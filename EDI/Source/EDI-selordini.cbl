      *{TOTEM}PRG-COMMENT
      * EDI-selordini.Cbl
      * EDI-selordini.Cbl is generated by TOTEM
      * This is a generated file. DO NOT modify this file directly.
      *{TOTEM}END
       IDENTIFICATION       DIVISION.
      *{TOTEM}PRGID
       PROGRAM-ID.          EDI-selordini.
       AUTHOR.              andre.
       DATE-WRITTEN.        martedì 25 ottobre 2022 09:30:13.
       REMARKS.
      *{TOTEM}END

       ENVIRONMENT          DIVISION.
       CONFIGURATION        SECTION.
       SPECIAL-NAMES.
      *{TOTEM}SPECIAL-NAME
      * <TOTEM:EPT. INIT:EDI-selordini, INIT:EDI-selordini, SpecialName>
      * <TOTEM:END>
      *{TOTEM}END
      *{TOTEM}ACTIVEX-DEF
      *{TOTEM}END
      *{TOTEM}DECIMAL-POINT
           DECIMAL-POINT IS COMMA.
      *{TOTEM}END

       INPUT-OUTPUT         SECTION.
       FILE-CONTROL.
      *{TOTEM}FILE-CONTROL
           COPY "clienti.sl".
           COPY "destini.sl".
           COPY "EDI-mtordini.sl".
           COPY "agenti.sl".
           COPY "tivaese.sl".
           COPY "ttipocli.sl".
           COPY "tvettori.sl".
           COPY "pagbloc.sl".
           COPY "tcaumag.sl".
           COPY "tmagaz.sl".
           COPY "note.sl".
           COPY "param.sl".
           COPY "recapiti.sl".
           COPY "EDI-mrordini.sl".
           COPY "articoli.sl".
           COPY "progmag.sl".
           COPY "sitfin.sl".
           COPY "tparamge.sl".
           COPY "mrordini.sl".
           COPY "mtordini.sl".
           COPY "timbalqta.sl".
           COPY "timposte.sl".
           COPY "tpiombo.sl".
           COPY "tmarche.sl".
           COPY "rpromo.sl".
           COPY "tpromo.sl".
           COPY "tmp-promo-prz.sl".
           COPY "listini.sl".
           COPY "locali.sl".
           COPY "blister.sl".
           COPY "cli-prg.sl".
           COPY "tcodpag.sl".
           COPY "tmp-progmag-zoom.sl".
           COPY "timballi.sl".
           COPY "tcontat.sl".
           COPY "lockfile.sl".
           COPY "tnazioni.sl".
           COPY "tscorte.sl".
           COPY "tmp-fido.sl".
           COPY "grade.sl".
           COPY "log-macrobatch.sl".
           COPY "macrobatch.sl".
           COPY "tprov.sl".
           COPY "EDI-clides.sl".
           COPY "anacap.sl".
      *{TOTEM}END
       DATA                 DIVISION.
       FILE                 SECTION.
      *{TOTEM}FILE
           COPY "clienti.fd".
           COPY "destini.fd".
           COPY "EDI-mtordini.fd".
           COPY "agenti.fd".
           COPY "tivaese.fd".
           COPY "ttipocli.fd".
           COPY "tvettori.fd".
           COPY "pagbloc.fd".
           COPY "tcaumag.fd".
           COPY "tmagaz.fd".
           COPY "note.fd".
           COPY "param.fd".
           COPY "recapiti.fd".
           COPY "EDI-mrordini.fd".
           COPY "articoli.fd".
           COPY "progmag.fd".
           COPY "sitfin.fd".
           COPY "tparamge.fd".
           COPY "mrordini.fd".
           COPY "mtordini.fd".
           COPY "timbalqta.fd".
           COPY "timposte.fd".
           COPY "tpiombo.fd".
           COPY "tmarche.fd".
           COPY "rpromo.fd".
           COPY "tpromo.fd".
           COPY "tmp-promo-prz.fd".
           COPY "listini.fd".
           COPY "locali.fd".
           COPY "blister.fd".
           COPY "cli-prg.fd".
           COPY "tcodpag.fd".
           COPY "tmp-progmag-zoom.fd".
           COPY "timballi.fd".
           COPY "tcontat.fd".
           COPY "lockfile.fd".
           COPY "tnazioni.fd".
           COPY "tscorte.fd".
           COPY "tmp-fido.fd".
           COPY "grade.fd".
           COPY "log-macrobatch.fd".
           COPY "macrobatch.fd".
           COPY "tprov.fd".
           COPY "EDI-clides.fd".
           COPY "anacap.fd".
      *{TOTEM}END

       WORKING-STORAGE      SECTION.
      *{TOTEM}ACU-DEF
               COPY "acugui.def".
               COPY "acucobol.def".
               COPY "fonts.def".
               COPY "crtvars.def".
               COPY "showmsg.def".
               COPY "totem.def".
               COPY "standard.def".
      *{TOTEM}END

      *{TOTEM}COPY-WORKING
      * Key Status
       77 Key-Status IS SPECIAL-NAMES CRT STATUS PIC 9(5) VALUE 0.
          88 Enter-Pushed VALUE 13.
          88 Exit-Pushed VALUE 27.
          88 Message-Received VALUE 95.
          88 Event-Occurred VALUE 96.
          88 Screen-No-Input-Field VALUE 97.
          88 Screen-Time-Out VALUE 99.
      * Properties & User defined Working Stoarge
           COPY  "COLOR-STATO-M.DEF".
       77 STATUS-clienti   PIC  X(2).
           88 Valid-STATUS-clienti VALUE IS "00" THRU "09". 
       77 STATUS-destini   PIC  X(2).
           88 Valid-STATUS-destini VALUE IS "00" THRU "09". 
       77 FILLER           PIC  9
                  VALUE IS 0.
           88 ControllaCliente VALUE IS 1    WHEN SET TO FALSE  0. 
       78 titolo VALUE IS "GESLUX EDI - Gestione Importazioni". 
       77 FILLER           PIC  9
                  VALUE IS 0.
           88 fromCancella VALUE IS 1    WHEN SET TO FALSE  0. 
       77 FILLER           PIC  9
                  VALUE IS 0.
           88 fromAggiungi VALUE IS 1    WHEN SET TO FALSE  0. 
       77 FILLER           PIC  9
                  VALUE IS 0.
           88 TrovataScortaForzata VALUE IS 1    WHEN SET TO FALSE  0. 
       78 78-edi-impord VALUE IS "EDI-impord". 
       01 FILLER           PIC  x.
           88 si-prg-listino VALUE IS "S". 
           88 no-prg-listino VALUE IS "N". 
           COPY  "EXTERNALS.DEF".
           COPY  "LINK-NAMBAR.DEF".
           COPY  "LINK-SITFIN.DEF".
           COPY  "LINK-CHK-ORD-CLI.DEF".
           COPY  "LINK-PASSWD.DEF".
           COPY  "TROVA-PARAMETRO.DEF".
           COPY  "COSTO-MEDIO.DEF".
           COPY  "IMPOSTE.DEF".
           COPY  "LINK-WPROGMAG.DEF".
           COPY  "LINK-SOST-ART.DEF".
           COPY  "LOG-MACROBATCH.DEF".
       77 toolbar-bmp      PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 data-evadi-dal-old           PIC  9(8)
                  VALUE IS 0.
       77 mult PIC  9v99.
       77 tot-righe-edi    PIC  9(10).
       77 tot-doc          PIC  9(10)v99.
       77 riga-edi         PIC  9(10).
       77 old-des-cap      PIC  x(5).
       77 old-des-prov     PIC  xx.
       77 iva-std          PIC  x(3).
       77 link-path        PIC  x(512).
       77 fido-tmp         PIC  s9(13)v99.
       77 fido-usato       PIC  s9(13)v99.
       77 como-prz         PIC  9(13)v99.
       77 como-prezzo      PIC  9(13)v99.
       77 como-prezzo2     PIC  9(13)v99.
       77 TotPrzBlister    PIC  9(13)v99.
       77 num-promo        PIC  9(3).
       77 LastIdx          PIC  9(3).
       77 giacenza         PIC  s9(8).
       77 como-record      PIC  x(32000).
       01 tab-tipologie.
           05 el-tipo          PIC  x(2)
                      OCCURS 100 TIMES.
       01 GiacenzaKey.
           10 gia-prg-cod-articolo         PIC  9(6).
           10 gia-prg-cod-magazzino        PIC  X(3).
           10 gia-prg-tipo-imballo         PIC  X(3).
           10 gia-prg-peso     PIC  9(5)v9(3).
       01 como-prg-chiave.
           10 como-prg-cod-articolo        PIC  9(6).
           10 como-prg-cod-magazzino       PIC  X(3).
           10 como-prg-tipo-imballo        PIC  X(3).
           10 como-prg-peso    PIC  9(5)v9(3).
       01 FILLER           PIC  9.
           88 si-promo VALUE IS 1. 
           88 no-promo VALUE IS 0. 
       77 Form1-Tb-1-Handle
                  USAGE IS HANDLE OF WINDOW.
       01 FILLER           PIC  9.
           88 hid-bloccato VALUE IS 1    WHEN SET TO FALSE  0. 
       77 save-tpr-codice  PIC  9(15).
       01 GdoInUsoFlag     PIC  x.
           88 GdoInUso VALUE IS "S". 
           88 GdoNonInUso VALUE IS "N" " ". 
       77 SavePag          PIC  x(3).
       77 Sum  PIC  s9(9)v99.
       77 SavePrezzo       PIC  s9(9)v99.
       77 tot-qta          PIC  9(10).
       77 primo-numero     PIC  9(8).
       77 primo-numero-z   PIC  z(8).
       77 ultimo-numero    PIC  9(8).
       77 ultimo-numero-z  PIC  z(8).
       77 idx-ordini       PIC  9(3).
       77 save-ordinato    PIC  s9(10).
       77 counter          PIC  9(10).
       77 counter2         PIC  9(10).
       77 StoreDesMagazzino            PIC  x(50).
       01 FILLER           PIC  9.
           88 ChiamaZoomProgressivo VALUE IS 1    WHEN SET TO FALSE  0. 
       77 counter-edit     PIC  z.zzz.zzz.zz9,99.
       01 tab-ordini.
           05 chiave-ordine
                      OCCURS 999 TIMES.
               10 ordine-anno      PIC  9(4).
               10 ordine-numero    PIC  9(8).
       77 tot-fido         PIC  s9(9)v99.
       77 como-edit        PIC  zzz.zzz.zz9,99.
       77 scoperto         PIC  s9(9)v99.
       77 num-articoli     PIC  9(5).
       77 imballo-descrizione          PIC  x(50).
       01 save-prg-chiave.
           10 save-prg-cod-articolo        PIC  9(6).
           10 save-prg-cod-magazzino       PIC  X(3).
           10 save-prg-tipo-imballo        PIC  X(3).
           10 save-prg-peso    PIC  9(5)v9(3).
       77 Arial10B
                  USAGE IS HANDLE OF FONT.
       01 gruppo-hidden.
           05 hid-emro-qta-imballi         PIC  9(5).
           05 HiddenKeyL.
               10 hid-prg-cod-articoloL        PIC  9(6).
               10 hid-prg-cod-magazzinoL       PIC  X(3).
               10 hid-prg-tipo-imballoL        PIC  X(3).
               10 hid-prg-pesoL    PIC  9(5)v9(3).
           05 HiddenKey.
               10 hid-prg-cod-articolo         PIC  9(6).
               10 hid-prg-cod-magazzino        PIC  X(3).
               10 hid-prg-tipo-imballo         PIC  X(3).
               10 hid-prg-peso     PIC  9(5)v9(3).
           05 hid-emro-blister PIC  9.
               88 hid-emro-si-blister VALUE IS 1    WHEN SET TO FALSE  
           0. 
           05 hid-emro-errori.
               10 emro-articolo    PIC  9.
                   88 hid-emro-articolo-valido VALUE IS 0. 
                   88 hid-emro-articolo-non-valido VALUE IS 1. 
                   88 hid-emro-articolo-non-attivo VALUE IS 2. 
      *(( XFD NAME = emro-articolo_1 ))
               10 hid-emro-qtac    PIC  9.
                   88 hid-emro-qtac-ok VALUE IS 0. 
                   88 hid-emro-qtac-non-presente VALUE IS 1. 
                   88 hid-emro-qtac-adattata VALUE IS 2. 
      *(( XFD NAME = emro-articolo_1_1 ))
               10 hid-emro-prezzo  PIC  9.
                   88 hid-emro-prezzo-valido VALUE IS 0. 
                   88 hid-emro-prezzo-non-valido VALUE IS 1. 
      *(( XFD NAME = emro-articolo_1_2 ))
               10 hid-emro-progressivo         PIC  9.
                   88 hid-emro-progressivo-valido VALUE IS 0. 
                   88 hid-emro-progressivo-non-trovato VALUE IS 1. 
                   88 hid-emro-progressivo-non-attivo VALUE IS 2. 
                   88 hid-emro-progressivo-non-forzato VALUE IS 3. 
           05 hid-emro-qta     PIC  9(8).
           05 hid-emro-prz     PIC  9(9)v9(2).
           05 hid-emro-evadi-dal           PIC  9(8).
           05 hid-emro-stato   PIC  X(1).
               88 hid-emro-attivo VALUE IS "A". 
               88 hid-emro-bloccato VALUE IS "B". 
           05 hid-emro-bloccato-prezzo     PIC  X(1).
               88 hid-emro-bloccato-prezzo-si VALUE IS 1. 
               88 hid-emro-bloccato-prezzo-no VALUE IS 0. 
       77 como-div         PIC  9(4).
       77 old-riga         PIC  9(4).
       77 righe-errate     PIC  9(4).
       77 TrattamentoInUso PIC  x.
       77 como-qta         PIC  9(8).
       77 FILLER           PIC  9.
           88 trovato-movim VALUE IS 1    WHEN SET TO FALSE  0. 
       77 FILLER           PIC  9.
           88 trovato-promo VALUE IS 1    WHEN SET TO FALSE  0. 
       77 FILLER           PIC  9.
           88 StoSalvando VALUE IS 1    WHEN SET TO FALSE  0. 
       77 SaveIva          PIC  x(3).
       77 SaveVet          PIC  9(5).
       77 data-oggi        PIC  9(8).
       77 E-ESCI           PIC  9
                  VALUE IS 1.
       77 E-NUOVO          PIC  9
                  VALUE IS 1.
       77 save-riga        PIC  9(9).
       77 E-CANCELLA       PIC  9
                  VALUE IS 1.
       77 tit-stato-ordine PIC  x(20).
       01 FILLER           PIC  9
                  VALUE IS 0.
           88 RicaricaGrid VALUE IS 1    WHEN SET TO FALSE  0. 
       01 stato-ordine     PIC  x.
           88 tutti VALUE IS " ". 
           88 attivi VALUE IS "A". 
           88 bloccati VALUE IS "B". 
       77 FILLER           PIC  9.
           88 CallManutenzione VALUE IS 1    WHEN SET TO FALSE  0. 
       77 FILLER           PIC  9.
           88 RigaCambiata VALUE IS 1    WHEN SET TO FALSE  0. 
       77 E-SALVA          PIC  9
                  VALUE IS 1.
       77 E-ANTEPRIMA      PIC  9
                  VALUE IS 0.
       77 E-MODIFICA       PIC  9
                  VALUE IS 1.
       77 E-STAMPA         PIC  9
                  VALUE IS 0.
       77 E-CERCA          PIC  9
                  VALUE IS 0.
       77 E-SELEZIONA      PIC  9
                  VALUE IS 1.
       77 Small-Font
                  USAGE IS HANDLE OF FONT SMALL-FONT.
       77 Default-Font
                  USAGE IS HANDLE OF FONT DEFAULT-FONT.
       77 Form1-St-1-Handle
                  USAGE IS HANDLE OF STATUS-BAR.
       77 form1-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 mod-fis          PIC  9
                  VALUE IS 1.
       77 AUTO-ID          PIC  9(6)
                  VALUE IS 0.
       77 TIPO-ELAB        PIC  9
                  VALUE IS 0.
       77 MOD-LIMITI       PIC  9
                  VALUE IS 1.
       77 ok-73x21-bmp     PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 cancel-73x21-bmp PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 BLUE-FINO-28X24-BMP          PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 BLUE-DA-28X24-BMP            PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 CBO-stato-ord-BUF            PIC  X(50).
       77 ANNO-TO          PIC  9(04).
       77 ordine-FROM      PIC  9(08).
       77 ordine-TO        PIC  9(08).
       77 data-FROM        PIC  9(08).
       77 CLIENTE-FROM     PIC  9(05).
       77 CLIENTE-TO       PIC  9(05).
       77 data-TO          PIC  9(08).
       77 data-to-AAAAMMGG PIC  9(8).
       77 data-from-AAAAMMGG           PIC  9(8).
       77 form2-Handle
                  USAGE IS HANDLE OF WINDOW.
       01 FILLER           PIC  x.
           88 controllo-finale VALUE IS "F"    WHEN SET TO FALSE  "N". 
       01 Gd-ordini-Record.
           05 col-nulla        PIC  X.
           05 Col-anno         PIC  9(4).
           05 Col-numero       PIC  z(7)9.
           05 Col-ord-cli      PIC  X(50).
           05 Col-data         PIC  x(10).
           05 col-stato        PIC  x(50).
           05 Col-cliente      PIC  z(4)9.
           05 Col-rag-soc-cli  PIC  X(40).
           05 Col-rag-soc-destini          PIC  X(40).
           05 Col-indirizzo    PIC  X(40).
           05 Col-localita     PIC  X(35).
       01 FILLER           PIC  9.
           88 record-ok VALUE IS 1    WHEN SET TO FALSE  0. 
       77 como-colore      PIC  9(5).
       77 Verdana10B-Occidentale
                  USAGE IS HANDLE OF FONT DEFAULT-FONT.
       77 como-x           PIC  x.
       01 como-chiave-ordine.
           05 como-anno        PIC  9(4).
           05 como-numero-ordine           PIC  9(8).
       77 Form3-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 Verdana12BI-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 font-evidenzia-griglia
                  USAGE IS HANDLE OF FONT.
       77 Arial11B-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 Arial11BI-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 Screen1-St-1-Handle
                  USAGE IS HANDLE OF STATUS-BAR.
       77 col-stato-ordine PIC  9(6)
                  VALUE IS 0.
       77 elemento-bmp     PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS ZERO.
       77 como-riga
                  USAGE IS UNSIGNED-INT.
       77 bottone-ok-bmp   PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 bottone-cancel-bmp           PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 Verdana12-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 STATUS-tparamge  PIC  X(2).
           88 Valid-STATUS-tparamge VALUE IS "00" THRU "09". 
       77 lab-cli-buf      PIC  x(50).
       77 lab-des-buf      PIC  X(50).
       77 Form1-Tb-1-Handlea
                  USAGE IS HANDLE OF WINDOW.
       77 CBO-stato-cons-BUF           PIC  X(50).
       77 STATUS-EDI-mtordini          PIC  X(2).
           88 Valid-STATUS-EDI-mtordini VALUE IS "00" THRU "09". 
       77 CBO-stato-ordine-BUF         PIC  X(50).
       77 BOTTOgNE-OK-BMP  PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 lab-bloccati-buf PIC  zzz.zz9.
       77 lab-attivi-buf   PIC  zzz.zz9.
       77 tot-attivi       PIC  9(6)
                  VALUE IS 0.
       77 tot-bloccati     PIC  9(6)
                  VALUE IS 0.
       77 lab-err-prg-buf  PIC  X(3).
       77 lab-err-prz-buf  PIC  X(3).
       77 lab-err-art-buf  PIC  X(3).
       77 lab-err-qta-buf  PIC  X(3).
       77 lab-err-righe-buf            PIC  X(3).
       77 lab-err-des-buf  PIC  X(3).
       77 lab-err-cli-buf  PIC  x(3).
       77 col-lab-err-cli  PIC  9(6)
                  VALUE IS 0.
       77 col-lab-err-des  PIC  9(6)
                  VALUE IS 0.
       77 col-lab-err-righe            PIC  9(6)
                  VALUE IS 0.
       77 col-lab-err-qta  PIC  9(6)
                  VALUE IS 0.
       77 col-lab-err-art  PIC  9(6)
                  VALUE IS 0.
       77 col-lab-err-prg  PIC  9(6)
                  VALUE IS 0.
       77 col-lab-err-prz  PIC  9(6)
                  VALUE IS 0.
       77 col-lab-err-bloc PIC  9(6)
                  VALUE IS 0.
       77 Verdana12B-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 Screen2-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 Verdana10-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 lab-cliente-buf  PIC  X(100).
       77 lab-destino-buf  PIC  X(100).
       77 lab-agente-buf   PIC  X(100).
       77 lab-pagamento-buf            PIC  X(100).
       77 lab-iva-buf      PIC  X(100).
       77 lab-vettore-buf  PIC  X(100).
       77 lab-stato-buf    PIC  X(100).
       77 col-lab-stato    PIC  9(6)
                  VALUE IS 0.
       77 STATUS-agenti    PIC  X(2).
           88 Valid-STATUS-agenti VALUE IS "00" THRU "09". 
       77 status-tcodpag   PIC  X(2).
           88 Valid-status-tcodpag VALUE IS "00" THRU "09". 
       77 STATUS-tivaese   PIC  X(2).
           88 Valid-STATUS-tivaese VALUE IS "00" THRU "09". 
       77 STATUS-ttipocli  PIC  X(2).
           88 Valid-STATUS-ttipocli VALUE IS "00" THRU "09". 
       77 STATUS-tvettori  PIC  X(2).
           88 Valid-STATUS-tvettori VALUE IS "00" THRU "09". 
       77 clr-cliente      PIC  9(6)
                  VALUE IS 257.
       77 clr-destino      PIC  9(6)
                  VALUE IS 1.
       77 clr-causale      PIC  9(6)
                  VALUE IS 1.
       77 clr-agente       PIC  9(6)
                  VALUE IS 1.
       77 clr-vettore      PIC  9(6)
                  VALUE IS 1.
       77 clr-pagamento    PIC  9(6)
                  VALUE IS 1.
       77 clr-iva          PIC  9(6)
                  VALUE IS 1.
       77 como-numero      PIC  9(9)v99999.
       77 Screen2-St-1-Handle
                  USAGE IS HANDLE OF STATUS-BAR.
       77 como-entry       PIC  x.
       77 form-ini-Handle
                  USAGE IS HANDLE OF WINDOW.
       78 78-col-num VALUE IS 1. 
       78 78-col-art VALUE IS 2. 
       78 78-col-des VALUE IS 3. 
       78 78-col-imb VALUE IS 4. 
       78 78-col-qta-EDI VALUE IS 5. 
       78 78-col-qta-GESLUX VALUE IS 6. 
       78 78-col-qta VALUE IS 7. 
       78 78-col-prz-EDI VALUE IS 8. 
       78 78-col-prz-GESLUX VALUE IS 9. 
       78 78-col-prz VALUE IS 10. 
       78 78-col-evadi-dal VALUE IS 11. 
       78 78-col-stato-r VALUE IS 12. 
       01 rec-grid.
           05 col-num          PIC  z(5).
           05 col-art          PIC  zzzzz9.
           05 col-des          PIC  x(50).
           05 col-imb          PIC  x(3).
           05 col-qta-EDI      PIC  z(7)9.
           05 col-qta-GESLUX   PIC  z(7)9.
           05 col-qta          PIC  z(7)9.
           05 col-prz-EDI      PIC  zzz.zzz.zz9,99.
           05 col-prz-GESLUX   PIC  zzz.zzz.zz9,99.
           05 col-prz          PIC  zzz.zzz.zz9,99.
           05 col-evadi-dal    PIC  99/99/9999.
           05 col-stato-r      PIC  xx.
       77 STATUS-pagbloc   PIC  X(2).
           88 Valid-STATUS-pagbloc VALUE IS "00" THRU "09". 
       77 STATUS-tcaumag   PIC  X(2).
           88 Valid-STATUS-tcaumag VALUE IS "00" THRU "09". 
       77 STATUS-tmagaz    PIC  X(2).
           88 Valid-STATUS-tmagaz VALUE IS "00" THRU "09". 
       77 STATUS-note      PIC  X(2).
           88 Valid-STATUS-note VALUE IS "00" THRU "09". 
       77 STATUS-param     PIC  X(2).
           88 Valid-STATUS-param VALUE IS "00" THRU "09". 
       77 STATUS-recapiti  PIC  X(2).
           88 Valid-STATUS-recapiti VALUE IS "00" THRU "09". 
       77 STATUS-EDI-mrordini          PIC  X(2).
           88 Valid-STATUS-EDI-mrordini VALUE IS "00" THRU "09". 
       77 STATUS-articoli  PIC  X(2).
           88 Valid-STATUS-articoli VALUE IS "00" THRU "09". 
       77 STATUS-progmag   PIC  X(2).
           88 Valid-STATUS-progmag VALUE IS "00" THRU "09". 
       77 STATUS-sitfin    PIC  X(2).
           88 Valid-STATUS-sitfin VALUE IS "00" THRU "09". 
       77 STATUS-tmarche   PIC  X(2).
           88 Valid-STATUS-tmarche VALUE IS "00" THRU "09". 
       77 FILLER           PIC  9
                  VALUE IS 0.
           88 prezzo-sp VALUE IS 1    WHEN SET TO FALSE  0. 
       77 FILLER           PIC  9
                  VALUE IS 0.
           88 promo-future VALUE IS 1    WHEN SET TO FALSE  0. 
       77 Verdana8B-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 ef-imb-buf       PIC  x(3).
       77 ef-peso-buf      PIC  z.zz9,999.
       77 ef-imb-l-buf     PIC  x(3).
       77 ef-peso-l-buf    PIC  z.zz9,999.
       77 ef-uni-EDI-buf   PIC  zzz.zz9,99.
       77 ef-uni-GESLUX-buf            PIC  zzz.zz9,99.
       77 ef-qta-buf       PIC  zz.zzz.zz9.
       77 genera-bmp       PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 Verdana9-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 Arial10-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 Arial10B-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 Arial12-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 tor-anno         PIC  9(4).
       77 mod-campi        PIC  9
                  VALUE IS 1.
       77 tor-causale      PIC  x(4).
       77 mod-cliente-destino          PIC  9
                  VALUE IS 1.
       77 tor-cod-cli      PIC  9(5).
       77 tor-prg-destino  PIC  9(5).
       77 Form1-Pg-1-Visible           PIC  9
                  VALUE IS 0.
       77 tor-num-ord-cli  PIC  X(10).
       77 tor-data-ordine  PIC  9(8).
       77 tor-data-passaggio-ordine    PIC  9(8).
       77 tor-cod-agente   PIC  9(5).
       77 tor-cod-pagamento            PIC  x(3).
       77 tor-cod-ese-iva  PIC  x(3).
       77 tor-vettore      PIC  9(5).
       77 tor-note1        PIC  X(19).
       77 tor-data-note1   PIC  9(8).
       77 tor-note2        PIC  X(30).
       77 tor-note3        PIC  X(30).
       77 tor-note4        PIC  X(30).
       01 .
           03 tor-stato-Item.
               05      PIC  X(10).
           78 tor-stato-Num VALUE IS 1. 
           03 tor-stato REDEFINES tor-stato-Item  PIC  X(10)
                      OCCURS 1 TIMES
                      INDEXED  tor-stato-Idx.
       77 cbo-stato-buf    PIC  X(10).
       77 e-man            PIC  9
                  VALUE IS 1.
       77 tor-mod-caricamento          PIC  S9(1)
                  VALUE IS 1.
       77 e-gui            PIC  9
                  VALUE IS 1.
       77 DATI-BOLLA-BMP   PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 lab-pag-buf      PIC  X(100).
       77 tor-num-bolla    PIC  9(8).
       77 tor-data-bolla   PIC  9(8).
       77 tor-num-fattura  PIC  9(8).
       77 tor-data-fattura PIC  9(8).
       77 lab-bolla-pren-buf           PIC  x(50).
       77 lab-invio-buf    PIC  x(50).
       77 lab-fatt-pren-buf            PIC  x(50).
       77 lab-lotto-buf    PIC  x(50).
       77 tor-data-bolla-dummy         PIC  X(30).
       77 tor-num-bolla-dummy          PIC  X(30).
       77 Form1-Pg-2-Visible           PIC  9
                  VALUE IS 0.
       77 v-manuale        PIC  9
                  VALUE IS 1.
       77 ror-cod-articolo PIC  9(6).
       77 ror-qta          PIC  9(8).
       77 ror-prz-unitario PIC  9(9)v9(2).
       77 ror-perce-sconto PIC  9(2)v9(2).
       77 ror-imp-consumo  PIC  9(4)v9(2).
       77 ror-imp-cou-cobat            PIC  9(4)v9(2).
       77 ror-imponib-merce            PIC  9(9)v9(2).
       77 ror-cod-iva      PIC  x(3).
       77 v-guidata        PIC  9
                  VALUE IS 1.
       77 STRIP-GRID-GCLIENTI-BMP      PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 label-cou-cobat  PIC  x(25)
                  VALUE IS "Imposta C.O.U./COBAT".
       77 Colorgiacenza    PIC  9(6)
                  VALUE IS 0.
       77 ColorImpegnato   PIC  9(6)
                  VALUE IS 0.
       77 ColorOrdinato    PIC  9(6)
                  VALUE IS 0.
       77 giacenza-ed      PIC  ---.---.--9.
       77 impegnato-ed     PIC  ---.---.--9.
       77 ordinato-ed      PIC  ---.---.--9.
       77 lab-iva-2-buf    PIC  X(100).
       77 lab-ivato-buf    PIC  z.zzz.zzz.zz9,99.
       77 v-dett           PIC  9
                  VALUE IS 1.
       77 lab-tot-ivato-buf            PIC  z.zzz.zzz.zz9,99.
       77 numero-edit      PIC  z(8).
       77 NOTACR-BMP       PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 v-nota           PIC  9
                  VALUE IS 1.
       77 giacenza-maggiore            PIC  s9(8).
       77 giacenza-fisica  PIC  s9(8).
       77 SaveArticolo     PIC  9(6).
       77 como-articolo    PIC  9(6).
       77 como-magazzino   PIC  x(3).
       77 Form1-Tb-1-Handleb
                  USAGE IS HANDLE OF WINDOW.
       77 STATUS-mrordini  PIC  X(2).
           88 Valid-STATUS-mrordini VALUE IS "00" THRU "09". 
       77 STATUS-mtordini  PIC  X(2).
           88 Valid-STATUS-mtordini VALUE IS "00" THRU "09". 
       77 STATUS-timbalqta PIC  X(2).
           88 Valid-STATUS-timbalqta VALUE IS "00" THRU "09". 
       77 STATUS-timballi  PIC  X(2).
           88 Valid-STATUS-timballi VALUE IS "00" THRU "09". 
       77 STATUS-timposte  PIC  X(2).
           88 Valid-STATUS-timposte VALUE IS "00" THRU "09". 
       77 STATUS-tpiombo   PIC  X(2).
           88 Valid-STATUS-tpiombo VALUE IS "00" THRU "09". 
       77 scr-fine-SF-HANDLE
                  USAGE IS HANDLE OF WINDOW.
       77 tot-ordini-z     PIC  ZZ.ZZZ.ZZ9.
       77 giacenza-assoluta            PIC  9(8).
       77 giacenza-assoluta-maggiore   PIC  9(8).
       77 imballi-ed       PIC  zz.zz9.
       77 Arial-Black12B-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 FILLER           PIC  9
                  VALUE IS 0.
           88 filtro-articoli VALUE IS 1    WHEN SET TO FALSE  0. 
       77 STATUS-rpromo    PIC  X(2).
           88 Valid-STATUS-rpromo VALUE IS "00" THRU "09". 
       77 STATUS-tpromo    PIC  X(2).
           88 Valid-STATUS-tpromo VALUE IS "00" THRU "09". 
       77 lab-err-doppio-buf           PIC  x(3).
       77 col-lab-err-doppio           PIC  9(6)
                  VALUE IS 0.
       77 path-tmp-promo-prz           PIC  X(256).
       77 STATUS-tmp-promo-prz         PIC  X(2).
           88 Valid-STATUS-tmp-promo-prz VALUE IS "00" THRU "09". 
       77 STATUS-listini   PIC  X(2).
           88 Valid-STATUS-listini VALUE IS "00" THRU "09". 
       77 STATUS-locali    PIC  X(2).
           88 Valid-STATUS-locali VALUE IS "00" THRU "09". 
       77 STATUS-blister   PIC  X(2).
           88 Valid-STATUS-blister VALUE IS "00" THRU "09". 
       77 STATUS-cli-prg   PIC  X(2).
           88 Valid-STATUS-cli-prg VALUE IS "00" THRU "09". 
       77 elimina-bmp      PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 bottone-aggiorna-bmp         PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 cambia-bmp       PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 path-tmp-progmag-zoom        PIC  X(256).
       77 STATUS-tmp-progmag-zoom      PIC  X(2).
           88 Valid-STATUS-tmp-progmag-zoom VALUE IS "00" THRU "09". 
       77 STATUS-tcontat   PIC  X(2).
           88 Valid-STATUS-tcontat VALUE IS "00" THRU "09". 
       77 lab-err-bloc-buf PIC  X(3).
       77 sel-tutto-bmp    PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 desel-tutto-bmp  PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       01 gd-tipocli-rec.
           05 col-tcl-codice   PIC  X(2).
           05 col-tcl-descrizione          PIC  X(50).
           05 hid-col-sel      PIC  9.
       77 ef-note-edi-buf  PIC  X(3000).
       77 Arial9-Occidentale
                  USAGE IS HANDLE OF FONT.
       01 FILLER           PIC  9
                  VALUE IS 0.
           88 RichiamoBatch VALUE IS 1    WHEN SET TO FALSE  0. 
       77 STATUS-lockfile  PIC  X(2).
           88 Valid-STATUS-lockfile VALUE IS "00" THRU "09". 
       77 STATUS-tnazioni  PIC  X(2).
           88 Valid-STATUS-tnazioni VALUE IS "00" THRU "09". 
       77 STATUS-tscorte   PIC  X(2).
           88 Valid-STATUS-tscorte VALUE IS "00" THRU "09". 
       77 STATUS-grade     PIC  X(2).
           88 Valid-STATUS-grade VALUE IS "00" THRU "09". 
       77 path-tmp-fido    PIC  X(256).
       77 STATUS-tmp-fido  PIC  X(2).
           88 Valid-STATUS-tmp-fido VALUE IS "00" THRU "09". 
       77 video-on         PIC  9
                  VALUE IS 0.
       77 path-log-macrobatch          PIC  X(256).
       77 STATUS-log-macrobatch        PIC  X(2).
           88 Valid-STATUS-log-macrobatch VALUE IS "00" THRU "09". 
       77 STATUS-macrobatch            PIC  X(2).
           88 Valid-STATUS-macrobatch VALUE IS "00" THRU "09". 
       77 tit-elab         PIC  X(30).
       77 AGGIUNGI-BMP     PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 lab-tot-buf      PIC  zz.zzz.zz9,99.
       77 STATUS-anautf    PIC  X(2).
           88 Valid-STATUS-anautf VALUE IS "00" THRU "09". 
       77 STATUS-tprov     PIC  X(2).
           88 Valid-STATUS-tprov VALUE IS "00" THRU "09". 
       77 STATUS-EDI-clides            PIC  X(2).
           88 Valid-STATUS-EDI-clides VALUE IS "00" THRU "09". 
       77 STATUS-anacap    PIC  X(2).
           88 Valid-STATUS-anacap VALUE IS "00" THRU "09". 

      ***********************************************************
      *   Code Gen's Buffer                                     *
      ***********************************************************
       77 STATUS-Form2-FLAG-REFRESH PIC  9.
          88 Form2-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 TMP-Form2-KEY1-ORDER  PIC X VALUE "A".
       77 TMP-Form2-EDI-mtordini-RESTOREBUF  PIC X(8412).
       77 TMP-Form2-KEYIS  PIC 9(3) VALUE 1.
       77 Form2-MULKEY-TMPBUF   PIC X(8412).
       77 Form2-KEYISTMP1   PIC X(13).
      * Form2 : PKEY & AKEY'S TEMP BUFFER
       77 Form2-PKEYTMP   PIC X(12).
       77 STATUS-Form-ini-FLAG-REFRESH PIC  9.
          88 Form-ini-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 STATUS-form3-FLAG-REFRESH PIC  9.
          88 form3-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 STATUS-Form1-FLAG-REFRESH PIC  9.
          88 Form1-FLAG-REFRESH  VALUE 1 FALSE 0. 
      * DATA CONTROL BUFFER
       01 Form1-BUF.
      * Data.Entry-Field
              05 ef-cli-BUF PIC 9(5).
              05 ef-cli-VALUEBUF PIC 9(5).
      * Data.Entry-Field
              05 ef-des-BUF PIC 9(5).
              05 ef-des-VALUEBUF PIC 9(5).
      * Data.Entry-Field
              05 ef-prov-d-BUF PIC X(2).
      * Data.Entry-Field
              05 ef-cap-d-BUF PIC X(5).
      * Data.Entry-Field
              05 ef-num-ord-BUF PIC X(50).
              05 ef-num-ord-VALUEBUF PIC X(50).
      * Data.Entry-Field
              05 ef-data-BUF PIC 99/99/9999.
              05 ef-data-VALUEBUF PIC 9(8).
      * Data.Entry-Field
              05 ef-data-pass-BUF PIC 99/99/9999.
      * Data.Entry-Field
              05 ef-evadi-dal-BUF PIC 99/99/9999.
      * Data.Entry-Field
              05 ef-age-BUF PIC z(5).
      * Data.Entry-Field
              05 ef-pag-BUF PIC X(3).
      * Data.Entry-Field
              05 ef-iva-BUF PIC X(3).
      * Data.Entry-Field
              05 ef-vet-BUF PIC z(5).
      * Data.Entry-Field
              05 ef-note-1-BUF PIC X(19).
      * Data.Entry-Field
              05 ef-data-cons-BUF PIC 99/99/9999.
      * Data.Entry-Field
              05 ef-note-2-BUF PIC X(30).
      * Data.Entry-Field
              05 ef-note-3-BUF PIC X(30).
      * Data.Entry-Field
              05 ef-note-4-BUF PIC X(30).
      * Data.Entry-Field
              05 ef-note-BUF PIC X(500).
      * Data.Check-Box
              05 chk-ritira-BUF PIC 9 VALUE ZERO.
      * Data.Check-Box
              05 chk-prenot-BUF PIC 9 VALUE ZERO.
      * Data.Check-Box
              05 chk-saldi-banco-BUF PIC 9 VALUE ZERO.
      * Data.Check-Box
              05 chk-saldi-promo-BUF PIC 9 VALUE ZERO.
      * Data.Check-Box
              05 chk-ev-immediata-BUF PIC 9 VALUE ZERO.
      * Data.Check-Box
              05 chk-contrassegno-BUF PIC 9 VALUE ZERO.
      * Data.Label
              05 lab-anno-BUF PIC 9(4).
      * Data.Label
              05 lab-numero-BUF PIC z(8).
      * Data.Label
              05 lab-nab-codbuyer-BUF PIC X(17).
      * Data.Label
              05 lab-nab-rafsocb-BUF PIC X(70).
      * Data.Label
              05 lab-nab-indirb-BUF PIC X(35).
      * Data.Label
              05 lab-nab-cittab-BUF PIC X(35).
      * Data.Label
              05 lab-nab-provb-BUF PIC X(3).
      * Data.Label
              05 lab-nab-capb-BUF PIC X(5).
      * Data.Label
              05 lab-nad-codcons-BUF PIC X(17).
      * Data.Label
              05 lab-nad-ragsocd-BUF PIC X(70).
      * Data.Label
              05 lab-nad-indird-BUF PIC X(35).
      * Data.Label
              05 lab-nad-cittad-BUF PIC X(35).
      * Data.Label
              05 lab-nad-provd-BUF PIC X(3).
      * Data.Label
              05 lab-nad-capd-BUF PIC X(5).

       77 TMP-Form1-KEY1-ORDER  PIC X VALUE "A".
       77 TMP-Form1-EDI-mtordini-RESTOREBUF  PIC X(8412).
       77 TMP-Form1-KEYIS  PIC 9(3) VALUE 1.
       77 Form1-MULKEY-TMPBUF   PIC X(8412).
       77 Form1-KEYISTMP1   PIC X(13).
      * Form1 : PKEY & AKEY'S TEMP BUFFER
       77 Form1-PKEYTMP   PIC X(12).
       77 STATUS-form-gen-FLAG-REFRESH PIC  9.
          88 form-gen-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 STATUS-scr-fine-FLAG-REFRESH PIC  9.
          88 scr-fine-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 TMP-DataSet1-clienti-BUF     PIC X(3610).
       77 TMP-DataSet1-destini-BUF     PIC X(3676).
       77 TMP-DataSet1-EDI-mtordini-BUF     PIC X(8412).
       77 TMP-DataSet1-agenti-BUF     PIC X(1233).
       77 TMP-DataSet1-tivaese-BUF     PIC X(1380).
       77 TMP-DataSet1-ttipocli-BUF     PIC X(889).
       77 TMP-DataSet1-tvettori-BUF     PIC X(1847).
       77 TMP-DataSet1-pagbloc-BUF     PIC X(609).
       77 TMP-DataSet1-tcaumag-BUF     PIC X(254).
       77 TMP-DataSet1-tmagaz-BUF     PIC X(212).
       77 TMP-DataSet1-note-BUF     PIC X(284).
       77 TMP-DataSet1-param-BUF     PIC X(980).
       77 TMP-DataSet1-recapiti-BUF     PIC X(328).
       77 TMP-DataSet1-EDI-mrordini-BUF     PIC X(1474).
       77 TMP-DataSet1-articoli-BUF     PIC X(3669).
       77 TMP-DataSet1-progmag-BUF     PIC X(1090).
       77 TMP-DataSet1-sitfin-BUF     PIC X(888).
       77 TMP-DataSet1-tparamge-BUF     PIC X(815).
       77 TMP-DataSet1-mrordini-BUF     PIC X(891).
       77 TMP-DataSet1-mtordini-BUF     PIC X(2122).
       77 TMP-DataSet1-timbalqta-BUF     PIC X(167).
       77 TMP-DataSet1-timposte-BUF     PIC X(717).
       77 TMP-DataSet1-tpiombo-BUF     PIC X(739).
       77 TMP-DataSet1-tmarche-BUF     PIC X(217).
       77 TMP-DataSet1-rpromo-BUF     PIC X(209).
       77 TMP-DataSet1-tpromo-BUF     PIC X(263).
       77 TMP-DataSet1-tmp-promo-prz-BUF     PIC X(74).
       77 TMP-DataSet1-listini-BUF     PIC X(207).
       77 TMP-DataSet1-locali-BUF     PIC X(203).
       77 TMP-DataSet1-blister-BUF     PIC X(2967).
       77 TMP-DataSet1-cli-prg-BUF     PIC X(577).
       77 TMP-DataSet1-tcodpag-BUF     PIC X(1380).
       77 TMP-DataSet1-tmp-progmag-zoom-BUF     PIC X(195).
       77 TMP-DataSet1-timballi-BUF     PIC X(210).
       77 TMP-DataSet1-tcontat-BUF     PIC X(3270).
       77 TMP-DataSet1-lockfile-BUF     PIC X(183).
       77 TMP-DataSet1-tnazioni-BUF     PIC X(190).
       77 TMP-DataSet1-tscorte-BUF     PIC X(205).
       77 TMP-DataSet1-tmp-fido-BUF     PIC X(78).
       77 TMP-DataSet1-grade-BUF     PIC X(754).
       77 TMP-DataSet1-log-macrobatch-BUF     PIC X(1000).
       77 TMP-DataSet1-macrobatch-BUF     PIC X(9848).
       77 TMP-DataSet1-tprov-BUF     PIC X(192).
       77 TMP-DataSet1-EDI-clides-BUF     PIC X(840).
       77 TMP-DataSet1-anacap-BUF     PIC X(1209).
      * VARIABLES FOR RECORD LENGTH.
       77  TotemFdSlRecordClearOffset   PIC 9(5) COMP-4.
       77  TotemFdSlRecordLength        PIC 9(5) COMP-4.
      * FILE'S LOCK MODE FLAG
       77 DataSet1-clienti-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-clienti-LOCK  VALUE "Y".
       77 DataSet1-clienti-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-clienti-KEY-Asc  VALUE "A".
          88 DataSet1-clienti-KEY-Desc VALUE "D".
       77 DataSet1-destini-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-destini-LOCK  VALUE "Y".
       77 DataSet1-destini-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-destini-KEY-Asc  VALUE "A".
          88 DataSet1-destini-KEY-Desc VALUE "D".
       77 DataSet1-EDI-mtordini-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-EDI-mtordini-LOCK  VALUE "Y".
       77 DataSet1-KEYIS   PIC 9(3) VALUE 1.
       77 DataSet1-EDI-mtordini-KEY1-ORDER  PIC X VALUE "A".
          88 DataSet1-EDI-mtordini-KEY1-Asc  VALUE "A".
          88 DataSet1-EDI-mtordini-KEY1-Desc VALUE "D".
       77 DataSet1-agenti-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-agenti-LOCK  VALUE "Y".
       77 DataSet1-agenti-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-agenti-KEY-Asc  VALUE "A".
          88 DataSet1-agenti-KEY-Desc VALUE "D".
       77 DataSet1-tivaese-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tivaese-LOCK  VALUE "Y".
       77 DataSet1-tivaese-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tivaese-KEY-Asc  VALUE "A".
          88 DataSet1-tivaese-KEY-Desc VALUE "D".
       77 DataSet1-ttipocli-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-ttipocli-LOCK  VALUE "Y".
       77 DataSet1-ttipocli-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-ttipocli-KEY-Asc  VALUE "A".
          88 DataSet1-ttipocli-KEY-Desc VALUE "D".
       77 DataSet1-tvettori-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tvettori-LOCK  VALUE "Y".
       77 DataSet1-tvettori-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tvettori-KEY-Asc  VALUE "A".
          88 DataSet1-tvettori-KEY-Desc VALUE "D".
       77 DataSet1-pagbloc-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-pagbloc-LOCK  VALUE "Y".
       77 DataSet1-pagbloc-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-pagbloc-KEY-Asc  VALUE "A".
          88 DataSet1-pagbloc-KEY-Desc VALUE "D".
       77 DataSet1-tcaumag-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tcaumag-LOCK  VALUE "Y".
       77 DataSet1-tcaumag-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tcaumag-KEY-Asc  VALUE "A".
          88 DataSet1-tcaumag-KEY-Desc VALUE "D".
       77 DataSet1-tmagaz-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tmagaz-LOCK  VALUE "Y".
       77 DataSet1-tmagaz-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tmagaz-KEY-Asc  VALUE "A".
          88 DataSet1-tmagaz-KEY-Desc VALUE "D".
       77 DataSet1-note-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-note-LOCK  VALUE "Y".
       77 DataSet1-note-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-note-KEY-Asc  VALUE "A".
          88 DataSet1-note-KEY-Desc VALUE "D".
       77 DataSet1-param-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-param-LOCK  VALUE "Y".
       77 DataSet1-param-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-param-KEY-Asc  VALUE "A".
          88 DataSet1-param-KEY-Desc VALUE "D".
       77 DataSet1-recapiti-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-recapiti-LOCK  VALUE "Y".
       77 DataSet1-recapiti-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-recapiti-KEY-Asc  VALUE "A".
          88 DataSet1-recapiti-KEY-Desc VALUE "D".
       77 DataSet1-EDI-mrordini-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-EDI-mrordini-LOCK  VALUE "Y".
       77 DataSet1-EDI-mrordini-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-EDI-mrordini-KEY-Asc  VALUE "A".
          88 DataSet1-EDI-mrordini-KEY-Desc VALUE "D".
       77 DataSet1-articoli-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-articoli-LOCK  VALUE "Y".
       77 DataSet1-articoli-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-articoli-KEY-Asc  VALUE "A".
          88 DataSet1-articoli-KEY-Desc VALUE "D".
       77 DataSet1-progmag-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-progmag-LOCK  VALUE "Y".
       77 DataSet1-progmag-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-progmag-KEY-Asc  VALUE "A".
          88 DataSet1-progmag-KEY-Desc VALUE "D".
       77 DataSet1-sitfin-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-sitfin-LOCK  VALUE "Y".
       77 DataSet1-sitfin-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-sitfin-KEY-Asc  VALUE "A".
          88 DataSet1-sitfin-KEY-Desc VALUE "D".
       77 DataSet1-tparamge-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tparamge-LOCK  VALUE "Y".
       77 DataSet1-tparamge-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tparamge-KEY-Asc  VALUE "A".
          88 DataSet1-tparamge-KEY-Desc VALUE "D".
       77 DataSet1-mrordini-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-mrordini-LOCK  VALUE "Y".
       77 DataSet1-mrordini-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-mrordini-KEY-Asc  VALUE "A".
          88 DataSet1-mrordini-KEY-Desc VALUE "D".
       77 DataSet1-mtordini-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-mtordini-LOCK  VALUE "Y".
       77 DataSet1-mtordini-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-mtordini-KEY-Asc  VALUE "A".
          88 DataSet1-mtordini-KEY-Desc VALUE "D".
       77 DataSet1-timbalqta-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-timbalqta-LOCK  VALUE "Y".
       77 DataSet1-timbalqta-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-timbalqta-KEY-Asc  VALUE "A".
          88 DataSet1-timbalqta-KEY-Desc VALUE "D".
       77 DataSet1-timposte-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-timposte-LOCK  VALUE "Y".
       77 DataSet1-timposte-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-timposte-KEY-Asc  VALUE "A".
          88 DataSet1-timposte-KEY-Desc VALUE "D".
       77 DataSet1-tpiombo-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tpiombo-LOCK  VALUE "Y".
       77 DataSet1-tpiombo-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tpiombo-KEY-Asc  VALUE "A".
          88 DataSet1-tpiombo-KEY-Desc VALUE "D".
       77 DataSet1-tmarche-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tmarche-LOCK  VALUE "Y".
       77 DataSet1-tmarche-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tmarche-KEY-Asc  VALUE "A".
          88 DataSet1-tmarche-KEY-Desc VALUE "D".
       77 DataSet1-rpromo-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-rpromo-LOCK  VALUE "Y".
       77 DataSet1-rpromo-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-rpromo-KEY-Asc  VALUE "A".
          88 DataSet1-rpromo-KEY-Desc VALUE "D".
       77 DataSet1-tpromo-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tpromo-LOCK  VALUE "Y".
       77 DataSet1-tpromo-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tpromo-KEY-Asc  VALUE "A".
          88 DataSet1-tpromo-KEY-Desc VALUE "D".
       77 DataSet1-tmp-promo-prz-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tmp-promo-prz-LOCK  VALUE "Y".
       77 DataSet1-tmp-promo-prz-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tmp-promo-prz-KEY-Asc  VALUE "A".
          88 DataSet1-tmp-promo-prz-KEY-Desc VALUE "D".
       77 DataSet1-listini-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-listini-LOCK  VALUE "Y".
       77 DataSet1-listini-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-listini-KEY-Asc  VALUE "A".
          88 DataSet1-listini-KEY-Desc VALUE "D".
       77 DataSet1-locali-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-locali-LOCK  VALUE "Y".
       77 DataSet1-locali-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-locali-KEY-Asc  VALUE "A".
          88 DataSet1-locali-KEY-Desc VALUE "D".
       77 DataSet1-blister-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-blister-LOCK  VALUE "Y".
       77 DataSet1-blister-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-blister-KEY-Asc  VALUE "A".
          88 DataSet1-blister-KEY-Desc VALUE "D".
       77 DataSet1-cli-prg-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-cli-prg-LOCK  VALUE "Y".
       77 DataSet1-cli-prg-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-cli-prg-KEY-Asc  VALUE "A".
          88 DataSet1-cli-prg-KEY-Desc VALUE "D".
       77 DataSet1-tcodpag-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tcodpag-LOCK  VALUE "Y".
       77 DataSet1-tcodpag-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tcodpag-KEY-Asc  VALUE "A".
          88 DataSet1-tcodpag-KEY-Desc VALUE "D".
       77 DataSet1-tmp-progmag-zoom-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tmp-progmag-zoom-LOCK  VALUE "Y".
       77 DataSet1-tmp-progmag-zoom-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tmp-progmag-zoom-KEY-Asc  VALUE "A".
          88 DataSet1-tmp-progmag-zoom-KEY-Desc VALUE "D".
       77 DataSet1-timballi-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-timballi-LOCK  VALUE "Y".
       77 DataSet1-timballi-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-timballi-KEY-Asc  VALUE "A".
          88 DataSet1-timballi-KEY-Desc VALUE "D".
       77 DataSet1-tcontat-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tcontat-LOCK  VALUE "Y".
       77 DataSet1-tcontat-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tcontat-KEY-Asc  VALUE "A".
          88 DataSet1-tcontat-KEY-Desc VALUE "D".
       77 DataSet1-lockfile-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-lockfile-LOCK  VALUE "Y".
       77 DataSet1-lockfile-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-lockfile-KEY-Asc  VALUE "A".
          88 DataSet1-lockfile-KEY-Desc VALUE "D".
       77 DataSet1-tnazioni-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tnazioni-LOCK  VALUE "Y".
       77 DataSet1-tnazioni-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tnazioni-KEY-Asc  VALUE "A".
          88 DataSet1-tnazioni-KEY-Desc VALUE "D".
       77 DataSet1-tscorte-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tscorte-LOCK  VALUE "Y".
       77 DataSet1-tscorte-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tscorte-KEY-Asc  VALUE "A".
          88 DataSet1-tscorte-KEY-Desc VALUE "D".
       77 DataSet1-tmp-fido-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tmp-fido-LOCK  VALUE "Y".
       77 DataSet1-tmp-fido-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tmp-fido-KEY-Asc  VALUE "A".
          88 DataSet1-tmp-fido-KEY-Desc VALUE "D".
       77 DataSet1-grade-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-grade-LOCK  VALUE "Y".
       77 DataSet1-grade-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-grade-KEY-Asc  VALUE "A".
          88 DataSet1-grade-KEY-Desc VALUE "D".
       77 DataSet1-log-macrobatch-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-log-macrobatch-LOCK  VALUE "Y".
       77 DataSet1-log-macrobatch-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-log-macrobatch-KEY-Asc  VALUE "A".
          88 DataSet1-log-macrobatch-KEY-Desc VALUE "D".
       77 DataSet1-macrobatch-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-macrobatch-LOCK  VALUE "Y".
       77 DataSet1-macrobatch-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-macrobatch-KEY-Asc  VALUE "A".
          88 DataSet1-macrobatch-KEY-Desc VALUE "D".
       77 DataSet1-tprov-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tprov-LOCK  VALUE "Y".
       77 DataSet1-tprov-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tprov-KEY-Asc  VALUE "A".
          88 DataSet1-tprov-KEY-Desc VALUE "D".
       77 DataSet1-EDI-clides-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-EDI-clides-LOCK  VALUE "Y".
       77 DataSet1-EDI-clides-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-EDI-clides-KEY-Asc  VALUE "A".
          88 DataSet1-EDI-clides-KEY-Desc VALUE "D".
       77 DataSet1-anacap-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-anacap-LOCK  VALUE "Y".
       77 DataSet1-anacap-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-anacap-KEY-Asc  VALUE "A".
          88 DataSet1-anacap-KEY-Desc VALUE "D".

       77 clienti-cli-K1-SPLITBUF  PIC X(47).
       77 clienti-cli-K3-SPLITBUF  PIC X(12).
       77 clienti-cli-K4-SPLITBUF  PIC X(8).
       77 destini-K1-SPLITBUF  PIC X(111).
       77 destini-k-localita-SPLITBUF  PIC X(36).
       77 EDI-mtordini-emto-k-ord-cli-SPLITBUF  PIC X(55).
       77 EDI-mtordini-k-emto-stato-SPLITBUF  PIC X(14).
       77 EDI-mtordini-k-emto-data-SPLITBUF  PIC X(21).
       77 EDI-mtordini-k-emto-clides-SPLITBUF  PIC X(23).
       77 tivaese-key01-SPLITBUF  PIC X(53).
       77 tvettori-k-des-SPLITBUF  PIC X(41).
       77 tcaumag-k-mag-SPLITBUF  PIC X(5).
       77 EDI-mrordini-emro-k-articolo-SPLITBUF  PIC X(24).
       77 EDI-mrordini-emro-k-stato-SPLITBUF  PIC X(19).
       77 articoli-art-k1-SPLITBUF  PIC X(51).
       77 articoli-art-k-frn-SPLITBUF  PIC X(16).
       77 progmag-key01-SPLITBUF  PIC X(21).
       77 mrordini-mro-k-promo-SPLITBUF  PIC X(33).
       77 mrordini-mro-k-articolo-SPLITBUF  PIC X(24).
       77 mrordini-mro-k-progr-SPLITBUF  PIC X(18).
       77 mrordini-mro-k-tprev-SPLITBUF  PIC X(39).
       77 mrordini-mro-k-ord-art-SPLITBUF  PIC X(19).
       77 mtordini-mto-k-ord-cli-SPLITBUF  PIC X(55).
       77 mtordini-mto-k-data-SPLITBUF  PIC X(21).
       77 mtordini-mto-k-clides-SPLITBUF  PIC X(19).
       77 mtordini-mto-k-age-SPLITBUF  PIC X(14).
       77 mtordini-k-mto-stato-sel-SPLITBUF  PIC X(15).
       77 mtordini-k-mto-stato-SPLITBUF  PIC X(14).
       77 mtordini-mto-k-gdo-SPLITBUF  PIC X(26).
       77 mtordini-mto-k-bloc-SPLITBUF  PIC X(20).
       77 mtordini-k-giang-SPLITBUF  PIC X(21).
       77 mtordini-mto-k-promo-SPLITBUF  PIC X(25).
       77 rpromo-k-stampa-SPLITBUF  PIC X(32).
       77 tpromo-tpr-chiave-ricerca-SPLITBUF  PIC X(22).
       77 tpromo-tpr-chiave-gdo-fine-SPLITBUF  PIC X(22).
       77 tpromo-tpr-chiave-fine-SPLITBUF  PIC X(22).
       77 tpromo-tpr-chiave-ini-SPLITBUF  PIC X(22).
       77 tpromo-tpr-chiave-volantino-SPLITBUF  PIC X(22).
       77 tpromo-tpr-k-fine-vol-SPLITBUF  PIC X(22).
       77 tpromo-tpr-k-data-ins-SPLITBUF  PIC X(29).
       77 listini-lst-k-articolo-SPLITBUF  PIC X(20).
       77 listini-lst-k-cod-art-cli-SPLITBUF  PIC X(29).
       77 listini-lst-k-data-SPLITBUF  PIC X(29).
       77 locali-loc-chiave-gdo-fine-SPLITBUF  PIC X(32).
       77 locali-loc-chiave-fine-SPLITBUF  PIC X(32).
       77 locali-loc-chiave-ini-SPLITBUF  PIC X(32).
       77 blister-k-magaz-SPLITBUF  PIC X(10).
       77 blister-k-des-SPLITBUF  PIC X(51).
       77 tcodpag-TBL-CODICE-01-SPLITBUF  PIC X(53).
       77 tmp-progmag-zoom-key-des-SPLITBUF  PIC X(64).
       77 tmp-progmag-zoom-key-art-SPLITBUF  PIC X(7).
       77 EDI-clides-ecd-k-orders-SPLITBUF  PIC X(35).
       77 anacap-k-prov-SPLITBUF  PIC X(158).
       77 anacap-k-comune-SPLITBUF  PIC X(158).
      * FOR SPLIT KEY BUFFER
       77 DataSet1-EDI-mtordini-SPLIT-BUF1   PIC X(14).

      * FOR SPLIT KEY BUFFER
       77 DataSet1-tmp-progmag-zoom-SPLIT-BUF1   PIC X(64).


       77  filtro-stato   pic x(10). 

       77  tipo-ricerca   pic 9.
           88 per-numero  value 1.
           88 per-cliente value 2.
           88 per-stato   value 3.
           88 per-data    value 4.

       01 OLD-emto-rec.
           05 OLD-emto-chiave.
               10 OLD-emto-anno        PIC  9(4).
               10 OLD-emto-numero      PIC  9(8).
           05 OLD-emto-dati.
               10 OLD-emto-causale     PIC  x(4).
               10 OLD-emto-cod-cli     PIC  9(5).
               10 OLD-emto-prg-destino PIC  9(5).
               10 OLD-emto-gdo         PIC  x(5).
               10 OLD-emto-num-ord-cli PIC  X(50).
               10 OLD-emto-data-ordine PIC  9(8).
               10 OLD-emto-data-passaggio-ordine   PIC  9(8).
               10 OLD-emto-cod-agente  PIC  9(5).
               10 OLD-emto-cod-pagamento           PIC  x(3).
               10 OLD-emto-cod-ese-iva PIC  x(3).
               10 OLD-emto-vettore     PIC  9(5).
               10 OLD-emto-note1       PIC  X(19).
               10 OLD-emto-data-note1  PIC  9(8).
               10 OLD-emto-note2       PIC  X(30).
               10 OLD-emto-note3       PIC  X(30).
               10 OLD-emto-note4       PIC  X(30).
               10 OLD-emto-note        PIC  X(500).
               10 OLD-emto-pz-tot      PIC  9(8).
               10 OLD-emto-ritira-in-lubex         PIC  9.
                   88 OLD-emto-ritira-si VALUE IS 1. 
                   88 OLD-emto-ritira-no VALUE IS 0. 
               10 OLD-emto-prenotazione-qta        PIC  9(1).
                   88 OLD-emto-prenotazione-qta-si VALUE IS 1. 
                   88 OLD-emto-prenotazione-qta-no VALUE IS 0. 
               10 OLD-emto-saldi-banco PIC  9(1).
                   88 OLD-emto-saldi-banco-si VALUE IS 1. 
                   88 OLD-emto-saldi-banco-no VALUE IS 0. 
               10 OLD-emto-saldi-promo PIC  9(1).
                   88 OLD-emto-saldi-promo-si VALUE IS 1. 
                   88 OLD-emto-saldi-promo-no VALUE IS 0. 
               10 OLD-emto-stato       PIC  X(1).
                   88 OLD-emto-attivo VALUE IS "A". 
                   88 OLD-emto-bloccato VALUE IS "B". 
                   88 OLD-emto-caricato VALUE IS "C". 
               10 OLD-emto-errori.
                   15 OLD-emto-cliente     PIC  9.
                       88 OLD-emto-cliente-valido VALUE IS 0. 
                       88 OLD-emto-clides-non-valido VALUE IS 1. 
                       88 OLD-emto-cliente-non-valido VALUE IS 2. 
                       88 OLD-emto-cliente-non-attivo VALUE IS 3. 
                   15 OLD-emto-cliente-fido            PIC  9.
                       88 OLD-emto-cliente-fido-ok VALUE IS 0. 
                       88 OLD-emto-cliente-fuori-fido VALUE IS 1. 
                   15 OLD-emto-destino     PIC  9.
                       88 OLD-emto-destino-valido VALUE IS 0. 
                       88 OLD-emto-destino-non-valido VALUE IS 1. 
                       88 OLD-emto-destino-non-attivo VALUE IS 2. 
                   15 OLD-emto-righe       PIC  9.
                       88 OLD-emto-righe-presenti VALUE IS 0. 
                       88 OLD-emto-righe-non-presenti VALUE IS 1. 
                   15 OLD-emto-qta         PIC  9.
                       88 OLD-emto-qta-ok VALUE IS 0. 
                       88 OLD-emto-qta-ko VALUE IS 1. 
                   15 OLD-emto-art         PIC  9.
                       88 OLD-emto-art-ok VALUE IS 0. 
                       88 OLD-emto-art-ko VALUE IS 1. 
                   15 OLD-emto-prg         PIC  9.
                       88 OLD-emto-prg-ok VALUE IS 0. 
                       88 OLD-emto-prg-ko VALUE IS 1. 
                   15 OLD-emto-prz         PIC  9.
                       88 OLD-emto-prz-ok VALUE IS 0. 
                       88 OLD-emto-prz-ko VALUE IS 1. 
                   15 OLD-emto-esistente   PIC  9.
                       88 OLD-emto-esistente-no VALUE IS 0. 
                       88 OLD-emto-esistente-si VALUE IS 1. 
               10 OLD-emto-ordine.
                   15 OLD-emto-ordine-anno PIC  9(4).
                   15 OLD-emto-ordine-numero           PIC  9(8).
               10 OLD-emto-dati-comuni.
                   15 OLD-emto-data-creazione          PIC  9(8).
                   15 OLD-emto-ora-creazione           PIC  9(8).
                   15 OLD-emto-utente-creazione        PIC  X(10).
                   15 OLD-emto-data-ultima-modifica    PIC  9(8).
                   15 OLD-emto-ora-ultima-modifica     PIC  9(8).
                   15 OLD-emto-utente-ultima-modifica  PIC  X(10).
           05 OLD-emto-dati-import.
               15 OLD-emto-nome-file   PIC  x(100).
               15 OLD-emto-riga-file   PIC  9(6).
               15 OLD-emto-record-01T.
                   20 OLD-emto-01T-filler  PIC  x(35).
                   20 OLD-emto-02T-filler  PIC  x(35).
                   20 OLD-emto-03T-filler  PIC  x(35).
                   20 OLD-emto-01T04-BGM-DATADOC       PIC  x(8).
                   20 OLD-emto-01T05-BGM-NUMDOC        PIC  x(35).
                   20 OLD-emto-06T-filler  PIC  x(35).
                   20 OLD-emto-07T-filler  PIC  x(35).
                   20 OLD-emto-08T-filler  PIC  x(35).
                   20 OLD-emto-09T-filler  PIC  x(35).
                   20 OLD-emto-10T-filler  PIC  x(35).
                   20 OLD-emto-01T11-DTM-DATACONS      PIC  x(8).
                   20 OLD-emto-12T-filler  PIC  x(35).
                   20 OLD-emto-13T-filler  PIC  x(35).
                   20 OLD-emto-14T-filler  PIC  x(35).
                   20 OLD-emto-15T-filler  PIC  x(35).
                   20 OLD-emto-16T-filler  PIC  x(35).
                   20 OLD-emto-17T-filler  PIC  x(35).
                   20 OLD-emto-18T-filler  PIC  x(35).
                   20 OLD-emto-19T-filler  PIC  x(35).
                   20 OLD-emto-20T-filler  PIC  x(35).
                   20 OLD-emto-01T21-NAB-CODBUYER      PIC  x(17).
                   20 OLD-emto-01T22-NAB-QCODBUYER     PIC  x(35).
                   20 OLD-emto-01T23-NAB-RAGSOCB       PIC  x(70).
                   20 OLD-emto-01T24-NAB-INDIRB        PIC  x(35).
                   20 OLD-emto-01T25-NAB-CITTAB        PIC  x(35).
                   20 OLD-emto-01T26-NAB-PROVB         PIC  x(3).
                   20 OLD-emto-01T27-NAB-CAPB          PIC  x(5).
      *"LBX" = prezzo e cliente LBX
      *"CLBX" = solo cliente LBX
      *"PLBX" = solo prezzo LBX
                   20 OLD-emto-01T28-NAD-CODCONS       PIC  x(17).
                   20 OLD-emto-29T-filler  PIC  x(35).
      *(( XFD NAME = OLD-emto-01T23-NAB-RAG ))
                   20 OLD-emto-01T30-NAD-RAGSOCD       PIC  x(70).
      *(( XFD NAME = OLD-emto-01T24-NAB-IND ))
                   20 OLD-emto-01T31-NAD-INDIRD        PIC  x(35).
      *(( XFD NAME = OLD-emto-01T25-NAB-CIT ))
                   20 OLD-emto-01T32-NAD-CITTAD        PIC  x(35).
      *(( XFD NAME = OLD-emto-01T26-NAB-PRO ))
                   20 OLD-emto-01T33-NAD-PROVD         PIC  x(3).
      *(( XFD NAME = OLD-emto-01T27-NAB-CAP ))
                   20 OLD-emto-01T34-NAD-CAPD          PIC  x(5).
                   20 OLD-emto-01T35-FTX-NOTE          PIC  x(350).
                   20 OLD-emto-36T-filler  PIC  x(35).
                   20 OLD-emto-01T37-BGM-CODAZION      PIC  x(35).
                   20 OLD-emto-38T-filler  PIC  x(35).
                   20 OLD-emto-39T-filler  PIC  x(35).
                   20 OLD-emto-40T-filler  PIC  x(35).
                   20 OLD-emto-01T41-NAI-CODFATT       PIC  x(35).
                   20 OLD-emto-42T-filler  PIC  x(35).
                   20 OLD-emto-43T-filler  PIC  x(35).
                   20 OLD-emto-44T-filler  PIC  x(35).
                   20 OLD-emto-45T-filler  PIC  x(35).
                   20 OLD-emto-46T-filler  PIC  x(35).
                   20 OLD-emto-47T-filler  PIC  x(35).
                   20 OLD-emto-48T-filler  PIC  x(35).
                   20 OLD-emto-49T-filler  PIC  x(35).
                   20 OLD-emto-50T-filler  PIC  x(35).
                   20 OLD-emto-51T-filler  PIC  x(35).
                   20 OLD-emto-52T-filler  PIC  x(35).
                   20 OLD-emto-53T-filler  PIC  x(35).
                   20 OLD-emto-54T-filler  PIC  x(35).
                   20 OLD-emto-55T-filler  PIC  x(35).
                   20 OLD-emto-56T-filler  PIC  x(35).
                   20 OLD-emto-57T-filler  PIC  x(35).
                   20 OLD-emto-58T-filler  PIC  x(35).
                   20 OLD-emto-59T-filler  PIC  x(35).
      * Valore del campo originale dal file di import
                   20 OLD-emto-01T60-inversione-imposte            PIC  
           x.
                   20 OLD-emto-60T-filler  PIC  x(34).
                   20 OLD-emto-61T-filler  PIC  x(35).
                   20 OLD-emto-62T-filler  PIC  x(35).
                   20 OLD-emto-63T-filler  PIC  x(35).
                   20 OLD-emto-64T-filler  PIC  x(35).
                   20 OLD-emto-65T-filler  PIC  x(35).
                   20 OLD-emto-66T-filler  PIC  x(35).
                   20 OLD-emto-67T-filler  PIC  x(35).
                   20 OLD-emto-01T68-FTX-NOTE          PIC  x(350).
                   20 OLD-emto-01T69-FTX-NOTE          PIC  x(350).
                   20 OLD-emto-01T70-FTX-NOTE          PIC  x(350).
                   20 OLD-emto-71T-filler  PIC  x(35).
                   20 OLD-emto-72T-filler  PIC  x(35).
                   20 OLD-emto-73T-filler  PIC  x(35).
                   20 OLD-emto-74T-filler  PIC  x(35).
                   20 OLD-emto-75T-filler  PIC  x(35).
                   20 OLD-emto-76T-filler  PIC  x(35).
                   20 OLD-emto-77T-filler  PIC  x(35).
                   20 OLD-emto-78T-filler  PIC  x(35).
                   20 OLD-emto-79T-filler  PIC  x(35).
                   20 OLD-emto-80T-filler  PIC  x(35).
                   20 OLD-emto-81T-filler  PIC  x(35).
                   20 OLD-emto-82T-filler  PIC  x(35).
                   20 OLD-emto-83T-filler  PIC  x(35).
                   20 OLD-emto-84T-filler  PIC  x(35).
                   20 OLD-emto-85T-filler  PIC  x(35).
                   20 OLD-emto-86T-filler  PIC  x(35).
                   20 OLD-emto-87T-filler  PIC  x(35).
                   20 OLD-emto-88T-filler  PIC  x(35).
                   20 OLD-emto-89T-filler  PIC  x(35).
                   20 OLD-emto-90T-filler  PIC  x(35).
                   20 OLD-emto-91T-filler  PIC  x(35).
                   20 OLD-emto-92T-filler  PIC  x(35).
                   20 OLD-emto-93T-filler  PIC  x(35).
                   20 OLD-emto-94T-filler  PIC  x(35).
                   20 OLD-emto-95T-filler  PIC  x(35).
                   20 OLD-emto-96T-filler  PIC  x(35).
                   20 OLD-emto-97T-filler  PIC  x(35).
                   20 OLD-emto-98T-filler  PIC  x(35).
                   20 OLD-emto-99T-filler  PIC  x(35).
                   20 OLD-emto-100T-filler PIC  x(35).
                   20 OLD-emto-101T-filler PIC  x(35).
                   20 OLD-emto-102T-filler PIC  x(35).
                   20 OLD-emto-103T-filler PIC  x(35).
                   20 OLD-emto-104T-filler PIC  x(35).
                   20 OLD-emto-105T-filler PIC  x(35).
                   20 OLD-emto-106T-filler PIC  x(35).
                   20 OLD-emto-107T-filler PIC  x(35).
                   20 OLD-emto-108T-filler PIC  x(35).
                   20 OLD-emto-109T-filler PIC  x(35).
                   20 OLD-emto-110T-filler PIC  x(35).
                   20 OLD-emto-111T-filler PIC  x(35).
                   20 OLD-emto-112T-filler PIC  x(35).
                   20 OLD-emto-113T-filler PIC  x(35).
                   20 OLD-emto-114T-filler PIC  x(35).
                   20 OLD-emto-115T-filler PIC  x(35).
                   20 OLD-emto-116T-filler PIC  x(35).
                   20 OLD-emto-117T-filler PIC  x(35).
                   20 OLD-emto-118T-filler PIC  x(35).
                   20 OLD-emto-119T-filler PIC  x(35).
                   20 OLD-emto-120T-filler PIC  x(35).
                   20 OLD-emto-121T-filler PIC  x(35).
                   20 OLD-emto-122T-filler PIC  x(35).
                   20 OLD-emto-123T-filler PIC  x(35).
                   20 OLD-emto-124T-filler PIC  x(35).
                   20 OLD-emto-125T-filler PIC  x(35).
                   20 OLD-emto-126T-filler PIC  x(35).
                   20 OLD-emto-127T-filler PIC  x(35).
                   20 OLD-emto-128T-filler PIC  x(35).
                   20 OLD-emto-129T-filler PIC  x(35).
                   20 OLD-emto-130T-filler PIC  x(35).
                   20 OLD-emto-131T-filler PIC  x(35).
                   20 OLD-emto-132T-filler PIC  x(35).
                   20 OLD-emto-133T-filler PIC  x(35).
                   20 OLD-emto-134T-filler PIC  x(35).
                   20 OLD-emto-135T-filler PIC  x(35).
                   20 OLD-emto-136T-filler PIC  x(35).
                   20 OLD-emto-137T-filler PIC  x(35).
                   20 OLD-emto-138T-filler PIC  x(35).
                   20 OLD-emto-139T-filler PIC  x(35).
                   20 OLD-emto-140T-filler PIC  x(35).
                   20 OLD-emto-141T-filler PIC  x(35).
                   20 OLD-emto-142T-filler PIC  x(35).
                   20 OLD-emto-143T-filler PIC  x(35).
                   20 OLD-emto-144T-filler PIC  x(35).
                   20 OLD-emto-145T-filler PIC  x(35).
                   20 OLD-emto-146T-filler PIC  x(35).
                   20 OLD-emto-147T-filler PIC  x(35).
                   20 OLD-emto-148T-filler PIC  x(35).
                   20 OLD-emto-149T-filler PIC  x(35).
                   20 OLD-emto-150T-filler PIC  x(35).
                   20 OLD-emto-151T-filler PIC  x(35).
                   20 OLD-emto-152T-filler PIC  x(35).
                   20 OLD-emto-153T-filler PIC  x(35).
                   20 OLD-emto-154T-filler PIC  x(35).
                   20 OLD-emto-155T-filler PIC  x(35).
                   20 OLD-emto-156T-filler PIC  x(35).
                   20 OLD-emto-157T-filler PIC  x(35).
                   20 OLD-emto-158T-filler PIC  x(35).
                   20 OLD-emto-159T-filler PIC  x(35).
                   20 OLD-emto-160T-filler PIC  x(35).
                   20 OLD-emto-161T-filler PIC  x(35).
                   20 OLD-emto-162T-filler PIC  x(35).
                   20 OLD-emto-01T163-TOD-CODCOST      PIC  x(3).
                   20 filler           PIC  x(501).
               15 OLD-emto-bloc-forzato            PIC  9.
                   88 OLD-emto-bloc-forzato-si VALUE IS 1. 
                   88 OLD-emto-bloc-forzato-no VALUE IS 0. 
               15 OLD-emto-Sum         PIC  9(12)v999.
               15 OLD-emto-evadi-dal   PIC  9(8).
      *L'inversione viene impostata solo per clienti tradizionali, quindi conservo il valore nel campo 60 ma poi uso questo
               15 OLD-emto-inversione-imposte      PIC  9.
                   88 OLD-emto-inversione-imposte-si VALUE IS 1. 
                   88 OLD-emto-inversione-imposte-no VALUE IS 0. 
               15 OLD-emto-ev-immediata      PIC  9.
                   88 OLD-emto-ev-immediata-si VALUE IS 1. 
                   88 OLD-emto-ev-immediata-no VALUE IS 0.  
               15 OLD-emto-contrassegno      PIC  x.
                   88 OLD-emto-contrassegno-si VALUE IS "S". 
                   88 OLD-emto-contrassegno-no VALUE IS "N", " ". 
               15 FILLER           PIC  x(173).
      *{TOTEM}END

      *{TOTEM}ID-LOGICI
      ***** Elenco ID Logici *****
       78  78-ID-gd-ordini VALUE 5001.
       78  78-ID-EF-ANNO VALUE 5001.
       78  78-ID-EF-ordine-FROM VALUE 5002.
       78  78-ID-EF-ordine-TO VALUE 5003.
       78  78-ID-EF-data-FROM VALUE 5004.
       78  78-ID-EF-DATA-TO VALUE 5005.
       78  78-ID-EF-CLIENTE-FROM VALUE 5006.
       78  78-ID-CBO-STATO-ORDINE VALUE 5007.
       78  78-ID-ef-cli VALUE 5001.
       78  78-ID-ef-des VALUE 5002.
       78  78-ID-ef-prov-d VALUE 5003.
       78  78-ID-ef-cap-d VALUE 5004.
       78  78-ID-ef-num-ord VALUE 5005.
       78  78-ID-ef-data VALUE 5006.
       78  78-ID-ef-data-pass VALUE 5007.
       78  78-ID-ef-evadi-dal VALUE 5008.
       78  78-ID-ef-age VALUE 5009.
       78  78-ID-ef-pag VALUE 5010.
       78  78-ID-ef-iva VALUE 5011.
       78  78-ID-ef-vet VALUE 5012.
       78  78-ID-ef-note-1 VALUE 5013.
       78  78-ID-ef-data-cons VALUE 5014.
       78  78-ID-ef-note-2 VALUE 5015.
       78  78-ID-ef-note-3 VALUE 5016.
       78  78-ID-ef-note-4 VALUE 5017.
       78  78-ID-ef-note VALUE 5018.
       78  78-ID-chk-ritira VALUE 5019.
       78  78-ID-chk-prenot VALUE 5020.
       78  78-ID-chk-saldi-banco VALUE 5021.
       78  78-ID-chk-saldi-promo VALUE 5022.
       78  78-ID-chk-ev-immediata VALUE 5023.
       78  78-ID-chk-contrassegno VALUE 5024.
       78  78-ID-Form1-Gd-1 VALUE 5025.
      ***** Fine ID Logici *****
      *{TOTEM}END

       LINKAGE          SECTION.
      *{TOTEM}LINKAGE
           COPY  "COMMON-LINKAGE.DEF".
       77 lk-mb-id         PIC  9(18).

      *{TOTEM}END

       SCREEN           SECTION.
      *{TOTEM}COPY-SCREEN
      * FORM
       01 
           Form2, 
           .

      * FRAME
       05
           Screen1-Fr-1, 
           Frame, 
           COL 1,17, 
           LINE 46,54,
           LINES 3,00 ,
           SIZE 33,00 ,
           LOWERED,
           FULL-HEIGHT,
           ID IS 2,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           .

      * LABEL
       05
           Screen1-La-1aaa, 
           Label, 
           COL 1,71, 
           LINE 46,54,
           LINES 2,54 ,
           SIZE 32,30 ,
           COLOR IS col-stato-ordine,
           FONT IS font-evidenzia-griglia,
           ID IS 4,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           .

      * LABEL
       05
           Screen1-La-1aa, 
           Label, 
           COL 2,67, 
           LINE 47,23,
           LINES 1,54 ,
           SIZE 30,00 ,
           COLOR IS col-stato-ordine,
           FONT IS Verdana12B-Occidentale,
           ID IS 5,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TITLE tit-stato-ordine,
           .

      * GRID
       05
           gd-ordini, 
           Grid, 
           COL 2,50, 
           LINE 1,77,
           LINES 37,00 ,
           SIZE 195,17 ,
           BOXED,
           DATA-COLUMNS (1, 2, 6, 14, 64, 74, 124, 129, 169, 209, 249),
           ALIGNMENT ("C", "C", "R", "U", "C", "L", "R", "U", "U", "U", 
           "U"),
           SEPARATION (5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5),
           DATA-TYPES ("X", "9(4)", "9(8)", "X(50)", "99/99/9999", "x(50
      -    ")", "9(4)", "x(40)", "x(40)", "x(40)", "x(35)"),
           NUM-COL-HEADINGS 1,
           COLUMN-HEADINGS,
           CURSOR-FRAME-WIDTH 0,
           DIVIDER-COLOR 1,
           HEADING-COLOR 257,
           HEADING-DIVIDER-COLOR 1,
           HEADING-FONT IS Verdana10B-Occidentale,
           HSCROLL,
           ID IS 78-ID-gd-ordini,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           ROW-HEADINGS,
           TILED-HEADINGS,
           VIRTUAL-WIDTH 192,
           VPADDING 50,
           VSCROLL,
           EVENT PROCEDURE Screen1-Gd-1-Event-Proc,
           .

      * FRAME
       05
           Screen1-Fr-1a, 
           Frame, 
           COL 34,50, 
           LINE 46,54,
           LINES 3,00 ,
           SIZE 136,83 ,
           LOWERED,
           FULL-HEIGHT,
           ID IS 202,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           .

      * LABEL
       05
           Screen1-La-1, 
           Label, 
           COL 36,50, 
           LINE 47,16,
           LINES 1,54 ,
           SIZE 65,00 ,
           FONT IS Verdana12-Occidentale,
           ID IS 203,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Doppio Click o Invio per modificare l'ordine",
           .

      * PUSH BUTTON
       05
           pb-genera, 
           Push-Button, 
           COL 157,83, 
           LINE 46,69,
           LINES 30,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE GENERA-BMP,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 1001,
           FLAT,
           ID IS 250,
           AFTER PROCEDURE pb-genera-AfterProcedure, 
           BEFORE PROCEDURE pb-genera-BeforeProcedure, 
           .

      * PUSH BUTTON
       05
           pb-aggiorna, 
           Push-Button, 
           COL 144,67, 
           LINE 46,69,
           LINES 30,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE BOTTONE-AGGIORNA-BMP,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 1002,
           FLAT,
           ID IS 251,
           TITLE "&Aggiorna",
           AFTER PROCEDURE pb-aggiorna-AfterProcedure, 
           BEFORE PROCEDURE pb-aggiorna-BeforeProcedure, 
           .

      * FRAME
       05
           Screen1-Fr-1aa, 
           Frame, 
           COL 171,33, 
           LINE 46,54,
           LINES 3,00 ,
           SIZE 27,83 ,
           LOWERED,
           FULL-HEIGHT,
           ID IS 6,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           .

      * PUSH BUTTON
       05
           pb-annulla2, 
           Push-Button, 
           COL 185,16, 
           LINE 46,69,
           LINES 30,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE BOTTONE-CANCEL-BMP,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 27,
           FLAT,
           ID IS 201,
           SELF-ACT,
           ESCAPE-BUTTON,
           AFTER PROCEDURE pb-annulla2-AfterProcedure, 
           BEFORE PROCEDURE pb-annulla2-BeforeProcedure, 
           .

      * PUSH BUTTON
       05
           pb-ok2, 
           Push-Button, 
           COL 172,00, 
           LINE 46,69,
           LINES 30,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE BOTTONE-OK-BMP,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 1000,
           FLAT,
           ID IS 200,
           AFTER PROCEDURE pb-ok2-AfterProcedure, 
           BEFORE PROCEDURE pb-ok2-BeforeProcedure, 
           .

      * LABEL
       05
           Screen1-La-1a, 
           Label, 
           COL 2,83, 
           LINE 44,46,
           LINES 1,31 ,
           SIZE 14,00 ,
           COLOR IS 176,
           FONT IS Verdana10B-Occidentale,
           ID IS 204,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "BLOCCATI:",
           .

      * LABEL
       05
           Screen1-La-1ab, 
           Label, 
           COL 28,33, 
           LINE 44,46,
           LINES 1,31 ,
           SIZE 14,00 ,
           COLOR IS 112,
           FONT IS Verdana10B-Occidentale,
           ID IS 205,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "ATTIVI:",
           .

      * LABEL
       05
           lab-bloccati, 
           Label, 
           COL 17,83, 
           LINE 44,46,
           LINES 1,31 ,
           SIZE 8,00 ,
           COLOR IS 176,
           FONT IS Verdana10B-Occidentale,
           ID IS 206,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TITLE lab-bloccati-buf,
           .

      * LABEL
       05
           lab-attivi, 
           Label, 
           COL 43,33, 
           LINE 44,46,
           LINES 1,31 ,
           SIZE 8,00 ,
           COLOR IS 112,
           FONT IS Verdana10B-Occidentale,
           ID IS 207,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TITLE lab-attivi-buf,
           .

      * FRAME
       05
           Screen1-Fr-2, 
           Frame, 
           COL 2,50, 
           LINE 39,08,
           LINES 4,23 ,
           SIZE 195,17 ,
           FONT IS Verdana10B-Occidentale,
           ID IS 3,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Errori",
           TITLE-POSITION 2,
           .

      * LABEL
       05
           Screen1-La-2, 
           Label, 
           COL 30,00, 
           LINE 40,93,
           LINES 1,31 ,
           SIZE 12,00 ,
           FONT IS Verdana10B-Occidentale,
           ID IS 7,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "CLIENTE:",
           .

      * LABEL
       05
           Screen1-La-2a, 
           Label, 
           COL 50,00, 
           LINE 40,93,
           LINES 1,31 ,
           SIZE 12,00 ,
           FONT IS Verdana10B-Occidentale,
           ID IS 8,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "DESTINO:",
           .

      * LABEL
       05
           Screen1-La-2aa, 
           Label, 
           COL 69,67, 
           LINE 40,93,
           LINES 1,31 ,
           SIZE 9,00 ,
           FONT IS Verdana10B-Occidentale,
           ID IS 9,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "RIGHE:",
           .

      * LABEL
       05
           Screen1-La-2aaa, 
           Label, 
           COL 88,00, 
           LINE 40,93,
           LINES 1,31 ,
           SIZE 7,00 ,
           FONT IS Verdana10B-Occidentale,
           ID IS 10,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Q.TA:",
           .

      * LABEL
       05
           Screen1-La-2aaaa, 
           Label, 
           COL 103,83, 
           LINE 40,93,
           LINES 1,31 ,
           SIZE 14,00 ,
           FONT IS Verdana10B-Occidentale,
           ID IS 11,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "ARTICOLO:",
           .

      * LABEL
       05
           Screen1-La-2aaab, 
           Label, 
           COL 125,00, 
           LINE 40,93,
           LINES 1,31 ,
           SIZE 19,00 ,
           FONT IS Verdana10B-Occidentale,
           ID IS 12,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "PROGRESSIVO:",
           .

      * LABEL
       05
           Screen1-La-2aaac, 
           Label, 
           COL 151,50, 
           LINE 40,93,
           LINES 1,31 ,
           SIZE 11,00 ,
           FONT IS Verdana10B-Occidentale,
           ID IS 13,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "PREZZO:",
           .

      * LABEL
       05
           lab-err-cli, 
           Label, 
           COL 42,83, 
           LINE 40,93,
           LINES 1,31 ,
           SIZE 6,00 ,
           COLOR IS col-lab-err-cli,
           FONT IS Verdana10B-Occidentale,
           ID IS 14,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TITLE lab-err-cli-buf,
           .

      * LABEL
       05
           lab-err-des, 
           Label, 
           COL 62,67, 
           LINE 40,93,
           LINES 1,31 ,
           SIZE 6,00 ,
           COLOR IS col-lab-err-des,
           FONT IS Verdana10B-Occidentale,
           ID IS 15,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TITLE lab-err-des-buf,
           .

      * LABEL
       05
           lab-err-righe, 
           Label, 
           COL 80,17, 
           LINE 40,93,
           LINES 1,31 ,
           SIZE 6,00 ,
           COLOR IS col-lab-err-righe,
           FONT IS Verdana10B-Occidentale,
           ID IS 16,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TITLE lab-err-righe-buf,
           .

      * LABEL
       05
           lab-err-qta, 
           Label, 
           COL 96,83, 
           LINE 40,93,
           LINES 1,31 ,
           SIZE 6,00 ,
           COLOR IS col-lab-err-qta,
           FONT IS Verdana10B-Occidentale,
           ID IS 17,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TITLE lab-err-qta-buf,
           .

      * LABEL
       05
           lab-err-art, 
           Label, 
           COL 118,50, 
           LINE 40,93,
           LINES 1,31 ,
           SIZE 6,00 ,
           COLOR IS col-lab-err-art,
           FONT IS Verdana10B-Occidentale,
           ID IS 18,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TITLE lab-err-art-buf,
           .

      * LABEL
       05
           lab-err-prg, 
           Label, 
           COL 144,50, 
           LINE 40,93,
           LINES 1,31 ,
           SIZE 6,00 ,
           COLOR IS col-lab-err-prg,
           FONT IS Verdana10B-Occidentale,
           ID IS 19,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TITLE lab-err-prg-buf,
           .

      * LABEL
       05
           lab-err-prz, 
           Label, 
           COL 163,67, 
           LINE 40,93,
           LINES 1,31 ,
           SIZE 6,00 ,
           COLOR IS col-lab-err-prz,
           FONT IS Verdana10B-Occidentale,
           ID IS 20,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TITLE lab-err-prz-buf,
           .

      * LABEL
       05
           Screen1-La-2b, 
           Label, 
           COL 10,33, 
           LINE 40,93,
           LINES 1,31 ,
           SIZE 11,00 ,
           FONT IS Verdana10B-Occidentale,
           ID IS 21,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "DOPPIO:",
           .

      * LABEL
       05
           lab-err-doppio, 
           Label, 
           COL 22,00, 
           LINE 40,93,
           LINES 1,31 ,
           SIZE 6,00 ,
           COLOR IS col-lab-err-doppio,
           FONT IS Verdana10B-Occidentale,
           ID IS 22,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TITLE lab-err-doppio-buf,
           .

      * LABEL
       05
           lab-err-bloc, 
           Label, 
           COL 183,67, 
           LINE 40,93,
           LINES 1,31 ,
           SIZE 6,00 ,
           COLOR IS col-lab-err-bloc,
           FONT IS Verdana10B-Occidentale,
           ID IS 23,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TITLE lab-err-bloc-buf,
           .

      * LABEL
       05
           Screen1-La-2aaaca, 
           Label, 
           COL 171,50, 
           LINE 40,93,
           LINES 1,31 ,
           SIZE 11,00 ,
           FONT IS Verdana10B-Occidentale,
           ID IS 24,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "BLOCCO:",
           .

      * LABEL
       05
           lab-attendere, 
           Label, 
           COL 79,83, 
           LINE 43,62,
           LINES 2,85 ,
           SIZE 40,33 ,
           COLOR IS 5,
           FONT IS Verdana12B-Occidentale,
           ID IS 25,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "ATTENDERE TERMINE STAMPA RIEPILOGO MASTER GENERATI",
           VISIBLE 0,
           .

      * FORM
       01 
           Form-ini, 
           .

      * RADIO BUTTON
       05
           RB-SINGOLO, 
           Radio-Button, 
           COL 6,00, 
           LINE 3,50,
           LINES 1,31 ,
           SIZE 2,00 ,
           EXCEPTION-VALUE 1001
           FLAT,
           GROUP 1,
           GROUP-VALUE 1,
           ID IS 101,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           VALUE TIPO-ELAB,
           AFTER PROCEDURE Screen4-Rb-1-AfterProcedure, 
           BEFORE PROCEDURE Screen4-Rb-1-BeforeProcedure, 
           .
      * RADIO BUTTON
       05
           RB-ELENCO, 
           Radio-Button, 
           COL 26,00, 
           LINE 3,50,
           LINES 1,31 ,
           SIZE 2,00 ,
           EXCEPTION-VALUE 1002
           FLAT,
           GROUP 1,
           GROUP-VALUE 2,
           ID IS 102,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           VALUE TIPO-ELAB,
           AFTER PROCEDURE Screen4-Rb-1-AfterProcedure, 
           BEFORE PROCEDURE Screen4-Rb-1-BeforeProcedure, 
           .
      * ENTRY FIELD
       05
           EF-ANNO, 
           Entry-Field, 
           COL 9,00, 
           LINE 8,00,
           LINES 1,39 ,
           SIZE 5,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED 1,
           ID IS 78-ID-EF-ANNO,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 4,
           NUMERIC,
           VALUE ANNO-TO,
           AFTER PROCEDURE EF-ANNO-TO-AfterProcedure, 
           BEFORE PROCEDURE EF-ANNO-TO-BeforeProcedure, 
           .

      * ENTRY FIELD
       05
           EF-ordine-FROM, 
           Entry-Field, 
           COL 5,00, 
           LINE 10,00,
           LINES 1,39 ,
           SIZE 9,00 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-EF-ordine-FROM,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 8,
           NUMERIC,
           VALUE ordine-FROM,
           PIC Z(7)9
           AFTER PROCEDURE EF-ordine-FROM-AfterProcedure, 
           BEFORE PROCEDURE EF-ordine-FROM-BeforeProcedure, 
           .

      * ENTRY FIELD
       05
           EF-ordine-TO, 
           Entry-Field, 
           COL 30,50, 
           LINE 10,00,
           LINES 1,38 ,
           SIZE 9,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED MOD-LIMITI,
           ID IS 78-ID-EF-ordine-TO,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 8,
           NUMERIC,
           VALUE ordine-TO,
           PIC Z(7)9
           AFTER PROCEDURE EF-ordine-TO-AfterProcedure, 
           BEFORE PROCEDURE EF-ordine-TO-BeforeProcedure, 
           .

      * ENTRY FIELD
       05
           EF-data-FROM, 
           Entry-Field, 
           COL 3,00, 
           LINE 12,00,
           LINES 1,38 ,
           SIZE 11,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED MOD-LIMITI,
           ID IS 78-ID-EF-data-FROM,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           MAX-TEXT 10,
           NUMERIC,
           VALUE data-FROM,
           PIC 99/99/9999
           AFTER PROCEDURE EF-data-FROM-AfterProcedure, 
           BEFORE PROCEDURE EF-data-FROM-BeforeProcedure, 
           .

      * ENTRY FIELD
       05
           EF-DATA-TO, 
           Entry-Field, 
           COL 30,50, 
           LINE 12,00,
           LINES 1,38 ,
           SIZE 11,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED MOD-LIMITI,
           ID IS 78-ID-EF-DATA-TO,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           MAX-TEXT 10,
           NUMERIC,
           VALUE data-TO,
           PIC 99/99/9999
           AFTER PROCEDURE EF-DATA-TO-AfterProcedure, 
           BEFORE PROCEDURE EF-DATA-TO-BeforeProcedure, 
           .

      * ENTRY FIELD
       05
           EF-CLIENTE-FROM, 
           Entry-Field, 
           COL 8,00, 
           LINE 14,39,
           LINES 1,39 ,
           SIZE 6,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED MOD-LIMITI,
           ID IS 78-ID-EF-CLIENTE-FROM,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 5,
           NUMERIC,
           VALUE CLIENTE-FROM,
           PIC Z(4)9
           AFTER PROCEDURE EF-CLIENTE-FROM-AfterProcedure, 
           BEFORE PROCEDURE EF-CLIENTE-FROM-BeforeProcedure, 
           .

      * COMBO-BOX
       05
           CBO-STATO-ORDINE, 
           Combo-Box, 
           COL 11,00, 
           LINE 17,00,
           LINES 6,00 ,
           SIZE 22,00 ,
           3-D,
           COLOR IS 513,
           ENABLED MOD-LIMITI,
           ID IS 78-ID-CBO-STATO-ORDINE,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MASS-UPDATE 0,
           DROP-LIST,
           UNSORTED,
           VALUE CBO-stato-ordine-BUF,
           AFTER PROCEDURE Form1-Cm-1-AfterProcedure, 
           BEFORE PROCEDURE Form1-Cm-1-BeforeProcedure, 
           .
      * LABEL
       05
           Screen3-La-1a, 
           Label, 
           COL 18,50, 
           LINE 8,00,
           LINES 1,17 ,
           SIZE 7,00 ,
           ID IS 100,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Anno",
           .

      * LABEL
       05
           Screen3-La-1aa, 
           Label, 
           COL 2,00, 
           LINE 1,50,
           LINES 1,15 ,
           SIZE 17,00 ,
           COLOR IS 80,
           ID IS 12,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TITLE "Tipo ricerca",
           .

      * BAR
       05
           Screen1-Br-1a, 
           Bar,
           COL 19,00, 
           LINE 2,00,
           SIZE 25,50 ,
           ID IS 15,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           COLORS (1),
           WIDTH 1,
           .

      * LABEL
       05
           Screen3-La-1ab, 
           Label, 
           COL 9,00, 
           LINE 3,50,
           LINES 1,15 ,
           SIZE 12,00 ,
           ID IS 104,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           LEFT,
           TRANSPARENT,
           TITLE "Singolo ordine",
           .

      * LABEL
       05
           Screen3-La-1aba, 
           Label, 
           COL 29,00, 
           LINE 3,00,
           LINES 2,33 ,
           SIZE 13,40 ,
           ID IS 105,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           LEFT,
           TRANSPARENT,
           TITLE "Da elenco (GENERAZIONE)",
           .

      * LABEL
       05
           Form1-La-1abc, 
           Label, 
           COL 2,50, 
           LINE 17,00,
           LINES 1,33 ,
           SIZE 5,00 ,
           ID IS 218,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Stato",
           .

      * LABEL
       05
           Screen3-La-1aaa, 
           Label, 
           COL 2,00, 
           LINE 6,00,
           LINES 1,15 ,
           SIZE 17,00 ,
           COLOR IS 80,
           ID IS 219,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TITLE "Limiti di Selezione",
           .

      * BAR
       05
           Screen1-Br-1aa, 
           Bar,
           COL 19,00, 
           LINE 6,60,
           SIZE 25,50 ,
           ID IS 220,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           COLORS (1),
           WIDTH 1,
           .

      * LABEL
       05
           Screen4-blockpgm-1, 
           Label, 
           COL 38,10, 
           LINE 5,33,
           LINES 0,61 ,
           SIZE 2,10 ,
           ID IS 1,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "BlockPgm",
           VISIBLE v-custom,
           .

      * BITMAP
       05
           Bitmap-freccia-daa, 
           Bitmap, 
           COL 15,00, 
           LINE 10,00,
           LINES 24,00 ,
           SIZE 28,00 ,
           TRANSPARENT-COLOR TR-COLOR,
           BITMAP-HANDLE BLUE-DA-28X24-BMP,
           BITMAP-NUMBER 1,
           ID IS 4,
           .

      * LABEL
       05
           Screen3-La-1ac, 
           Label, 
           COL 18,50, 
           LINE 10,00,
           LINES 1,17 ,
           SIZE 7,00 ,
           ID IS 5,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Numero",
           .

      * BITMAP
       05
           Bitmap-freccia-finoa, 
           Bitmap, 
           COL 26,50, 
           LINE 10,00,
           LINES 24,00 ,
           SIZE 28,00 ,
           TRANSPARENT-COLOR TR-COLOR,
           BITMAP-HANDLE BLUE-FINO-28X24-BMP,
           BITMAP-NUMBER 1,
           ID IS 6,
           .

      * BITMAP
       05
           Bitmap-freccia-daaa, 
           Bitmap, 
           COL 15,00, 
           LINE 12,00,
           LINES 24,00 ,
           SIZE 28,00 ,
           TRANSPARENT-COLOR TR-COLOR,
           BITMAP-HANDLE BLUE-DA-28X24-BMP,
           BITMAP-NUMBER 1,
           ID IS 9,
           .

      * LABEL
       05
           Screen3-La-1aca, 
           Label, 
           COL 18,50, 
           LINE 12,00,
           LINES 1,15 ,
           SIZE 7,00 ,
           ID IS 10,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Data",
           .

      * BITMAP
       05
           Bitmap-freccia-finoaa, 
           Bitmap, 
           COL 26,50, 
           LINE 12,00,
           LINES 24,00 ,
           SIZE 28,00 ,
           TRANSPARENT-COLOR TR-COLOR,
           BITMAP-HANDLE BLUE-FINO-28X24-BMP,
           BITMAP-NUMBER 1,
           ID IS 11,
           .

      * LABEL
       05
           Screen3-La-1acb, 
           Label, 
           COL 1,50, 
           LINE 14,39,
           LINES 1,39 ,
           SIZE 6,00 ,
           ID IS 19,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Cliente",
           .

      * LABEL
       05
           Screen4-Custom1-1, 
           Label, 
           COL 33,30, 
           LINE 5,28,
           LINES 0,61 ,
           SIZE 2,40 ,
           ID IS 2,
           TRANSPARENT,
           TITLE "CUSTOM CONTROL",
           VISIBLE v-custom,
           .

      * FRAME
       05
           Screen4-Fr-1, 
           Frame, 
           COL 1,00, 
           LINE 20,56,
           LINES 2,78 ,
           SIZE 43,60 ,
           ID IS 23,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           .

      * PUSH BUTTON
       05
           pb-ok, 
           Push-Button, 
           COL 28,10, 
           LINE 21,23,
           LINES 30,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE BOTTONE-OK-BMP,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 1000,
           FLAT,
           ID IS 200,
           AFTER PROCEDURE pb-ok-AfterProcedure, 
           BEFORE PROCEDURE pb-ok-BeforeProcedure, 
           .

      * PUSH BUTTON
       05
           pb-annulla, 
           Push-Button, 
           COL 36,20, 
           LINE 21,23,
           LINES 30,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE bottone-cancel-bmp,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 27,
           FLAT,
           ID IS 201,
           SELF-ACT,
           ESCAPE-BUTTON,
           AFTER PROCEDURE pb-annulla-AfterProcedure, 
           BEFORE PROCEDURE pb-annulla-BeforeProcedure, 
           .

      * LABEL
       05
           lab-cli, 
           Label, 
           COL 15,00, 
           LINE 14,39,
           LINES 2,00 ,
           SIZE 27,00 ,
           COLOR IS 5,
           ID IS 13,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-cli-buf,
           .

      * GRID
       05
           gd-tipocli, 
           Grid, 
           COL 46,20, 
           LINE 1,72,
           LINES 19,00 ,
           SIZE 41,90 ,
           BOXED,
           DATA-COLUMNS (1, 3),
           SEPARATION (5, 5),
           NUM-COL-HEADINGS 1,
           COLUMN-HEADINGS,
           CURSOR-FRAME-WIDTH 2,
           DIVIDER-COLOR 1,
           HEADING-COLOR 257,
           HEADING-DIVIDER-COLOR 1,
           ID IS 14,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RECORD-DATA gd-tipocli-rec,
           TILED-HEADINGS,
           VIRTUAL-WIDTH 40,
           VPADDING 10,
           VSCROLL,
           EVENT PROCEDURE Screen4-Gd-1-Event-Proc,
           .

      * BAR
       05
           Screen4-Br-1, 
           Bar,
           COL 44,50, 
           LINE 1,00,
           LINES 22,33 ,
           ID IS 18,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           WIDTH 1,
           .

      * PUSH BUTTON
       05
           pb-sel, 
           Push-Button, 
           COL 46,20, 
           LINE 21,06,
           LINES 30,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE SEL-TUTTO-BMP,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 1003,
           FLAT,
           ID IS 21,
           TITLE "g",
           AFTER PROCEDURE pb-sel-AfterProcedure, 
           BEFORE PROCEDURE pb-sel-BeforeProcedure, 
           .

      * PUSH BUTTON
       05
           pb-desel, 
           Push-Button, 
           COL 54,20, 
           LINE 21,06,
           LINES 30,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE DESEL-TUTTO-BMP,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 1004,
           FLAT,
           ID IS 22,
           TITLE "g",
           AFTER PROCEDURE pb-desel-AfterProcedure, 
           BEFORE PROCEDURE pb-desel-BeforeProcedure, 
           .

      * TOOLBAR
       01
           Form1-Tb-1a,
           .    

      * PUSH BUTTON
       05
           TOOL-ESCI, 
           Push-Button, 
           COL 1,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           ENABLED E-ESCI,
           EXCEPTION-VALUE 27,
           FLAT,
           ID IS 24,
           SELF-ACT,
           ESCAPE-BUTTON,
           TITLE "&Esci",
           .

      * PUSH BUTTON
       05
           TOOL-CERCAa, 
           Push-Button, 
           COL 6,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           BITMAP-NUMBER 8,
           UNFRAMED,
           SQUARE,
           ENABLED E-CERCA,
           EXCEPTION-VALUE 8,
           FLAT,
           ID IS 25,
           SELF-ACT,
           TITLE "Cerca (F8)",
           .

      * FORM
       01 
           form3, 
           .

      * LABEL
       05
           form3-La-1, 
           Label, 
           COL 12,43, 
           LINE 2,46,
           LINES 2,00 ,
           SIZE 50,00 ,
           FONT IS Verdana12BI-Occidentale,
           ID IS 2,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE tit-elab,
           .

      * FORM
       01 
           Form1, 
           AFTER PROCEDURE Form1-AfterProcedure,
           BEFORE PROCEDURE  Form1-BEFORE-SCREEN
           .

      * ENTRY FIELD
       05
           ef-cli, 
           Entry-Field, 
           COL 14,00, 
           LINE 3,73,
           LINES 1,31 ,
           SIZE 7,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED MOD,
           ID IS 78-ID-ef-cli,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 5,
           VALUE ef-cli-BUF,
           BEFORE PROCEDURE Screen2-DaEf-2-BeforeProcedure, 
           .

      * ENTRY FIELD
       05
           ef-des, 
           Entry-Field, 
           COL 86,43, 
           LINE 3,73,
           LINES 1,33 ,
           SIZE 7,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED MOD,
           ID IS 78-ID-ef-des,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 5,
           VALUE ef-des-BUF,
           BEFORE PROCEDURE Screen2-DaEf-3-BeforeProcedure, 
           .

      * ENTRY FIELD
       05
           ef-prov-d, 
           Entry-Field, 
           COL 86,43, 
           LINE 5,40,
           LINES 1,33 ,
           SIZE 4,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED MOD,
           ID IS 78-ID-ef-prov-d,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 2,
           VALUE ef-prov-d-BUF,
           BEFORE PROCEDURE ef-prov-d-BeforeProcedure, 
           .

      * ENTRY FIELD
       05
           ef-cap-d, 
           Entry-Field, 
           COL 100,71, 
           LINE 5,40,
           LINES 1,31 ,
           SIZE 8,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED MOD,
           ID IS 78-ID-ef-cap-d,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 5,
           VALUE ef-cap-d-BUF,
           BEFORE PROCEDURE ef-cap-d-BeforeProcedure, 
           .

      * ENTRY FIELD
       05
           ef-num-ord, 
           Entry-Field, 
           COL 14,00, 
           LINE 19,73,
           LINES 1,31 ,
           SIZE 31,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED MOD,
           ID IS 78-ID-ef-num-ord,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 50,
           VALUE ef-num-ord-BUF,
           BEFORE PROCEDURE Screen2-DaEf-5-BeforeProcedure, 
           .
      * ENTRY FIELD
       05
           ef-data, 
           Entry-Field, 
           COL 55,00, 
           LINE 19,73,
           LINES 1,31 ,
           SIZE 11,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED MOD,
           ID IS 78-ID-ef-data,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           MAX-TEXT 8,
           VALUE ef-data-BUF,
           BEFORE PROCEDURE Screen2-DaEf-6-BeforeProcedure, 
           .
      * ENTRY FIELD
       05
           ef-data-pass, 
           Entry-Field, 
           COL 86,43, 
           LINE 19,73,
           LINES 1,31 ,
           SIZE 11,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED MOD,
           ID IS 78-ID-ef-data-pass,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           MAX-TEXT 8,
           VALUE ef-data-pass-BUF,
           BEFORE PROCEDURE Screen2-DaEf-7-BeforeProcedure, 
           .
      * ENTRY FIELD
       05
           ef-evadi-dal, 
           Entry-Field, 
           COL 113,57, 
           LINE 19,73,
           LINES 1,31 ,
           SIZE 11,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED MOD,
           ID IS 78-ID-ef-evadi-dal,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           MAX-TEXT 8,
           VALUE ef-evadi-dal-BUF,
           BEFORE PROCEDURE Screen2-DaEf-7-BeforeProcedure, 
           .
      * ENTRY FIELD
       05
           ef-age, 
           Entry-Field, 
           COL 14,00, 
           LINE 21,27,
           LINES 1,31 ,
           SIZE 7,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED MOD,
           ID IS 78-ID-ef-age,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 5,
           VALUE ef-age-BUF,
           BEFORE PROCEDURE Screen2-DaEf-8-BeforeProcedure, 
           .

      * ENTRY FIELD
       05
           ef-pag, 
           Entry-Field, 
           COL 86,43, 
           LINE 21,27,
           LINES 1,31 ,
           SIZE 7,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED MOD,
           ID IS 78-ID-ef-pag,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 3,
           VALUE ef-pag-BUF,
           BEFORE PROCEDURE Screen2-DaEf-9-BeforeProcedure, 
           .

      * ENTRY FIELD
       05
           ef-iva, 
           Entry-Field, 
           COL 14,00, 
           LINE 22,80,
           LINES 1,31 ,
           SIZE 7,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED MOD,
           ID IS 78-ID-ef-iva,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 3,
           VALUE ef-iva-BUF,
           BEFORE PROCEDURE Screen2-DaEf-10-BeforeProcedure, 
           .

      * ENTRY FIELD
       05
           ef-vet, 
           Entry-Field, 
           COL 86,43, 
           LINE 22,80,
           LINES 1,31 ,
           SIZE 7,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED MOD,
           ID IS 78-ID-ef-vet,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 5,
           VALUE ef-vet-BUF,
           BEFORE PROCEDURE Screen2-DaEf-11-BeforeProcedure, 
           .

      * ENTRY FIELD
       05
           ef-note-1, 
           Entry-Field, 
           COL 14,00, 
           LINE 24,40,
           LINES 1,31 ,
           SIZE 30,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED MOD,
           ID IS 78-ID-ef-note-1,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 19,
           VALUE ef-note-1-BUF,
           BEFORE PROCEDURE Screen2-DaEf-12-BeforeProcedure, 
           .
      * ENTRY FIELD
       05
           ef-data-cons, 
           Entry-Field, 
           COL 55,00, 
           LINE 24,40,
           LINES 1,33 ,
           SIZE 11,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED MOD,
           ID IS 78-ID-ef-data-cons,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           MAX-TEXT 8,
           VALUE ef-data-cons-BUF,
           BEFORE PROCEDURE Screen2-DaEf-13-BeforeProcedure, 
           .
      * ENTRY FIELD
       05
           ef-note-2, 
           Entry-Field, 
           COL 86,43, 
           LINE 24,40,
           LINES 1,33 ,
           SIZE 52,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED MOD,
           ID IS 78-ID-ef-note-2,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 30,
           VALUE ef-note-2-BUF,
           BEFORE PROCEDURE Screen2-DaEf-14-BeforeProcedure, 
           .
      * ENTRY FIELD
       05
           ef-note-3, 
           Entry-Field, 
           COL 14,00, 
           LINE 25,93,
           LINES 1,31 ,
           SIZE 52,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED MOD,
           ID IS 78-ID-ef-note-3,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 30,
           VALUE ef-note-3-BUF,
           BEFORE PROCEDURE Screen2-DaEf-15-BeforeProcedure, 
           .
      * ENTRY FIELD
       05
           ef-note-4, 
           Entry-Field, 
           COL 86,57, 
           LINE 25,93,
           LINES 1,31 ,
           SIZE 52,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED MOD,
           ID IS 78-ID-ef-note-4,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 30,
           VALUE ef-note-4-BUF,
           BEFORE PROCEDURE Screen2-DaEf-16-BeforeProcedure, 
           .
      * ENTRY FIELD
       05
           ef-note, 
           Entry-Field, 
           COL 14,00, 
           LINE 27,47,
           LINES 2,60 ,
           SIZE 127,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED MOD,
           ID IS 78-ID-ef-note,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 500,
           VSCROLL-BAR,
           VALUE ef-note-BUF,
           BEFORE PROCEDURE Screen2-DaEf-17-BeforeProcedure, 
           .
      * CHECK BOX
       05
           chk-ritira, 
           Check-Box, 
           COL 14,00, 
           LINE 30,40,
           LINES 1,31 ,
           SIZE 2,50 ,
           ENABLED MOD,
           EXCEPTION-VALUE 1000
           FLAT,
           ID IS 78-ID-chk-ritira,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           SELF-ACT,
           VALUE chk-ritira-BUF,
           BEFORE PROCEDURE Screen2-DaCb-1-BeforeProcedure, 
            .
      * CHECK BOX
       05
           chk-prenot, 
           Check-Box, 
           COL 37,14, 
           LINE 30,40,
           LINES 1,31 ,
           SIZE 2,50 ,
           ENABLED MOD,
           FLAT,
           ID IS 78-ID-chk-prenot,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           SELF-ACT,
           VALUE chk-prenot-BUF,
           BEFORE PROCEDURE Screen2-DaCb-3-BeforeProcedure, 
            .
      * CHECK BOX
       05
           chk-saldi-banco, 
           Check-Box, 
           COL 55,29, 
           LINE 30,40,
           LINES 1,31 ,
           SIZE 2,50 ,
           ENABLED MOD,
           FLAT,
           ID IS 78-ID-chk-saldi-banco,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           SELF-ACT,
           VALUE chk-saldi-banco-BUF,
           BEFORE PROCEDURE Screen2-DaCb-4-BeforeProcedure, 
            .
      * CHECK BOX
       05
           chk-saldi-promo, 
           Check-Box, 
           COL 73,57, 
           LINE 30,40,
           LINES 1,33 ,
           SIZE 2,57 ,
           ENABLED MOD,
           FLAT,
           ID IS 78-ID-chk-saldi-promo,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           SELF-ACT,
           VALUE chk-saldi-promo-BUF,
           BEFORE PROCEDURE Screen2-DaCb-5-BeforeProcedure, 
            .
      * CHECK BOX
       05
           chk-ev-immediata, 
           Check-Box, 
           COL 99,00, 
           LINE 30,40,
           LINES 1,33 ,
           SIZE 2,57 ,
           ENABLED MOD,
           FLAT,
           ID IS 78-ID-chk-ev-immediata,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           SELF-ACT,
           VALUE chk-ev-immediata-BUF,
           BEFORE PROCEDURE Screen2-DaCb-5-BeforeProcedure, 
            .
      * CHECK BOX
       05
           chk-contrassegno, 
           Check-Box, 
           COL 120,43, 
           LINE 30,40,
           LINES 1,33 ,
           SIZE 2,57 ,
           ENABLED MOD,
           FLAT,
           ID IS 78-ID-chk-contrassegno,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           SELF-ACT,
           VALUE chk-contrassegno-BUF,
           BEFORE PROCEDURE Screen2-DaCb-5-BeforeProcedure, 
            .
      * GRID
       05
           Form1-Gd-1, 
           Grid, 
           COL 1,71, 
           LINE 32,93,
           LINES 17,73 ,
           SIZE 144,71 ,
           ADJUSTABLE-COLUMNS,
           BOXED,
           CENTERED-HEADINGS,
           DATA-COLUMNS (1, 6, 12, 62, 65, 73, 81, 89, 103, 117, 131, 
           141),
           ALIGNMENT ("R", "R", "U", "U", "R", "R", "R", "R", "R", "R", 
           "C", "C"),
           SEPARATION (5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5),
           DATA-TYPES ("9(5)", "9(6)", "X", "x(3)", "9(8)", "9(8)", "9(8
      -    ")", "9(12)", "9(12)", "9(12)", "X", "U(2)"),
           NUM-COL-HEADINGS 1,
           COLUMN-HEADINGS,
           CURSOR-FRAME-WIDTH 2,
           DIVIDER-COLOR 1,
           HEADING-COLOR 257,
           HEADING-DIVIDER-COLOR 1,
           ID IS 78-ID-Form1-Gd-1,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           ROW-HEADINGS,
           TILED-HEADINGS,
           VIRTUAL-WIDTH 142,
           VPADDING 40,
           VSCROLL,
           EVENT PROCEDURE Form1-Gd-1-Event-Proc,
           .

      * PUSH BUTTON
       05
           pb-aggiungi, 
           Push-Button, 
           COL 146,71, 
           LINE 32,60,
           LINES 40,00 ,
           SIZE 40,00 ,
           BITMAP-HANDLE AGGIUNGI-BMP,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           ENABLED MOD,
           EXCEPTION-VALUE 1003,
           FLAT,
           FONT IS Small-Font,
           ID IS 4,
           TITLE "&Elimina riga",
           AFTER PROCEDURE pb-aggiungi-AfterProcedure, 
           BEFORE PROCEDURE pb-aggiungi-BeforeProcedure, 
           .

      * PUSH BUTTON
       05
           pb-elimina, 
           Push-Button, 
           COL 146,71, 
           LINE 35,60,
           LINES 40,00 ,
           SIZE 40,00 ,
           BITMAP-HANDLE ELIMINA-BMP,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           ENABLED MOD,
           EXCEPTION-VALUE 1001,
           FLAT,
           FONT IS Small-Font,
           ID IS 5,
           TITLE "&Elimina riga",
           AFTER PROCEDURE pb-elimina-AfterProcedure, 
           BEFORE PROCEDURE pb-elimina-BeforeProcedure, 
           .

      * LABEL
       05
           Screen2-La-1, 
           Label, 
           COL 3,00, 
           LINE 1,56,
           LINES 1,31 ,
           SIZE 10,00 ,
           FONT IS Arial10B-Occidentale,
           ID IS 1,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Anno",
           .

      * LABEL
       05
           Screen2-La-1a, 
           Label, 
           COL 22,71, 
           LINE 1,56,
           LINES 1,31 ,
           SIZE 10,00 ,
           FONT IS Arial10B-Occidentale,
           ID IS 2,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Numero",
           .

      * DB_LABEL
       05
           lab-anno, 
           Label, 
           COL 14,00, 
           LINE 1,56,
           LINES 1,31 ,
           SIZE 6,00 ,
           COLOR IS 2,
           FONT IS Arial10B-Occidentale,
           ID IS 112,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-anno-BUF,
           TRANSPARENT,
           .

      * DB_LABEL
       05
           lab-numero, 
           Label, 
           COL 33,71, 
           LINE 1,56,
           LINES 1,31 ,
           SIZE 9,00 ,
           COLOR IS 2,
           FONT IS Arial10B-Occidentale,
           ID IS 113,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-numero-BUF,
           LEFT,
           TRANSPARENT,
           .

      * LABEL
       05
           cliente-lab, 
           Label, 
           COL 3,00, 
           LINE 3,73,
           LINES 1,31 ,
           SIZE 10,00 ,
           COLOR IS clr-cliente,
           ID IS 117,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Cliente",
           .

      * LABEL
       05
           destino-lab, 
           Label, 
           COL 75,00, 
           LINE 3,73,
           LINES 1,33 ,
           SIZE 7,00 ,
           COLOR IS clr-destino,
           ID IS 119,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Destino",
           .

      * LABEL
       05
           Screen2-La-6, 
           Label, 
           COL 3,00, 
           LINE 19,73,
           LINES 1,31 ,
           SIZE 10,00 ,
           COLOR IS 1,
           ID IS 123,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "N.Ord. Cli.",
           .

      * LABEL
       05
           Screen2-La-7, 
           Label, 
           COL 48,29, 
           LINE 19,73,
           LINES 1,31 ,
           SIZE 4,00 ,
           COLOR IS 1,
           ID IS 125,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "del",
           .

      * LABEL
       05
           Screen2-La-8, 
           Label, 
           COL 75,14, 
           LINE 19,73,
           LINES 1,31 ,
           SIZE 10,00 ,
           COLOR IS 1,
           ID IS 127,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Data pass.",
           .

      * LABEL
       05
           agente-lab, 
           Label, 
           COL 3,00, 
           LINE 21,27,
           LINES 1,31 ,
           SIZE 10,00 ,
           COLOR IS clr-agente,
           ID IS 131,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Agente",
           .

      * LABEL
       05
           pagamento-lab, 
           Label, 
           COL 75,14, 
           LINE 21,27,
           LINES 1,31 ,
           SIZE 10,00 ,
           COLOR IS clr-pagamento,
           ID IS 133,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Pagamento",
           .

      * LABEL
       05
           iva-lab, 
           Label, 
           COL 3,00, 
           LINE 22,80,
           LINES 1,31 ,
           SIZE 10,00 ,
           COLOR IS clr-iva,
           ID IS 135,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Iva esente",
           .

      * LABEL
       05
           vettore-lab, 
           Label, 
           COL 75,14, 
           LINE 22,80,
           LINES 1,31 ,
           SIZE 10,00 ,
           COLOR IS clr-vettore,
           ID IS 137,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Vettore",
           .

      * LABEL
       05
           Screen2-La-13, 
           Label, 
           COL 3,00, 
           LINE 24,40,
           LINES 1,31 ,
           SIZE 10,00 ,
           COLOR IS 1,
           ID IS 139,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Consegna",
           .

      * LABEL
       05
           Screen2-La-14, 
           Label, 
           COL 48,25, 
           LINE 24,40,
           LINES 1,07 ,
           SIZE 6,00 ,
           COLOR IS 1,
           ID IS 141,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Data",
           .

      * LABEL
       05
           Screen2-La-15, 
           Label, 
           COL 75,14, 
           LINE 24,40,
           LINES 1,31 ,
           SIZE 10,00 ,
           COLOR IS 1,
           ID IS 143,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Note 2",
           .

      * LABEL
       05
           Screen2-La-16, 
           Label, 
           COL 3,00, 
           LINE 25,93,
           LINES 1,31 ,
           SIZE 10,00 ,
           COLOR IS 1,
           ID IS 145,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Note 3",
           .

      * LABEL
       05
           Screen2-La-17, 
           Label, 
           COL 75,14, 
           LINE 25,93,
           LINES 1,31 ,
           SIZE 10,00 ,
           COLOR IS 1,
           ID IS 147,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Note 4",
           .

      * LABEL
       05
           Screen2-La-18, 
           Label, 
           COL 3,00, 
           LINE 27,47,
           LINES 1,31 ,
           SIZE 10,00 ,
           COLOR IS 1,
           ID IS 149,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Note",
           .

      * LABEL
       05
           lab-cliente, 
           Label, 
           COL 23,00, 
           LINE 3,73,
           LINES 2,00 ,
           SIZE 50,00 ,
           COLOR IS 5,
           ID IS 150,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           NO-KEY-LETTER,
           TRANSPARENT,
           TITLE lab-cliente-buf,
           .

      * LABEL
       05
           lab-destino, 
           Label, 
           COL 95,00, 
           LINE 3,73,
           LINES 1,20 ,
           SIZE 58,00 ,
           COLOR IS 5,
           ID IS 151,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           NO-KEY-LETTER,
           TRANSPARENT,
           TITLE lab-destino-buf,
           .

      * LABEL
       05
           lab-agente, 
           Label, 
           COL 23,43, 
           LINE 21,27,
           LINES 1,31 ,
           SIZE 50,00 ,
           COLOR IS 5,
           ID IS 152,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-agente-buf,
           .

      * LABEL
       05
           lab-pagamento, 
           Label, 
           COL 95,43, 
           LINE 21,27,
           LINES 1,31 ,
           SIZE 50,00 ,
           COLOR IS 5,
           ID IS 153,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-pagamento-buf,
           .

      * LABEL
       05
           lab-iva, 
           Label, 
           COL 23,43, 
           LINE 22,80,
           LINES 1,31 ,
           SIZE 50,00 ,
           COLOR IS 5,
           ID IS 155,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-iva-buf,
           .

      * LABEL
       05
           lab-vettore, 
           Label, 
           COL 95,43, 
           LINE 22,80,
           LINES 1,31 ,
           SIZE 50,00 ,
           COLOR IS 5,
           ID IS 161,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-vettore-buf,
           .

      * BAR
       05
           Screen2-Br-1a, 
           Bar,
           COL 1,00, 
           LINE 32,20,
           SIZE 153,43 ,
           ID IS 162,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           WIDTH 1,
           .

      * LABEL
       05
           lab-stato, 
           Label, 
           COL 132,33, 
           LINE 1,56,
           LINES 1,31 ,
           SIZE 14,00 ,
           COLOR IS col-lab-stato,
           FONT IS Arial10B-Occidentale,
           ID IS 163,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TITLE lab-stato-buf,
           .

      * LABEL
       05
           Screen2-La-5, 
           Label, 
           COL 3,00, 
           LINE 30,40,
           LINES 1,31 ,
           SIZE 10,50 ,
           COLOR IS 1,
           ID IS 164,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Ritira in LBX",
           .

      * LABEL
       05
           Screen2-La-5aa, 
           Label, 
           COL 20,14, 
           LINE 30,40,
           LINES 1,31 ,
           SIZE 15,63 ,
           COLOR IS 1,
           ID IS 165,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Prenotazione q.tà",
           .

      * LABEL
       05
           Screen2-La-5ab, 
           Label, 
           COL 43,29, 
           LINE 30,40,
           LINES 1,33 ,
           SIZE 10,00 ,
           COLOR IS 1,
           ID IS 166,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Saldi banco",
           .

      * LABEL
       05
           Screen2-La-5aba, 
           Label, 
           COL 61,57, 
           LINE 30,40,
           LINES 1,33 ,
           SIZE 10,00 ,
           COLOR IS 1,
           ID IS 167,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Saldi promo",
           .

      * BAR
       05
           Screen2-Br-1ab, 
           Bar,
           COL 1,00, 
           LINE 3,20,
           SIZE 153,43 ,
           ID IS 168,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           WIDTH 1,
           .

      * LABEL
       05
           Screen2-Custom1-1, 
           Label, 
           COL 72,38, 
           LINE 1,81,
           LINES 1,22 ,
           SIZE 14,63 ,
           ID IS 3,
           TRANSPARENT,
           TITLE "CUSTOM CONTROL",
           VISIBLE v-custom,
           .

      * PUSH BUTTON
       05
           pb-cambia, 
           Push-Button, 
           COL 146,71, 
           LINE 38,60,
           LINES 3,13 ,
           SIZE 6,86 ,
           BITMAP-HANDLE cambia-bmp,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           ENABLED MOD,
           EXCEPTION-VALUE 1002,
           FLAT,
           FONT IS Small-Font,
           ID IS 6,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "CAMBIA ARTICOLO",
           MULTILINE
           AFTER PROCEDURE pb-cambia-AfterProcedure, 
           BEFORE PROCEDURE pb-cambia-BeforeProcedure, 
           .

      * BAR
       05
           Screen2-Br-1aba, 
           Bar,
           COL 1,00, 
           LINE 7,27,
           SIZE 153,43 ,
           ID IS 7,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           WIDTH 1,
           .

      * BAR
       05
           Screen2-Br-1abb, 
           Bar,
           COL 1,00, 
           LINE 13,80,
           SIZE 153,43 ,
           ID IS 8,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           WIDTH 1,
           .

      * DB_LABEL
       05
           lab-nab-codbuyer, 
           Label, 
           COL 3,00, 
           LINE 8,13,
           LINES 1,31 ,
           SIZE 19,00 ,
           COLOR IS 5,
           ID IS 9,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-nab-codbuyer-BUF,
           TRANSPARENT,
           .

      * DB_LABEL
       05
           lab-nab-rafsocb, 
           Label, 
           COL 23,00, 
           LINE 8,13,
           LINES 1,31 ,
           SIZE 50,00 ,
           COLOR IS 5,
           ID IS 10,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-nab-rafsocb-BUF,
           TRANSPARENT,
           .

      * DB_LABEL
       05
           lab-nab-indirb, 
           Label, 
           COL 3,00, 
           LINE 9,80,
           LINES 1,31 ,
           SIZE 70,00 ,
           COLOR IS 5,
           ID IS 11,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-nab-indirb-BUF,
           TRANSPARENT,
           .

      * DB_LABEL
       05
           lab-nab-cittab, 
           Label, 
           COL 3,00, 
           LINE 11,53,
           LINES 1,31 ,
           SIZE 55,00 ,
           COLOR IS 5,
           ID IS 12,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-nab-cittab-BUF,
           TRANSPARENT,
           .

      * DB_LABEL
       05
           lab-nab-provb, 
           Label, 
           COL 59,00, 
           LINE 11,53,
           LINES 1,31 ,
           SIZE 5,00 ,
           COLOR IS 5,
           ID IS 13,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-nab-provb-BUF,
           TRANSPARENT,
           .

      * DB_LABEL
       05
           lab-nab-capb, 
           Label, 
           COL 65,00, 
           LINE 11,60,
           LINES 1,31 ,
           SIZE 5,00 ,
           COLOR IS 5,
           ID IS 14,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-nab-capb-BUF,
           TRANSPARENT,
           .

      * DB_LABEL
       05
           lab-nad-codcons, 
           Label, 
           COL 75,00, 
           LINE 8,13,
           LINES 1,31 ,
           SIZE 19,00 ,
           COLOR IS 5,
           ID IS 15,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-nad-codcons-BUF,
           TRANSPARENT,
           .

      * DB_LABEL
       05
           lab-nad-ragsocd, 
           Label, 
           COL 95,00, 
           LINE 8,13,
           LINES 1,31 ,
           SIZE 50,00 ,
           COLOR IS 5,
           ID IS 16,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-nad-ragsocd-BUF,
           TRANSPARENT,
           .

      * DB_LABEL
       05
           lab-nad-indird, 
           Label, 
           COL 75,00, 
           LINE 9,80,
           LINES 1,31 ,
           SIZE 70,00 ,
           COLOR IS 5,
           ID IS 17,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-nad-indird-BUF,
           TRANSPARENT,
           .

      * DB_LABEL
       05
           lab-nad-cittad, 
           Label, 
           COL 75,00, 
           LINE 11,53,
           LINES 1,31 ,
           SIZE 55,00 ,
           COLOR IS 5,
           ID IS 18,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-nad-cittad-BUF,
           TRANSPARENT,
           .

      * DB_LABEL
       05
           lab-nad-provd, 
           Label, 
           COL 133,86, 
           LINE 11,53,
           LINES 1,31 ,
           SIZE 5,00 ,
           COLOR IS 5,
           ID IS 19,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-nad-provd-BUF,
           TRANSPARENT,
           .

      * DB_LABEL
       05
           lab-nad-capd, 
           Label, 
           COL 139,86, 
           LINE 11,53,
           LINES 1,31 ,
           SIZE 5,00 ,
           COLOR IS 5,
           ID IS 20,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-nad-capd-BUF,
           TRANSPARENT,
           .

      * BAR
       05
           Screen2-Br-1abba, 
           Bar,
           COL 1,00, 
           LINE 18,87,
           SIZE 153,43 ,
           ID IS 21,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           WIDTH 1,
           .

      * ENTRY FIELD
       05
           ef-note-edi, 
           Entry-Field, 
           COL 14,00, 
           LINE 14,33,
           LINES 4,00 ,
           SIZE 127,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED 1,
           ID IS 22,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           READ-ONLY,
           VSCROLL-BAR,
           VALUE ef-note-edi-buf,
           AFTER PROCEDURE Screen2-Ef-1-AfterProcedure, 
           BEFORE PROCEDURE Screen2-Ef-1-BeforeProcedure, 
           .

      * LABEL
       05
           Screen2-La-6a, 
           Label, 
           COL 3,00, 
           LINE 14,33,
           LINES 1,31 ,
           SIZE 10,00 ,
           COLOR IS 1,
           ID IS 23,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Note EDI",
           .

      * LABEL
       05
           Screen2-La-8a, 
           Label, 
           COL 102,29, 
           LINE 19,73,
           LINES 1,31 ,
           SIZE 10,00 ,
           COLOR IS 1,
           ID IS 24,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Evadi dal",
           .

      * LABEL
       05
           Screen2-La-8aa, 
           Label, 
           COL 126,57, 
           LINE 30,40,
           LINES 1,33 ,
           SIZE 11,00 ,
           COLOR IS 5,
           ID IS 25,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Totale ordine",
           .

      * LABEL
       05
           lab-tot, 
           Label, 
           COL 137,00, 
           LINE 30,40,
           LINES 1,33 ,
           SIZE 12,00 ,
           COLOR IS 5,
           ID IS 26,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           TITLE lab-tot-buf,
           .

      * LABEL
       05
           lab-tota, 
           Label, 
           COL 149,86, 
           LINE 30,40,
           LINES 1,33 ,
           SIZE 2,00 ,
           COLOR IS 5,
           ID IS 27,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           LEFT,
           TITLE "",
           .

      * LABEL
       05
           Screen2-La-5abaa, 
           Label, 
           COL 80,57, 
           LINE 30,40,
           LINES 1,33 ,
           SIZE 17,00 ,
           COLOR IS 1,
           ID IS 28,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Evasione immediata",
           .

      * LABEL
       05
           provincia-lab, 
           Label, 
           COL 75,00, 
           LINE 5,40,
           LINES 1,33 ,
           SIZE 8,00 ,
           COLOR IS clr-destino,
           ID IS 29,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Provincia",
           .

      * LABEL
       05
           cap-lab, 
           Label, 
           COL 93,57, 
           LINE 5,40,
           LINES 1,33 ,
           SIZE 5,00 ,
           COLOR IS clr-destino,
           ID IS 30,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "CAP",
           .

      * LABEL
       05
           Screen2-La-5abaaa, 
           Label, 
           COL 106,14, 
           LINE 30,40,
           LINES 1,33 ,
           SIZE 13,00 ,
           COLOR IS 1,
           ID IS 31,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Contrassegno",
           .

      * TOOLBAR
       01
           Form1-Tb-1,
           .    

      * PUSH BUTTON
       05
           TOOL-ESCIa, 
           Push-Button, 
           COL 1,00, 
           LINE 1,00,
           LINES 28,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           ENABLED E-ESCI,
           EXCEPTION-VALUE 27,
           FLAT,
           ID IS 72,
           SELF-ACT,
           ESCAPE-BUTTON,
           TITLE "Esci (Esc)",
           .

      * PUSH BUTTON
       05
           TOOL-NUOVO, 
           Push-Button, 
           COL 6,00, 
           LINE 1,00,
           LINES 28,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           BITMAP-NUMBER 23,
           FRAMED,
           SQUARE,
           ENABLED 0,
           EXCEPTION-VALUE 2,
           FLAT,
           ID IS 73,
           SELF-ACT,
           TITLE "Nuovo (F2)",
           .

      * PUSH BUTTON
       05
           TOOL-CANCELLA, 
           Push-Button, 
           COL 16,00, 
           LINE 1,00,
           LINES 28,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           FRAMED,
           SQUARE,
           ENABLED 0,
           EXCEPTION-VALUE 4,
           FLAT,
           ID IS 74,
           SELF-ACT,
           TITLE "Cancella (F4)",
           BITMAP-NUMBER BitmapNumDelete
           .

      * PUSH BUTTON
       05
           TOOL-SALVA, 
           Push-Button, 
           COL 11,00, 
           LINE 1,00,
           LINES 28,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           FRAMED,
           SQUARE,
           ENABLED E-SALVA,
           EXCEPTION-VALUE 3,
           FLAT,
           ID IS 75,
           SELF-ACT,
           TITLE "Salva (F3)",
           BITMAP-NUMBER BitmapNumSave
           .

      * PUSH BUTTON
       05
           TOOL-ANTEPRIMA, 
           Push-Button, 
           COL 26,00, 
           LINE 1,00,
           LINES 28,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           BITMAP-NUMBER 17,
           FRAMED,
           SQUARE,
           ENABLED E-ANTEPRIMA,
           EXCEPTION-VALUE 6,
           FLAT,
           ID IS 76,
           SELF-ACT,
           TITLE "Anteprima (F6)",
           .

      * CHECK BOX
       05
           TOOL-MODIFICA, 
           Check-Box, 
           COL 21,00, 
           LINE 1,15,
           LINES 25,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           BITMAP-NUMBER 5,
           FRAMED,
           SQUARE,
           ENABLED E-MODIFICA,
           EXCEPTION-VALUE 150
           FLAT,
           ID IS 77,
           SELF-ACT,
           TITLE "Modifica (F5)",
           VALUE MOD,
           BITMAP-NUMBER BitmapNumEdit
           AFTER PROCEDURE TOOL-MODIFICA-AfterProcedure,
           BEFORE PROCEDURE TOOL-MODIFICA-BeforeProcedure, 
           .
      * PUSH BUTTON
       05
           TOOL-STAMPA, 
           Push-Button, 
           COL 31,00, 
           LINE 1,00,
           LINES 28,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           BITMAP-NUMBER 18,
           FRAMED,
           SQUARE,
           ENABLED E-STAMPA,
           EXCEPTION-VALUE 7,
           FLAT,
           ID IS 110,
           SELF-ACT,
           TITLE "Stampa (F7)",
           .

      * PUSH BUTTON
       05
           TOOL-CERCA, 
           Push-Button, 
           COL 36,00, 
           LINE 1,00,
           LINES 28,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           FRAMED,
           SQUARE,
           ENABLED E-CERCA,
           EXCEPTION-VALUE 8,
           FLAT,
           ID IS 111,
           SELF-ACT,
           TITLE "Cerca (F8)",
           VISIBLE 1,
           BITMAP-NUMBER BitmapNumZoom
           .

      * FORM
       01 
           form-gen, 
           AFTER PROCEDURE  form-gen-AFTER-SCREEN
           BEFORE PROCEDURE  form-gen-BEFORE-SCREEN
           .

      * LABEL
       05
           form3-La-1a, 
           Label, 
           COL 17,86, 
           LINE 2,46,
           LINES 2,00 ,
           SIZE 38,00 ,
           COLOR IS 5,
           FONT IS Verdana12BI-Occidentale,
           ID IS 2,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Generazione ordini in corso...",
           .

      * FORM
       01 
           scr-fine, 
           HELP-ID 1,
           AFTER PROCEDURE  scr-fine-AFTER-SCREEN
           BEFORE PROCEDURE  scr-fine-BEFORE-SCREEN
           .

      * PUSH BUTTON
       05
           scr-fine-Pb-1, 
           Push-Button, 
           COL 1,00, 
           LINE 20,50,
           LINES 0,80 CELLS,
           SIZE 0,90 CELLS,
           FONT IS Small-Font,
           ID IS 1,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           .

      * PUSH BUTTON
       05
           pb-sia, 
           Push-Button, 
           COL 11,90, 
           LINE 17,20,
           LINES 30,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE BOTTONE-OK-BMP,
           BITMAP-NUMBER 2,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 2700,
           FLAT,
           ID IS 10,
           AFTER PROCEDURE pb-sia-AfterProcedure, 
           BEFORE PROCEDURE pb-sia-BeforeProcedure, 
           .

      * FRAME
       05
           Screen1-Fr-1ab, 
           Frame, 
           COL 2,00, 
           LINE 1,30,
           LINES 15,40 CELLS,
           SIZE 27,90 CELLS,
           ID IS 3,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           .

      * LABEL
       05
           scr-fine-La-4, 
           Label, 
           COL 5,10, 
           LINE 3,00,
           LINES 2,00 CELLS,
           SIZE 20,60 CELLS,
           ID IS 11,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Ordini Generati",
           .

      * BAR
       05
           scr-fine-Br-1a, 
           Bar,
           COL 2,50, 
           LINE 3,80,
           SIZE 2,20 CELLS,
           ID IS 14,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           COLORS (1),
           WIDTH 1,
           .

      * LABEL
       05
           scr-fine-La-5, 
           Label, 
           COL 5,10, 
           LINE 6,30,
           LINES 2,00 CELLS,
           SIZE 2,80 CELLS,
           ID IS 15,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Da",
           .

      * LABEL
       05
           scr-fine-La-6, 
           Label, 
           COL 17,10, 
           LINE 6,30,
           LINES 2,00 CELLS,
           SIZE 1,50 CELLS,
           ID IS 16,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "a",
           .

      * LABEL
       05
           scr-fine-La-7, 
           Label, 
           COL 8,40, 
           LINE 6,30,
           LINES 2,00 CELLS,
           SIZE 7,50 CELLS,
           COLOR IS 5,
           ID IS 17,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           LEFT,
           TRANSPARENT,
           TITLE primo-numero-z,
           .

      * LABEL
       05
           scr-fine-La-8, 
           Label, 
           COL 19,30, 
           LINE 6,30,
           LINES 2,00 CELLS,
           SIZE 7,50 CELLS,
           COLOR IS 5,
           ID IS 18,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           LEFT,
           TRANSPARENT,
           TITLE ultimo-numero-z,
           .

      * LABEL
       05
           scr-fine-La-4a, 
           Label, 
           COL 8,40, 
           LINE 10,30,
           LINES 2,00 CELLS,
           SIZE 15,00 CELLS,
           ID IS 6,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Totale Ordini",
           .

      * LABEL
       05
           lbl-tot-fat, 
           Label, 
           COL 10,90, 
           LINE 13,30,
           LINES 2,00 CELLS,
           SIZE 10,00 CELLS,
           COLOR IS 5,
           ID IS 12,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE tot-ordini-z,
           .

      * BAR
       05
           scr-fine-Br-1aa, 
           Bar,
           COL 27,10, 
           LINE 3,80,
           SIZE 2,20 CELLS,
           ID IS 13,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           COLORS (1),
           WIDTH 1,
           .

      *{TOTEM}END

      *{TOTEM}LINKPARA
       PROCEDURE  DIVISION USING LK-BLOCKPGM, USER-CODI, LIVELLO-ABIL, 
           lk-mb-id.
      *{TOTEM}END

      *{TOTEM}DECLARATIVE
       DECLARATIVES.
      * <TOTEM:EPT. INIT:EDI-selordini, INIT:EDI-selordini, BeforeDeclarative>
       EDI-MTORDINI-ERROR SECTION.
           use after error procedure on EDI-MTORDINI.
           set RecLocked to false.
           evaluate status-EDI-MTORDINI
           when "35"
                display message "File [EDI-MTORDINI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [EDI-MTORDINI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[EDI-MTORDINI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           when "99"
           when "93"
                set RecLocked to true
                set errori    to true
                move 0 to mod
                modify tool-modifica, value = mod
                move 1 to mod-k
                display form1
                set StatusVisua to true
                perform STATUS-BAR-MSG
                move "00" to status-EDI-MTORDINI
                if ReadSecca
                   read EDI-MTORDINI       no lock 
                        invalid      continue
                        not invalid  perform FORM1-IUD-DISPLAY
                   end-read
                end-if
                display message box MSG-Record-gia-in-uso
                        title = tit-err
                        icon is mb-error-icon
           when "23"
                move 1 to mod-k
                move 0 to mod
                modify tool-modifica, value = mod
                set StatusVisua to true
                perform STATUS-BAR-MSG 
                perform ABILITAZIONI
                display form1
                |RISETTO IL VALORE A "23" PERCHE DENTRO AL PAR. CLEAR-SCREEN
                |CON L'OPERAZIONE UNLOCK VIENE RISETTATO A ZERO COSICCHÈ 
                |QUANDO TORNA DENTRO AI PAR. DI SCORRIMENTO DI TOTEM SI 
                |TROVA IN UNA SITUAZIONE CORRETTA E PROSEGUE CON LA READ
                |USCENDO CON UN MESSAGGIO DI ERRORE DI TIPO "46"
                move "23" to status-EDI-MTORDINI
           end-evaluate.  
 
      ***---
       EDI-MRORDINI-ERR SECTION.
           use after error procedure on EDI-MRORDINI.
           set tutto-ok  to true.
           evaluate status-EDI-MRORDINI
           when "35"
                display message "File [EDI-MRORDINI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [EDI-MRORDINI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[EDI-MRORDINI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       CLIENTI-ERR SECTION.
           use after error procedure on clienti.
           set tutto-ok  to true.
           evaluate status-clienti
           when "35"
                display message "File [CLIENTI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [CLIENTI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[CLIENTI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       DESTINI-ERR SECTION.
           use after error procedure on destini.
           set tutto-ok  to true.
           evaluate status-destini
           when "35"
                display message "File [DESTINI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [DESTINI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[DESTINI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       TPARAMGE-ERR SECTION.
           use after error procedure on tparamge.
           set tutto-ok  to true.
           evaluate status-tparamge
           when "35"
                display message "File [TPARAMGE] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TPARAMGE] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TPARAMGE] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.


       LOCKFILE-ERR SECTION.
           use after error procedure on lockfile.
           evaluate status-lockfile
           when "99" set RecLocked to true
           when "00"
           when other continue
           end-evaluate.

      * <TOTEM:END>
       INPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON INPUT.
       0100-DECL.
           EXIT.
       I-O-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON I-O.
       0200-DECL.
           EXIT.
       OUTPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON OUTPUT.
       0300-DECL.
           EXIT.
       TRANSACTION-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON TRANSACTION.
       0400-DECL.
           EXIT.
       END DECLARATIVES.
      *{TOTEM}END

       MAIN-LOGIC.
      *{TOTEM}ENTRY-BEFPRG
      *    Before-Program
           PERFORM ginqui-Ev-Before-Program
      *{TOTEM}END
           PERFORM INITIALIZE-ROUTINE.
      * run main screen
      *{TOTEM}RUN-MAINSCR
           PERFORM Form-ini-OPEN-ROUTINE.
      *{TOTEM}END

      *{TOTEM}COPY-PROCEDURE
       EXIT-STOP-ROUTINE.
           PERFORM CLOSE-FILE-RTN
      * <TOTEM:EPT. INIT:EDI-selordini, INIT:EDI-selordini, BeforeDestroyResource>
      * <TOTEM:END>
           DESTROY Verdana12B-Occidentale
           DESTROY Verdana10B-Occidentale
           DESTROY Verdana12-Occidentale
           DESTROY Verdana12BI-Occidentale
           DESTROY Arial10B-Occidentale
           DESTROY Arial9-Occidentale
           DESTROY Arial-Black12B-Occidentale
           CALL "w$bitmap" USING WBITMAP-DESTROY, GENERA-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, BOTTONE-AGGIORNA-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, BOTTONE-CANCEL-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, BOTTONE-OK-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, BLUE-DA-28X24-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, BLUE-FINO-28X24-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, bottone-cancel-bmp
           CALL "w$bitmap" USING WBITMAP-DESTROY, SEL-TUTTO-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, DESEL-TUTTO-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, toolbar-bmp
           CALL "w$bitmap" USING WBITMAP-DESTROY, TOOLBAR-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, AGGIUNGI-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, ELIMINA-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, cambia-bmp
      *    After-Program
           PERFORM ginqui-Ev-After-Program
           EXIT PROGRAM TOTEM-PgmStatus
           STOP RUN.

       INITIALIZE-ROUTINE.
      *    Before Init
      * initialize program status variable
           Initialize TOTEM-PgmStatus.
      * get system information
           ACCEPT SYSTEM-INFORMATION FROM SYSTEM-INFO.
      * get terminal information
           ACCEPT TERMINAL-ABILITIES FROM TERMINAL-INFO.
      * set font
           PERFORM INIT-FONT.
      * load bitmap
           PERFORM INIT-BMP.
      * load resource
           PERFORM INIT-RES.
      * create pop-up menu
           PERFORM INIT-POPUP.
      * open files
           PERFORM OPEN-FILE-RTN.
      *    After Init
           .
    
       INIT-FONT.
      * Verdana12B-Occidentale
           INITIALIZE WFONT-DATA Verdana12B-Occidentale
           MOVE 12 TO WFONT-SIZE
           MOVE "Verdana" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO TRUE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Verdana12B-Occidentale, WFONT-DATA
      * Verdana10B-Occidentale
           INITIALIZE WFONT-DATA Verdana10B-Occidentale
           MOVE 10 TO WFONT-SIZE
           MOVE "Verdana" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO TRUE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Verdana10B-Occidentale, WFONT-DATA
      * Verdana12-Occidentale
           INITIALIZE WFONT-DATA Verdana12-Occidentale
           MOVE 12 TO WFONT-SIZE
           MOVE "Verdana" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO FALSE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Verdana12-Occidentale, WFONT-DATA
      * Verdana12BI-Occidentale
           INITIALIZE WFONT-DATA Verdana12BI-Occidentale
           MOVE 12 TO WFONT-SIZE
           MOVE "Verdana" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO TRUE
           SET WFONT-ITALIC TO TRUE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Verdana12BI-Occidentale, WFONT-DATA

      * Arial10B-Occidentale
           INITIALIZE WFONT-DATA Arial10B-Occidentale
           MOVE 10 TO WFONT-SIZE
           MOVE "Arial" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO TRUE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Arial10B-Occidentale, WFONT-DATA
      * Arial9-Occidentale
           INITIALIZE WFONT-DATA Arial9-Occidentale
           MOVE 9 TO WFONT-SIZE
           MOVE "Arial" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO FALSE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Arial9-Occidentale, WFONT-DATA
      * Arial-Black12B-Occidentale
           INITIALIZE WFONT-DATA Arial-Black12B-Occidentale
           MOVE 12 TO WFONT-SIZE
           MOVE "Arial Black" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO TRUE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Arial-Black12B-Occidentale, WFONT-DATA
           .

       INIT-BMP.
      * pb-genera
           COPY RESOURCE "GENERA.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "GENERA.BMP", 
                   GIVING GENERA-BMP.
      * pb-aggiorna
           COPY RESOURCE "BOTTONE-AGGIORNA.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "BOTTONE-AGGIORNA.BMP", 
                   GIVING BOTTONE-AGGIORNA-BMP.
      * pb-annulla2
           COPY RESOURCE "BOTTONE-CANCEL.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "BOTTONE-CANCEL.BMP", 
                   GIVING BOTTONE-CANCEL-BMP.
      * pb-ok2
           COPY RESOURCE "BOTTONE-OK.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "BOTTONE-OK.BMP", 
                   GIVING BOTTONE-OK-BMP.
      * Bitmap-freccia-daa
           COPY RESOURCE "BLUE-DA-28X24.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "BLUE-DA-28X24.BMP", 
                   GIVING BLUE-DA-28X24-BMP.
      * Bitmap-freccia-finoa
           COPY RESOURCE "BLUE-FINO-28X24.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "BLUE-FINO-28X24.BMP", 
                   GIVING BLUE-FINO-28X24-BMP.
      * pb-annulla
           COPY RESOURCE "BOTTONE-CANCEL.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "BOTTONE-CANCEL.BMP", 
                   GIVING bottone-cancel-bmp.
      * pb-sel
           COPY RESOURCE "SEL-TUTTO.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "SEL-TUTTO.BMP", 
                   GIVING SEL-TUTTO-BMP.
      * pb-desel
           COPY RESOURCE "DESEL-TUTTO.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "DESEL-TUTTO.BMP", 
                   GIVING DESEL-TUTTO-BMP.
      * TOOL-ESCI
           COPY RESOURCE "toolbar.bmp".
           CALL "w$bitmap" USING WBITMAP-LOAD "toolbar.bmp", 
                   GIVING toolbar-bmp.
      * TOOL-CERCAa
           COPY RESOURCE "TOOLBAR.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "TOOLBAR.BMP", 
                   GIVING TOOLBAR-BMP.
      * pb-aggiungi
           COPY RESOURCE "AGGIUNGI.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "AGGIUNGI.BMP", 
                   GIVING AGGIUNGI-BMP.
      * pb-elimina
           COPY RESOURCE "ELIMINA.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "ELIMINA.BMP", 
                   GIVING ELIMINA-BMP.
      * pb-cambia
           COPY RESOURCE "CAMBIA.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "CAMBIA.BMP", 
                   GIVING cambia-bmp.
           .

       INIT-RES.
           .

       INIT-POPUP.
           .

       OPEN-FILE-RTN.
      *    Before Open
           PERFORM OPEN-clienti
           PERFORM OPEN-destini
           PERFORM OPEN-EDI-mtordini
           PERFORM OPEN-agenti
           PERFORM OPEN-tivaese
           PERFORM OPEN-ttipocli
           PERFORM OPEN-tvettori
           PERFORM OPEN-pagbloc
           PERFORM OPEN-tcaumag
           PERFORM OPEN-tmagaz
           PERFORM OPEN-note
           PERFORM OPEN-param
           PERFORM OPEN-recapiti
           PERFORM OPEN-EDI-mrordini
           PERFORM OPEN-articoli
           PERFORM OPEN-progmag
           PERFORM OPEN-sitfin
           PERFORM OPEN-tparamge
           PERFORM OPEN-mrordini
           PERFORM OPEN-mtordini
           PERFORM OPEN-timbalqta
           PERFORM OPEN-timposte
           PERFORM OPEN-tpiombo
           PERFORM OPEN-tmarche
           PERFORM OPEN-rpromo
           PERFORM OPEN-tpromo
      *    tmp-promo-prz OPEN MODE IS FALSE
      *    PERFORM OPEN-tmp-promo-prz
           PERFORM OPEN-listini
           PERFORM OPEN-locali
           PERFORM OPEN-blister
           PERFORM OPEN-cli-prg
           PERFORM OPEN-tcodpag
      *    tmp-progmag-zoom OPEN MODE IS FALSE
      *    PERFORM OPEN-tmp-progmag-zoom
           PERFORM OPEN-timballi
           PERFORM OPEN-tcontat
           PERFORM OPEN-lockfile
           PERFORM OPEN-tnazioni
           PERFORM OPEN-tscorte
      *    tmp-fido OPEN MODE IS FALSE
      *    PERFORM OPEN-tmp-fido
           PERFORM OPEN-grade
      *    log-macrobatch OPEN MODE IS FALSE
      *    PERFORM OPEN-log-macrobatch
      *    macrobatch OPEN MODE IS FALSE
      *    PERFORM OPEN-macrobatch
           PERFORM OPEN-tprov
           PERFORM OPEN-EDI-clides
           PERFORM OPEN-anacap
      *    After Open
           .

       OPEN-clienti.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:clienti, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT clienti
           IF NOT Valid-STATUS-clienti
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:clienti, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-destini.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:destini, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O destini
           IF STATUS-destini = "35"
              OPEN OUTPUT destini
                IF Valid-STATUS-destini
                   CLOSE destini
                   OPEN I-O destini
                END-IF
           END-IF
           IF NOT Valid-STATUS-destini
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:destini, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-EDI-mtordini.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:EDI-mtordini, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O EDI-mtordini
           IF STATUS-EDI-mtordini = "35"
              OPEN OUTPUT EDI-mtordini
                IF Valid-STATUS-EDI-mtordini
                   CLOSE EDI-mtordini
                   OPEN I-O EDI-mtordini
                END-IF
           END-IF
           IF NOT Valid-STATUS-EDI-mtordini
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:EDI-mtordini, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-agenti.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:agenti, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT agenti
           IF NOT Valid-STATUS-agenti
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:agenti, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tivaese.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tivaese, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tivaese
           IF NOT Valid-STATUS-tivaese
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tivaese, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-ttipocli.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:ttipocli, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT ttipocli
           IF NOT Valid-STATUS-ttipocli
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:ttipocli, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tvettori.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tvettori, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tvettori
           IF NOT Valid-STATUS-tvettori
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tvettori, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-pagbloc.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:pagbloc, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT pagbloc
           IF NOT Valid-STATUS-pagbloc
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:pagbloc, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tcaumag.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tcaumag, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tcaumag
           IF NOT Valid-STATUS-tcaumag
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tcaumag, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tmagaz.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tmagaz, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tmagaz
           IF NOT Valid-STATUS-tmagaz
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tmagaz, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-note.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:note, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT note
           IF NOT Valid-STATUS-note
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:note, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-param.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:param, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT param
           IF NOT Valid-STATUS-param
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:param, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-recapiti.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:recapiti, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT recapiti
           IF NOT Valid-STATUS-recapiti
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:recapiti, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-EDI-mrordini.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:EDI-mrordini, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O EDI-mrordini
           IF STATUS-EDI-mrordini = "35"
              OPEN OUTPUT EDI-mrordini
                IF Valid-STATUS-EDI-mrordini
                   CLOSE EDI-mrordini
                   OPEN I-O EDI-mrordini
                END-IF
           END-IF
           IF NOT Valid-STATUS-EDI-mrordini
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:EDI-mrordini, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-articoli.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:articoli, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT articoli
           IF NOT Valid-STATUS-articoli
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:articoli, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-progmag.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:progmag, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT progmag
           IF NOT Valid-STATUS-progmag
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:progmag, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-sitfin.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:sitfin, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT sitfin
           IF NOT Valid-STATUS-sitfin
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:sitfin, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tparamge.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tparamge, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tparamge
           IF NOT Valid-STATUS-tparamge
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tparamge, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-mrordini.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:mrordini, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O mrordini
           IF STATUS-mrordini = "35"
              OPEN OUTPUT mrordini
                IF Valid-STATUS-mrordini
                   CLOSE mrordini
                   OPEN I-O mrordini
                END-IF
           END-IF
           IF NOT Valid-STATUS-mrordini
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:mrordini, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-mtordini.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:mtordini, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O mtordini
           IF STATUS-mtordini = "35"
              OPEN OUTPUT mtordini
                IF Valid-STATUS-mtordini
                   CLOSE mtordini
                   OPEN I-O mtordini
                END-IF
           END-IF
           IF NOT Valid-STATUS-mtordini
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:mtordini, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-timbalqta.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:timbalqta, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT timbalqta
           IF NOT Valid-STATUS-timbalqta
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:timbalqta, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-timposte.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:timposte, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT timposte
           IF NOT Valid-STATUS-timposte
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:timposte, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tpiombo.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tpiombo, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tpiombo
           IF NOT Valid-STATUS-tpiombo
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tpiombo, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tmarche.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tmarche, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tmarche
           IF NOT Valid-STATUS-tmarche
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tmarche, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-rpromo.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:rpromo, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT rpromo
           IF NOT Valid-STATUS-rpromo
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:rpromo, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tpromo.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tpromo, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O tpromo
           IF STATUS-tpromo = "35"
              OPEN OUTPUT tpromo
                IF Valid-STATUS-tpromo
                   CLOSE tpromo
                   OPEN I-O tpromo
                END-IF
           END-IF
           IF NOT Valid-STATUS-tpromo
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tpromo, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tmp-promo-prz.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tmp-promo-prz, BeforeOpen>
      * <TOTEM:END>
           OPEN  OUTPUT tmp-promo-prz
           IF NOT Valid-STATUS-tmp-promo-prz
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tmp-promo-prz, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-listini.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:listini, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT listini
           IF NOT Valid-STATUS-listini
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:listini, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-locali.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:locali, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT locali
           IF NOT Valid-STATUS-locali
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:locali, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-blister.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:blister, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT blister
           IF NOT Valid-STATUS-blister
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:blister, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-cli-prg.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:cli-prg, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT cli-prg
           IF NOT Valid-STATUS-cli-prg
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:cli-prg, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tcodpag.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tcodpag, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tcodpag
           IF NOT Valid-status-tcodpag
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tcodpag, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tmp-progmag-zoom.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tmp-progmag-zoom, BeforeOpen>
      * <TOTEM:END>
           OPEN  OUTPUT tmp-progmag-zoom
           IF NOT Valid-STATUS-tmp-progmag-zoom
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tmp-progmag-zoom, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-timballi.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:timballi, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT timballi
           IF NOT Valid-STATUS-timballi
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:timballi, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tcontat.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tcontat, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tcontat
           IF NOT Valid-STATUS-tcontat
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tcontat, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-lockfile.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:lockfile, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O lockfile
           IF STATUS-lockfile = "35"
              OPEN OUTPUT lockfile
                IF Valid-STATUS-lockfile
                   CLOSE lockfile
                   OPEN I-O lockfile
                END-IF
           END-IF
           IF NOT Valid-STATUS-lockfile
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:lockfile, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tnazioni.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tnazioni, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tnazioni
           IF NOT Valid-STATUS-tnazioni
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tnazioni, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tscorte.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tscorte, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tscorte
           IF NOT Valid-STATUS-tscorte
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tscorte, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tmp-fido.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tmp-fido, BeforeOpen>
      * <TOTEM:END>
           OPEN  OUTPUT tmp-fido
           IF NOT Valid-STATUS-tmp-fido
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tmp-fido, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-grade.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:grade, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT grade
           IF NOT Valid-STATUS-grade
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:grade, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-log-macrobatch.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:log-macrobatch, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT log-macrobatch
           IF NOT Valid-STATUS-log-macrobatch
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:log-macrobatch, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-macrobatch.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:macrobatch, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O macrobatch
           IF STATUS-macrobatch = "35"
              OPEN OUTPUT macrobatch
                IF Valid-STATUS-macrobatch
                   CLOSE macrobatch
                   OPEN I-O macrobatch
                END-IF
           END-IF
           IF NOT Valid-STATUS-macrobatch
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:macrobatch, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tprov.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tprov, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tprov
           IF NOT Valid-STATUS-tprov
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tprov, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-EDI-clides.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:EDI-clides, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O EDI-clides
           IF STATUS-EDI-clides = "35"
              OPEN OUTPUT EDI-clides
                IF Valid-STATUS-EDI-clides
                   CLOSE EDI-clides
                   OPEN I-O EDI-clides
                END-IF
           END-IF
           IF NOT Valid-STATUS-EDI-clides
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:EDI-clides, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-anacap.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:anacap, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT anacap
           IF NOT Valid-STATUS-anacap
              PERFORM  Form-ini-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:EDI-selordini, FD:anacap, AfterOpen>
      * <TOTEM:END>
           .

       CLOSE-FILE-RTN.
      *    Before Close
           PERFORM CLOSE-clienti
           PERFORM CLOSE-destini
           PERFORM CLOSE-EDI-mtordini
           PERFORM CLOSE-agenti
           PERFORM CLOSE-tivaese
           PERFORM CLOSE-ttipocli
           PERFORM CLOSE-tvettori
           PERFORM CLOSE-pagbloc
           PERFORM CLOSE-tcaumag
           PERFORM CLOSE-tmagaz
           PERFORM CLOSE-note
           PERFORM CLOSE-param
           PERFORM CLOSE-recapiti
           PERFORM CLOSE-EDI-mrordini
           PERFORM CLOSE-articoli
           PERFORM CLOSE-progmag
           PERFORM CLOSE-sitfin
           PERFORM CLOSE-tparamge
           PERFORM CLOSE-mrordini
           PERFORM CLOSE-mtordini
           PERFORM CLOSE-timbalqta
           PERFORM CLOSE-timposte
           PERFORM CLOSE-tpiombo
           PERFORM CLOSE-tmarche
           PERFORM CLOSE-rpromo
           PERFORM CLOSE-tpromo
      *    tmp-promo-prz CLOSE MODE IS FALSE
      *    PERFORM CLOSE-tmp-promo-prz
           PERFORM CLOSE-listini
           PERFORM CLOSE-locali
           PERFORM CLOSE-blister
           PERFORM CLOSE-cli-prg
           PERFORM CLOSE-tcodpag
      *    tmp-progmag-zoom CLOSE MODE IS FALSE
      *    PERFORM CLOSE-tmp-progmag-zoom
           PERFORM CLOSE-timballi
           PERFORM CLOSE-tcontat
           PERFORM CLOSE-lockfile
           PERFORM CLOSE-tnazioni
           PERFORM CLOSE-tscorte
      *    tmp-fido CLOSE MODE IS FALSE
      *    PERFORM CLOSE-tmp-fido
           PERFORM CLOSE-grade
      *    log-macrobatch CLOSE MODE IS FALSE
      *    PERFORM CLOSE-log-macrobatch
      *    macrobatch CLOSE MODE IS FALSE
      *    PERFORM CLOSE-macrobatch
           PERFORM CLOSE-tprov
           PERFORM CLOSE-EDI-clides
           PERFORM CLOSE-anacap
      *    After Close
           .

       CLOSE-clienti.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:clienti, BeforeClose>
      * <TOTEM:END>
           CLOSE clienti
           .

       CLOSE-destini.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:destini, BeforeClose>
      * <TOTEM:END>
           CLOSE destini
           .

       CLOSE-EDI-mtordini.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:EDI-mtordini, BeforeClose>
      * <TOTEM:END>
           CLOSE EDI-mtordini
           .

       CLOSE-agenti.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:agenti, BeforeClose>
      * <TOTEM:END>
           CLOSE agenti
           .

       CLOSE-tivaese.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tivaese, BeforeClose>
      * <TOTEM:END>
           CLOSE tivaese
           .

       CLOSE-ttipocli.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:ttipocli, BeforeClose>
      * <TOTEM:END>
           CLOSE ttipocli
           .

       CLOSE-tvettori.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tvettori, BeforeClose>
      * <TOTEM:END>
           CLOSE tvettori
           .

       CLOSE-pagbloc.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:pagbloc, BeforeClose>
      * <TOTEM:END>
           CLOSE pagbloc
           .

       CLOSE-tcaumag.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tcaumag, BeforeClose>
      * <TOTEM:END>
           CLOSE tcaumag
           .

       CLOSE-tmagaz.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tmagaz, BeforeClose>
      * <TOTEM:END>
           CLOSE tmagaz
           .

       CLOSE-note.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:note, BeforeClose>
      * <TOTEM:END>
           CLOSE note
           .

       CLOSE-param.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:param, BeforeClose>
      * <TOTEM:END>
           CLOSE param
           .

       CLOSE-recapiti.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:recapiti, BeforeClose>
      * <TOTEM:END>
           CLOSE recapiti
           .

       CLOSE-EDI-mrordini.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:EDI-mrordini, BeforeClose>
      * <TOTEM:END>
           CLOSE EDI-mrordini
           .

       CLOSE-articoli.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:articoli, BeforeClose>
      * <TOTEM:END>
           CLOSE articoli
           .

       CLOSE-progmag.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:progmag, BeforeClose>
      * <TOTEM:END>
           CLOSE progmag
           .

       CLOSE-sitfin.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:sitfin, BeforeClose>
      * <TOTEM:END>
           CLOSE sitfin
           .

       CLOSE-tparamge.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tparamge, BeforeClose>
      * <TOTEM:END>
           CLOSE tparamge
           .

       CLOSE-mrordini.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:mrordini, BeforeClose>
      * <TOTEM:END>
           CLOSE mrordini
           .

       CLOSE-mtordini.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:mtordini, BeforeClose>
      * <TOTEM:END>
           CLOSE mtordini
           .

       CLOSE-timbalqta.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:timbalqta, BeforeClose>
      * <TOTEM:END>
           CLOSE timbalqta
           .

       CLOSE-timposte.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:timposte, BeforeClose>
      * <TOTEM:END>
           CLOSE timposte
           .

       CLOSE-tpiombo.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tpiombo, BeforeClose>
      * <TOTEM:END>
           CLOSE tpiombo
           .

       CLOSE-tmarche.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tmarche, BeforeClose>
      * <TOTEM:END>
           CLOSE tmarche
           .

       CLOSE-rpromo.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:rpromo, BeforeClose>
      * <TOTEM:END>
           CLOSE rpromo
           .

       CLOSE-tpromo.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tpromo, BeforeClose>
      * <TOTEM:END>
           CLOSE tpromo
           .

       CLOSE-tmp-promo-prz.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tmp-promo-prz, BeforeClose>
      * <TOTEM:END>
           .

       CLOSE-listini.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:listini, BeforeClose>
      * <TOTEM:END>
           CLOSE listini
           .

       CLOSE-locali.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:locali, BeforeClose>
      * <TOTEM:END>
           CLOSE locali
           .

       CLOSE-blister.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:blister, BeforeClose>
      * <TOTEM:END>
           CLOSE blister
           .

       CLOSE-cli-prg.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:cli-prg, BeforeClose>
      * <TOTEM:END>
           CLOSE cli-prg
           .

       CLOSE-tcodpag.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tcodpag, BeforeClose>
      * <TOTEM:END>
           CLOSE tcodpag
           .

       CLOSE-tmp-progmag-zoom.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tmp-progmag-zoom, BeforeClose>
      * <TOTEM:END>
           .

       CLOSE-timballi.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:timballi, BeforeClose>
      * <TOTEM:END>
           CLOSE timballi
           .

       CLOSE-tcontat.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tcontat, BeforeClose>
      * <TOTEM:END>
           CLOSE tcontat
           .

       CLOSE-lockfile.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:lockfile, BeforeClose>
      * <TOTEM:END>
           CLOSE lockfile
           .

       CLOSE-tnazioni.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tnazioni, BeforeClose>
      * <TOTEM:END>
           CLOSE tnazioni
           .

       CLOSE-tscorte.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tscorte, BeforeClose>
      * <TOTEM:END>
           CLOSE tscorte
           .

       CLOSE-tmp-fido.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tmp-fido, BeforeClose>
      * <TOTEM:END>
           .

       CLOSE-grade.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:grade, BeforeClose>
      * <TOTEM:END>
           CLOSE grade
           .

       CLOSE-log-macrobatch.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:log-macrobatch, BeforeClose>
      * <TOTEM:END>
           .

       CLOSE-macrobatch.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:macrobatch, BeforeClose>
      * <TOTEM:END>
           .

       CLOSE-tprov.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:tprov, BeforeClose>
      * <TOTEM:END>
           CLOSE tprov
           .

       CLOSE-EDI-clides.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:EDI-clides, BeforeClose>
      * <TOTEM:END>
           CLOSE EDI-clides
           .

       CLOSE-anacap.
      * <TOTEM:EPT. INIT:EDI-selordini, FD:anacap, BeforeClose>
      * <TOTEM:END>
           CLOSE anacap
           .

       clienti-cli-K1-MERGE-SPLITBUF.
           INITIALIZE clienti-cli-K1-SPLITBUF
           MOVE cli-tipo-CF OF clienti(1:1) TO 
           clienti-cli-K1-SPLITBUF(1:1)
           MOVE cli-ragsoc-1 OF clienti(1:40) TO 
           clienti-cli-K1-SPLITBUF(2:40)
           MOVE cli-codice OF clienti(1:5) TO 
           clienti-cli-K1-SPLITBUF(42:5)
           .

       clienti-cli-K3-MERGE-SPLITBUF.
           INITIALIZE clienti-cli-K3-SPLITBUF
           MOVE cli-gdo OF clienti(1:5) TO clienti-cli-K3-SPLITBUF(1:5)
           MOVE cli-chiave OF clienti(1:6) TO 
           clienti-cli-K3-SPLITBUF(6:6)
           .

       clienti-cli-K4-MERGE-SPLITBUF.
           INITIALIZE clienti-cli-K4-SPLITBUF
           MOVE cli-utf OF clienti(1:1) TO clienti-cli-K4-SPLITBUF(1:1)
           MOVE cli-chiave OF clienti(1:6) TO 
           clienti-cli-K4-SPLITBUF(2:6)
           .

       DataSet1-clienti-INITSTART.
           IF DataSet1-clienti-KEY-Asc
              MOVE Low-Value TO cli-chiave OF clienti
           ELSE
              MOVE High-Value TO cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-INITEND.
           IF DataSet1-clienti-KEY-Asc
              MOVE High-Value TO cli-chiave OF clienti
           ELSE
              MOVE Low-Value TO cli-chiave OF clienti
           END-IF
           .

      * clienti
       DataSet1-clienti-START.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY >= cli-chiave OF clienti
           ELSE
              START clienti KEY <= cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-START-NOTGREATER.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY <= cli-chiave OF clienti
           ELSE
              START clienti KEY >= cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-START-GREATER.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY > cli-chiave OF clienti
           ELSE
              START clienti KEY < cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-START-LESS.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY < cli-chiave OF clienti
           ELSE
              START clienti KEY > cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-clienti-LOCK
              READ clienti WITH LOCK 
              KEY cli-chiave OF clienti
           ELSE
              READ clienti WITH NO LOCK 
              KEY cli-chiave OF clienti
           END-IF
           PERFORM clienti-cli-K1-MERGE-SPLITBUF
           PERFORM clienti-cli-K3-MERGE-SPLITBUF
           PERFORM clienti-cli-K4-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT 
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-clienti-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-clienti-KEY-Asc
              IF DataSet1-clienti-LOCK
                 READ clienti NEXT WITH LOCK
              ELSE
                 READ clienti NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-clienti-LOCK
                 READ clienti PREVIOUS WITH LOCK
              ELSE
                 READ clienti PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM clienti-cli-K1-MERGE-SPLITBUF
           PERFORM clienti-cli-K3-MERGE-SPLITBUF
           PERFORM clienti-cli-K4-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-clienti-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-clienti-KEY-Asc
              IF DataSet1-clienti-LOCK
                 READ clienti PREVIOUS WITH LOCK
              ELSE
                 READ clienti PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-clienti-LOCK
                 READ clienti NEXT WITH LOCK
              ELSE
                 READ clienti NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM clienti-cli-K1-MERGE-SPLITBUF
           PERFORM clienti-cli-K3-MERGE-SPLITBUF
           PERFORM clienti-cli-K4-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterDelete>
      * <TOTEM:END>
           .

       destini-K1-MERGE-SPLITBUF.
           INITIALIZE destini-K1-SPLITBUF
           MOVE des-ragsoc-1(1:100) TO destini-K1-SPLITBUF(1:100)
           MOVE des-codice(1:5) TO destini-K1-SPLITBUF(101:5)
           MOVE des-prog(1:5) TO destini-K1-SPLITBUF(106:5)
           .

       destini-k-localita-MERGE-SPLITBUF.
           INITIALIZE destini-k-localita-SPLITBUF
           MOVE des-localita(1:35) TO destini-k-localita-SPLITBUF(1:35)
           .

       DataSet1-destini-INITSTART.
           IF DataSet1-destini-KEY-Asc
              MOVE Low-Value TO des-chiave
           ELSE
              MOVE High-Value TO des-chiave
           END-IF
           .

       DataSet1-destini-INITEND.
           IF DataSet1-destini-KEY-Asc
              MOVE High-Value TO des-chiave
           ELSE
              MOVE Low-Value TO des-chiave
           END-IF
           .

      * destini
       DataSet1-destini-START.
           IF DataSet1-destini-KEY-Asc
              START destini KEY >= des-chiave
           ELSE
              START destini KEY <= des-chiave
           END-IF
           .

       DataSet1-destini-START-NOTGREATER.
           IF DataSet1-destini-KEY-Asc
              START destini KEY <= des-chiave
           ELSE
              START destini KEY >= des-chiave
           END-IF
           .

       DataSet1-destini-START-GREATER.
           IF DataSet1-destini-KEY-Asc
              START destini KEY > des-chiave
           ELSE
              START destini KEY < des-chiave
           END-IF
           .

       DataSet1-destini-START-LESS.
           IF DataSet1-destini-KEY-Asc
              START destini KEY < des-chiave
           ELSE
              START destini KEY > des-chiave
           END-IF
           .

       DataSet1-destini-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-destini-LOCK
              READ destini WITH LOCK 
              KEY des-chiave
           ELSE
              READ destini WITH NO LOCK 
              KEY des-chiave
           END-IF
           PERFORM destini-K1-MERGE-SPLITBUF
           PERFORM destini-k-localita-MERGE-SPLITBUF
           MOVE STATUS-destini TO TOTEM-ERR-STAT 
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-destini-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-destini-KEY-Asc
              IF DataSet1-destini-LOCK
                 READ destini NEXT WITH LOCK
              ELSE
                 READ destini NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-destini-LOCK
                 READ destini PREVIOUS WITH LOCK
              ELSE
                 READ destini PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM destini-K1-MERGE-SPLITBUF
           PERFORM destini-k-localita-MERGE-SPLITBUF
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-destini-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-destini-KEY-Asc
              IF DataSet1-destini-LOCK
                 READ destini PREVIOUS WITH LOCK
              ELSE
                 READ destini PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-destini-LOCK
                 READ destini NEXT WITH LOCK
              ELSE
                 READ destini NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM destini-K1-MERGE-SPLITBUF
           PERFORM destini-k-localita-MERGE-SPLITBUF
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-destini-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeWrite>
      * <TOTEM:END>
           WRITE des-rec OF destini.
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-destini-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeRewrite>
      * <TOTEM:END>
           REWRITE des-rec OF destini.
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-destini-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeDelete>
      * <TOTEM:END>
           DELETE destini.
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterDelete>
      * <TOTEM:END>
           .

       EDI-mtordini-emto-k-ord-cli-MERGE-SPLITBUF.
           INITIALIZE EDI-mtordini-emto-k-ord-cli-SPLITBUF
           MOVE emto-anno(1:4) TO 
           EDI-mtordini-emto-k-ord-cli-SPLITBUF(1:4)
           MOVE emto-num-ord-cli(1:50) TO 
           EDI-mtordini-emto-k-ord-cli-SPLITBUF(5:50)
           .

       EDI-mtordini-k-emto-stato-MERGE-SPLITBUF.
           INITIALIZE EDI-mtordini-k-emto-stato-SPLITBUF
           MOVE emto-stato(1:1) TO 
           EDI-mtordini-k-emto-stato-SPLITBUF(1:1)
           MOVE emto-chiave(1:12) TO 
           EDI-mtordini-k-emto-stato-SPLITBUF(2:12)
           .

       EDI-mtordini-k-emto-data-MERGE-SPLITBUF.
           INITIALIZE EDI-mtordini-k-emto-data-SPLITBUF
           MOVE emto-data-ordine(1:8) TO 
           EDI-mtordini-k-emto-data-SPLITBUF(1:8)
           MOVE emto-chiave(1:12) TO 
           EDI-mtordini-k-emto-data-SPLITBUF(9:12)
           .

       EDI-mtordini-k-emto-clides-MERGE-SPLITBUF.
           INITIALIZE EDI-mtordini-k-emto-clides-SPLITBUF
           MOVE emto-cod-cli(1:5) TO 
           EDI-mtordini-k-emto-clides-SPLITBUF(1:5)
           MOVE emto-prg-destino(1:5) TO 
           EDI-mtordini-k-emto-clides-SPLITBUF(6:5)
           MOVE emto-chiave(1:12) TO 
           EDI-mtordini-k-emto-clides-SPLITBUF(11:12)
           .

       DataSet1-EDI-mtordini-INITSTART.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-EDI-mtordini-KEY1-Asc
                 MOVE Low-Value TO emto-stato
              ELSE
                 MOVE High-Value TO emto-stato
              END-IF
              IF DataSet1-EDI-mtordini-KEY1-Asc
                 MOVE Low-Value TO emto-chiave
              ELSE
                 MOVE High-Value TO emto-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-EDI-mtordini-INITEND.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-EDI-mtordini-KEY1-Asc
                 MOVE High-Value to emto-stato
              ELSE          
                 MOVE Low-Value to emto-stato
              END-IF
              IF DataSet1-EDI-mtordini-KEY1-Asc
                 MOVE High-Value to emto-chiave
              ELSE          
                 MOVE Low-Value to emto-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-EDI-mtordini-TMPBUF-TO-FLD.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE DataSet1-EDI-mtordini-SPLIT-BUF1(1:1) TO
                   emto-stato(1:1)
              MOVE DataSet1-EDI-mtordini-SPLIT-BUF1(2:12) TO
                   emto-chiave(1:12)
           END-EVALUATE
           .

       DataSet1-EDI-mtordini-FLD-TO-TMPBUF.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE emto-stato(1:1) TO
                   DataSet1-EDI-mtordini-SPLIT-BUF1(1:1)
              MOVE emto-chiave(1:12) TO
                   DataSet1-EDI-mtordini-SPLIT-BUF1(2:12)
           END-EVALUATE
           .

       DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           .   

       DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-EDI-mtordini-KEY1-ORDER
           END-EVALUATE
           .

       DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-EDI-mtordini-KEY1-ORDER
           END-EVALUATE
           .

      * EDI-mtordini
       DataSet1-EDI-mtordini-START.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-EDI-mtordini-KEY1-Asc
                 START EDI-mtordini KEY >= k-emto-stato
              ELSE
                 START EDI-mtordini KEY <= k-emto-stato
              END-IF
           END-EVALUATE
           .

       DataSet1-EDI-mtordini-START-NOTGREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-EDI-mtordini-KEY1-Asc
                 START EDI-mtordini KEY <= k-emto-stato
              ELSE
                 START EDI-mtordini KEY >= k-emto-stato
              END-IF
           END-EVALUATE
           .

       DataSet1-EDI-mtordini-START-GREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-EDI-mtordini-KEY1-Asc
                 START EDI-mtordini KEY > k-emto-stato
              ELSE
                 START EDI-mtordini KEY < k-emto-stato
              END-IF
           END-EVALUATE
           .

       DataSet1-EDI-mtordini-START-LESS.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-EDI-mtordini-KEY1-Asc
                 START EDI-mtordini KEY < k-emto-stato
              ELSE
                 START EDI-mtordini KEY > k-emto-stato
              END-IF
           END-EVALUATE
           .

       DataSet1-EDI-mtordini-START-EQUAL.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              START EDI-mtordini KEY = k-emto-stato
           END-EVALUATE
           .

       DataSet1-EDI-mtordini-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-mtordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-mtordini, BeforeReadRecord>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-EDI-mtordini-LOCK
                 READ EDI-mtordini WITH LOCK 
                 KEY k-emto-stato
              ELSE
                 READ EDI-mtordini WITH NO LOCK 
                 KEY k-emto-stato
              END-IF
           END-EVALUATE
           PERFORM EDI-mtordini-emto-k-ord-cli-MERGE-SPLITBUF
           PERFORM EDI-mtordini-k-emto-stato-MERGE-SPLITBUF
           PERFORM EDI-mtordini-k-emto-data-MERGE-SPLITBUF
           PERFORM EDI-mtordini-k-emto-clides-MERGE-SPLITBUF
           MOVE STATUS-EDI-mtordini TO TOTEM-ERR-STAT 
           MOVE "EDI-mtordini" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-mtordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-mtordini, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-EDI-mtordini-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-mtordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-mtordini, BeforeReadNext>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-EDI-mtordini-KEY1-Asc
                 IF DataSet1-EDI-mtordini-LOCK
                    READ EDI-mtordini NEXT WITH LOCK
                 ELSE
                    READ EDI-mtordini NEXT WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-EDI-mtordini-LOCK
                    READ EDI-mtordini PREVIOUS WITH LOCK
                 ELSE
                    READ EDI-mtordini PREVIOUS WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           PERFORM EDI-mtordini-emto-k-ord-cli-MERGE-SPLITBUF
           PERFORM EDI-mtordini-k-emto-stato-MERGE-SPLITBUF
           PERFORM EDI-mtordini-k-emto-data-MERGE-SPLITBUF
           PERFORM EDI-mtordini-k-emto-clides-MERGE-SPLITBUF
           MOVE STATUS-EDI-mtordini TO TOTEM-ERR-STAT
           MOVE "EDI-mtordini" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-mtordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-mtordini, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-EDI-mtordini-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-mtordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-mtordini, BeforeReadPrev>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-EDI-mtordini-KEY1-Asc
                 IF DataSet1-EDI-mtordini-LOCK
                    READ EDI-mtordini PREVIOUS WITH LOCK
                 ELSE
                    READ EDI-mtordini PREVIOUS WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-EDI-mtordini-LOCK
                    READ EDI-mtordini NEXT WITH LOCK
                 ELSE
                    READ EDI-mtordini NEXT WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           PERFORM EDI-mtordini-emto-k-ord-cli-MERGE-SPLITBUF
           PERFORM EDI-mtordini-k-emto-stato-MERGE-SPLITBUF
           PERFORM EDI-mtordini-k-emto-data-MERGE-SPLITBUF
           PERFORM EDI-mtordini-k-emto-clides-MERGE-SPLITBUF
           MOVE STATUS-EDI-mtordini TO TOTEM-ERR-STAT
           MOVE "EDI-mtordini" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-mtordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-mtordini, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-EDI-mtordini-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-mtordini, BeforeWrite>
      * <TOTEM:END>
           WRITE emto-rec OF EDI-mtordini.
           MOVE STATUS-EDI-mtordini TO TOTEM-ERR-STAT
           MOVE "EDI-mtordini" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-mtordini, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-EDI-mtordini-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-mtordini, BeforeRewrite>
      * <TOTEM:END>
           REWRITE emto-rec OF EDI-mtordini.
           MOVE STATUS-EDI-mtordini TO TOTEM-ERR-STAT
           MOVE "EDI-mtordini" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-mtordini, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-EDI-mtordini-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-mtordini, BeforeDelete>
      * <TOTEM:END>
           DELETE EDI-mtordini.
           MOVE STATUS-EDI-mtordini TO TOTEM-ERR-STAT
           MOVE "EDI-mtordini" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-mtordini, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-agenti-INITSTART.
           IF DataSet1-agenti-KEY-Asc
              MOVE Low-Value TO age-chiave
           ELSE
              MOVE High-Value TO age-chiave
           END-IF
           .

       DataSet1-agenti-INITEND.
           IF DataSet1-agenti-KEY-Asc
              MOVE High-Value TO age-chiave
           ELSE
              MOVE Low-Value TO age-chiave
           END-IF
           .

      * agenti
       DataSet1-agenti-START.
           IF DataSet1-agenti-KEY-Asc
              START agenti KEY >= age-chiave
           ELSE
              START agenti KEY <= age-chiave
           END-IF
           .

       DataSet1-agenti-START-NOTGREATER.
           IF DataSet1-agenti-KEY-Asc
              START agenti KEY <= age-chiave
           ELSE
              START agenti KEY >= age-chiave
           END-IF
           .

       DataSet1-agenti-START-GREATER.
           IF DataSet1-agenti-KEY-Asc
              START agenti KEY > age-chiave
           ELSE
              START agenti KEY < age-chiave
           END-IF
           .

       DataSet1-agenti-START-LESS.
           IF DataSet1-agenti-KEY-Asc
              START agenti KEY < age-chiave
           ELSE
              START agenti KEY > age-chiave
           END-IF
           .

       DataSet1-agenti-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-agenti-LOCK
              READ agenti WITH LOCK 
              KEY age-chiave
           ELSE
              READ agenti WITH NO LOCK 
              KEY age-chiave
           END-IF
           MOVE STATUS-agenti TO TOTEM-ERR-STAT 
           MOVE "agenti" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-agenti-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-agenti-KEY-Asc
              IF DataSet1-agenti-LOCK
                 READ agenti NEXT WITH LOCK
              ELSE
                 READ agenti NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-agenti-LOCK
                 READ agenti PREVIOUS WITH LOCK
              ELSE
                 READ agenti PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-agenti TO TOTEM-ERR-STAT
           MOVE "agenti" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-agenti-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-agenti-KEY-Asc
              IF DataSet1-agenti-LOCK
                 READ agenti PREVIOUS WITH LOCK
              ELSE
                 READ agenti PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-agenti-LOCK
                 READ agenti NEXT WITH LOCK
              ELSE
                 READ agenti NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-agenti TO TOTEM-ERR-STAT
           MOVE "agenti" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-agenti-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-agenti TO TOTEM-ERR-STAT
           MOVE "agenti" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-agenti-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-agenti TO TOTEM-ERR-STAT
           MOVE "agenti" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-agenti-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-agenti TO TOTEM-ERR-STAT
           MOVE "agenti" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, AfterDelete>
      * <TOTEM:END>
           .

       tivaese-key01-MERGE-SPLITBUF.
           INITIALIZE tivaese-key01-SPLITBUF
           MOVE TBLIV-CODICE1(1:2) TO tivaese-key01-SPLITBUF(1:2)
           MOVE TBLIV-DESCRIZIONE1(1:30) TO tivaese-key01-SPLITBUF(3:30)
           MOVE TBLIV-CODICE2(1:20) TO tivaese-key01-SPLITBUF(33:20)
           .

       DataSet1-tivaese-INITSTART.
           IF DataSet1-tivaese-KEY-Asc
              MOVE Low-Value TO TBLIV-CODICE
           ELSE
              MOVE High-Value TO TBLIV-CODICE
           END-IF
           .

       DataSet1-tivaese-INITEND.
           IF DataSet1-tivaese-KEY-Asc
              MOVE High-Value TO TBLIV-CODICE
           ELSE
              MOVE Low-Value TO TBLIV-CODICE
           END-IF
           .

      * tivaese
       DataSet1-tivaese-START.
           IF DataSet1-tivaese-KEY-Asc
              START tivaese KEY >= TBLIV-CODICE
           ELSE
              START tivaese KEY <= TBLIV-CODICE
           END-IF
           .

       DataSet1-tivaese-START-NOTGREATER.
           IF DataSet1-tivaese-KEY-Asc
              START tivaese KEY <= TBLIV-CODICE
           ELSE
              START tivaese KEY >= TBLIV-CODICE
           END-IF
           .

       DataSet1-tivaese-START-GREATER.
           IF DataSet1-tivaese-KEY-Asc
              START tivaese KEY > TBLIV-CODICE
           ELSE
              START tivaese KEY < TBLIV-CODICE
           END-IF
           .

       DataSet1-tivaese-START-LESS.
           IF DataSet1-tivaese-KEY-Asc
              START tivaese KEY < TBLIV-CODICE
           ELSE
              START tivaese KEY > TBLIV-CODICE
           END-IF
           .

       DataSet1-tivaese-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tivaese-LOCK
              READ tivaese WITH LOCK 
              KEY TBLIV-CODICE
           ELSE
              READ tivaese WITH NO LOCK 
              KEY TBLIV-CODICE
           END-IF
           PERFORM tivaese-key01-MERGE-SPLITBUF
           MOVE STATUS-tivaese TO TOTEM-ERR-STAT 
           MOVE "tivaese" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tivaese-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tivaese-KEY-Asc
              IF DataSet1-tivaese-LOCK
                 READ tivaese NEXT WITH LOCK
              ELSE
                 READ tivaese NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tivaese-LOCK
                 READ tivaese PREVIOUS WITH LOCK
              ELSE
                 READ tivaese PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tivaese-key01-MERGE-SPLITBUF
           MOVE STATUS-tivaese TO TOTEM-ERR-STAT
           MOVE "tivaese" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tivaese-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tivaese-KEY-Asc
              IF DataSet1-tivaese-LOCK
                 READ tivaese PREVIOUS WITH LOCK
              ELSE
                 READ tivaese PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tivaese-LOCK
                 READ tivaese NEXT WITH LOCK
              ELSE
                 READ tivaese NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tivaese-key01-MERGE-SPLITBUF
           MOVE STATUS-tivaese TO TOTEM-ERR-STAT
           MOVE "tivaese" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tivaese-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tivaese TO TOTEM-ERR-STAT
           MOVE "tivaese" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tivaese-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tivaese TO TOTEM-ERR-STAT
           MOVE "tivaese" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tivaese-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tivaese TO TOTEM-ERR-STAT
           MOVE "tivaese" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-ttipocli-INITSTART.
           IF DataSet1-ttipocli-KEY-Asc
              MOVE Low-Value TO tcl-chiave
           ELSE
              MOVE High-Value TO tcl-chiave
           END-IF
           .

       DataSet1-ttipocli-INITEND.
           IF DataSet1-ttipocli-KEY-Asc
              MOVE High-Value TO tcl-chiave
           ELSE
              MOVE Low-Value TO tcl-chiave
           END-IF
           .

      * ttipocli
       DataSet1-ttipocli-START.
           IF DataSet1-ttipocli-KEY-Asc
              START ttipocli KEY >= tcl-chiave
           ELSE
              START ttipocli KEY <= tcl-chiave
           END-IF
           .

       DataSet1-ttipocli-START-NOTGREATER.
           IF DataSet1-ttipocli-KEY-Asc
              START ttipocli KEY <= tcl-chiave
           ELSE
              START ttipocli KEY >= tcl-chiave
           END-IF
           .

       DataSet1-ttipocli-START-GREATER.
           IF DataSet1-ttipocli-KEY-Asc
              START ttipocli KEY > tcl-chiave
           ELSE
              START ttipocli KEY < tcl-chiave
           END-IF
           .

       DataSet1-ttipocli-START-LESS.
           IF DataSet1-ttipocli-KEY-Asc
              START ttipocli KEY < tcl-chiave
           ELSE
              START ttipocli KEY > tcl-chiave
           END-IF
           .

       DataSet1-ttipocli-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-ttipocli-LOCK
              READ ttipocli WITH LOCK 
              KEY tcl-chiave
           ELSE
              READ ttipocli WITH NO LOCK 
              KEY tcl-chiave
           END-IF
           MOVE STATUS-ttipocli TO TOTEM-ERR-STAT 
           MOVE "ttipocli" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-ttipocli-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-ttipocli-KEY-Asc
              IF DataSet1-ttipocli-LOCK
                 READ ttipocli NEXT WITH LOCK
              ELSE
                 READ ttipocli NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-ttipocli-LOCK
                 READ ttipocli PREVIOUS WITH LOCK
              ELSE
                 READ ttipocli PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-ttipocli TO TOTEM-ERR-STAT
           MOVE "ttipocli" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-ttipocli-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-ttipocli-KEY-Asc
              IF DataSet1-ttipocli-LOCK
                 READ ttipocli PREVIOUS WITH LOCK
              ELSE
                 READ ttipocli PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-ttipocli-LOCK
                 READ ttipocli NEXT WITH LOCK
              ELSE
                 READ ttipocli NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-ttipocli TO TOTEM-ERR-STAT
           MOVE "ttipocli" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-ttipocli-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-ttipocli TO TOTEM-ERR-STAT
           MOVE "ttipocli" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-ttipocli-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-ttipocli TO TOTEM-ERR-STAT
           MOVE "ttipocli" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-ttipocli-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-ttipocli TO TOTEM-ERR-STAT
           MOVE "ttipocli" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterDelete>
      * <TOTEM:END>
           .

       tvettori-k-des-MERGE-SPLITBUF.
           INITIALIZE tvettori-k-des-SPLITBUF
           MOVE vet-descrizione(1:40) TO tvettori-k-des-SPLITBUF(1:40)
           .

       DataSet1-tvettori-INITSTART.
           IF DataSet1-tvettori-KEY-Asc
              MOVE Low-Value TO vet-chiave
           ELSE
              MOVE High-Value TO vet-chiave
           END-IF
           .

       DataSet1-tvettori-INITEND.
           IF DataSet1-tvettori-KEY-Asc
              MOVE High-Value TO vet-chiave
           ELSE
              MOVE Low-Value TO vet-chiave
           END-IF
           .

      * tvettori
       DataSet1-tvettori-START.
           IF DataSet1-tvettori-KEY-Asc
              START tvettori KEY >= vet-chiave
           ELSE
              START tvettori KEY <= vet-chiave
           END-IF
           .

       DataSet1-tvettori-START-NOTGREATER.
           IF DataSet1-tvettori-KEY-Asc
              START tvettori KEY <= vet-chiave
           ELSE
              START tvettori KEY >= vet-chiave
           END-IF
           .

       DataSet1-tvettori-START-GREATER.
           IF DataSet1-tvettori-KEY-Asc
              START tvettori KEY > vet-chiave
           ELSE
              START tvettori KEY < vet-chiave
           END-IF
           .

       DataSet1-tvettori-START-LESS.
           IF DataSet1-tvettori-KEY-Asc
              START tvettori KEY < vet-chiave
           ELSE
              START tvettori KEY > vet-chiave
           END-IF
           .

       DataSet1-tvettori-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tvettori-LOCK
              READ tvettori WITH LOCK 
              KEY vet-chiave
           ELSE
              READ tvettori WITH NO LOCK 
              KEY vet-chiave
           END-IF
           PERFORM tvettori-k-des-MERGE-SPLITBUF
           MOVE STATUS-tvettori TO TOTEM-ERR-STAT 
           MOVE "tvettori" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tvettori-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tvettori-KEY-Asc
              IF DataSet1-tvettori-LOCK
                 READ tvettori NEXT WITH LOCK
              ELSE
                 READ tvettori NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tvettori-LOCK
                 READ tvettori PREVIOUS WITH LOCK
              ELSE
                 READ tvettori PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tvettori-k-des-MERGE-SPLITBUF
           MOVE STATUS-tvettori TO TOTEM-ERR-STAT
           MOVE "tvettori" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tvettori-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tvettori-KEY-Asc
              IF DataSet1-tvettori-LOCK
                 READ tvettori PREVIOUS WITH LOCK
              ELSE
                 READ tvettori PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tvettori-LOCK
                 READ tvettori NEXT WITH LOCK
              ELSE
                 READ tvettori NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tvettori-k-des-MERGE-SPLITBUF
           MOVE STATUS-tvettori TO TOTEM-ERR-STAT
           MOVE "tvettori" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tvettori-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tvettori TO TOTEM-ERR-STAT
           MOVE "tvettori" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tvettori-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tvettori TO TOTEM-ERR-STAT
           MOVE "tvettori" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tvettori-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tvettori TO TOTEM-ERR-STAT
           MOVE "tvettori" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-pagbloc-INITSTART.
           IF DataSet1-pagbloc-KEY-Asc
              MOVE Low-Value TO pgb-chiave
           ELSE
              MOVE High-Value TO pgb-chiave
           END-IF
           .

       DataSet1-pagbloc-INITEND.
           IF DataSet1-pagbloc-KEY-Asc
              MOVE High-Value TO pgb-chiave
           ELSE
              MOVE Low-Value TO pgb-chiave
           END-IF
           .

      * pagbloc
       DataSet1-pagbloc-START.
           IF DataSet1-pagbloc-KEY-Asc
              START pagbloc KEY >= pgb-chiave
           ELSE
              START pagbloc KEY <= pgb-chiave
           END-IF
           .

       DataSet1-pagbloc-START-NOTGREATER.
           IF DataSet1-pagbloc-KEY-Asc
              START pagbloc KEY <= pgb-chiave
           ELSE
              START pagbloc KEY >= pgb-chiave
           END-IF
           .

       DataSet1-pagbloc-START-GREATER.
           IF DataSet1-pagbloc-KEY-Asc
              START pagbloc KEY > pgb-chiave
           ELSE
              START pagbloc KEY < pgb-chiave
           END-IF
           .

       DataSet1-pagbloc-START-LESS.
           IF DataSet1-pagbloc-KEY-Asc
              START pagbloc KEY < pgb-chiave
           ELSE
              START pagbloc KEY > pgb-chiave
           END-IF
           .

       DataSet1-pagbloc-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:pagbloc, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:pagbloc, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-pagbloc-LOCK
              READ pagbloc WITH LOCK 
              KEY pgb-chiave
           ELSE
              READ pagbloc WITH NO LOCK 
              KEY pgb-chiave
           END-IF
           MOVE STATUS-pagbloc TO TOTEM-ERR-STAT 
           MOVE "pagbloc" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:pagbloc, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:pagbloc, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-pagbloc-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:pagbloc, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:pagbloc, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-pagbloc-KEY-Asc
              IF DataSet1-pagbloc-LOCK
                 READ pagbloc NEXT WITH LOCK
              ELSE
                 READ pagbloc NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-pagbloc-LOCK
                 READ pagbloc PREVIOUS WITH LOCK
              ELSE
                 READ pagbloc PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-pagbloc TO TOTEM-ERR-STAT
           MOVE "pagbloc" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:pagbloc, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:pagbloc, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-pagbloc-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:pagbloc, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:pagbloc, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-pagbloc-KEY-Asc
              IF DataSet1-pagbloc-LOCK
                 READ pagbloc PREVIOUS WITH LOCK
              ELSE
                 READ pagbloc PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-pagbloc-LOCK
                 READ pagbloc NEXT WITH LOCK
              ELSE
                 READ pagbloc NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-pagbloc TO TOTEM-ERR-STAT
           MOVE "pagbloc" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:pagbloc, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:pagbloc, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-pagbloc-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:pagbloc, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-pagbloc TO TOTEM-ERR-STAT
           MOVE "pagbloc" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:pagbloc, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-pagbloc-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:pagbloc, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-pagbloc TO TOTEM-ERR-STAT
           MOVE "pagbloc" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:pagbloc, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-pagbloc-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:pagbloc, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-pagbloc TO TOTEM-ERR-STAT
           MOVE "pagbloc" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:pagbloc, AfterDelete>
      * <TOTEM:END>
           .

       tcaumag-k-mag-MERGE-SPLITBUF.
           INITIALIZE tcaumag-k-mag-SPLITBUF
           MOVE tca-cod-magaz(1:3) TO tcaumag-k-mag-SPLITBUF(1:3)
           MOVE tca-ord-forn(1:1) TO tcaumag-k-mag-SPLITBUF(4:1)
           .

       DataSet1-tcaumag-INITSTART.
           IF DataSet1-tcaumag-KEY-Asc
              MOVE Low-Value TO tca-chiave
           ELSE
              MOVE High-Value TO tca-chiave
           END-IF
           .

       DataSet1-tcaumag-INITEND.
           IF DataSet1-tcaumag-KEY-Asc
              MOVE High-Value TO tca-chiave
           ELSE
              MOVE Low-Value TO tca-chiave
           END-IF
           .

      * tcaumag
       DataSet1-tcaumag-START.
           IF DataSet1-tcaumag-KEY-Asc
              START tcaumag KEY >= tca-chiave
           ELSE
              START tcaumag KEY <= tca-chiave
           END-IF
           .

       DataSet1-tcaumag-START-NOTGREATER.
           IF DataSet1-tcaumag-KEY-Asc
              START tcaumag KEY <= tca-chiave
           ELSE
              START tcaumag KEY >= tca-chiave
           END-IF
           .

       DataSet1-tcaumag-START-GREATER.
           IF DataSet1-tcaumag-KEY-Asc
              START tcaumag KEY > tca-chiave
           ELSE
              START tcaumag KEY < tca-chiave
           END-IF
           .

       DataSet1-tcaumag-START-LESS.
           IF DataSet1-tcaumag-KEY-Asc
              START tcaumag KEY < tca-chiave
           ELSE
              START tcaumag KEY > tca-chiave
           END-IF
           .

       DataSet1-tcaumag-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tcaumag-LOCK
              READ tcaumag WITH LOCK 
              KEY tca-chiave
           ELSE
              READ tcaumag WITH NO LOCK 
              KEY tca-chiave
           END-IF
           PERFORM tcaumag-k-mag-MERGE-SPLITBUF
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT 
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tcaumag-KEY-Asc
              IF DataSet1-tcaumag-LOCK
                 READ tcaumag NEXT WITH LOCK
              ELSE
                 READ tcaumag NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tcaumag-LOCK
                 READ tcaumag PREVIOUS WITH LOCK
              ELSE
                 READ tcaumag PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tcaumag-k-mag-MERGE-SPLITBUF
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tcaumag-KEY-Asc
              IF DataSet1-tcaumag-LOCK
                 READ tcaumag PREVIOUS WITH LOCK
              ELSE
                 READ tcaumag PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tcaumag-LOCK
                 READ tcaumag NEXT WITH LOCK
              ELSE
                 READ tcaumag NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tcaumag-k-mag-MERGE-SPLITBUF
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tmagaz-INITSTART.
           IF DataSet1-tmagaz-KEY-Asc
              MOVE Low-Value TO mag-chiave
           ELSE
              MOVE High-Value TO mag-chiave
           END-IF
           .

       DataSet1-tmagaz-INITEND.
           IF DataSet1-tmagaz-KEY-Asc
              MOVE High-Value TO mag-chiave
           ELSE
              MOVE Low-Value TO mag-chiave
           END-IF
           .

      * tmagaz
       DataSet1-tmagaz-START.
           IF DataSet1-tmagaz-KEY-Asc
              START tmagaz KEY >= mag-chiave
           ELSE
              START tmagaz KEY <= mag-chiave
           END-IF
           .

       DataSet1-tmagaz-START-NOTGREATER.
           IF DataSet1-tmagaz-KEY-Asc
              START tmagaz KEY <= mag-chiave
           ELSE
              START tmagaz KEY >= mag-chiave
           END-IF
           .

       DataSet1-tmagaz-START-GREATER.
           IF DataSet1-tmagaz-KEY-Asc
              START tmagaz KEY > mag-chiave
           ELSE
              START tmagaz KEY < mag-chiave
           END-IF
           .

       DataSet1-tmagaz-START-LESS.
           IF DataSet1-tmagaz-KEY-Asc
              START tmagaz KEY < mag-chiave
           ELSE
              START tmagaz KEY > mag-chiave
           END-IF
           .

       DataSet1-tmagaz-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tmagaz-LOCK
              READ tmagaz WITH LOCK 
              KEY mag-chiave
           ELSE
              READ tmagaz WITH NO LOCK 
              KEY mag-chiave
           END-IF
           MOVE STATUS-tmagaz TO TOTEM-ERR-STAT 
           MOVE "tmagaz" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tmagaz-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tmagaz-KEY-Asc
              IF DataSet1-tmagaz-LOCK
                 READ tmagaz NEXT WITH LOCK
              ELSE
                 READ tmagaz NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tmagaz-LOCK
                 READ tmagaz PREVIOUS WITH LOCK
              ELSE
                 READ tmagaz PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tmagaz TO TOTEM-ERR-STAT
           MOVE "tmagaz" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tmagaz-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tmagaz-KEY-Asc
              IF DataSet1-tmagaz-LOCK
                 READ tmagaz PREVIOUS WITH LOCK
              ELSE
                 READ tmagaz PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tmagaz-LOCK
                 READ tmagaz NEXT WITH LOCK
              ELSE
                 READ tmagaz NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tmagaz TO TOTEM-ERR-STAT
           MOVE "tmagaz" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tmagaz-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tmagaz TO TOTEM-ERR-STAT
           MOVE "tmagaz" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tmagaz-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tmagaz TO TOTEM-ERR-STAT
           MOVE "tmagaz" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tmagaz-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tmagaz TO TOTEM-ERR-STAT
           MOVE "tmagaz" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-note-INITSTART.
           IF DataSet1-note-KEY-Asc
              MOVE Low-Value TO not-chiave OF note
           ELSE
              MOVE High-Value TO not-chiave OF note
           END-IF
           .

       DataSet1-note-INITEND.
           IF DataSet1-note-KEY-Asc
              MOVE High-Value TO not-chiave OF note
           ELSE
              MOVE Low-Value TO not-chiave OF note
           END-IF
           .

      * note
       DataSet1-note-START.
           IF DataSet1-note-KEY-Asc
              START note KEY >= not-chiave OF note
           ELSE
              START note KEY <= not-chiave OF note
           END-IF
           .

       DataSet1-note-START-NOTGREATER.
           IF DataSet1-note-KEY-Asc
              START note KEY <= not-chiave OF note
           ELSE
              START note KEY >= not-chiave OF note
           END-IF
           .

       DataSet1-note-START-GREATER.
           IF DataSet1-note-KEY-Asc
              START note KEY > not-chiave OF note
           ELSE
              START note KEY < not-chiave OF note
           END-IF
           .

       DataSet1-note-START-LESS.
           IF DataSet1-note-KEY-Asc
              START note KEY < not-chiave OF note
           ELSE
              START note KEY > not-chiave OF note
           END-IF
           .

       DataSet1-note-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:note, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:note, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-note-LOCK
              READ note WITH LOCK 
              KEY not-chiave OF note
           ELSE
              READ note WITH NO LOCK 
              KEY not-chiave OF note
           END-IF
           MOVE STATUS-note TO TOTEM-ERR-STAT 
           MOVE "note" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:note, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:note, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-note-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:note, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:note, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-note-KEY-Asc
              IF DataSet1-note-LOCK
                 READ note NEXT WITH LOCK
              ELSE
                 READ note NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-note-LOCK
                 READ note PREVIOUS WITH LOCK
              ELSE
                 READ note PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-note TO TOTEM-ERR-STAT
           MOVE "note" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:note, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:note, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-note-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:note, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:note, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-note-KEY-Asc
              IF DataSet1-note-LOCK
                 READ note PREVIOUS WITH LOCK
              ELSE
                 READ note PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-note-LOCK
                 READ note NEXT WITH LOCK
              ELSE
                 READ note NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-note TO TOTEM-ERR-STAT
           MOVE "note" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:note, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:note, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-note-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:note, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-note TO TOTEM-ERR-STAT
           MOVE "note" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:note, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-note-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:note, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-note TO TOTEM-ERR-STAT
           MOVE "note" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:note, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-note-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:note, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-note TO TOTEM-ERR-STAT
           MOVE "note" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:note, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-param-INITSTART.
           IF DataSet1-param-KEY-Asc
              MOVE Low-Value TO prm-chiave OF param
           ELSE
              MOVE High-Value TO prm-chiave OF param
           END-IF
           .

       DataSet1-param-INITEND.
           IF DataSet1-param-KEY-Asc
              MOVE High-Value TO prm-chiave OF param
           ELSE
              MOVE Low-Value TO prm-chiave OF param
           END-IF
           .

      * param
       DataSet1-param-START.
           IF DataSet1-param-KEY-Asc
              START param KEY >= prm-chiave OF param
           ELSE
              START param KEY <= prm-chiave OF param
           END-IF
           .

       DataSet1-param-START-NOTGREATER.
           IF DataSet1-param-KEY-Asc
              START param KEY <= prm-chiave OF param
           ELSE
              START param KEY >= prm-chiave OF param
           END-IF
           .

       DataSet1-param-START-GREATER.
           IF DataSet1-param-KEY-Asc
              START param KEY > prm-chiave OF param
           ELSE
              START param KEY < prm-chiave OF param
           END-IF
           .

       DataSet1-param-START-LESS.
           IF DataSet1-param-KEY-Asc
              START param KEY < prm-chiave OF param
           ELSE
              START param KEY > prm-chiave OF param
           END-IF
           .

       DataSet1-param-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:param, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:param, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-param-LOCK
              READ param WITH LOCK 
              KEY prm-chiave OF param
           ELSE
              READ param WITH NO LOCK 
              KEY prm-chiave OF param
           END-IF
           MOVE STATUS-param TO TOTEM-ERR-STAT 
           MOVE "param" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:param, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:param, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-param-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:param, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:param, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-param-KEY-Asc
              IF DataSet1-param-LOCK
                 READ param NEXT WITH LOCK
              ELSE
                 READ param NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-param-LOCK
                 READ param PREVIOUS WITH LOCK
              ELSE
                 READ param PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-param TO TOTEM-ERR-STAT
           MOVE "param" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:param, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:param, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-param-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:param, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:param, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-param-KEY-Asc
              IF DataSet1-param-LOCK
                 READ param PREVIOUS WITH LOCK
              ELSE
                 READ param PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-param-LOCK
                 READ param NEXT WITH LOCK
              ELSE
                 READ param NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-param TO TOTEM-ERR-STAT
           MOVE "param" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:param, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:param, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-param-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:param, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-param TO TOTEM-ERR-STAT
           MOVE "param" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:param, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-param-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:param, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-param TO TOTEM-ERR-STAT
           MOVE "param" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:param, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-param-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:param, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-param TO TOTEM-ERR-STAT
           MOVE "param" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:param, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-recapiti-INITSTART.
           IF DataSet1-recapiti-KEY-Asc
              MOVE Low-Value TO rec-chiave
           ELSE
              MOVE High-Value TO rec-chiave
           END-IF
           .

       DataSet1-recapiti-INITEND.
           IF DataSet1-recapiti-KEY-Asc
              MOVE High-Value TO rec-chiave
           ELSE
              MOVE Low-Value TO rec-chiave
           END-IF
           .

      * recapiti
       DataSet1-recapiti-START.
           IF DataSet1-recapiti-KEY-Asc
              START recapiti KEY >= rec-chiave
           ELSE
              START recapiti KEY <= rec-chiave
           END-IF
           .

       DataSet1-recapiti-START-NOTGREATER.
           IF DataSet1-recapiti-KEY-Asc
              START recapiti KEY <= rec-chiave
           ELSE
              START recapiti KEY >= rec-chiave
           END-IF
           .

       DataSet1-recapiti-START-GREATER.
           IF DataSet1-recapiti-KEY-Asc
              START recapiti KEY > rec-chiave
           ELSE
              START recapiti KEY < rec-chiave
           END-IF
           .

       DataSet1-recapiti-START-LESS.
           IF DataSet1-recapiti-KEY-Asc
              START recapiti KEY < rec-chiave
           ELSE
              START recapiti KEY > rec-chiave
           END-IF
           .

       DataSet1-recapiti-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-recapiti-LOCK
              READ recapiti WITH LOCK 
              KEY rec-chiave
           ELSE
              READ recapiti WITH NO LOCK 
              KEY rec-chiave
           END-IF
           MOVE STATUS-recapiti TO TOTEM-ERR-STAT 
           MOVE "recapiti" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-recapiti-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-recapiti-KEY-Asc
              IF DataSet1-recapiti-LOCK
                 READ recapiti NEXT WITH LOCK
              ELSE
                 READ recapiti NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-recapiti-LOCK
                 READ recapiti PREVIOUS WITH LOCK
              ELSE
                 READ recapiti PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-recapiti TO TOTEM-ERR-STAT
           MOVE "recapiti" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-recapiti-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-recapiti-KEY-Asc
              IF DataSet1-recapiti-LOCK
                 READ recapiti PREVIOUS WITH LOCK
              ELSE
                 READ recapiti PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-recapiti-LOCK
                 READ recapiti NEXT WITH LOCK
              ELSE
                 READ recapiti NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-recapiti TO TOTEM-ERR-STAT
           MOVE "recapiti" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-recapiti-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-recapiti TO TOTEM-ERR-STAT
           MOVE "recapiti" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-recapiti-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-recapiti TO TOTEM-ERR-STAT
           MOVE "recapiti" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-recapiti-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-recapiti TO TOTEM-ERR-STAT
           MOVE "recapiti" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, AfterDelete>
      * <TOTEM:END>
           .

       EDI-mrordini-emro-k-articolo-MERGE-SPLITBUF.
           INITIALIZE EDI-mrordini-emro-k-articolo-SPLITBUF
           MOVE emro-cod-articolo(1:6) TO 
           EDI-mrordini-emro-k-articolo-SPLITBUF(1:6)
           MOVE emro-chiave(1:17) TO 
           EDI-mrordini-emro-k-articolo-SPLITBUF(7:17)
           .

       EDI-mrordini-emro-k-stato-MERGE-SPLITBUF.
           INITIALIZE EDI-mrordini-emro-k-stato-SPLITBUF
           MOVE emro-stato(1:1) TO 
           EDI-mrordini-emro-k-stato-SPLITBUF(1:1)
           MOVE emro-chiave(1:17) TO 
           EDI-mrordini-emro-k-stato-SPLITBUF(2:17)
           .

       DataSet1-EDI-mrordini-INITSTART.
           IF DataSet1-EDI-mrordini-KEY-Asc
              MOVE Low-Value TO emro-chiave
           ELSE
              MOVE High-Value TO emro-chiave
           END-IF
           .

       DataSet1-EDI-mrordini-INITEND.
           IF DataSet1-EDI-mrordini-KEY-Asc
              MOVE High-Value TO emro-chiave
           ELSE
              MOVE Low-Value TO emro-chiave
           END-IF
           .

      * EDI-mrordini
       DataSet1-EDI-mrordini-START.
           IF DataSet1-EDI-mrordini-KEY-Asc
              START EDI-mrordini KEY >= emro-chiave
           ELSE
              START EDI-mrordini KEY <= emro-chiave
           END-IF
           .

       DataSet1-EDI-mrordini-START-NOTGREATER.
           IF DataSet1-EDI-mrordini-KEY-Asc
              START EDI-mrordini KEY <= emro-chiave
           ELSE
              START EDI-mrordini KEY >= emro-chiave
           END-IF
           .

       DataSet1-EDI-mrordini-START-GREATER.
           IF DataSet1-EDI-mrordini-KEY-Asc
              START EDI-mrordini KEY > emro-chiave
           ELSE
              START EDI-mrordini KEY < emro-chiave
           END-IF
           .

       DataSet1-EDI-mrordini-START-LESS.
           IF DataSet1-EDI-mrordini-KEY-Asc
              START EDI-mrordini KEY < emro-chiave
           ELSE
              START EDI-mrordini KEY > emro-chiave
           END-IF
           .

       DataSet1-EDI-mrordini-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-mrordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-mrordini, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-EDI-mrordini-LOCK
              READ EDI-mrordini WITH LOCK 
              KEY emro-chiave
           ELSE
              READ EDI-mrordini WITH NO LOCK 
              KEY emro-chiave
           END-IF
           PERFORM EDI-mrordini-emro-k-articolo-MERGE-SPLITBUF
           PERFORM EDI-mrordini-emro-k-stato-MERGE-SPLITBUF
           MOVE STATUS-EDI-mrordini TO TOTEM-ERR-STAT 
           MOVE "EDI-mrordini" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-mrordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-mrordini, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-EDI-mrordini-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-mrordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-mrordini, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-EDI-mrordini-KEY-Asc
              IF DataSet1-EDI-mrordini-LOCK
                 READ EDI-mrordini NEXT WITH LOCK
              ELSE
                 READ EDI-mrordini NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-EDI-mrordini-LOCK
                 READ EDI-mrordini PREVIOUS WITH LOCK
              ELSE
                 READ EDI-mrordini PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM EDI-mrordini-emro-k-articolo-MERGE-SPLITBUF
           PERFORM EDI-mrordini-emro-k-stato-MERGE-SPLITBUF
           MOVE STATUS-EDI-mrordini TO TOTEM-ERR-STAT
           MOVE "EDI-mrordini" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-mrordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-mrordini, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-EDI-mrordini-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-mrordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-mrordini, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-EDI-mrordini-KEY-Asc
              IF DataSet1-EDI-mrordini-LOCK
                 READ EDI-mrordini PREVIOUS WITH LOCK
              ELSE
                 READ EDI-mrordini PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-EDI-mrordini-LOCK
                 READ EDI-mrordini NEXT WITH LOCK
              ELSE
                 READ EDI-mrordini NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM EDI-mrordini-emro-k-articolo-MERGE-SPLITBUF
           PERFORM EDI-mrordini-emro-k-stato-MERGE-SPLITBUF
           MOVE STATUS-EDI-mrordini TO TOTEM-ERR-STAT
           MOVE "EDI-mrordini" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-mrordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-mrordini, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-EDI-mrordini-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-mrordini, BeforeWrite>
      * <TOTEM:END>
           WRITE emro-rec OF EDI-mrordini.
           MOVE STATUS-EDI-mrordini TO TOTEM-ERR-STAT
           MOVE "EDI-mrordini" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-mrordini, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-EDI-mrordini-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-mrordini, BeforeRewrite>
      * <TOTEM:END>
           REWRITE emro-rec OF EDI-mrordini.
           MOVE STATUS-EDI-mrordini TO TOTEM-ERR-STAT
           MOVE "EDI-mrordini" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-mrordini, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-EDI-mrordini-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-mrordini, BeforeDelete>
      * <TOTEM:END>
           DELETE EDI-mrordini.
           MOVE STATUS-EDI-mrordini TO TOTEM-ERR-STAT
           MOVE "EDI-mrordini" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-mrordini, AfterDelete>
      * <TOTEM:END>
           .

       articoli-art-k1-MERGE-SPLITBUF.
           INITIALIZE articoli-art-k1-SPLITBUF
           MOVE art-descrizione OF articoli(1:50) TO 
           articoli-art-k1-SPLITBUF(1:50)
           .

       articoli-art-k-frn-MERGE-SPLITBUF.
           INITIALIZE articoli-art-k-frn-SPLITBUF
           MOVE art-cod-art-frn OF articoli(1:15) TO 
           articoli-art-k-frn-SPLITBUF(1:15)
           .

       DataSet1-articoli-INITSTART.
           IF DataSet1-articoli-KEY-Asc
              MOVE Low-Value TO art-chiave OF articoli
           ELSE
              MOVE High-Value TO art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-INITEND.
           IF DataSet1-articoli-KEY-Asc
              MOVE High-Value TO art-chiave OF articoli
           ELSE
              MOVE Low-Value TO art-chiave OF articoli
           END-IF
           .

      * articoli
       DataSet1-articoli-START.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY >= art-chiave OF articoli
           ELSE
              START articoli KEY <= art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-START-NOTGREATER.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY <= art-chiave OF articoli
           ELSE
              START articoli KEY >= art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-START-GREATER.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY > art-chiave OF articoli
           ELSE
              START articoli KEY < art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-START-LESS.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY < art-chiave OF articoli
           ELSE
              START articoli KEY > art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-articoli-LOCK
              READ articoli WITH LOCK 
              KEY art-chiave OF articoli
           ELSE
              READ articoli WITH NO LOCK 
              KEY art-chiave OF articoli
           END-IF
           PERFORM articoli-art-k1-MERGE-SPLITBUF
           PERFORM articoli-art-k-frn-MERGE-SPLITBUF
           MOVE STATUS-articoli TO TOTEM-ERR-STAT 
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-articoli-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-articoli-KEY-Asc
              IF DataSet1-articoli-LOCK
                 READ articoli NEXT WITH LOCK
              ELSE
                 READ articoli NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-articoli-LOCK
                 READ articoli PREVIOUS WITH LOCK
              ELSE
                 READ articoli PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM articoli-art-k1-MERGE-SPLITBUF
           PERFORM articoli-art-k-frn-MERGE-SPLITBUF
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-articoli-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-articoli-KEY-Asc
              IF DataSet1-articoli-LOCK
                 READ articoli PREVIOUS WITH LOCK
              ELSE
                 READ articoli PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-articoli-LOCK
                 READ articoli NEXT WITH LOCK
              ELSE
                 READ articoli NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM articoli-art-k1-MERGE-SPLITBUF
           PERFORM articoli-art-k-frn-MERGE-SPLITBUF
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-articoli-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-articoli-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-articoli-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterDelete>
      * <TOTEM:END>
           .

       progmag-key01-MERGE-SPLITBUF.
           INITIALIZE progmag-key01-SPLITBUF
           MOVE prg-cod-magazzino OF progmag(1:3) TO 
           progmag-key01-SPLITBUF(1:3)
           MOVE prg-cod-articolo OF progmag(1:6) TO 
           progmag-key01-SPLITBUF(4:6)
           MOVE prg-tipo-imballo OF progmag(1:3) TO 
           progmag-key01-SPLITBUF(10:3)
           MOVE prg-peso OF progmag(1:8) TO progmag-key01-SPLITBUF(13:8)
           .

       DataSet1-progmag-INITSTART.
           IF DataSet1-progmag-KEY-Asc
              MOVE Low-Value TO prg-chiave OF progmag
           ELSE
              MOVE High-Value TO prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-INITEND.
           IF DataSet1-progmag-KEY-Asc
              MOVE High-Value TO prg-chiave OF progmag
           ELSE
              MOVE Low-Value TO prg-chiave OF progmag
           END-IF
           .

      * progmag
       DataSet1-progmag-START.
           IF DataSet1-progmag-KEY-Asc
              START progmag KEY >= prg-chiave OF progmag
           ELSE
              START progmag KEY <= prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-START-NOTGREATER.
           IF DataSet1-progmag-KEY-Asc
              START progmag KEY <= prg-chiave OF progmag
           ELSE
              START progmag KEY >= prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-START-GREATER.
           IF DataSet1-progmag-KEY-Asc
              START progmag KEY > prg-chiave OF progmag
           ELSE
              START progmag KEY < prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-START-LESS.
           IF DataSet1-progmag-KEY-Asc
              START progmag KEY < prg-chiave OF progmag
           ELSE
              START progmag KEY > prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-progmag-LOCK
              READ progmag WITH LOCK 
              KEY prg-chiave OF progmag
           ELSE
              READ progmag WITH NO LOCK 
              KEY prg-chiave OF progmag
           END-IF
           PERFORM progmag-key01-MERGE-SPLITBUF
           MOVE STATUS-progmag TO TOTEM-ERR-STAT 
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-progmag-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-progmag-KEY-Asc
              IF DataSet1-progmag-LOCK
                 READ progmag NEXT WITH LOCK
              ELSE
                 READ progmag NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-progmag-LOCK
                 READ progmag PREVIOUS WITH LOCK
              ELSE
                 READ progmag PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM progmag-key01-MERGE-SPLITBUF
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-progmag-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-progmag-KEY-Asc
              IF DataSet1-progmag-LOCK
                 READ progmag PREVIOUS WITH LOCK
              ELSE
                 READ progmag PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-progmag-LOCK
                 READ progmag NEXT WITH LOCK
              ELSE
                 READ progmag NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM progmag-key01-MERGE-SPLITBUF
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-progmag-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-progmag-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-progmag-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-sitfin-INITSTART.
           IF DataSet1-sitfin-KEY-Asc
              MOVE Low-Value TO sf-chiave
           ELSE
              MOVE High-Value TO sf-chiave
           END-IF
           .

       DataSet1-sitfin-INITEND.
           IF DataSet1-sitfin-KEY-Asc
              MOVE High-Value TO sf-chiave
           ELSE
              MOVE Low-Value TO sf-chiave
           END-IF
           .

      * sitfin
       DataSet1-sitfin-START.
           IF DataSet1-sitfin-KEY-Asc
              START sitfin KEY >= sf-chiave
           ELSE
              START sitfin KEY <= sf-chiave
           END-IF
           .

       DataSet1-sitfin-START-NOTGREATER.
           IF DataSet1-sitfin-KEY-Asc
              START sitfin KEY <= sf-chiave
           ELSE
              START sitfin KEY >= sf-chiave
           END-IF
           .

       DataSet1-sitfin-START-GREATER.
           IF DataSet1-sitfin-KEY-Asc
              START sitfin KEY > sf-chiave
           ELSE
              START sitfin KEY < sf-chiave
           END-IF
           .

       DataSet1-sitfin-START-LESS.
           IF DataSet1-sitfin-KEY-Asc
              START sitfin KEY < sf-chiave
           ELSE
              START sitfin KEY > sf-chiave
           END-IF
           .

       DataSet1-sitfin-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:sitfin, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:sitfin, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-sitfin-LOCK
              READ sitfin WITH LOCK 
              KEY sf-chiave
           ELSE
              READ sitfin WITH NO LOCK 
              KEY sf-chiave
           END-IF
           MOVE STATUS-sitfin TO TOTEM-ERR-STAT 
           MOVE "sitfin" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:sitfin, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:sitfin, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-sitfin-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:sitfin, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:sitfin, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-sitfin-KEY-Asc
              IF DataSet1-sitfin-LOCK
                 READ sitfin NEXT WITH LOCK
              ELSE
                 READ sitfin NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-sitfin-LOCK
                 READ sitfin PREVIOUS WITH LOCK
              ELSE
                 READ sitfin PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-sitfin TO TOTEM-ERR-STAT
           MOVE "sitfin" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:sitfin, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:sitfin, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-sitfin-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:sitfin, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:sitfin, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-sitfin-KEY-Asc
              IF DataSet1-sitfin-LOCK
                 READ sitfin PREVIOUS WITH LOCK
              ELSE
                 READ sitfin PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-sitfin-LOCK
                 READ sitfin NEXT WITH LOCK
              ELSE
                 READ sitfin NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-sitfin TO TOTEM-ERR-STAT
           MOVE "sitfin" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:sitfin, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:sitfin, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-sitfin-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:sitfin, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-sitfin TO TOTEM-ERR-STAT
           MOVE "sitfin" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:sitfin, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-sitfin-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:sitfin, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-sitfin TO TOTEM-ERR-STAT
           MOVE "sitfin" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:sitfin, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-sitfin-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:sitfin, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-sitfin TO TOTEM-ERR-STAT
           MOVE "sitfin" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:sitfin, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tparamge-INITSTART.
           IF DataSet1-tparamge-KEY-Asc
              MOVE Low-Value TO tge-chiave
           ELSE
              MOVE High-Value TO tge-chiave
           END-IF
           .

       DataSet1-tparamge-INITEND.
           IF DataSet1-tparamge-KEY-Asc
              MOVE High-Value TO tge-chiave
           ELSE
              MOVE Low-Value TO tge-chiave
           END-IF
           .

      * tparamge
       DataSet1-tparamge-START.
           IF DataSet1-tparamge-KEY-Asc
              START tparamge KEY >= tge-chiave
           ELSE
              START tparamge KEY <= tge-chiave
           END-IF
           .

       DataSet1-tparamge-START-NOTGREATER.
           IF DataSet1-tparamge-KEY-Asc
              START tparamge KEY <= tge-chiave
           ELSE
              START tparamge KEY >= tge-chiave
           END-IF
           .

       DataSet1-tparamge-START-GREATER.
           IF DataSet1-tparamge-KEY-Asc
              START tparamge KEY > tge-chiave
           ELSE
              START tparamge KEY < tge-chiave
           END-IF
           .

       DataSet1-tparamge-START-LESS.
           IF DataSet1-tparamge-KEY-Asc
              START tparamge KEY < tge-chiave
           ELSE
              START tparamge KEY > tge-chiave
           END-IF
           .

       DataSet1-tparamge-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tparamge-LOCK
              READ tparamge WITH LOCK 
              KEY tge-chiave
           ELSE
              READ tparamge WITH NO LOCK 
              KEY tge-chiave
           END-IF
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT 
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tparamge-KEY-Asc
              IF DataSet1-tparamge-LOCK
                 READ tparamge NEXT WITH LOCK
              ELSE
                 READ tparamge NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tparamge-LOCK
                 READ tparamge PREVIOUS WITH LOCK
              ELSE
                 READ tparamge PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tparamge-KEY-Asc
              IF DataSet1-tparamge-LOCK
                 READ tparamge PREVIOUS WITH LOCK
              ELSE
                 READ tparamge PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tparamge-LOCK
                 READ tparamge NEXT WITH LOCK
              ELSE
                 READ tparamge NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterDelete>
      * <TOTEM:END>
           .

       mrordini-mro-k-promo-MERGE-SPLITBUF.
           INITIALIZE mrordini-mro-k-promo-SPLITBUF
           MOVE mro-promo(1:15) TO mrordini-mro-k-promo-SPLITBUF(1:15)
           MOVE mro-chiave(1:17) TO mrordini-mro-k-promo-SPLITBUF(16:17)
           .

       mrordini-mro-k-articolo-MERGE-SPLITBUF.
           INITIALIZE mrordini-mro-k-articolo-SPLITBUF
           MOVE mro-cod-articolo(1:6) TO 
           mrordini-mro-k-articolo-SPLITBUF(1:6)
           MOVE mro-chiave(1:17) TO 
           mrordini-mro-k-articolo-SPLITBUF(7:17)
           .

       mrordini-mro-k-progr-MERGE-SPLITBUF.
           INITIALIZE mrordini-mro-k-progr-SPLITBUF
           MOVE mro-chiave-testa(1:12) TO 
           mrordini-mro-k-progr-SPLITBUF(1:12)
           MOVE mro-progr(1:5) TO mrordini-mro-k-progr-SPLITBUF(13:5)
           .

       mrordini-mro-k-tprev-MERGE-SPLITBUF.
           INITIALIZE mrordini-mro-k-tprev-SPLITBUF
           MOVE mro-promo(1:15) TO mrordini-mro-k-tprev-SPLITBUF(1:15)
           MOVE mro-prg-cod-articolo(1:6) TO 
           mrordini-mro-k-tprev-SPLITBUF(16:6)
           MOVE mro-chiave(1:17) TO mrordini-mro-k-tprev-SPLITBUF(22:17)
           .

       mrordini-mro-k-ord-art-MERGE-SPLITBUF.
           INITIALIZE mrordini-mro-k-ord-art-SPLITBUF
           MOVE mro-chiave-testa(1:12) TO 
           mrordini-mro-k-ord-art-SPLITBUF(1:12)
           MOVE mro-cod-articolo(1:6) TO 
           mrordini-mro-k-ord-art-SPLITBUF(13:6)
           .

       DataSet1-mrordini-INITSTART.
           IF DataSet1-mrordini-KEY-Asc
              MOVE Low-Value TO mro-chiave
           ELSE
              MOVE High-Value TO mro-chiave
           END-IF
           .

       DataSet1-mrordini-INITEND.
           IF DataSet1-mrordini-KEY-Asc
              MOVE High-Value TO mro-chiave
           ELSE
              MOVE Low-Value TO mro-chiave
           END-IF
           .

      * mrordini
       DataSet1-mrordini-START.
           IF DataSet1-mrordini-KEY-Asc
              START mrordini KEY >= mro-chiave
           ELSE
              START mrordini KEY <= mro-chiave
           END-IF
           .

       DataSet1-mrordini-START-NOTGREATER.
           IF DataSet1-mrordini-KEY-Asc
              START mrordini KEY <= mro-chiave
           ELSE
              START mrordini KEY >= mro-chiave
           END-IF
           .

       DataSet1-mrordini-START-GREATER.
           IF DataSet1-mrordini-KEY-Asc
              START mrordini KEY > mro-chiave
           ELSE
              START mrordini KEY < mro-chiave
           END-IF
           .

       DataSet1-mrordini-START-LESS.
           IF DataSet1-mrordini-KEY-Asc
              START mrordini KEY < mro-chiave
           ELSE
              START mrordini KEY > mro-chiave
           END-IF
           .

       DataSet1-mrordini-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-mrordini-LOCK
              READ mrordini WITH LOCK 
              KEY mro-chiave
           ELSE
              READ mrordini WITH NO LOCK 
              KEY mro-chiave
           END-IF
           PERFORM mrordini-mro-k-promo-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-articolo-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-progr-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-tprev-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-ord-art-MERGE-SPLITBUF
           MOVE STATUS-mrordini TO TOTEM-ERR-STAT 
           MOVE "mrordini" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-mrordini-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-mrordini-KEY-Asc
              IF DataSet1-mrordini-LOCK
                 READ mrordini NEXT WITH LOCK
              ELSE
                 READ mrordini NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-mrordini-LOCK
                 READ mrordini PREVIOUS WITH LOCK
              ELSE
                 READ mrordini PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM mrordini-mro-k-promo-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-articolo-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-progr-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-tprev-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-ord-art-MERGE-SPLITBUF
           MOVE STATUS-mrordini TO TOTEM-ERR-STAT
           MOVE "mrordini" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-mrordini-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-mrordini-KEY-Asc
              IF DataSet1-mrordini-LOCK
                 READ mrordini PREVIOUS WITH LOCK
              ELSE
                 READ mrordini PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-mrordini-LOCK
                 READ mrordini NEXT WITH LOCK
              ELSE
                 READ mrordini NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM mrordini-mro-k-promo-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-articolo-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-progr-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-tprev-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-ord-art-MERGE-SPLITBUF
           MOVE STATUS-mrordini TO TOTEM-ERR-STAT
           MOVE "mrordini" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-mrordini-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, BeforeWrite>
      * <TOTEM:END>
           WRITE mro-rec OF mrordini.
           MOVE STATUS-mrordini TO TOTEM-ERR-STAT
           MOVE "mrordini" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-mrordini-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, BeforeRewrite>
      * <TOTEM:END>
           REWRITE mro-rec OF mrordini.
           MOVE STATUS-mrordini TO TOTEM-ERR-STAT
           MOVE "mrordini" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-mrordini-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, BeforeDelete>
      * <TOTEM:END>
           DELETE mrordini.
           MOVE STATUS-mrordini TO TOTEM-ERR-STAT
           MOVE "mrordini" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, AfterDelete>
      * <TOTEM:END>
           .

       mtordini-mto-k-ord-cli-MERGE-SPLITBUF.
           INITIALIZE mtordini-mto-k-ord-cli-SPLITBUF
           MOVE mto-anno(1:4) TO mtordini-mto-k-ord-cli-SPLITBUF(1:4)
           MOVE mto-num-ord-cli(1:50) TO 
           mtordini-mto-k-ord-cli-SPLITBUF(5:50)
           .

       mtordini-mto-k-data-MERGE-SPLITBUF.
           INITIALIZE mtordini-mto-k-data-SPLITBUF
           MOVE mto-data-ordine(1:8) TO 
           mtordini-mto-k-data-SPLITBUF(1:8)
           MOVE mto-chiave(1:12) TO mtordini-mto-k-data-SPLITBUF(9:12)
           .

       mtordini-mto-k-clides-MERGE-SPLITBUF.
           INITIALIZE mtordini-mto-k-clides-SPLITBUF
           MOVE mto-cod-cli(1:5) TO mtordini-mto-k-clides-SPLITBUF(1:5)
           MOVE mto-prg-destino(1:5) TO 
           mtordini-mto-k-clides-SPLITBUF(6:5)
           MOVE mto-data-ordine(1:8) TO 
           mtordini-mto-k-clides-SPLITBUF(11:8)
           .

       mtordini-mto-k-age-MERGE-SPLITBUF.
           INITIALIZE mtordini-mto-k-age-SPLITBUF
           MOVE mto-cod-agente(1:5) TO mtordini-mto-k-age-SPLITBUF(1:5)
           MOVE mto-data-ordine(1:8) TO mtordini-mto-k-age-SPLITBUF(6:8)
           .

       mtordini-k-mto-stato-sel-MERGE-SPLITBUF.
           INITIALIZE mtordini-k-mto-stato-sel-SPLITBUF
           MOVE mto-stato-ordine(1:1) TO 
           mtordini-k-mto-stato-sel-SPLITBUF(1:1)
           MOVE mto-cod-cli(1:5) TO 
           mtordini-k-mto-stato-sel-SPLITBUF(2:5)
           MOVE mto-data-ordine(1:8) TO 
           mtordini-k-mto-stato-sel-SPLITBUF(7:8)
           .

       mtordini-k-mto-stato-MERGE-SPLITBUF.
           INITIALIZE mtordini-k-mto-stato-SPLITBUF
           MOVE mto-stato-ordine(1:1) TO 
           mtordini-k-mto-stato-SPLITBUF(1:1)
           MOVE mto-chiave(1:12) TO mtordini-k-mto-stato-SPLITBUF(2:12)
           .

       mtordini-mto-k-gdo-MERGE-SPLITBUF.
           INITIALIZE mtordini-mto-k-gdo-SPLITBUF
           MOVE mto-gdo(1:5) TO mtordini-mto-k-gdo-SPLITBUF(1:5)
           MOVE mto-data-ordine(1:8) TO mtordini-mto-k-gdo-SPLITBUF(6:8)
           MOVE mto-chiave(1:12) TO mtordini-mto-k-gdo-SPLITBUF(14:12)
           .

       mtordini-mto-k-bloc-MERGE-SPLITBUF.
           INITIALIZE mtordini-mto-k-bloc-SPLITBUF
           MOVE mto-stato-attivazione(1:1) TO 
           mtordini-mto-k-bloc-SPLITBUF(1:1)
           MOVE mto-data-ordine(1:8) TO 
           mtordini-mto-k-bloc-SPLITBUF(2:8)
           MOVE mto-cod-cli(1:5) TO mtordini-mto-k-bloc-SPLITBUF(10:5)
           MOVE mto-prg-destino(1:5) TO 
           mtordini-mto-k-bloc-SPLITBUF(15:5)
           .

       mtordini-k-giang-MERGE-SPLITBUF.
           INITIALIZE mtordini-k-giang-SPLITBUF
           MOVE mto-data-note1(1:8) TO mtordini-k-giang-SPLITBUF(1:8)
           MOVE mto-chiave(1:12) TO mtordini-k-giang-SPLITBUF(9:12)
           .

       mtordini-mto-k-promo-MERGE-SPLITBUF.
           INITIALIZE mtordini-mto-k-promo-SPLITBUF
           MOVE mto-promo(1:1) TO mtordini-mto-k-promo-SPLITBUF(1:1)
           MOVE mto-tipo-CF(1:1) TO mtordini-mto-k-promo-SPLITBUF(2:1)
           MOVE mto-cod-cli(1:5) TO mtordini-mto-k-promo-SPLITBUF(3:5)
           MOVE mto-prg-destino(1:5) TO 
           mtordini-mto-k-promo-SPLITBUF(8:5)
           MOVE mto-chiave(1:12) TO mtordini-mto-k-promo-SPLITBUF(13:12)
           .

       DataSet1-mtordini-INITSTART.
           IF DataSet1-mtordini-KEY-Asc
              MOVE Low-Value TO mto-chiave
           ELSE
              MOVE High-Value TO mto-chiave
           END-IF
           .

       DataSet1-mtordini-INITEND.
           IF DataSet1-mtordini-KEY-Asc
              MOVE High-Value TO mto-chiave
           ELSE
              MOVE Low-Value TO mto-chiave
           END-IF
           .

      * mtordini
       DataSet1-mtordini-START.
           IF DataSet1-mtordini-KEY-Asc
              START mtordini KEY >= mto-chiave
           ELSE
              START mtordini KEY <= mto-chiave
           END-IF
           .

       DataSet1-mtordini-START-NOTGREATER.
           IF DataSet1-mtordini-KEY-Asc
              START mtordini KEY <= mto-chiave
           ELSE
              START mtordini KEY >= mto-chiave
           END-IF
           .

       DataSet1-mtordini-START-GREATER.
           IF DataSet1-mtordini-KEY-Asc
              START mtordini KEY > mto-chiave
           ELSE
              START mtordini KEY < mto-chiave
           END-IF
           .

       DataSet1-mtordini-START-LESS.
           IF DataSet1-mtordini-KEY-Asc
              START mtordini KEY < mto-chiave
           ELSE
              START mtordini KEY > mto-chiave
           END-IF
           .

       DataSet1-mtordini-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-mtordini-LOCK
              READ mtordini WITH LOCK 
              KEY mto-chiave
           ELSE
              READ mtordini WITH NO LOCK 
              KEY mto-chiave
           END-IF
           PERFORM mtordini-mto-k-ord-cli-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-data-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-clides-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-age-MERGE-SPLITBUF
           PERFORM mtordini-k-mto-stato-sel-MERGE-SPLITBUF
           PERFORM mtordini-k-mto-stato-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-gdo-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-bloc-MERGE-SPLITBUF
           PERFORM mtordini-k-giang-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-promo-MERGE-SPLITBUF
           MOVE STATUS-mtordini TO TOTEM-ERR-STAT 
           MOVE "mtordini" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-mtordini-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-mtordini-KEY-Asc
              IF DataSet1-mtordini-LOCK
                 READ mtordini NEXT WITH LOCK
              ELSE
                 READ mtordini NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-mtordini-LOCK
                 READ mtordini PREVIOUS WITH LOCK
              ELSE
                 READ mtordini PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM mtordini-mto-k-ord-cli-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-data-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-clides-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-age-MERGE-SPLITBUF
           PERFORM mtordini-k-mto-stato-sel-MERGE-SPLITBUF
           PERFORM mtordini-k-mto-stato-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-gdo-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-bloc-MERGE-SPLITBUF
           PERFORM mtordini-k-giang-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-promo-MERGE-SPLITBUF
           MOVE STATUS-mtordini TO TOTEM-ERR-STAT
           MOVE "mtordini" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-mtordini-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-mtordini-KEY-Asc
              IF DataSet1-mtordini-LOCK
                 READ mtordini PREVIOUS WITH LOCK
              ELSE
                 READ mtordini PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-mtordini-LOCK
                 READ mtordini NEXT WITH LOCK
              ELSE
                 READ mtordini NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM mtordini-mto-k-ord-cli-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-data-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-clides-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-age-MERGE-SPLITBUF
           PERFORM mtordini-k-mto-stato-sel-MERGE-SPLITBUF
           PERFORM mtordini-k-mto-stato-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-gdo-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-bloc-MERGE-SPLITBUF
           PERFORM mtordini-k-giang-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-promo-MERGE-SPLITBUF
           MOVE STATUS-mtordini TO TOTEM-ERR-STAT
           MOVE "mtordini" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-mtordini-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, BeforeWrite>
      * <TOTEM:END>
           WRITE mto-rec OF mtordini.
           MOVE STATUS-mtordini TO TOTEM-ERR-STAT
           MOVE "mtordini" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-mtordini-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, BeforeRewrite>
      * <TOTEM:END>
           REWRITE mto-rec OF mtordini.
           MOVE STATUS-mtordini TO TOTEM-ERR-STAT
           MOVE "mtordini" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-mtordini-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, BeforeDelete>
      * <TOTEM:END>
           DELETE mtordini.
           MOVE STATUS-mtordini TO TOTEM-ERR-STAT
           MOVE "mtordini" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-timbalqta-INITSTART.
           IF DataSet1-timbalqta-KEY-Asc
              MOVE Low-Value TO imq-chiave
           ELSE
              MOVE High-Value TO imq-chiave
           END-IF
           .

       DataSet1-timbalqta-INITEND.
           IF DataSet1-timbalqta-KEY-Asc
              MOVE High-Value TO imq-chiave
           ELSE
              MOVE Low-Value TO imq-chiave
           END-IF
           .

      * timbalqta
       DataSet1-timbalqta-START.
           IF DataSet1-timbalqta-KEY-Asc
              START timbalqta KEY >= imq-chiave
           ELSE
              START timbalqta KEY <= imq-chiave
           END-IF
           .

       DataSet1-timbalqta-START-NOTGREATER.
           IF DataSet1-timbalqta-KEY-Asc
              START timbalqta KEY <= imq-chiave
           ELSE
              START timbalqta KEY >= imq-chiave
           END-IF
           .

       DataSet1-timbalqta-START-GREATER.
           IF DataSet1-timbalqta-KEY-Asc
              START timbalqta KEY > imq-chiave
           ELSE
              START timbalqta KEY < imq-chiave
           END-IF
           .

       DataSet1-timbalqta-START-LESS.
           IF DataSet1-timbalqta-KEY-Asc
              START timbalqta KEY < imq-chiave
           ELSE
              START timbalqta KEY > imq-chiave
           END-IF
           .

       DataSet1-timbalqta-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-timbalqta-LOCK
              READ timbalqta WITH LOCK 
              KEY imq-chiave
           ELSE
              READ timbalqta WITH NO LOCK 
              KEY imq-chiave
           END-IF
           MOVE STATUS-timbalqta TO TOTEM-ERR-STAT 
           MOVE "timbalqta" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-timbalqta-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-timbalqta-KEY-Asc
              IF DataSet1-timbalqta-LOCK
                 READ timbalqta NEXT WITH LOCK
              ELSE
                 READ timbalqta NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-timbalqta-LOCK
                 READ timbalqta PREVIOUS WITH LOCK
              ELSE
                 READ timbalqta PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-timbalqta TO TOTEM-ERR-STAT
           MOVE "timbalqta" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-timbalqta-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-timbalqta-KEY-Asc
              IF DataSet1-timbalqta-LOCK
                 READ timbalqta PREVIOUS WITH LOCK
              ELSE
                 READ timbalqta PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-timbalqta-LOCK
                 READ timbalqta NEXT WITH LOCK
              ELSE
                 READ timbalqta NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-timbalqta TO TOTEM-ERR-STAT
           MOVE "timbalqta" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-timbalqta-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-timbalqta TO TOTEM-ERR-STAT
           MOVE "timbalqta" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-timbalqta-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-timbalqta TO TOTEM-ERR-STAT
           MOVE "timbalqta" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-timbalqta-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-timbalqta TO TOTEM-ERR-STAT
           MOVE "timbalqta" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-timposte-INITSTART.
           IF DataSet1-timposte-KEY-Asc
              MOVE Low-Value TO imp-chiave
           ELSE
              MOVE High-Value TO imp-chiave
           END-IF
           .

       DataSet1-timposte-INITEND.
           IF DataSet1-timposte-KEY-Asc
              MOVE High-Value TO imp-chiave
           ELSE
              MOVE Low-Value TO imp-chiave
           END-IF
           .

      * timposte
       DataSet1-timposte-START.
           IF DataSet1-timposte-KEY-Asc
              START timposte KEY >= imp-chiave
           ELSE
              START timposte KEY <= imp-chiave
           END-IF
           .

       DataSet1-timposte-START-NOTGREATER.
           IF DataSet1-timposte-KEY-Asc
              START timposte KEY <= imp-chiave
           ELSE
              START timposte KEY >= imp-chiave
           END-IF
           .

       DataSet1-timposte-START-GREATER.
           IF DataSet1-timposte-KEY-Asc
              START timposte KEY > imp-chiave
           ELSE
              START timposte KEY < imp-chiave
           END-IF
           .

       DataSet1-timposte-START-LESS.
           IF DataSet1-timposte-KEY-Asc
              START timposte KEY < imp-chiave
           ELSE
              START timposte KEY > imp-chiave
           END-IF
           .

       DataSet1-timposte-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-timposte-LOCK
              READ timposte WITH LOCK 
              KEY imp-chiave
           ELSE
              READ timposte WITH NO LOCK 
              KEY imp-chiave
           END-IF
           MOVE STATUS-timposte TO TOTEM-ERR-STAT 
           MOVE "timposte" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-timposte-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-timposte-KEY-Asc
              IF DataSet1-timposte-LOCK
                 READ timposte NEXT WITH LOCK
              ELSE
                 READ timposte NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-timposte-LOCK
                 READ timposte PREVIOUS WITH LOCK
              ELSE
                 READ timposte PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-timposte TO TOTEM-ERR-STAT
           MOVE "timposte" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-timposte-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-timposte-KEY-Asc
              IF DataSet1-timposte-LOCK
                 READ timposte PREVIOUS WITH LOCK
              ELSE
                 READ timposte PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-timposte-LOCK
                 READ timposte NEXT WITH LOCK
              ELSE
                 READ timposte NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-timposte TO TOTEM-ERR-STAT
           MOVE "timposte" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-timposte-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-timposte TO TOTEM-ERR-STAT
           MOVE "timposte" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-timposte-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-timposte TO TOTEM-ERR-STAT
           MOVE "timposte" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-timposte-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-timposte TO TOTEM-ERR-STAT
           MOVE "timposte" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tpiombo-INITSTART.
           IF DataSet1-tpiombo-KEY-Asc
              MOVE Low-Value TO tpb-chiave
           ELSE
              MOVE High-Value TO tpb-chiave
           END-IF
           .

       DataSet1-tpiombo-INITEND.
           IF DataSet1-tpiombo-KEY-Asc
              MOVE High-Value TO tpb-chiave
           ELSE
              MOVE Low-Value TO tpb-chiave
           END-IF
           .

      * tpiombo
       DataSet1-tpiombo-START.
           IF DataSet1-tpiombo-KEY-Asc
              START tpiombo KEY >= tpb-chiave
           ELSE
              START tpiombo KEY <= tpb-chiave
           END-IF
           .

       DataSet1-tpiombo-START-NOTGREATER.
           IF DataSet1-tpiombo-KEY-Asc
              START tpiombo KEY <= tpb-chiave
           ELSE
              START tpiombo KEY >= tpb-chiave
           END-IF
           .

       DataSet1-tpiombo-START-GREATER.
           IF DataSet1-tpiombo-KEY-Asc
              START tpiombo KEY > tpb-chiave
           ELSE
              START tpiombo KEY < tpb-chiave
           END-IF
           .

       DataSet1-tpiombo-START-LESS.
           IF DataSet1-tpiombo-KEY-Asc
              START tpiombo KEY < tpb-chiave
           ELSE
              START tpiombo KEY > tpb-chiave
           END-IF
           .

       DataSet1-tpiombo-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tpiombo-LOCK
              READ tpiombo WITH LOCK 
              KEY tpb-chiave
           ELSE
              READ tpiombo WITH NO LOCK 
              KEY tpb-chiave
           END-IF
           MOVE STATUS-tpiombo TO TOTEM-ERR-STAT 
           MOVE "tpiombo" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tpiombo-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tpiombo-KEY-Asc
              IF DataSet1-tpiombo-LOCK
                 READ tpiombo NEXT WITH LOCK
              ELSE
                 READ tpiombo NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tpiombo-LOCK
                 READ tpiombo PREVIOUS WITH LOCK
              ELSE
                 READ tpiombo PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tpiombo TO TOTEM-ERR-STAT
           MOVE "tpiombo" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tpiombo-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tpiombo-KEY-Asc
              IF DataSet1-tpiombo-LOCK
                 READ tpiombo PREVIOUS WITH LOCK
              ELSE
                 READ tpiombo PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tpiombo-LOCK
                 READ tpiombo NEXT WITH LOCK
              ELSE
                 READ tpiombo NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tpiombo TO TOTEM-ERR-STAT
           MOVE "tpiombo" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tpiombo-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tpiombo TO TOTEM-ERR-STAT
           MOVE "tpiombo" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tpiombo-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tpiombo TO TOTEM-ERR-STAT
           MOVE "tpiombo" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tpiombo-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tpiombo TO TOTEM-ERR-STAT
           MOVE "tpiombo" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tmarche-INITSTART.
           IF DataSet1-tmarche-KEY-Asc
              MOVE Low-Value TO mar-chiave
           ELSE
              MOVE High-Value TO mar-chiave
           END-IF
           .

       DataSet1-tmarche-INITEND.
           IF DataSet1-tmarche-KEY-Asc
              MOVE High-Value TO mar-chiave
           ELSE
              MOVE Low-Value TO mar-chiave
           END-IF
           .

      * tmarche
       DataSet1-tmarche-START.
           IF DataSet1-tmarche-KEY-Asc
              START tmarche KEY >= mar-chiave
           ELSE
              START tmarche KEY <= mar-chiave
           END-IF
           .

       DataSet1-tmarche-START-NOTGREATER.
           IF DataSet1-tmarche-KEY-Asc
              START tmarche KEY <= mar-chiave
           ELSE
              START tmarche KEY >= mar-chiave
           END-IF
           .

       DataSet1-tmarche-START-GREATER.
           IF DataSet1-tmarche-KEY-Asc
              START tmarche KEY > mar-chiave
           ELSE
              START tmarche KEY < mar-chiave
           END-IF
           .

       DataSet1-tmarche-START-LESS.
           IF DataSet1-tmarche-KEY-Asc
              START tmarche KEY < mar-chiave
           ELSE
              START tmarche KEY > mar-chiave
           END-IF
           .

       DataSet1-tmarche-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tmarche-LOCK
              READ tmarche WITH LOCK 
              KEY mar-chiave
           ELSE
              READ tmarche WITH NO LOCK 
              KEY mar-chiave
           END-IF
           MOVE STATUS-tmarche TO TOTEM-ERR-STAT 
           MOVE "tmarche" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tmarche-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tmarche-KEY-Asc
              IF DataSet1-tmarche-LOCK
                 READ tmarche NEXT WITH LOCK
              ELSE
                 READ tmarche NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tmarche-LOCK
                 READ tmarche PREVIOUS WITH LOCK
              ELSE
                 READ tmarche PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tmarche TO TOTEM-ERR-STAT
           MOVE "tmarche" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tmarche-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tmarche-KEY-Asc
              IF DataSet1-tmarche-LOCK
                 READ tmarche PREVIOUS WITH LOCK
              ELSE
                 READ tmarche PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tmarche-LOCK
                 READ tmarche NEXT WITH LOCK
              ELSE
                 READ tmarche NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tmarche TO TOTEM-ERR-STAT
           MOVE "tmarche" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tmarche-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tmarche TO TOTEM-ERR-STAT
           MOVE "tmarche" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tmarche-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tmarche TO TOTEM-ERR-STAT
           MOVE "tmarche" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tmarche-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tmarche TO TOTEM-ERR-STAT
           MOVE "tmarche" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterDelete>
      * <TOTEM:END>
           .

       rpromo-k-stampa-MERGE-SPLITBUF.
           INITIALIZE rpromo-k-stampa-SPLITBUF
           MOVE rpr-codice(1:15) TO rpromo-k-stampa-SPLITBUF(1:15)
           MOVE rpr-data-creazione(1:8) TO 
           rpromo-k-stampa-SPLITBUF(16:8)
           MOVE rpr-ora-creazione(1:8) TO rpromo-k-stampa-SPLITBUF(24:8)
           .

       DataSet1-rpromo-INITSTART.
           IF DataSet1-rpromo-KEY-Asc
              MOVE Low-Value TO rpr-chiave
           ELSE
              MOVE High-Value TO rpr-chiave
           END-IF
           .

       DataSet1-rpromo-INITEND.
           IF DataSet1-rpromo-KEY-Asc
              MOVE High-Value TO rpr-chiave
           ELSE
              MOVE Low-Value TO rpr-chiave
           END-IF
           .

      * rpromo
       DataSet1-rpromo-START.
           IF DataSet1-rpromo-KEY-Asc
              START rpromo KEY >= rpr-chiave
           ELSE
              START rpromo KEY <= rpr-chiave
           END-IF
           .

       DataSet1-rpromo-START-NOTGREATER.
           IF DataSet1-rpromo-KEY-Asc
              START rpromo KEY <= rpr-chiave
           ELSE
              START rpromo KEY >= rpr-chiave
           END-IF
           .

       DataSet1-rpromo-START-GREATER.
           IF DataSet1-rpromo-KEY-Asc
              START rpromo KEY > rpr-chiave
           ELSE
              START rpromo KEY < rpr-chiave
           END-IF
           .

       DataSet1-rpromo-START-LESS.
           IF DataSet1-rpromo-KEY-Asc
              START rpromo KEY < rpr-chiave
           ELSE
              START rpromo KEY > rpr-chiave
           END-IF
           .

       DataSet1-rpromo-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:rpromo, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rpromo, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-rpromo-LOCK
              READ rpromo WITH LOCK 
              KEY rpr-chiave
           ELSE
              READ rpromo WITH NO LOCK 
              KEY rpr-chiave
           END-IF
           PERFORM rpromo-k-stampa-MERGE-SPLITBUF
           MOVE STATUS-rpromo TO TOTEM-ERR-STAT 
           MOVE "rpromo" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rpromo, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rpromo, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-rpromo-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:rpromo, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rpromo, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-rpromo-KEY-Asc
              IF DataSet1-rpromo-LOCK
                 READ rpromo NEXT WITH LOCK
              ELSE
                 READ rpromo NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-rpromo-LOCK
                 READ rpromo PREVIOUS WITH LOCK
              ELSE
                 READ rpromo PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM rpromo-k-stampa-MERGE-SPLITBUF
           MOVE STATUS-rpromo TO TOTEM-ERR-STAT
           MOVE "rpromo" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rpromo, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rpromo, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-rpromo-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:rpromo, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rpromo, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-rpromo-KEY-Asc
              IF DataSet1-rpromo-LOCK
                 READ rpromo PREVIOUS WITH LOCK
              ELSE
                 READ rpromo PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-rpromo-LOCK
                 READ rpromo NEXT WITH LOCK
              ELSE
                 READ rpromo NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM rpromo-k-stampa-MERGE-SPLITBUF
           MOVE STATUS-rpromo TO TOTEM-ERR-STAT
           MOVE "rpromo" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rpromo, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rpromo, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-rpromo-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:rpromo, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-rpromo TO TOTEM-ERR-STAT
           MOVE "rpromo" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rpromo, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-rpromo-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:rpromo, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-rpromo TO TOTEM-ERR-STAT
           MOVE "rpromo" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rpromo, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-rpromo-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:rpromo, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-rpromo TO TOTEM-ERR-STAT
           MOVE "rpromo" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rpromo, AfterDelete>
      * <TOTEM:END>
           .

       tpromo-tpr-chiave-ricerca-MERGE-SPLITBUF.
           INITIALIZE tpromo-tpr-chiave-ricerca-SPLITBUF
           MOVE tpr-chiave-ricerca OF tpromo(1:21) TO 
           tpromo-tpr-chiave-ricerca-SPLITBUF(1:21)
           .

       tpromo-tpr-chiave-gdo-fine-MERGE-SPLITBUF.
           INITIALIZE tpromo-tpr-chiave-gdo-fine-SPLITBUF
           MOVE tpr-gdo OF tpromo(1:5) TO 
           tpromo-tpr-chiave-gdo-fine-SPLITBUF(1:5)
           MOVE tpr-fine-dpo OF tpromo(1:8) TO 
           tpromo-tpr-chiave-gdo-fine-SPLITBUF(6:8)
           MOVE tpr-ini-dpo OF tpromo(1:8) TO 
           tpromo-tpr-chiave-gdo-fine-SPLITBUF(14:8)
           .

       tpromo-tpr-chiave-fine-MERGE-SPLITBUF.
           INITIALIZE tpromo-tpr-chiave-fine-SPLITBUF
           MOVE tpr-fine-dpo OF tpromo(1:8) TO 
           tpromo-tpr-chiave-fine-SPLITBUF(1:8)
           MOVE tpr-ini-dpo OF tpromo(1:8) TO 
           tpromo-tpr-chiave-fine-SPLITBUF(9:8)
           MOVE tpr-gdo OF tpromo(1:5) TO 
           tpromo-tpr-chiave-fine-SPLITBUF(17:5)
           .

       tpromo-tpr-chiave-ini-MERGE-SPLITBUF.
           INITIALIZE tpromo-tpr-chiave-ini-SPLITBUF
           MOVE tpr-ini-dpo OF tpromo(1:8) TO 
           tpromo-tpr-chiave-ini-SPLITBUF(1:8)
           MOVE tpr-fine-dpo OF tpromo(1:8) TO 
           tpromo-tpr-chiave-ini-SPLITBUF(9:8)
           MOVE tpr-gdo OF tpromo(1:5) TO 
           tpromo-tpr-chiave-ini-SPLITBUF(17:5)
           .

       tpromo-tpr-chiave-volantino-MERGE-SPLITBUF.
           INITIALIZE tpromo-tpr-chiave-volantino-SPLITBUF
           MOVE tpr-ini-volantino OF tpromo(1:8) TO 
           tpromo-tpr-chiave-volantino-SPLITBUF(1:8)
           MOVE tpr-fine-volantino OF tpromo(1:8) TO 
           tpromo-tpr-chiave-volantino-SPLITBUF(9:8)
           MOVE tpr-gdo OF tpromo(1:5) TO 
           tpromo-tpr-chiave-volantino-SPLITBUF(17:5)
           .

       tpromo-tpr-k-fine-vol-MERGE-SPLITBUF.
           INITIALIZE tpromo-tpr-k-fine-vol-SPLITBUF
           MOVE tpr-fine-volantino OF tpromo(1:8) TO 
           tpromo-tpr-k-fine-vol-SPLITBUF(1:8)
           MOVE tpr-ini-volantino OF tpromo(1:8) TO 
           tpromo-tpr-k-fine-vol-SPLITBUF(9:8)
           MOVE tpr-gdo OF tpromo(1:5) TO 
           tpromo-tpr-k-fine-vol-SPLITBUF(17:5)
           .

       tpromo-tpr-k-data-ins-MERGE-SPLITBUF.
           INITIALIZE tpromo-tpr-k-data-ins-SPLITBUF
           MOVE tpr-data-creazione OF tpromo(1:8) TO 
           tpromo-tpr-k-data-ins-SPLITBUF(1:8)
           MOVE tpr-codice OF tpromo(1:15) TO 
           tpromo-tpr-k-data-ins-SPLITBUF(9:15)
           MOVE tpr-gdo OF tpromo(1:5) TO 
           tpromo-tpr-k-data-ins-SPLITBUF(24:5)
           .

       DataSet1-tpromo-INITSTART.
           IF DataSet1-tpromo-KEY-Asc
              MOVE Low-Value TO tpr-chiave OF tpromo
           ELSE
              MOVE High-Value TO tpr-chiave OF tpromo
           END-IF
           .

       DataSet1-tpromo-INITEND.
           IF DataSet1-tpromo-KEY-Asc
              MOVE High-Value TO tpr-chiave OF tpromo
           ELSE
              MOVE Low-Value TO tpr-chiave OF tpromo
           END-IF
           .

      * tpromo
       DataSet1-tpromo-START.
           IF DataSet1-tpromo-KEY-Asc
              START tpromo KEY >= tpr-chiave OF tpromo
           ELSE
              START tpromo KEY <= tpr-chiave OF tpromo
           END-IF
           .

       DataSet1-tpromo-START-NOTGREATER.
           IF DataSet1-tpromo-KEY-Asc
              START tpromo KEY <= tpr-chiave OF tpromo
           ELSE
              START tpromo KEY >= tpr-chiave OF tpromo
           END-IF
           .

       DataSet1-tpromo-START-GREATER.
           IF DataSet1-tpromo-KEY-Asc
              START tpromo KEY > tpr-chiave OF tpromo
           ELSE
              START tpromo KEY < tpr-chiave OF tpromo
           END-IF
           .

       DataSet1-tpromo-START-LESS.
           IF DataSet1-tpromo-KEY-Asc
              START tpromo KEY < tpr-chiave OF tpromo
           ELSE
              START tpromo KEY > tpr-chiave OF tpromo
           END-IF
           .

       DataSet1-tpromo-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tpromo-LOCK
              READ tpromo WITH LOCK 
              KEY tpr-chiave OF tpromo
           ELSE
              READ tpromo WITH NO LOCK 
              KEY tpr-chiave OF tpromo
           END-IF
           PERFORM tpromo-tpr-chiave-ricerca-MERGE-SPLITBUF
           PERFORM tpromo-tpr-chiave-gdo-fine-MERGE-SPLITBUF
           PERFORM tpromo-tpr-chiave-fine-MERGE-SPLITBUF
           PERFORM tpromo-tpr-chiave-ini-MERGE-SPLITBUF
           PERFORM tpromo-tpr-chiave-volantino-MERGE-SPLITBUF
           PERFORM tpromo-tpr-k-fine-vol-MERGE-SPLITBUF
           PERFORM tpromo-tpr-k-data-ins-MERGE-SPLITBUF
           MOVE STATUS-tpromo TO TOTEM-ERR-STAT 
           MOVE "tpromo" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tpromo-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tpromo-KEY-Asc
              IF DataSet1-tpromo-LOCK
                 READ tpromo NEXT WITH LOCK
              ELSE
                 READ tpromo NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tpromo-LOCK
                 READ tpromo PREVIOUS WITH LOCK
              ELSE
                 READ tpromo PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tpromo-tpr-chiave-ricerca-MERGE-SPLITBUF
           PERFORM tpromo-tpr-chiave-gdo-fine-MERGE-SPLITBUF
           PERFORM tpromo-tpr-chiave-fine-MERGE-SPLITBUF
           PERFORM tpromo-tpr-chiave-ini-MERGE-SPLITBUF
           PERFORM tpromo-tpr-chiave-volantino-MERGE-SPLITBUF
           PERFORM tpromo-tpr-k-fine-vol-MERGE-SPLITBUF
           PERFORM tpromo-tpr-k-data-ins-MERGE-SPLITBUF
           MOVE STATUS-tpromo TO TOTEM-ERR-STAT
           MOVE "tpromo" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tpromo-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tpromo-KEY-Asc
              IF DataSet1-tpromo-LOCK
                 READ tpromo PREVIOUS WITH LOCK
              ELSE
                 READ tpromo PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tpromo-LOCK
                 READ tpromo NEXT WITH LOCK
              ELSE
                 READ tpromo NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tpromo-tpr-chiave-ricerca-MERGE-SPLITBUF
           PERFORM tpromo-tpr-chiave-gdo-fine-MERGE-SPLITBUF
           PERFORM tpromo-tpr-chiave-fine-MERGE-SPLITBUF
           PERFORM tpromo-tpr-chiave-ini-MERGE-SPLITBUF
           PERFORM tpromo-tpr-chiave-volantino-MERGE-SPLITBUF
           PERFORM tpromo-tpr-k-fine-vol-MERGE-SPLITBUF
           PERFORM tpromo-tpr-k-data-ins-MERGE-SPLITBUF
           MOVE STATUS-tpromo TO TOTEM-ERR-STAT
           MOVE "tpromo" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tpromo-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, BeforeWrite>
      * <TOTEM:END>
           WRITE tpr-rec OF tpromo.
           MOVE STATUS-tpromo TO TOTEM-ERR-STAT
           MOVE "tpromo" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tpromo-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, BeforeRewrite>
      * <TOTEM:END>
           REWRITE tpr-rec OF tpromo.
           MOVE STATUS-tpromo TO TOTEM-ERR-STAT
           MOVE "tpromo" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tpromo-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, BeforeDelete>
      * <TOTEM:END>
           DELETE tpromo.
           MOVE STATUS-tpromo TO TOTEM-ERR-STAT
           MOVE "tpromo" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tmp-promo-prz-INITSTART.
           IF DataSet1-tmp-promo-prz-KEY-Asc
              MOVE Low-Value TO tprz-chiave
           ELSE
              MOVE High-Value TO tprz-chiave
           END-IF
           .

       DataSet1-tmp-promo-prz-INITEND.
           IF DataSet1-tmp-promo-prz-KEY-Asc
              MOVE High-Value TO tprz-chiave
           ELSE
              MOVE Low-Value TO tprz-chiave
           END-IF
           .

      * tmp-promo-prz
       DataSet1-tmp-promo-prz-START.
           IF DataSet1-tmp-promo-prz-KEY-Asc
              START tmp-promo-prz KEY >= tprz-chiave
           ELSE
              START tmp-promo-prz KEY <= tprz-chiave
           END-IF
           .

       DataSet1-tmp-promo-prz-START-NOTGREATER.
           IF DataSet1-tmp-promo-prz-KEY-Asc
              START tmp-promo-prz KEY <= tprz-chiave
           ELSE
              START tmp-promo-prz KEY >= tprz-chiave
           END-IF
           .

       DataSet1-tmp-promo-prz-START-GREATER.
           IF DataSet1-tmp-promo-prz-KEY-Asc
              START tmp-promo-prz KEY > tprz-chiave
           ELSE
              START tmp-promo-prz KEY < tprz-chiave
           END-IF
           .

       DataSet1-tmp-promo-prz-START-LESS.
           IF DataSet1-tmp-promo-prz-KEY-Asc
              START tmp-promo-prz KEY < tprz-chiave
           ELSE
              START tmp-promo-prz KEY > tprz-chiave
           END-IF
           .

       DataSet1-tmp-promo-prz-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-promo-prz, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-promo-prz, BeforeReadRecord>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-promo-prz, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-promo-prz, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tmp-promo-prz-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-promo-prz, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-promo-prz, BeforeReadNext>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-promo-prz, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-promo-prz, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tmp-promo-prz-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-promo-prz, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-promo-prz, BeforeReadPrev>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-promo-prz, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-promo-prz, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tmp-promo-prz-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-promo-prz, BeforeWrite>
      * <TOTEM:END>
           WRITE tprz-rec OF tmp-promo-prz.
           MOVE STATUS-tmp-promo-prz TO TOTEM-ERR-STAT
           MOVE "tmp-promo-prz" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-promo-prz, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tmp-promo-prz-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-promo-prz, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tmp-promo-prz TO TOTEM-ERR-STAT
           MOVE "tmp-promo-prz" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-promo-prz, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tmp-promo-prz-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-promo-prz, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tmp-promo-prz TO TOTEM-ERR-STAT
           MOVE "tmp-promo-prz" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-promo-prz, AfterDelete>
      * <TOTEM:END>
           .

       listini-lst-k-articolo-MERGE-SPLITBUF.
           INITIALIZE listini-lst-k-articolo-SPLITBUF
           MOVE lst-gdo OF listini(1:5) TO 
           listini-lst-k-articolo-SPLITBUF(1:5)
           MOVE lst-articolo OF listini(1:6) TO 
           listini-lst-k-articolo-SPLITBUF(6:6)
           MOVE lst-data OF listini(1:8) TO 
           listini-lst-k-articolo-SPLITBUF(12:8)
           .

       listini-lst-k-cod-art-cli-MERGE-SPLITBUF.
           INITIALIZE listini-lst-k-cod-art-cli-SPLITBUF
           MOVE lst-gdo OF listini(1:5) TO 
           listini-lst-k-cod-art-cli-SPLITBUF(1:5)
           MOVE lst-cod-art-cli OF listini(1:15) TO 
           listini-lst-k-cod-art-cli-SPLITBUF(6:15)
           MOVE lst-data OF listini(1:8) TO 
           listini-lst-k-cod-art-cli-SPLITBUF(21:8)
           .

       listini-lst-k-data-MERGE-SPLITBUF.
           INITIALIZE listini-lst-k-data-SPLITBUF
           MOVE lst-data OF listini(1:8) TO 
           listini-lst-k-data-SPLITBUF(1:8)
           MOVE lst-gdo OF listini(1:5) TO 
           listini-lst-k-data-SPLITBUF(9:5)
           MOVE lst-cod-art-cli OF listini(1:15) TO 
           listini-lst-k-data-SPLITBUF(14:15)
           .

       DataSet1-listini-INITSTART.
           IF DataSet1-listini-KEY-Asc
              MOVE Low-Value TO lst-chiave OF listini
           ELSE
              MOVE High-Value TO lst-chiave OF listini
           END-IF
           .

       DataSet1-listini-INITEND.
           IF DataSet1-listini-KEY-Asc
              MOVE High-Value TO lst-chiave OF listini
           ELSE
              MOVE Low-Value TO lst-chiave OF listini
           END-IF
           .

      * listini
       DataSet1-listini-START.
           IF DataSet1-listini-KEY-Asc
              START listini KEY >= lst-chiave OF listini
           ELSE
              START listini KEY <= lst-chiave OF listini
           END-IF
           .

       DataSet1-listini-START-NOTGREATER.
           IF DataSet1-listini-KEY-Asc
              START listini KEY <= lst-chiave OF listini
           ELSE
              START listini KEY >= lst-chiave OF listini
           END-IF
           .

       DataSet1-listini-START-GREATER.
           IF DataSet1-listini-KEY-Asc
              START listini KEY > lst-chiave OF listini
           ELSE
              START listini KEY < lst-chiave OF listini
           END-IF
           .

       DataSet1-listini-START-LESS.
           IF DataSet1-listini-KEY-Asc
              START listini KEY < lst-chiave OF listini
           ELSE
              START listini KEY > lst-chiave OF listini
           END-IF
           .

       DataSet1-listini-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:listini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:listini, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-listini-LOCK
              READ listini WITH LOCK 
              KEY lst-chiave OF listini
           ELSE
              READ listini WITH NO LOCK 
              KEY lst-chiave OF listini
           END-IF
           PERFORM listini-lst-k-articolo-MERGE-SPLITBUF
           PERFORM listini-lst-k-cod-art-cli-MERGE-SPLITBUF
           PERFORM listini-lst-k-data-MERGE-SPLITBUF
           MOVE STATUS-listini TO TOTEM-ERR-STAT 
           MOVE "listini" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:listini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:listini, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-listini-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:listini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:listini, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-listini-KEY-Asc
              IF DataSet1-listini-LOCK
                 READ listini NEXT WITH LOCK
              ELSE
                 READ listini NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-listini-LOCK
                 READ listini PREVIOUS WITH LOCK
              ELSE
                 READ listini PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM listini-lst-k-articolo-MERGE-SPLITBUF
           PERFORM listini-lst-k-cod-art-cli-MERGE-SPLITBUF
           PERFORM listini-lst-k-data-MERGE-SPLITBUF
           MOVE STATUS-listini TO TOTEM-ERR-STAT
           MOVE "listini" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:listini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:listini, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-listini-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:listini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:listini, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-listini-KEY-Asc
              IF DataSet1-listini-LOCK
                 READ listini PREVIOUS WITH LOCK
              ELSE
                 READ listini PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-listini-LOCK
                 READ listini NEXT WITH LOCK
              ELSE
                 READ listini NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM listini-lst-k-articolo-MERGE-SPLITBUF
           PERFORM listini-lst-k-cod-art-cli-MERGE-SPLITBUF
           PERFORM listini-lst-k-data-MERGE-SPLITBUF
           MOVE STATUS-listini TO TOTEM-ERR-STAT
           MOVE "listini" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:listini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:listini, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-listini-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:listini, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-listini TO TOTEM-ERR-STAT
           MOVE "listini" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:listini, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-listini-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:listini, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-listini TO TOTEM-ERR-STAT
           MOVE "listini" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:listini, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-listini-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:listini, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-listini TO TOTEM-ERR-STAT
           MOVE "listini" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:listini, AfterDelete>
      * <TOTEM:END>
           .

       locali-loc-chiave-gdo-fine-MERGE-SPLITBUF.
           INITIALIZE locali-loc-chiave-gdo-fine-SPLITBUF
           MOVE loc-gdo(1:5) TO locali-loc-chiave-gdo-fine-SPLITBUF(1:5)
           MOVE loc-cliente(1:5) TO 
           locali-loc-chiave-gdo-fine-SPLITBUF(6:5)
           MOVE loc-destino(1:5) TO 
           locali-loc-chiave-gdo-fine-SPLITBUF(11:5)
           MOVE loc-fine-dpo(1:8) TO 
           locali-loc-chiave-gdo-fine-SPLITBUF(16:8)
           MOVE loc-ini-dpo(1:8) TO 
           locali-loc-chiave-gdo-fine-SPLITBUF(24:8)
           .

       locali-loc-chiave-fine-MERGE-SPLITBUF.
           INITIALIZE locali-loc-chiave-fine-SPLITBUF
           MOVE loc-fine-dpo(1:8) TO 
           locali-loc-chiave-fine-SPLITBUF(1:8)
           MOVE loc-ini-dpo(1:8) TO locali-loc-chiave-fine-SPLITBUF(9:8)
           MOVE loc-gdo(1:5) TO locali-loc-chiave-fine-SPLITBUF(17:5)
           MOVE loc-cliente(1:5) TO 
           locali-loc-chiave-fine-SPLITBUF(22:5)
           MOVE loc-destino(1:5) TO 
           locali-loc-chiave-fine-SPLITBUF(27:5)
           .

       locali-loc-chiave-ini-MERGE-SPLITBUF.
           INITIALIZE locali-loc-chiave-ini-SPLITBUF
           MOVE loc-ini-dpo(1:8) TO locali-loc-chiave-ini-SPLITBUF(1:8)
           MOVE loc-fine-dpo(1:8) TO locali-loc-chiave-ini-SPLITBUF(9:8)
           MOVE loc-gdo(1:5) TO locali-loc-chiave-ini-SPLITBUF(17:5)
           MOVE loc-cliente(1:5) TO locali-loc-chiave-ini-SPLITBUF(22:5)
           MOVE loc-destino(1:5) TO locali-loc-chiave-ini-SPLITBUF(27:5)
           .

       DataSet1-locali-INITSTART.
           IF DataSet1-locali-KEY-Asc
              MOVE Low-Value TO loc-chiave
           ELSE
              MOVE High-Value TO loc-chiave
           END-IF
           .

       DataSet1-locali-INITEND.
           IF DataSet1-locali-KEY-Asc
              MOVE High-Value TO loc-chiave
           ELSE
              MOVE Low-Value TO loc-chiave
           END-IF
           .

      * locali
       DataSet1-locali-START.
           IF DataSet1-locali-KEY-Asc
              START locali KEY >= loc-chiave
           ELSE
              START locali KEY <= loc-chiave
           END-IF
           .

       DataSet1-locali-START-NOTGREATER.
           IF DataSet1-locali-KEY-Asc
              START locali KEY <= loc-chiave
           ELSE
              START locali KEY >= loc-chiave
           END-IF
           .

       DataSet1-locali-START-GREATER.
           IF DataSet1-locali-KEY-Asc
              START locali KEY > loc-chiave
           ELSE
              START locali KEY < loc-chiave
           END-IF
           .

       DataSet1-locali-START-LESS.
           IF DataSet1-locali-KEY-Asc
              START locali KEY < loc-chiave
           ELSE
              START locali KEY > loc-chiave
           END-IF
           .

       DataSet1-locali-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:locali, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:locali, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-locali-LOCK
              READ locali WITH LOCK 
              KEY loc-chiave
           ELSE
              READ locali WITH NO LOCK 
              KEY loc-chiave
           END-IF
           PERFORM locali-loc-chiave-gdo-fine-MERGE-SPLITBUF
           PERFORM locali-loc-chiave-fine-MERGE-SPLITBUF
           PERFORM locali-loc-chiave-ini-MERGE-SPLITBUF
           MOVE STATUS-locali TO TOTEM-ERR-STAT 
           MOVE "locali" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:locali, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:locali, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-locali-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:locali, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:locali, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-locali-KEY-Asc
              IF DataSet1-locali-LOCK
                 READ locali NEXT WITH LOCK
              ELSE
                 READ locali NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-locali-LOCK
                 READ locali PREVIOUS WITH LOCK
              ELSE
                 READ locali PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM locali-loc-chiave-gdo-fine-MERGE-SPLITBUF
           PERFORM locali-loc-chiave-fine-MERGE-SPLITBUF
           PERFORM locali-loc-chiave-ini-MERGE-SPLITBUF
           MOVE STATUS-locali TO TOTEM-ERR-STAT
           MOVE "locali" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:locali, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:locali, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-locali-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:locali, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:locali, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-locali-KEY-Asc
              IF DataSet1-locali-LOCK
                 READ locali PREVIOUS WITH LOCK
              ELSE
                 READ locali PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-locali-LOCK
                 READ locali NEXT WITH LOCK
              ELSE
                 READ locali NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM locali-loc-chiave-gdo-fine-MERGE-SPLITBUF
           PERFORM locali-loc-chiave-fine-MERGE-SPLITBUF
           PERFORM locali-loc-chiave-ini-MERGE-SPLITBUF
           MOVE STATUS-locali TO TOTEM-ERR-STAT
           MOVE "locali" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:locali, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:locali, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-locali-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:locali, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-locali TO TOTEM-ERR-STAT
           MOVE "locali" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:locali, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-locali-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:locali, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-locali TO TOTEM-ERR-STAT
           MOVE "locali" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:locali, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-locali-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:locali, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-locali TO TOTEM-ERR-STAT
           MOVE "locali" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:locali, AfterDelete>
      * <TOTEM:END>
           .

       blister-k-magaz-MERGE-SPLITBUF.
           INITIALIZE blister-k-magaz-SPLITBUF
           MOVE bli-magazzino(1:3) TO blister-k-magaz-SPLITBUF(1:3)
           MOVE bli-codice(1:6) TO blister-k-magaz-SPLITBUF(4:6)
           .

       blister-k-des-MERGE-SPLITBUF.
           INITIALIZE blister-k-des-SPLITBUF
           MOVE bli-descrizione(1:50) TO blister-k-des-SPLITBUF(1:50)
           .

       DataSet1-blister-INITSTART.
           IF DataSet1-blister-KEY-Asc
              MOVE Low-Value TO bli-chiave
           ELSE
              MOVE High-Value TO bli-chiave
           END-IF
           .

       DataSet1-blister-INITEND.
           IF DataSet1-blister-KEY-Asc
              MOVE High-Value TO bli-chiave
           ELSE
              MOVE Low-Value TO bli-chiave
           END-IF
           .

      * blister
       DataSet1-blister-START.
           IF DataSet1-blister-KEY-Asc
              START blister KEY >= bli-chiave
           ELSE
              START blister KEY <= bli-chiave
           END-IF
           .

       DataSet1-blister-START-NOTGREATER.
           IF DataSet1-blister-KEY-Asc
              START blister KEY <= bli-chiave
           ELSE
              START blister KEY >= bli-chiave
           END-IF
           .

       DataSet1-blister-START-GREATER.
           IF DataSet1-blister-KEY-Asc
              START blister KEY > bli-chiave
           ELSE
              START blister KEY < bli-chiave
           END-IF
           .

       DataSet1-blister-START-LESS.
           IF DataSet1-blister-KEY-Asc
              START blister KEY < bli-chiave
           ELSE
              START blister KEY > bli-chiave
           END-IF
           .

       DataSet1-blister-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:blister, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:blister, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-blister-LOCK
              READ blister WITH LOCK 
              KEY bli-chiave
           ELSE
              READ blister WITH NO LOCK 
              KEY bli-chiave
           END-IF
           PERFORM blister-k-magaz-MERGE-SPLITBUF
           PERFORM blister-k-des-MERGE-SPLITBUF
           MOVE STATUS-blister TO TOTEM-ERR-STAT 
           MOVE "blister" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:blister, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:blister, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-blister-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:blister, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:blister, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-blister-KEY-Asc
              IF DataSet1-blister-LOCK
                 READ blister NEXT WITH LOCK
              ELSE
                 READ blister NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-blister-LOCK
                 READ blister PREVIOUS WITH LOCK
              ELSE
                 READ blister PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM blister-k-magaz-MERGE-SPLITBUF
           PERFORM blister-k-des-MERGE-SPLITBUF
           MOVE STATUS-blister TO TOTEM-ERR-STAT
           MOVE "blister" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:blister, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:blister, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-blister-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:blister, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:blister, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-blister-KEY-Asc
              IF DataSet1-blister-LOCK
                 READ blister PREVIOUS WITH LOCK
              ELSE
                 READ blister PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-blister-LOCK
                 READ blister NEXT WITH LOCK
              ELSE
                 READ blister NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM blister-k-magaz-MERGE-SPLITBUF
           PERFORM blister-k-des-MERGE-SPLITBUF
           MOVE STATUS-blister TO TOTEM-ERR-STAT
           MOVE "blister" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:blister, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:blister, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-blister-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:blister, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-blister TO TOTEM-ERR-STAT
           MOVE "blister" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:blister, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-blister-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:blister, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-blister TO TOTEM-ERR-STAT
           MOVE "blister" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:blister, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-blister-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:blister, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-blister TO TOTEM-ERR-STAT
           MOVE "blister" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:blister, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-cli-prg-INITSTART.
           IF DataSet1-cli-prg-KEY-Asc
              MOVE Low-Value TO cp-chiave
           ELSE
              MOVE High-Value TO cp-chiave
           END-IF
           .

       DataSet1-cli-prg-INITEND.
           IF DataSet1-cli-prg-KEY-Asc
              MOVE High-Value TO cp-chiave
           ELSE
              MOVE Low-Value TO cp-chiave
           END-IF
           .

      * cli-prg
       DataSet1-cli-prg-START.
           IF DataSet1-cli-prg-KEY-Asc
              START cli-prg KEY >= cp-chiave
           ELSE
              START cli-prg KEY <= cp-chiave
           END-IF
           .

       DataSet1-cli-prg-START-NOTGREATER.
           IF DataSet1-cli-prg-KEY-Asc
              START cli-prg KEY <= cp-chiave
           ELSE
              START cli-prg KEY >= cp-chiave
           END-IF
           .

       DataSet1-cli-prg-START-GREATER.
           IF DataSet1-cli-prg-KEY-Asc
              START cli-prg KEY > cp-chiave
           ELSE
              START cli-prg KEY < cp-chiave
           END-IF
           .

       DataSet1-cli-prg-START-LESS.
           IF DataSet1-cli-prg-KEY-Asc
              START cli-prg KEY < cp-chiave
           ELSE
              START cli-prg KEY > cp-chiave
           END-IF
           .

       DataSet1-cli-prg-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:cli-prg, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:cli-prg, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-cli-prg-LOCK
              READ cli-prg WITH LOCK 
              KEY cp-chiave
           ELSE
              READ cli-prg WITH NO LOCK 
              KEY cp-chiave
           END-IF
           MOVE STATUS-cli-prg TO TOTEM-ERR-STAT 
           MOVE "cli-prg" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:cli-prg, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:cli-prg, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-cli-prg-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:cli-prg, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:cli-prg, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-cli-prg-KEY-Asc
              IF DataSet1-cli-prg-LOCK
                 READ cli-prg NEXT WITH LOCK
              ELSE
                 READ cli-prg NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-cli-prg-LOCK
                 READ cli-prg PREVIOUS WITH LOCK
              ELSE
                 READ cli-prg PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-cli-prg TO TOTEM-ERR-STAT
           MOVE "cli-prg" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:cli-prg, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:cli-prg, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-cli-prg-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:cli-prg, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:cli-prg, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-cli-prg-KEY-Asc
              IF DataSet1-cli-prg-LOCK
                 READ cli-prg PREVIOUS WITH LOCK
              ELSE
                 READ cli-prg PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-cli-prg-LOCK
                 READ cli-prg NEXT WITH LOCK
              ELSE
                 READ cli-prg NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-cli-prg TO TOTEM-ERR-STAT
           MOVE "cli-prg" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:cli-prg, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:cli-prg, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-cli-prg-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:cli-prg, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-cli-prg TO TOTEM-ERR-STAT
           MOVE "cli-prg" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:cli-prg, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-cli-prg-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:cli-prg, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-cli-prg TO TOTEM-ERR-STAT
           MOVE "cli-prg" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:cli-prg, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-cli-prg-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:cli-prg, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-cli-prg TO TOTEM-ERR-STAT
           MOVE "cli-prg" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:cli-prg, AfterDelete>
      * <TOTEM:END>
           .

       tcodpag-TBL-CODICE-01-MERGE-SPLITBUF.
           INITIALIZE tcodpag-TBL-CODICE-01-SPLITBUF
           MOVE TBLPA-CODICE1(1:2) TO 
           tcodpag-TBL-CODICE-01-SPLITBUF(1:2)
           MOVE TBLPA-DESCRIZIONE1(1:30) TO 
           tcodpag-TBL-CODICE-01-SPLITBUF(3:30)
           MOVE TBLPA-CODICE2(1:20) TO 
           tcodpag-TBL-CODICE-01-SPLITBUF(33:20)
           .

       DataSet1-tcodpag-INITSTART.
           IF DataSet1-tcodpag-KEY-Asc
              MOVE Low-Value TO TBLPA-CODICE
           ELSE
              MOVE High-Value TO TBLPA-CODICE
           END-IF
           .

       DataSet1-tcodpag-INITEND.
           IF DataSet1-tcodpag-KEY-Asc
              MOVE High-Value TO TBLPA-CODICE
           ELSE
              MOVE Low-Value TO TBLPA-CODICE
           END-IF
           .

      * tcodpag
       DataSet1-tcodpag-START.
           IF DataSet1-tcodpag-KEY-Asc
              START tcodpag KEY >= TBLPA-CODICE
           ELSE
              START tcodpag KEY <= TBLPA-CODICE
           END-IF
           .

       DataSet1-tcodpag-START-NOTGREATER.
           IF DataSet1-tcodpag-KEY-Asc
              START tcodpag KEY <= TBLPA-CODICE
           ELSE
              START tcodpag KEY >= TBLPA-CODICE
           END-IF
           .

       DataSet1-tcodpag-START-GREATER.
           IF DataSet1-tcodpag-KEY-Asc
              START tcodpag KEY > TBLPA-CODICE
           ELSE
              START tcodpag KEY < TBLPA-CODICE
           END-IF
           .

       DataSet1-tcodpag-START-LESS.
           IF DataSet1-tcodpag-KEY-Asc
              START tcodpag KEY < TBLPA-CODICE
           ELSE
              START tcodpag KEY > TBLPA-CODICE
           END-IF
           .

       DataSet1-tcodpag-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tcodpag-LOCK
              READ tcodpag WITH LOCK 
              KEY TBLPA-CODICE
           ELSE
              READ tcodpag WITH NO LOCK 
              KEY TBLPA-CODICE
           END-IF
           PERFORM tcodpag-TBL-CODICE-01-MERGE-SPLITBUF
           MOVE status-tcodpag TO TOTEM-ERR-STAT 
           MOVE "tcodpag" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tcodpag-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tcodpag-KEY-Asc
              IF DataSet1-tcodpag-LOCK
                 READ tcodpag NEXT WITH LOCK
              ELSE
                 READ tcodpag NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tcodpag-LOCK
                 READ tcodpag PREVIOUS WITH LOCK
              ELSE
                 READ tcodpag PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tcodpag-TBL-CODICE-01-MERGE-SPLITBUF
           MOVE status-tcodpag TO TOTEM-ERR-STAT
           MOVE "tcodpag" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tcodpag-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tcodpag-KEY-Asc
              IF DataSet1-tcodpag-LOCK
                 READ tcodpag PREVIOUS WITH LOCK
              ELSE
                 READ tcodpag PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tcodpag-LOCK
                 READ tcodpag NEXT WITH LOCK
              ELSE
                 READ tcodpag NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tcodpag-TBL-CODICE-01-MERGE-SPLITBUF
           MOVE status-tcodpag TO TOTEM-ERR-STAT
           MOVE "tcodpag" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tcodpag-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeWrite>
      * <TOTEM:END>
           MOVE status-tcodpag TO TOTEM-ERR-STAT
           MOVE "tcodpag" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tcodpag-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeRewrite>
      * <TOTEM:END>
           MOVE status-tcodpag TO TOTEM-ERR-STAT
           MOVE "tcodpag" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tcodpag-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeDelete>
      * <TOTEM:END>
           MOVE status-tcodpag TO TOTEM-ERR-STAT
           MOVE "tcodpag" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterDelete>
      * <TOTEM:END>
           .

       tmp-progmag-zoom-key-des-MERGE-SPLITBUF.
           INITIALIZE tmp-progmag-zoom-key-des-SPLITBUF
           MOVE tmp-prg-z-art-des(1:40) TO 
           tmp-progmag-zoom-key-des-SPLITBUF(1:40)
           MOVE tmp-prg-z-chiave(1:23) TO 
           tmp-progmag-zoom-key-des-SPLITBUF(41:23)
           .

       tmp-progmag-zoom-key-des-SPLITBUF-TOFLD.
           MOVE tmp-progmag-zoom-key-des-SPLITBUF(1:40) TO 
           tmp-prg-z-art-des(1:40)
           MOVE tmp-progmag-zoom-key-des-SPLITBUF(41:23) TO 
           tmp-prg-z-chiave(1:23)
           .

       tmp-progmag-zoom-key-art-MERGE-SPLITBUF.
           INITIALIZE tmp-progmag-zoom-key-art-SPLITBUF
           MOVE tmp-prg-z-cod-articolo(1:6) TO 
           tmp-progmag-zoom-key-art-SPLITBUF(1:6)
           .

       DataSet1-tmp-progmag-zoom-INITSTART.
           IF DataSet1-tmp-progmag-zoom-KEY-Asc
              MOVE Low-Value TO tmp-prg-z-art-des
           ELSE
              MOVE High-Value TO tmp-prg-z-art-des
           END-IF
           IF DataSet1-tmp-progmag-zoom-KEY-Asc
              MOVE Low-Value TO tmp-prg-z-chiave
           ELSE
              MOVE High-Value TO tmp-prg-z-chiave
           END-IF
           .

       DataSet1-tmp-progmag-zoom-INITEND.
           IF DataSet1-tmp-progmag-zoom-KEY-Asc
              MOVE High-Value to tmp-prg-z-art-des
           ELSE
              MOVE Low-Value to tmp-prg-z-art-des
           END-IF
           IF DataSet1-tmp-progmag-zoom-KEY-Asc
              MOVE High-Value to tmp-prg-z-chiave
           ELSE
              MOVE Low-Value to tmp-prg-z-chiave
           END-IF
           .

       DataSet1-tmp-progmag-zoom-TMPBUF-TO-FLD.
           MOVE DataSet1-tmp-progmag-zoom-SPLIT-BUF1(1:40) TO
                tmp-prg-z-art-des(1:40)
           MOVE DataSet1-tmp-progmag-zoom-SPLIT-BUF1(41:23) TO
                tmp-prg-z-chiave(1:23)
           .

       DataSet1-tmp-progmag-zoom-FLD-TO-TMPBUF.
           MOVE tmp-prg-z-art-des(1:40) TO
                DataSet1-tmp-progmag-zoom-SPLIT-BUF1(1:40)
           MOVE tmp-prg-z-chiave(1:23) TO
                DataSet1-tmp-progmag-zoom-SPLIT-BUF1(41:23)
           .

      * tmp-progmag-zoom
       DataSet1-tmp-progmag-zoom-START.
           IF DataSet1-tmp-progmag-zoom-KEY-Asc
              START tmp-progmag-zoom KEY >= key-des
           ELSE
              START tmp-progmag-zoom KEY <= key-des
           END-IF
           .

       DataSet1-tmp-progmag-zoom-START-NOTGREATER.
           IF DataSet1-tmp-progmag-zoom-KEY-Asc
              START tmp-progmag-zoom KEY <= key-des
           ELSE
              START tmp-progmag-zoom KEY >= key-des
           END-IF
           .

       DataSet1-tmp-progmag-zoom-START-GREATER.
           IF DataSet1-tmp-progmag-zoom-KEY-Asc
              START tmp-progmag-zoom KEY > key-des
           ELSE
              START tmp-progmag-zoom KEY < key-des
           END-IF
           .

       DataSet1-tmp-progmag-zoom-START-LESS.
           IF DataSet1-tmp-progmag-zoom-KEY-Asc
              START tmp-progmag-zoom KEY < key-des
           ELSE
              START tmp-progmag-zoom KEY > key-des
           END-IF
           .

       DataSet1-tmp-progmag-zoom-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, BeforeReadRecord>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tmp-progmag-zoom-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, BeforeReadNext>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tmp-progmag-zoom-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, BeforeReadPrev>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tmp-progmag-zoom-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, BeforeWrite>
      * <TOTEM:END>
           WRITE tmp-prg-z-rec OF tmp-progmag-zoom.
           MOVE STATUS-tmp-progmag-zoom TO TOTEM-ERR-STAT
           MOVE "tmp-progmag-zoom" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tmp-progmag-zoom-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tmp-progmag-zoom TO TOTEM-ERR-STAT
           MOVE "tmp-progmag-zoom" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tmp-progmag-zoom-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tmp-progmag-zoom TO TOTEM-ERR-STAT
           MOVE "tmp-progmag-zoom" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-timballi-INITSTART.
           IF DataSet1-timballi-KEY-Asc
              MOVE Low-Value TO imb-chiave
           ELSE
              MOVE High-Value TO imb-chiave
           END-IF
           .

       DataSet1-timballi-INITEND.
           IF DataSet1-timballi-KEY-Asc
              MOVE High-Value TO imb-chiave
           ELSE
              MOVE Low-Value TO imb-chiave
           END-IF
           .

      * timballi
       DataSet1-timballi-START.
           IF DataSet1-timballi-KEY-Asc
              START timballi KEY >= imb-chiave
           ELSE
              START timballi KEY <= imb-chiave
           END-IF
           .

       DataSet1-timballi-START-NOTGREATER.
           IF DataSet1-timballi-KEY-Asc
              START timballi KEY <= imb-chiave
           ELSE
              START timballi KEY >= imb-chiave
           END-IF
           .

       DataSet1-timballi-START-GREATER.
           IF DataSet1-timballi-KEY-Asc
              START timballi KEY > imb-chiave
           ELSE
              START timballi KEY < imb-chiave
           END-IF
           .

       DataSet1-timballi-START-LESS.
           IF DataSet1-timballi-KEY-Asc
              START timballi KEY < imb-chiave
           ELSE
              START timballi KEY > imb-chiave
           END-IF
           .

       DataSet1-timballi-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-timballi-LOCK
              READ timballi WITH LOCK 
              KEY imb-chiave
           ELSE
              READ timballi WITH NO LOCK 
              KEY imb-chiave
           END-IF
           MOVE STATUS-timballi TO TOTEM-ERR-STAT 
           MOVE "timballi" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-timballi-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-timballi-KEY-Asc
              IF DataSet1-timballi-LOCK
                 READ timballi NEXT WITH LOCK
              ELSE
                 READ timballi NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-timballi-LOCK
                 READ timballi PREVIOUS WITH LOCK
              ELSE
                 READ timballi PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-timballi TO TOTEM-ERR-STAT
           MOVE "timballi" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-timballi-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-timballi-KEY-Asc
              IF DataSet1-timballi-LOCK
                 READ timballi PREVIOUS WITH LOCK
              ELSE
                 READ timballi PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-timballi-LOCK
                 READ timballi NEXT WITH LOCK
              ELSE
                 READ timballi NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-timballi TO TOTEM-ERR-STAT
           MOVE "timballi" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-timballi-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-timballi TO TOTEM-ERR-STAT
           MOVE "timballi" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-timballi-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-timballi TO TOTEM-ERR-STAT
           MOVE "timballi" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-timballi-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-timballi TO TOTEM-ERR-STAT
           MOVE "timballi" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tcontat-INITSTART.
           IF DataSet1-tcontat-KEY-Asc
              MOVE Low-Value TO con-chiave
           ELSE
              MOVE High-Value TO con-chiave
           END-IF
           .

       DataSet1-tcontat-INITEND.
           IF DataSet1-tcontat-KEY-Asc
              MOVE High-Value TO con-chiave
           ELSE
              MOVE Low-Value TO con-chiave
           END-IF
           .

      * tcontat
       DataSet1-tcontat-START.
           IF DataSet1-tcontat-KEY-Asc
              START tcontat KEY >= con-chiave
           ELSE
              START tcontat KEY <= con-chiave
           END-IF
           .

       DataSet1-tcontat-START-NOTGREATER.
           IF DataSet1-tcontat-KEY-Asc
              START tcontat KEY <= con-chiave
           ELSE
              START tcontat KEY >= con-chiave
           END-IF
           .

       DataSet1-tcontat-START-GREATER.
           IF DataSet1-tcontat-KEY-Asc
              START tcontat KEY > con-chiave
           ELSE
              START tcontat KEY < con-chiave
           END-IF
           .

       DataSet1-tcontat-START-LESS.
           IF DataSet1-tcontat-KEY-Asc
              START tcontat KEY < con-chiave
           ELSE
              START tcontat KEY > con-chiave
           END-IF
           .

       DataSet1-tcontat-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tcontat-LOCK
              READ tcontat WITH LOCK 
              KEY con-chiave
           ELSE
              READ tcontat WITH NO LOCK 
              KEY con-chiave
           END-IF
           MOVE STATUS-tcontat TO TOTEM-ERR-STAT 
           MOVE "tcontat" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tcontat-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tcontat-KEY-Asc
              IF DataSet1-tcontat-LOCK
                 READ tcontat NEXT WITH LOCK
              ELSE
                 READ tcontat NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tcontat-LOCK
                 READ tcontat PREVIOUS WITH LOCK
              ELSE
                 READ tcontat PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tcontat TO TOTEM-ERR-STAT
           MOVE "tcontat" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tcontat-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tcontat-KEY-Asc
              IF DataSet1-tcontat-LOCK
                 READ tcontat PREVIOUS WITH LOCK
              ELSE
                 READ tcontat PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tcontat-LOCK
                 READ tcontat NEXT WITH LOCK
              ELSE
                 READ tcontat NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tcontat TO TOTEM-ERR-STAT
           MOVE "tcontat" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tcontat-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tcontat TO TOTEM-ERR-STAT
           MOVE "tcontat" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tcontat-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tcontat TO TOTEM-ERR-STAT
           MOVE "tcontat" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tcontat-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tcontat TO TOTEM-ERR-STAT
           MOVE "tcontat" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-lockfile-INITSTART.
           IF DataSet1-lockfile-KEY-Asc
              MOVE Low-Value TO lck-chiave
           ELSE
              MOVE High-Value TO lck-chiave
           END-IF
           .

       DataSet1-lockfile-INITEND.
           IF DataSet1-lockfile-KEY-Asc
              MOVE High-Value TO lck-chiave
           ELSE
              MOVE Low-Value TO lck-chiave
           END-IF
           .

      * lockfile
       DataSet1-lockfile-START.
           IF DataSet1-lockfile-KEY-Asc
              START lockfile KEY >= lck-chiave
           ELSE
              START lockfile KEY <= lck-chiave
           END-IF
           .

       DataSet1-lockfile-START-NOTGREATER.
           IF DataSet1-lockfile-KEY-Asc
              START lockfile KEY <= lck-chiave
           ELSE
              START lockfile KEY >= lck-chiave
           END-IF
           .

       DataSet1-lockfile-START-GREATER.
           IF DataSet1-lockfile-KEY-Asc
              START lockfile KEY > lck-chiave
           ELSE
              START lockfile KEY < lck-chiave
           END-IF
           .

       DataSet1-lockfile-START-LESS.
           IF DataSet1-lockfile-KEY-Asc
              START lockfile KEY < lck-chiave
           ELSE
              START lockfile KEY > lck-chiave
           END-IF
           .

       DataSet1-lockfile-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:lockfile, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lockfile, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-lockfile-LOCK
              READ lockfile WITH LOCK 
              KEY lck-chiave
           ELSE
              READ lockfile WITH NO LOCK 
              KEY lck-chiave
           END-IF
           MOVE STATUS-lockfile TO TOTEM-ERR-STAT 
           MOVE "lockfile" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:lockfile, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lockfile, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-lockfile-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:lockfile, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lockfile, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-lockfile-KEY-Asc
              IF DataSet1-lockfile-LOCK
                 READ lockfile NEXT WITH LOCK
              ELSE
                 READ lockfile NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-lockfile-LOCK
                 READ lockfile PREVIOUS WITH LOCK
              ELSE
                 READ lockfile PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-lockfile TO TOTEM-ERR-STAT
           MOVE "lockfile" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:lockfile, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lockfile, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-lockfile-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:lockfile, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lockfile, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-lockfile-KEY-Asc
              IF DataSet1-lockfile-LOCK
                 READ lockfile PREVIOUS WITH LOCK
              ELSE
                 READ lockfile PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-lockfile-LOCK
                 READ lockfile NEXT WITH LOCK
              ELSE
                 READ lockfile NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-lockfile TO TOTEM-ERR-STAT
           MOVE "lockfile" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:lockfile, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lockfile, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-lockfile-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:lockfile, BeforeWrite>
      * <TOTEM:END>
           WRITE lck-rec OF lockfile.
           MOVE STATUS-lockfile TO TOTEM-ERR-STAT
           MOVE "lockfile" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:lockfile, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-lockfile-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:lockfile, BeforeRewrite>
      * <TOTEM:END>
           REWRITE lck-rec OF lockfile.
           MOVE STATUS-lockfile TO TOTEM-ERR-STAT
           MOVE "lockfile" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:lockfile, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-lockfile-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:lockfile, BeforeDelete>
      * <TOTEM:END>
           DELETE lockfile.
           MOVE STATUS-lockfile TO TOTEM-ERR-STAT
           MOVE "lockfile" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:lockfile, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tnazioni-INITSTART.
           IF DataSet1-tnazioni-KEY-Asc
              MOVE Low-Value TO naz-chiave
           ELSE
              MOVE High-Value TO naz-chiave
           END-IF
           .

       DataSet1-tnazioni-INITEND.
           IF DataSet1-tnazioni-KEY-Asc
              MOVE High-Value TO naz-chiave
           ELSE
              MOVE Low-Value TO naz-chiave
           END-IF
           .

      * tnazioni
       DataSet1-tnazioni-START.
           IF DataSet1-tnazioni-KEY-Asc
              START tnazioni KEY >= naz-chiave
           ELSE
              START tnazioni KEY <= naz-chiave
           END-IF
           .

       DataSet1-tnazioni-START-NOTGREATER.
           IF DataSet1-tnazioni-KEY-Asc
              START tnazioni KEY <= naz-chiave
           ELSE
              START tnazioni KEY >= naz-chiave
           END-IF
           .

       DataSet1-tnazioni-START-GREATER.
           IF DataSet1-tnazioni-KEY-Asc
              START tnazioni KEY > naz-chiave
           ELSE
              START tnazioni KEY < naz-chiave
           END-IF
           .

       DataSet1-tnazioni-START-LESS.
           IF DataSet1-tnazioni-KEY-Asc
              START tnazioni KEY < naz-chiave
           ELSE
              START tnazioni KEY > naz-chiave
           END-IF
           .

       DataSet1-tnazioni-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tnazioni, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tnazioni, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tnazioni-LOCK
              READ tnazioni WITH LOCK 
              KEY naz-chiave
           ELSE
              READ tnazioni WITH NO LOCK 
              KEY naz-chiave
           END-IF
           MOVE STATUS-tnazioni TO TOTEM-ERR-STAT 
           MOVE "tnazioni" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tnazioni, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tnazioni, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tnazioni-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tnazioni, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tnazioni, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tnazioni-KEY-Asc
              IF DataSet1-tnazioni-LOCK
                 READ tnazioni NEXT WITH LOCK
              ELSE
                 READ tnazioni NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tnazioni-LOCK
                 READ tnazioni PREVIOUS WITH LOCK
              ELSE
                 READ tnazioni PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tnazioni TO TOTEM-ERR-STAT
           MOVE "tnazioni" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tnazioni, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tnazioni, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tnazioni-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tnazioni, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tnazioni, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tnazioni-KEY-Asc
              IF DataSet1-tnazioni-LOCK
                 READ tnazioni PREVIOUS WITH LOCK
              ELSE
                 READ tnazioni PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tnazioni-LOCK
                 READ tnazioni NEXT WITH LOCK
              ELSE
                 READ tnazioni NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tnazioni TO TOTEM-ERR-STAT
           MOVE "tnazioni" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tnazioni, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tnazioni, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tnazioni-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tnazioni, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tnazioni TO TOTEM-ERR-STAT
           MOVE "tnazioni" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tnazioni, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tnazioni-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tnazioni, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tnazioni TO TOTEM-ERR-STAT
           MOVE "tnazioni" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tnazioni, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tnazioni-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tnazioni, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tnazioni TO TOTEM-ERR-STAT
           MOVE "tnazioni" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tnazioni, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tscorte-INITSTART.
           IF DataSet1-tscorte-KEY-Asc
              MOVE Low-Value TO sco-chiave
           ELSE
              MOVE High-Value TO sco-chiave
           END-IF
           .

       DataSet1-tscorte-INITEND.
           IF DataSet1-tscorte-KEY-Asc
              MOVE High-Value TO sco-chiave
           ELSE
              MOVE Low-Value TO sco-chiave
           END-IF
           .

      * tscorte
       DataSet1-tscorte-START.
           IF DataSet1-tscorte-KEY-Asc
              START tscorte KEY >= sco-chiave
           ELSE
              START tscorte KEY <= sco-chiave
           END-IF
           .

       DataSet1-tscorte-START-NOTGREATER.
           IF DataSet1-tscorte-KEY-Asc
              START tscorte KEY <= sco-chiave
           ELSE
              START tscorte KEY >= sco-chiave
           END-IF
           .

       DataSet1-tscorte-START-GREATER.
           IF DataSet1-tscorte-KEY-Asc
              START tscorte KEY > sco-chiave
           ELSE
              START tscorte KEY < sco-chiave
           END-IF
           .

       DataSet1-tscorte-START-LESS.
           IF DataSet1-tscorte-KEY-Asc
              START tscorte KEY < sco-chiave
           ELSE
              START tscorte KEY > sco-chiave
           END-IF
           .

       DataSet1-tscorte-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tscorte, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tscorte, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tscorte-LOCK
              READ tscorte WITH LOCK 
              KEY sco-chiave
           ELSE
              READ tscorte WITH NO LOCK 
              KEY sco-chiave
           END-IF
           MOVE STATUS-tscorte TO TOTEM-ERR-STAT 
           MOVE "tscorte" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tscorte, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tscorte, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tscorte-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tscorte, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tscorte, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tscorte-KEY-Asc
              IF DataSet1-tscorte-LOCK
                 READ tscorte NEXT WITH LOCK
              ELSE
                 READ tscorte NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tscorte-LOCK
                 READ tscorte PREVIOUS WITH LOCK
              ELSE
                 READ tscorte PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tscorte TO TOTEM-ERR-STAT
           MOVE "tscorte" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tscorte, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tscorte, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tscorte-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tscorte, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tscorte, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tscorte-KEY-Asc
              IF DataSet1-tscorte-LOCK
                 READ tscorte PREVIOUS WITH LOCK
              ELSE
                 READ tscorte PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tscorte-LOCK
                 READ tscorte NEXT WITH LOCK
              ELSE
                 READ tscorte NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tscorte TO TOTEM-ERR-STAT
           MOVE "tscorte" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tscorte, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tscorte, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tscorte-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tscorte, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tscorte TO TOTEM-ERR-STAT
           MOVE "tscorte" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tscorte, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tscorte-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tscorte, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tscorte TO TOTEM-ERR-STAT
           MOVE "tscorte" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tscorte, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tscorte-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tscorte, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tscorte TO TOTEM-ERR-STAT
           MOVE "tscorte" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tscorte, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tmp-fido-INITSTART.
           IF DataSet1-tmp-fido-KEY-Asc
              MOVE Low-Value TO tfid-chiave
           ELSE
              MOVE High-Value TO tfid-chiave
           END-IF
           .

       DataSet1-tmp-fido-INITEND.
           IF DataSet1-tmp-fido-KEY-Asc
              MOVE High-Value TO tfid-chiave
           ELSE
              MOVE Low-Value TO tfid-chiave
           END-IF
           .

      * tmp-fido
       DataSet1-tmp-fido-START.
           IF DataSet1-tmp-fido-KEY-Asc
              START tmp-fido KEY >= tfid-chiave
           ELSE
              START tmp-fido KEY <= tfid-chiave
           END-IF
           .

       DataSet1-tmp-fido-START-NOTGREATER.
           IF DataSet1-tmp-fido-KEY-Asc
              START tmp-fido KEY <= tfid-chiave
           ELSE
              START tmp-fido KEY >= tfid-chiave
           END-IF
           .

       DataSet1-tmp-fido-START-GREATER.
           IF DataSet1-tmp-fido-KEY-Asc
              START tmp-fido KEY > tfid-chiave
           ELSE
              START tmp-fido KEY < tfid-chiave
           END-IF
           .

       DataSet1-tmp-fido-START-LESS.
           IF DataSet1-tmp-fido-KEY-Asc
              START tmp-fido KEY < tfid-chiave
           ELSE
              START tmp-fido KEY > tfid-chiave
           END-IF
           .

       DataSet1-tmp-fido-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-fido, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-fido, BeforeReadRecord>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-fido, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-fido, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tmp-fido-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-fido, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-fido, BeforeReadNext>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-fido, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-fido, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tmp-fido-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-fido, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-fido, BeforeReadPrev>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-fido, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-fido, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tmp-fido-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-fido, BeforeWrite>
      * <TOTEM:END>
           WRITE tfid-rec OF tmp-fido.
           MOVE STATUS-tmp-fido TO TOTEM-ERR-STAT
           MOVE "tmp-fido" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-fido, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tmp-fido-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-fido, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tmp-fido TO TOTEM-ERR-STAT
           MOVE "tmp-fido" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-fido, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tmp-fido-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-fido, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tmp-fido TO TOTEM-ERR-STAT
           MOVE "tmp-fido" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-fido, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-grade-INITSTART.
           IF DataSet1-grade-KEY-Asc
              MOVE Low-Value TO gra-chiave
           ELSE
              MOVE High-Value TO gra-chiave
           END-IF
           .

       DataSet1-grade-INITEND.
           IF DataSet1-grade-KEY-Asc
              MOVE High-Value TO gra-chiave
           ELSE
              MOVE Low-Value TO gra-chiave
           END-IF
           .

      * grade
       DataSet1-grade-START.
           IF DataSet1-grade-KEY-Asc
              START grade KEY >= gra-chiave
           ELSE
              START grade KEY <= gra-chiave
           END-IF
           .

       DataSet1-grade-START-NOTGREATER.
           IF DataSet1-grade-KEY-Asc
              START grade KEY <= gra-chiave
           ELSE
              START grade KEY >= gra-chiave
           END-IF
           .

       DataSet1-grade-START-GREATER.
           IF DataSet1-grade-KEY-Asc
              START grade KEY > gra-chiave
           ELSE
              START grade KEY < gra-chiave
           END-IF
           .

       DataSet1-grade-START-LESS.
           IF DataSet1-grade-KEY-Asc
              START grade KEY < gra-chiave
           ELSE
              START grade KEY > gra-chiave
           END-IF
           .

       DataSet1-grade-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:grade, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:grade, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-grade-LOCK
              READ grade WITH LOCK 
              KEY gra-chiave
           ELSE
              READ grade WITH NO LOCK 
              KEY gra-chiave
           END-IF
           MOVE STATUS-grade TO TOTEM-ERR-STAT 
           MOVE "grade" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:grade, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:grade, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-grade-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:grade, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:grade, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-grade-KEY-Asc
              IF DataSet1-grade-LOCK
                 READ grade NEXT WITH LOCK
              ELSE
                 READ grade NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-grade-LOCK
                 READ grade PREVIOUS WITH LOCK
              ELSE
                 READ grade PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-grade TO TOTEM-ERR-STAT
           MOVE "grade" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:grade, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:grade, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-grade-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:grade, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:grade, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-grade-KEY-Asc
              IF DataSet1-grade-LOCK
                 READ grade PREVIOUS WITH LOCK
              ELSE
                 READ grade PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-grade-LOCK
                 READ grade NEXT WITH LOCK
              ELSE
                 READ grade NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-grade TO TOTEM-ERR-STAT
           MOVE "grade" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:grade, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:grade, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-grade-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:grade, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-grade TO TOTEM-ERR-STAT
           MOVE "grade" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:grade, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-grade-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:grade, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-grade TO TOTEM-ERR-STAT
           MOVE "grade" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:grade, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-grade-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:grade, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-grade TO TOTEM-ERR-STAT
           MOVE "grade" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:grade, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-log-macrobatch-INITSTART.
           .

       DataSet1-log-macrobatch-INITEND.
           .

       DataSet1-log-macrobatch-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:log-macrobatch, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:log-macrobatch, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-log-macrobatch-LOCK
              READ log-macrobatch WITH LOCK 
           ELSE
              READ log-macrobatch WITH NO LOCK 
           END-IF
           MOVE STATUS-log-macrobatch TO TOTEM-ERR-STAT 
           MOVE "log-macrobatch" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:log-macrobatch, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:log-macrobatch, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-log-macrobatch-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:log-macrobatch, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:log-macrobatch, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-log-macrobatch-KEY-Asc
              IF DataSet1-log-macrobatch-LOCK
                 READ log-macrobatch NEXT WITH LOCK
              ELSE
                 READ log-macrobatch NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-log-macrobatch TO TOTEM-ERR-STAT
           MOVE "log-macrobatch" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:log-macrobatch, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:log-macrobatch, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-log-macrobatch-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:log-macrobatch, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:log-macrobatch, BeforeReadPrev>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:log-macrobatch, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:log-macrobatch, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-log-macrobatch-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:log-macrobatch, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-log-macrobatch TO TOTEM-ERR-STAT
           MOVE "log-macrobatch" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:log-macrobatch, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-log-macrobatch-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:log-macrobatch, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-log-macrobatch TO TOTEM-ERR-STAT
           MOVE "log-macrobatch" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:log-macrobatch, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-log-macrobatch-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:log-macrobatch, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-log-macrobatch TO TOTEM-ERR-STAT
           MOVE "log-macrobatch" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:log-macrobatch, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-macrobatch-INITSTART.
           IF DataSet1-macrobatch-KEY-Asc
              MOVE Low-Value TO mb-chiave
           ELSE
              MOVE High-Value TO mb-chiave
           END-IF
           .

       DataSet1-macrobatch-INITEND.
           IF DataSet1-macrobatch-KEY-Asc
              MOVE High-Value TO mb-chiave
           ELSE
              MOVE Low-Value TO mb-chiave
           END-IF
           .

      * macrobatch
       DataSet1-macrobatch-START.
           IF DataSet1-macrobatch-KEY-Asc
              START macrobatch KEY >= mb-chiave
           ELSE
              START macrobatch KEY <= mb-chiave
           END-IF
           .

       DataSet1-macrobatch-START-NOTGREATER.
           IF DataSet1-macrobatch-KEY-Asc
              START macrobatch KEY <= mb-chiave
           ELSE
              START macrobatch KEY >= mb-chiave
           END-IF
           .

       DataSet1-macrobatch-START-GREATER.
           IF DataSet1-macrobatch-KEY-Asc
              START macrobatch KEY > mb-chiave
           ELSE
              START macrobatch KEY < mb-chiave
           END-IF
           .

       DataSet1-macrobatch-START-LESS.
           IF DataSet1-macrobatch-KEY-Asc
              START macrobatch KEY < mb-chiave
           ELSE
              START macrobatch KEY > mb-chiave
           END-IF
           .

       DataSet1-macrobatch-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:macrobatch, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:macrobatch, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-macrobatch-LOCK
              READ macrobatch WITH LOCK 
              KEY mb-chiave
           ELSE
              READ macrobatch WITH NO LOCK 
              KEY mb-chiave
           END-IF
           MOVE STATUS-macrobatch TO TOTEM-ERR-STAT 
           MOVE "macrobatch" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:macrobatch, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:macrobatch, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-macrobatch-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:macrobatch, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:macrobatch, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-macrobatch-KEY-Asc
              IF DataSet1-macrobatch-LOCK
                 READ macrobatch NEXT WITH LOCK
              ELSE
                 READ macrobatch NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-macrobatch-LOCK
                 READ macrobatch PREVIOUS WITH LOCK
              ELSE
                 READ macrobatch PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-macrobatch TO TOTEM-ERR-STAT
           MOVE "macrobatch" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:macrobatch, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:macrobatch, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-macrobatch-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:macrobatch, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:macrobatch, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-macrobatch-KEY-Asc
              IF DataSet1-macrobatch-LOCK
                 READ macrobatch PREVIOUS WITH LOCK
              ELSE
                 READ macrobatch PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-macrobatch-LOCK
                 READ macrobatch NEXT WITH LOCK
              ELSE
                 READ macrobatch NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-macrobatch TO TOTEM-ERR-STAT
           MOVE "macrobatch" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:macrobatch, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:macrobatch, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-macrobatch-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:macrobatch, BeforeWrite>
      * <TOTEM:END>
           WRITE mb-rec OF macrobatch.
           MOVE STATUS-macrobatch TO TOTEM-ERR-STAT
           MOVE "macrobatch" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:macrobatch, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-macrobatch-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:macrobatch, BeforeRewrite>
      * <TOTEM:END>
           REWRITE mb-rec OF macrobatch.
           MOVE STATUS-macrobatch TO TOTEM-ERR-STAT
           MOVE "macrobatch" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:macrobatch, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-macrobatch-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:macrobatch, BeforeDelete>
      * <TOTEM:END>
           DELETE macrobatch.
           MOVE STATUS-macrobatch TO TOTEM-ERR-STAT
           MOVE "macrobatch" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:macrobatch, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tprov-INITSTART.
           IF DataSet1-tprov-KEY-Asc
              MOVE Low-Value TO prv-chiave
           ELSE
              MOVE High-Value TO prv-chiave
           END-IF
           .

       DataSet1-tprov-INITEND.
           IF DataSet1-tprov-KEY-Asc
              MOVE High-Value TO prv-chiave
           ELSE
              MOVE Low-Value TO prv-chiave
           END-IF
           .

      * tprov
       DataSet1-tprov-START.
           IF DataSet1-tprov-KEY-Asc
              START tprov KEY >= prv-chiave
           ELSE
              START tprov KEY <= prv-chiave
           END-IF
           .

       DataSet1-tprov-START-NOTGREATER.
           IF DataSet1-tprov-KEY-Asc
              START tprov KEY <= prv-chiave
           ELSE
              START tprov KEY >= prv-chiave
           END-IF
           .

       DataSet1-tprov-START-GREATER.
           IF DataSet1-tprov-KEY-Asc
              START tprov KEY > prv-chiave
           ELSE
              START tprov KEY < prv-chiave
           END-IF
           .

       DataSet1-tprov-START-LESS.
           IF DataSet1-tprov-KEY-Asc
              START tprov KEY < prv-chiave
           ELSE
              START tprov KEY > prv-chiave
           END-IF
           .

       DataSet1-tprov-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tprov, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tprov, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tprov-LOCK
              READ tprov WITH LOCK 
              KEY prv-chiave
           ELSE
              READ tprov WITH NO LOCK 
              KEY prv-chiave
           END-IF
           MOVE STATUS-tprov TO TOTEM-ERR-STAT 
           MOVE "tprov" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tprov, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tprov, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tprov-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tprov, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tprov, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tprov-KEY-Asc
              IF DataSet1-tprov-LOCK
                 READ tprov NEXT WITH LOCK
              ELSE
                 READ tprov NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tprov-LOCK
                 READ tprov PREVIOUS WITH LOCK
              ELSE
                 READ tprov PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tprov TO TOTEM-ERR-STAT
           MOVE "tprov" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tprov, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tprov, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tprov-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tprov, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tprov, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tprov-KEY-Asc
              IF DataSet1-tprov-LOCK
                 READ tprov PREVIOUS WITH LOCK
              ELSE
                 READ tprov PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tprov-LOCK
                 READ tprov NEXT WITH LOCK
              ELSE
                 READ tprov NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tprov TO TOTEM-ERR-STAT
           MOVE "tprov" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tprov, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tprov, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tprov-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tprov, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tprov TO TOTEM-ERR-STAT
           MOVE "tprov" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tprov, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tprov-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tprov, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tprov TO TOTEM-ERR-STAT
           MOVE "tprov" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tprov, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tprov-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tprov, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tprov TO TOTEM-ERR-STAT
           MOVE "tprov" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tprov, AfterDelete>
      * <TOTEM:END>
           .

       EDI-clides-ecd-k-orders-MERGE-SPLITBUF.
           INITIALIZE EDI-clides-ecd-k-orders-SPLITBUF
           MOVE ecd-cod-dest(1:17) TO 
           EDI-clides-ecd-k-orders-SPLITBUF(1:17)
           MOVE ecd-cod-consegna(1:17) TO 
           EDI-clides-ecd-k-orders-SPLITBUF(18:17)
           .

       DataSet1-EDI-clides-INITSTART.
           IF DataSet1-EDI-clides-KEY-Asc
              MOVE Low-Value TO ecd-chiave
           ELSE
              MOVE High-Value TO ecd-chiave
           END-IF
           .

       DataSet1-EDI-clides-INITEND.
           IF DataSet1-EDI-clides-KEY-Asc
              MOVE High-Value TO ecd-chiave
           ELSE
              MOVE Low-Value TO ecd-chiave
           END-IF
           .

      * EDI-clides
       DataSet1-EDI-clides-START.
           IF DataSet1-EDI-clides-KEY-Asc
              START EDI-clides KEY >= ecd-chiave
           ELSE
              START EDI-clides KEY <= ecd-chiave
           END-IF
           .

       DataSet1-EDI-clides-START-NOTGREATER.
           IF DataSet1-EDI-clides-KEY-Asc
              START EDI-clides KEY <= ecd-chiave
           ELSE
              START EDI-clides KEY >= ecd-chiave
           END-IF
           .

       DataSet1-EDI-clides-START-GREATER.
           IF DataSet1-EDI-clides-KEY-Asc
              START EDI-clides KEY > ecd-chiave
           ELSE
              START EDI-clides KEY < ecd-chiave
           END-IF
           .

       DataSet1-EDI-clides-START-LESS.
           IF DataSet1-EDI-clides-KEY-Asc
              START EDI-clides KEY < ecd-chiave
           ELSE
              START EDI-clides KEY > ecd-chiave
           END-IF
           .

       DataSet1-EDI-clides-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-clides, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-clides, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-EDI-clides-LOCK
              READ EDI-clides WITH LOCK 
              KEY ecd-chiave
           ELSE
              READ EDI-clides WITH NO LOCK 
              KEY ecd-chiave
           END-IF
           PERFORM EDI-clides-ecd-k-orders-MERGE-SPLITBUF
           MOVE STATUS-EDI-clides TO TOTEM-ERR-STAT 
           MOVE "EDI-clides" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-clides, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-clides, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-EDI-clides-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-clides, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-clides, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-EDI-clides-KEY-Asc
              IF DataSet1-EDI-clides-LOCK
                 READ EDI-clides NEXT WITH LOCK
              ELSE
                 READ EDI-clides NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-EDI-clides-LOCK
                 READ EDI-clides PREVIOUS WITH LOCK
              ELSE
                 READ EDI-clides PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM EDI-clides-ecd-k-orders-MERGE-SPLITBUF
           MOVE STATUS-EDI-clides TO TOTEM-ERR-STAT
           MOVE "EDI-clides" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-clides, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-clides, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-EDI-clides-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-clides, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-clides, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-EDI-clides-KEY-Asc
              IF DataSet1-EDI-clides-LOCK
                 READ EDI-clides PREVIOUS WITH LOCK
              ELSE
                 READ EDI-clides PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-EDI-clides-LOCK
                 READ EDI-clides NEXT WITH LOCK
              ELSE
                 READ EDI-clides NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM EDI-clides-ecd-k-orders-MERGE-SPLITBUF
           MOVE STATUS-EDI-clides TO TOTEM-ERR-STAT
           MOVE "EDI-clides" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-clides, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-clides, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-EDI-clides-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-clides, BeforeWrite>
      * <TOTEM:END>
           WRITE ecd-rec OF EDI-clides.
           MOVE STATUS-EDI-clides TO TOTEM-ERR-STAT
           MOVE "EDI-clides" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-clides, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-EDI-clides-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-clides, BeforeRewrite>
      * <TOTEM:END>
           REWRITE ecd-rec OF EDI-clides.
           MOVE STATUS-EDI-clides TO TOTEM-ERR-STAT
           MOVE "EDI-clides" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-clides, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-EDI-clides-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-clides, BeforeDelete>
      * <TOTEM:END>
           DELETE EDI-clides.
           MOVE STATUS-EDI-clides TO TOTEM-ERR-STAT
           MOVE "EDI-clides" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:EDI-clides, AfterDelete>
      * <TOTEM:END>
           .

       anacap-k-prov-MERGE-SPLITBUF.
           INITIALIZE anacap-k-prov-SPLITBUF
           MOVE anc-prov(1:2) TO anacap-k-prov-SPLITBUF(1:2)
           MOVE anc-comune(1:150) TO anacap-k-prov-SPLITBUF(3:150)
           MOVE anc-chiave(1:5) TO anacap-k-prov-SPLITBUF(153:5)
           .

       anacap-k-comune-MERGE-SPLITBUF.
           INITIALIZE anacap-k-comune-SPLITBUF
           MOVE anc-comune(1:150) TO anacap-k-comune-SPLITBUF(1:150)
           MOVE anc-prov(1:2) TO anacap-k-comune-SPLITBUF(151:2)
           MOVE anc-chiave(1:5) TO anacap-k-comune-SPLITBUF(153:5)
           .

       DataSet1-anacap-INITSTART.
           IF DataSet1-anacap-KEY-Asc
              MOVE Low-Value TO anc-chiave
           ELSE
              MOVE High-Value TO anc-chiave
           END-IF
           .

       DataSet1-anacap-INITEND.
           IF DataSet1-anacap-KEY-Asc
              MOVE High-Value TO anc-chiave
           ELSE
              MOVE Low-Value TO anc-chiave
           END-IF
           .

      * anacap
       DataSet1-anacap-START.
           IF DataSet1-anacap-KEY-Asc
              START anacap KEY >= anc-chiave
           ELSE
              START anacap KEY <= anc-chiave
           END-IF
           .

       DataSet1-anacap-START-NOTGREATER.
           IF DataSet1-anacap-KEY-Asc
              START anacap KEY <= anc-chiave
           ELSE
              START anacap KEY >= anc-chiave
           END-IF
           .

       DataSet1-anacap-START-GREATER.
           IF DataSet1-anacap-KEY-Asc
              START anacap KEY > anc-chiave
           ELSE
              START anacap KEY < anc-chiave
           END-IF
           .

       DataSet1-anacap-START-LESS.
           IF DataSet1-anacap-KEY-Asc
              START anacap KEY < anc-chiave
           ELSE
              START anacap KEY > anc-chiave
           END-IF
           .

       DataSet1-anacap-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:anacap, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:anacap, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-anacap-LOCK
              READ anacap WITH LOCK 
              KEY anc-chiave
           ELSE
              READ anacap WITH NO LOCK 
              KEY anc-chiave
           END-IF
           PERFORM anacap-k-prov-MERGE-SPLITBUF
           PERFORM anacap-k-comune-MERGE-SPLITBUF
           MOVE STATUS-anacap TO TOTEM-ERR-STAT 
           MOVE "anacap" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:anacap, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:anacap, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-anacap-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:anacap, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:anacap, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-anacap-KEY-Asc
              IF DataSet1-anacap-LOCK
                 READ anacap NEXT WITH LOCK
              ELSE
                 READ anacap NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-anacap-LOCK
                 READ anacap PREVIOUS WITH LOCK
              ELSE
                 READ anacap PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM anacap-k-prov-MERGE-SPLITBUF
           PERFORM anacap-k-comune-MERGE-SPLITBUF
           MOVE STATUS-anacap TO TOTEM-ERR-STAT
           MOVE "anacap" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:anacap, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:anacap, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-anacap-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:anacap, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:anacap, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-anacap-KEY-Asc
              IF DataSet1-anacap-LOCK
                 READ anacap PREVIOUS WITH LOCK
              ELSE
                 READ anacap PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-anacap-LOCK
                 READ anacap NEXT WITH LOCK
              ELSE
                 READ anacap NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM anacap-k-prov-MERGE-SPLITBUF
           PERFORM anacap-k-comune-MERGE-SPLITBUF
           MOVE STATUS-anacap TO TOTEM-ERR-STAT
           MOVE "anacap" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:anacap, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:anacap, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-anacap-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:anacap, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-anacap TO TOTEM-ERR-STAT
           MOVE "anacap" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:anacap, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-anacap-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:anacap, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-anacap TO TOTEM-ERR-STAT
           MOVE "anacap" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:anacap, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-anacap-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:anacap, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-anacap TO TOTEM-ERR-STAT
           MOVE "anacap" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:anacap, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-INIT-RECORD.
           INITIALIZE cli-rec OF clienti
           INITIALIZE des-rec OF destini
           INITIALIZE emto-rec OF EDI-mtordini
           INITIALIZE age-rec OF agenti
           INITIALIZE record-tbliv OF tivaese
           INITIALIZE tcl-rec OF ttipocli
           INITIALIZE vet-rec OF tvettori
           INITIALIZE pgb-rec OF pagbloc
           INITIALIZE tca-rec OF tcaumag
           INITIALIZE mag-rec OF tmagaz
           INITIALIZE not-rec OF note
           INITIALIZE prm-rec OF param
           INITIALIZE rec-rec OF recapiti
           INITIALIZE emro-rec OF EDI-mrordini
           INITIALIZE art-rec OF articoli
           INITIALIZE prg-rec OF progmag
           INITIALIZE sf-rec OF sitfin
           INITIALIZE tge-rec OF tparamge
           INITIALIZE mro-rec OF mrordini
           INITIALIZE mto-rec OF mtordini
           INITIALIZE imq-rec OF timbalqta
           INITIALIZE imp-rec OF timposte
           INITIALIZE tpb-rec OF tpiombo
           INITIALIZE mar-rec OF tmarche
           INITIALIZE rpr-rec OF rpromo
           INITIALIZE tpr-rec OF tpromo
           INITIALIZE tprz-rec OF tmp-promo-prz
           INITIALIZE lst-rec OF listini
           INITIALIZE loc-rec OF locali
           INITIALIZE bli-rec OF blister
           INITIALIZE cp-rec OF cli-prg
           INITIALIZE record-tblpa OF tcodpag
           INITIALIZE tmp-prg-z-rec OF tmp-progmag-zoom
           INITIALIZE imb-rec OF timballi
           INITIALIZE con-rec OF tcontat
           INITIALIZE lck-rec OF lockfile
           INITIALIZE naz-rec OF tnazioni
           INITIALIZE sco-rec OF tscorte
           INITIALIZE tfid-rec OF tmp-fido
           INITIALIZE gra-rec OF grade
           INITIALIZE lm-riga OF log-macrobatch
           INITIALIZE mb-rec OF macrobatch
           INITIALIZE prv-rec OF tprov
           INITIALIZE ecd-rec OF EDI-clides
           INITIALIZE anc-rec OF anacap
           .


      * GRID
       gd-ordini-Content.
      * CELLS' SETTING
              MODIFY gd-ordini, X = 2, Y = 1,
                CELL-DATA = "Anno",
      * CELLS' SETTING
              MODIFY gd-ordini, X = 3, Y = 1,
                CELL-DATA = "Numero",
      * CELLS' SETTING
              MODIFY gd-ordini, X = 4, Y = 1,
                CELL-DATA = "N.Ord.Cli.",
      * CELLS' SETTING
              MODIFY gd-ordini, X = 5, Y = 1,
                CELL-DATA = "Data",
      * CELLS' SETTING
              MODIFY gd-ordini, X = 6, Y = 1,
                CELL-DATA = "Stato",
      * CELLS' SETTING
              MODIFY gd-ordini, X = 7, Y = 1,
                CELL-DATA = "Cli",
      * CELLS' SETTING
              MODIFY gd-ordini, X = 8, Y = 1,
                CELL-DATA = "Ragione Sociale",
      * CELLS' SETTING
              MODIFY gd-ordini, X = 9, Y = 1,
                CELL-DATA = "Destino",
      * CELLS' SETTING
              MODIFY gd-ordini, X = 10, Y = 1,
                CELL-DATA = "Indirizzo",
      * CELLS' SETTING
              MODIFY gd-ordini, X = 11, Y = 1,
                CELL-DATA = "Località",
           .

      * COMBO-BOX
       CBO-STATO-ORDINE-Content.
           .

      * GRID
       gd-tipocli-Content.
      * CELLS' SETTING
              MODIFY gd-tipocli, X = 1, Y = 1,
                CELL-DATA = "Codice",
      * CELLS' SETTING
              MODIFY gd-tipocli, X = 2, Y = 1,
                CELL-DATA = "Descrizione",
           .

      * GRID
       Form1-Gd-1-Content.
      * CELLS' SETTING
              MODIFY Form1-Gd-1, X = 2, Y = 1,
                CELL-DATA = "Articolo",
      * CELLS' SETTING
              MODIFY Form1-Gd-1, X = 3, Y = 1,
                CELL-DATA = "Descrizione",
      * CELLS' SETTING
              MODIFY Form1-Gd-1, X = 4, Y = 1,
                CELL-DATA = "Imb",
      * CELLS' SETTING
              MODIFY Form1-Gd-1, X = 5, Y = 1,
                CELL-DATA = "Qta E",
      * CELLS' SETTING
              MODIFY Form1-Gd-1, X = 6, Y = 1,
                CELL-DATA = "Qta G",
      * CELLS' SETTING
              MODIFY Form1-Gd-1, X = 7, Y = 1,
                CELL-DATA = "Qta OK",
      * CELLS' SETTING
              MODIFY Form1-Gd-1, X = 8, Y = 1,
                CELL-DATA = "Prz E",
      * CELLS' SETTING
              MODIFY Form1-Gd-1, X = 9, Y = 1,
                CELL-DATA = "Prz G",
      * CELLS' SETTING
              MODIFY Form1-Gd-1, X = 10, Y = 1,
                CELL-DATA = "Prz OK",
      * CELLS' SETTING
              MODIFY Form1-Gd-1, X = 11, Y = 1,
                CELL-DATA = "Evadi dal",
      * CELLS' SETTING
              MODIFY Form1-Gd-1, X = 12, Y = 1,
                CELL-DATA = "STATO",
      * COLUMNS' SETTING
              MODIFY Form1-Gd-1, X = 12  
                COLUMN-COLOR = 481,
                COLUMN-FONT = Arial10B-Occidentale,
           .

      * FD's Initialize Paragraph
       DataSet1-clienti-INITREC.
           INITIALIZE cli-rec OF clienti
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-destini-INITREC.
           INITIALIZE des-rec OF destini
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-EDI-mtordini-INITREC.
           INITIALIZE emto-rec OF EDI-mtordini
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-agenti-INITREC.
           INITIALIZE age-rec OF agenti
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tivaese-INITREC.
           INITIALIZE record-tbliv OF tivaese
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-ttipocli-INITREC.
           INITIALIZE tcl-rec OF ttipocli
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tvettori-INITREC.
           INITIALIZE vet-rec OF tvettori
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-pagbloc-INITREC.
           INITIALIZE pgb-rec OF pagbloc
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tcaumag-INITREC.
           INITIALIZE tca-rec OF tcaumag
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tmagaz-INITREC.
           INITIALIZE mag-rec OF tmagaz
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-note-INITREC.
           INITIALIZE not-rec OF note
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-param-INITREC.
           INITIALIZE prm-rec OF param
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-recapiti-INITREC.
           INITIALIZE rec-rec OF recapiti
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-EDI-mrordini-INITREC.
           INITIALIZE emro-rec OF EDI-mrordini
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-articoli-INITREC.
           INITIALIZE art-rec OF articoli
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-progmag-INITREC.
           INITIALIZE prg-rec OF progmag
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-sitfin-INITREC.
           INITIALIZE sf-rec OF sitfin
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tparamge-INITREC.
           INITIALIZE tge-rec OF tparamge
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-mrordini-INITREC.
           INITIALIZE mro-rec OF mrordini
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-mtordini-INITREC.
           INITIALIZE mto-rec OF mtordini
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-timbalqta-INITREC.
           INITIALIZE imq-rec OF timbalqta
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-timposte-INITREC.
           INITIALIZE imp-rec OF timposte
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tpiombo-INITREC.
           INITIALIZE tpb-rec OF tpiombo
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tmarche-INITREC.
           INITIALIZE mar-rec OF tmarche
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-rpromo-INITREC.
           INITIALIZE rpr-rec OF rpromo
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tpromo-INITREC.
           INITIALIZE tpr-rec OF tpromo
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tmp-promo-prz-INITREC.
           INITIALIZE tprz-rec OF tmp-promo-prz
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-listini-INITREC.
           INITIALIZE lst-rec OF listini
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-locali-INITREC.
           INITIALIZE loc-rec OF locali
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-blister-INITREC.
           INITIALIZE bli-rec OF blister
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-cli-prg-INITREC.
           INITIALIZE cp-rec OF cli-prg
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tcodpag-INITREC.
           INITIALIZE record-tblpa OF tcodpag
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tmp-progmag-zoom-INITREC.
           INITIALIZE tmp-prg-z-rec OF tmp-progmag-zoom
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-timballi-INITREC.
           INITIALIZE imb-rec OF timballi
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tcontat-INITREC.
           INITIALIZE con-rec OF tcontat
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-lockfile-INITREC.
           INITIALIZE lck-rec OF lockfile
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tnazioni-INITREC.
           INITIALIZE naz-rec OF tnazioni
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tscorte-INITREC.
           INITIALIZE sco-rec OF tscorte
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tmp-fido-INITREC.
           INITIALIZE tfid-rec OF tmp-fido
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-grade-INITREC.
           INITIALIZE gra-rec OF grade
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-log-macrobatch-INITREC.
           INITIALIZE lm-riga OF log-macrobatch
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-macrobatch-INITREC.
           INITIALIZE mb-rec OF macrobatch
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tprov-INITREC.
           INITIALIZE prv-rec OF tprov
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-EDI-clides-INITREC.
           INITIALIZE ecd-rec OF EDI-clides
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-anacap-INITREC.
           INITIALIZE anc-rec OF anacap
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      *
       DataSet1-DISPATCH-BUFTOFLD.
           EVALUATE TOTEM-Form-Index ALSO TOTEM-Frame-Index
              WHEN 1 ALSO 0
                  PERFORM Form2-Buf-To-Fld
              WHEN 4 ALSO 0
                  PERFORM Form1-Buf-To-Fld
           END-EVALUATE
           .

       Form2-Open-Routine.
           PERFORM Form2-Scrn
           PERFORM Form2-Proc
           .

       Form2-Scrn.
           PERFORM Form2-Create-Win
           PERFORM Form2-Init-Value
           PERFORM Form2-Init-Data
      * Tab keystrok settings
      * Tool Bar
           PERFORM Form2-DISPLAY
           .

       Form2-Create-Win.
           Display Independent GRAPHICAL WINDOW
              LINES 48,54,
              SIZE 198,17,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 65793,
              CONTROL FONT Small-Font,
              LABEL-OFFSET 23,
              LINK TO THREAD,
              MODELESS,
              NO SCROLL,
              TITLE-BAR,
              TITLE titolo,
              WITH SYSTEM MENU,
              USER-GRAY,
           VISIBLE video-on,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE Screen1-Event-Proc,
              HANDLE IS form2-Handle,
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterCreateWin>
      *<<** Customized_Default, SP-G, Screen4-blockpgm-1, Disable **>>

           .
      * <TOTEM:END>


      * Tool Bar    
      * Status-bar
           DISPLAY Form2 UPON form2-Handle
      * DISPLAY-COLUMNS settings
              MODIFY gd-ordini, DISPLAY-COLUMNS (1, 4, 12, 23, 48, 61, 
           73, 81, 110, 137, 164)
           .

       Form2-PROC.
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeAccept>
           set CallManutenzione to false.
           move 0 to tot-attivi tot-bloccati.
           perform FORM3-OPEN-ROUTINE.

           if not trovato
              if RichiamoBatch
                 call   "set-ini-log" using r-output
                 cancel "set-ini-log"
                 initialize lm-riga
                 string r-output delimited size
                        "NESSUN ORDINE PRESENTE PER I LIMITI RICHIESTI" 
           delimited size
                   into lm-riga
                 end-string
                 write lm-riga
              else
                 display message 
                         "Nessun ordine presente per i limiti richiesti"
                         title = tit-err
                         icon mb-error-icon
              end-if
              perform FORM2-EXIT
           else             
              perform PB-AGGIORNA-LINKTO
              if not RichiamoBatch
                 modify form2-Handle, visible = 1 
              end-if
              move 2 to riga, EVENT-DATA-2
              modify gd-ordini, CURSOR-Y = 2
              perform CAMBIA-FONT-RIGA
              move tot-attivi   to lab-attivi-buf
              move tot-bloccati to lab-bloccati-buf
              display lab-attivi lab-bloccati
              if RichiamoBatch
                 if not RecLocked 
                    perform PB-GENERA-LINKTO
                 end-if
                 move 27 to key-status
              end-if
           end-if.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT Form2
                 ON EXCEPTION
                    PERFORM Form2-Evaluate-Func
                 MOVE 1 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterEndAccept>
           if CallManutenzione             
              perform ORDINE-DA-GRIGLIA
              set CallManutenzione to false        
              modify gd-ordini, cursor-y old-riga
           end-if

      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY form2-Handle
           INITIALIZE Key-Status
           .

       Form2-Evaluate-Func.
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM Form2-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM Form2-Exit
                 END-IF
              WHEN Key-Status = 1001
                 PERFORM pb-genera-LinkTo
              WHEN Key-Status = 1002
                 PERFORM pb-aggiorna-LinkTo
              WHEN Key-Status = 1000
                 PERFORM pb-ok2-LinkTo
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       Form2-CLEAR.
           PERFORM Form2-INIT-VALUE
           PERFORM Form2-DISPLAY
           .

       Form2-DISPLAY.
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY Form2 UPON form2-Handle
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterDisplay>
      *<<** Customized_Default, SP-G, Screen4-blockpgm-1, Disable **>>

           .
      * <TOTEM:END>
           .

       Form2-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeExit>
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       Form2-Init-Data.
           MOVE 1 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
      * GRID
           PERFORM gd-ordini-Content
           .

       Form2-DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           PERFORM Form2-DataSet1-Update-Key
           .

       Form2-DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-EDI-mtordini-KEY1-ORDER
           END-EVALUATE
           PERFORM Form2-DataSet1-Update-Key
           .

       Form2-DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-EDI-mtordini-KEY1-ORDER
           END-EVALUATE
           PERFORM Form2-DataSet1-Update-Key
           .

       Form2-DataSet1-Update-Key.
           MOVE emto-rec OF EDI-mtordini TO
                     Form2-MULKEY-TMPBUF
           PERFORM Form2-CLEAR
           PERFORM Form2-INIT-DATA
           MOVE Form2-MULKEY-TMPBUF TO
                     emto-rec OF EDI-mtordini
           PERFORM DataSet1-EDI-mtordini-Read
           PERFORM Form2-DUPLICATE-MOVEKEY
           PERFORM Form2-DUMMY-CURR
           PERFORM Form2-IUD-Display
           .

       Form2-DUPLICATE-PREV.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              PERFORM EDI-mtordini-k-emto-stato-MERGE-SPLITBUF
              IF EDI-mtordini-k-emto-stato-SPLITBUF = Form2-KEYISTMP1
                 MOVE DataSet1-EDI-mtordini-KEY1-ORDER TO 
           TMP-Form2-KEY1-ORDER
                 MOVE "A" TO DataSet1-EDI-mtordini-KEY1-ORDER
                 PERFORM DataSet1-EDI-mtordini-START-EQUAL
                 IF Valid-STATUS-EDI-mtordini
                    PERFORM DataSet1-EDI-mtordini-Read-Next
                    PERFORM UNTIL NOT Valid-STATUS-EDI-mtordini OR 
                         emto-chiave = Form2-PKEYTMP OR
                         EDI-mtordini-k-emto-stato-SPLITBUF NOT = 
           Form2-KEYISTMP1
                       PERFORM DataSet1-EDI-mtordini-Read-Next
                    END-PERFORM
                 END-IF
                 MOVE TMP-Form2-KEY1-ORDER TO 
           DataSet1-EDI-mtordini-KEY1-ORDER
              ELSE
                 PERFORM DataSet1-EDI-mtordini-START-LESS
              END-IF
           WHEN OTHER
              PERFORM DataSet1-EDI-mtordini-START-LESS
           END-EVALUATE
           .

       Form2-DUPLICATE-NEXT.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              PERFORM EDI-mtordini-k-emto-stato-MERGE-SPLITBUF
              IF EDI-mtordini-k-emto-stato-SPLITBUF = Form2-KEYISTMP1
                 MOVE DataSet1-EDI-mtordini-KEY1-ORDER TO 
           TMP-Form2-KEY1-ORDER
                 MOVE "A" TO DataSet1-EDI-mtordini-KEY1-ORDER
                 PERFORM DataSet1-EDI-mtordini-START
                 IF Valid-STATUS-EDI-mtordini
                    PERFORM DataSet1-EDI-mtordini-Read-Next
                    PERFORM UNTIL NOT Valid-STATUS-EDI-mtordini OR 
                         emto-chiave = Form2-PKEYTMP OR
                         EDI-mtordini-k-emto-stato-SPLITBUF NOT = 
           Form2-KEYISTMP1
                       PERFORM DataSet1-EDI-mtordini-Read-Next
                    END-PERFORM
                 END-IF
                 MOVE TMP-Form2-KEY1-ORDER TO 
           DataSet1-EDI-mtordini-KEY1-ORDER
              ELSE
                 PERFORM DataSet1-EDI-mtordini-START-GREATER
              END-IF
           WHEN OTHER
              PERFORM DataSet1-EDI-mtordini-START-GREATER
           END-EVALUATE
           .

       Form2-DUPLICATE-MOVEKEY.
           MOVE emto-chiave TO Form2-PKEYTMP
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE EDI-mtordini-k-emto-stato-SPLITBUF TO
                   Form2-KEYISTMP1
           END-EVALUATE
           .

       Form2-First.
           PERFORM Form2-DUMMY-FIRST
           PERFORM DataSet1-EDI-mtordini-INITSTART
           PERFORM DataSet1-EDI-mtordini-START
           IF NOT Valid-STATUS-EDI-mtordini
              PERFORM Form2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeFirst>
      * <TOTEM:END>
           PERFORM DataSet1-EDI-mtordini-Read-Next
           IF NOT Valid-STATUS-EDI-mtordini
              PERFORM Form2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterFirst>
      * <TOTEM:END>
           PERFORM Form2-DUPLICATE-MOVEKEY.
           PERFORM Form2-IUD-Display
           .

       Form2-Previous.
              PERFORM Form2-Buf-To-Fld
              PERFORM Form2-DUPLICATE-PREV
           IF NOT Valid-STATUS-EDI-mtordini
              PERFORM Form2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforePrevious>
      * <TOTEM:END>
           PERFORM DataSet1-EDI-mtordini-Read-Prev
           IF NOT Valid-STATUS-EDI-mtordini
              PERFORM Form2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterPrevious>
      * <TOTEM:END>
           PERFORM Form2-DUPLICATE-MOVEKEY
           PERFORM Form2-DUMMY-PREVIOUS
           PERFORM Form2-IUD-Display
           .

       Form2-Next.
              PERFORM Form2-Buf-To-Fld
              PERFORM Form2-DUPLICATE-NEXT
           IF NOT Valid-STATUS-EDI-mtordini
              PERFORM Form2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeNext>
      * <TOTEM:END>
           PERFORM DataSet1-EDI-mtordini-Read-Next
           IF NOT Valid-STATUS-EDI-mtordini
              PERFORM Form2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterNext>
      * <TOTEM:END>
           PERFORM Form2-DUPLICATE-MOVEKEY
           PERFORM Form2-DUMMY-NEXT
           PERFORM Form2-IUD-Display
           .
      
       Form2-Last.
           PERFORM Form2-DUMMY-LAST
           PERFORM DataSet1-EDI-mtordini-INITEND
           PERFORM DataSet1-EDI-mtordini-START-NOTGREATER
           IF NOT Valid-STATUS-EDI-mtordini
              PERFORM Form2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeLast>
      * <TOTEM:END>
           PERFORM DataSet1-EDI-mtordini-Read-Prev
           IF NOT Valid-STATUS-EDI-mtordini
              PERFORM Form2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterLast>
      * <TOTEM:END>
           PERFORM Form2-DUPLICATE-MOVEKEY.
           PERFORM Form2-IUD-Display
           .

       Form2-Curr.
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeCurrent>
      * <TOTEM:END>
           PERFORM Form2-Buf-To-Fld
           PERFORM DataSet1-EDI-mtordini-Read
           PERFORM Form2-DUPLICATE-MOVEKEY
           PERFORM Form2-DUMMY-CURR
           PERFORM Form2-IUD-Display
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterCurrent>
      * <TOTEM:END>
           .

       Form2-IUD-Display.
           IF Valid-STATUS-EDI-mtordini
              PERFORM Form2-ALLGRID-RESET
              PERFORM Form2-Fld-To-Buf
              PERFORM Form2-NAVI-FOR-MASTERGRID
              PERFORM Form2-DISPLAY
           ELSE
              IF Form2-FLAG-REFRESH
                 CONTINUE
              ELSE
                 PERFORM Form2-Extended-File-Status
              END-IF
           END-IF
           .

       Form2-Add.
           PERFORM Form2-Buf-To-Fld
           PERFORM Form2-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM Form2-DUMMY-ADD
           PERFORM DataSet1-EDI-mtordini-INITREC
           PERFORM Form2-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeAdd>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-EDI-mtordini-Rec-Write
           IF Valid-STATUS-EDI-mtordini
              PERFORM Form2-RESUMMARY-INS
              PERFORM Form2-DUMMY-UPDATE-INIT
              MOVE "301" TO TOTEM-MSG-ID
              PERFORM Form2-IUD-Display
           END-IF
           PERFORM Form2-ERR-CHECKING
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterAdd>
      * <TOTEM:END>
           .
     
       Form2-Update.
           PERFORM Form2-Buf-To-Fld
           PERFORM DataSet1-EDI-mtordini-START              
           IF NOT Valid-STATUS-EDI-mtordini
              PERFORM Form2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
           PERFORM DataSet1-EDI-mtordini-Read
           PERFORM Form2-Buf-To-Fld
           PERFORM Form2-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM Form2-DUMMY-UPDATE
           PERFORM Form2-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeUpdate>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-EDI-mtordini-Rec-Rewrite
           IF Valid-STATUS-EDI-mtordini
              PERFORM Form2-RESUMMARY-DEL
              PERFORM Form2-DUMMY-UPDATE-INIT
              MOVE "302" TO TOTEM-MSG-ID
              PERFORM Form2-IUD-Display
           END-IF
           PERFORM Form2-ERR-CHECKING
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterUpdate>
      * <TOTEM:END>
           .

       Form2-Delete.
           MOVE "203" TO TOTEM-MSG-ID
           PERFORM MESSAGE-BOX-DISPLAY
           IF TOTEM-MSG-RETURN-VALUE NOT = 1
              INITIALIZE TOTEM-MSG-TEXT
              EXIT PARAGRAPH 
           END-IF
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeDelete>
      * <TOTEM:END>
           PERFORM Form2-DUMMY-DELETE
      * delete
           PERFORM Form2-Buf-To-Fld
           PERFORM DataSet1-EDI-mtordini-Rec-Delete
           IF Valid-STATUS-EDI-mtordini
              PERFORM Form2-CLEAR
              PERFORM Form2-DUMMY-DELETE-INIT
              MOVE "303" TO TOTEM-MSG-ID
              MOVE "00" to STATUS-EDI-mtordini
           END-IF
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterDelete>
      * <TOTEM:END>
           PERFORM Form2-ERR-CHECKING
           .

       Form2-NAVI-FOR-MASTERGRID.
           .

       Form2-ERR-CHECKING.
           IF Valid-STATUS-EDI-mtordini
              PERFORM Form2-SHOW-MSG-ROUTINE
           ELSE
              PERFORM Form2-Extended-File-Status
           END-IF
           .

       Form2-RESUMMARY-INS.
           .

       Form2-RESUMMARY-DEL.
           .


       Form2-DUMMY-FIRST.
           .

       Form2-DUMMY-PREVIOUS.
           .

       Form2-DUMMY-NEXT.
           .

       Form2-DUMMY-LAST.
           .

       Form2-DUMMY-CURR.
           .

       Form2-DUMMY-ADD.
           .

       Form2-DUMMY-UPDATE.
           .

       Form2-DUMMY-UPDATE-INIT.
           .

       Form2-DUMMY-DELETE.
           .

       Form2-DUMMY-DELETE-INIT.
           .

       Form2-Init-Value.
      * FORM : Form2
           PERFORM DataSet1-INIT-RECORD
           MOVE ALL X'9' TO Form2-KEYISTMP1
           MOVE ALL X'9' TO Form2-PKEYTMP
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, SetDefault>
      * <TOTEM:END>
           PERFORM Form2-FLD-TO-BUF
           .


       Form2-ALLGRID-RESET.
           .

      * for Form's Validation
       Form2-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       Form2-Buf-To-Fld.
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterBufToFld>
      * <TOTEM:END>
           .

       Form2-Fld-To-Buf.
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeFldToBuf>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterFldToBuf>
      * <TOTEM:END>
           .

       Form2-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform Form2-BUF-TO-FLD.
           move 0 to scelta.
           .
       Form2-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM Form2-SHOW-MSG-ROUTINE
           .

       Form2-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM Form2-DISPLAY-MESSAGE
           .

       Form2-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       Form2-Save-Status.
           MOVE DataSet1-EDI-mtordini-KEY1-ORDER TO TMP-Form2-KEY1-ORDER
           MOVE DataSet1-KEYIS TO TMP-Form2-KEYIS
           MOVE emto-rec OF EDI-mtordini TO 
              TMP-Form2-EDI-mtordini-RESTOREBUF
           .             

       Form2-Restore-Status.
           MOVE TMP-Form2-KEY1-ORDER TO DataSet1-EDI-mtordini-KEY1-ORDER
           MOVE TMP-Form2-KEYIS TO DataSet1-KEYIS
           MOVE TMP-Form2-EDI-mtordini-RESTOREBUF TO
              emto-rec OF EDI-mtordini
           PERFORM DataSet1-EDI-mtordini-START
           IF Valid-STATUS-EDI-mtordini
              PERFORM DataSet1-EDI-mtordini-Read-Next
           ELSE
              PERFORM DataSet1-EDI-mtordini-INITREC
           END-IF
           PERFORM UNTIL NOT Valid-STATUS-EDI-mtordini OR
              (Valid-STATUS-EDI-mtordini AND
                 emto-rec OF EDI-mtordini = 
                   TMP-Form2-EDI-mtordini-RESTOREBUF)
              PERFORM DataSet1-EDI-mtordini-Read-Next
           END-PERFORM
           .

       Form-ini-Open-Routine.
           PERFORM Form-ini-Scrn
           PERFORM Form-ini-Proc
           .

       Form-ini-Scrn.
           PERFORM Form-ini-Create-Win
           PERFORM Form-ini-Init-Value
           PERFORM Form-ini-Init-Data
      * Tab keystrok settings
      * Tool Bar
           DISPLAY Form1-Tb-1a
           PERFORM Form-ini-DISPLAY
           .

       Form-ini-Create-Win.
           Display Independent GRAPHICAL WINDOW
              LINES 22,33,
              SIZE 88,30,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 65793,
              CONTROL FONT Verdana12-Occidentale,
              LABEL-OFFSET 23,
              LINK TO THREAD,
              NO SCROLL,
              TITLE-BAR,
              TITLE TITOLO,
              AUTO-MINIMIZE,
              WITH SYSTEM MENU,
              USER-GRAY,
           VISIBLE video-on,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE Screen4-Event-Proc,
              HANDLE IS form-ini-Handle,
      * <TOTEM:EPT. FORM:Form-ini, FORM:Form-ini, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
           DISPLAY TOOL-BAR 
              LINES 2,67,   
              HANDLE IN Form1-Tb-1-Handlea
           DISPLAY Form1-Tb-1a UPON Form1-Tb-1-Handlea

      * Status-bar
           DISPLAY Form-ini UPON form-ini-Handle
      * DISPLAY-COLUMNS settings
              MODIFY gd-tipocli, DISPLAY-COLUMNS (1, 8)
           .

       Form-ini-PROC.
      * <TOTEM:EPT. FORM:Form-ini, FORM:Form-ini, BeforeAccept>
      * SPECIFICO PER PROGRAMMI CON SCREEN DI ACCETTAZIONE LIMITI
           move spaces to tge-anno.
           move spaces to tge-codice.
           read tparamge no lock invalid continue end-read.

           move tge-anno to anno-to.

           move 1        to tipo-elab.
           Move all "9"  to ordine-to,
                            data-to,
                            cliente-to.
                                         
           Move zero     to ordine-from,
                            data-from,
                            cliente-from.

           Perform RIEMPI-COMBO-STATO-ORDINE.
           move "tutti" to cbo-stato-ordine-buf.
           modify cbo-stato-ordine value cbo-stato-ordine-buf.

           move 0 to mod-limiti. 
                           
           if RichiamoBatch 
              display Form-ini    

              modify gd-tipocli, reset-grid = 1
              move low-value to tcl-rec
              start ttipocli key >= tcl-chiave
                    invalid continue
                not invalid
                    move 1 to riga
                    perform until 1 = 2
                       read ttipocli next at end exit perform end-read
                       move tcl-codice      to col-tcl-codice
                       move tcl-descrizione to col-tcl-descrizione
                       if tcl-edi-auto-si
                          move 1 to hid-col-sel
                       else                    
                          move 0 to hid-col-sel
                       end-if
                       add 1 to riga
                       modify gd-tipocli(riga, 1), cell-data 
           col-tcl-codice
                       modify gd-tipocli(riga, 2), cell-data 
           col-tcl-descrizione
                       modify gd-tipocli(riga, 1), hidden-data 
           hid-col-sel
                    end-perform
              end-start

              move 2 to tipo-elab
              perform PB-OK-LINKTO
              move 27 to key-status
           else
              move 1 to video-on
              modify form-ini-handle, visible video-on
              display Form-ini

              modify gd-tipocli, reset-grid = 1
              perform GD-TIPOCLI-CONTENT
              move low-value to tcl-rec
              start ttipocli key >= tcl-chiave
                    invalid continue
                not invalid
                    move 1 to riga
                    perform until 1 = 2
                       read ttipocli next at end exit perform end-read
                       move tcl-codice      to col-tcl-codice
                       move tcl-descrizione to col-tcl-descrizione
                       move 1 to hid-col-sel
                       add 1 to riga
                       modify gd-tipocli(riga, 1), cell-data 
           col-tcl-codice
                       modify gd-tipocli(riga, 2), cell-data 
           col-tcl-descrizione
                       modify gd-tipocli(riga, 1), hidden-data 
           hid-col-sel
                       modify gd-tipocli(riga), row-color = 480
                    end-perform
              end-start
           end-if.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT Form-ini
                 ON EXCEPTION
                    PERFORM Form-ini-Evaluate-Func
                 MOVE 2 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:Form-ini, FORM:Form-ini, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:Form-ini, FORM:Form-ini, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY form-ini-Handle
           INITIALIZE Key-Status
           .

       Form-ini-Evaluate-Func.
      * <TOTEM:EPT. FORM:Form-ini, FORM:Form-ini, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM Form-ini-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM Form-ini-Exit
                 END-IF
              WHEN Key-Status = 1001
                 PERFORM RB-SINGOLA-LinkTo
              WHEN Key-Status = 1002
                 PERFORM RB-ELENCO-LinkTo
              WHEN Key-Status = 1000
                 PERFORM pb-ok-LinkTo
              WHEN Key-Status = 27
                 PERFORM pb-annulla-LinkTo
              WHEN Key-Status = 1003
                 PERFORM pb-sel-LinkTo
              WHEN Key-Status = 1004
                 PERFORM pb-desel-LinkTo
              WHEN Key-Status = 8
                 PERFORM TOOL-CERCAa-LinkTo
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       Form-ini-CLEAR.
           PERFORM Form-ini-INIT-VALUE
           PERFORM Form-ini-DISPLAY
           .

       Form-ini-DISPLAY.
      * <TOTEM:EPT. FORM:Form-ini, FORM:Form-ini, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY Form1-Tb-1a
           DISPLAY Form-ini UPON form-ini-Handle
      * <TOTEM:EPT. FORM:Form-ini, FORM:Form-ini, AfterDisplay>
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       Form-ini-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:Form-ini, FORM:Form-ini, BeforeExit>
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       Form-ini-Init-Data.
           MOVE 2 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
      * COMBO-BOX
           PERFORM CBO-STATO-ORDINE-Content
      * GRID
           PERFORM gd-tipocli-Content
           .

       Form-ini-Init-Value.
           MOVE TITOLO TO TOTEM-MSG-TITLE
      * <TOTEM:EPT. FORM:Form-ini, FORM:Form-ini, SetDefault>
      * <TOTEM:END>
           PERFORM Form-ini-FLD-TO-BUF
           .


       Form-ini-ALLGRID-RESET.
           .

      * for Form's Validation
       Form-ini-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       Form-ini-Buf-To-Fld.
      * <TOTEM:EPT. FORM:Form-ini, FORM:Form-ini, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:Form-ini, FORM:Form-ini, AfterBufToFld>
      * <TOTEM:END>
           .

       Form-ini-Fld-To-Buf.
      * <TOTEM:EPT. FORM:Form-ini, FORM:Form-ini, BeforeFldToBuf>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:Form-ini, FORM:Form-ini, AfterFldToBuf>
      * <TOTEM:END>
           .

       Form-ini-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform Form-ini-BUF-TO-FLD.
           move 0 to scelta.
           .
       Form-ini-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM Form-ini-SHOW-MSG-ROUTINE
           .

       Form-ini-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM Form-ini-DISPLAY-MESSAGE
           .

       Form-ini-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       Form-ini-Save-Status.
           .             

       Form-ini-Restore-Status.
           .

       form3-Open-Routine.
           PERFORM form3-Scrn
           PERFORM form3-Proc
           .

       form3-Scrn.
           PERFORM form3-Create-Win
           PERFORM form3-Init-Value
           PERFORM form3-Init-Data
      * Tab keystrok settings
      * Tool Bar
           PERFORM form3-DISPLAY
           .

       form3-Create-Win.
           Display Floating GRAPHICAL WINDOW
              LINES 5,00,
              SIZE 73,00,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 65793,
              LINK TO THREAD,
              MODELESS,
              NO SCROLL,
              USER-GRAY,
           VISIBLE video-on,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE form3-Event-Proc,
              HANDLE IS form3-Handle,
      * <TOTEM:EPT. FORM:form3, FORM:form3, AfterCreateWin>
      *<<** Customized_Default, SP-G, Screen4-blockpgm-1, Disable **>>

           .
      * <TOTEM:END>


      * Tool Bar    
      * Status-bar
           DISPLAY form3 UPON form3-Handle
      * DISPLAY-COLUMNS settings
           .

       form3-PROC.
      * <TOTEM:EPT. FORM:form3, FORM:form3, BeforeAccept>
           if not RichiamoBatch
              move 1 to video-on
              modify form3-handle, visible = video-on
           end-if.
           call "w$mouse" using set-mouse-shape, wait-pointer.
           perform RIEMPI-GRID
           call "w$mouse" using set-mouse-shape, arrow-pointer.

           perform FORM3-EXIT.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT OMITTED LINE 1 COL 1
                 ON EXCEPTION
                    PERFORM form3-Evaluate-Func
                 MOVE 3 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:form3, FORM:form3, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:form3, FORM:form3, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY form3-Handle
           INITIALIZE Key-Status
           .

       form3-Evaluate-Func.
      * <TOTEM:EPT. FORM:form3, FORM:form3, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM form3-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM form3-Exit
                 END-IF
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       form3-CLEAR.
           PERFORM form3-INIT-VALUE
           PERFORM form3-DISPLAY
           .

       form3-DISPLAY.
      * <TOTEM:EPT. FORM:form3, FORM:form3, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY form3 UPON form3-Handle
      * <TOTEM:EPT. FORM:form3, FORM:form3, AfterDisplay>
      *<<** Customized_Default, SP-G, Screen4-blockpgm-1, Disable **>>

           .
      * <TOTEM:END>
           .

       form3-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:form3, FORM:form3, BeforeExit>
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       form3-Init-Data.
           MOVE 3 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
           .

       form3-Init-Value.
      * <TOTEM:EPT. FORM:form3, FORM:form3, SetDefault>
      * <TOTEM:END>
           PERFORM form3-FLD-TO-BUF
           .


       form3-ALLGRID-RESET.
           .

      * for Form's Validation
       form3-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       form3-Buf-To-Fld.
      * <TOTEM:EPT. FORM:form3, FORM:form3, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:form3, FORM:form3, AfterBufToFld>
      * <TOTEM:END>
           .

       form3-Fld-To-Buf.
      * <TOTEM:EPT. FORM:form3, FORM:form3, BeforeFldToBuf>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:form3, FORM:form3, AfterFldToBuf>
      * <TOTEM:END>
           .

       form3-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform form3-BUF-TO-FLD.
           move 0 to scelta.
           .
       form3-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM form3-SHOW-MSG-ROUTINE
           .

       form3-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM form3-DISPLAY-MESSAGE
           .

       form3-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       form3-Save-Status.
           .             

       form3-Restore-Status.
           .

       Form1-Open-Routine.
           PERFORM Form1-Scrn
           PERFORM Form1-Proc
           .

       Form1-Scrn.
           PERFORM Form1-Create-Win
           PERFORM Form1-Init-Value
           PERFORM Form1-Init-Data
      * Tab keystrok settings
      * Tool Bar
           DISPLAY Form1-Tb-1
           PERFORM Form1-DISPLAY
           .

       Form1-Create-Win.
           Display Independent GRAPHICAL WINDOW
              LINES 50,27,
              SIZE 153,43,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 65793,
              CONTROL FONT Arial9-Occidentale,
              LINK TO THREAD,
              MODELESS,
              NO SCROLL,
              TITLE-BAR,
              TITLE "GESLUX EDI - Manutenzione ordine",
              AUTO-MINIMIZE,
              WITH SYSTEM MENU,
              USER-GRAY,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE Screen2-Event-Proc,
              HANDLE IS Form1-handle,
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
           DISPLAY TOOL-BAR 
              LINES 3,07,   
              HANDLE IN Form1-Tb-1-Handle
           DISPLAY Form1-Tb-1 UPON Form1-Tb-1-Handle

      * Status-bar
           DISPLAY Form1 UPON Form1-handle
      * DISPLAY-COLUMNS settings
              MODIFY Form1-Gd-1, DISPLAY-COLUMNS (1, 5, 13, 58, 64, 72, 
           80, 88, 100, 112, 124, 135)
           .

       Form1-PROC.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeAccept>
           perform ABILITA-TOOLBAR.
           move 0 to mod.
           perform ABILITAZIONI.
           accept data-oggi from century-date.

           perform CURRENT-RECORD. 
           
           

      *****     
      *****             15 emto-righe       PIC  9.
      *****                 88 emto-righe-presenti VALUE IS 0. 
      *****                 88 emto-righe-non-presenti VALUE IS 1.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT Form1
                 ON EXCEPTION
                    PERFORM Form1-Evaluate-Func
                 MOVE 4 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterEndAccept>
           if ChiamaZoomProgressivo                     
              inquire form1-gd-1, cursor-y in riga 
                 inquire form1-gd-1(riga, 78-col-imb),
                         cell-data in col-imb
              set ChiamaZoomProgressivo to false
              move art-codice           to prg-cod-articolo
              move tca-cod-magaz        to prg-cod-magazzino
              move col-imb              to prg-tipo-imballo
              move "prg-artico-sons-a"  to como-file
              call "zoom-gt"  using como-file, prg-rec
                             giving stato-zoom
              end-call
              cancel "zoom-gt"

              if stato-zoom = 0                         
                 inquire form1-gd-1(riga, 78-col-qta),
                         cell-data in col-qta
                 move col-qta to como-qta

                 move mb-yes to scelta
                 move prg-tipo-imballo to imq-codice
                 read timbalqta no lock
                 perform CHECK-QTA-IMBALLO

                 if scelta = mb-yes
                    modify form1-gd-1(riga, 78-col-qta), 
                           cell-data col-qta 
                    move col-qta to col-qta-GESLUX
                    modify form1-gd-1(riga, 78-col-qta-GESLUX), 
                           cell-data col-qta-GESLUX
                                                      
                    if not hid-emro-si-blister
                       move imq-qta-imb to hid-emro-qta-imballi
                    end-if

                    move prg-chiave to HiddenKey
                    set hid-emro-progressivo-valido to true
                    modify form1-gd-1(riga, 1), 
                           hidden-data gruppo-hidden
                    modify form1-gd-1(riga, 78-col-imb), 
                           cell-data prg-tipo-imballo
                    set hid-emro-progressivo-valido to true
                    perform STATO-RIGA
                 end-if

              end-if
           end-if

      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY Form1-handle
           INITIALIZE Key-Status
           .

       Form1-Evaluate-Func.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterAccept>
      *    per il bottone modifica
           if key-status = 5
              inquire tool-modifica, enabled in e-modifica
              if e-modifica = 1
                 if mod = zero
                    move 1    to mod
                 else 
                    move zero to mod
                 end-if
                 modify tool-modifica, value = mod
                 perform MODIFICA
              end-if
           end-if.

           .
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM Form1-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM Form1-Exit
                 END-IF
              WHEN Key-Status = 1000
                 PERFORM chk-ritira-LinkTo
              WHEN Key-Status = 1003
                 PERFORM pb-aggiungi-LinkTo
              WHEN Key-Status = 1001
                 PERFORM pb-elimina-LinkTo
              WHEN Key-Status = 1002
                 PERFORM pb-cambia-LinkTo
              WHEN Key-Status = 2
                 PERFORM NUOVO-LinkTo
              WHEN Key-Status = 4
                 PERFORM CANCELLA-LinkTo
              WHEN Key-Status = 3
                 PERFORM TOOL-SALVA-LinkTo
              WHEN Key-Status = 6
                 PERFORM ANTEPRIMA-LinkTo
              WHEN Key-Status = 150
                 PERFORM TOOL-MODIFICA-LinkTo
              WHEN Key-Status = 7
                 PERFORM STAMPA-LinkTo
              WHEN Key-Status = 8
                 PERFORM TOOL-CERCA-LinkTo
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       Form1-CLEAR.
           PERFORM Form1-INIT-VALUE
           PERFORM Form1-DISPLAY
           .

       Form1-DISPLAY.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY Form1-Tb-1
           DISPLAY Form1 UPON Form1-handle
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterDisplay>
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       Form1-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeExit>
           perform SALV-MOD.

           if errori
              move 26 to KEY-STATUS
              exit paragraph
           end-if.

           .
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       Form1-Init-Data.
           MOVE 4 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
      * GRID
           PERFORM Form1-Gd-1-Content
           .

       Form1-DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-EDI-mtordini-KEY1-ORDER
           END-EVALUATE
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-EDI-mtordini-KEY1-ORDER
           END-EVALUATE
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Update-Key.
           MOVE emto-rec OF EDI-mtordini TO
                     Form1-MULKEY-TMPBUF
           PERFORM Form1-CLEAR
           PERFORM Form1-INIT-DATA
           MOVE Form1-MULKEY-TMPBUF TO
                     emto-rec OF EDI-mtordini
           PERFORM DataSet1-EDI-mtordini-Read
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-CURR
           PERFORM Form1-IUD-Display
           .

       Form1-DUPLICATE-PREV.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              PERFORM EDI-mtordini-k-emto-stato-MERGE-SPLITBUF
              IF EDI-mtordini-k-emto-stato-SPLITBUF = Form1-KEYISTMP1
                 MOVE DataSet1-EDI-mtordini-KEY1-ORDER TO 
           TMP-Form1-KEY1-ORDER
                 MOVE "A" TO DataSet1-EDI-mtordini-KEY1-ORDER
                 PERFORM DataSet1-EDI-mtordini-START-EQUAL
                 IF Valid-STATUS-EDI-mtordini
                    PERFORM DataSet1-EDI-mtordini-Read-Next
                    PERFORM UNTIL NOT Valid-STATUS-EDI-mtordini OR 
                         emto-chiave = Form1-PKEYTMP OR
                         EDI-mtordini-k-emto-stato-SPLITBUF NOT = 
           Form1-KEYISTMP1
                       PERFORM DataSet1-EDI-mtordini-Read-Next
                    END-PERFORM
                 END-IF
                 MOVE TMP-Form1-KEY1-ORDER TO 
           DataSet1-EDI-mtordini-KEY1-ORDER
              ELSE
                 PERFORM DataSet1-EDI-mtordini-START-LESS
              END-IF
           WHEN OTHER
              PERFORM DataSet1-EDI-mtordini-START-LESS
           END-EVALUATE
           .

       Form1-DUPLICATE-NEXT.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              PERFORM EDI-mtordini-k-emto-stato-MERGE-SPLITBUF
              IF EDI-mtordini-k-emto-stato-SPLITBUF = Form1-KEYISTMP1
                 MOVE DataSet1-EDI-mtordini-KEY1-ORDER TO 
           TMP-Form1-KEY1-ORDER
                 MOVE "A" TO DataSet1-EDI-mtordini-KEY1-ORDER
                 PERFORM DataSet1-EDI-mtordini-START
                 IF Valid-STATUS-EDI-mtordini
                    PERFORM DataSet1-EDI-mtordini-Read-Next
                    PERFORM UNTIL NOT Valid-STATUS-EDI-mtordini OR 
                         emto-chiave = Form1-PKEYTMP OR
                         EDI-mtordini-k-emto-stato-SPLITBUF NOT = 
           Form1-KEYISTMP1
                       PERFORM DataSet1-EDI-mtordini-Read-Next
                    END-PERFORM
                 END-IF
                 MOVE TMP-Form1-KEY1-ORDER TO 
           DataSet1-EDI-mtordini-KEY1-ORDER
              ELSE
                 PERFORM DataSet1-EDI-mtordini-START-GREATER
              END-IF
           WHEN OTHER
              PERFORM DataSet1-EDI-mtordini-START-GREATER
           END-EVALUATE
           .

       Form1-DUPLICATE-MOVEKEY.
           MOVE emto-chiave TO Form1-PKEYTMP
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE EDI-mtordini-k-emto-stato-SPLITBUF TO
                   Form1-KEYISTMP1
           END-EVALUATE
           .

       Form1-First.
           PERFORM Form1-DUMMY-FIRST
           PERFORM DataSet1-EDI-mtordini-INITSTART
           PERFORM DataSet1-EDI-mtordini-START
           IF NOT Valid-STATUS-EDI-mtordini
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeFirst>
      * <TOTEM:END>
           PERFORM DataSet1-EDI-mtordini-Read-Next
           IF NOT Valid-STATUS-EDI-mtordini
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterFirst>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY.
           PERFORM Form1-IUD-Display
           .

       Form1-Previous.
              PERFORM Form1-Buf-To-Fld
              PERFORM Form1-DUPLICATE-PREV
           IF NOT Valid-STATUS-EDI-mtordini
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforePrevious>
      * <TOTEM:END>
           PERFORM DataSet1-EDI-mtordini-Read-Prev
           IF NOT Valid-STATUS-EDI-mtordini
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterPrevious>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-PREVIOUS
           PERFORM Form1-IUD-Display
           .

       Form1-Next.
              PERFORM Form1-Buf-To-Fld
              PERFORM Form1-DUPLICATE-NEXT
           IF NOT Valid-STATUS-EDI-mtordini
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeNext>
      * <TOTEM:END>
           PERFORM DataSet1-EDI-mtordini-Read-Next
           IF NOT Valid-STATUS-EDI-mtordini
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterNext>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-NEXT
           PERFORM Form1-IUD-Display
           .
      
       Form1-Last.
           PERFORM Form1-DUMMY-LAST
           PERFORM DataSet1-EDI-mtordini-INITEND
           PERFORM DataSet1-EDI-mtordini-START-NOTGREATER
           IF NOT Valid-STATUS-EDI-mtordini
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeLast>
      * <TOTEM:END>
           PERFORM DataSet1-EDI-mtordini-Read-Prev
           IF NOT Valid-STATUS-EDI-mtordini
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterLast>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY.
           PERFORM Form1-IUD-Display
           .

       Form1-Curr.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeCurrent>
      * <TOTEM:END>
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-EDI-mtordini-Read
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-CURR
           PERFORM Form1-IUD-Display
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterCurrent>
      * <TOTEM:END>
           .

       Form1-IUD-Display.
           IF Valid-STATUS-EDI-mtordini
              PERFORM Form1-ALLGRID-RESET
              PERFORM Form1-Fld-To-Buf
              PERFORM Form1-NAVI-FOR-MASTERGRID
              PERFORM Form1-DISPLAY
           ELSE
              IF Form1-FLAG-REFRESH
                 CONTINUE
              ELSE
                 PERFORM Form1-Extended-File-Status
              END-IF
           END-IF
           .

       Form1-Add.
           PERFORM Form1-Buf-To-Fld
           PERFORM Form1-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM Form1-DUMMY-ADD
           PERFORM DataSet1-EDI-mtordini-INITREC
           PERFORM Form1-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeAdd>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-EDI-mtordini-Rec-Write
           IF Valid-STATUS-EDI-mtordini
              PERFORM Form1-RESUMMARY-INS
              PERFORM Form1-DUMMY-UPDATE-INIT
              MOVE "301" TO TOTEM-MSG-ID
              PERFORM Form1-IUD-Display
           END-IF
           PERFORM Form1-ERR-CHECKING
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterAdd>
      * <TOTEM:END>
           .
     
       Form1-Update.
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-EDI-mtordini-START              
           IF NOT Valid-STATUS-EDI-mtordini
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
           PERFORM DataSet1-EDI-mtordini-Read
           PERFORM Form1-Buf-To-Fld
           PERFORM Form1-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM Form1-DUMMY-UPDATE
           PERFORM Form1-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeUpdate>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-EDI-mtordini-Rec-Rewrite
           IF Valid-STATUS-EDI-mtordini
              PERFORM Form1-RESUMMARY-DEL
              PERFORM Form1-DUMMY-UPDATE-INIT
              MOVE "302" TO TOTEM-MSG-ID
              PERFORM Form1-IUD-Display
           END-IF
           PERFORM Form1-ERR-CHECKING
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterUpdate>
      * <TOTEM:END>
           .

       Form1-Delete.
           MOVE "203" TO TOTEM-MSG-ID
           PERFORM MESSAGE-BOX-DISPLAY
           IF TOTEM-MSG-RETURN-VALUE NOT = 1
              INITIALIZE TOTEM-MSG-TEXT
              EXIT PARAGRAPH 
           END-IF
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDelete>
      * <TOTEM:END>
           PERFORM Form1-DUMMY-DELETE
      * delete
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-EDI-mtordini-Rec-Delete
           IF Valid-STATUS-EDI-mtordini
              PERFORM Form1-CLEAR
              PERFORM Form1-DUMMY-DELETE-INIT
              MOVE "303" TO TOTEM-MSG-ID
              MOVE "00" to STATUS-EDI-mtordini
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterDelete>
      * <TOTEM:END>
           PERFORM Form1-ERR-CHECKING
           .

       Form1-NAVI-FOR-MASTERGRID.
           .

       Form1-ERR-CHECKING.
           IF Valid-STATUS-EDI-mtordini
              PERFORM Form1-SHOW-MSG-ROUTINE
           ELSE
              PERFORM Form1-Extended-File-Status
           END-IF
           .

       Form1-RESUMMARY-INS.
           .

       Form1-RESUMMARY-DEL.
           .


       Form1-DUMMY-FIRST.
           .

       Form1-DUMMY-PREVIOUS.
           .

       Form1-DUMMY-NEXT.
           .

       Form1-DUMMY-LAST.
           .

       Form1-DUMMY-CURR.
           .

       Form1-DUMMY-ADD.
           .

       Form1-DUMMY-UPDATE.
           .

       Form1-DUMMY-UPDATE-INIT.
           .

       Form1-DUMMY-DELETE.
           .

       Form1-DUMMY-DELETE-INIT.
           .

       Form1-Init-Value.
           INITIALIZE Form1-BUF
      * FORM : Form1
           PERFORM DataSet1-INIT-RECORD
      * DB_CHECK BOX
              MOVE 0 TO emto-ritira-in-lubex
      * DB_CHECK BOX
              MOVE 0 TO emto-prenotazione-qta
      * DB_CHECK BOX
              MOVE 0 TO emto-saldi-banco
      * DB_CHECK BOX
              MOVE 0 TO emto-saldi-promo
      * DB_CHECK BOX
              MOVE 0 TO emto-ev-immediata
      * DB_CHECK BOX
              MOVE "N" TO emto-contrassegno
           MOVE ALL X'9' TO Form1-KEYISTMP1
           MOVE ALL X'9' TO Form1-PKEYTMP
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, SetDefault>
      * <TOTEM:END>
           PERFORM Form1-FLD-TO-BUF
           .


       Form1-ALLGRID-RESET.
           .

      * for Form's Validation
       Form1-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
      * ef-cli's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-cli-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5001 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-des's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-des-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5002 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-prov-d's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-prov-d-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5003 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-cap-d's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-cap-d-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5004 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-num-ord's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-num-ord-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5005 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-data's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-data-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5006 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-data-pass's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-data-pass-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5007 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-evadi-dal's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-evadi-dal-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5008 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-age's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-age-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5009 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-pag's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-pag-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5010 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-iva's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-iva-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5011 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-vet's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-vet-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5012 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-note-1's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-note-1-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5013 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-data-cons's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-data-cons-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5014 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-note-2's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-note-2-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5015 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-note-3's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-note-3-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5016 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-note-4's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-note-4-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5017 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-note's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-note-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5018 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
           .

       ef-cli-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-cli, BeforeValidation>
      * <TOTEM:END>
           .

       ef-cli-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-cli, AfterValidation>
      * <TOTEM:END>
           .

      * ef-cli's Validation
       ef-cli-VALIDATION.
           PERFORM ef-cli-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-cli-AFTER-VALIDATION
           .

       ef-des-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-des, BeforeValidation>
      * <TOTEM:END>
           .

       ef-des-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-des, AfterValidation>
      * <TOTEM:END>
           .

      * ef-des's Validation
       ef-des-VALIDATION.
           PERFORM ef-des-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-des-AFTER-VALIDATION
           .

       ef-prov-d-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-prov-d, BeforeValidation>
      * <TOTEM:END>
           .

       ef-prov-d-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-prov-d, AfterValidation>
      * <TOTEM:END>
           .

      * ef-prov-d's Validation
       ef-prov-d-VALIDATION.
           PERFORM ef-prov-d-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-prov-d-AFTER-VALIDATION
           .

       ef-cap-d-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-cap-d, BeforeValidation>
      * <TOTEM:END>
           .

       ef-cap-d-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-cap-d, AfterValidation>
      * <TOTEM:END>
           .

      * ef-cap-d's Validation
       ef-cap-d-VALIDATION.
           PERFORM ef-cap-d-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-cap-d-AFTER-VALIDATION
           .

       ef-num-ord-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-num-ord, BeforeValidation>
      * <TOTEM:END>
           .

       ef-num-ord-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-num-ord, AfterValidation>
      * <TOTEM:END>
           .

      * ef-num-ord's Validation
       ef-num-ord-VALIDATION.
           PERFORM ef-num-ord-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-num-ord-AFTER-VALIDATION
           .

       ef-data-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-data, BeforeValidation>
      * <TOTEM:END>
           .

       ef-data-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-data, AfterValidation>
      * <TOTEM:END>
           .

      * ef-data's Validation
       ef-data-VALIDATION.
           PERFORM ef-data-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-data-AFTER-VALIDATION
           .

       ef-data-pass-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-data-pass, BeforeValidation>
      * <TOTEM:END>
           .

       ef-data-pass-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-data-pass, AfterValidation>
      * <TOTEM:END>
           .

      * ef-data-pass's Validation
       ef-data-pass-VALIDATION.
           PERFORM ef-data-pass-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-data-pass-AFTER-VALIDATION
           .

       ef-evadi-dal-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-evadi-dal, BeforeValidation>
      * <TOTEM:END>
           .

       ef-evadi-dal-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-evadi-dal, AfterValidation>
      * <TOTEM:END>
           .

      * ef-evadi-dal's Validation
       ef-evadi-dal-VALIDATION.
           PERFORM ef-evadi-dal-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-evadi-dal-AFTER-VALIDATION
           .

       ef-age-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-age, BeforeValidation>
      * <TOTEM:END>
           .

       ef-age-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-age, AfterValidation>
      * <TOTEM:END>
           .

      * ef-age's Validation
       ef-age-VALIDATION.
           PERFORM ef-age-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-age-AFTER-VALIDATION
           .

       ef-pag-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-pag, BeforeValidation>
      * <TOTEM:END>
           .

       ef-pag-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-pag, AfterValidation>
      * <TOTEM:END>
           .

      * ef-pag's Validation
       ef-pag-VALIDATION.
           PERFORM ef-pag-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-pag-AFTER-VALIDATION
           .

       ef-iva-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-iva, BeforeValidation>
      * <TOTEM:END>
           .

       ef-iva-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-iva, AfterValidation>
      * <TOTEM:END>
           .

      * ef-iva's Validation
       ef-iva-VALIDATION.
           PERFORM ef-iva-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-iva-AFTER-VALIDATION
           .

       ef-vet-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-vet, BeforeValidation>
      * <TOTEM:END>
           .

       ef-vet-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-vet, AfterValidation>
      * <TOTEM:END>
           .

      * ef-vet's Validation
       ef-vet-VALIDATION.
           PERFORM ef-vet-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-vet-AFTER-VALIDATION
           .

       ef-note-1-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-note-1, BeforeValidation>
      * <TOTEM:END>
           .

       ef-note-1-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-note-1, AfterValidation>
      * <TOTEM:END>
           .

      * ef-note-1's Validation
       ef-note-1-VALIDATION.
           PERFORM ef-note-1-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-note-1-AFTER-VALIDATION
           .

       ef-data-cons-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-data-cons, BeforeValidation>
      * <TOTEM:END>
           .

       ef-data-cons-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-data-cons, AfterValidation>
      * <TOTEM:END>
           .

      * ef-data-cons's Validation
       ef-data-cons-VALIDATION.
           PERFORM ef-data-cons-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-data-cons-AFTER-VALIDATION
           .

       ef-note-2-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-note-2, BeforeValidation>
      * <TOTEM:END>
           .

       ef-note-2-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-note-2, AfterValidation>
      * <TOTEM:END>
           .

      * ef-note-2's Validation
       ef-note-2-VALIDATION.
           PERFORM ef-note-2-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-note-2-AFTER-VALIDATION
           .

       ef-note-3-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-note-3, BeforeValidation>
      * <TOTEM:END>
           .

       ef-note-3-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-note-3, AfterValidation>
      * <TOTEM:END>
           .

      * ef-note-3's Validation
       ef-note-3-VALIDATION.
           PERFORM ef-note-3-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-note-3-AFTER-VALIDATION
           .

       ef-note-4-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-note-4, BeforeValidation>
      * <TOTEM:END>
           .

       ef-note-4-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-note-4, AfterValidation>
      * <TOTEM:END>
           .

      * ef-note-4's Validation
       ef-note-4-VALIDATION.
           PERFORM ef-note-4-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-note-4-AFTER-VALIDATION
           .

       ef-note-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-note, BeforeValidation>
      * <TOTEM:END>
           .

       ef-note-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-note, AfterValidation>
      * <TOTEM:END>
           .

      * ef-note's Validation
       ef-note-VALIDATION.
           PERFORM ef-note-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-note-AFTER-VALIDATION
           .


       Form1-Buf-To-Fld.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeBufToFld>
      * <TOTEM:END>
      * DB_Entry-Field : ef-cli
           MOVE ef-cli-BUF TO emto-cod-cli
      * DB_Entry-Field : ef-des
           MOVE ef-des-BUF TO emto-prg-destino
      * DB_Entry-Field : ef-prov-d
           MOVE ef-prov-d-BUF TO des-prov
      * DB_Entry-Field : ef-cap-d
           MOVE ef-cap-d-BUF TO des-cap
      * DB_Entry-Field : ef-num-ord
           MOVE ef-num-ord-BUF TO emto-num-ord-cli
      * DB_Entry-Field : ef-data
           MOVE ef-data-BUF TO emto-data-ordine
      * DB_Entry-Field : ef-data-pass
           MOVE ef-data-pass-BUF TO emto-data-passaggio-ordine
      * DB_Entry-Field : ef-evadi-dal
           MOVE ef-evadi-dal-BUF TO emto-evadi-dal
      * DB_Entry-Field : ef-age
           MOVE ef-age-BUF TO emto-cod-agente
      * DB_Entry-Field : ef-pag
           MOVE ef-pag-BUF TO emto-cod-pagamento
      * DB_Entry-Field : ef-iva
           MOVE ef-iva-BUF TO emto-cod-ese-iva
      * DB_Entry-Field : ef-vet
           MOVE ef-vet-BUF TO emto-vettore
      * DB_Entry-Field : ef-note-1
           MOVE ef-note-1-BUF TO emto-note1
      * DB_Entry-Field : ef-data-cons
           MOVE ef-data-cons-BUF TO emto-data-note1
      * DB_Entry-Field : ef-note-2
           MOVE ef-note-2-BUF TO emto-note2
      * DB_Entry-Field : ef-note-3
           MOVE ef-note-3-BUF TO emto-note3
      * DB_Entry-Field : ef-note-4
           MOVE ef-note-4-BUF TO emto-note4
      * DB_Entry-Field : ef-note
           MOVE ef-note-BUF TO emto-note
      * DB_CHECK BOX : chk-ritira
              IF chk-ritira-BUF = 1
                 MOVE 1 TO emto-ritira-in-lubex
              ELSE
                 MOVE 0 TO emto-ritira-in-lubex
              END-IF
      * DB_CHECK BOX : chk-prenot
              IF chk-prenot-BUF = 1
                 MOVE 1 TO emto-prenotazione-qta
              ELSE
                 MOVE 0 TO emto-prenotazione-qta
              END-IF
      * DB_CHECK BOX : chk-saldi-banco
              IF chk-saldi-banco-BUF = 1
                 MOVE 1 TO emto-saldi-banco
              ELSE
                 MOVE 0 TO emto-saldi-banco
              END-IF
      * DB_CHECK BOX : chk-saldi-promo
              IF chk-saldi-promo-BUF = 1
                 MOVE 1 TO emto-saldi-promo
              ELSE
                 MOVE 0 TO emto-saldi-promo
              END-IF
      * DB_CHECK BOX : chk-ev-immediata
              IF chk-ev-immediata-BUF = 1
                 MOVE 1 TO emto-ev-immediata
              ELSE
                 MOVE 0 TO emto-ev-immediata
              END-IF
      * DB_CHECK BOX : chk-contrassegno
              IF chk-contrassegno-BUF = 1
                 MOVE "S" TO emto-contrassegno
              ELSE
                 MOVE "N" TO emto-contrassegno
              END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterBufToFld>
           move ef-data-buf to como-data.
           perform DATE-TO-FILE.
           move como-data to emto-data-ordine.

           move ef-data-pass-buf to como-data.
           perform DATE-TO-FILE.
           move como-data to emto-data-passaggio-ordine.

           move ef-data-cons-buf to como-data.
           perform DATE-TO-FILE.
           move como-data to emto-data-note1.         

           move ef-evadi-dal-buf to como-data.
           perform DATE-TO-FILE.
           move como-data to emto-evadi-dal.

           .
      * <TOTEM:END>
           .

       Form1-Fld-To-Buf.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeFldToBuf>
      * <TOTEM:END>
      * DB_Entry-Field : ef-cli
           MOVE emto-cod-cli TO ef-cli-BUF
      * DB_Entry-Field : ef-des
           MOVE emto-prg-destino TO ef-des-BUF
      * DB_Entry-Field : ef-prov-d
           MOVE des-prov TO ef-prov-d-BUF
      * DB_Entry-Field : ef-cap-d
           MOVE des-cap TO ef-cap-d-BUF
      * DB_Entry-Field : ef-num-ord
           MOVE emto-num-ord-cli TO ef-num-ord-BUF
      * DB_Entry-Field : ef-data
           MOVE emto-data-ordine TO ef-data-BUF
      * DB_Entry-Field : ef-data-pass
           MOVE emto-data-passaggio-ordine TO ef-data-pass-BUF
      * DB_Entry-Field : ef-evadi-dal
           MOVE emto-evadi-dal TO ef-evadi-dal-BUF
      * DB_Entry-Field : ef-age
           MOVE emto-cod-agente TO ef-age-BUF
      * DB_Entry-Field : ef-pag
           MOVE emto-cod-pagamento TO ef-pag-BUF
      * DB_Entry-Field : ef-iva
           MOVE emto-cod-ese-iva TO ef-iva-BUF
      * DB_Entry-Field : ef-vet
           MOVE emto-vettore TO ef-vet-BUF
      * DB_Entry-Field : ef-note-1
           MOVE emto-note1 TO ef-note-1-BUF
      * DB_Entry-Field : ef-data-cons
           MOVE emto-data-note1 TO ef-data-cons-BUF
      * DB_Entry-Field : ef-note-2
           MOVE emto-note2 TO ef-note-2-BUF
      * DB_Entry-Field : ef-note-3
           MOVE emto-note3 TO ef-note-3-BUF
      * DB_Entry-Field : ef-note-4
           MOVE emto-note4 TO ef-note-4-BUF
      * DB_Entry-Field : ef-note
           MOVE emto-note TO ef-note-BUF
      * DB_CHECK BOX : chk-ritira
              IF emto-ritira-in-lubex = 1
                 MOVE 1 TO chk-ritira-BUF
              ELSE
                 MOVE 0 TO chk-ritira-BUF
              END-IF
      * DB_CHECK BOX : chk-prenot
              IF emto-prenotazione-qta = 1
                 MOVE 1 TO chk-prenot-BUF
              ELSE
                 MOVE 0 TO chk-prenot-BUF
              END-IF
      * DB_CHECK BOX : chk-saldi-banco
              IF emto-saldi-banco = 1
                 MOVE 1 TO chk-saldi-banco-BUF
              ELSE
                 MOVE 0 TO chk-saldi-banco-BUF
              END-IF
      * DB_CHECK BOX : chk-saldi-promo
              IF emto-saldi-promo = 1
                 MOVE 1 TO chk-saldi-promo-BUF
              ELSE
                 MOVE 0 TO chk-saldi-promo-BUF
              END-IF
      * DB_CHECK BOX : chk-ev-immediata
              IF emto-ev-immediata = 1
                 MOVE 1 TO chk-ev-immediata-BUF
              ELSE
                 MOVE 0 TO chk-ev-immediata-BUF
              END-IF
      * DB_CHECK BOX : chk-contrassegno
              IF emto-contrassegno = "S"
                 MOVE 1 TO chk-contrassegno-BUF
              ELSE
                 MOVE 0 TO chk-contrassegno-BUF
              END-IF
      * DB_LABEL : lab-anno
              MOVE emto-anno  TO lab-anno-BUF
      * DB_LABEL : lab-numero
              MOVE emto-numero  TO lab-numero-BUF
      * DB_LABEL : lab-nab-codbuyer
              MOVE emto-01T21-NAB-CODBUYER  TO lab-nab-codbuyer-BUF
      * DB_LABEL : lab-nab-rafsocb
              MOVE emto-01T23-NAB-RAGSOCB  TO lab-nab-rafsocb-BUF
      * DB_LABEL : lab-nab-indirb
              MOVE emto-01T24-NAB-INDIRB  TO lab-nab-indirb-BUF
      * DB_LABEL : lab-nab-cittab
              MOVE emto-01T25-NAB-CITTAB  TO lab-nab-cittab-BUF
      * DB_LABEL : lab-nab-provb
              MOVE emto-01T26-NAB-PROVB  TO lab-nab-provb-BUF
      * DB_LABEL : lab-nab-capb
              MOVE emto-01T27-NAB-CAPB  TO lab-nab-capb-BUF
      * DB_LABEL : lab-nad-codcons
              MOVE emto-01T28-NAD-CODCONS  TO lab-nad-codcons-BUF
      * DB_LABEL : lab-nad-ragsocd
              MOVE emto-01T30-NAD-RAGSOCD  TO lab-nad-ragsocd-BUF
      * DB_LABEL : lab-nad-indird
              MOVE emto-01T31-NAD-INDIRD  TO lab-nad-indird-BUF
      * DB_LABEL : lab-nad-cittad
              MOVE emto-01T32-NAD-CITTAD  TO lab-nad-cittad-BUF
      * DB_LABEL : lab-nad-provd
              MOVE emto-01T33-NAD-PROVD  TO lab-nad-provd-BUF
      * DB_LABEL : lab-nad-capd
              MOVE emto-01T34-NAD-CAPD  TO lab-nad-capd-BUF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterFldToBuf>
           set cli-tipo-C to true.
           move emto-cod-cli to cli-codice.
           read clienti no lock 
                invalid move "NON VALIDO" to cli-ragsoc-1
           end-read.
           perform RAGSOC-CLIENTE.

           if emto-prg-destino not = 0
              move emto-cod-cli     to des-codice
              move emto-prg-destino to des-prog
              read destini no lock 
                   invalid move "NON VALIDO" to des-ragsoc-1
              end-read
              perform RAGSOC-DESTINO
           end-if.                           

           if emto-cod-agente not = 0
              move emto-cod-agente to age-codice
              read agenti no lock 
                   invalid move "NON VALIDO" to age-ragsoc-1
              end-read
              move age-ragsoc-1 to lab-agente-buf
           end-if.

           if emto-vettore not = 0
              move emto-vettore to vet-codice
              read tvettori no lock 
                   invalid move "NON VALIDO" to vet-descrizione
              end-read
              move vet-descrizione to lab-vettore-buf
           end-if.

           if emto-cod-pagamento not = spaces
              move "PA" to tblpa-codice1
              move emto-cod-pagamento to tblpa-codice2
              read tcodpag no lock
                   invalid move "NON VALIDO" to tblpa-descrizione1
              end-read
              move tblpa-descrizione1 to lab-pagamento-buf
           end-if.

           if emto-cod-ese-iva not = spaces
              move "IV" to tbliv-codice1
              move emto-cod-ese-iva to tbliv-codice2
              read tivaese no lock
                   invalid move "NON VALIDO" to tbliv-descrizione1
              end-read
              move tbliv-descrizione1 to lab-iva-buf
           end-if.

           initialize ef-note-edi-buf.
           inspect emto-01T35-FTX-NOTE replacing trailing spaces by 
           low-value.
           inspect emto-01T68-FTX-NOTE replacing trailing spaces by 
           low-value.
           inspect emto-01T69-FTX-NOTE replacing trailing spaces by 
           low-value.
           inspect emto-01T70-FTX-NOTE replacing trailing spaces by 
           low-value.

           string  emto-01T35-FTX-NOTE delimited low-value x"0d0a"
                   emto-01T68-FTX-NOTE delimited low-value x"0d0a"
                   emto-01T69-FTX-NOTE delimited low-value x"0d0a"
                   emto-01T70-FTX-NOTE delimited low-value
              into ef-note-edi-buf
           end-string.

           inspect emto-01T35-FTX-NOTE replacing trailing low-value by 
           spaces.
           inspect emto-01T68-FTX-NOTE replacing trailing low-value by 
           spaces.
           inspect emto-01T69-FTX-NOTE replacing trailing low-value by 
           spaces.
           inspect emto-01T70-FTX-NOTE replacing trailing low-value by 
           spaces.

           move emto-data-ordine           to como-data.
           perform DATE-TO-SCREEN.
           move como-data                  to ef-data-buf.

           move emto-data-passaggio-ordine to como-data.
           perform DATE-TO-SCREEN.
           move como-data                  to ef-data-pass-buf. 

           move emto-data-note1            to como-data.
           perform DATE-TO-SCREEN.
           move como-data                  to ef-data-cons-buf.

           move emto-evadi-dal             to como-data.
           perform DATE-TO-SCREEN.
           move como-data                  to ef-evadi-dal-buf.

           .
      * <TOTEM:END>
           .

       Form1-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform Form1-BUF-TO-FLD.
           move 0 to scelta.
           .
       Form1-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM Form1-SHOW-MSG-ROUTINE
           .

       Form1-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM Form1-DISPLAY-MESSAGE
           .

       Form1-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       Form1-Save-Status.
           MOVE DataSet1-EDI-mtordini-KEY1-ORDER TO TMP-Form1-KEY1-ORDER
           MOVE DataSet1-KEYIS TO TMP-Form1-KEYIS
           MOVE emto-rec OF EDI-mtordini TO 
              TMP-Form1-EDI-mtordini-RESTOREBUF
           .             

       Form1-Restore-Status.
           MOVE TMP-Form1-KEY1-ORDER TO DataSet1-EDI-mtordini-KEY1-ORDER
           MOVE TMP-Form1-KEYIS TO DataSet1-KEYIS
           MOVE TMP-Form1-EDI-mtordini-RESTOREBUF TO
              emto-rec OF EDI-mtordini
           PERFORM DataSet1-EDI-mtordini-START
           IF Valid-STATUS-EDI-mtordini
              PERFORM DataSet1-EDI-mtordini-Read-Next
           ELSE
              PERFORM DataSet1-EDI-mtordini-INITREC
           END-IF
           PERFORM UNTIL NOT Valid-STATUS-EDI-mtordini OR
              (Valid-STATUS-EDI-mtordini AND
                 emto-rec OF EDI-mtordini = 
                   TMP-Form1-EDI-mtordini-RESTOREBUF)
              PERFORM DataSet1-EDI-mtordini-Read-Next
           END-PERFORM
           .


      * Paragrafo per la struttura del codice in BEFORE sulla screen Form1
      ***---
       Form1-BEFORE-SCREEN.
           evaluate control-id
           |78-ID-ef-cli è l'ID del campo ef-cli
           when 78-ID-ef-cli
                move 1 to StatusHelp
                perform STATUS-HELP
           |78-ID-ef-des è l'ID del campo ef-des
           when 78-ID-ef-des
                move 1 to StatusHelp
                perform STATUS-HELP
           |78-ID-ef-prov-d è l'ID del campo ef-prov-d
           when 78-ID-ef-prov-d
                move 1 to StatusHelp
                perform STATUS-HELP
           |78-ID-ef-cap-d è l'ID del campo ef-cap-d
           when 78-ID-ef-cap-d
                move 1 to StatusHelp
                perform STATUS-HELP
           |78-ID-ef-age è l'ID del campo ef-age
           when 78-ID-ef-age
                move 1 to StatusHelp
                perform STATUS-HELP
           |78-ID-ef-pag è l'ID del campo ef-pag
           when 78-ID-ef-pag
                move 1 to StatusHelp
                perform STATUS-HELP
           |78-ID-ef-iva è l'ID del campo ef-iva
           when 78-ID-ef-iva
                move 1 to StatusHelp
                perform STATUS-HELP
           |78-ID-ef-vet è l'ID del campo ef-vet
           when 78-ID-ef-vet
                move 1 to StatusHelp
                perform STATUS-HELP
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella BEFORE della screen
           when 99999 continue
           when other continue
           end-evaluate.

      * Generazione settaggio keyboard "." ---> ","

      * Paragrafo per la struttura del codice in AFTER sulla screen Form1
      ***---
       Form1-AFTER-SCREEN.
           evaluate control-id
           |78-ID-ef-cli è l'ID del campo ef-cli
           when 78-ID-ef-cli
                move 0 to StatusHelp
                perform STATUS-HELP

           |78-ID-ef-des è l'ID del campo ef-des
           when 78-ID-ef-des
                move 0 to StatusHelp
                perform STATUS-HELP

           |78-ID-ef-prov-d è l'ID del campo ef-prov-d
           when 78-ID-ef-prov-d
                move 0 to StatusHelp
                perform STATUS-HELP

           |78-ID-ef-cap-d è l'ID del campo ef-cap-d
           when 78-ID-ef-cap-d
                move 0 to StatusHelp
                perform STATUS-HELP

           |78-ID-ef-age è l'ID del campo ef-age
           when 78-ID-ef-age
                move 0 to StatusHelp
                perform STATUS-HELP

           |78-ID-ef-pag è l'ID del campo ef-pag
           when 78-ID-ef-pag
                move 0 to StatusHelp
                perform STATUS-HELP

           |78-ID-ef-iva è l'ID del campo ef-iva
           when 78-ID-ef-iva
                move 0 to StatusHelp
                perform STATUS-HELP

           |78-ID-ef-vet è l'ID del campo ef-vet
           when 78-ID-ef-vet
                move 0 to StatusHelp
                perform STATUS-HELP

           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER della screen
           when 99999 continue
           when other continue
           end-evaluate.

      * Generazione risettaggio keyboard "." ---> "."

      * Generazione stringa perform CONTROLLO

       form-gen-Open-Routine.
           PERFORM form-gen-Scrn
           PERFORM form-gen-Proc
           .

       form-gen-Scrn.
           PERFORM form-gen-Create-Win
           PERFORM form-gen-Init-Value
           PERFORM form-gen-Init-Data
      * Tab keystrok settings
      * Tool Bar
           PERFORM form-gen-DISPLAY
           .

       form-gen-Create-Win.
           Display Floating GRAPHICAL WINDOW
              LINES 5,00,
              SIZE 72,00,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 65793,
              LINK TO THREAD,
              MODELESS,
              NO SCROLL,
              USER-GRAY,
           VISIBLE video-on,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE form3-Event-Proc,
              HANDLE IS form3-Handle,
      * <TOTEM:EPT. FORM:form-gen, FORM:form-gen, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
      * Status-bar
           DISPLAY form-gen UPON form3-Handle
      * DISPLAY-COLUMNS settings
           .

       form-gen-PROC.
      * <TOTEM:EPT. FORM:form-gen, FORM:form-gen, BeforeAccept>
           if not RichiamoBatch
              move 1 to video-on
              modify form3-Handle, visible video-on
           end-if.
           call "w$mouse" using set-mouse-shape, wait-pointer.
           perform ATTIVA-ORDINI.   
           modify form3-Handle, visible false.
           if primo-numero not = 0
              perform SCR-FINE-OPEN-ROUTINE
           end-if.
           call "w$mouse" using set-mouse-shape, arrow-pointer.

           perform FORM-GEN-EXIT.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT OMITTED LINE 1 COL 1
                 ON EXCEPTION
                    PERFORM form-gen-Evaluate-Func
                 MOVE 5 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:form-gen, FORM:form-gen, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:form-gen, FORM:form-gen, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY form3-Handle
           INITIALIZE Key-Status
           .

       form-gen-Evaluate-Func.
      * <TOTEM:EPT. FORM:form-gen, FORM:form-gen, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM form-gen-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM form-gen-Exit
                 END-IF
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       form-gen-CLEAR.
           PERFORM form-gen-INIT-VALUE
           PERFORM form-gen-DISPLAY
           .

       form-gen-DISPLAY.
      * <TOTEM:EPT. FORM:form-gen, FORM:form-gen, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY form-gen UPON form3-Handle
      * <TOTEM:EPT. FORM:form-gen, FORM:form-gen, AfterDisplay>
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       form-gen-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:form-gen, FORM:form-gen, BeforeExit>
      *****     display message "STAMPA?"
      *****               title titolo
      *****                type mb-yes-no
      *****              default mb-no
      *****              giving scelta
      *****     if scelta = mb-yes             
      
              modify lab-attendere, visible true
              modify pb-genera,     visible false
              modify pb-ok2,        visible false
              modify pb-annulla2,   visible false
              modify gd-ordini,     enabled false
              set PrintXX to true
              perform ACCESSOXX

              perform varying idx from 1 by 1 
                        until idx > idx-ordini
                 move chiave-ordine(idx) to mto-chiave
                 read mtordini no lock
                      invalid continue
                  not invalid
                      call   "st-ordine-m" using mto-chiave, 
                                                 link-path,
                                                 "I"
                      cancel "st-ordine-m"
                 end-read
              end-perform

              perform DESTROYXX
              modify form2-handle, visible false
      *****     end-if.
           move 27 to key-status.

           .
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       form-gen-Init-Data.
           MOVE 5 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
           .

       form-gen-Init-Value.
      * <TOTEM:EPT. FORM:form-gen, FORM:form-gen, SetDefault>
      * <TOTEM:END>
           PERFORM form-gen-FLD-TO-BUF
           .


       form-gen-ALLGRID-RESET.
           .

      * for Form's Validation
       form-gen-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       form-gen-Buf-To-Fld.
      * <TOTEM:EPT. FORM:form-gen, FORM:form-gen, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:form-gen, FORM:form-gen, AfterBufToFld>
      * <TOTEM:END>
           .

       form-gen-Fld-To-Buf.
      * <TOTEM:EPT. FORM:form-gen, FORM:form-gen, BeforeFldToBuf>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:form-gen, FORM:form-gen, AfterFldToBuf>
      * <TOTEM:END>
           .

       form-gen-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform form-gen-BUF-TO-FLD.
           move 0 to scelta.
           .
       form-gen-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM form-gen-SHOW-MSG-ROUTINE
           .

       form-gen-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM form-gen-DISPLAY-MESSAGE
           .

       form-gen-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       form-gen-Save-Status.
           .             

       form-gen-Restore-Status.
           .


      * Paragrafo per la struttura del codice in BEFORE sulla screen form-gen
      ***---
       form-gen-BEFORE-SCREEN.
           evaluate control-id
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella BEFORE della screen
           when 99999 continue
           when other continue
           end-evaluate.

      * Generazione settaggio keyboard "." ---> ","

      * Paragrafo per la struttura del codice in AFTER sulla screen form-gen
      ***---
       form-gen-AFTER-SCREEN.
           evaluate control-id
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER della screen
           when 99999 continue
           when other continue
           end-evaluate.

      * Generazione risettaggio keyboard "." ---> "."

      * Generazione stringa perform CONTROLLO

       scr-fine-Open-Routine.
           PERFORM scr-fine-Scrn
           PERFORM scr-fine-Proc
           .

       scr-fine-Scrn.
           PERFORM scr-fine-Create-Win
           PERFORM scr-fine-Init-Value
           PERFORM scr-fine-Init-Data
      * Tab keystrok settings
      * Tool Bar
           PERFORM scr-fine-DISPLAY
           .

       scr-fine-Create-Win.
           Display Floating GRAPHICAL WINDOW
              LINES 20,30,
              SIZE 30,00,
              CELL HEIGHT 10,
              CELL WIDTH 10,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 65793,
              ERASE,
              CONTROL FONT Arial-Black12B-Occidentale,
              LABEL-OFFSET 0,
              LINK TO THREAD,
              RESIZABLE,
              NO SCROLL,
              TITLE-BAR,
              TITLE "Operazione conclusa - Riepilogo",
              WITH SYSTEM MENU,
              USER-GRAY,
              USER-WHITE,
              No WRAP,
              HANDLE IS scr-fine-SF-HANDLE,
      * <TOTEM:EPT. FORM:scr-fine, FORM:scr-fine, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
      * Status-bar
           DISPLAY scr-fine UPON scr-fine-SF-HANDLE
      * DISPLAY-COLUMNS settings
           .

       scr-fine-PROC.
      * <TOTEM:EPT. FORM:scr-fine, FORM:scr-fine, BeforeAccept>
           if RichiamoBatch
              move 27 to key-status  
              call   "set-ini-log" using r-output
              cancel "set-ini-log"
              initialize lm-riga
              string r-output      delimited size
                     "GENERATI "   delimited size
                     idx-ordini    delimited size
                     " DAL N. "    delimited size
                     primo-numero  delimited size
                     " - AL N. "   delimited size
                     ultimo-numero delimited size
                into lm-riga
              end-string
              write lm-riga               

              move lk-mb-id to mb-id
              read macrobatch no lock        
              move primo-numero  to mb-edi-selordini-primo-numero
              move ultimo-numero to mb-edi-selordini-ultimo-numero
              move idx-ordini    to mb-edi-selordini-tot-ordini
              rewrite mb-rec

           else
              move primo-numero  to primo-numero-z
              move ultimo-numero to ultimo-numero-z

              move idx-ordini to tot-ordini-z
              display scr-fine
           end-if.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT scr-fine
                 ON EXCEPTION
                    PERFORM scr-fine-Evaluate-Func
                 MOVE 6 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:scr-fine, FORM:scr-fine, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:scr-fine, FORM:scr-fine, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY scr-fine-SF-HANDLE
           INITIALIZE Key-Status
           .

       scr-fine-Evaluate-Func.
      * <TOTEM:EPT. FORM:scr-fine, FORM:scr-fine, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM scr-fine-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM scr-fine-Exit
                 END-IF
              WHEN Key-Status = 2700
                 PERFORM pb-si-LinkTo
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       scr-fine-CLEAR.
           PERFORM scr-fine-INIT-VALUE
           PERFORM scr-fine-DISPLAY
           .

       scr-fine-DISPLAY.
      * <TOTEM:EPT. FORM:scr-fine, FORM:scr-fine, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY scr-fine UPON scr-fine-SF-HANDLE
      * <TOTEM:EPT. FORM:scr-fine, FORM:scr-fine, AfterDisplay>
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       scr-fine-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:scr-fine, FORM:scr-fine, BeforeExit>
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       scr-fine-Init-Data.
           MOVE 6 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
           .

       scr-fine-Init-Value.
      * <TOTEM:EPT. FORM:scr-fine, FORM:scr-fine, SetDefault>
      * <TOTEM:END>
           PERFORM scr-fine-FLD-TO-BUF
           .


       scr-fine-ALLGRID-RESET.
           .

      * for Form's Validation
       scr-fine-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       scr-fine-Buf-To-Fld.
      * <TOTEM:EPT. FORM:scr-fine, FORM:scr-fine, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:scr-fine, FORM:scr-fine, AfterBufToFld>
      * <TOTEM:END>
           .

       scr-fine-Fld-To-Buf.
      * <TOTEM:EPT. FORM:scr-fine, FORM:scr-fine, BeforeFldToBuf>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:scr-fine, FORM:scr-fine, AfterFldToBuf>
      * <TOTEM:END>
           .

       scr-fine-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform scr-fine-BUF-TO-FLD.
           move 0 to scelta.
           .
       scr-fine-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM scr-fine-SHOW-MSG-ROUTINE
           .

       scr-fine-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM scr-fine-DISPLAY-MESSAGE
           .

       scr-fine-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       scr-fine-Save-Status.
           .             

       scr-fine-Restore-Status.
           .


      * Paragrafo per la struttura del codice in BEFORE sulla screen scr-fine
      ***---
       scr-fine-BEFORE-SCREEN.
           evaluate control-id
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella BEFORE della screen
           when 99999 continue
           when other continue
           end-evaluate.

      * Generazione settaggio keyboard "." ---> ","

      * Paragrafo per la struttura del codice in AFTER sulla screen scr-fine
      ***---
       scr-fine-AFTER-SCREEN.
           evaluate control-id
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER della screen
           when 99999 continue
           when other continue
           end-evaluate.

      * Generazione risettaggio keyboard "." ---> "."

      * Generazione stringa perform CONTROLLO



       Form1-AfterProcedure.
           EVALUATE Control-Id
           When 5001 PERFORM Screen2-DaEf-2-AfterProcedure
           When 5002 PERFORM Screen2-DaEf-3-AfterProcedure
           When 5003 PERFORM ef-prov-d-AfterProcedure
           When 5004 PERFORM ef-cap-d-AfterProcedure
           When 5005 PERFORM Screen2-DaEf-5-AfterProcedure
           When 5006 PERFORM Screen2-DaEf-6-AfterProcedure
           When 5007 PERFORM Screen2-DaEf-7-AfterProcedure
           When 5008 PERFORM Screen2-DaEf-7-AfterProcedure
           When 5009 PERFORM Screen2-DaEf-8-AfterProcedure
           When 5010 PERFORM Screen2-DaEf-9-AfterProcedure
           When 5011 PERFORM Screen2-DaEf-10-AfterProcedure
           When 5012 PERFORM Screen2-DaEf-11-AfterProcedure
           When 5013 PERFORM Screen2-DaEf-12-AfterProcedure
           When 5014 PERFORM Screen2-DaEf-13-AfterProcedure
           When 5015 PERFORM Screen2-DaEf-14-AfterProcedure
           When 5016 PERFORM Screen2-DaEf-15-AfterProcedure
           When 5017 PERFORM Screen2-DaEf-16-AfterProcedure
           When 5018 PERFORM Screen2-DaEf-17-AfterProcedure
           When 5019 PERFORM Screen2-DaCb-1-AfterProcedure
           When 5020 PERFORM Screen2-DaCb-3-AfterProcedure
           When 5021 PERFORM Screen2-DaCb-4-AfterProcedure
           When 5022 PERFORM Screen2-DaCb-5-AfterProcedure
           When 5023 PERFORM Screen2-DaCb-5-AfterProcedure
           When 5024 PERFORM Screen2-DaCb-5-AfterProcedure
           END-EVALUATE
           perform Form1-AFTER-SCREEN
           .

       Screen1-Event-Proc.
           .

       Screen1-Gd-1-Event-Proc.
           EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
           WHEN Msg-Begin-Drag ALSO 5001 ALSO
                    form2-Handle 
              PERFORM gd-ordini-Ev-Msg-Begin-Drag
           WHEN Msg-Begin-Entry ALSO 5001 ALSO
                    form2-Handle 
              PERFORM gd-ordini-Ev-Msg-Begin-Entry
           WHEN Msg-End-Drag ALSO 5001 ALSO
                    form2-Handle 
              PERFORM gd-ordini-Ev-Msg-End-Drag
           WHEN Msg-Goto-Cell ALSO 5001 ALSO
                    form2-Handle 
              PERFORM gd-ordini-Ev-Msg-Goto-Cell
           WHEN Msg-Goto-Cell-Drag ALSO 5001 ALSO
                    form2-Handle 
              PERFORM gd-ordini-Ev-Msg-Goto-Cell-Drag
           WHEN Msg-Goto-Cell-Mouse ALSO 5001 ALSO
                    form2-Handle 
              PERFORM gd-ordini-Ev-Msg-Goto-Cell-Mouse
           END-EVALUATE
           .

       Screen4-Event-Proc.
           .

       Screen4-Gd-1-Event-Proc.
           EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
           WHEN Msg-Begin-Entry ALSO 14 ALSO
                    form-ini-Handle 
              PERFORM gd-tipocli-Ev-Msg-Begin-Entry
           END-EVALUATE
           .

       form3-Event-Proc.
           .

       Screen2-Event-Proc.
           .

       Form1-Gd-1-Event-Proc.
           EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
           WHEN Msg-Begin-Drag ALSO 5025 ALSO
                    Form1-handle 
              PERFORM Form1-Gd-1-Ev-Msg-Begin-Drag
           WHEN Msg-Begin-Entry ALSO 5025 ALSO
                    Form1-handle 
              PERFORM Form1-Gd-1-Ev-Msg-Begin-Entry
           WHEN Msg-Cancel-Entry ALSO 5025 ALSO
                    Form1-handle 
              PERFORM Form1-Gd-1-Ev-Msg-Cancel-Entry
           WHEN Msg-End-Drag ALSO 5025 ALSO
                    Form1-handle 
              PERFORM Form1-Gd-1-Ev-Msg-End-Drag
           WHEN Msg-Finish-Entry ALSO 5025 ALSO
                    Form1-handle 
              PERFORM Form1-Gd-1-Ev-Msg-Finish-Entry
           WHEN Msg-Goto-Cell ALSO 5025 ALSO
                    Form1-handle 
              PERFORM Form1-Gd-1-Ev-Msg-Goto-Cell
           WHEN Msg-Goto-Cell-Drag ALSO 5025 ALSO
                    Form1-handle 
              PERFORM Form1-Gd-1-Ev-Msg-Goto-Cell-Drag
           WHEN Msg-Goto-Cell-Mouse ALSO 5025 ALSO
                    Form1-handle 
              PERFORM Form1-Gd-1-Ev-Msg-Goto-Cell-Mouse
           END-EVALUATE
           .

      * USER DEFINE PARAGRAPH
       ABILITAZIONI.
      * <TOTEM:PARA. ABILITAZIONI>
           if mod = 1  
              move BitmapDeleteEnabled to BitmapNumDelete
              move BitmapSaveEnabled   to BitmapNumSave
              move 1 to e-salva e-cancella
           else
              |se sono in visua           
              move BitmapDeleteDisabled to BitmapNumDelete
              move BitmapSaveDisabled   to BitmapNumSave
              move 0 to e-salva e-cancella
           end-if.     
                             
           move BitmapNewDisabled to BitmapNumNew.
           move 0 to e-nuovo.
           modify tool-nuovo, enabled e-nuovo.

           move BitmapZoomEnabled to BitmapNumZoom.
           modify tool-cerca, enabled e-cerca, bitmap-number 
           BitmapNumZoom.

      * ISACCO (CORREZIONE SU LIVELLO ABILITAZIONE 2) - 10/11/2003
      * (CANCELLAZIONE NON PERMESSA)
           if livello-abil = 2 
              move ZERO to e-cancella
              move BitmapDeleteDisabled to BitmapNumDelete
           end-if.
      * FINE
           modify tool-cancella, enabled = e-cancella.
           modify tool-salva,    enabled = e-salva.
       
      * ISACCO (SERVE SEMPRE PER LA MODIFICA PRCEDENTE E PER RIPRISTINARE
      * LE BITMAP DISABILITATE. - 10/11/2003
      *     perform FORM1-DISPLAY.
           display tool-nuovo, tool-salva, tool-cancella, tool-modifica.
      * FINE 
           .
      * <TOTEM:END>

       AGGIUNGI-RIGA.
      * <TOTEM:PARA. AGGIUNGI-RIGA>
           move emro-prg-chiave    to HiddenKey
           move emro-prg-forzato   to HiddenKeyL
           move emro-errori        to hid-emro-errori
           move emro-blister       to hid-emro-blister
           move emro-stato         to hid-emro-stato
           move emro-riga          to col-num
           move emro-cod-articolo  to col-art art-codice
           read articoli no lock
                invalid 
                initialize art-rec
                move emro-02D15-LIN-DESART to art-descrizione
           end-read
           move art-descrizione        to col-des
           move emro-prg-tipo-imballo  to col-imb
           move emro-qta-EDI           to col-qta-EDI
           move emro-qta-GESLUX        to col-qta-GESLUX

           if emro-qta = 0
              move emro-qta-GESLUX to emro-qta
              set hid-emro-qtac-ok to true
           end-if

           move emro-qta           to col-qta hid-emro-qta
           move emro-prz-EDI       to col-prz-EDI
           move emro-prz-GESLUX    to col-prz-GESLUX
           move emro-evadi-dal     to como-data.
           perform DATE-TO-sCREEN.
           move como-data          to col-evadi-dal.

           if emro-prezzo-non-valido
              |Se il prezzo è DA CONFERMARE (= 0) e non è stato
              |richiesto come omaggio
              if emro-prz = 0 and
                 emro-prz-EDI not = 0
                 |Imposto il prezzo GESLUX come                                    
                 move emro-prz-GESLUX to emro-prz
                 if emro-prz-GESLUX < 9999,99
                    set hid-emro-prezzo-valido to true
                 end-if
              else
                 |Se = 0 ed ho richiesto omaggio lo considero 
                 |come giusto al momento del salvataggio
                 set hid-emro-prezzo-valido to true
              end-if
           end-if

           move emro-prz to col-prz hid-emro-prz
           
      *****     move emro-cod-iva           to col-iva
      *****     move emro-omaggio           to col-oma  
           
           move emro-qta-imballi     to hid-emro-qta-imballi
           move emro-bloccato-prezzo to hid-emro-bloccato-prezzo
           move emro-evadi-dal       to hid-emro-evadi-dal.
           
           modify form1-gd-1(riga, 1), 
                  hidden-data gruppo-hidden
           
           |Qta e prezzo se non corretti propongo quelli GESLUX
           |quindi se sono solo quelli gli errori metto la riga
           |come OK
           if emro-articolo-valido and emro-progressivo-valido and
              emro-qta > 0
              if emro-prz = 0
                 if emro-prz-EDI    = 0 and
                    emro-prz-GESLUX = 0
                    move "OK" to col-stato-r
                 end-if
              else
                 move "OK" to col-stato-r
              end-if
           else
              add 1 to righe-errate
              move spaces to col-stato-r
           end-if
           
           modify form1-gd-1(riga,  78-col-num), 
                  cell-data col-num
           modify form1-gd-1(riga,  78-col-art), 
                  cell-data col-art 
           modify form1-gd-1(riga,  78-col-des), 
                  cell-data col-des 
           modify form1-gd-1(riga,  78-col-imb), 
                  cell-data col-imb
           modify form1-gd-1(riga,  78-col-qta-EDI),    
                  cell-data col-qta-EDI
           modify form1-gd-1(riga,  78-col-qta-GESLUX), 
                  cell-data col-qta-GESLUX
           modify form1-gd-1(riga,  78-col-qta), 
                  cell-data col-qta
           modify form1-gd-1(riga,  78-col-prz-EDI),    
                  cell-data col-prz-EDI
           modify form1-gd-1(riga,  78-col-prz-GESLUX), 
                  cell-data col-prz-GESLUX      
           modify form1-gd-1(riga,  78-col-prz), 
                  cell-data col-prz
           modify form1-gd-1(riga,  78-col-evadi-dal), 
                  cell-data col-evadi-dal
      *****     modify form1-gd-1(riga,  78-col-iva), 
      *****            cell-data col-iva 
      *****     modify form1-gd-1(riga,  78-col-oma), 
      *****            cell-data col-oma 
           modify form1-gd-1(riga,  78-col-stato-r), 
                  cell-data col-stato-r
           
           if emro-bloccato
              if emro-articolo-non-valido or
                 emro-articolo-non-attivo
                 modify form1-gd-1(riga, 78-col-art), 
                        cell-color = 78-colore-fatt-tot
              end-if
              if emro-qtac-non-presente or
                 emro-qtac-adattata
                 modify form1-gd-1(riga, 78-col-qta-EDI), 
                        cell-color = 78-colore-fatt-tot
              end-if
              if emro-prezzo-non-valido
                 modify form1-gd-1(riga, 78-col-prz-EDI), 
                        cell-color = 78-colore-fatt-tot
              end-if
              if emro-progressivo-non-trovato or
                 emro-progressivo-non-attivo  or
                 emro-progressivo-non-forzato
                 modify form1-gd-1(riga, 78-col-art), 
                        cell-color = 78-colore-fatt-tot
              end-if
           end-if 
           .
      * <TOTEM:END>

       CALCOLA-TOTALE.
      * <TOTEM:PARA. CALCOLA-TOTALE>
           move 0 to tot-doc.
           inquire form1-gd-1, last-row in tot-righe.
           perform varying riga from 2 by 1 
                     until riga > tot-righe                      
              inquire form1-gd-1(riga, 7),  cell-data in como-qta
              inquire form1-gd-1(riga, 10), cell-data in como-prz
              compute tot-doc = tot-doc + como-qta * como-prz
           end-perform.
           if emto-cod-ese-iva = spaces 
              if emto-causale = tge-causale-ordini-std
                 move "IV"            to tbliv-codice1
                 move tge-cod-iva-std to tbliv-codice2
                 read tivaese no lock
                 compute tot-doc rounded = 
                         tot-doc * ( 1 + tbliv-percentuale / 100 )
              end-if
           else
              move "IV"             to tbliv-codice1
              move emto-cod-ese-iva to tbliv-codice2
              read tivaese no lock
              compute tot-doc rounded = 
                      tot-doc * ( 1 + tbliv-percentuale / 100 )
           end-if.
                 
           move tot-doc to lab-tot-buf.
           display lab-tot 
           .
      * <TOTEM:END>

       CAMBIA-FONT-RIGA.
      * <TOTEM:PARA. CAMBIA-FONT-RIGA>
           modify gd-ordini(riga), ROW-FONT = small-font.

           modify gd-ordini(riga, 1),
                  bitmap        = elemento-bmp,
                  bitmap-number = 1,
                  bitmap-width  = 16.


           move event-data-2 to riga.
           modify gd-ordini(riga), ROW-FONT = font-evidenzia-griglia.

      *    cambio la label legenda
                                                                
           inquire gd-ordini(riga, 1), hidden-data = emto-stato.
           inquire gd-ordini(riga, 2),   cell-data = emto-anno.
           inquire gd-ordini(riga, 3),   cell-data = emto-numero.
           read EDI-mtordini no lock.
           if emto-esistente-no
              move "OK"  to lab-err-doppio-buf
              move 78-colore-chiuso to col-lab-err-doppio
           else
              move "ERR" to lab-err-doppio-buf
              move 78-colore-fatt-tot to col-lab-err-doppio
           end-if.
           if emto-cliente-valido 
              move "OK"  to lab-err-cli-buf           
              move 78-colore-chiuso to col-lab-err-cli
           else                   
              move "ERR" to lab-err-cli-buf             
              move 78-colore-fatt-tot to col-lab-err-cli
           end-if.
           if emto-destino-valido 
              move "OK"  to lab-err-des-buf           
              move 78-colore-chiuso to col-lab-err-des
           else                   
              move "ERR" to lab-err-des-buf           
              move 78-colore-fatt-tot to col-lab-err-des
           end-if.
           if emto-righe-presenti 
              move "OK"  to lab-err-righe-buf         
              move 78-colore-chiuso to col-lab-err-righe
           else                   
              move "ERR" to lab-err-righe-buf     
              move 78-colore-fatt-tot to col-lab-err-righe
           end-if.
           if emto-qta-ok         
              move "OK"  to lab-err-qta-buf           
              move 78-colore-chiuso to col-lab-err-qta
           else                   
              move "ERR" to lab-err-qta-buf         
              move 78-colore-fatt-tot to col-lab-err-qta
           end-if.
           if emto-art-ok         
              move "OK"  to lab-err-art-buf           
              move 78-colore-chiuso to col-lab-err-art
           else
              move "ERR" to lab-err-art-buf         
              move 78-colore-fatt-tot to col-lab-err-art
           end-if.
           if emto-prg-ok       
              move "OK"  to lab-err-prg-buf           
              move 78-colore-chiuso to col-lab-err-prg
           else
              move "ERR" to lab-err-prg-buf
              move 78-colore-fatt-tot to col-lab-err-prg
           end-if.
           if emto-prz-ok  
              move "OK"  to lab-err-prz-buf
              move 78-colore-chiuso to col-lab-err-prz
           else 
              move "ERR" to lab-err-prz-buf
              move 78-colore-fatt-tot to col-lab-err-prz
           end-if.

           if emto-bloc-forzato-no
              move "OK"  to lab-err-bloc-buf
              move 78-colore-chiuso to col-lab-err-bloc
           else 
              move "ERR" to lab-err-bloc-buf
              move 78-colore-fatt-tot to col-lab-err-bloc
           end-if.

           evaluate true
           when emto-attivo
                move 78-colore-chiuso         to col-stato-ordine
                move "Attivo"                 to tit-stato-ordine
      *****     when emto-in-lavorazione
      *****          move 78-colore-in-lavorazione to col-stato-ordine
      *****          move 78-in-lavorazione        to tit-stato-ordine
      *****     when emto-sped-parz
      *****          move 78-colore-sped-parz      to col-stato-ordine
      *****          move 78-sped-parz             to tit-stato-ordine
      *****     when emto-sped-tot
      *****          move 78-colore-sped-tot       to col-stato-ordine
      *****          move 78-sped-tot              to tit-stato-ordine
      *****     when emto-fatt-parz
      *****          move 78-colore-fatt-parz      to col-stato-ordine
      *****          move 78-fatt-parz             to tit-stato-ordine
      *****     when emto-fatt-tot
      *****          move 78-colore-fatt-tot       to col-stato-ordine
      *****          move 78-fatt-tot              to tit-stato-ordine
           when emto-bloccato
                move 78-colore-fatt-tot       to col-stato-ordine
                move "Bloccato"               to tit-stato-ordine
           end-evaluate.

           modify gd-ordini, (riga, 1),
                  bitmap        = elemento-bmp,
                  bitmap-number = 2,
                  bitmap-width  = 16.


           display form2 
           .
      * <TOTEM:END>

       CANCELLA.
      * <TOTEM:PARA. CANCELLA>
           set DeleteXX to true.
           perform ACCESSOXX.
           move como-chiave-ordine to emto-chiave.
           delete EDI-mtordini record.
           
           move low-value   to emro-chiave.
           move emto-chiave to emro-chiave-testa.
           start EDI-mrordini key >= emro-chiave
                 invalid continue
             not invalid
                 perform until 1 = 2
                    read edi-mrordini next 
                         at end exit perform 
                    end-read
                    if emro-chiave-testa not = emto-chiave
                       exit perform 
                    end-if
                    delete edi-mrordini record
                 end-perform
           end-start.

           perform DESTROYXX.
           display message "Cancellazione avvenuta con successo"
                     title titolo.
           set RicaricaGrid to true.
           perform FORM1-EXIT 
           .
      * <TOTEM:END>

       CARICA-GRID.
      * <TOTEM:PARA. CARICA-GRID>
           modify form1-gd-1, reset-grid = 1, mass-update = 1.
           move 0 to righe-errate.
           perform form1-gd-1-CONTENT.
           move 1 to riga.
           move low-value to emro-chiave.
           move emto-chiave to emro-chiave-testa.
           start EDI-mrordini key >= emro-chiave
                 invalid continue
             not invalid
                 perform until 1 = 2
                    read edi-mrordini next at end exit perform end-read
                    if emro-chiave-testa not = emto-chiave
                       exit perform 
                    end-if

                    add 1 to riga

                    perform AGGIUNGI-RIGA
                end-perform
           end-start. 
           modify form1-gd-1, mass-update = 0.
           move 2 to riga event-data-2.
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>

       CARICA-ORDINI.
      * <TOTEM:PARA. CARICA-ORDINI>
           inquire gd-tipocli, last-row in tot-righe.
           
           set per-numero to true.

           if cliente-from not = 0
              set per-cliente to true
           end-if.

           if data-FROM-aaaammgg not = 0
              set per-data    to true
           end-if.

           if data-to-aaaammgg not = 99999999
              set per-data    to true
           end-if.

           if bloccati
              continue
           else
              if not tutti
                 set per-stato   to true
              end-if
           end-if.

           move anno-to      to emto-anno.
           move ordine-from  to emto-numero.

      *****     if data-from-AAAAMMGG = 0
      *****        move anno-to to data-from-AAAAMMGG(1:4)
      *****        move "01"    to data-from-AAAAMMGG(5:2)
      *****        move "01"    to data-from-AAAAMMGG(7:2)
      *****     end-if

           if tutti
              set emto-attivo to true
           else
              move stato-ordine to emto-stato
           end-if.
                     
           set trovato to false.

           move spaces to tge-chiave.
           read tparamge no lock.

           evaluate true
           when per-numero
                move anno-to       to emto-anno
                move ordine-from   to emto-numero
                start EDI-mtordini key >= emto-chiave
                      invalid  continue
                  not invalid  perform SCORRI-ORDINI
                end-start
           when per-cliente
                move cliente-from  to emto-cod-cli
                move low-value     to emto-prg-destino
                                      emto-data-ordine
                start EDI-mtordini key >= k-emto-clides
                      invalid continue
                  not invalid perform SCORRI-ORDINI
                end-start
           when per-data
                move data-from-AAAAMMGG  to emto-data-ordine
                start EDI-mtordini key >= k-emto-data
                      invalid continue
                  not invalid perform SCORRI-ORDINI
                end-start
           when per-stato
                move stato-ordine        to emto-stato
                move cliente-from        to emto-cod-cli
                move data-from-AAAAMMGG  to emto-data-ordine
                start EDI-mtordini key >= k-emto-stato
                      invalid continue
                  not invalid perform SCORRI-ORDINI
                end-start
           end-evaluate.

      ***---
       SCORRI-ORDINI.
           accept como-data from century-date.
           accept como-ora  from time.
           initialize path-tmp-fido.
           accept path-tmp-fido from environment "PATH_ST".
           inspect path-tmp-fido replacing trailing spaces by low-value.
           string  path-tmp-fido delimited low-value
                   "TMP-FIDO_"   delimited size
                   como-data     delimited size
                   "_"           delimited size
                   como-ora      delimited size
              into path-tmp-fido 
           end-string.
           open output tmp-fido.
           close       tmp-fido.
           open i-o    tmp-fido.
           modify gd-ordini, mass-update 1.

           if not ControllaCliente
              move "Caricamento ordini in corso..." to tit-elab
           else
              move "Aggiornamento ordini in corso..." to tit-elab
           end-if.
           display form3.

           perform until 1 = 2
              read EDI-mtordini next at end exit perform end-read
              perform COUNTER-VIDEO 
              evaluate true
              when per-numero
                   if anno-to not = emto-anno
                      exit perform
                   end-if
                   if emto-numero > ordine-to
                      exit perform
                   end-if

              when per-cliente
                   if cliente-from not = emto-cod-cli
                      exit perform
                   end-if
              when per-data
                   if emto-data-ordine > data-to-AAAAMMGG
                      exit perform
                   end-if
              when per-stato
                   if emto-stato not = stato-ordine
                      exit perform
                   end-if
              end-evaluate

              perform VALIDA-RECORD

              if record-ok 
                 perform METTI-IN-GRIGLIA 
              end-if

           end-perform.

           modify gd-ordini, mass-update 0.     

           close       tmp-fido.
           delete file tmp-fido.

      ***---
       METTI-IN-GRIGLIA.
           move emto-anno     to col-anno.
           move emto-numero   to col-numero.

LUBEXX     move emto-data-ordine(1:4) to col-data(7:4).
LUBEXX     move emto-data-ordine(5:2) to col-data(4:2).
LUBEXX     move emto-data-ordine(7:2) to col-data(1:2).

           move "/"                   to col-data(3:1)
                                         col-data(6:1).

           move emto-cod-cli          to Col-cliente
                                         cli-codice.

           move emto-num-ord-cli      to Col-ord-cli.

           set cli-tipo-C to true.
           read clienti   key cli-chiave
                invalid initialize cli-dati
           end-read.
           
           move cli-ragsoc-1          to  Col-rag-soc-cli.
           
           if emto-prg-destino = 0
              move space              to Col-rag-soc-destini
              move cli-indirizzo      to Col-indirizzo
              move cli-localita       to Col-localita              
           else
              move emto-cod-cli        to des-codice
              move emto-prg-destino    to des-prog
              read destini              
                   invalid initialize des-dati
              end-read

              move des-ragsoc-1       to Col-rag-soc-destini
              move des-indirizzo      to Col-indirizzo
              move des-localita       to Col-localita              
           end-if.
           
           evaluate true
           when emto-attivo
                move 78-colore-chiuso         to como-colore
                move "Attivo"                 to col-stato
                add 1 to tot-attivi
      *****     when emto-in-lavorazione
      *****          move 78-colore-in-lavorazione to col-stato-ordine
      *****          move 78-in-lavorazione        to tit-stato-ordine
      *****     when emto-sped-parz
      *****          move 78-colore-sped-parz      to col-stato-ordine
      *****          move 78-sped-parz             to tit-stato-ordine
      *****     when emto-sped-tot
      *****          move 78-colore-sped-tot       to col-stato-ordine
      *****          move 78-sped-tot              to tit-stato-ordine
      *****     when emto-fatt-parz
      *****          move 78-colore-fatt-parz      to col-stato-ordine
      *****          move 78-fatt-parz             to tit-stato-ordine
      *****     when emto-fatt-tot
      *****          move 78-colore-fatt-tot       to col-stato-ordine
      *****          move 78-fatt-tot              to tit-stato-ordine
           when emto-bloccato                               
                move 78-colore-fatt-tot       to como-colore
                move "Bloccato"               to col-stato
                add 1 to tot-bloccati
           end-evaluate.

           modify gd-ordini, record-to-add Gd-ordini-Record.

           inquire gd-ordini, last-row = riga.

           modify gd-ordini(riga), row-color = como-colore.

           modify gd-ordini(riga, 1) hidden-data = emto-stato.
           set trovato to true.         

      ***---        
       VALIDA-RECORD.
           set record-ok to false.
           if emto-anno = anno-to and
              emto-numero >= ordine-from and
              emto-numero <= ordine-to
              set record-ok to true
           else
              set record-ok to false
           end-if.
       
           if emto-data-ordine < data-FROM-aaaammgg
              set record-ok to false
           end-if.
           if emto-data-ordine > data-to-aaaammgg
              set record-ok to false
           end-if.
                            
           if cliente-from not = zero
              if cliente-from not = emto-cod-cli
                 set record-ok to false
              end-if
           end-if.

           if bloccati 
              if emto-bloccato
                 continue
              else
                 set record-ok to false
              end-if
           end-if.

           if anno-to not = emto-anno
              set record-ok to false
           end-if.

           if emto-ordine-anno   not = 0 or 
              emto-ordine-numero not = 0
              |PATCH
              if emto-attivo or emto-bloccato
                 set emto-caricato to true
                 rewrite emto-rec
                 display message "CHECK"
              end-if
              |||||
              set record-ok to false
           end-if.
                                          
           if ControllaCliente and record-ok
              if emto-bloccato or emto-attivo     
                 |Leggo solo per avere il codice iva
                 set cli-tipo-C to true
                 move emto-cod-cli to cli-codice
                 read clienti no lock

                 set tutto-ok to true

                 perform CONTROLLA-FUORI-FIDO
   
                 move Sum to emto-Sum 
                 rewrite emto-rec

                 if tutto-ok
                    set emto-cliente-fido-ok    to true         
      *              set emto-bloc-forzato-no    to true
                 else
                    set emto-cliente-fuori-fido to true
                    set emto-bloccato           to true
                 end-if                                              
                 |05052020 Se il cliente è bloccato, dev'essere rosso
      *****        end-if             
      *****
      *****        if emto-bloccato
                 set emto-cliente-valido  to true 
                 set cli-tipo-C to true
                 move emto-cod-cli to cli-codice
                 read clienti no lock
                     invalid set emto-cliente-non-valido to true
                 not invalid
                     
                     if cli-bloccato or cli-disattivo
                        set emto-cliente-non-attivo to true
                     end-if
                     |Se il fido extra è sufficiente verrà 
                     |deciso dopo dal programma di conferma
                     if cli-fuori-fido |and cli-fido-extra = 0
                        set emto-cliente-fuori-fido to true
                        set emto-cliente-non-attivo to true
                     end-if
                 end-read

                 if emto-cliente-valido  and
                    emto-cliente-fido-ok and 
                    emto-destino-valido  and 
                    emto-righe-presenti  and 
                    emto-qta-ok          and 
                    emto-art-ok          and 
                    emto-prg-ok          and
                    emto-prz-ok          and
                    emto-bloc-forzato-no and
                    emto-esistente-no
                    set emto-attivo          to true
                 else
                    set emto-bloccato to true
                 end-if
                 rewrite emto-rec
              end-if

      *****        |Considetro gli ordini bloccati SOLO per fido
      *****        if emto-bloccato
      *****
      *****           if emto-cliente-fuori-fido and
      *****              emto-destino-valido     and 
      *****              emto-righe-presenti     and 
      *****              emto-qta-ok             and 
      *****              emto-art-ok             and 
      *****              emto-prg-ok             and
      *****              emto-prz-ok             and
      *****              emto-esistente-no       and
      *****              emto-bloc-forzato-no    and
      *****              emto-esistente-no
      *****
      *****              set tutto-ok to true
      *****              perform CONTROLLA-FUORI-FIDO
      *****
      *****              if tutto-ok
      *****                 set emto-cliente-fido-ok to true
      *****                 set emto-attivo to true
      *****                 set emto-bloc-forzato-no to true
      *****                 set emto-cliente-valido  to true
      *****                 rewrite emto-rec
      *****              end-if
      *****           end-if
      *****        end-if
           end-if.         

           if record-ok             
              set cli-tipo-C to true
              move emto-cod-cli to cli-codice
              read clienti no lock
                   invalid continue |altrimenti non lo vedrei mai
               not invalid
                   perform varying riga from 2 by 1 
                             until riga > tot-righe
                      inquire gd-tipocli(riga, 1), 
                              cell-data in  col-tcl-codice
                      if col-tcl-codice = cli-tipo
                         inquire gd-tipocli(riga, 1), 
                                 hidden-data in hid-col-sel
                         if hid-col-sel = 0
                            set record-ok to false
                         end-if
                      end-if
                   end-perform
              end-read
           end-if 
           .
      * <TOTEM:END>

       CERCA.
      * <TOTEM:PARA. CERCA>
           evaluate control-id
           when 78-ID-ef-cli
                set cli-tipo-c  to true
                inquire ef-cli, value in cli-codice
                move "clienti-alfa-all" to como-file
                move spaces to cli-ragsoc-1
                call "zoom-gt"  using como-file, cli-rec
                               giving stato-zoom
                end-call
                cancel "zoom-gt"

                if stato-zoom = 0
                   move cli-codice     to ef-cli-buf
                   perform RAGSOC-CLIENTE
                   display ef-cli lab-cliente
                end-if    

           when 78-ID-ef-prov-d
                inquire ef-prov-d, value in prv-codice
                move "tprov"    to como-file
                call "zoom-gt"  using como-file, prv-rec
                                giving stato-zoom
                end-call
                cancel "zoom-gt"
                if stato-zoom = 0
                   move prv-codice to ef-prov-d-buf
                   display ef-prov-d
                end-if 

           when 78-ID-ef-cap-d
                inquire ef-cap-d, value in anc-cap
                move "anacap"      to como-file
                call "zoom-gt"  using como-file, anc-rec
                                giving stato-zoom
                end-call
                cancel "zoom-gt"
                if stato-zoom = 0
                   move anc-cap to ef-cap-d-buf
                   display ef-cap-d
                end-if 

           when 78-ID-ef-des
                inquire ef-cli, value in des-codice
                set cli-tipo-c to true
                move "clienti-des"    to como-file
                inquire ef-des, value in des-prog
                call "zoom-gt"  using como-file, des-rec
                                giving stato-zoom
                end-call
                cancel "zoom-gt"
                if stato-zoom = 0
                   move des-prog     to ef-des-buf
                   perform RAGSOC-DESTINO
                   display ef-des lab-destino
                end-if

           when 78-ID-ef-des
                inquire ef-cli, value in des-codice
                set cli-tipo-c to true
                move "clienti-des"    to como-file
                inquire ef-des, value in des-prog
                call "zoom-gt"  using como-file, des-rec
                                giving stato-zoom
                end-call
                cancel "zoom-gt"
                if stato-zoom = 0
                   move des-prog     to ef-des-buf
                   perform RAGSOC-DESTINO
                   display ef-des lab-destino
                end-if

           when 78-ID-ef-vet
                move "tvettori"  to como-file
                inquire ef-vet, value in vet-codice
                call "zoom-gt"   using como-file, vet-rec
                                giving stato-zoom
                end-call
                cancel "zoom-gt"
                if stato-zoom = 0
                   move vet-codice      to ef-vet-buf
                   move vet-descrizione to lab-vettore-buf
                   display ef-vet lab-vettore
                end-if

           when 78-ID-ef-age
                move "agenti"    to como-file
                inquire ef-age,  value in age-codice
                call "zoom-gt"   using como-file, age-rec
                                giving stato-zoom
                end-call
                cancel "zoom-gt"
                if stato-zoom = 0
                   move age-codice   to ef-age-buf
                   move age-ragsoc-1 to lab-agente-buf
                   display ef-age lab-agente
                end-if

           when 78-ID-ef-iva
                move "tivaese"     to como-file
                move "IV"          to tbliv-codice1
                inquire ef-iva,  value in tbliv-codice2
                call "zoom-gt"   using como-file, record-tbliv
                                giving stato-zoom
                end-call
                cancel "zoom-gt"
                if stato-zoom = 0
                   move tbliv-codice2      to ef-iva-buf
                   move tbliv-descrizione1 to lab-iva-buf
                   display ef-iva lab-iva
                end-if

           when 78-ID-ef-pag
                move "tcodpag"   to como-file
                move "PA"        to tblpa-codice1
                inquire ef-pag,  value in tblpa-codice2
                call "zoom-gt"   using como-file, record-tblpa
                                giving stato-zoom
                end-call
                cancel "zoom-gt"
                if stato-zoom = 0
                   move tblpa-codice2      to ef-pag-buf
                   move tblpa-descrizione1 to lab-pagamento-buf
                   display ef-pag lab-pagamento
                end-if
                
           when 78-ID-form1-gd-1
LABLAB          if tcl-si-recupero       and 
                   tca-prezzo-reso-no
                   inquire form1-gd-1, cursor-y in store-riga
                   inquire form1-gd-1(store-riga, 78-col-art), 
                           cell-data col-art
LABLAB             set promo-future to true
LABLAB             perform CERCA-PROMO-LISTINO
                   if trovato
                      move store-riga to riga
                      if not prezzo-sp
                         |DEVO AGGIORNARE LA PROMO NEL RECORD

                         inquire form1-gd-1(riga, 78-col-num),
                              cell-data in col-num

                         move emto-chiave to emro-chiave-testa
                         move col-num     to emro-riga
                         read edi-mrordini

                         move rpr-codice    to emro-promo    
                         move rpr-prz-acq   to emro-prz emro-prz-GESLUX
                         
                         set emro-bloccato-prezzo-no to true
                         set emro-prezzo-valido      to true

                         rewrite emro-rec 
                      end-if
                      set RigaCambiata   to true
                      move rpr-prz-acq   to col-prz col-prz-GESLUX
                      modify form1-gd-1(riga, 78-col-prz), 
                             cell-data col-prz       
                      modify form1-gd-1(riga, 78-col-prz-GESLUX), 
                             cell-data col-prz-GESLUX
                      perform IMPOSTA-PREZZO
                   end-if
LABLAB          end-if
           end-evaluate           
           .
      * <TOTEM:END>

       CERCA-INI.
      * <TOTEM:PARA. CERCA-INI>
           evaluate control-id
           when 78-ID-ef-cliente-from
                inquire ef-cliente-from, value in cli-codice
                set cli-tipo-C to true
                move spaces to cli-ragsoc-1
                move "clienti-alfa-all" to como-file
                call "zoom-gt"  using  como-file, cli-rec
                               giving  stato-zoom
                cancel "zoom-gt"
                if stato-zoom = 0
                   move cli-codice to cliente-from
                   display ef-cliente-from
                   move cli-ragsoc-1 to lab-cli-buf
                   display lab-cli
                end-if

           end-evaluate 
           .
      * <TOTEM:END>

       CERCA-PROMO-LISTINO.
      * <TOTEM:PARA. CERCA-PROMO-LISTINO>

           move col-art to art-codice.
           move ef-des-buf to emto-prg-destino.
           set trovato      to false.
           |Inserimento ordini
           move ef-data-buf to como-data.
           perform DATE-TO-FILE.
           move como-data to emto-data-ordine.

           initialize path-tmp-promo-prz.
           move 0 to num-promo.

           |Provo con la promo locale
           if emto-prg-destino not = 0
              if promo-future
                 move cli-gdo          to loc-gdo
                 move cli-codice       to loc-cliente
                 move emto-prg-destino to loc-destino
                 move 0                to loc-ini-dpo
                 move low-value        to loc-fine-dpo
                 start locali key >= loc-chiave-ricerca
                       invalid set record-ok to false
                   not invalid set record-ok to true
                 end-start
              else
                 move cli-gdo          to loc-gdo
                 move cli-codice       to loc-cliente
                 move emto-prg-destino to loc-destino
                 move emto-data-ordine to loc-fine-dpo
                 move low-value        to loc-ini-dpo
                 start locali key >= loc-chiave-gdo-fine
                       invalid set record-ok to false
                   not invalid set record-ok to true
                 end-start
              end-if
              if record-ok
                 perform until 1 = 2
                    read locali next at end exit perform end-read
                    if loc-gdo     not = cli-gdo    or
                       loc-cliente not = cli-codice or
                       loc-destino not = emto-prg-destino
                       exit perform
                    end-if

                    if ( loc-fine-dpo >= emto-data-ordine  and
                         loc-ini-dpo  <= emto-data-ordine ) or
                       ( promo-future and 
                         loc-fine-dpo >= emto-data-ordine )

                       move loc-codice to tpr-codice
                       read tpromo no lock
                            invalid continue
                        not invalid
                            if tpr-gdo      = loc-gdo     and
                               tpr-ini-dpo  = loc-ini-dpo and
                               tpr-fine-dpo = loc-fine-dpo
                               move tpr-codice to rpr-codice
                               move art-codice to rpr-articolo
                               read rpromo no lock
                                    invalid continue
                                not invalid
                                    if path-tmp-promo-prz = spaces
                                       perform APRI-TMP-PROMO-PRZ
                                    end-if
                                    set trovato to true
                                    add 1 to num-promo
                                    move tpr-codice to tprz-codice
                                    move cli-gdo    to tprz-gdo
                                    move tpr-descrizione
                                      to tprz-descr
                                    move tpr-ini-dpo
                                      to tprz-ini-dpo
                                    move tpr-fine-dpo
                                      to tprz-fine-dpo
                                    move rpr-prz-acq
                                      to tprz-prz-acq
                                    write tprz-rec
                                          invalid continue
                                    end-write
                               end-read
                            end-if
                       end-read
                    end-if
                 end-perform
              end-if
           end-if.

           |PROMO GDO
           if not trovato
              if promo-future
                 move cli-gdo         to tpr-gdo
                 move 0               to tpr-ini-dpo
                 move low-value       to tpr-fine-dpo
                 start tpromo  key >= tpr-chiave-ricerca
                       invalid set record-ok to false
                   not invalid set record-ok to true
                 end-start
              else
                 move cli-gdo         to tpr-gdo
                 move emto-data-ordine to tpr-fine-dpo
                 move low-value       to tpr-ini-dpo
                 start tpromo  key >= tpr-chiave-gdo-fine
                       invalid set record-ok to false
                   not invalid set record-ok to true
                 end-start
              end-if

              if record-ok
                 perform until 1 = 2
                    read tpromo next at end exit perform end-read
                    if tpr-gdo not = cli-gdo
                       exit perform
                    end-if

                    if ( tpr-fine-dpo >= emto-data-ordine  and
                         tpr-ini-dpo  <= emto-data-ordine ) or
                       ( promo-future and 
                         tpr-fine-dpo >= emto-data-ordine )

                       if tpr-nazionale
                          move tpr-codice to rpr-codice
                          move art-codice to rpr-articolo
                          read rpromo no lock 
                               invalid continue
                           not invalid
                               set trovato to true
                               if path-tmp-promo-prz = spaces
                                  perform APRI-TMP-PROMO-PRZ
                               end-if
                               add 1 to num-promo
                               move tpr-codice       to tprz-codice
                               move cli-gdo          to tprz-gdo
                               move tpr-descrizione  to tprz-descr
                               move tpr-ini-dpo      to tprz-ini-dpo
                               move tpr-fine-dpo     to tprz-fine-dpo
                               move rpr-prz-acq      to tprz-prz-acq
                               write tprz-rec invalid continue end-write
                          end-read
                       end-if
                    end-if
                 end-perform
              end-if

           end-if.

           if not trovato 
              if not promo-future
                 move 0                to rpr-codice
                 move cli-gdo          to lst-gdo
                 move emto-data-ordine to lst-data
                 move art-codice       to lst-articolo
                 start listini key <= lst-k-articolo
                       invalid continue
                   not invalid
                       read listini previous
                       if lst-gdo      = cli-gdo          and
                          lst-data    <= emto-data-ordine  and
                          lst-articolo = art-codice
                          |In caso di "FA" non cerco promo 
                          |né successive né precedenti
                          if lst-prezzo >= 999999,99
                             set hid-bloccato to true
                             set trovato      to false
                          else
                             if lst-prezzo not = 0
                                set trovato to true
                                move lst-prezzo   to rpr-prz-acq
                                set  hid-bloccato to false
                             else
                                set prezzo-sp to true
      *****                          set  hid-bloccato to true (levato in data 12/05/09)
                                |RIMESSO REL. 2.7.1 (21/10/2011)
                                set hid-bloccato to true
                                |CASO "SP"
                                |1. Cerco la promo immediatamente dopo
                                perform CERCA-PROMO-DOPO
                                if not trovato
                                   |2. Cerco la promo immediatamente prima
                                   perform CERCA-PROMO-PRIMA
                                end-if
                             end-if
                          end-if
                       end-if
                 end-start
              end-if
           else
              if num-promo > 1 or promo-future
                 move path-tmp-promo-prz to ext-file
                 move "tmp-promo-prz"    to como-file
                 call "zoom-gt"       using como-file, 
                                            tprz-rec
                                     giving stato-zoom
                 end-call
                 cancel "zoom-gt"
                 if stato-zoom = 0
                    move tprz-codice  to rpr-codice
                    move tprz-prz-acq to rpr-prz-acq
                    set trovato to true
                 else
                    set trovato to false
                 end-if
              else
                 move tprz-codice  to rpr-codice
                 move tprz-prz-acq to rpr-prz-acq
              end-if
              close       tmp-promo-prz
              delete file tmp-promo-prz
           end-if.

      ***---
       CERCA-PROMO-DOPO.
           if emto-prg-destino not = 0
              move cli-gdo          to loc-gdo
              move cli-codice       to loc-cliente
              move emto-prg-destino to loc-destino
              move emto-data-ordine to loc-ini-dpo
              move low-value        to loc-fine-dpo
              start locali key >= loc-chiave-ricerca
                    invalid set record-ok to false
                not invalid set record-ok to true
              end-start

              if record-ok
                 perform until 1 = 2
                    read locali next at end exit perform end-read
                    if loc-gdo      not =  cli-gdo         or
                       loc-cliente  not =  cli-codice      or
                       loc-destino  not =  emto-prg-destino
                       exit perform
                    end-if

                    if loc-ini-dpo  >= emto-data-ordine and
                       loc-fine-dpo >= emto-data-ordine
                       move loc-codice to tpr-codice
                       read tpromo no lock
                            invalid continue
                        not invalid
                            if tpr-gdo      = loc-gdo     and
                               tpr-ini-dpo  = loc-ini-dpo and
                               tpr-fine-dpo = loc-fine-dpo
                               move tpr-codice to rpr-codice
                               move art-codice to rpr-articolo
                               read rpromo no lock 
                                    invalid continue
                                not invalid set trovato to true
                                            exit perform
                               end-read
                            end-if
                       end-read
                    end-if

                 end-perform
              end-if
           end-if.

           if not trovato
              move cli-gdo          to tpr-gdo
              move emto-data-ordine to tpr-ini-dpo
              move low-value        to tpr-fine-dpo
              start tpromo key >= tpr-chiave-ricerca
                    invalid set record-ok to false
                not invalid set record-ok to true
              end-start

              if record-ok
                 perform until 1 = 2
                    read tpromo next at end exit perform end-read
                    if tpr-gdo not = cli-gdo
                       exit perform
                    end-if

                    if tpr-fine-dpo > emto-data-ordine and
                       tpr-ini-dpo  > emto-data-ordine
                       move tpr-codice to rpr-codice
                       move art-codice to rpr-articolo
                       read rpromo no lock 
                            invalid continue
                        not invalid set trovato to true
                                    exit perform
                       end-read
                    end-if
                 end-perform
              end-if
           end-if.                   

      ***---
       CERCA-PROMO-PRIMA.
           if emto-prg-destino not = 0
              move cli-gdo          to loc-gdo
              move cli-codice       to loc-cliente
              move emto-prg-destino to loc-destino
              move emto-data-ordine to loc-fine-dpo
              move low-value        to loc-ini-dpo
              start locali key <= loc-chiave-gdo-fine
                    invalid set record-ok to false
                not invalid set record-ok to true
              end-start

              if record-ok
                 perform until 1 = 2
                    read locali previous at end exit perform end-read
                    if loc-gdo     not =  cli-gdo      or
                       loc-cliente not =  cli-codice   or
                       loc-destino not =  emto-prg-destino
                       exit perform
                    end-if

                    if loc-ini-dpo  >= emto-data-ordine and
                       loc-fine-dpo >= emto-data-ordine
                       move loc-codice to tpr-codice
                       read tpromo no lock
                            invalid continue
                        not invalid
                            if tpr-gdo      = loc-gdo     and
                               tpr-ini-dpo  = loc-ini-dpo and
                               tpr-fine-dpo = loc-fine-dpo
                               move tpr-codice to rpr-codice
                               move art-codice to rpr-articolo
                               read rpromo no lock 
                                    invalid continue
                                not invalid set trovato to true
                                            exit perform
                               end-read
                            end-if
                       end-read
                    end-if
                 end-perform
              end-if
           end-if.

           if not trovato
              move cli-gdo          to tpr-gdo
              move emto-data-ordine to tpr-fine-dpo
              move low-value        to tpr-ini-dpo
              start tpromo key <= tpr-chiave-gdo-fine
                    invalid set record-ok to false
                not invalid set record-ok to true
              end-start

              if record-ok
                 perform until 1 = 2
                    read tpromo previous at end exit perform end-read
                    if tpr-gdo not = cli-gdo
                       exit perform
                    end-if
                    if tpr-fine-dpo < emto-data-ordine and
                       tpr-ini-dpo  < emto-data-ordine
                       move tpr-codice to rpr-codice
                       move art-codice to rpr-articolo
                       read rpromo no lock 
                            invalid continue
                        not invalid set trovato to true
                                    exit perform
                       end-read
                    end-if
                 end-perform
              end-if

           end-if.


      ***---
       APRI-TMP-PROMO-PRZ.
           accept  como-data from century-date.
           accept  como-ora  from time.
           accept  path-tmp-promo-prz from environment "PATH_ST".
           inspect path-tmp-promo-prz replacing trailing 
                                      spaces by low-value.
           string  path-tmp-promo-prz delimited low-value
                   "TMP-PROMO-PRZ"    delimited size
                   "_"                delimited size
                   como-data          delimited size
                   "_"                delimited size
                   como-ora           delimited size
                   ".tmp"             delimited size
                   into path-tmp-promo-prz
           end-string.
           open output tmp-promo-prz 
           .
      * <TOTEM:END>

       CHECK-QTA-IMBALLO.
      * <TOTEM:PARA. CHECK-QTA-IMBALLO>
           evaluate true
           when imq-qta-imb > como-qta
                move imq-qta-imb to col-qta como-qta
                display message 
                   "La quantità verrà adattata al nuovo imballo."
            x"0d0a""Confermi?"
                         title titolo
                          type mb-yes-no
                          icon 2
                        giving scelta

           when imq-qta-imb < como-qta
                 move 0 to como-div
                 compute como-div = 
                         como-qta / imq-qta-imb
                 compute como-div = 
                         como-div * imq-qta-imb
                 if como-div not = como-qta
                    compute como-div = 
                            como-qta / imq-qta-imb
                    add 1 to como-div
                    compute como-qta = como-div * imq-qta-imb
                    move como-qta to col-qta
                    display message 
                   "La quantità verrà adattata al nuovo imballo."
            x"0d0a""Confermi?"
                              title titolo
                               type mb-yes-no
                               icon 2
                             giving scelta
                 end-if
           end-evaluate 
           .
      * <TOTEM:END>

       CHIAMA-MANUTENZIONE.
      * <TOTEM:PARA. CHIAMA-MANUTENZIONE>
           set  RicaricaGrid       to false.
           move como-anno          to emto-anno.
           move como-numero-ordine to emto-numero.
           read EDI-mtordini no lock invalid continue end-read.

           modify form2-Handle, visible = zero.

           perform FORM1-OPEN-ROUTINE.

           modify form2-Handle, visible = 1 
           .
      * <TOTEM:END>

       CONTROLLO.
      * <TOTEM:PARA. CONTROLLO>
           if mod   = 0 
              exit paragraph 
           end-if.
           set tutto-ok to true.

           evaluate control-id
           |78-ID-ef-cli è l'ID del control ef-cli
           when 78-ID-ef-cli
                inquire ef-cli, value in ef-cli-buf
                if ef-cli-buf not = 0
                   perform SELEZIONA-NUMERICO
                   display lab-cliente

                else
                   set errori to true
                   move 78-ID-ef-cli to control-id
                   display message "Inserimento codice cliente mancante"
                           title = tit-err
                           icon mb-warning-icon
                end-if
                
                if tutto-ok
                   perform LETTURE-CLIENTE
                end-if

           |78-ID-ef-des è l'ID del control ef-des
           when 78-ID-ef-des
                inquire ef-des, value in ef-des-buf
                if ef-des-buf not = 0
                   perform SELEZIONA-DESTINO-NUMERICO
                   display lab-destino
                else
                   if not StoSalvando
                      perform TROVA-DESTINO
                      if trovato
                         display message "Esiste uno o più destini per"
                                         " il cliente specificato."
                                  x"0d0a""Procedere comunque con "
                                         "progressivo non valorizzato?"
                                 title = titolo
                                 type mb-yes-no
                                 giving scelta
                         if scelta = mb-no
                            set errori to true
                            move 78-ID-ef-cli to control-id
                         else
                            move 0 to des-prog
                            move spaces to lab-destino-buf
                            display lab-destino
                         end-if
                      else
                         move spaces to lab-destino-buf
                         display lab-destino
                      end-if
                   end-if
                end-if
                if tutto-ok
                   if tca-cap-obbligatorio-si
                      if des-prog = 0
                         move cli-cap to des-cap
                      end-if
                      if des-cap = spaces or = "00000"
                         display message 
                         "CAP obbligatorio per questo magazzino"
                                   title tit-err
                                    icon 2
                         set errori to true
                      end-if
                   end-if
                end-if
                if tutto-ok
                   if des-prog = 0
                      move cli-nazione to des-nazione
                      move cli-utf to des-deposito-utf
                   end-if
                end-if

           when 78-ID-ef-num-ord

                inquire ef-num-ord, value in chk-num-ord-cli

                if chk-num-ord-cli not = spaces
                   initialize chk-ord-cli-linkage
                              replacing numeric data by zeroes
                                   alphanumeric data by spaces

                   move emto-chiave  to chk-ord-chiave
                   move lab-anno-buf to chk-ord-anno 
                   inquire ef-cli,     value in chk-cod-cli
                   inquire ef-des,     value in chk-prg-destino
                   inquire ef-num-ord, value in chk-num-ord-cli

                   move emto-chiave  to chk-ord-chiave-EDI
                   move lab-anno-buf to chk-ord-anno-EDI
                   inquire ef-cli,     value in chk-cod-cli-EDI
                   inquire ef-des,     value in chk-prg-destino-EDI
                   inquire ef-num-ord, value in chk-num-ord-cli-EDI

                   call   "check-ord-cli" using chk-ord-cli-linkage
                   cancel "check-ord-cli"                          

                   if chk-ord-status = -1
                      display message "Esiste già l'ordine con"
                               x"0d0a""Anno: " chk-ord-anno
                               x"0d0a""Numero: " chk-ord-numero
                               x"0d0a""avente lo stesso numero ordine."
                               x"0d0a""Proseguire?"
                                title titolo
                                 type mb-yes-no
                               giving scelta
                                 icon 2
                      if scelta = mb-no
                         set errori to true
                         move 78-ID-ef-num-ord to control-id
                      end-if
                   else
                      move mb-yes to scelta
                   end-if

                   if chk-ord-status-EDI = -1 and scelta = mb-yes
                      display message "Esiste già l'ordine EDI con"
                               x"0d0a""Anno: " chk-ord-anno-EDI
                               x"0d0a""Numero: " chk-ord-numero-EDI
                               x"0d0a""avente lo stesso numero ordine."
                               x"0d0a""Proseguire?"
                                title titolo
                                 type mb-yes-no
                               giving scelta
                                 icon 2
                      if scelta = mb-no
                         set errori to true
                         move 78-ID-ef-num-ord to control-id
                      end-if
                   end-if

                end-if

           |78-ID-ef-data è l'ID del control ef-data
           when 78-ID-ef-data
                inquire ef-data, value in ef-data-buf
                move ef-data-buf to como-data
                if como-data = 0
                   move data-oggi to como-data
                   perform DATE-TO-SCREEN
                   move como-data to ef-data-buf
                   move data-oggi to como-data
                else
                   |Prima ne controllo la validita...

                   move ef-data-buf to como-data
                   perform DATE-FORMAT
                   move como-data to ef-data-buf

                   perform DATE-TO-FILE
      *****             |...poi che non sia > alla data di oggi
      *****             move ef-data-buf to como-data
      *****             perform DATE-TO-FILE
      *****             if como-data > data-oggi
      *****                set errori to true
      *****                display message "Data dell'ordine > data odierna"
      *****                        title = tit-err
      *****                        icon mb-warning-icon
      *****                move 78-ID-ef-anno to control-id
      *****             end-if
                end-if
                display ef-data

           |78-ID-ef-data-pass è l'ID del control ef-data-pass
           when 78-ID-ef-data-pass
                inquire ef-data-pass, value in ef-data-pass-buf
                move ef-data-pass-buf to como-data
                if como-data = 0
                   move data-oggi to como-data
                   perform DATE-TO-SCREEN
                   move como-data to ef-data-pass-buf
                else
                   perform DATE-FORMAT
                   move como-data to ef-data-pass-buf
                end-if
                display ef-data-pass

           |78-ID-ef-data-pass è l'ID del control ef-data-pass
           when 78-ID-ef-evadi-dal
                inquire ef-evadi-dal, value in ef-evadi-dal-buf
                move ef-evadi-dal-buf to como-data
                if como-data = 0
                   move data-oggi to como-data
                   perform DATE-TO-SCREEN
                   move como-data to ef-evadi-dal-buf
                else
                   perform DATE-FORMAT
                   move como-data to ef-evadi-dal-buf
                end-if
                display ef-evadi-dal

                inquire ef-evadi-dal, value in ef-evadi-dal-buf
                move ef-evadi-dal-buf to como-data
                perform DATE-TO-FILE
                if data-evadi-dal-old = 0
                   move emto-evadi-dal to data-evadi-dal-old
                end-if
                if como-data not = data-evadi-dal-old
                   move como-data to data-evadi-dal-old
                   display message "E' stata cambiata la data."
                            x"0d0a""Riportarla su tutte le righe?"
                             type mb-yes-no
                             icon 2
                          default mb-no
                           giving scelta
                   if scelta = mb-yes
                      set RigaCambiata to true
                      perform DATE-TO-SCREEN
                      move como-data to col-evadi-dal
                      inquire form1-gd-1, last-row in tot-righe
                      perform varying riga from 2 by 1 
                                until riga > tot-righe
                         modify form1-gd-1(riga, 78-col-evadi-dal), 
                                cell-data col-evadi-dal
                      end-perform
                   end-if
                end-if  
                                                  
           when 78-ID-ef-prov-d
                inquire ef-prov-d, value in prv-codice
                read tprov
                     invalid
                     set errori to true        
                     display message "Provincia NON valida"
                               title tit-err
                                icon mb-warning-icon
                     move 78-ID-ef-prov-d to control-id
                end-read

           when 78-ID-ef-cap-d
                inquire ef-cap-d, value in anc-cap
                read anacap
                     invalid
                     set errori to true        
                     display message "CAP NON valido"
                               title tit-err
                                icon mb-warning-icon
                     move 78-ID-ef-cap-d to control-id
                end-read

           |78-ID-ef-age è l'ID del control ef-age
           when 78-ID-ef-age
                inquire ef-age, value in ef-age-buf  
                move spaces to lab-agente-buf
                move ef-age-buf to age-codice
                read agenti 
                     invalid
                        set errori to true        
                        display message "Codice agente NON valido"
                                title = tit-err
                                icon mb-warning-icon
                        move 78-ID-ef-age to control-id
                 not invalid move age-ragsoc-1 to lab-agente-buf
                end-read
                display lab-agente

           |78-ID-ef-pag è l'ID del control ef-pag
           when 78-ID-ef-pag
                inquire ef-pag, value in ef-pag-buf  
                if ef-pag-buf not = SavePag
                   move 1 to Passwd-password
                   call   "passwd" using Passwd-linkage
                   cancel "passwd"

                   if not Passwd-StatusOk
                      move SavePag to ef-pag-buf
                      display ef-pag
                      move "PA"       to tblpa-codice1
                      move ef-pag-buf to tblpa-codice2
                      read tcodpag
                           invalid continue
                       not invalid 
                           move tblpa-descrizione1 to lab-pagamento-buf
                           display lab-pagamento
                      end-read
                   else
                      move "PA"       to tblpa-codice1
                      move ef-pag-buf to tblpa-codice2
                      read tcodpag
                           invalid
                           set errori to true
                           display message "Codice pagamento NON valido"
                                     title tit-err
                                      icon mb-warning-icon
                           move 78-ID-ef-pag to control-id
                           move SavePag to ef-pag-buf
                           display ef-pag
                       not invalid 
                           move tblpa-descrizione1 to lab-pagamento-buf
                           move ef-pag-buf to SavePag
                           display lab-pagamento
                      end-read
                   end-if
                end-if
                if tutto-ok
                   move ef-pag-buf to pgb-codice
                   read pagbloc no lock
                        invalid continue
                    not invalid
                        set errori to true
                        move 78-ID-ef-pag to control-id
                        display message "Codice pagamento BLOCCATO"
                                  title tit-err
                                   icon mb-warning-icon
                   end-read
                end-if

           |78-ID-ef-iva è l'ID del control ef-iva
           when 78-ID-ef-iva
                inquire ef-iva, value in ef-iva-buf  
                if ef-iva-buf not = SaveIva
                   move 1 to Passwd-password
                   call   "passwd" using Passwd-linkage
                   cancel "passwd"

                   if not Passwd-StatusOk
                      move SaveIva to ef-iva-buf
                      display ef-iva
                      move "IV"       to tbliv-codice1
                      move ef-iva-buf to tbliv-codice2
                      read tivaese
                           invalid continue
                       not invalid 
                           move tbliv-descrizione1 to lab-iva-buf
                      end-read
                   else
                      move "IV"       to tbliv-codice1
                      move ef-iva-buf to tbliv-codice2
                      read tivaese
                           invalid
                           if ef-iva-buf = spaces
                              move spaces to lab-iva-buf
                           else
                              set errori to true        
                              display message "Codice IVA NON valido"
                                        title tit-err
                                         icon mb-warning-icon
                              move 78-ID-ef-iva to control-id
                              move SaveIva      to ef-iva-buf
                              display ef-iva
                           end-if
                       not invalid 
      *****                     if tbliv-percentuale not = 0
      *****                        set errori to true        
      *****                        display message"Codice IVA NON valido "
      *****                                       "in quanto non esente"
      *****                                  title tit-err
      *****                                   icon mb-warning-icon
      *****                        move 78-ID-ef-iva to control-id
      *****                        move SaveIva      to ef-iva-buf
      *****                        display ef-iva
      *****                     else                   
                              move tbliv-descrizione1 to lab-iva-buf
                              move ef-iva-buf to SaveIva
      *****                     end-if
                      end-read
                   end-if
                end-if
                display lab-iva

           |78-ID-ef-vet è l'ID del control ef-vet
           when 78-ID-ef-vet
                inquire ef-vet, value in ef-vet-buf  
                move ef-vet-buf to vet-codice
                if vet-codice = 0
                   move 0 to SaveVet
                   move spaces to lab-vettore-buf
                   display lab-vettore
                else
                   move 0 to chk-ritira-buf          
                   display chk-ritira
                end-if           
                if vet-codice not = SaveVet 
                   
                   move ef-vet-buf to vet-codice
                   read tvettori
                        invalid continue
                    not invalid 
                        if vet-su-autorizz-si
                           move 12 to Passwd-password
                           call   "passwd" using Passwd-linkage
                           cancel "passwd"
                        else
                           set Passwd-StatusOk to true
                        end-if
                   end-read

                   if not Passwd-StatusOk
                      move SaveVet to ef-vet-buf
                      display ef-vet
                      move ef-vet-buf to vet-codice
                      read tvettori 
                           invalid continue
                       not invalid 
                           move vet-descrizione to lab-vettore-buf
                           display lab-vettore
                      end-read
                   else
                      move ef-vet-buf to vet-codice
                      read tvettori
                           invalid
                           set errori to true
                           display message "Codice vettore NON valido"
                                     title tit-err
                                      icon mb-warning-icon
                           move 78-ID-ef-vet to control-id
                           move SaveVet      to ef-vet-buf
                           display ef-vet            
                           move spaces to lab-vettore-buf
                           display lab-vettore
                       not invalid                   
                           move ef-vet-buf to SaveVet
                           move vet-descrizione to lab-vettore-buf
                           display lab-vettore
                      end-read
                   end-if                            
                end-if

           |78-ID-ef-data-cons è l'ID del control ef-data-cons
           when 78-ID-ef-data-cons
                move 0 to not-data
                move ef-cli-buf   to not-codice 
                move ef-des-buf   to not-prog   
                read note invalid continue end-read

                inquire ef-data-cons, value in ef-data-cons-buf
                move ef-data-cons-buf to como-data
                if como-data = 0       
                   accept  como-data from century-date
                   compute como-data = 
                           function integer-of-date (como-data)
                   subtract 1 from como-data
                   compute como-data = 
                           function date-of-integer (como-data)
                   move como-data to not-data
                   perform DATE-TO-SCREEN
                   move como-data  to ef-data-cons-buf
      *****             if not-data = 0     
      *****                move como-data to not-data
      *****                accept  como-data from century-date
      *****                move cli-codice to como-prm-cliente
      *****                move des-prog   to como-prm-destino
      *****                perform TROVA-PARAMETRO
      *****                compute como-data = como-data       +
      *****                                    prm-gg-parziale + 
      *****                                    prm-gg-per-cons
      *****                compute not-data = 
      *****                        function date-of-integer (como-data)
      *****             end-if
      *****             move not-data   to como-data
      *****             perform DATE-TO-SCREEN
      *****             move como-data  to ef-data-cons-buf
                else
                   perform DATE-FORMAT
                   move como-data to ef-data-cons-buf
                end-if
                display ef-data-cons

           end-evaluate.

           if errori 
              perform CANCELLA-COLORE
              move 4 to accept-control
           end-if.


      ***---
       SELEZIONA-NUMERICO.
           set tutto-ok to true.
           move spaces to lab-cliente-buf.

           inquire ef-cli, value in cli-codice.
           if cli-codice not > 0
              set errori to true
              move 78-ID-ef-cli to CONTROL-ID
              display message box msg-codice-obbligatorio
                      title tit-err
                      icon  MB-WARNING-ICON
           else          
              set cli-tipo-c to true
              read clienti no lock
                   invalid
                   display message box "Codice cliente NON valido"
                           title = tit-err
                           icon MB-WARNING-ICON
                   set errori to true
                   move 78-ID-ef-cli to CONTROL-ID
               not invalid
                   if cli-disattivo or cli-bloccato
                      if cli-fuori-fido and cli-fido-extra not = 0
                         continue
                      else
                         if cli-fuori-fido
                            initialize calfido-linkage 
                                        sitfin-linkage
                                     replacing numeric data by zeroes
                                          alphanumeric data by spaces
                            move ef-cli-buf   to link-cli-codice
                            call "C$JUSTIFY"  using 
                                              link-cli-codice, "R"
                            inspect link-cli-codice 
                                    replacing leading x"20" by x"30"
                            call   "sitfin"  using sitfin-linkage
                                                  calfido-linkage
                            cancel "sitfin"
                         end-if
                         display message "Cliente NON attivo"
                                   title tit-err
                                    icon 2
                         set errori to true
                         move spaces to lab-cliente-buf
                      end-if
                   end-if
                   if tutto-ok
                      perform VALUTA-CAMBIO-TIPOLOGIA
                      perform RAGSOC-CLIENTE
                   end-if
              end-read
           end-if.

      ***---
       SELEZIONA-DESTINO-NUMERICO.
           move spaces to lab-destino-buf.
           inquire ef-cli, value in des-codice.
           inquire ef-des, value in des-prog.
           if des-codice not > 0
              set errori to true
              move 78-ID-ef-des to control-id
              display message box msg-codice-obbligatorio
                      title tit-err
                      icon  mb-warning-icon
           else          
              inquire ef-cli, value in des-codice
              read destini no lock
                   invalid
                   display message "Progressivo destino NON valido"
                             title tit-err
                             icon mb-warning-icon
                   set errori to true
                   move 78-ID-ef-des to control-id
               not invalid
                   if des-disattivo or des-bloccato
                      set errori to true
                      display message "Destino NON attivo"
                                title tit-err
                                 icon 2
                      move spaces to lab-destino-buf
                   end-if
                   if tutto-ok
                      perform RAGSOC-DESTINO
                   end-if
              end-read
           end-if.

      ***---
       TROVA-DESTINO.
           set trovato to false.
           inquire ef-cli, value in ef-cli-buf.
           move ef-cli-buf to des-codice
           move ef-cli-buf to cli-codice

           move low-value to des-prog.
           start destini  key is >= des-chiave
                 invalid  continue
             not invalid  read destini next
                 if des-codice = cli-codice 
                    set trovato to true 
                 else 
                    move ef-cli-buf to des-codice
                    move ef-des-buf to des-prog
                 end-if
           end-start.

      ***---
       VALUTA-CAMBIO-TIPOLOGIA.
           move cli-tipo to tcl-codice.
           read ttipocli no lock
                invalid  move spaces to tcl-tipologia-tratt-imposte
           end-read.
           perform INVERTI-TIPOLOGIA.
           if tcl-tipologia-tratt-imposte not = TrattamentoInUso
LUBEXX        display message "ATTENZIONE!!"
LUBEXX                 x"0d0a""Impossibile cambiare la tipologia "
LUBEXX                        "trattamento imposte del cliente."
LUBEXX                  title tit-err
LUBEXX                   icon 2
LUBEXX        set errori to true
           end-if.

      ***---
       CONTROLLA-FUORI-FIDO.
LUBEXX     if tutto-ok
              perform CONTROLLA-TOTALE-MAN
              move cli-codice to tfid-cli-codice
              read tmp-fido no lock
                   invalid
                   move 0 to tfid-Sum
LUBEXX             initialize calfido-linkage 
LUBEXX                        replacing numeric data by zeroes
LUBEXX                             alphanumeric data by spaces
LUBEXX             move cli-codice to link-cli-codice
LUBEXX             call   "calfido" using calfido-linkage
LUBEXX             cancel "calfido"           
                   move saldo            to tfid-saldo
                   move effetti-rischio  to tfid-effetti-rischio
                   move ordini-in-essere to tfid-ordini-in-essere
                   write tfid-rec end-write
               not invalid
                   move tfid-saldo            to saldo            
                   move tfid-effetti-rischio  to effetti-rischio  
                   move tfid-ordini-in-essere to ordini-in-essere 
              end-read
              add Sum to tfid-Sum

LUBEXX*****        initialize calfido-linkage 
LUBEXX*****                   replacing numeric data by zeroes
LUBEXX*****                        alphanumeric data by spaces
LUBEXX*****        move cli-codice to link-cli-codice
LUBEXX*****        call   "calfido" using calfido-linkage
LUBEXX*****        cancel "calfido"  
LUBEXX        compute scoperto = saldo + tfid-Sum +
LUBEXX                           effetti-rischio  + ordini-in-essere

              if cli-gestione-fido-si
      *****           move cli-piva to sf-piva
      *****           read sitfin no lock                   
      *****                invalid move 0 to sf-fido-max
      *****           end-read                   
                 if tcl-fido-nuovo-si            
                    compute fido-tmp = cli-fido |sf-lince
                 else
                    compute tot-fido = cli-fido + cli-pfa|sf-lince
                 end-if
              else
                 if tcl-fido-nuovo-si
                    compute fido-tmp = cli-fido
                 else
                    compute tot-fido = cli-fido + 
                                       cli-pfa  + 
                                       cli-fidejussione
                 end-if
              end-if  
   
              if tcl-fido-nuovo-si
                 move 0 to fido-usato   
                 if cli-fidejussione > 0

                    if cli-grade > 0
                       move spaces to gra-codice
                       read grade no lock
                            invalid move 0 to Sum
                        not invalid
                            perform varying idx from 1 by 1 
                                      until idx > 20
                               if gra-da(idx) <= cli-grade and
                                  gra-a(idx)  >= cli-grade
                                  move gra-perce(idx) to Sum
                                  exit perform
                               end-if
                            end-perform
                        end-read
                        if Sum > 0
                           compute cli-fidejussione = 
                                   cli-fidejussione * Sum / 100
                        end-if
                    end-if

                    compute fido-usato = 
                            cli-fidejussione +
                            cli-fido-extra   +
                            cli-pfa
                 else  
                    if tge-blocco-fido < cli-fido
                       compute fido-usato = tge-blocco-fido + cli-pfa
                    else
                       compute fido-usato = fido-tmp + cli-pfa
                    end-if
                 end-if
                 if scoperto > fido-usato
                    subtract fido-usato from scoperto giving como-numero
                    set errori to true
                    if not ControllaCliente                             
LUBEXX                 move como-numero to como-edit
LUBEXX                 display message
LUBEXX                         "ATTENZIONE!!!!"
LUBEXX                  x"0d0a""CLIENTE FUORI FIDO DI:  " como-edit
LUBEXX                  x"0d0a""IMPOSSIBILE REGISTRARE L'ORDINE!"
LUBEXX                           title tit-err
LUBEXX                            icon 2
                    end-if 
                 else
                    |Aggiorno il totale con solo quelli che possono attivarsi non con tutti
      *****              add Sum to tfid-Sum
                    rewrite tfid-rec
LUBEXX           end-if
              else
LUBEXX           if scoperto > tot-fido
                    if tfid-Sum <= cli-fido-extra
                       move tfid-Sum to como-numero
                       perform AGGIORNA-FIDO-RESIDUO-TMP
                    else
                       compute como-numero = scoperto - tot-fido
                       if como-numero > cli-fido-extra 
LUBEXX                    set errori to true
                          if not ControllaCliente
                             subtract cli-fido-extra from como-numero
LUBEXX                       move como-numero to como-edit
LUBEXX                       display message
LUBEXX                            "ATTENZIONE!!!!"
LUBEXX                     x"0d0a""CLIENTE FUORI FIDO DI:  " como-edit
LUBEXX                     x"0d0a""IMPOSSIBILE REGISTRARE L'ORDINE!"
LUBEXX                              title tit-err
LUBEXX                               icon 2
                          end-if
LUBEXX                 else
                          perform AGGIORNA-FIDO-RESIDUO-TMP
                       end-if
LUBEXX              end-if
                 else
                    |Aggiorno il totale con solo quelli che possono attivarsi non con tutti
      *****              add Sum to tfid-Sum            
                    rewrite tfid-rec
LUBEXX           end-if
              end-if
LUBEXX     end-if.   

      ***---
       AGGIORNA-FIDO-RESIDUO-TMP.
LUBEXX*****     close    clienti.
LUBEXX*****     open i-o clienti.
LUBEXX*****     read clienti no lock invalid continue end-read.
LUBEXX*****     subtract como-numero from cli-fido-extra.
LUBEXX*****     rewrite cli-rec invalid continue end-rewrite.
LUBEXX*****     close      clienti.
LUBEXX*****     open input clienti.
LUBEXX*****     read clienti no lock invalid continue end-read.

      ***---
       CONTROLLA-TOTALE-MAN.   
           move emto-anno to con-anno.
           read tcontat no lock.
           
           evaluate tcl-serie-bolle
           when 1 move con-ult-stampa-bolle-gdo to imp-data
           when 2 move con-ult-stampa-bolle-mv  to imp-data
           when 3 move con-ult-stampa-bolle-at  to imp-data
           end-evaluate.
           
           start timposte key <= imp-chiave
                 invalid continue
             not invalid
                 read timposte previous
           end-start.

LUBEXX*****Se è attiva la causale di movimento "speciale" non
LUBEXX*****devo fare nessun controllo sul totale del documento
LUBEXX     if tca-si-speciale exit paragraph end-if.
           move cli-tipo to tcl-codice.
           read ttipocli no lock invalid continue end-read. 

           perform INVERTI-TIPOLOGIA.

           if ttipocli-gdo set TrattamentoGDO to false
           else            set TrattamentoGDO to true
           end-if.
           move 0 to Sum.
           if ControllaCliente
              move low-value   to emro-chiave
              move emto-chiave to emro-chiave
              start EDI-mrordini key >= emro-chiave
                    invalid continue
                not invalid
                    perform until 1 = 2
                       read EDI-mrordini next at end exit perform 
           end-read
                       if emro-chiave-testa not = emto-chiave
                          exit perform
                       end-if
                       move emro-qta          to como-qta
                       move emro-prz          to SavePrezzo
                       move emro-prg-chiave   to prg-chiave
                       move emto-cod-cli      to mto-cod-cli
                       move emro-cod-articolo to como-articolo
                       move emto-prg-destino  to mto-prg-destino
                       move emto-data-ordine  to mto-data-ordine
                       perform AGGIUNGI-VALORI
                    end-perform
              end-start
           else
              set cli-tipo-C to true
              move ef-cli-buf to cli-codice mto-cod-cli
              read clienti        
              move cli-tipo to tcl-codice
              read ttipocli

              perform INVERTI-TIPOLOGIA

              move ef-des-buf to emto-prg-destino  mto-prg-destino
              move ef-data-buf to como-data
              perform DATE-TO-FILE
              move como-data to mto-data-ordine
              if emto-prg-destino not = 0         
                 move cli-codice       to des-codice    
                 move emto-prg-destino to des-prog 
                 read destini
              else
                 move cli-nazione to des-nazione
              end-if

              inquire form1-gd-1, last-row in tot-righe
              perform varying store-riga from 2 by 1 
                        until store-riga > tot-righe
                 inquire form1-gd-1(store-riga, 78-col-prz), 
                         cell-data in SavePrezzo            
                 inquire form1-gd-1(store-riga, 78-col-qta), 
                         cell-data in como-qta
                 inquire form1-gd-1(store-riga, 78-col-art), 
                         cell-data in como-articolo
                 inquire form1-gd-1(store-riga, 1),
                         hidden-data = gruppo-hidden
                 move HiddenKey to prg-chiave
                 perform AGGIUNGI-VALORI
              end-perform
           end-if.

      ***---
       AGGIUNGI-VALORI.
           move prg-cod-articolo to art-codice
           if art-codice = 0 |BLISTER
              move como-articolo to art-codice
           end-if.
           read articoli no lock
                invalid
                move art-codice to bli-codice
                read blister no lock
                     invalid continue
                 not invalid    
                     move SavePrezzo to TotPrzBlister
                     move 0 to idx
                     perform varying idx from 1 by 1
                               until idx > 50
                        if bli-el-articolo(idx) = 0
                           exit perform
                        end-if        
                        set trovato  to false
                        move bli-el-articolo(idx) to art-codice
                        if tcl-gdo-si or tcl-gdo-opz
                           perform TROVA-LISTINO
                           if no-prg-listino
                              perform TROVA-CLI-PRG
                           end-if
                           if tutto-ok
                              if si-prg-listino
                                 move como-prg-chiave to GiacenzaKey
                                 set trovato to true
                              else
                                 perform VALORIZZA-MAGGIOR-GIACENZA
                              end-if
                           end-if
                        else
                           perform VALORIZZA-MAGGIOR-GIACENZA
                        end-if

                        if trovato             
                           move bli-el-articolo(idx) to art-codice
                           move bli-el-qta(idx)      to mro-bli-qta
                           move bli-el-perce(idx)    to mro-bli-perce
                           move GiacenzaKey          to prg-chiave
                           read progmag  no lock invalid continue 
           end-read
                           read articoli no lock invalid continue 
           end-read  
                                                                  
                           compute mro-qta = como-qta * bli-el-qta(idx)
           
                           if bli-el-perce(idx) not = 0
           
                              compute como-numero =
                                      TotPrzBlister * 
                                      bli-el-perce(idx) / 100 / 
                                      bli-el-qta(idx) 
      *                        perform ARROTONDA-PRZ-BLISTER
                              move como-numero to SavePrezzo
                              perform AGGIUNGI-VALORE
                           end-if
                        end-if
                     end-perform
                end-read
            not invalid
                perform AGGIUNGI-VALORE
           end-read.

      ***---
       AGGIUNGI-VALORE.          
           move art-marca-prodotto to mar-codice.
           read tmarche.
           read progmag no lock.
           if SavePrezzo > 999999    
              perform CALCOLA-COSTO-MP-COMPLETO
              |Altrimenti righe solo 999999,99 senza costo mp
              |darebbero come risultato un master prezzo ZERO
              if costo-mp = 0
                 compute Sum = Sum + 0,01
              else
                 compute Sum = Sum + ( costo-mp * como-qta )
              end-if
           else                  
              if SavePrezzo > 0 

                 move SavePrezzo to como-prz-unitario mro-prz-unitario
                 perform CALCOLA-IMPOSTE-ORDINE
                 perform CALCOLA-IMPONIBILE    
                 
                 compute SavePrezzo =
                         mro-imponib-merce + 
                         mro-imp-cou-cobat + 
                         mro-imp-consumo   +
                         mro-add-piombo         

                 if tcl-fido-nuovo-si    
                       
                    if cli-iva not = spaces
                       move cli-iva to tbliv-codice2
                    else
                       if cli-iva-ese not = spaces
                          move cli-iva-ese to tbliv-codice2
                       else
                          move tge-cod-iva-std to tbliv-codice2
                       end-if
                    end-if

                    move "IV"        to tbliv-codice1
                    read tivaese 
                    compute mult = 1 + tbliv-percentuale / 100
                    compute SavePrezzo =
                            SavePrezzo * mult
                 end-if

                 compute Sum = Sum + ( SavePrezzo * como-qta )
              end-if
           end-if            
           .
      * <TOTEM:END>

       CONTROLLO-INI.
      * <TOTEM:PARA. CONTROLLO-INI>
           set tutto-ok to true.

           evaluate CONTROL-ID

           when 78-ID-ef-anno
                 inquire ef-anno, value in anno-to
                 if anno-to = 0
                    set errori  to true
                    display message "Inserimento anno mancante"
                              title tit-err
                               icon 2
                    move 78-ID-ef-anno to store-id
                 end-if

           when 78-ID-ef-ordine-from
                if tipo-elab = 1
                   if ordine-from = zero
                      if controllo-finale
                         set errori to true                             
                              
                         move 78-ID-ef-ordine-from to CONTROL-ID
                         display message 
                                 "Il numero d'ordine è obbligatorio!"
                                 title tit-err
                                 icon  MB-WARNING-ICON
                      end-if
                   else
                      move anno-to     to emto-anno
                      move ordine-from to emto-numero
                      read EDI-mtordini
                           invalid 
                           set errori to true
                           move 78-ID-ef-ordine-from to CONTROL-ID
                           display message "Ordine inesistente!"
                                   title tit-err
                                   icon  MB-WARNING-ICON
                      end-read
                   end-if
                end-if

           when 78-ID-ef-ordine-to
                if ordine-to = ZERO
                   move all "9" to ordine-to
                   modify EF-ORDINE-TO, VALUE ordine-to
                end-if
                if ordine-to < ordine-from
                   set errori to true
                   move 78-ID-ef-ordine-to to CONTROL-ID
                   display message MSG-intervallo-num-ord-err
                      title tit-err
                      icon  MB-WARNING-ICON
                end-if

           when 78-ID-ef-data-from
                if data-from not = 0
                   move data-from to como-data
                   perform DATE-FORMAT
                   move como-data to data-from
                end-if

           when 78-ID-ef-data-to
                if data-to = zero
                   move 99999999 to data-to
                end-if
                if data-to not = 99999999
                   move data-to to como-data
                   perform DATE-FORMAT
                   move como-data to data-to
                end-if

                move data-from(1:2) to data-from-AAAAMMGG(7:2)
                move data-from(3:2) to data-from-AAAAMMGG(5:2)
                move data-from(5:4) to data-from-AAAAMMGG(1:4)
                move data-to(1:2)   to data-to-AAAAMMGG(7:2)
                move data-to(3:2)   to data-to-AAAAMMGG(5:2)
                move data-to(5:4)   to data-to-AAAAMMGG(1:4)

      *          if data-from-AAAAMMGG = 0
      *             move anno-to to data-from-AAAAMMGG(1:4)
      *             move "01"    to data-from-AAAAMMGG(5:2)
      *             move "01"    to data-from-AAAAMMGG(7:2)
      *          end-if

                if data-to-AAAAMMGG < data-from-AAAAMMGG
                   set errori to true
                   move 78-ID-ef-data-to to CONTROL-ID
                   display message MSG-intervallo-date-err
                      title tit-err
                      icon  MB-WARNING-ICON
                end-if

           when 78-ID-ef-cliente-from
                if cliente-from = 0
                   move "TUTTI I CLIENTI" to cli-ragsoc-1
                   move all "9" to cliente-to
                else
                   move cliente-from to cli-codice
                   set cli-tipo-C to true
                   read clienti no lock
                        invalid
                        set errori to true
                        display message "Cliente NON valido"
                                  title tit-err
                                   icon 2
                        move spaces to cli-ragsoc-1
                   end-read
                   move cliente-from to cliente-to
                end-if
                move cli-ragsoc-1 to lab-cli-buf
                display lab-cli
           end-evaluate.

           if errori
              perform CANCELLA-COLORE
              move CONTROL-ID to store-id
              move 4          to ACCEPT-CONTROL
           end-if.

           display form-ini 
           .
      * <TOTEM:END>

       CURRENT-RECORD.
      * <TOTEM:PARA. CURRENT-RECORD>
           set RigaCambiata to false.
           set StoSalvando  to false.
           move como-chiave-ordine to emto-chiave.
           read edi-mtordini no lock.
           perform VALORIZZA-OLD.
           perform FORM1-IUD-DISPLAY.         
           move emto-cod-pagamento to SavePag.
           move emto-cod-ese-iva   to SaveIva.
           move emto-vettore       to SaveVet.
           move emto-causale       to tca-codice.
           read tcaumag  no lock.
           move tca-cod-magaz      to mag-codice.
           read tmagaz   no lock.
           move spaces   to tge-chiave.
           read tparamge no lock.

           perform LETTURE-CLIENTE.
           
           if emto-attivo
              move 78-colore-chiuso         to col-lab-stato
              move "ATTIVO"                 to lab-stato-buf
           end-if.
           if emto-bloccato
              move 78-colore-fatt-tot       to col-lab-stato
              move "BLOCCATO"               to lab-stato-buf
           end-if.
           if emto-caricato
              move 78-colore-sped-tot       to col-lab-stato
              move "CARICATO"               to lab-stato-buf
           end-if.
           display lab-stato.    
 
           if emto-cliente-valido 
              move 257 to clr-cliente
           else                   
              move 78-colore-fatt-tot to clr-cliente
           end-if.
           if emto-cliente-fuori-fido
              move 78-colore-fatt-tot to clr-cliente
           end-if.
           display cliente-lab.

           if emto-destino-valido
              move 257 to clr-destino
           else
              move 78-colore-fatt-tot to clr-destino
           end-if.
           if emto-clides-non-valido
              move 78-colore-fatt-tot to clr-destino
           end-if.
           display destino-lab cap-lab provincia-lab.
           perform CARICA-GRID.   

           if emto-evadi-dal = 0
              move emro-evadi-dal to emto-evadi-dal como-data
              perform DATE-TO-SCREEN
              move como-data to ef-evadi-dal-buf
           end-if.
   
           move emto-evadi-dal to data-evadi-dal-old.
           display ef-evadi-dal.

           move 2 to riga event-data-2.
           modify form1-gd-1, cursor-y = riga.
           move 78-ID-form1-gd-1 to control-id.
           move 4 to accept-control.   

           read destini no lock 
                invalid move spaces to des-cap des-prov
           end-read.                 

           move des-cap  to old-des-cap.
           move des-prov to old-des-prov.
           
           move des-cap  to ef-cap-d-buf.
           move des-prov to ef-prov-d-buf.
           display ef-cap-d ef-prov-d.

           perform SPOSTAMENTO.     

           perform CALCOLA-TOTALE 
           .
      * <TOTEM:END>

       IMPOSTA-CAUSALE.
      * <TOTEM:PARA. IMPOSTA-CAUSALE>
           inquire form1-gd-1, last-row in tot-righe.
           move tge-causale-omag to tca-codice emto-causale.
           perform varying como-riga from 2 by 1
                     until como-riga > tot-righe
              inquire form1-gd-1(como-riga, 78-col-prz), 
                      cell-data in col-prz
              move col-prz to como-prz
              if como-prz > 0
                 move tge-causale-ordini-std to tca-codice emto-causale
                 exit perform
              end-if
           end-perform.
           read tcaumag no lock.

           move tca-cod-magaz   to mag-codice.
           read tmagaz no lock  invalid continue end-read.
           move mag-descrizione to StoreDesMagazzino 
           .
      * <TOTEM:END>

       IMPOSTA-PREZZO.
      * <TOTEM:PARA. IMPOSTA-PREZZO>
           inquire form1-gd-1(event-data-2, 78-col-prz),
                   cell-data in col-prz.
           modify  form1-gd-1(event-data-2, 78-col-prz),
                   cell-data col-prz.
           if hid-emro-prezzo-non-valido
              set hid-emro-prezzo-valido to true
           end-if.
           move col-prz to emro-prz.
      *****     if emro-prz = 0
      *****        move tge-cod-iva-omag  to col-iva
      *****        move "S" to col-oma
      *****     else                             
      *****        move tge-cod-iva-std   to col-iva  
      *****        move "N" to col-oma
      *****     end-if.
           if emro-prz < 99999,99
              set hid-emro-bloccato-prezzo-no to true
           else                                      
              set hid-emro-bloccato-prezzo-si to true
           end-if.
           modify form1-gd-1(event-data-2, 1),
                   hidden-data = gruppo-hidden.

           if hid-emro-prz not = emro-prz
              set RigaCambiata to true
           end-if.

      *****     modify form1-gd-1(event-data-2, 78-col-iva), 
      *****            cell-data col-iva.
      *****     modify form1-gd-1(event-data-2, 78-col-oma), 
      *****            cell-data col-oma.
           perform IMPOSTA-CAUSALE.

           perform STATO-RIGA 
           .
      * <TOTEM:END>

       LETTURE-CLIENTE.
      * <TOTEM:PARA. LETTURE-CLIENTE>
           move cli-tipo to tcl-codice.
           read ttipocli no lock invalid continue end-read.   
           perform INVERTI-TIPOLOGIA.
           move tcl-tipologia-tratt-imposte to TrattamentoInUso.
           move cli-codice to rec-codice.
           read recapiti no lock invalid continue end-read 
           .
      * <TOTEM:END>

       MODIFICA.
      * <TOTEM:PARA. MODIFICA>
           move 5 to key-status.
           inquire tool-modifica, value in mod.
           set tutto-ok to true.

           if emto-righe-non-presenti
      *        move 0 to mod
      *        modify tool-modifica, value mod
              display message 
                      "ATTENZIONE: RIGHE NON PRESENTI"
                        title titolo
                         icon mb-warning-icon
      *        exit paragraph
           end-if.

           
      *  SE L'UTENTE E' ABILITATO PUO' MODIFICARE UN RECORD
           if mod = 1
              read EDI-mtordini lock
              if RecLocked
                 set errori to true
              end-if
              if tutto-ok
                 if CONTROL-ID < 78-ID-ef-cli
                    move 78-ID-ef-cli to CONTROL-ID
                 end-if
                 move 1    to mod
                 set StatusModifica to true
                 perform STATUS-BAR-MSG
              else
                 move 0 to mod
              end-if
           else
              move 1 to mod
              perform SALV-MOD            
              move 0 to mod
              if errori
                 move 1    to mod
              else
                 move 78-ID-ef-cli to CONTROL-ID
                 perform STATUS-BAR-MSG 
                 unlock EDI-mtordini all records
                 perform CURRENT-RECORD 
              end-if
           end-if
                     
           display form1
           modify tool-modifica,  value mod
           perform CANCELLA-COLORE 

           move 4 to ACCEPT-CONTROL.
           perform ABILITAZIONI   
           .
      * <TOTEM:END>

       ORDINE-DA-GRIGLIA.
      * <TOTEM:PARA. ORDINE-DA-GRIGLIA>
           inquire gd-ordini(riga), RECORD-DATA = Gd-ordini-Record.

           move col-anno            to como-anno.
           move Col-numero          to como-numero-ordine.
           move riga                to como-riga.
           
           move riga to old-riga.

           perform CHIAMA-MANUTENZIONE.
           move old-riga to riga event-data-2.
           
           if RicaricaGrid       
              move 0 to tot-attivi tot-bloccati
              move riga to save-riga
              perform RIEMPI-GRID
              inquire gd-ordini, last-row in tot-righe
              if save-riga > tot-righe
                 move tot-righe to save-riga event-data-2
              end-if
              move save-riga to riga
              move tot-attivi   to lab-attivi-buf
              move tot-bloccati to lab-bloccati-buf
              display lab-attivi lab-bloccati
           end-if.

           if tot-righe = 1
              move 27 to key-status
           else

              modify gd-ordini, cursor-y = riga
              perform CAMBIA-FONT-RIGA

              move como-riga to riga, EVENT-DATA-2
              perform SPOSTAMENTO-INI

           end-if 
           .
      * <TOTEM:END>

       PARAGRAFO-COPY.
      * <TOTEM:PARA. PARAGRAFO-COPY>
           copy "utydata.cpy".
           copy "color-custom.cpy".
           copy "calcola-colore-trasparente.cpy".
           copy "abilita-toolbar.cpy".
           copy "status.cpy".
           copy "trova-parametro.cpy".
           copy "addizionale-piombo.cpy".
           copy "promo-fittizia.cpy".
           copy "direziona-impegnato-common.cpy".
           copy "accessoxx.cpy".
           copy "costo-medio.cpy".
           copy "recupero-anagrafica.cpy".
           copy "righe-ordine-EDI.cpy".        

      ***---
       RIEMPI-COMBO-STATO-ORDINE.           
           Modify cbo-stato-ordine, item-to-add "Tutti".
           Modify cbo-stato-ordine, item-to-add "Bloccati".
           Modify cbo-stato-ordine, item-to-add "Attivi".

      ***---
       CARICA-COMBO-STATO-ORDINE.
           evaluate true
           when attivi
                move "Attivi"   to cbo-stato-ordine-buf
           when bloccati
                move "Bloccati" to cbo-stato-ordine-buf
           when tutti
                move "Tutti "   to cbo-stato-ordine-buf
           end-evaluate.       
           modify cbo-stato-ordine, value cbo-stato-ordine-buf.
           
      ***---
       SCARICA-COMBO-STATO-ORDINE.     
           inquire cbo-stato-ordine, value cbo-stato-ordine-buf.
           evaluate cbo-stato-ordine-buf
           when "Tutti"     set tutti    to true
           when "Bloccati"  set bloccati to true
           when "Attivi"    set attivi   to true
           end-evaluate 
           .
      * <TOTEM:END>

       RAGSOC-CLIENTE.
      * <TOTEM:PARA. RAGSOC-CLIENTE>
           inspect cli-ragsoc-1 replacing trailing spaces by low-value
           initialize lab-cliente-buf.
           string cli-ragsoc-1 delimited low-value
                  cli-ragsoc-2 delimited size
                  into lab-cliente-buf
           end-string 
           .
      * <TOTEM:END>

       RAGSOC-DESTINO.
      * <TOTEM:PARA. RAGSOC-DESTINO>
           inspect des-ragsoc-1 replacing trailing spaces by low-value
           initialize lab-destino-buf.
           string des-ragsoc-1 delimited low-value
                  des-ragsoc-2 delimited size
                  into lab-destino-buf
           end-string 
           .
      * <TOTEM:END>

       RIEMPI-GRID.
      * <TOTEM:PARA. RIEMPI-GRID>
           modify gd-ordini, mass-update = 1.
           modify gd-ordini, reset-grid = 1.
           perform GD-ORDINI-CONTENT.
           
           set CallManutenzione to false.
           move 0 to tot-attivi tot-bloccati.

           set controllo-finale to true.
           move control-id to mem-id.
           perform  varying CONTROL-ID from 78-id-ef-anno by 1
                      until CONTROL-ID > 78-id-ef-cliente-from
              perform CONTROLLO-INI
              if errori 
                 exit perform 
              end-if
           end-perform.

           set controllo-finale to false.

           perform CARICA-ORDINI.


           modify gd-ordini, mass-update = 0                 
           .
      * <TOTEM:END>

       SALV-MOD.
      * <TOTEM:PARA. SALV-MOD>
           set SiSalvato to true.
           set tutto-ok  to true.
           if mod = 0 or fromCancella exit paragraph end-if.
           perform Form1-BUF-TO-FLD.

           if emto-cod-cli               not = OLD-emto-cod-cli and
              SiSalvato 
              set NoSalvato to true
              move 78-ID-ef-cli to store-id
           end-if.

           if emto-prg-destino  not = OLD-emto-prg-destino           and
              SiSalvato 
              set NoSalvato to true
              move 78-ID-ef-des to store-id
           end-if.

           if emto-num-ord-cli  not = OLD-emto-num-ord-cli           and
              SiSalvato 
              set NoSalvato to true
              move 78-ID-ef-num-ord to store-id
           end-if.

           if emto-data-ordine  not = OLD-emto-data-ordine           and
              SiSalvato 
              set NoSalvato to true
              move 78-ID-ef-data to store-id
           end-if.
                                       
           if des-cap not = old-des-cap and SiSalvato
              set NoSalvato to true
              move 78-ID-ef-cap-d to store-id
           end-if.
                                       
           if des-prov not = old-des-prov and SiSalvato
              set NoSalvato to true
              move 78-ID-ef-prov-d to store-id
           end-if.

           if   emto-data-passaggio-ordine not = 
            OLD-emto-data-passaggio-ordine and
              SiSalvato 
              set NoSalvato to true
              move 78-ID-ef-data-pass to store-id
           end-if.

           if emto-cod-agente  not = OLD-emto-cod-agente            and
              SiSalvato 
              set NoSalvato to true
              move 78-ID-ef-age to store-id
           end-if.

           if emto-cod-pagamento  not = OLD-emto-cod-pagamento      and
              SiSalvato 
              set NoSalvato to true
              move 78-ID-ef-pag to store-id
           end-if.

           if emto-cod-ese-iva  not = OLD-emto-cod-ese-iva         and
              SiSalvato 
              set NoSalvato to true
              move 78-ID-ef-iva to store-id
           end-if.
           if emto-vettore     not = OLD-emto-vettore               and
              SiSalvato 
              set NoSalvato to true
              move 78-ID-ef-vet to store-id
           end-if.
           if emto-note1  not = OLD-emto-note1                 and
              SiSalvato 
              set NoSalvato to true
              move 78-ID-ef-note-1 to store-id
           end-if.
           if emto-data-note1  not = OLD-emto-data-note1            and
              SiSalvato 
              set NoSalvato to true
              move 78-ID-ef-data-cons to store-id
           end-if.
           if emto-note2       not = OLD-emto-note2                 and
              SiSalvato 
              set NoSalvato to true
              move 78-ID-ef-note-2 to store-id
           end-if.
           if emto-note3        not = OLD-emto-note3                 and
              SiSalvato 
              set NoSalvato to true
              move 78-ID-ef-note-3 to store-id
           end-if.
           if emto-note4      not = OLD-emto-note4                 and
              SiSalvato 
              set NoSalvato to true
              move 78-ID-ef-note-4 to store-id
           end-if.
           if emto-note         not = OLD-emto-note                  and
              SiSalvato 
              set NoSalvato to true
              move 78-ID-ef-note to store-id
           end-if.
           if emto-ritira-in-lubex not = OLD-emto-ritira-in-lubex and
              SiSalvato
              set NoSalvato to true
              move 78-ID-chk-ritira to store-id
           end-if. 
           if emto-prenotazione-qta not = OLD-emto-prenotazione-qta  and
              SiSalvato 
              set NoSalvato to true
              move 78-ID-chk-prenot to store-id
           end-if.
           if emto-saldi-banco           not = OLD-emto-saldi-banco  and
              SiSalvato  
              set NoSalvato to true
              move 78-ID-chk-saldi-banco to store-id
           end-if.
           if emto-saldi-promo           not = OLD-emto-saldi-promo  and
              SiSalvato 
              set NoSalvato to true
              move 78-ID-chk-saldi-promo to store-id
           end-if.
           if emto-evadi-dal not = OLD-emto-evadi-dal and
              SiSalvato 
              set NoSalvato to true
              move 78-ID-ef-evadi-dal to store-id
           end-if.
           if emto-ev-immediata not = OLD-emto-ev-immediata and
              SiSalvato 
              set NoSalvato to true
              move 78-ID-chk-ev-immediata to store-id
           end-if.
           if emto-contrassegno not = OLD-emto-contrassegno and
              SiSalvato 
              set NoSalvato to true
              move 78-ID-chk-contrassegno to store-id
           end-if.
         
           set tutto-ok to true.

           if RigaCambiata
              set NoSalvato to true
              move 78-ID-form1-gd-1 to store-id
           end-if.
      
      *****     if PrezzoCambiato and mod = 1
      *****        set NoSalvato to true
      *****     end-if.
                     
           if NoSalvato
              display message box MSG-Salvare-le-modifiche
                            title titolo
                            type mb-yes-no-cancel
                            giving scelta

              evaluate scelta
              when mb-yes
                   perform SALVA
              when mb-no
                   continue
              when other
                   perform CANCELLA-COLORE

                   set errori to true
                   move store-id to control-id
                   move 4 to accept-control
              end-evaluate
           end-if 
           .
      * <TOTEM:END>

       SALVA.
      * <TOTEM:PARA. SALVA>
           if mod = 0 exit paragraph end-if.
                                                
           set SaveXX to true.
           perform ACCESSOXX.

           move BitmapSaveDisabled to BitmapNumSave.
           move 0 to e-salva.
           modify tool-salva, 
                  enabled = e-salva,
            bitmap-number = BitmapNumSave.

           set tutto-ok to true.
                                                    
           set StoSalvando to true. 
           
           set StoSalvando to true.
           perform varying control-id from 78-ID-ef-cli by 1
                     until control-id > 78-ID-ef-note
              perform CONTROLLO
              if errori 
                 exit perform
              end-if
           end-perform.

           set StoSalvando to false.

           if tutto-ok
              inquire form1-gd-1, last-row in tot-righe
              if tot-righe < 2
                 set errori to true
                 display message "Nessuna riga presente"
                           title tit-err
                            icon 2
              end-if
           end-if.

      *****     if tutto-ok
      *****        if tcl-si-gestione-fido or cli-gestione-fido-si
      *****           perform CONTROLLA-FUORI-FIDO
      *****        end-if
      *****     end-if.

           if errori
              perform CANCELLA-COLORE
           else  

              inquire ef-prov-d value in des-prov
              inquire ef-cap-d  value in des-cap                  

              if old-des-prov not = des-prov or
                 old-des-cap  not = des-cap  
                 if des-prog not = 0
                    read destini no lock                    
                    move ef-cap-d-buf  to des-cap  old-des-cap
                    move ef-prov-d-buf to des-prov old-des-prov
                    rewrite des-rec
                 end-if

                 set emto-destino-valido  to true

                 inquire ef-cli, value in ecd-cli-codice
                 inquire ef-des, value in ecd-prg-destino
                 read edi-clides no lock
                      invalid continue
                  not invalid
                      move ef-cap-d-buf  to ecd-cap-d
                      move ef-prov-d-buf to ecd-prov-d
                      rewrite ecd-rec                
                 end-read

                 move des-prov to old-des-prov
                 move des-cap  to old-des-cap
              end-if


              perform FORM1-BUF-TO-FLD
              perform SCRIVI-RIGHE
              perform CANCELLA-COLORE
              perform VALORIZZA-RECORD
              accept emto-data-ultima-modifica from century-date
              accept emto-ora-ultima-modifica  from time
              move user-codi to emto-utente-ultima-modifica
              rewrite emto-rec 
              unlock EDI-mtordini all record 

           end-if.

PATCH      move BitmapSaveEnabled to BitmapNumSave
PATCH      move 1 to e-salva.
PATCH      modify tool-salva, 
PATCH             enabled = e-salva,
PATCH       bitmap-number = BitmapNumSave.

           perform DESTROYXX.

           if tutto-ok
              perform TORNA-IN-VISUA
           end-if.

      ***---
       VALORIZZA-RECORD. 
           move cli-gdo to emto-gdo.

           move user-codi to emto-utente-ultima-modifica.
           accept emto-data-ultima-modifica from century-date.
           accept emto-ora-ultima-modifica  from time.

           set emto-cliente-valido  to true.
      *****     set emto-cliente-fido-ok to true.
           set emto-destino-valido  to true.
           set emto-esistente-no    to true.
           set emto-bloc-forzato-no to true.

           if righe-errate = 0
              set emto-qta-ok to true
              set emto-prg-ok to true
              set emto-art-ok to true
              set emto-prz-ok to true
           end-if.
           
           if emto-qta-ok and
              emto-art-ok and
              emto-prg-ok and
              emto-prz-ok and
              emto-cliente-fido-ok
              set emto-attivo to true
           end-if.


      ***---
       TORNA-IN-VISUA.   
           perform VALORIZZA-OLD.
           perform CURRENT-RECORD.
           move 0 to mod.
           perform ABILITAZIONI.
           set RicaricaGrid to true.
           display form1. 

      ***---
       SCRIVI-RIGHE.      
              
           set emto-qta-ok to true. 
           set emto-prg-ok to true.
           set emto-art-ok to true.

           inquire form1-gd-1, last-row in tot-righe.
           perform varying riga from 2 by 1 
                     until riga > tot-righe  

              inquire form1-gd-1(riga, 78-col-num),
                      cell-data in col-num
              move emto-chiave to emro-chiave-testa
              move col-num     to emro-riga
              read edi-mrordini
                   invalid                                    
                   inquire form1-gd-1(riga, 1),        
                           hidden-data in gruppo-hidden
                   move hid-prg-cod-articolo to art-codice         
                   initialize emro-dati emro-dati-import
                              replacing numeric data by zeroes
                                   alphanumeric data by spaces

                   move prg-tipo-imballo to imq-codice
                   read timbalqta        no lock
                   move imq-qta-imb      to imballi-ed
                   move imq-tipo         to imb-codice
                   read timballi no lock
                        invalid  initialize imb-descrizione
                   end-read
                   move imb-descrizione to emro-des-imballo

                   accept emro-data-creazione from century-date
                   accept emro-ora-creazione  from time
                   move user-codi to emro-utente-creazione    
                   move prg-peso-utf     to emro-peso-utf
                   move prg-peso-non-utf to emro-peso-non-utf
      *****         10 emro-prz-commle  PIC  9(9)v9(2).
                   write emro-rec end-write

               not invalid
                    accept emro-data-ultima-modifica from century-date
                    accept emro-ora-ultima-modifica  from time
                    move user-codi to emro-utente-ultima-modifica
              end-read

              inquire form1-gd-1(riga, 78-col-art),        
                      cell-data in col-art 
              inquire form1-gd-1(riga, 78-col-des),        
                      cell-data in col-des 
              inquire form1-gd-1(riga, 78-col-qta-EDI),    
                      cell-data in col-qta-EDI
              inquire form1-gd-1(riga, 78-col-qta-GESLUX), 
                      cell-data in col-qta-GESLUX
              inquire form1-gd-1(riga, 78-col-qta),        
                      cell-data in col-qta 
              inquire form1-gd-1(riga, 78-col-prz-EDI),    
                      cell-data in col-prz-EDI 
              inquire form1-gd-1(riga, 78-col-prz-GESLUX), 
                      cell-data in col-prz-GESLUX
              inquire form1-gd-1(riga, 78-col-prz),        
                      cell-data in col-prz
              inquire form1-gd-1(riga, 78-col-evadi-dal),        
                      cell-data in col-evadi-dal
      *****        inquire form1-gd-1(riga, 78-col-iva),        
      *****                cell-data in col-iva 
      *****        inquire form1-gd-1(riga, 78-col-oma),        
      *****                cell-data in col-oma 

              move col-art        to emro-cod-articolo
              move col-qta-EDI    to emro-qta-EDI
              move col-qta-GESLUX to emro-qta-GESLUX
              move col-qta        to emro-qta
              move col-prz-EDI    to emro-prz-EDI
              move col-prz-GESLUX to emro-prz-GESLUX
              move col-prz        to emro-prz
              move col-evadi-dal  to como-data
              perform DATE-TO-FILE
              move como-data      to emro-evadi-dal
      *****        if ef-iva-buf not = spaces
      *****           move ef-iva-buf to emro-cod-iva
      *****        else
      *****           move col-iva    to emro-cod-iva           
      *****        end-if
      *****        move col-oma  to emro-omaggio           

              inquire form1-gd-1(riga, 1), hidden-data in gruppo-hidden

PATCH         |Nel caso in cui passi un prezzo da bloccare
              if emro-prz > 9999,99 and hid-emro-bloccato-prezzo-no
                 set hid-emro-bloccato-prezzo-si to true
                 modify form1-gd-1(riga, 1), hidden-data = gruppo-hidden
              end-if

              move hid-emro-bloccato-prezzo to emro-bloccato-prezzo
              move hid-emro-errori to emro-errori
              move hid-emro-stato  to emro-stato
              move HiddenKey       to emro-prg-chiave prg-chiave
              read progmag no lock 
                   invalid set emto-prg-ko to true
              end-read

              move prg-cod-articolo to art-codice
              read articoli no lock 
                   invalid
                   set emto-art-ko to true
              end-read

              move prg-peso-utf     to emro-peso-utf
              move prg-peso-non-utf to emro-peso-non-utf
                              
              if not hid-emro-si-blister
                 move hid-emro-qta-imballi to emro-qta-imballi
                 if emro-qta = 0
                    compute emro-num-colli = 
                            emro-qta-GESLUX / emro-qta-imballi
                 else
                    compute emro-num-colli = 
                            emro-qta / emro-qta-imballi
                 end-if
              end-if  

              if emro-qta-GESLUX = 0  
                 set emro-qtac-non-presente to true
                 set emto-qta-ko            to true
              end-if
              if emro-prz = 0
                 set emro-prezzo-non-valido to true
                 set emto-prz-ko            to true
              end-if           
              rewrite emro-rec
           end-perform 
           .
      * <TOTEM:END>

       SPOSTAMENTO.
      * <TOTEM:PARA. SPOSTAMENTO>
           inquire form1-gd-1, last-row in tot-righe, cursor-y in riga.
           modify form1-gd-1(riga), row-font = Arial10-Occidentale.
           modify form1-gd-1(riga, 78-col-stato-r), 
                  cell-font = Arial10B-Occidentale.
           if event-data-2 > tot-righe
              move tot-righe to event-data-2
              modify form1-gd-1, cursor-y event-data-2
           end-if.
           if event-data-2 < 2
              move 2 to event-data-2
              modify form1-gd-1, cursor-y event-data-2
           end-if.
           modify form1-gd-1, start-y = event-data-2, y = event-data-2,
                              start-x = 1,            x = 1,
                              region-color = 480.
           modify  form1-gd-1(event-data-2), row-font = Arial10B.       
              
           inquire form1-gd-1(event-data-2, 1), 
                   hidden-data in gruppo-hidden.

           move 0 to StatusHelp.
           if mod = 1 and event-data-1 = 78-col-prz
LABLAB        if tcl-si-recupero and
                 tca-prezzo-reso-no
                 move 1 to StatusHelp
              end-if
           end-if.
           perform STATUS-HELP 
           .
      * <TOTEM:END>

       SPOSTAMENTO-INI.
      * <TOTEM:PARA. SPOSTAMENTO-INI>
           inquire gd-ordini, last-row in tot-righe.
           if event-data-2 < 2 
              move 2 to event-data-2 
           end-if.
           if event-data-2 > tot-righe
              move tot-righe to event-data-2 
           end-if.
           if riga not = event-data-2 
              perform CAMBIA-FONT-RIGA
           end-if 
           .
      * <TOTEM:END>

       STATO-RIGA.
      * <TOTEM:PARA. STATO-RIGA>
           if hid-emro-bloccato
              if hid-emro-qtac-ok          and
                 hid-emro-prezzo-valido    and
                 hid-emro-articolo-valido  and
                 hid-emro-progressivo-valido
                 move "OK" to col-stato
                 modify form1-gd-1(event-data-2, 78-col-stato-r), 
                        cell-data col-stato
                 if righe-errate > 0
                    subtract 1 from righe-errate
                    if righe-errate = 0
                       set emto-prz-ok to true
      *****                 move 78-colore-chiuso         to col-lab-stato
      *****                 move "ATTIVO"                 to lab-stato-buf
      *****                 display lab-stato
                    end-if
                 end-if             
                 set hid-emro-attivo to true
              end-if
              set RigaCambiata to true
              modify form1-gd-1(event-data-2, 1),
                     hidden-data = gruppo-hidden
           end-if 
           .
      * <TOTEM:END>

       VALORIZZA-OLD.
      * <TOTEM:PARA. VALORIZZA-OLD>
           move emto-rec to old-emto-rec 
           .
      * <TOTEM:END>

       ATTIVA-ORDINI.
      * <TOTEM:PARA. ATTIVA-ORDINI>
           if RichiamoBatch 
              call   "set-ini-log" using r-output
              cancel "set-ini-log"
              initialize lm-riga
              string r-output               delimited size
                     "INIZIO ATTIVA-ORDINI" delimited size
                into lm-riga
              end-string
              write lm-riga
           end-if.

           initialize tab-ordini.
           move 0 to idx-ordini primo-numero ultimo-numero.
                         
           move low-value to emto-rec.              
           inquire gd-ordini, last-row in tot-righe-edi.

           perform varying riga-edi from 2 by 1 
                     until riga-edi > tot-righe-edi
              inquire gd-ordini(riga-edi, 2), cell-data in emto-anno
              inquire gd-ordini(riga-edi, 3), cell-data in emto-numero

              if not RichiamoBatch
                 perform COUNTER-VIDEO
              end-if

              read EDI-mtordini no lock
                   invalid        
                   subtract 1 from riga-edi
                   display message "ERR: RIGA(", riga-edi, "): ORDINE NO
      -    "T FOUND"
                             title tit-err
                              icon 3
                   add 1 to riga-edi
                   exit perform
               not invalid
                   set tutto-ok to true
                   if emto-bloccato or emto-caricato 
                      exit perform cycle
                   end-if

                   set record-ok to false
                   set cli-tipo-C to true
                   move emto-cod-cli to cli-codice
                   read clienti no lock
                        invalid
                        subtract 1 from riga-edi
                        display message "ERR: RIGA(", riga-edi, "): CLIE
      -    "NTE NOT FOUND"
                                  title tit-err
                                   icon 3
                        add 1 to riga-edi
                    not invalid
                        perform varying idx from 1 by 1 
                                  until idx > 100
                           if el-tipo(idx) = spaces
                              exit perform
                           end-if
                           if el-tipo(idx) = cli-tipo
                              set record-ok to true
                              exit perform
                           end-if
                        end-perform
                   end-read
             
                   if record-ok
                      |PATCH
                      if emto-ordine-anno   not = 0 or
                         emto-ordine-numero not = 0
                         set errori to true
                      end-if
                      |||
                      
                      if tutto-ok          
                         if RichiamoBatch 
                            call   "set-ini-log" using r-output
                            cancel "set-ini-log"
                            initialize lm-riga
                            string r-output           delimited size
                                   "VALORIZZA NUMERO" delimited size
                              into lm-riga
                            end-string
                            write lm-riga
                         end-if

                         initialize mto-rec 
                                    replacing numeric data by zeroes
                                         alphanumeric data by spaces
                         perform VALORIZZA-NUMERO     
                      end-if
                      
                      if tutto-ok
                         
                         set no-promo to true
                         move 0 to save-tpr-codice
                      
                         move link-anno             to mto-anno
                         move emto-causale          to mto-causale
                         move "C"                   to mto-tipo-CF
                         move emto-cod-cli          to mto-cod-cli 
                      
                         set  cli-tipo-C  to true
                         move mto-cod-cli to cli-codice
                         read clienti  no lock
                         move cli-tipo to tcl-codice
                         read ttipocli no lock 

                         perform INVERTI-TIPOLOGIA
                      
                         move emto-anno to con-anno
                         read tcontat no lock
                      
                         evaluate tcl-serie-bolle
                         when 1 move con-ult-stampa-bolle-gdo to 
           imp-data
                         when 2 move con-ult-stampa-bolle-mv  to 
           imp-data
                         when 3 move con-ult-stampa-bolle-at  to 
           imp-data
                         end-evaluate
                      
                         start timposte key <= imp-chiave
                               invalid continue
                           not invalid
                               read timposte previous
                         end-start
                      
                         if cli-iva not = spaces
                            move cli-iva to iva-std
                         else
                            if cli-iva-ese not = spaces
                               move cli-iva-ese to iva-std
                            else
                               move tge-cod-iva-std to iva-std
                            end-if
                         end-if
                      
                         move cli-gdo               to mto-gdo
                         move emto-prg-destino      to mto-prg-destino 
                         move emto-gdo              to mto-gdo         
                         move emto-num-ord-cli      to mto-num-ord-cli 
                         move emto-data-ordine      to mto-data-ordine 
                         move emto-data-passaggio-ordine
                           to mto-data-passaggio-ordine
                         move emto-cod-agente       to mto-cod-agente   
              
                         move emto-cod-pagamento    to 
           mto-cod-pagamento   
                         move emto-cod-ese-iva      to mto-cod-ese-iva  
              
                         move emto-vettore          to mto-vettore      
              
                         move emto-note1            to mto-note1        
              
                         move emto-data-note1       to mto-data-note1   
              
                         move emto-note2            to mto-note2        
              
                         move emto-note3            to mto-note3        
              
                         move emto-note4            to mto-note4        
              
                         move emto-note             to mto-note         
              
                         move emto-pz-tot           to mto-pz-tot       
              
                         move emto-ritira-in-lubex  to 
           mto-ritira-in-lubex 
                      
LABLAB                   if si-promo set mto-si-promo to true
LABLAB                   else        set mto-no-promo to true
LABLAB                   end-if
                      
                         move emto-prenotazione-qta to 
           mto-prenotazione-qta
                         move emto-saldi-banco      to mto-saldi-banco  
              
                         move emto-saldi-promo      to mto-saldi-promo  
            
                         move tot-qta               to mto-pz-tot
                      
                         accept mto-data-creazione from century-date
                         accept mto-ora-creazione  from time
                         move user-codi to mto-utente-creazione  
                      
                         set mto-registrato to true
                         set mto-attivo to true  

                         move emto-ev-immediata to mto-immediato
                         move emto-contrassegno to mto-contrassegno
                      
                         move emto-chiave to mto-ordine-EDI      

                         if RichiamoBatch
                            call   "set-ini-log" using r-output
                            cancel "set-ini-log"
                            initialize lm-riga
                            string r-output        delimited size
                                   "WRITE MTO-REC" delimited size
                              into lm-riga
                            end-string
                            write lm-riga
                         end-if

                         write mto-rec                           

                         if RichiamoBatch
                            call   "set-ini-log" using r-output
                            cancel "set-ini-log"
                            initialize lm-riga
                            string r-output        delimited size
                                   "WRITE MTO-REC" delimited size
                                   "STATUS: "      delimited size
                                   status-mtordini delimited size
                              into lm-riga
                            end-string
                            write lm-riga
                         end-if
                      
                         add 1 to idx-ordini
                         move mto-chiave to chiave-ordine(idx-ordini)  
                      
                         move mto-cod-cli     to como-prm-cliente
                         move mto-prg-destino to como-prm-destino
                      
                         perform SCRIVI-RIGHE-ORDINE 
                         
                         move mto-chiave to sost-art-chiave
                         move user-codi  to sost-art-user
                         |Deve fare solo gli AUTO
                         set sost-art-batch to true
                         call   "sost-art" using sost-art-linkage
                         cancel "sost-art"

                         if RichiamoBatch
                            call   "set-ini-log" using r-output
                            cancel "set-ini-log"
                            initialize lm-riga
                            string r-output        delimited size
                                   "DOPO SOST-ART" delimited size
                                   mto-numero      delimited size
                              into lm-riga
                            end-string
                            write lm-riga
                         end-if

                         if tcl-fido-nuovo-no
LUBEXX                      close    clienti
LUBEXX                      open i-o clienti
LUBEXX                      read clienti no lock invalid continue 
           end-read
LUBEXX                      subtract emto-Sum from cli-fido-extra
LUBEXX                      rewrite cli-rec invalid continue end-rewrite
LUBEXX                      close      clienti
LUBEXX                      open input clienti
LUBEXX                      read clienti no lock invalid continue 
           end-read
                         end-if
                      
                         if save-tpr-codice not = 0
                            perform RIGHE-PROMO-FITTIZIE
                         end-if  
                         unlock mtordini all records 
                      
                         move mto-chiave   to emto-ordine
                         set emto-caricato to true    
                      
                         accept emto-data-ultima-modifica from 
           century-date
                         accept emto-ora-ultima-modifica  from time
                         move user-codi to emto-utente-ultima-modifica
                         
                         if TrovataScortaForzata      
                            set emto-saldi-banco-si to true
                            set emto-saldi-promo-si to true

                            set mto-saldi-banco-si  to true
                            set mto-saldi-promo-si  to true

                            rewrite mto-rec
                         end-if

                         rewrite emto-rec
                         unlock EDI-mtordini all records 
                      
                      else
                         exit perform
                      end-if
                   end-if

              end-read
           end-perform.

           if RichiamoBatch 
              call   "set-ini-log" using r-output
              cancel "set-ini-log"
              initialize lm-riga
              string r-output               delimited size
                     "FINE ATTIVA-ORDINI" delimited size
                into lm-riga
              end-string
              write lm-riga
           end-if.


      ***---
       VALORIZZA-NUMERO.           
           move spaces to tge-codice
           read tparamge no lock

           move tge-anno     to link-anno.

           set  link-ordine  to true.
           set  link-crea    to true.

           call   "nambar" using link-nambar.
           cancel "nambar".
           
           if primo-numero = 0
              move link-numero to primo-numero
           end-if.
           move link-numero    to ultimo-numero.
           
           if link-status-nambar = -1 
              set errori       to true                
              if RichiamoBatch 
                 call   "set-ini-log" using r-output
                 cancel "set-ini-log"
                 initialize lm-riga
                 string r-output    delimited size
                        "ERRORE!! " delimited size
                   into lm-riga
                 end-string
                 write lm-riga
              end-if
           else                       
              move link-numero to mto-numero          
              if RichiamoBatch 
                 call   "set-ini-log" using r-output
                 cancel "set-ini-log"
                 initialize lm-riga
                 string r-output              delimited size
                        "VALORIZZATO NUMERO " delimited size
                        mto-numero            delimited size
                   into lm-riga
                 end-string
                 write lm-riga
              end-if
           end-if.                                    
  
      ***---
       COUNTER-VIDEO.
           add 1 to counter.
           add 1 to counter2.
           if counter2 = 10
              move counter to counter-edit
              display counter-edit
                 upon form3-handle at column 16
                                        line 01
              move 0 to counter2
           end-if            
           .
      * <TOTEM:END>

       VERIFICA-ESEGUIBILITA.
      * <TOTEM:PARA. VERIFICA-ESEGUIBILITA>
           if RichiamoBatch 
              call   "set-ini-log" using r-output
              cancel "set-ini-log"
              initialize lm-riga
              string r-output                 delimited size
                     "VERIFICA ESEGUIBILITA'" delimited size
                into lm-riga
              end-string
              write lm-riga
           end-if.

           set RecLocked to false.
           set tutto-ok  to true.
           perform DELETE-LOCKFILE.
           if RecLocked
              move 78-EDI-impord to lck-nome-pgm
              read lockfile  no lock invalid continue end-read

              if RichiamoBatch
                 call   "set-ini-log" using r-output
                 cancel "set-ini-log"
                 initialize lm-riga
                 string r-output                   delimited size
                        "FUNZIONE GIA' IN USO DA " delimited size
                        lck-utente-creazione       delimited size
                   into lm-riga
                 end-string
                 write lm-riga     

                 move lk-mb-id to mb-id
                 read macrobatch no lock
                 set mb-edi-selordini-stato-err to true
                 rewrite mb-rec
              else
                 display message 
                 "FUNZIONE GIA' IN USO DA: " lck-utente-creazione
                           title tit-err
                            icon 2
              end-if
              set errori to true
           else
              perform SCRIVI-LOCKFILE
           end-if.

      ***---
       SCRIVI-LOCKFILE.
           move 78-EDI-impord to lck-nome-pgm.
           accept lck-data-creazione from century-date.
           accept lck-ora-creazione  from time.
           move user-codi to lck-utente-creazione.
           write lck-rec invalid rewrite lck-rec end-write.
           read lockfile lock.

      ***---
       DELETE-LOCKFILE.
           move 78-EDI-impord to lck-nome-pgm.
           delete lockfile invalid continue end-delete.
           if status-lockfile = "49"
              open i-o lockfile
              move 78-EDI-impord to lck-nome-pgm
              delete lockfile invalid continue end-delete
           end-if 
           .
      * <TOTEM:END>

       INVERTI-TIPOLOGIA.
      * <TOTEM:PARA. INVERTI-TIPOLOGIA>
           if emto-inversione-imposte-si
              |Funziona solo per tradizionali
              if ttipocli-standard
                 set ttipocli-gdo to true
                 exit paragraph
              end-if
              if ttipocli-gdo
                 set emto-inversione-imposte-no to true
                 exit paragraph
              end-if
           end-if 
           .
      * <TOTEM:END>

      * EVENT PARAGRAPH
       ginqui-Ev-Before-Program.
      * <TOTEM:PARA. ginqui-Ev-Before-Program>
           if lk-bl-prog-id = "macrobatch"
              set RichiamoBatch to true

              open i-o macrobatch
              move lk-mb-id to mb-id
              read macrobatch no lock
              move mb-path-log to path-log-macrobatch

              open extend log-macrobatch
              call   "set-ini-log" using r-output
              cancel "set-ini-log"
              initialize lm-riga
              string r-output                 delimited size
                     "|=> INGRESSO EDI-SELORDINI" delimited size
                into lm-riga
              end-string
              write lm-riga
           end-if.  

           move LK-BL-PROG-ID    TO COMO-PROG-ID.
           perform CALCOLA-COLORE-TRASPARENTE.

      * Verdana10B-Occidentale
           INITIALIZE WFONT-DATA, font-evidenzia-griglia
           MOVE 10                TO WFONT-SIZE
           MOVE "Arial"           TO WFONT-NAME
           SET WFONT-BOLD         TO true
           SET WFONT-ITALIC       TO true
           SET WFONT-UNDERLINE    TO FALSE
           SET WFONT-STRIKEOUT    TO FALSE
           SET WFONT-FIXED-PITCH  TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     font-evidenzia-griglia, WFONT-DATA

           copy resource "elemento.bmp".
           call "W$BITMAP" using wbitmap-load, "elemento.bmp"
                          giving elemento-bmp.
                                                  

      * Arial10B-Occidentale
           INITIALIZE WFONT-DATA, Arial10B
           MOVE 10                TO WFONT-SIZE
           MOVE "Arial"           TO WFONT-NAME
           SET WFONT-BOLD         TO true
           SET WFONT-ITALIC       TO FALSE
           SET WFONT-UNDERLINE    TO FALSE
           SET WFONT-STRIKEOUT    TO FALSE
           SET WFONT-FIXED-PITCH  TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                               Arial10B, WFONT-DATA
           .
      * <TOTEM:END>
       ginqui-Ev-After-Program.
      * <TOTEM:PARA. ginqui-Ev-After-Program>
           SET LK-BL-CANCELLAZIONE TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           DESTROY font-evidenzia-griglia Arial10B.

           call "W$BITMAP" using wbitmap-destroy, elemento-bmp.   
      
           if RichiamoBatch
              call   "set-ini-log" using r-output
              cancel "set-ini-log"
              initialize lm-riga
              string r-output               delimited size
                     "<=| USCITA EDI-SELORDINI" delimited size
                into lm-riga
              end-string
              write lm-riga
              close log-macrobatch
              close macrobatch
           end-if 
           .
      * <TOTEM:END>
       Screen4-Rb-1-BeforeProcedure.
      * <TOTEM:PARA. Screen4-Rb-1-BeforeProcedure>
           modify control-handle, color = colore-nu
           modify control-handle, color = colore-nu
           .
      * <TOTEM:END>
       Screen4-Rb-1-AfterProcedure.
      * <TOTEM:PARA. Screen4-Rb-1-AfterProcedure>
           modify control-handle, color = colore-or
           modify control-handle, color = colore-or
           .
      * <TOTEM:END>
       RB-SINGOLA-LinkTo.
      * <TOTEM:PARA. RB-SINGOLA-LinkTo>
           move 0 to mod-limiti.
           move 0 to cliente-from.
           move "<< HELP >> 0 = TUTTI I CLIENTI" to lab-cli-buf.
           display Form-ini 
           .
      * <TOTEM:END>
       RB-ELENCO-LinkTo.
      * <TOTEM:PARA. RB-ELENCO-LinkTo>
           move 1 to mod-limiti.
           display Form-ini 
           .
      * <TOTEM:END>
       Form1-Cm-1-BeforeProcedure.
      * <TOTEM:PARA. Form1-Cm-1-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       Form1-Cm-1-AfterProcedure.
      * <TOTEM:PARA. Form1-Cm-1-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       EF-ANNO-TO-BeforeProcedure.
      * <TOTEM:PARA. EF-ANNO-TO-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       EF-ordine-FROM-BeforeProcedure.
      * <TOTEM:PARA. EF-ordine-FROM-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       EF-ordine-TO-BeforeProcedure.
      * <TOTEM:PARA. EF-ordine-TO-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       EF-data-FROM-BeforeProcedure.
      * <TOTEM:PARA. EF-data-FROM-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       EF-DATA-TO-BeforeProcedure.
      * <TOTEM:PARA. EF-DATA-TO-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       EF-CLIENTE-FROM-BeforeProcedure.
      * <TOTEM:PARA. EF-CLIENTE-FROM-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           move 1 to e-cerca.
           modify tool-cercaa, enabled = e-cerca.
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       EF-ANNO-TO-AfterProcedure.
      * <TOTEM:PARA. EF-ANNO-TO-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO-INI.
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       EF-ordine-FROM-AfterProcedure.
      * <TOTEM:PARA. EF-ordine-FROM-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO-INI.
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       EF-ordine-TO-AfterProcedure.
      * <TOTEM:PARA. EF-ordine-TO-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO-INI.
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       EF-data-FROM-AfterProcedure.
      * <TOTEM:PARA. EF-data-FROM-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO-INI.
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       EF-DATA-TO-AfterProcedure.
      * <TOTEM:PARA. EF-DATA-TO-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO-INI.
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       EF-CLIENTE-FROM-AfterProcedure.
      * <TOTEM:PARA. EF-CLIENTE-FROM-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO-INI.
           move 0 to e-cerca.
           modify tool-cercaa, enabled = e-cerca.
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       gd-ordini-Ev-Msg-Begin-Entry.
      * <TOTEM:PARA. gd-ordini-Ev-Msg-Begin-Entry>
           inquire gd-ordini, entry-reason in como-x.

           set EVENT-ACTION to EVENT-ACTION-FAIL-TERMINATE.
           evaluate como-x
           when X"00"|doppio click
           when X"0D"|invio
                inquire gd-ordini, CURSOR-Y = riga
                set CallManutenzione to true
           end-evaluate 
           .
      * <TOTEM:END>
       gd-ordini-Ev-Msg-Goto-Cell.
      * <TOTEM:PARA. gd-ordini-Ev-Msg-Goto-Cell>
           perform SPOSTAMENTO-INI 
           .
      * <TOTEM:END>
       gd-ordini-Ev-Msg-Goto-Cell-Mouse.
      * <TOTEM:PARA. gd-ordini-Ev-Msg-Goto-Cell-Mouse>
           perform SPOSTAMENTO-INI 
           .
      * <TOTEM:END>
       gd-ordini-Ev-Msg-End-Drag.
      * <TOTEM:PARA. gd-ordini-Ev-Msg-End-Drag>
           perform SPOSTAMENTO-INI 
           .
      * <TOTEM:END>
       gd-ordini-Ev-Msg-Begin-Drag.
      * <TOTEM:PARA. gd-ordini-Ev-Msg-Begin-Drag>
           perform SPOSTAMENTO-INI 
           .
      * <TOTEM:END>
       gd-ordini-Ev-Msg-Goto-Cell-Drag.
      * <TOTEM:PARA. gd-ordini-Ev-Msg-Goto-Cell-Drag>
           perform SPOSTAMENTO-INI 
           .
      * <TOTEM:END>
       pb-ok-BeforeProcedure.
      * <TOTEM:PARA. pb-ok-BeforeProcedure>
           modify pb-ok, bitmap-number 2
           .
      * <TOTEM:END>
       pb-ok-AfterProcedure.
      * <TOTEM:PARA. pb-ok-AfterProcedure>
           modify pb-ok, bitmap-number 1
           .
      * <TOTEM:END>
       pb-annulla-BeforeProcedure.
      * <TOTEM:PARA. pb-annulla-BeforeProcedure>
           modify pb-annulla, bitmap-number 2
           .
      * <TOTEM:END>
       pb-annulla-AfterProcedure.
      * <TOTEM:PARA. pb-annulla-AfterProcedure>
           modify pb-annulla, bitmap-number 1
           .
      * <TOTEM:END>
       pb-annulla-LinkTo.
      * <TOTEM:PARA. pb-annulla-LinkTo>
           .
      * <TOTEM:END>
       pb-ok-LinkTo.
      * <TOTEM:PARA. pb-ok-LinkTo>
           set controllo-finale to true.

           move control-id to mem-id.
           perform  varying CONTROL-ID from 78-id-ef-anno by 1
                      until CONTROL-ID > 78-id-ef-cliente-from
              perform CONTROLLO-INI
              if errori 
                 exit perform 
              end-if
           end-perform.

           set controllo-finale to false.

           if tutto-ok
              move 0 to idx
              initialize tab-tipologie replacing numeric data by zeroes
                                            alphanumeric data by spaces
              inquire gd-tipocli, last-row in tot-righe
              perform varying riga from 2 by 1 
                        until riga > tot-righe
                 inquire gd-tipocli(riga, 1), 
                         hidden-data in hid-col-sel
                 if hid-col-sel = 1
                    add 1 to idx
                    inquire gd-tipocli(riga, 1), 
                            cell-data in el-tipo(idx)
                 end-if
              end-perform

              modify form1-Handle, visible 0
              if tipo-elab = 1
                 move anno-to      to como-anno
                 move ordine-from  to como-numero-ordine
                 perform CHIAMA-MANUTENZIONE
              else
                 perform SCARICA-COMBO-STATO-ORDINE
                 perform FORM2-OPEN-ROUTINE 
              end-if                      
              if not RichiamoBatch      
                 modify form1-Handle, visible 1
              end-if
           end-if 
           .
      * <TOTEM:END>
       TOOL-CERCA-LinkTo.
      * <TOTEM:PARA. TOOL-CERCA-LinkTo>
           inquire tool-cerca, enabled in e-cerca.
           if e-cerca = 1
              perform CERCA
           end-if 
           .
      * <TOTEM:END>
       pb-annulla2-BeforeProcedure.
      * <TOTEM:PARA. pb-annulla2-BeforeProcedure>
           modify pb-annulla2, bitmap-number 2
           .
      * <TOTEM:END>
       pb-annulla2-AfterProcedure.
      * <TOTEM:PARA. pb-annulla2-AfterProcedure>
           modify pb-annulla2, bitmap-number 1
           .
      * <TOTEM:END>
       pb-ok2-BeforeProcedure.
      * <TOTEM:PARA. pb-ok2-BeforeProcedure>
           modify pb-ok2, bitmap-number 2
           .
      * <TOTEM:END>
       pb-ok2-AfterProcedure.
      * <TOTEM:PARA. pb-ok2-AfterProcedure>
           modify pb-ok2, bitmap-number 1
           .
      * <TOTEM:END>
       pb-ok2-LinkTo.
      * <TOTEM:PARA. pb-ok2-LinkTo>
           inquire gd-ordini, CURSOR-Y = riga.

           perform ORDINE-DA-GRIGLIA 
           .
      * <TOTEM:END>
       Screen2-DaEf-2-BeforeProcedure.
      * <TOTEM:PARA. Screen2-DaEf-2-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           move 1 to StatusHelp.
           perform STATUS-HELP 
           .
      * <TOTEM:END>
       Screen2-DaEf-2-AfterProcedure.
      * <TOTEM:PARA. Screen2-DaEf-2-AfterProcedure>
              INQUIRE ef-cli, VALUE IN emto-cod-cli
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-cli-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           move 0 to StatusHelp.
           perform STATUS-HELP.
           perform CONTROLLO.

           .
      * <TOTEM:END>

       Screen2-DaEf-3-BeforeProcedure.
      * <TOTEM:PARA. Screen2-DaEf-3-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           move 1 to StatusHelp.
           perform STATUS-HELP 
           .
      * <TOTEM:END>
       Screen2-DaEf-3-AfterProcedure.
      * <TOTEM:PARA. Screen2-DaEf-3-AfterProcedure>
              INQUIRE ef-des, VALUE IN emto-prg-destino
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-des-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           move 0 to StatusHelp.
           perform STATUS-HELP.
           perform CONTROLLO.

           .
      * <TOTEM:END>

       Screen2-DaEf-5-BeforeProcedure.
      * <TOTEM:PARA. Screen2-DaEf-5-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       Screen2-DaEf-5-AfterProcedure.
      * <TOTEM:PARA. Screen2-DaEf-5-AfterProcedure>
              INQUIRE ef-num-ord, VALUE IN emto-num-ord-cli
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-num-ord-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO.

           .
      * <TOTEM:END>

       Screen2-DaEf-6-BeforeProcedure.
      * <TOTEM:PARA. Screen2-DaEf-6-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       Screen2-DaEf-6-AfterProcedure.
      * <TOTEM:PARA. Screen2-DaEf-6-AfterProcedure>
              INQUIRE ef-data, VALUE IN emto-data-ordine
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-data-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO.

           .
      * <TOTEM:END>

       Screen2-DaEf-7-BeforeProcedure.
      * <TOTEM:PARA. Screen2-DaEf-7-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       Screen2-DaEf-7-AfterProcedure.
      * <TOTEM:PARA. Screen2-DaEf-7-AfterProcedure>
              INQUIRE ef-data-pass, VALUE IN emto-data-passaggio-ordine
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-data-pass-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
              INQUIRE ef-evadi-dal, VALUE IN emto-evadi-dal
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-evadi-dal-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO.

           .
      * <TOTEM:END>

       Screen2-DaEf-8-BeforeProcedure.
      * <TOTEM:PARA. Screen2-DaEf-8-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           move 1 to StatusHelp.
           perform STATUS-HELP 
           .
      * <TOTEM:END>
       Screen2-DaEf-8-AfterProcedure.
      * <TOTEM:PARA. Screen2-DaEf-8-AfterProcedure>
              INQUIRE ef-age, VALUE IN emto-cod-agente
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-age-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           move 0 to StatusHelp.
           perform STATUS-HELP.      
           perform CONTROLLO.

           .
      * <TOTEM:END>

       Screen2-DaEf-9-BeforeProcedure.
      * <TOTEM:PARA. Screen2-DaEf-9-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           move 1 to StatusHelp.
           perform STATUS-HELP 
           .
      * <TOTEM:END>
       Screen2-DaEf-9-AfterProcedure.
      * <TOTEM:PARA. Screen2-DaEf-9-AfterProcedure>
              INQUIRE ef-pag, VALUE IN emto-cod-pagamento
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-pag-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           move 0 to StatusHelp.
           perform STATUS-HELP.
           perform CONTROLLO.

           .
      * <TOTEM:END>

       Screen2-DaEf-10-BeforeProcedure.
      * <TOTEM:PARA. Screen2-DaEf-10-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           move 1 to StatusHelp.
           perform STATUS-HELP 
           .
      * <TOTEM:END>
       Screen2-DaEf-10-AfterProcedure.
      * <TOTEM:PARA. Screen2-DaEf-10-AfterProcedure>
              INQUIRE ef-iva, VALUE IN emto-cod-ese-iva
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-iva-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           move 0 to StatusHelp.
           perform STATUS-HELP.
           perform CONTROLLO.

           .
      * <TOTEM:END>

       Screen2-DaEf-11-BeforeProcedure.
      * <TOTEM:PARA. Screen2-DaEf-11-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           move 1 to StatusHelp.
           perform STATUS-HELP 
           .
      * <TOTEM:END>
       Screen2-DaEf-11-AfterProcedure.
      * <TOTEM:PARA. Screen2-DaEf-11-AfterProcedure>
              INQUIRE ef-vet, VALUE IN emto-vettore
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-vet-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           move 0 to StatusHelp.
           perform STATUS-HELP.
           perform CONTROLLO.

           .
      * <TOTEM:END>

       Screen2-DaEf-12-BeforeProcedure.
      * <TOTEM:PARA. Screen2-DaEf-12-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       Screen2-DaEf-12-AfterProcedure.
      * <TOTEM:PARA. Screen2-DaEf-12-AfterProcedure>
              INQUIRE ef-note-1, VALUE IN emto-note1
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-note-1-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       Screen2-DaEf-13-BeforeProcedure.
      * <TOTEM:PARA. Screen2-DaEf-13-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       Screen2-DaEf-13-AfterProcedure.
      * <TOTEM:PARA. Screen2-DaEf-13-AfterProcedure>
              INQUIRE ef-data-cons, VALUE IN emto-data-note1
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-data-cons-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO.

           .
      * <TOTEM:END>

       Screen2-DaEf-14-BeforeProcedure.
      * <TOTEM:PARA. Screen2-DaEf-14-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       Screen2-DaEf-14-AfterProcedure.
      * <TOTEM:PARA. Screen2-DaEf-14-AfterProcedure>
              INQUIRE ef-note-2, VALUE IN emto-note2
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-note-2-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       Screen2-DaEf-15-BeforeProcedure.
      * <TOTEM:PARA. Screen2-DaEf-15-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       Screen2-DaEf-15-AfterProcedure.
      * <TOTEM:PARA. Screen2-DaEf-15-AfterProcedure>
              INQUIRE ef-note-3, VALUE IN emto-note3
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-note-3-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       Screen2-DaEf-16-BeforeProcedure.
      * <TOTEM:PARA. Screen2-DaEf-16-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       Screen2-DaEf-16-AfterProcedure.
      * <TOTEM:PARA. Screen2-DaEf-16-AfterProcedure>
              INQUIRE ef-note-4, VALUE IN emto-note4
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-note-4-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       Screen2-DaEf-17-BeforeProcedure.
      * <TOTEM:PARA. Screen2-DaEf-17-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       Screen2-DaEf-17-AfterProcedure.
      * <TOTEM:PARA. Screen2-DaEf-17-AfterProcedure>
              INQUIRE ef-note, VALUE IN emto-note
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-note-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       Screen2-DaCb-1-BeforeProcedure.
      * <TOTEM:PARA. Screen2-DaCb-1-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       Screen2-DaCb-1-AfterProcedure.
      * <TOTEM:PARA. Screen2-DaCb-1-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       Screen2-DaCb-3-BeforeProcedure.
      * <TOTEM:PARA. Screen2-DaCb-3-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       Screen2-DaCb-3-AfterProcedure.
      * <TOTEM:PARA. Screen2-DaCb-3-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       Screen2-DaCb-4-BeforeProcedure.
      * <TOTEM:PARA. Screen2-DaCb-4-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       Screen2-DaCb-4-AfterProcedure.
      * <TOTEM:PARA. Screen2-DaCb-4-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       Screen2-DaCb-5-BeforeProcedure.
      * <TOTEM:PARA. Screen2-DaCb-5-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       Screen2-DaCb-5-AfterProcedure.
      * <TOTEM:PARA. Screen2-DaCb-5-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       NUOVO-LinkTo.
      * <TOTEM:PARA. NUOVO-LinkTo>
           .
      * <TOTEM:END>
       CANCELLA-LinkTo.
      * <TOTEM:PARA. CANCELLA-LinkTo>
           inquire tool-cancella, enabled in e-cancella.
           if e-cancella = 1
              display message "Cancellare l'ordine corrente?"
                        title titolo
                         type mb-yes-no
                      default mb-no
                       giving scelta
                         icon 2

              if scelta = mb-yes
                 set RigaCambiata to false
                 perform CANCELLA
              end-if

           end-if 
           .
      * <TOTEM:END>
       TOOL-SALVA-LinkTo.
      * <TOTEM:PARA. TOOL-SALVA-LinkTo>
           inquire tool-salva, enabled in e-salva.
           if e-salva = 1
              perform SALVA
           end-if 
           .
      * <TOTEM:END>
       ANTEPRIMA-LinkTo.
      * <TOTEM:PARA. ANTEPRIMA-LinkTo>
           .
      * <TOTEM:END>
       TOOL-MODIFICA-BeforeProcedure.
      * <TOTEM:PARA. TOOL-MODIFICA-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       TOOL-MODIFICA-AfterProcedure.
      * <TOTEM:PARA. TOOL-MODIFICA-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       TOOL-MODIFICA-LinkTo.
      * <TOTEM:PARA. TOOL-MODIFICA-LinkTo>
           inquire tool-modifica, enabled in e-modifica.
           if e-modifica = 1
              perform MODIFICA
           end-if 
           .
      * <TOTEM:END>
       STAMPA-LinkTo.
      * <TOTEM:PARA. STAMPA-LinkTo>
           .
      * <TOTEM:END>
       TOOL-CERCAa-LinkTo.
      * <TOTEM:PARA. TOOL-CERCAa-LinkTo>
           inquire tool-cercaa, enabled in e-cerca.
           if e-cerca = 1
              perform CERCA-INI
           end-if 
           .
      * <TOTEM:END>
       chk-ritira-LinkTo.
      * <TOTEM:PARA. chk-ritira-LinkTo>
           if chk-ritira-buf = 1
              move 0 to ef-vet-buf
              move spaces to lab-vettore-buf
              display ef-vet lab-vettore
           end-if 
           .
      * <TOTEM:END>
       Form1-Gd-1-Ev-Msg-Begin-Drag.
      * <TOTEM:PARA. Form1-Gd-1-Ev-Msg-Begin-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       Form1-Gd-1-Ev-Msg-Begin-Entry.
      * <TOTEM:PARA. Form1-Gd-1-Ev-Msg-Begin-Entry>
           inquire form1-gd-1, cursor-x in colonna.
           set tutto-ok              to true.
           set ChiamaZoomProgressivo to false.

           if mod = 0
              set event-action to event-action-fail
              exit paragraph 
           else
              inquire form1-gd-1(event-data-2, 78-col-art),
                      cell-data in col-art
              move col-art to art-codice
              if art-codice = 0
                 set event-action to event-action-fail
                 exit paragraph 
              end-if
           end-if.     
                   
           evaluate colonna
           when 78-col-art
           when 78-col-des
           when 78-col-imb
                if hid-emro-si-blister
                   set event-action to event-action-fail     
                   move col-art to emro-cod-articolo
                   |E' comunque LBX
                   move tge-causale-ordini-std to mto-causale
                   perform CONTROLLA-VALIDITA-COMPONENTI
                   if bli-attivo
                      set hid-emro-progressivo-valido to true
                      set hid-emro-articolo-valido    to true
                      modify form1-gd-1(riga, 1),
                             hidden-data gruppo-hidden
                      set hid-emro-progressivo-valido to true
                      perform STATO-RIGA
                   end-if
                else
                   set event-action to event-action-fail-terminate
                   inquire form1-gd-1, entry-reason in como-x
                   evaluate como-x
                   when X"00"|doppio click
                   when X"0D"|invio
                        if art-codice not = 0
                           set ChiamaZoomProgressivo to true
                        end-if
                   end-evaluate
                end-if

           when 78-col-qta-EDI
           when 78-col-qta-GESLUX    
                if hid-emro-si-blister
                   set event-action to event-action-fail
                else
                   set event-action to event-action-fail-terminate
                   inquire form1-gd-1, entry-reason in como-x
                   evaluate como-x
                   when X"00"|doppio click
                   when X"0D"|invio
                        inquire form1-gd-1(event-data-2, colonna),
                                cell-data in col-qta
                        move col-qta to emro-qta
                        if hid-emro-qta-imballi <= emro-qta
                           move 0 to como-div
                           compute como-div = 
                                   emro-qta / hid-emro-qta-imballi
                           compute como-qta = 
                                   como-div * hid-emro-qta-imballi
                           if como-qta not = emro-qta
                              set errori to true
                           else

                              modify  form1-gd-1(event-data-2, 
           78-col-qta),
                                      cell-data col-qta
                                                                        
                                   
      *****                  modify form1-gd-1(event-data-2, 78-col-prz-EDI), cell-color = 513
                              move col-qta to emro-qta

                              if emro-qta not = 0
                                 set hid-emro-qtac-ok to true
                              end-if
                              perform STATO-RIGA
                           end-if
                        else
                           set errori to true
                        end-if
                        if errori
                           display message "Quantità errata. Imballo da 
      -    "" 
                                           hid-emro-qta-imballi
                                     title tit-err
                                      icon 2
                        end-if
                   end-evaluate
                end-if

           when 78-col-qta
                continue
      *****          if hid-emro-si-blister
      *****             set event-action to event-action-fail
      *****          end-if     
      *****          inquire form1-gd-1(event-data-2, 78-col-qta-EDI), 
      *****                  cell-data in col-qta-EDI
      *****          move col-qta-EDI to emro-qta-EDI
      *****          inquire form1-gd-1(event-data-2, 78-col-qta-GESLUX), 
      *****                  cell-data in col-qta-GESLUX
      *****          move col-qta-GESLUX to emro-qta-GESLUX
      *****          if emro-qta-EDI    not = 0 or
      *****             emro-qta-GESLUX not = 0
      *****             set event-action to event-action-fail
      *****          end-if
      *****

           when 78-col-prz-EDI
           when 78-col-prz-GESLUX
                set event-action to event-action-fail-terminate
                inquire form1-gd-1, entry-reason in como-x
                evaluate como-x
                when X"00"|doppio click
                when X"0D"|invio        
                     inquire form1-gd-1(event-data-2, colonna),
                             cell-data in col-prz
                     modify  form1-gd-1(event-data-2, 78-col-prz),
                             cell-data col-prz
                     perform IMPOSTA-PREZZO
                end-evaluate   

           when 78-col-prz
                set environment "KEYSTROKE" to "DATA=44 46"

           when 78-col-evadi-dal
                continue

           when other
                set event-action to event-action-fail
           end-evaluate 
           .
      * <TOTEM:END>
       Form1-Gd-1-Ev-Msg-End-Drag.
      * <TOTEM:PARA. Form1-Gd-1-Ev-Msg-End-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       Form1-Gd-1-Ev-Msg-Goto-Cell.
      * <TOTEM:PARA. Form1-Gd-1-Ev-Msg-Goto-Cell>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       Form1-Gd-1-Ev-Msg-Goto-Cell-Drag.
      * <TOTEM:PARA. Form1-Gd-1-Ev-Msg-Goto-Cell-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       Form1-Gd-1-Ev-Msg-Goto-Cell-Mouse.
      * <TOTEM:PARA. Form1-Gd-1-Ev-Msg-Goto-Cell-Mouse>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       pb-genera-BeforeProcedure.
      * <TOTEM:PARA. pb-genera-BeforeProcedure>
           modify pb-genera, bitmap-number = 2 
           .
      * <TOTEM:END>
       pb-genera-AfterProcedure.
      * <TOTEM:PARA. pb-genera-AfterProcedure>
           modify pb-genera, bitmap-number = 1 
           .
      * <TOTEM:END>
       pb-genera-LinkTo.
      * <TOTEM:PARA. pb-genera-LinkTo>
           if RichiamoBatch
              move mb-yes to scelta
           else
              display message "Attivare gli ordini?"
                        title titolo
                         type mb-yes-no
                      default mb-no
                       giving scelta
           end-if.

           if scelta = mb-yes
              perform VERIFICA-ESEGUIBILITA
              if tutto-ok            
                 if RichiamoBatch 
                    call   "set-ini-log" using r-output
                    cancel "set-ini-log"
                    initialize lm-riga
                    string r-output             delimited size
                           "GENERAZIONE ORDINI" delimited size
                      into lm-riga
                    end-string
                    write lm-riga
                 end-if
                 perform FORM-GEN-OPEN-ROUTINE
                 move 27 to key-status
                 if idx-ordini = 0
                    if RichiamoBatch 
                       call   "set-ini-log" using r-output
                       cancel "set-ini-log"
                       initialize lm-riga
                       string r-output                 delimited size
                              "NESSUN ORDINE GENERATO" delimited size
                         into lm-riga
                       end-string
                       write lm-riga
                    else
                       display message "Nessun ordine attivato" 
                                 title titolo
                                  icon 2
                    end-if
                 end-if
                 perform DELETE-LOCKFILE
              end-if
           end-if 
           .
      * <TOTEM:END>
       Form1-Gd-1-Ev-Msg-Finish-Entry.
      * <TOTEM:PARA. Form1-Gd-1-Ev-Msg-Finish-Entry>
           inquire form1-gd-1, cursor-x in colonna.
           set tutto-ok to true.

           evaluate colonna 
           when 78-col-qta
                inquire form1-gd-1(event-data-2, 78-col-qta), 
                        cell-data in col-qta
                move col-qta to emro-qta

                if hid-emro-qta-imballi <= emro-qta
                   move 0 to como-div
                   compute como-div = emro-qta / hid-emro-qta-imballi
                   compute como-qta = como-div * hid-emro-qta-imballi
                   if como-qta not = emro-qta
                      set errori to true
                   end-if
                else
                   set errori to true
                end-if

                if errori
                   set event-action to event-action-fail
                   display message "Quantità errata. Imballo da " 
                                   hid-emro-qta-imballi
                             title tit-err
                              icon 2
                else
                   set hid-emro-qtac-ok to true
                   perform STATO-RIGA 

                   inquire form1-gd-1(event-data-2, 78-col-qta), 
                           cell-data in col-qta
                   move col-qta to emro-qta
                   if emro-qta not = hid-emro-qta
                      set RigaCambiata to true
                   end-if
                end-if

           when 78-col-prz
                perform IMPOSTA-PREZZO
                set environment "KEYSTROKE" to "DATA=44 44"
                set environment "KEYSTROKE" to "DATA=46 46"
                inquire form1-gd-1(event-data-2, 78-col-prz), 
                        cell-data in col-prz
                move col-prz to emro-prz
                if emro-prz not = hid-emro-prz
                   set RigaCambiata to true
                end-if

           when 78-col-evadi-dal
                inquire form1-gd-1(event-data-2, 78-col-evadi-dal), 
                        cell-data in col-evadi-dal
                move col-evadi-dal to como-data
                if como-data = 0
                   inquire ef-evadi-dal, value in ef-evadi-dal-buf
                   move ef-evadi-dal-buf to como-data
                   if como-data = 0
                      move data-oggi to como-data
                      perform DATE-TO-SCREEN
                      move como-data to col-evadi-dal
                   else
                      perform DATE-TO-SCREEN
                      move como-data to col-evadi-dal
                   end-if
                else
                   perform DATE-FORMAT
                   move como-data to col-evadi-dal
                end-if                            
                modify form1-gd-1(event-data-2, 78-col-evadi-dal), 
                       cell-data = col-evadi-dal 
                move col-evadi-dal to como-data
                perform DATE-TO-FILE
                if como-data not = hid-emro-evadi-dal
                   set RigaCambiata to true
                end-if

           end-evaluate.

           perform CALCOLA-TOTALE 
           .
      * <TOTEM:END>
       pb-sia-BeforeProcedure.
      * <TOTEM:PARA. pb-sia-BeforeProcedure>
           modify pb-sia, bitmap-number = 2 
           .
      * <TOTEM:END>
       pb-sia-AfterProcedure.
      * <TOTEM:PARA. pb-sia-AfterProcedure>
           modify pb-sia, bitmap-number = 1 
           .
      * <TOTEM:END>
       pb-si-LinkTo.
      * <TOTEM:PARA. pb-si-LinkTo>
           move 27 to key-status 
           .
      * <TOTEM:END>
       Form1-Gd-1-Ev-Msg-Cancel-Entry.
      * <TOTEM:PARA. Form1-Gd-1-Ev-Msg-Cancel-Entry>
           set environment "KEYSTROKE" to "DATA=44 44".
           set environment "KEYSTROKE" to "DATA=46 46" 
           .
      * <TOTEM:END>
       pb-elimina-LinkTo.
      * <TOTEM:PARA. pb-elimina-LinkTo>
           if mod = 0 exit paragraph end-if.

           display message "Cancellare la riga?"
                     title titolo
                      icon 2
                      type mb-yes-no
                   default mb-no
                    giving scelta
                    
           if scelta = mb-yes
              inquire form1-gd-1, cursor-y in riga
              inquire form1-gd-1(riga, 78-col-num),
                      cell-data in col-num

              move emto-chiave to emro-chiave-testa
              move col-num     to emro-riga
              delete EDI-mrordini record 
                     invalid continue
                     |display message "?"
              end-delete             
              modify pb-elimina, bitmap-number = 1

              modify form1-gd-1, record-to-delete = riga
              if hid-emro-bloccato
                 subtract 1 from righe-errate
              end-if
              inquire form1-gd-1, last-row in tot-righe
              if tot-righe = 1   
                 set fromCancella to true
                 set RigaCambiata to false
                 perform CANCELLA
              else
                 if riga > tot-righe
                    move tot-righe to riga
                 end-if
                 move riga to event-data-2
                 modify form1-gd-1, cursor-y riga
                 perform SPOSTAMENTO
                 set RigaCambiata to true
              end-if

           end-if.      
           perform CALCOLA-TOTALE 
           .
      * <TOTEM:END>
       pb-elimina-BeforeProcedure.
      * <TOTEM:PARA. pb-elimina-BeforeProcedure>
           modify pb-elimina, bitmap-number = 2 
           .
      * <TOTEM:END>
       pb-elimina-AfterProcedure.
      * <TOTEM:PARA. pb-elimina-AfterProcedure>
           modify pb-elimina, bitmap-number = 1 
           .
      * <TOTEM:END>
       pb-aggiorna-BeforeProcedure.
      * <TOTEM:PARA. pb-aggiorna-BeforeProcedure>
           modify pb-aggiorna, bitmap-number = 2 
           .
      * <TOTEM:END>
       pb-aggiorna-AfterProcedure.
      * <TOTEM:PARA. pb-aggiorna-AfterProcedure>
           modify pb-aggiorna, bitmap-number = 1 
           .
      * <TOTEM:END>
       pb-aggiorna-LinkTo.
      * <TOTEM:PARA. pb-aggiorna-LinkTo>
           perform VERIFICA-ESEGUIBILITA.
           if tutto-ok
              if RichiamoBatch 
                 call   "set-ini-log" using r-output
                 cancel "set-ini-log"
                 initialize lm-riga
                 string r-output               delimited size
                        "AGGIORNAMENTO ORDINI" delimited size
                   into lm-riga
                 end-string
                 write lm-riga
              end-if

              modify form2-Handle, visible false
              set ControllaCliente to true
              perform FORM3-OPEN-ROUTINE
              set ControllaCliente to false
              move 78-ID-gd-ordini to control-id
              move 4 to accept-control
              modify pb-aggiorna, bitmap-number = 2
              move 2 to riga, EVENT-DATA-2
              modify gd-ordini, CURSOR-Y = 2
              perform CAMBIA-FONT-RIGA
              move tot-attivi   to lab-attivi-buf
              move tot-bloccati to lab-bloccati-buf
              display lab-attivi lab-bloccati
              if not RichiamoBatch
                 modify form2-Handle, visible true
              end-if
              perform DELETE-LOCKFILE
           end-if 
           .
      * <TOTEM:END>
       pb-cambia-BeforeProcedure.
      * <TOTEM:PARA. pb-cambia-BeforeProcedure>
           modify pb-cambia, bitmap-number = 2 
           .
      * <TOTEM:END>
       pb-cambia-AfterProcedure.
      * <TOTEM:PARA. pb-cambia-AfterProcedure>
           modify pb-cambia, bitmap-number = 1 
           .
      * <TOTEM:END>
       pb-cambia-LinkTo.
      * <TOTEM:PARA. pb-cambia-LinkTo>
      *--------     zoom selezione articolo ordinato per descrizione
      *--------     zoom selezione progressivo  
      ***--------      piu progressivi
      ***--------      un progressivo
      ***--------      progressivo forzato
      *--------     adattare quantità 
      *--------     cambiare riga griglia 
      *--------     riportare prezzo           

           if hid-emro-si-blister
              continue
           else
              perform ZOOM-SU-PROGMAG
           end-if.
           move 4 to ACCEPT-CONTROL.
           

      ***---                          
       ZOOM-SU-PROGMAG.   
           if fromAggiungi
              initialize art-rec
              move "articoli-codice" to como-file
           else                          
              inquire form1-gd-1, cursor-y in riga
              inquire form1-gd-1(riga, 78-col-art), cell-data in col-art
              move 0 to num-articoli
              move col-art to art-codice
              read articoli no lock
                   invalid move spaces to art-descrizione
              end-read
              move "articoli"    to como-file
           end-if.
           call "zoom-gt"  using como-file, art-rec
                          giving stato-zoom
           end-call.
           cancel "zoom-gt".
           if stato-zoom = 0
              set filtro-articoli to true
              perform COMPONI-TMP
              if trovato
                 if num-articoli > 1                  
                    perform TROVA-LISTINO
                    if no-prg-listino
                       perform TROVA-CLI-PRG
                    end-if
                    if si-prg-listino
                       perform FIND-PROGMAG-LISTINO
                       perform UN-SOLO-ARTICOLO-SU-PROGMAG
                    else
                       move prg-chiave to como-prg-chiave
                       perform POSITION-ON-MAJOR-GIACENZA
LUBEXX*****                 perform POSITION-ON-FIRST-RECORD
                       move path-tmp-progmag-zoom to ext-file
                       move "tmp-progmag-zoom-o"  to como-file
                       call "zoom-gt"          using como-file, 
                                                     tmp-prg-z-rec
                                              giving stato-zoom
                       end-call
                       cancel "zoom-gt"
                       if stato-zoom = 0 
                          move tmp-prg-z-chiave to prg-chiave
                          read progmag no lock invalid continue end-read
                          if not fromAggiungi             
                             modify pb-cambia, bitmap-number = 1
                             perform CAMBIA-ARTICOLO
                          end-if
                       end-if
                    end-if
                 else
                    perform UN-SOLO-ARTICOLO-SU-PROGMAG
                 end-if
              else
                 display message "Articolo NON valido"
                           title tit-err
                            icon 2
                 set errori to true
                 move 1 to stato-zoom
              end-if
              delete file tmp-progmag-zoom
           end-if.       
           perform CALCOLA-TOTALE.

      ***---
       COMPONI-TMP.
           move 0 to num-articoli.
           call "W$MOUSE" using set-mouse-shape, wait-pointer.
           set record-ok to true.
           move art-codice to SaveArticolo.
      *     tca-cod-magaz.
           accept  path-tmp-progmag-zoom from environment "PATH_ST".
           accept  como-data             from century-date.
           accept  como-ora              from time.
           inspect path-tmp-progmag-zoom replacing trailing
                                         spaces by low-value.
           string path-tmp-progmag-zoom  delimited by low-value
                  "tmp-progmag-zoom-o"   delimited by size
                  "_"                    delimited by size
                  como-data              delimited by size
                  "_"                    delimited by size
                  como-ora               delimited by size
                  into path-tmp-progmag-zoom
           end-string.

           set trovato to false.
           open output tmp-progmag-zoom.
           if status-tmp-progmag-zoom = "00"
              initialize prg-rec
              if filtro-articoli
                 move SaveArticolo to prg-cod-articolo
                 read progmag no lock invalid continue end-read
                 move prg-ordinato-1 to save-ordinato
              end-if
              move tca-cod-magaz to prg-cod-magazzino
              start progmag key  is >= prg-chiave
                    invalid continue 
                not invalid perform CICLO-READ
              end-start

              close tmp-progmag-zoom
              call "W$MOUSE" using set-mouse-shape, arrow-pointer
           end-if.

      ***---
       CICLO-READ.
           perform until 1 = 2
              read progmag next no lock at end exit perform end-read
              if filtro-articoli
                 if prg-cod-articolo not = SaveArticolo
                    exit perform
                 end-if
              end-if
              set record-ok to false
              if prg-cod-magazzino not = spaces and
                 prg-tipo-imballo  not = spaces and
                 prg-peso          not = 0      and
                 prg-cod-magazzino     = tca-cod-magaz 

                 if prg-attivo
                    move prg-cod-articolo  to art-codice
                    read articoli no lock invalid continue end-read
                    if art-attivo
                       set record-ok to true 
                    end-if
                 
                    if record-ok
                 
                       move prg-tipo-imballo to imq-codice
                       read timbalqta no lock invalid continue end-read
                 
                       move imq-qta-imb      to imballi-ed
                       move imq-tipo         to imb-codice
                       read timballi no lock
                            invalid  initialize imb-descrizione
                       end-read
                       inspect imb-descrizione replacing trailing spaces
                                                            by low-value
                       move imq-qta-imb    to imballi-ed
                       call "C$JUSTIFY" using imballi-ed, "L"
                       initialize imballo-descrizione
                       string  imb-descrizione delimited low-value
                               " da "          delimited size
                               imballi-ed      delimited spaces
                               " x "           delimited size
                               art-udm-imballo delimited size
                               into imballo-descrizione
                       end-string
                 
                       move art-codice          to 
           tmp-prg-z-cod-articolo
                       move art-descrizione     to tmp-prg-z-art-des
                       move tca-cod-magaz       to 
           tmp-prg-z-cod-magazzino
                       move StoreDesMagazzino   to tmp-prg-z-mag-des
                       move prg-tipo-imballo    to 
           tmp-prg-z-tipo-imballo
                       move imballo-descrizione to tmp-prg-z-imb-des
                       move prg-peso            to tmp-prg-z-peso
                       move prg-giacenza        to tmp-prg-z-giacenza
                       move prg-impegnato       to tmp-prg-z-impegnato
                       move save-ordinato       to tmp-prg-z-ordinato
                 
                       write tmp-prg-z-rec invalid continue end-write
                       set trovato to true
                       add 1 to num-articoli
                       if num-articoli = 1
                          move prg-chiave to GiacenzaKey
                       end-if
                    end-if
                 end-if
              end-if

           end-perform.

      ***---
       POSITION-ON-MAJOR-GIACENZA.
           open input tmp-progmag-zoom.

           move low-value     to tmp-prg-z-rec.
           move SaveArticolo  to tmp-prg-z-cod-articolo como-articolo.
           move tca-cod-magaz to como-magazzino
           move tmp-prg-z-cod-articolo  to como-articolo.
           move tca-cod-magaz           to tmp-prg-z-cod-magazzino
                                           como-magazzino.
           move 0      to giacenza-maggiore giacenza-fisica 
                          giacenza-assoluta giacenza-assoluta-maggiore.
           move spaces to como-record.
           start tmp-progmag-zoom key is >=  key-des
                 invalid continue
             not invalid
                 perform until 1 = 2
                    read tmp-progmag-zoom next 
                         at end exit perform 
                    end-read
                    if tmp-prg-z-cod-articolo  not = como-articolo or
                       tmp-prg-z-cod-magazzino not = como-magazzino
                       exit perform
                    end-if            
                    
                    move tmp-prg-z-giacenza to giacenza-assoluta
                    if giacenza-assoluta >= giacenza-assoluta-maggiore
                       move tmp-prg-z-chiave  to save-prg-chiave
                       move giacenza-assoluta 
                         to giacenza-assoluta-maggiore
                    end-if            
                    
                    compute giacenza-fisica = 
                            tmp-prg-z-giacenza - 
                            tmp-prg-z-impegnato

                    if giacenza-fisica > giacenza-maggiore or
                       como-record = spaces
                       move giacenza-fisica to giacenza-maggiore
                       move tmp-prg-z-rec   to como-record
                    end-if

                 end-perform
           end-start.
           if como-record not = spaces
              move como-record to tmp-prg-z-rec
              if tmp-prg-z-giacenza  <= 0
                 move save-prg-chiave to tmp-prg-z-chiave
                 read tmp-progmag-zoom no lock
                 move tmp-prg-z-rec to como-record
              end-if
           end-if.
           close tmp-progmag-zoom.

      ***---
       POSITION-ON-FIRST-RECORD.
           |Mi posiziono sul PRIMO record
           open input tmp-progmag-zoom.
           move low-value to tmp-prg-z-rec.
           start tmp-progmag-zoom key is >= key-des
                 invalid continue
           end-start.
           read tmp-progmag-zoom next end-read.
           close tmp-progmag-zoom. 

      ***---
       FIND-PROGMAG-LISTINO.
           move 1               to num-articoli
           move como-prg-chiave to GiacenzaKey.

      ***---
       UN-SOLO-ARTICOLO-SU-PROGMAG.
           |Se c'è un solo rec. su progmag con quel codice articolo
           |simulo la scelta di progmag da zoom con il rec. in linea
           move GiacenzaKey   to prg-chiave.
           read progmag no  lock invalid continue end-read.
           if not fromAggiungi
              perform CAMBIA-ARTICOLO
           end-if.

      ***---
       CAMBIA-ARTICOLO.
           move prg-cod-articolo to art-codice col-art.
           read articoli no lock invalid continue end-read.
           move art-descrizione to col-des.
           set RigaCambiata to true.
           inquire form1-gd-1, cursor-y in riga
           inquire form1-gd-1(riga, 78-col-num),
                   cell-data in col-num.

           move emto-chiave to emro-chiave-testa.
           move col-num     to emro-riga.
           read EDI-mrordini
                invalid continue
            not invalid
                move col-art to emro-cod-articolo

                move prg-tipo-imballo to imq-codice
                read timbalqta no lock
                     invalid continue
                 not invalid

                     move imq-tipo  to imb-codice
                     read timballi  no lock
                          invalid continue
                      not invalid
                          move imb-descrizione to emro-des-imballo
                     end-read
                                              
                     inquire form1-gd-1(riga, 78-col-qta),
                             cell-data in col-qta
                     move col-qta to como-qta

                     move mb-yes to scelta
                     perform CHECK-QTA-IMBALLO

                     if scelta = mb-yes
                        move riga to event-data-2
                        move 78-ID-form1-gd-1 to control-id
                        modify form1-gd-1(riga, 78-col-art), 
                                cell-data col-art
                        perform CERCA 
                        move col-art to emro-cod-articolo

                        set hid-emro-qtac-ok to true
                        set emro-qtac-ok     to true

                        move como-qta to emro-qta-GESLUX emro-qta
                        compute emro-num-colli = como-qta / imq-qta-imb

                        move prg-peso-utf     to emro-peso-utf
                        move prg-peso-non-utf to emro-peso-non-utf

                        move imq-qta-imb to emro-qta-imballi
                        move prg-chiave  to emro-prg-chiave
                                                     
                        set emro-progressivo-valido     to true
                        set emro-articolo-valido        to true
                        initialize emro-prg-forzato
                                   replacing numeric data by zeroes
                                        alphanumeric data by spaces
                        if si-prg-listino
                           move emro-prg-chiave to emro-prg-forzato
                        end-if
                        accept emro-data-ultima-modifica from 
           century-date
                        accept emro-ora-ultima-modifica  from time
                        move user-codi to emro-utente-ultima-modifica

                        rewrite emro-rec

                        |viene sommato dopo
                        if not ( emro-articolo-valido    and
                                 emro-progressivo-valido and
                                 emro-qta-GESLUX > 0     and 
                                 emro-prz > 0 )
                           subtract 1 from righe-errate
                        end-if

                        perform AGGIUNGI-RIGA
                     end-if    
                end-read
           end-read                                                
           .
      * <TOTEM:END>
       pb-sel-BeforeProcedure.
      * <TOTEM:PARA. pb-sel-BeforeProcedure>
           modify pb-sel, bitmap-number = 2 
           .
      * <TOTEM:END>
       pb-sel-AfterProcedure.
      * <TOTEM:PARA. pb-sel-AfterProcedure>
           modify pb-sel, bitmap-number = 1 
           .
      * <TOTEM:END>
       pb-desel-BeforeProcedure.
      * <TOTEM:PARA. pb-desel-BeforeProcedure>
           modify pb-desel, bitmap-number = 2 
           .
      * <TOTEM:END>
       pb-desel-AfterProcedure.
      * <TOTEM:PARA. pb-desel-AfterProcedure>
           modify pb-desel, bitmap-number = 1 
           .
      * <TOTEM:END>
       gd-tipocli-Ev-Msg-Begin-Entry.
      * <TOTEM:PARA. gd-tipocli-Ev-Msg-Begin-Entry>
           inquire gd-tipocli, entry-reason in como-x.

           set EVENT-ACTION to EVENT-ACTION-FAIL-TERMINATE.
           evaluate como-x
           when X"00"|doppio click
           when X"0D"|invio
           when x"20"|space
                inquire gd-tipocli, CURSOR-Y = riga
                inquire gd-tipocli(riga, 1), hidden-data in hid-col-sel
                if hid-col-sel = 1
                   move 0 to hid-col-sel
                   modify gd-tipocli(riga), row-color = 513
                else
                   move 1 to hid-col-sel
                   modify gd-tipocli(riga), row-color = 480
                end-if
                modify gd-tipocli(riga, 1), hidden-data hid-col-sel
           end-evaluate 
           .
      * <TOTEM:END>
       pb-sel-LinkTo.
      * <TOTEM:PARA. pb-sel-LinkTo>
           inquire gd-tipocli, last-row in tot-righe.
           perform varying riga from 2 by 1 
                     until riga > tot-righe
              move 1 to hid-col-sel
              modify gd-tipocli(riga, 1), hidden-data hid-col-sel
              modify gd-tipocli(riga), row-color = 480
           end-perform 
           .
      * <TOTEM:END>
       pb-desel-LinkTo.
      * <TOTEM:PARA. pb-desel-LinkTo>
           inquire gd-tipocli, last-row in tot-righe.
           perform varying riga from 2 by 1 
                     until riga > tot-righe
              move 0 to hid-col-sel
              modify gd-tipocli(riga, 1), hidden-data hid-col-sel
              modify gd-tipocli(riga), row-color = 513
           end-perform 
           .
      * <TOTEM:END>
       Screen2-Ef-1-BeforeProcedure.
      * <TOTEM:PARA. Screen2-Ef-1-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       Screen2-Ef-1-AfterProcedure.
      * <TOTEM:PARA. Screen2-Ef-1-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       pb-aggiungi-BeforeProcedure.
      * <TOTEM:PARA. pb-aggiungi-BeforeProcedure>
           modify pb-aggiungi, bitmap-number = 2 
           .
      * <TOTEM:END>
       pb-aggiungi-AfterProcedure.
      * <TOTEM:PARA. pb-aggiungi-AfterProcedure>
           modify pb-aggiungi, bitmap-number = 1 
           .
      * <TOTEM:END>
       pb-aggiungi-LinkTo.
      * <TOTEM:PARA. pb-aggiungi-LinkTo>
           set fromAggiungi to true.
           perform ZOOM-SU-PROGMAG. 
           set fromAggiungi to false.
           if stato-zoom = 0               
              modify pb-aggiungi, bitmap-number = 1
              modify form1-gd-1(riga), row-font = Arial10-Occidentale
              initialize gruppo-hidden rec-grid
                         replacing numeric data by zeroes
                              alphanumeric data by spaces  
      
              inquire form1-gd-1, last-row in tot-righe
              inquire form1-gd-1(tot-righe, 78-col-num), 
                      cell-data in emro-riga
              add 1 to emro-riga giving col-num
              modify form1-gd-1, insert-rows = 1
              add 1 to tot-righe giving event-data-2
      
              move prg-cod-articolo to art-codice
              read articoli no lock
      
              move prg-tipo-imballo to imq-codice
              read timbalqta no lock
              move imq-qta-imb to col-qta col-qta-EDI col-qta-GESLUX
      
              move 0    to col-prz-EDI col-prz-GESLUX col-prz
              move "OK" to col-stato-r
      
              inquire ef-evadi-dal, value in col-evadi-dal
      
              move prg-chiave    to HiddenKey              
              move imq-qta-imb   to hid-emro-qta-imballi
              move prg-chiave    to HiddenKeyL HiddenKey        
              move col-evadi-dal to como-data
              perform DATE-TO-FILE
              move como-data to hid-emro-evadi-dal
              set hid-emro-attivo             to true
              set hid-emro-bloccato-prezzo-no to true
              set hid-emro-progressivo-valido to true
              modify form1-gd-1(event-data-2, 1), 
                     hidden-data gruppo-hidden
              modify form1-gd-1(event-data-2, 78-col-num), 
                     cell-data col-num
              modify form1-gd-1(event-data-2, 78-col-art), 
                     cell-data prg-cod-articolo
              modify form1-gd-1(event-data-2, 78-col-des), 
                     cell-data art-descrizione
              modify form1-gd-1(event-data-2, 78-col-imb), 
                     cell-data prg-tipo-imballo  
              modify form1-gd-1(event-data-2, 78-col-qta-EDI), 
                     cell-data col-qta-EDI
              modify form1-gd-1(event-data-2, 78-col-qta-GESLUX), 
                     cell-data col-qta-GESLUX
              modify form1-gd-1(event-data-2, 78-col-qta), 
                     cell-data col-qta
              modify form1-gd-1(event-data-2, 78-col-prz-EDI), 
                     cell-data col-prz-EDI
              modify form1-gd-1(event-data-2, 78-col-prz-GESLUX), 
                     cell-data col-prz-GESLUX
              modify form1-gd-1(event-data-2, 78-col-prz), 
                     cell-data col-prz
              modify form1-gd-1(event-data-2, 78-col-evadi-dal), 
                     cell-data col-evadi-dal
              modify form1-gd-1(event-data-2, 78-col-stato-r), 
                     cell-data col-stato-r
              set hid-emro-progressivo-valido to true
              perform STATO-RIGA
              perform SPOSTAMENTO
              set RigaCambiata to true
              modify form1-gd-1, cursor-y event-data-2, 
                                 cursor-x 78-col-art
              move 78-ID-form1-gd-1 to control-id
              move 4                to accept-control
           end-if.           
           perform CALCOLA-TOTALE 
           .
      * <TOTEM:END>
       ef-prov-d-BeforeProcedure.
      * <TOTEM:PARA. ef-prov-d-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           move 1 to StatusHelp.
           perform STATUS-HELP 
           .
      * <TOTEM:END>
       ef-cap-d-BeforeProcedure.
      * <TOTEM:PARA. ef-cap-d-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           move 1 to StatusHelp.
           perform STATUS-HELP 
           .
      * <TOTEM:END>
       ef-prov-d-AfterProcedure.
      * <TOTEM:PARA. ef-prov-d-AfterProcedure>
              INQUIRE ef-prov-d, VALUE IN des-prov
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-prov-d-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           move 0 to StatusHelp.
           perform STATUS-HELP.
           perform CONTROLLO.

           .
      * <TOTEM:END>

       ef-cap-d-AfterProcedure.
      * <TOTEM:PARA. ef-cap-d-AfterProcedure>
              INQUIRE ef-cap-d, VALUE IN des-cap
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-cap-d-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           move 0 to StatusHelp.
           perform STATUS-HELP.
           perform CONTROLLO.

           .
      * <TOTEM:END>


      *{TOTEM}END

      *{TOTEM}SHOW-MSG
       MESSAGE-FOR-FILEERROR.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
              MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           .

       SHOW-TRANSACTION-ROUTINE.
           IF TOTEM-TRANSACTION-FLAG = SPACES
              IF TRANSACTION-STATUS NOT = 0
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-1
              END-IF
           ELSE
              PERFORM SHOW-MSG-ROUTINE
              IF TRANSACTION-STATUS = 0
                 MOVE "Transazione terminata con Rollback." TO 
           TOTEM-MSG-3
              ELSE
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-3
              END-IF
           END-IF
           .

       SHOW-MSG-ROUTINE.
           MOVE SPACE TO TOTEM-MSG-1 TOTEM-MSG-2 TOTEM-MSG-3
           EVALUATE TOTEM-MSG-ID
               WHEN "10"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Nessun altro dato." TO TOTEM-MSG-2
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "22"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Chiave Duplicata." TO TOTEM-MSG-2
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "23"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Raggiunta fine file." TO TOTEM-MSG-2
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "101"
                    MOVE "Terminare l'applicazione?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "201"
                    MOVE "Aggiungere un nuovo record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "202"
                    MOVE "Aggiornare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "203"
                    MOVE "Cancellare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "204"
                    MOVE "Chiave duplicata." TO TOTEM-MSG-1
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "301"
                    MOVE "Inserimento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "302"
                    MOVE "Aggiornamento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "303"
                    MOVE "Cancellazione avvenuta con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "401"
                    MOVE "Shell non trovata." TO TOTEM-MSG-1
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN OTHER
                    MOVE TEXT-MESSAGE TO TOTEM-MSG-1
                    STRING "FILE:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-3
                    MOVE 0 TO TOTEM-IDX1
                    INSPECT TOTEM-MSG-3 TALLYING TOTEM-IDX1
                       FOR TRAILING SPACE
                    STRING TOTEM-MSG-3(1:TOTEM-MSG-LENGTH - 
           TOTEM-IDX1), 
                       ", FILE STATUS ", PRIMARY-ERROR "," 
                       SECONDARY-ERROR
                    DELIMITED BY SIZE INTO TOTEM-MSG-2
                    MOVE SPACES TO TOTEM-MSG-3
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
           END-EVALUATE
           PERFORM MESSAGE-BOX-ROUTINE
           .

       MESSAGE-BOX-ROUTINE.
           MOVE 1 TO TOTEM-MSG-TEXT-POINTER
           IF TOTEM-MSG-1 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-1 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              STRING TOTEM-MSG-1( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                 DELIMITED BY SIZE
                 INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-2 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-2 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-2( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-3 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-3 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-3( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-TEXT-POINTER = 1
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-TEXT TALLYING TOTEM-MSG-SIZE FOR 
           TRAILING SPACE
                  COMPUTE TOTEM-MSG-TEXT-POINTER = 
           TOTEM-MSG-FULL-LENGTH - TOTEM-MSG-SIZE + 1
           END-IF
           MOVE LOW-VALUES TO TOTEM-MSG-TEXT(TOTEM-MSG-TEXT-POINTER : 1 
           )
           .

       MESSAGE-BOX-DISPLAY.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

      *{TOTEM}END

