      *{TOTEM}PRG-COMMENT
      * distinteb.Cbl
      * distinteb.Cbl is generated by TOTEM
      * This is a generated file. DO NOT modify this file directly.
      *{TOTEM}END
       IDENTIFICATION       DIVISION.
      *{TOTEM}PRGID
       PROGRAM-ID.          distinteb.
       AUTHOR.              ANDREA EVENTI.
       DATE-WRITTEN.        lunedì 2 febbraio 2015 11:45:54.
       REMARKS.
      *{TOTEM}END

       ENVIRONMENT          DIVISION.
       CONFIGURATION        SECTION.
       SPECIAL-NAMES.
      *{TOTEM}SPECIAL-NAME
      * <TOTEM:EPT. INIT:distinteb, INIT:distinteb, SpecialName>
      * <TOTEM:END>
      *{TOTEM}END
      *{TOTEM}ACTIVEX-DEF
      *{TOTEM}END
      *{TOTEM}DECIMAL-POINT
           DECIMAL-POINT IS COMMA.
      *{TOTEM}END

       INPUT-OUTPUT         SECTION.
       FILE-CONTROL.
      *{TOTEM}FILE-CONTROL
           COPY "distinteb.sl".
           COPY "articoli.sl".
           COPY "tmagaz.sl".
           COPY "progmag.sl".
           COPY "timballi.sl".
           COPY "timbalqta.sl".
           COPY "tmp-progmag-zoom.sl".
           COPY "tmarche.sl".
           COPY "timposte.sl".
           COPY "zoom-distinteb.sl".
      *{TOTEM}END
       DATA                 DIVISION.
       FILE                 SECTION.
      *{TOTEM}FILE
           COPY "distinteb.fd".
           COPY "articoli.fd".
           COPY "tmagaz.fd".
           COPY "progmag.fd".
           COPY "timballi.fd".
           COPY "timbalqta.fd".
           COPY "tmp-progmag-zoom.fd".
           COPY "tmarche.fd".
           COPY "timposte.fd".
           COPY "zoom-distinteb.fd".
      *{TOTEM}END

       WORKING-STORAGE      SECTION.
      *{TOTEM}ACU-DEF
               COPY "acugui.def".
               COPY "acucobol.def".
               COPY "crtvars.def".
               COPY "showmsg.def".
               COPY "totem.def".
               COPY "F:\lubex\geslux\Copylib\standard.def".
      *{TOTEM}END

      *{TOTEM}COPY-WORKING
      * Key Status
       77 Key-Status IS SPECIAL-NAMES CRT STATUS PIC 9(5) VALUE 0.
          88 Enter-Pushed VALUE 13.
          88 Exit-Pushed VALUE 27.
          88 Message-Received VALUE 95.
          88 Event-Occurred VALUE 96.
          88 Screen-No-Input-Field VALUE 97.
          88 Screen-Time-Out VALUE 99.
      * Properties & User defined Working Stoarge
       78 titolo VALUE IS "Geslux - Gestione Distinta Base". 
           COPY  "LINK-WPROGMAG.DEF".
           COPY  "LINK-INSARTICOLI.DEF".
           COPY  "COSTO-MEDIO.DEF".
           COPY  "IMPOSTE.DEF".
       77 Form1-Tb-1-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 msg-err          PIC  x(19).
       77 qta-arrotondata  PIC  9(8).
       77 decimali         PIC  9(3).
       77 CountChar        PIC  9(3).
       77 ext-file EXTERNAL   PIC  x(256).
       77 como-articolo    PIC  9(6).
       77 como-id          PIC  9(5).
       77 data-oggi        PIC  9(8).
       77 descr-articolo   PIC  x(100).
       77 imballi-ed       PIC  zz.zz9.
       77 hid-cod-doganale PIC  9(8).
       77 spunta-bmp
                  USAGE IS HANDLE OF BITMAP.
       77 EntryReason      PIC  x.
       77 toolbar-bmp      PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 E-ESCI           PIC  9
                  VALUE IS 1.
       77 E-NUOVO          PIC  9
                  VALUE IS 1.
       77 E-CANCELLA       PIC  9
                  VALUE IS 1.
       77 E-SALVA          PIC  9
                  VALUE IS 1.
       77 E-ANTEPRIMA      PIC  9
                  VALUE IS 0.
       77 E-MODIFICA       PIC  9
                  VALUE IS 1.
       77 E-STAMPA         PIC  9
                  VALUE IS 0.
       77 E-CERCA          PIC  9
                  VALUE IS 0.
       77 E-SELEZIONA      PIC  9
                  VALUE IS 1.
       77 Small-Font
                  USAGE IS HANDLE OF FONT SMALL-FONT.
       77 Default-Font
                  USAGE IS HANDLE OF FONT DEFAULT-FONT.
       77 Screen1-St-1-Handle
                  USAGE IS HANDLE OF STATUS-BAR.
       77 Form1-St-1-Handle
                  USAGE IS HANDLE OF STATUS-BAR.
       77 form1-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 como-qta         PIC  9(8)v9(3).
       77 AUTO-ID          PIC  9(6)
                  VALUE IS 0,00.
       77 old-oneri        PIC  s9(15)v99.
       77 old-utf          PIC  s9(15)v99.
       77 old-non-utf      PIC  s9(15)v99.
       77 old-mp           PIC  s9(15)v99.
       77 old-qta          PIC  9(8)v999.
       77 old-somma        PIC  9.
       77 col-oneri-num    PIC  s9(15)v99.
       77 somma-utf        PIC  9(15)v999.
       77 como-utf         PIC  9(15)v999.
       77 somma-oneri      PIC  9(15)v999.
       77 como-oneri       PIC  9(15)v999.
       77 somma-non-utf    PIC  9(15)v999.
       77 como-non-utf     PIC  9(15)v999.
       77 somma-prezzo     PIC  9(15)v999.
       77 como-prezzo      PIC  9(15)v999.
       77 num-articoli     PIC  9(3).
       77 win-lines        PIC  9(3)v99.
       77 como-peso        PIC  9(9)v9(3).
       77 somma-peso       PIC  9(9)v9(3).
       77 peso-totale      PIC  9(9)v9(3).
       77 BitmapNumAzzera  PIC  9.
       77 BitmapNumGenera  PIC  9.
       77 riga-edit        PIC  z9.
       01 FILLER           PIC  9
                  VALUE IS 0.
           88 FromFinishEntryCancPressed VALUE IS 1    WHEN SET TO 
           FALSE  0. 
       01 FILLER           PIC  9.
           88 FromFinishEntry VALUE IS 1    WHEN SET TO FALSE  0. 
       78 78-WinLinesWithout VALUE IS 34,00. 
       78 78-WinLinesWith VALUE IS 43,62. 
       01 FILLER.
           05 articolo         PIC  9(6).
           05 magazzino        PIC  x(3).
           05 imballo          PIC  x(3).
           05 peso PIC  9(5)V9(3).
       01 SaveProgmagKey.
           05 SaveArticolo     PIC  9(6).
           05 SaveMagazzino    PIC  x(3).
           05 SaveImballo      PIC  x(3).
           05 SavePeso         PIC  9(5)V9(3).
       77 SaveUtf          PIC  9(5)V9(3).
       77 SaveNonUtf       PIC  9(5)V9(3).
       01 rec-grid.
           05 col-idx          PIC  99.
           05 col-art          PIC  z(6)
                      BLANK WHEN ZERO.
           05 col-mag          PIC  x(3).
           05 col-imb          PIC  x(3).
           05 col-peso         PIC  zz9,999
                      BLANK WHEN ZERO.
           05 col-des          PIC  x(100).
           05 col-utf          PIC  zz9,999
                      BLANK WHEN ZERO.
           05 col-non-utf      PIC  zz9,999
                      BLANK WHEN ZERO.
           05 col-mp           PIC  ----.---.---.--9,99
                      BLANK WHEN ZERO.
           05 col-qta          PIC  zz.zzz.zz9,999
                      BLANK WHEN ZERO.
           05 col-oneri        PIC  ----.---.---.--9,99
                      BLANK WHEN ZERO.
       01 hid-somma        PIC  9.
           88 hid-SiSomma VALUE IS 1. 
           88 hid-NoSomma VALUE IS 0. 
       77 STATUS-articoli  PIC  X(2).
           88 Valid-STATUS-articoli VALUE IS "00" THRU "09". 
       77 STATUS-distinteb PIC  X(2).
           88 Valid-STATUS-distinteb VALUE IS "00" THRU "09". 
       77 STATUS-tmagaz    PIC  X(2).
           88 Valid-STATUS-tmagaz VALUE IS "00" THRU "09". 
       01 OLD-dis-rec.
           05 OLD-dis-chiave.
               10 OLD-dis-codice   PIC  9(5).
           05 OLD-dis-dati.
               10 OLD-dis-chiave-progmag.
                   15 OLD-dis-articolo-finale      PIC  9(6).
                   15 OLD-dis-magazzino-finale     PIC  x(3).
                   15 OLD-dis-imballo-finale       PIC  x(3).
                   15 OLD-dis-peso-finale          PIC  9(5)V9(3).
               10 OLD-dis-peso-utf PIC  9(5)V9(3).
               10 OLD-dis-peso-non-utf         PIC  9(5)V9(3).
               10 OLD-dis-prezzo   PIC  s9(12)v9(2).
               10 OLD-dis-dettaglio.
                   15 OLD-dis-riga
                              OCCURS 10 TIMES.
                       20 OLD-dis-chiave-progmag-el.
                           25 OLD-dis-articolo PIC  9(6).
                           25 OLD-dis-magazzino            PIC  x(3).
      *(( XFD NAME = dis-imballo_1 ))
                           25 OLD-dis-imballo  PIC  x(3).
      *(( XFD NAME = dis-peso_1 ))
                           25 OLD-dis-peso     PIC  9(5)V9(3).
                       20 OLD-dis-qta      PIC  9(8)v999.
                       20 OLD-dis-oneri    PIC  9(12)v9(2).
                       20 OLD-dis-somma-peso           PIC  9.
                           88 OLD-dis-si-somma VALUE IS 1. 
                           88 OLD-dis-no-somma VALUE IS 0. 
               10 OLD-dis-dati-comuni.
                   15 OLD-dis-data-creazione       PIC  9(8).
                   15 OLD-dis-ora-creazione        PIC  9(8).
                   15 OLD-dis-utente-creazione     PIC  X(10).
                   15 OLD-dis-data-ultima-modifica PIC  9(8).
                   15 OLD-dis-ora-ultima-modifica  PIC  9(8).
                   15 OLD-dis-utente-ultima-modifica           PIC  
           X(10).
               10 OLD-dis-vuoti.
                   15 OLD-dis-num-vuoto-1          PIC  9(15).
                   15 OLD-dis-num-vuoto-2          PIC  9(15).
                   15 OLD-dis-num-vuoto-3          PIC  9(15).
                   15 OLD-dis-alfa-vuoto-1         PIC  X(20).
                   15 OLD-dis-alfa-vuoto-2         PIC  X(20).
                   15 OLD-dis-alfa-vuoto-3         PIC  X(20).
       77 ef-oneri-buf     PIC  ----.---.---.--9,99.
       77 ef-tot-prezzo-buf            PIC  ----.---.---.--9,99.
       77 ef-tot-utf-buf   PIC  zzz.zz9,999.
       77 ef-tot-non-utf-buf           PIC  zzz.zz9,999.
       77 ef-tot-oneri-buf PIC  zzz.zzz.zzz.zz9,99.
       77 GENERA-BMP       PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 v-grid           PIC  9
                  VALUE IS 1.
       77 distinteb-bmp    PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 STATUS-progmag   PIC  X(2).
           88 Valid-STATUS-progmag VALUE IS "00" THRU "09". 
       77 STATUS-timballi  PIC  X(2).
           88 Valid-STATUS-timballi VALUE IS "00" THRU "09". 
       77 STATUS-timbalqta PIC  X(2).
           88 Valid-STATUS-timbalqta VALUE IS "00" THRU "09". 
       77 E-AZZERA         PIC  9
                  VALUE IS 0.
       77 e-genera         PIC  9
                  VALUE IS 0.
       01 save-key.
           05 save-codice      PIC  9(5).
       77 v-riga           PIC  9
                  VALUE IS 0.
       77 ef-oneri-2-buf   PIC  ----.---.---.--9,99.
       77 lab-des-buf      PIC  x(100).
       77 lab-des-2-buf    PIC  x(100).
       77 v-screen         PIC  9
                  VALUE IS 0.
       77 annulla-73x21-bmp            PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 ritorna-bmp      PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 v-esc            PIC  9
                  VALUE IS 0.
       01 FILLER           PIC  9.
           88 record-ok VALUE IS 0    WHEN SET TO FALSE  0. 
       01 FILLER           PIC  9.
           88 filtro-articoli VALUE IS 1    WHEN SET TO FALSE  0. 
       77 imballo-descrizione          PIC  x(100).
       77 como-giacenza    PIC  9(8).
       77 como-record      PIC  x(32000).
       01 GiacenzaKey.
           10 gia-cod-articolo PIC  9(6).
           10 gia-cod-magazzino            PIC  X(3).
           10 gia-tipo-imballo PIC  X(3).
           10 gia-peso         PIC  9(5)V9(3).
       01 HiddenKey.
           10 hid-cod-articolo PIC  9(6).
           10 hid-cod-magazzino            PIC  X(3).
           10 hid-tipo-imballo PIC  X(3).
           10 hid-peso         PIC  9(5)V9(3).
       77 path-tmp-progmag-zoom        PIC  X(256).
       77 STATUS-tmp-progmag-zoom      PIC  X(2).
           88 Valid-STATUS-tmp-progmag-zoom VALUE IS "00" THRU "09". 
       77 STATUS-timposte  PIC  X(2).
           88 Valid-STATUS-timposte VALUE IS "00" THRU "09". 
       77 STATUS-tmarche   PIC  X(2).
           88 Valid-STATUS-tmarche VALUE IS "00" THRU "09". 
       77 path-zoom-distinteb          PIC  X(256).
       77 STATUS-zoom-distinteb        PIC  X(2).
           88 Valid-STATUS-zoom-distinteb VALUE IS "00" THRU "09". 

      ***********************************************************
      *   Code Gen's Buffer                                     *
      ***********************************************************
       77 STATUS-Form1-FLAG-REFRESH PIC  9.
          88 Form1-FLAG-REFRESH  VALUE 1 FALSE 0. 
      * DATA CONTROL BUFFER
       01 Form1-BUF.
      * Data.Entry-Field
              05 ef-art-BUF PIC z(6).
              05 ef-art-VALUEBUF PIC 9(6).
      * Data.Entry-Field
              05 ef-art-2-BUF PIC z(6).
              05 ef-art-2-VALUEBUF PIC 9(6).
      * Data.Entry-Field
              05 ef-mag-2-BUF PIC X(3).
      * Data.Entry-Field
              05 ef-imb-2-BUF PIC X(3).
      * Data.Entry-Field
              05 ef-mag-BUF PIC X(3).
      * Data.Entry-Field
              05 ef-imb-BUF PIC X(3).
      * Data.Entry-Field
              05 ef-peso-BUF PIC zz9,999.
      * Data.Entry-Field
              05 ef-peso-utf-BUF PIC zz9,999.
      * Data.Entry-Field
              05 ef-peso-non-utf-BUF PIC zz9,999.
      * Data.Entry-Field
              05 ef-mp-BUF PIC ----.---.---.--9,99.
      * Data.Entry-Field
              05 ef-peso-2-BUF PIC zz9,999.
      * Data.Entry-Field
              05 ef-peso-utf-2-BUF PIC zz9,999.
      * Data.Entry-Field
              05 ef-peso-non-utf-2-BUF PIC zz9,999.
      * Data.Entry-Field
              05 ef-mp-2-BUF PIC ----.---.---.--9,99.
      * Data.Label
              05 lab-numero-BUF PIC z(5).

       77 TMP-Form1-KEY1-ORDER  PIC X VALUE "A".
       77 TMP-Form1-distinteb-RESTOREBUF  PIC X(672).
       77 TMP-Form1-KEYIS  PIC 9(3) VALUE 1.
       77 Form1-MULKEY-TMPBUF   PIC X(672).
       77 TMP-DataSet1-distinteb-BUF     PIC X(672).
       77 TMP-DataSet1-articoli-BUF     PIC X(3669).
       77 TMP-DataSet1-tmagaz-BUF     PIC X(212).
       77 TMP-DataSet1-progmag-BUF     PIC X(1090).
       77 TMP-DataSet1-timballi-BUF     PIC X(210).
       77 TMP-DataSet1-timbalqta-BUF     PIC X(167).
       77 TMP-DataSet1-tmp-progmag-zoom-BUF     PIC X(195).
       77 TMP-DataSet1-tmarche-BUF     PIC X(217).
       77 TMP-DataSet1-timposte-BUF     PIC X(277).
       77 TMP-DataSet1-zoom-distinteb-BUF     PIC X(197).
      * VARIABLES FOR RECORD LENGTH.
       77  TotemFdSlRecordClearOffset   PIC 9(5) COMP-4.
       77  TotemFdSlRecordLength        PIC 9(5) COMP-4.
      * FILE'S LOCK MODE FLAG
       77 DataSet1-distinteb-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-distinteb-LOCK  VALUE "Y".
       77 DataSet1-KEYIS   PIC 9(3) VALUE 1.
       77 DataSet1-distinteb-KEY1-ORDER  PIC X VALUE "A".
          88 DataSet1-distinteb-KEY1-Asc  VALUE "A".
          88 DataSet1-distinteb-KEY1-Desc VALUE "D".
       77 DataSet1-articoli-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-articoli-LOCK  VALUE "Y".
       77 DataSet1-articoli-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-articoli-KEY-Asc  VALUE "A".
          88 DataSet1-articoli-KEY-Desc VALUE "D".
       77 DataSet1-tmagaz-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tmagaz-LOCK  VALUE "Y".
       77 DataSet1-tmagaz-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tmagaz-KEY-Asc  VALUE "A".
          88 DataSet1-tmagaz-KEY-Desc VALUE "D".
       77 DataSet1-progmag-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-progmag-LOCK  VALUE "Y".
       77 DataSet1-progmag-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-progmag-KEY-Asc  VALUE "A".
          88 DataSet1-progmag-KEY-Desc VALUE "D".
       77 DataSet1-timballi-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-timballi-LOCK  VALUE "Y".
       77 DataSet1-timballi-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-timballi-KEY-Asc  VALUE "A".
          88 DataSet1-timballi-KEY-Desc VALUE "D".
       77 DataSet1-timbalqta-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-timbalqta-LOCK  VALUE "Y".
       77 DataSet1-timbalqta-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-timbalqta-KEY-Asc  VALUE "A".
          88 DataSet1-timbalqta-KEY-Desc VALUE "D".
       77 DataSet1-tmp-progmag-zoom-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tmp-progmag-zoom-LOCK  VALUE "Y".
       77 DataSet1-tmp-progmag-zoom-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tmp-progmag-zoom-KEY-Asc  VALUE "A".
          88 DataSet1-tmp-progmag-zoom-KEY-Desc VALUE "D".
       77 DataSet1-tmarche-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tmarche-LOCK  VALUE "Y".
       77 DataSet1-tmarche-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tmarche-KEY-Asc  VALUE "A".
          88 DataSet1-tmarche-KEY-Desc VALUE "D".
       77 DataSet1-timposte-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-timposte-LOCK  VALUE "Y".
       77 DataSet1-timposte-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-timposte-KEY-Asc  VALUE "A".
          88 DataSet1-timposte-KEY-Desc VALUE "D".
       77 DataSet1-zoom-distinteb-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-zoom-distinteb-LOCK  VALUE "Y".
       77 DataSet1-zoom-distinteb-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-zoom-distinteb-KEY-Asc  VALUE "A".
          88 DataSet1-zoom-distinteb-KEY-Desc VALUE "D".

       77 distinteb-k-articolo-SPLITBUF  PIC X(12).
       77 distinteb-k-progmag-SPLITBUF  PIC X(21).
       77 articoli-art-k1-SPLITBUF  PIC X(51).
       77 progmag-key01-SPLITBUF  PIC X(21).
       77 tmp-progmag-zoom-key-des-SPLITBUF  PIC X(64).
       77 tmp-progmag-zoom-key-art-SPLITBUF  PIC X(7).
       77 zoom-distinteb-k-des-SPLITBUF  PIC X(56).
      * FOR SPLIT KEY BUFFER
       77 DataSet1-tmp-progmag-zoom-SPLIT-BUF1   PIC X(64).


      *{TOTEM}END

      *{TOTEM}ID-LOGICI
      ***** Elenco ID Logici *****
       78  78-ID-form1-Gd-1 VALUE 5001.
       78  78-ID-ef-art VALUE 5002.
       78  78-ID-ef-art-2 VALUE 5003.
       78  78-ID-ef-mag-2 VALUE 5004.
       78  78-ID-ef-imb-2 VALUE 5005.
       78  78-ID-ef-mag VALUE 5006.
       78  78-ID-ef-imb VALUE 5007.
       78  78-ID-ef-peso VALUE 5008.
       78  78-ID-ef-peso-utf VALUE 5009.
       78  78-ID-ef-peso-non-utf VALUE 5010.
       78  78-ID-ef-mp VALUE 5011.
       78  78-ID-ef-oneri VALUE 5012.
       78  78-ID-ef-peso-2 VALUE 5013.
       78  78-ID-ef-peso-utf-2 VALUE 5014.
       78  78-ID-ef-peso-non-utf-2 VALUE 5015.
       78  78-ID-ef-mp-2 VALUE 5016.
       78  78-ID-ef-oneri-2 VALUE 5017.
      ***** Fine ID Logici *****
      *{TOTEM}END

       LINKAGE          SECTION.
      *{TOTEM}LINKAGE
           COPY  "COMMON-LINKAGE.DEF".

      *{TOTEM}END

       SCREEN           SECTION.
      *{TOTEM}COPY-SCREEN
      * FORM
       01 
           Form1, 
           AFTER PROCEDURE Form1-AfterProcedure,
           BEFORE PROCEDURE Form1-BeforeProcedure,
           .

      * GRID
       05
           form1-Gd-1, 
           Grid, 
           COL 2,83, 
           LINE 4,00,
           LINES 23,00 ,
           SIZE 163,33 ,
           BOXED,
           CENTERED-HEADINGS,
           DATA-COLUMNS (1, 3, 9, 12, 15, 22, 62, 69, 76, 95, 105, 124),
           ALIGNMENT ("C", "R", "C", "C", "R", "U", "R", "R", "R", "R", 
           "R", "C"),
           SEPARATION (5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5),
           DATA-TYPES ("X", "9(6)", "U(3)", "U(3)", "9(7)", "x(40)", "9(
      -    "7)", "9(7)", "9(19)", "9(10)", "9(19)", "X"),
           NUM-COL-HEADINGS 1,
           COLUMN-HEADINGS,
           CURSOR-FRAME-WIDTH 2,
           DIVIDER-COLOR 1,
           HEADING-COLOR 144,
           HEADING-DIVIDER-COLOR 1,
           ID IS 78-ID-form1-Gd-1,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           NUM-ROWS 11,
           ROW-HEADINGS,
           TILED-HEADINGS,
           VIRTUAL-WIDTH 163,
           VPADDING 100,
           EVENT PROCEDURE Screen1-Gd-1-Event-Proc,
           .

      * PUSH BUTTON
       05
           pb-genera, 
           Push-Button, 
           COL 65,67, 
           LINE 30,23,
           LINES 29,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE DISTINTEB-BMP,
           UNFRAMED,
           SQUARE,
           ENABLED e-genera,
           EXCEPTION-VALUE 1000,
           FLAT,
           ID IS 73,
           SELF-ACT,
           TITLE "&Genera",
           VISIBLE v-grid,
           BITMAP-NUMBER BitmapNumGenera
           AFTER PROCEDURE pb-genera-AfterProcedure, 
           BEFORE PROCEDURE pb-genera-BeforeProcedure, 
           .

      * PUSH BUTTON
       05
           pb-azzera, 
           Push-Button, 
           COL 82,33, 
           LINE 30,23,
           LINES 29,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE DISTINTEB-BMP,
           UNFRAMED,
           SQUARE,
           ENABLED E-AZZERA,
           EXCEPTION-VALUE 1001,
           FLAT,
           ID IS 74,
           SELF-ACT,
           TITLE "&Azzera",
           VISIBLE v-grid,
           BITMAP-NUMBER BitmapNumAzzera
           AFTER PROCEDURE pb-azzera-AfterProcedure, 
           BEFORE PROCEDURE pb-azzera-BeforeProcedure, 
           .

      * ENTRY FIELD
       05
           ef-art, 
           Entry-Field, 
           COL 3,00, 
           LINE 36,92,
           LINES 1,31 ,
           SIZE 7,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 78-ID-ef-art,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 6,
           VALUE ef-art-BUF,
           .

      * ENTRY FIELD
       05
           ef-art-2, 
           Entry-Field, 
           COL 3,00, 
           LINE 39,92,
           LINES 1,31 ,
           SIZE 7,00 ,
           BOXED,
           UPPER,
           COLOR IS 513,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 78-ID-ef-art-2,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 6,
           VALUE ef-art-2-BUF,
           VISIBLE v-riga,
           .

      * ENTRY FIELD
       05
           ef-mag-2, 
           Entry-Field, 
           COL 63,00, 
           LINE 39,92,
           LINES 1,31 ,
           SIZE 6,00 ,
           BOXED,
           UPPER,
           COLOR IS 513,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 78-ID-ef-mag-2,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 3,
           VALUE ef-mag-2-BUF,
           VISIBLE v-riga,
           .

      * ENTRY FIELD
       05
           ef-imb-2, 
           Entry-Field, 
           COL 73,00, 
           LINE 39,92,
           LINES 1,31 ,
           SIZE 6,00 ,
           BOXED,
           UPPER,
           COLOR IS 513,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 78-ID-ef-imb-2,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 3,
           VALUE ef-imb-2-BUF,
           VISIBLE v-riga,
           .

      * PUSH BUTTON
       05
           pb-ritorna, 
           Push-Button, 
           COL 2,17, 
           LINE 41,46,
           LINES 16,00 ,
           SIZE 55,00 ,
           BITMAP-HANDLE RITORNA-BMP,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 1003,
           FLAT,
           FONT IS Small-Font,
           ID IS 41,
           SELF-ACT,
           TITLE "&Ritorna",
           VISIBLE v-riga,
           AFTER PROCEDURE pb-ritorna-AfterProcedure, 
           BEFORE PROCEDURE pb-ritorna-BeforeProcedure, 
           .

      * ENTRY FIELD
       05
           ef-mag, 
           Entry-Field, 
           COL 63,00, 
           LINE 36,92,
           LINES 1,31 ,
           SIZE 6,00 ,
           BOXED,
           COLOR IS 33281,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 78-ID-ef-mag,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 3,
           READ-ONLY,
           VALUE ef-mag-BUF,
           .

      * ENTRY FIELD
       05
           ef-imb, 
           Entry-Field, 
           COL 73,00, 
           LINE 36,92,
           LINES 1,31 ,
           SIZE 6,00 ,
           BOXED,
           COLOR IS 33281,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 78-ID-ef-imb,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 3,
           READ-ONLY,
           VALUE ef-imb-BUF,
           .

      * ENTRY FIELD
       05
           ef-peso, 
           Entry-Field, 
           COL 82,00, 
           LINE 36,92,
           LINES 1,31 ,
           SIZE 11,00 ,
           BOXED,
           COLOR IS 33281,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 78-ID-ef-peso,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 7,
           READ-ONLY,
           VALUE ef-peso-BUF,
           .
      * ENTRY FIELD
       05
           ef-peso-utf, 
           Entry-Field, 
           COL 95,00, 
           LINE 36,92,
           LINES 1,31 ,
           SIZE 11,00 ,
           BOXED,
           COLOR IS 33281,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 78-ID-ef-peso-utf,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 7,
           READ-ONLY,
           VALUE ef-peso-utf-BUF,
           .
      * ENTRY FIELD
       05
           ef-peso-non-utf, 
           Entry-Field, 
           COL 108,00, 
           LINE 36,92,
           LINES 1,31 ,
           SIZE 11,00 ,
           BOXED,
           COLOR IS 33281,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 78-ID-ef-peso-non-utf,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 7,
           READ-ONLY,
           VALUE ef-peso-non-utf-BUF,
           .
      * ENTRY FIELD
       05
           ef-mp, 
           Entry-Field, 
           COL 121,00, 
           LINE 36,92,
           LINES 1,31 ,
           SIZE 18,00 ,
           BOXED,
           COLOR IS 33281,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 78-ID-ef-mp,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 16,
           READ-ONLY,
           VALUE ef-mp-BUF,
           .

      * ENTRY FIELD
       05
           ef-oneri, 
           Entry-Field, 
           COL 140,17, 
           LINE 36,92,
           LINES 1,31 ,
           SIZE 18,00 ,
           BOXED,
           COLOR IS 33281,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 78-ID-ef-oneri,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           READ-ONLY,
           VALUE ef-oneri-buf,
           AFTER PROCEDURE Screen1-Ef-1-AfterProcedure, 
           .

      * ENTRY FIELD
       05
           ef-peso-2, 
           Entry-Field, 
           COL 82,00, 
           LINE 39,92,
           LINES 1,31 ,
           SIZE 11,00 ,
           BOXED,
           COLOR IS 33281,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 78-ID-ef-peso-2,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 7,
           VALUE ef-peso-2-BUF,
           VISIBLE v-riga,
           .

      * ENTRY FIELD
       05
           ef-peso-utf-2, 
           Entry-Field, 
           COL 95,00, 
           LINE 39,92,
           LINES 1,31 ,
           SIZE 11,00 ,
           BOXED,
           COLOR IS 33281,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 78-ID-ef-peso-utf-2,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 7,
           VALUE ef-peso-utf-2-BUF,
           VISIBLE v-riga,
           .
      * ENTRY FIELD
       05
           ef-peso-non-utf-2, 
           Entry-Field, 
           COL 108,00, 
           LINE 39,92,
           LINES 1,31 ,
           SIZE 11,00 ,
           BOXED,
           COLOR IS 33281,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 78-ID-ef-peso-non-utf-2,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 7,
           VALUE ef-peso-non-utf-2-BUF,
           VISIBLE v-riga,
           .
      * ENTRY FIELD
       05
           ef-mp-2, 
           Entry-Field, 
           COL 121,00, 
           LINE 39,92,
           LINES 1,31 ,
           SIZE 18,00 ,
           BOXED,
           COLOR IS 33281,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 78-ID-ef-mp-2,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 16,
           VALUE ef-mp-2-BUF,
           VISIBLE v-riga,
           .
      * ENTRY FIELD
       05
           ef-oneri-2, 
           Entry-Field, 
           COL 140,17, 
           LINE 39,92,
           LINES 1,31 ,
           SIZE 18,00 ,
           BOXED,
           COLOR IS 33281,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 78-ID-ef-oneri-2,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           VALUE ef-oneri-2-buf,
           VISIBLE v-riga,
           AFTER PROCEDURE Screen1-Ef-1-AfterProcedure, 
           .

      * LABEL
       05
           Screen1-Custom1-1, 
           Label, 
           COL 64,90, 
           LINE 1,00,
           LINES 0,46 ,
           SIZE 4,00 ,
           ID IS 18,
           TRANSPARENT,
           TITLE "CUSTOM CONTROL",
           VISIBLE v-custom,
           .

      * LABEL
       05
           Screen1-blockpgm-2, 
           Label, 
           COL 71,17, 
           LINE 1,00,
           LINES 0,69 ,
           SIZE 2,33 ,
           ID IS 21,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "BlockPgm",
           VISIBLE v-custom,
           .

      * LABEL
       05
           Screen1-La-1, 
           Label, 
           COL 2,83, 
           LINE 2,00,
           LINES 1,31 ,
           SIZE 8,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 1,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Distinta n.",
           .

      * DB_LABEL
       05
           lab-numero, 
           Label, 
           COL 12,00, 
           LINE 2,00,
           LINES 1,31 ,
           SIZE 7,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 2,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-numero-BUF,
           RIGHT,
           TRANSPARENT,
           .

      * LABEL
       05
           Screen1-La-2, 
           Label, 
           COL 3,00, 
           LINE 28,00,
           LINES 1,54 ,
           SIZE 27,17 ,
           COLOR IS 32773,
           FONT IS Small-Font,
           ID IS 3,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "TOTALI:",
           .

      * ENTRY FIELD
       05
           ef-tot-utf, 
           Entry-Field, 
           COL 87,67, 
           LINE 28,00,
           LINES 1,54 ,
           SIZE 10,33 ,
           BOXED,
           COLOR IS 32773,
           FONT IS Small-Font,
           ID IS 4,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           READ-ONLY,
           VALUE ef-tot-utf-buf,
           AFTER PROCEDURE Screen1-Ef-1-AfterProcedure, 
           BEFORE PROCEDURE Screen1-Ef-1-BeforeProcedure, 
           .

      * ENTRY FIELD
       05
           ef-tot-non-utf, 
           Entry-Field, 
           COL 97,83, 
           LINE 28,00,
           LINES 1,54 ,
           SIZE 10,33 ,
           BOXED,
           COLOR IS 32773,
           FONT IS Small-Font,
           ID IS 5,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           READ-ONLY,
           VALUE ef-tot-non-utf-buf,
           AFTER PROCEDURE Screen1-Ef-1-AfterProcedure, 
           BEFORE PROCEDURE Screen1-Ef-1-BeforeProcedure, 
           .

      * ENTRY FIELD
       05
           ef-tot-prezzo, 
           Entry-Field, 
           COL 107,83, 
           LINE 28,00,
           LINES 1,54 ,
           SIZE 20,33 ,
           BOXED,
           COLOR IS 32773,
           FONT IS Small-Font,
           ID IS 6,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           READ-ONLY,
           VALUE ef-tot-prezzo-buf,
           AFTER PROCEDURE Screen1-Ef-1-AfterProcedure, 
           BEFORE PROCEDURE Screen1-Ef-1-BeforeProcedure, 
           .

      * ENTRY FIELD
       05
           ef-tot-oneri, 
           Entry-Field, 
           COL 138,00, 
           LINE 28,00,
           LINES 1,54 ,
           SIZE 20,17 ,
           BOXED,
           COLOR IS 32773,
           FONT IS Small-Font,
           ID IS 7,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           READ-ONLY,
           VALUE ef-tot-oneri-buf,
           AFTER PROCEDURE Screen1-Ef-1-AfterProcedure, 
           BEFORE PROCEDURE Screen1-Ef-1-BeforeProcedure, 
           .

      * LABEL
       05
           Screen1-La-3, 
           Label, 
           COL 3,00, 
           LINE 34,92,
           LINES 1,31 ,
           SIZE 7,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 8,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Articolo",
           .

      * LABEL
       05
           Screen1-La-4, 
           Label, 
           COL 61,00, 
           LINE 34,92,
           LINES 1,31 ,
           SIZE 10,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 10,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Magazzino",
           .

      * LABEL
       05
           Screen1-La-5, 
           Label, 
           COL 73,00, 
           LINE 34,92,
           LINES 1,31 ,
           SIZE 6,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 12,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Imballo",
           .

      * LABEL
       05
           Screen1-La-6, 
           Label, 
           COL 82,00, 
           LINE 34,92,
           LINES 1,31 ,
           SIZE 11,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 14,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Peso Totale",
           .

      * LABEL
       05
           Screen1-La-7, 
           Label, 
           COL 95,00, 
           LINE 34,92,
           LINES 1,31 ,
           SIZE 11,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 16,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Totale UTF",
           .

      * LABEL
       05
           Screen1-La-8, 
           Label, 
           COL 108,00, 
           LINE 34,92,
           LINES 1,31 ,
           SIZE 11,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 19,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Totale Esente",
           .

      * LABEL
       05
           Screen1-La-9, 
           Label, 
           COL 121,00, 
           LINE 34,92,
           LINES 1,31 ,
           SIZE 18,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 22,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Prezzo MP",
           .

      * LABEL
       05
           lab-des, 
           Label, 
           COL 11,00, 
           LINE 36,77,
           LINES 2,00 ,
           SIZE 48,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 24,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-des-buf,
           .

      * LABEL
       05
           Screen1-La-11, 
           Label, 
           COL 140,17, 
           LINE 34,92,
           LINES 1,31 ,
           SIZE 18,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 25,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Oneri accessori x UM",
           .

      * LABEL
       05
           lab-des-2, 
           Label, 
           COL 11,00, 
           LINE 39,77,
           LINES 2,00 ,
           SIZE 48,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 35,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-des-2-buf,
           VISIBLE v-riga,
           .

      * BAR
       05
           Screen1-Br-1, 
           Bar,
           COL 1,00, 
           LINE 33,54,
           SIZE 167,50 ,
           ID IS 36,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           COLORS (8, 8),
           SHADING (-1, 1),
           WIDTH 2,
           .

      * BAR
       05
           Screen1-Br-1a, 
           Bar,
           COL 1,00, 
           LINE 34,00,
           SIZE 167,50 ,
           ID IS 37,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           COLORS (8, 8),
           SHADING (-1, 1),
           WIDTH 2,
           .

      * BAR
       05
           Screen1-Br-1aa, 
           Bar,
           COL 1,00, 
           LINE 39,00,
           SIZE 167,50 ,
           ID IS 38,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           COLORS (8, 8),
           SHADING (-1, 1),
           WIDTH 2,
           .

      * LABEL
       05
           Screen1-La-3a, 
           Label, 
           COL 11,00, 
           LINE 34,92,
           LINES 1,31 ,
           SIZE 48,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 39,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Descrizione",
           .

      * LABEL
       05
           lab-esc, 
           Label, 
           COL 112,50, 
           LINE 41,77,
           LINES 1,00 ,
           SIZE 48,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 40,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Premere [Esc] per ritornare all'inserimento dei compon
      -    "enti ...",
           VISIBLE v-esc,
           .

      * TOOLBAR
       01
           Form1-Tb-1,
           .    

      * PUSH BUTTON
       05
           TOOL-ESCI, 
           Push-Button, 
           COL 1,00, 
           LINE 1,15,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           ENABLED E-ESCI,
           EXCEPTION-VALUE 27,
           FLAT,
           ID IS 72,
           SELF-ACT,
           ESCAPE-BUTTON,
           TITLE "Esci (Esc)",
           .

      * PUSH BUTTON
       05
           TOOL-NUOVO, 
           Push-Button, 
           COL 6,00, 
           LINE 1,15,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           FRAMED,
           SQUARE,
           ENABLED E-NUOVO,
           EXCEPTION-VALUE 2,
           FLAT,
           ID IS 75,
           SELF-ACT,
           TITLE "Nuovo (F2)",
           BITMAP-NUMBER BitmapNumNew
           .

      * PUSH BUTTON
       05
           TOOL-CANCELLA, 
           Push-Button, 
           COL 16,00, 
           LINE 1,15,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           FRAMED,
           SQUARE,
           ENABLED E-CANCELLA,
           EXCEPTION-VALUE 4,
           FLAT,
           ID IS 76,
           SELF-ACT,
           TITLE "Cancella (F4)",
           BITMAP-NUMBER BitmapNumDelete
           .

      * PUSH BUTTON
       05
           TOOL-SALVA, 
           Push-Button, 
           COL 11,00, 
           LINE 1,15,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           FRAMED,
           SQUARE,
           ENABLED E-SALVA,
           EXCEPTION-VALUE 3,
           FLAT,
           ID IS 77,
           SELF-ACT,
           TITLE "Salva (F3)",
           BITMAP-NUMBER BitmapNumSave
           .

      * PUSH BUTTON
       05
           TOOL-ANTEPRIMA, 
           Push-Button, 
           COL 26,00, 
           LINE 1,15,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           FRAMED,
           SQUARE,
           ENABLED E-ANTEPRIMA,
           EXCEPTION-VALUE 6,
           FLAT,
           ID IS 78,
           SELF-ACT,
           TITLE "Anteprima (F6)",
           BITMAP-NUMBER BitmapNumPreview
           .

      * CHECK BOX
       05
           TOOL-MODIFICA, 
           Check-Box, 
           COL 21,00, 
           LINE 1,15,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 5,
           FRAMED,
           SQUARE,
           ENABLED E-MODIFICA,
           EXCEPTION-VALUE 150
           FLAT,
           ID IS 79,
           SELF-ACT,
           TITLE "Modifica (F5)",
           VALUE MOD,
           BITMAP-NUMBER BitmapNumEdit
           AFTER PROCEDURE TOOL-MODIFICA-AfterProcedure,
           BEFORE PROCEDURE TOOL-MODIFICA-BeforeProcedure, 
           .
      * PUSH BUTTON
       05
           TOOL-STAMPA, 
           Push-Button, 
           COL 31,00, 
           LINE 1,15,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           FRAMED,
           SQUARE,
           ENABLED E-STAMPA,
           EXCEPTION-VALUE 7,
           FLAT,
           ID IS 110,
           SELF-ACT,
           TITLE "Stampa (F7)",
           BITMAP-NUMBER BitmapNumPrint
           .

      * PUSH BUTTON
       05
           TOOL-CERCA, 
           Push-Button, 
           COL 36,00, 
           LINE 1,15,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           FRAMED,
           SQUARE,
           ENABLED E-CERCA,
           EXCEPTION-VALUE 8,
           FLAT,
           ID IS 111,
           SELF-ACT,
           TITLE "Cerca (F8)",
           BITMAP-NUMBER BitmapNumZoom
           .

      * PUSH BUTTON
       05
           TOOL-SELEZIONA, 
           Push-Button, 
           COL 41,00, 
           LINE 1,15,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 9,
           FRAMED,
           SQUARE,
           ENABLED E-SELEZIONA,
           EXCEPTION-VALUE 9,
           FLAT,
           ID IS 112,
           SELF-ACT,
           TITLE "Seleziona (F9)",
           .

      * PUSH BUTTON
       05
           Form1-Pb-1a, 
           Push-Button, 
           COL 46,00, 
           LINE 1,15,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 10,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 1002,
           FLAT,
           ID IS 113,
           SELF-ACT,
           TITLE "&Primo",
           .

      * PUSH BUTTON
       05
           Form1-Pb-1b, 
           Push-Button, 
           COL 51,00, 
           LINE 1,15,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 11,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 67,
           FLAT,
           ID IS 114,
           SELF-ACT,
           TITLE "Precedente (PgDn)",
           .

      * PUSH BUTTON
       05
           Form1-Pb-1c, 
           Push-Button, 
           COL 56,00, 
           LINE 1,15,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 12,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 68,
           FLAT,
           ID IS 115,
           SELF-ACT,
           TITLE "Successivo (PgUp)",
           .

      * PUSH BUTTON
       05
           Form1-Pb-1d, 
           Push-Button, 
           COL 61,00, 
           LINE 1,15,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 13,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 1006,
           FLAT,
           ID IS 116,
           SELF-ACT,
           TITLE "&Ultimo",
           .

      * CHECK BOX
       05
           TOOL-ORD, 
           Check-Box, 
           COL 66,00, 
           LINE 1,23,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 21,
           UNFRAMED,
           SQUARE,
           ENABLED 0,
           FLAT,
           ID IS 122,
           SELF-ACT,
           TITLE "Ordinamento Alfabetico (F10)",
           VALUE OrderBy,
           AFTER PROCEDURE TOOL-ORD-AfterProcedure,
           BEFORE PROCEDURE TOOL-ORD-BeforeProcedure, 
           .
      *{TOTEM}END

      *{TOTEM}LINKPARA
       PROCEDURE  DIVISION USING LK-BLOCKPGM, USER-CODI, LIVELLO-ABIL.
      *{TOTEM}END

      *{TOTEM}DECLARATIVE
       DECLARATIVES.
      * <TOTEM:EPT. INIT:distinteb, INIT:distinteb, BeforeDeclarative>
       DISTINTEB-ERROR SECTION.
           use after error procedure on distinteb.
           set RecLocked to false.
           evaluate status-distinteb
           when "35"
                display message "File [DISTINTEB] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [DISTINTEB] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[DISTINTEB] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           when "99"
           when "93"
                set RecLocked to true
                set errori    to true
                move 0 to mod
                modify tool-modifica, value = mod
                display form1
                set StatusVisua to true
                perform STATUS-BAR-MSG
                move "00" to status-distinteb
                if ReadSecca
                   read distinteb    no lock 
                        invalid      continue
                        not invalid  perform FORM1-IUD-DISPLAY
                   end-read
                end-if
                display message MSG-Record-gia-in-uso
                          title tit-err
                           icon 2
           when "23"
                move 1 to mod-k
                move 0 to mod
                modify tool-modifica, value = mod
                set StatusVisua to true
                perform STATUS-BAR-MSG 
                if nuovo              
                   initialize dis-dati replacing numeric data by zeroes
                                            alphanumeric data by spaces
                   perform FORM1-FLD-TO-BUF
                   display form1-tb-1
                   set vecchio to true
                end-if   
                perform ABILITAZIONI
                display form1
                |RISETTO IL VALORE A "23" PERCHE DENTRO AL PAR. CLEAR-SCREEN
                |CON L'OPERAZIONE UNLOCK VIENE RISETTATO A ZERO COSICCHÈ 
                |QUANDO TORNA DENTRO AI PAR. DI SCORRIMENTO DI TOTEM SI 
                |TROVA IN UNA SITUAZIONE CORRETTA E PROSEGUE CON LA READ
                |USCENDO CON UN MESSAGGIO DI ERRORE DI TIPO "46"
                move "23" to status-distinteb
           end-evaluate.
 
      ***---
       ARTICOLI-ERR SECTION.
           use after error procedure on articoli.
           set tutto-ok  to true.
           evaluate status-articoli
           when "35"
                display message "File [ARTICOLI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [ARTICOLI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[ARTICOLI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       TMAGAZ-ERR SECTION.
           use after error procedure on tmagaz.
           set tutto-ok  to true.
           evaluate status-tmagaz
           when "35"
                display message "File [TMAGAZ] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TMAGAZ] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TMAGAZ] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       PROGMAG-ERR SECTION.
           use after error procedure on progmag.
           set tutto-ok  to true.
           evaluate status-progmag
           when "35"
                display message "File [PROGMAG] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [PROGMAG] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[PROGMAG] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       TIMBALLI-ERR SECTION.
           use after error procedure on timballi.
           set tutto-ok  to true.
           evaluate status-timballi
           when "35"
                display message "File [TIMBALLI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TIMBALLI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TIMBALLI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       TIMBALQTA-ERR SECTION.
           use after error procedure on timbalqta.
           set tutto-ok  to true.
           evaluate status-timbalqta
           when "35"
                display message "File [TIMBALQTA] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TIMBALQTA] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TIMBALQTA] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       TMP-PROGMAG-ZOOM-ERR SECTION.
           use after error procedure on tmp-progmag-zoom.
           set tutto-ok  to true.
           evaluate status-tmp-progmag-zoom
           when "35"
                display message "File [TMP-PROGMAG-ZOOM] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TMP-PROGMAG-ZOOM] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TMP-PROGMAG-ZOOM] Indexed file corrupt
      -    "!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       TMARCHE-ERR SECTION.
           use after error procedure on tmarche.
           set tutto-ok  to true.
           evaluate status-tmarche
           when "35"
                display message "File [TMARCHE] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TMARCHE] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TMARCHE] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       TIMPOSTE-ERR SECTION.
           use after error procedure on timposte.
           set tutto-ok  to true.
           evaluate status-timposte
           when "35"
                display message "File [TIMPOSTE] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TIMPOSTE] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TIMPOSTE] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.

      * <TOTEM:END>
       INPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON INPUT.
       0100-DECL.
           EXIT.
       I-O-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON I-O.
       0200-DECL.
           EXIT.
       OUTPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON OUTPUT.
       0300-DECL.
           EXIT.
       TRANSACTION-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON TRANSACTION.
       0400-DECL.
           EXIT.
       END DECLARATIVES.
      *{TOTEM}END

       MAIN-LOGIC.
      *{TOTEM}ENTRY-BEFPRG
      *    Before-Program
           PERFORM ginqui-Ev-Before-Program
      *{TOTEM}END
           PERFORM INITIALIZE-ROUTINE.
      * run main screen
      *{TOTEM}RUN-MAINSCR
           PERFORM Form1-OPEN-ROUTINE.
      *{TOTEM}END

      *{TOTEM}COPY-PROCEDURE
       EXIT-STOP-ROUTINE.
           PERFORM CLOSE-FILE-RTN
      * <TOTEM:EPT. INIT:distinteb, INIT:distinteb, BeforeDestroyResource>
      * <TOTEM:END>
           CALL "w$bitmap" USING WBITMAP-DESTROY, DISTINTEB-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, RITORNA-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, toolbar-bmp
      *    After-Program
           PERFORM ginqui-Ev-After-Program
           EXIT PROGRAM TOTEM-PgmStatus
           STOP RUN.

       INITIALIZE-ROUTINE.
      *    Before Init
      * initialize program status variable
           Initialize TOTEM-PgmStatus.
      * get system information
           ACCEPT SYSTEM-INFORMATION FROM SYSTEM-INFO.
      * get terminal information
           ACCEPT TERMINAL-ABILITIES FROM TERMINAL-INFO.
      * set font
           PERFORM INIT-FONT.
      * load bitmap
           PERFORM INIT-BMP.
      * load resource
           PERFORM INIT-RES.
      * create pop-up menu
           PERFORM INIT-POPUP.
      * open files
           PERFORM OPEN-FILE-RTN.
      *    After Init
           .
    
       INIT-FONT.
           .

       INIT-BMP.
      * pb-genera
           COPY RESOURCE "DISTINTEB.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "DISTINTEB.BMP", 
                   GIVING DISTINTEB-BMP.
      * pb-ritorna
           COPY RESOURCE "RITORNA.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "RITORNA.BMP", 
                   GIVING RITORNA-BMP.
      * TOOL-ESCI
           COPY RESOURCE "toolbar.bmp".
           CALL "w$bitmap" USING WBITMAP-LOAD "toolbar.bmp", 
                   GIVING toolbar-bmp.
           .

       INIT-RES.
           .

       INIT-POPUP.
           .

       OPEN-FILE-RTN.
      *    Before Open
           PERFORM OPEN-distinteb
           PERFORM OPEN-articoli
           PERFORM OPEN-tmagaz
           PERFORM OPEN-progmag
           PERFORM OPEN-timballi
           PERFORM OPEN-timbalqta
      *    tmp-progmag-zoom OPEN MODE IS FALSE
      *    PERFORM OPEN-tmp-progmag-zoom
           PERFORM OPEN-tmarche
           PERFORM OPEN-timposte
      *    zoom-distinteb OPEN MODE IS FALSE
      *    PERFORM OPEN-zoom-distinteb
      *    After Open
           .

       OPEN-distinteb.
      * <TOTEM:EPT. INIT:distinteb, FD:distinteb, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O distinteb
           IF STATUS-distinteb = "35"
              OPEN OUTPUT distinteb
                IF Valid-STATUS-distinteb
                   CLOSE distinteb
                   OPEN I-O distinteb
                END-IF
           END-IF
           IF NOT Valid-STATUS-distinteb
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:distinteb, FD:distinteb, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-articoli.
      * <TOTEM:EPT. INIT:distinteb, FD:articoli, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT articoli
           IF NOT Valid-STATUS-articoli
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:distinteb, FD:articoli, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tmagaz.
      * <TOTEM:EPT. INIT:distinteb, FD:tmagaz, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tmagaz
           IF NOT Valid-STATUS-tmagaz
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:distinteb, FD:tmagaz, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-progmag.
      * <TOTEM:EPT. INIT:distinteb, FD:progmag, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT progmag
           IF NOT Valid-STATUS-progmag
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:distinteb, FD:progmag, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-timballi.
      * <TOTEM:EPT. INIT:distinteb, FD:timballi, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT timballi
           IF NOT Valid-STATUS-timballi
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:distinteb, FD:timballi, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-timbalqta.
      * <TOTEM:EPT. INIT:distinteb, FD:timbalqta, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT timbalqta
           IF NOT Valid-STATUS-timbalqta
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:distinteb, FD:timbalqta, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tmp-progmag-zoom.
      * <TOTEM:EPT. INIT:distinteb, FD:tmp-progmag-zoom, BeforeOpen>
      * <TOTEM:END>
           OPEN  OUTPUT tmp-progmag-zoom
           IF NOT Valid-STATUS-tmp-progmag-zoom
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:distinteb, FD:tmp-progmag-zoom, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tmarche.
      * <TOTEM:EPT. INIT:distinteb, FD:tmarche, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tmarche
           IF NOT Valid-STATUS-tmarche
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:distinteb, FD:tmarche, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-timposte.
      * <TOTEM:EPT. INIT:distinteb, FD:timposte, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT timposte
           IF NOT Valid-STATUS-timposte
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:distinteb, FD:timposte, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-zoom-distinteb.
      * <TOTEM:EPT. INIT:distinteb, FD:zoom-distinteb, BeforeOpen>
      * <TOTEM:END>
           OPEN  OUTPUT zoom-distinteb
           IF NOT Valid-STATUS-zoom-distinteb
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:distinteb, FD:zoom-distinteb, AfterOpen>
      * <TOTEM:END>
           .

       CLOSE-FILE-RTN.
      *    Before Close
           PERFORM CLOSE-distinteb
           PERFORM CLOSE-articoli
           PERFORM CLOSE-tmagaz
           PERFORM CLOSE-progmag
           PERFORM CLOSE-timballi
           PERFORM CLOSE-timbalqta
      *    tmp-progmag-zoom CLOSE MODE IS FALSE
      *    PERFORM CLOSE-tmp-progmag-zoom
           PERFORM CLOSE-tmarche
           PERFORM CLOSE-timposte
      *    zoom-distinteb CLOSE MODE IS FALSE
      *    PERFORM CLOSE-zoom-distinteb
      *    After Close
           .

       CLOSE-distinteb.
      * <TOTEM:EPT. INIT:distinteb, FD:distinteb, BeforeClose>
      * <TOTEM:END>
           CLOSE distinteb
           .

       CLOSE-articoli.
      * <TOTEM:EPT. INIT:distinteb, FD:articoli, BeforeClose>
      * <TOTEM:END>
           CLOSE articoli
           .

       CLOSE-tmagaz.
      * <TOTEM:EPT. INIT:distinteb, FD:tmagaz, BeforeClose>
      * <TOTEM:END>
           CLOSE tmagaz
           .

       CLOSE-progmag.
      * <TOTEM:EPT. INIT:distinteb, FD:progmag, BeforeClose>
      * <TOTEM:END>
           CLOSE progmag
           .

       CLOSE-timballi.
      * <TOTEM:EPT. INIT:distinteb, FD:timballi, BeforeClose>
      * <TOTEM:END>
           CLOSE timballi
           .

       CLOSE-timbalqta.
      * <TOTEM:EPT. INIT:distinteb, FD:timbalqta, BeforeClose>
      * <TOTEM:END>
           CLOSE timbalqta
           .

       CLOSE-tmp-progmag-zoom.
      * <TOTEM:EPT. INIT:distinteb, FD:tmp-progmag-zoom, BeforeClose>
      * <TOTEM:END>
           .

       CLOSE-tmarche.
      * <TOTEM:EPT. INIT:distinteb, FD:tmarche, BeforeClose>
      * <TOTEM:END>
           CLOSE tmarche
           .

       CLOSE-timposte.
      * <TOTEM:EPT. INIT:distinteb, FD:timposte, BeforeClose>
      * <TOTEM:END>
           CLOSE timposte
           .

       CLOSE-zoom-distinteb.
      * <TOTEM:EPT. INIT:distinteb, FD:zoom-distinteb, BeforeClose>
      * <TOTEM:END>
           .

       distinteb-k-articolo-MERGE-SPLITBUF.
           INITIALIZE distinteb-k-articolo-SPLITBUF
           MOVE dis-articolo-finale(1:6) TO 
           distinteb-k-articolo-SPLITBUF(1:6)
           MOVE dis-chiave(1:5) TO distinteb-k-articolo-SPLITBUF(7:5)
           .

       distinteb-k-progmag-MERGE-SPLITBUF.
           INITIALIZE distinteb-k-progmag-SPLITBUF
           MOVE dis-chiave-progmag(1:20) TO 
           distinteb-k-progmag-SPLITBUF(1:20)
           .

       DataSet1-distinteb-INITSTART.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-distinteb-KEY1-Asc
                 MOVE Low-Value TO dis-chiave
              ELSE
                 MOVE High-Value TO dis-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-distinteb-INITEND.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-distinteb-KEY1-Asc
                 MOVE High-Value TO dis-chiave
              ELSE
                 MOVE Low-Value TO dis-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           .   

       DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-distinteb-KEY1-ORDER
           END-EVALUATE
           .

       DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-distinteb-KEY1-ORDER
           END-EVALUATE
           .

      * distinteb
       DataSet1-distinteb-START.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-distinteb-KEY1-Asc
                 START distinteb KEY >= dis-chiave
              ELSE
                 START distinteb KEY <= dis-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-distinteb-START-NOTGREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-distinteb-KEY1-Asc
                 START distinteb KEY <= dis-chiave
              ELSE
                 START distinteb KEY >= dis-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-distinteb-START-GREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-distinteb-KEY1-Asc
                 START distinteb KEY > dis-chiave
              ELSE
                 START distinteb KEY < dis-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-distinteb-START-LESS.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-distinteb-KEY1-Asc
                 START distinteb KEY < dis-chiave
              ELSE
                 START distinteb KEY > dis-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-distinteb-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, BeforeReadRecord>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-distinteb-LOCK
                 READ distinteb WITH LOCK 
                 KEY dis-chiave
              ELSE
                 READ distinteb WITH NO LOCK 
                 KEY dis-chiave
              END-IF
           END-EVALUATE
           PERFORM distinteb-k-articolo-MERGE-SPLITBUF
           PERFORM distinteb-k-progmag-MERGE-SPLITBUF
           MOVE STATUS-distinteb TO TOTEM-ERR-STAT 
           MOVE "distinteb" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-distinteb-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, BeforeReadNext>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-distinteb-KEY1-Asc
                 IF DataSet1-distinteb-LOCK
                    READ distinteb NEXT WITH LOCK
                 ELSE
                    READ distinteb NEXT WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-distinteb-LOCK
                    READ distinteb PREVIOUS WITH LOCK
                 ELSE
                    READ distinteb PREVIOUS WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           PERFORM distinteb-k-articolo-MERGE-SPLITBUF
           PERFORM distinteb-k-progmag-MERGE-SPLITBUF
           MOVE STATUS-distinteb TO TOTEM-ERR-STAT
           MOVE "distinteb" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-distinteb-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, BeforeReadPrev>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-distinteb-KEY1-Asc
                 IF DataSet1-distinteb-LOCK
                    READ distinteb PREVIOUS WITH LOCK
                 ELSE
                    READ distinteb PREVIOUS WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-distinteb-LOCK
                    READ distinteb NEXT WITH LOCK
                 ELSE
                    READ distinteb NEXT WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           PERFORM distinteb-k-articolo-MERGE-SPLITBUF
           PERFORM distinteb-k-progmag-MERGE-SPLITBUF
           MOVE STATUS-distinteb TO TOTEM-ERR-STAT
           MOVE "distinteb" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-distinteb-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, BeforeWrite>
      * <TOTEM:END>
           WRITE dis-rec OF distinteb.
           MOVE STATUS-distinteb TO TOTEM-ERR-STAT
           MOVE "distinteb" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-distinteb-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, BeforeRewrite>
      * <TOTEM:END>
           REWRITE dis-rec OF distinteb.
           MOVE STATUS-distinteb TO TOTEM-ERR-STAT
           MOVE "distinteb" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-distinteb-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, BeforeDelete>
      * <TOTEM:END>
           DELETE distinteb.
           MOVE STATUS-distinteb TO TOTEM-ERR-STAT
           MOVE "distinteb" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, AfterDelete>
      * <TOTEM:END>
           .

       articoli-art-k1-MERGE-SPLITBUF.
           INITIALIZE articoli-art-k1-SPLITBUF
           MOVE art-descrizione OF articoli(1:50) TO 
           articoli-art-k1-SPLITBUF(1:50)
           .

       DataSet1-articoli-INITSTART.
           IF DataSet1-articoli-KEY-Asc
              MOVE Low-Value TO art-chiave OF articoli
           ELSE
              MOVE High-Value TO art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-INITEND.
           IF DataSet1-articoli-KEY-Asc
              MOVE High-Value TO art-chiave OF articoli
           ELSE
              MOVE Low-Value TO art-chiave OF articoli
           END-IF
           .

      * articoli
       DataSet1-articoli-START.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY >= art-chiave OF articoli
           ELSE
              START articoli KEY <= art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-START-NOTGREATER.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY <= art-chiave OF articoli
           ELSE
              START articoli KEY >= art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-START-GREATER.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY > art-chiave OF articoli
           ELSE
              START articoli KEY < art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-START-LESS.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY < art-chiave OF articoli
           ELSE
              START articoli KEY > art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-articoli-LOCK
              READ articoli WITH LOCK 
              KEY art-chiave OF articoli
           ELSE
              READ articoli WITH NO LOCK 
              KEY art-chiave OF articoli
           END-IF
           PERFORM articoli-art-k1-MERGE-SPLITBUF
           MOVE STATUS-articoli TO TOTEM-ERR-STAT 
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-articoli-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-articoli-KEY-Asc
              IF DataSet1-articoli-LOCK
                 READ articoli NEXT WITH LOCK
              ELSE
                 READ articoli NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-articoli-LOCK
                 READ articoli PREVIOUS WITH LOCK
              ELSE
                 READ articoli PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM articoli-art-k1-MERGE-SPLITBUF
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-articoli-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-articoli-KEY-Asc
              IF DataSet1-articoli-LOCK
                 READ articoli PREVIOUS WITH LOCK
              ELSE
                 READ articoli PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-articoli-LOCK
                 READ articoli NEXT WITH LOCK
              ELSE
                 READ articoli NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM articoli-art-k1-MERGE-SPLITBUF
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-articoli-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-articoli-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-articoli-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tmagaz-INITSTART.
           IF DataSet1-tmagaz-KEY-Asc
              MOVE Low-Value TO mag-chiave
           ELSE
              MOVE High-Value TO mag-chiave
           END-IF
           .

       DataSet1-tmagaz-INITEND.
           IF DataSet1-tmagaz-KEY-Asc
              MOVE High-Value TO mag-chiave
           ELSE
              MOVE Low-Value TO mag-chiave
           END-IF
           .

      * tmagaz
       DataSet1-tmagaz-START.
           IF DataSet1-tmagaz-KEY-Asc
              START tmagaz KEY >= mag-chiave
           ELSE
              START tmagaz KEY <= mag-chiave
           END-IF
           .

       DataSet1-tmagaz-START-NOTGREATER.
           IF DataSet1-tmagaz-KEY-Asc
              START tmagaz KEY <= mag-chiave
           ELSE
              START tmagaz KEY >= mag-chiave
           END-IF
           .

       DataSet1-tmagaz-START-GREATER.
           IF DataSet1-tmagaz-KEY-Asc
              START tmagaz KEY > mag-chiave
           ELSE
              START tmagaz KEY < mag-chiave
           END-IF
           .

       DataSet1-tmagaz-START-LESS.
           IF DataSet1-tmagaz-KEY-Asc
              START tmagaz KEY < mag-chiave
           ELSE
              START tmagaz KEY > mag-chiave
           END-IF
           .

       DataSet1-tmagaz-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tmagaz-LOCK
              READ tmagaz WITH LOCK 
              KEY mag-chiave
           ELSE
              READ tmagaz WITH NO LOCK 
              KEY mag-chiave
           END-IF
           MOVE STATUS-tmagaz TO TOTEM-ERR-STAT 
           MOVE "tmagaz" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tmagaz-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tmagaz-KEY-Asc
              IF DataSet1-tmagaz-LOCK
                 READ tmagaz NEXT WITH LOCK
              ELSE
                 READ tmagaz NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tmagaz-LOCK
                 READ tmagaz PREVIOUS WITH LOCK
              ELSE
                 READ tmagaz PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tmagaz TO TOTEM-ERR-STAT
           MOVE "tmagaz" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tmagaz-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tmagaz-KEY-Asc
              IF DataSet1-tmagaz-LOCK
                 READ tmagaz PREVIOUS WITH LOCK
              ELSE
                 READ tmagaz PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tmagaz-LOCK
                 READ tmagaz NEXT WITH LOCK
              ELSE
                 READ tmagaz NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tmagaz TO TOTEM-ERR-STAT
           MOVE "tmagaz" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tmagaz-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tmagaz TO TOTEM-ERR-STAT
           MOVE "tmagaz" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tmagaz-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tmagaz TO TOTEM-ERR-STAT
           MOVE "tmagaz" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tmagaz-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tmagaz TO TOTEM-ERR-STAT
           MOVE "tmagaz" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterDelete>
      * <TOTEM:END>
           .

       progmag-key01-MERGE-SPLITBUF.
           INITIALIZE progmag-key01-SPLITBUF
           MOVE prg-cod-magazzino OF progmag(1:3) TO 
           progmag-key01-SPLITBUF(1:3)
           MOVE prg-cod-articolo OF progmag(1:6) TO 
           progmag-key01-SPLITBUF(4:6)
           MOVE prg-tipo-imballo OF progmag(1:3) TO 
           progmag-key01-SPLITBUF(10:3)
           MOVE prg-peso OF progmag(1:8) TO progmag-key01-SPLITBUF(13:8)
           .

       DataSet1-progmag-INITSTART.
           IF DataSet1-progmag-KEY-Asc
              MOVE Low-Value TO prg-chiave OF progmag
           ELSE
              MOVE High-Value TO prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-INITEND.
           IF DataSet1-progmag-KEY-Asc
              MOVE High-Value TO prg-chiave OF progmag
           ELSE
              MOVE Low-Value TO prg-chiave OF progmag
           END-IF
           .

      * progmag
       DataSet1-progmag-START.
           IF DataSet1-progmag-KEY-Asc
              START progmag KEY >= prg-chiave OF progmag
           ELSE
              START progmag KEY <= prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-START-NOTGREATER.
           IF DataSet1-progmag-KEY-Asc
              START progmag KEY <= prg-chiave OF progmag
           ELSE
              START progmag KEY >= prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-START-GREATER.
           IF DataSet1-progmag-KEY-Asc
              START progmag KEY > prg-chiave OF progmag
           ELSE
              START progmag KEY < prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-START-LESS.
           IF DataSet1-progmag-KEY-Asc
              START progmag KEY < prg-chiave OF progmag
           ELSE
              START progmag KEY > prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-progmag-LOCK
              READ progmag WITH LOCK 
              KEY prg-chiave OF progmag
           ELSE
              READ progmag WITH NO LOCK 
              KEY prg-chiave OF progmag
           END-IF
           PERFORM progmag-key01-MERGE-SPLITBUF
           MOVE STATUS-progmag TO TOTEM-ERR-STAT 
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-progmag-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-progmag-KEY-Asc
              IF DataSet1-progmag-LOCK
                 READ progmag NEXT WITH LOCK
              ELSE
                 READ progmag NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-progmag-LOCK
                 READ progmag PREVIOUS WITH LOCK
              ELSE
                 READ progmag PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM progmag-key01-MERGE-SPLITBUF
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-progmag-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-progmag-KEY-Asc
              IF DataSet1-progmag-LOCK
                 READ progmag PREVIOUS WITH LOCK
              ELSE
                 READ progmag PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-progmag-LOCK
                 READ progmag NEXT WITH LOCK
              ELSE
                 READ progmag NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM progmag-key01-MERGE-SPLITBUF
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-progmag-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-progmag-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-progmag-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-timballi-INITSTART.
           IF DataSet1-timballi-KEY-Asc
              MOVE Low-Value TO imb-chiave
           ELSE
              MOVE High-Value TO imb-chiave
           END-IF
           .

       DataSet1-timballi-INITEND.
           IF DataSet1-timballi-KEY-Asc
              MOVE High-Value TO imb-chiave
           ELSE
              MOVE Low-Value TO imb-chiave
           END-IF
           .

      * timballi
       DataSet1-timballi-START.
           IF DataSet1-timballi-KEY-Asc
              START timballi KEY >= imb-chiave
           ELSE
              START timballi KEY <= imb-chiave
           END-IF
           .

       DataSet1-timballi-START-NOTGREATER.
           IF DataSet1-timballi-KEY-Asc
              START timballi KEY <= imb-chiave
           ELSE
              START timballi KEY >= imb-chiave
           END-IF
           .

       DataSet1-timballi-START-GREATER.
           IF DataSet1-timballi-KEY-Asc
              START timballi KEY > imb-chiave
           ELSE
              START timballi KEY < imb-chiave
           END-IF
           .

       DataSet1-timballi-START-LESS.
           IF DataSet1-timballi-KEY-Asc
              START timballi KEY < imb-chiave
           ELSE
              START timballi KEY > imb-chiave
           END-IF
           .

       DataSet1-timballi-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-timballi-LOCK
              READ timballi WITH LOCK 
              KEY imb-chiave
           ELSE
              READ timballi WITH NO LOCK 
              KEY imb-chiave
           END-IF
           MOVE STATUS-timballi TO TOTEM-ERR-STAT 
           MOVE "timballi" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-timballi-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-timballi-KEY-Asc
              IF DataSet1-timballi-LOCK
                 READ timballi NEXT WITH LOCK
              ELSE
                 READ timballi NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-timballi-LOCK
                 READ timballi PREVIOUS WITH LOCK
              ELSE
                 READ timballi PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-timballi TO TOTEM-ERR-STAT
           MOVE "timballi" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-timballi-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-timballi-KEY-Asc
              IF DataSet1-timballi-LOCK
                 READ timballi PREVIOUS WITH LOCK
              ELSE
                 READ timballi PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-timballi-LOCK
                 READ timballi NEXT WITH LOCK
              ELSE
                 READ timballi NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-timballi TO TOTEM-ERR-STAT
           MOVE "timballi" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-timballi-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-timballi TO TOTEM-ERR-STAT
           MOVE "timballi" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-timballi-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-timballi TO TOTEM-ERR-STAT
           MOVE "timballi" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-timballi-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-timballi TO TOTEM-ERR-STAT
           MOVE "timballi" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-timbalqta-INITSTART.
           IF DataSet1-timbalqta-KEY-Asc
              MOVE Low-Value TO imq-chiave
           ELSE
              MOVE High-Value TO imq-chiave
           END-IF
           .

       DataSet1-timbalqta-INITEND.
           IF DataSet1-timbalqta-KEY-Asc
              MOVE High-Value TO imq-chiave
           ELSE
              MOVE Low-Value TO imq-chiave
           END-IF
           .

      * timbalqta
       DataSet1-timbalqta-START.
           IF DataSet1-timbalqta-KEY-Asc
              START timbalqta KEY >= imq-chiave
           ELSE
              START timbalqta KEY <= imq-chiave
           END-IF
           .

       DataSet1-timbalqta-START-NOTGREATER.
           IF DataSet1-timbalqta-KEY-Asc
              START timbalqta KEY <= imq-chiave
           ELSE
              START timbalqta KEY >= imq-chiave
           END-IF
           .

       DataSet1-timbalqta-START-GREATER.
           IF DataSet1-timbalqta-KEY-Asc
              START timbalqta KEY > imq-chiave
           ELSE
              START timbalqta KEY < imq-chiave
           END-IF
           .

       DataSet1-timbalqta-START-LESS.
           IF DataSet1-timbalqta-KEY-Asc
              START timbalqta KEY < imq-chiave
           ELSE
              START timbalqta KEY > imq-chiave
           END-IF
           .

       DataSet1-timbalqta-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-timbalqta-LOCK
              READ timbalqta WITH LOCK 
              KEY imq-chiave
           ELSE
              READ timbalqta WITH NO LOCK 
              KEY imq-chiave
           END-IF
           MOVE STATUS-timbalqta TO TOTEM-ERR-STAT 
           MOVE "timbalqta" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-timbalqta-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-timbalqta-KEY-Asc
              IF DataSet1-timbalqta-LOCK
                 READ timbalqta NEXT WITH LOCK
              ELSE
                 READ timbalqta NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-timbalqta-LOCK
                 READ timbalqta PREVIOUS WITH LOCK
              ELSE
                 READ timbalqta PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-timbalqta TO TOTEM-ERR-STAT
           MOVE "timbalqta" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-timbalqta-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-timbalqta-KEY-Asc
              IF DataSet1-timbalqta-LOCK
                 READ timbalqta PREVIOUS WITH LOCK
              ELSE
                 READ timbalqta PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-timbalqta-LOCK
                 READ timbalqta NEXT WITH LOCK
              ELSE
                 READ timbalqta NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-timbalqta TO TOTEM-ERR-STAT
           MOVE "timbalqta" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-timbalqta-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-timbalqta TO TOTEM-ERR-STAT
           MOVE "timbalqta" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-timbalqta-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-timbalqta TO TOTEM-ERR-STAT
           MOVE "timbalqta" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-timbalqta-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-timbalqta TO TOTEM-ERR-STAT
           MOVE "timbalqta" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterDelete>
      * <TOTEM:END>
           .

       tmp-progmag-zoom-key-des-MERGE-SPLITBUF.
           INITIALIZE tmp-progmag-zoom-key-des-SPLITBUF
           MOVE tmp-prg-z-art-des(1:40) TO 
           tmp-progmag-zoom-key-des-SPLITBUF(1:40)
           MOVE tmp-prg-z-chiave(1:23) TO 
           tmp-progmag-zoom-key-des-SPLITBUF(41:23)
           .

       tmp-progmag-zoom-key-des-SPLITBUF-TOFLD.
           MOVE tmp-progmag-zoom-key-des-SPLITBUF(1:40) TO 
           tmp-prg-z-art-des(1:40)
           MOVE tmp-progmag-zoom-key-des-SPLITBUF(41:23) TO 
           tmp-prg-z-chiave(1:23)
           .

       tmp-progmag-zoom-key-art-MERGE-SPLITBUF.
           INITIALIZE tmp-progmag-zoom-key-art-SPLITBUF
           MOVE tmp-prg-z-cod-articolo(1:6) TO 
           tmp-progmag-zoom-key-art-SPLITBUF(1:6)
           .

       DataSet1-tmp-progmag-zoom-INITSTART.
           IF DataSet1-tmp-progmag-zoom-KEY-Asc
              MOVE Low-Value TO tmp-prg-z-art-des
           ELSE
              MOVE High-Value TO tmp-prg-z-art-des
           END-IF
           IF DataSet1-tmp-progmag-zoom-KEY-Asc
              MOVE Low-Value TO tmp-prg-z-chiave
           ELSE
              MOVE High-Value TO tmp-prg-z-chiave
           END-IF
           .

       DataSet1-tmp-progmag-zoom-INITEND.
           IF DataSet1-tmp-progmag-zoom-KEY-Asc
              MOVE High-Value to tmp-prg-z-art-des
           ELSE
              MOVE Low-Value to tmp-prg-z-art-des
           END-IF
           IF DataSet1-tmp-progmag-zoom-KEY-Asc
              MOVE High-Value to tmp-prg-z-chiave
           ELSE
              MOVE Low-Value to tmp-prg-z-chiave
           END-IF
           .

       DataSet1-tmp-progmag-zoom-TMPBUF-TO-FLD.
           MOVE DataSet1-tmp-progmag-zoom-SPLIT-BUF1(1:40) TO
                tmp-prg-z-art-des(1:40)
           MOVE DataSet1-tmp-progmag-zoom-SPLIT-BUF1(41:23) TO
                tmp-prg-z-chiave(1:23)
           .

       DataSet1-tmp-progmag-zoom-FLD-TO-TMPBUF.
           MOVE tmp-prg-z-art-des(1:40) TO
                DataSet1-tmp-progmag-zoom-SPLIT-BUF1(1:40)
           MOVE tmp-prg-z-chiave(1:23) TO
                DataSet1-tmp-progmag-zoom-SPLIT-BUF1(41:23)
           .

      * tmp-progmag-zoom
       DataSet1-tmp-progmag-zoom-START.
           IF DataSet1-tmp-progmag-zoom-KEY-Asc
              START tmp-progmag-zoom KEY >= key-des
           ELSE
              START tmp-progmag-zoom KEY <= key-des
           END-IF
           .

       DataSet1-tmp-progmag-zoom-START-NOTGREATER.
           IF DataSet1-tmp-progmag-zoom-KEY-Asc
              START tmp-progmag-zoom KEY <= key-des
           ELSE
              START tmp-progmag-zoom KEY >= key-des
           END-IF
           .

       DataSet1-tmp-progmag-zoom-START-GREATER.
           IF DataSet1-tmp-progmag-zoom-KEY-Asc
              START tmp-progmag-zoom KEY > key-des
           ELSE
              START tmp-progmag-zoom KEY < key-des
           END-IF
           .

       DataSet1-tmp-progmag-zoom-START-LESS.
           IF DataSet1-tmp-progmag-zoom-KEY-Asc
              START tmp-progmag-zoom KEY < key-des
           ELSE
              START tmp-progmag-zoom KEY > key-des
           END-IF
           .

       DataSet1-tmp-progmag-zoom-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, BeforeReadRecord>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tmp-progmag-zoom-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, BeforeReadNext>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tmp-progmag-zoom-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, BeforeReadPrev>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tmp-progmag-zoom-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, BeforeWrite>
      * <TOTEM:END>
           WRITE tmp-prg-z-rec OF tmp-progmag-zoom.
           MOVE STATUS-tmp-progmag-zoom TO TOTEM-ERR-STAT
           MOVE "tmp-progmag-zoom" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tmp-progmag-zoom-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tmp-progmag-zoom TO TOTEM-ERR-STAT
           MOVE "tmp-progmag-zoom" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tmp-progmag-zoom-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tmp-progmag-zoom TO TOTEM-ERR-STAT
           MOVE "tmp-progmag-zoom" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tmarche-INITSTART.
           IF DataSet1-tmarche-KEY-Asc
              MOVE Low-Value TO mar-chiave
           ELSE
              MOVE High-Value TO mar-chiave
           END-IF
           .

       DataSet1-tmarche-INITEND.
           IF DataSet1-tmarche-KEY-Asc
              MOVE High-Value TO mar-chiave
           ELSE
              MOVE Low-Value TO mar-chiave
           END-IF
           .

      * tmarche
       DataSet1-tmarche-START.
           IF DataSet1-tmarche-KEY-Asc
              START tmarche KEY >= mar-chiave
           ELSE
              START tmarche KEY <= mar-chiave
           END-IF
           .

       DataSet1-tmarche-START-NOTGREATER.
           IF DataSet1-tmarche-KEY-Asc
              START tmarche KEY <= mar-chiave
           ELSE
              START tmarche KEY >= mar-chiave
           END-IF
           .

       DataSet1-tmarche-START-GREATER.
           IF DataSet1-tmarche-KEY-Asc
              START tmarche KEY > mar-chiave
           ELSE
              START tmarche KEY < mar-chiave
           END-IF
           .

       DataSet1-tmarche-START-LESS.
           IF DataSet1-tmarche-KEY-Asc
              START tmarche KEY < mar-chiave
           ELSE
              START tmarche KEY > mar-chiave
           END-IF
           .

       DataSet1-tmarche-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tmarche-LOCK
              READ tmarche WITH LOCK 
              KEY mar-chiave
           ELSE
              READ tmarche WITH NO LOCK 
              KEY mar-chiave
           END-IF
           MOVE STATUS-tmarche TO TOTEM-ERR-STAT 
           MOVE "tmarche" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tmarche-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tmarche-KEY-Asc
              IF DataSet1-tmarche-LOCK
                 READ tmarche NEXT WITH LOCK
              ELSE
                 READ tmarche NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tmarche-LOCK
                 READ tmarche PREVIOUS WITH LOCK
              ELSE
                 READ tmarche PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tmarche TO TOTEM-ERR-STAT
           MOVE "tmarche" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tmarche-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tmarche-KEY-Asc
              IF DataSet1-tmarche-LOCK
                 READ tmarche PREVIOUS WITH LOCK
              ELSE
                 READ tmarche PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tmarche-LOCK
                 READ tmarche NEXT WITH LOCK
              ELSE
                 READ tmarche NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tmarche TO TOTEM-ERR-STAT
           MOVE "tmarche" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tmarche-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tmarche TO TOTEM-ERR-STAT
           MOVE "tmarche" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tmarche-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tmarche TO TOTEM-ERR-STAT
           MOVE "tmarche" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tmarche-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tmarche TO TOTEM-ERR-STAT
           MOVE "tmarche" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-timposte-INITSTART.
           IF DataSet1-timposte-KEY-Asc
              MOVE Low-Value TO imp-chiave
           ELSE
              MOVE High-Value TO imp-chiave
           END-IF
           .

       DataSet1-timposte-INITEND.
           IF DataSet1-timposte-KEY-Asc
              MOVE High-Value TO imp-chiave
           ELSE
              MOVE Low-Value TO imp-chiave
           END-IF
           .

      * timposte
       DataSet1-timposte-START.
           IF DataSet1-timposte-KEY-Asc
              START timposte KEY >= imp-chiave
           ELSE
              START timposte KEY <= imp-chiave
           END-IF
           .

       DataSet1-timposte-START-NOTGREATER.
           IF DataSet1-timposte-KEY-Asc
              START timposte KEY <= imp-chiave
           ELSE
              START timposte KEY >= imp-chiave
           END-IF
           .

       DataSet1-timposte-START-GREATER.
           IF DataSet1-timposte-KEY-Asc
              START timposte KEY > imp-chiave
           ELSE
              START timposte KEY < imp-chiave
           END-IF
           .

       DataSet1-timposte-START-LESS.
           IF DataSet1-timposte-KEY-Asc
              START timposte KEY < imp-chiave
           ELSE
              START timposte KEY > imp-chiave
           END-IF
           .

       DataSet1-timposte-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-timposte-LOCK
              READ timposte WITH LOCK 
              KEY imp-chiave
           ELSE
              READ timposte WITH NO LOCK 
              KEY imp-chiave
           END-IF
           MOVE STATUS-timposte TO TOTEM-ERR-STAT 
           MOVE "timposte" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-timposte-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-timposte-KEY-Asc
              IF DataSet1-timposte-LOCK
                 READ timposte NEXT WITH LOCK
              ELSE
                 READ timposte NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-timposte-LOCK
                 READ timposte PREVIOUS WITH LOCK
              ELSE
                 READ timposte PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-timposte TO TOTEM-ERR-STAT
           MOVE "timposte" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-timposte-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-timposte-KEY-Asc
              IF DataSet1-timposte-LOCK
                 READ timposte PREVIOUS WITH LOCK
              ELSE
                 READ timposte PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-timposte-LOCK
                 READ timposte NEXT WITH LOCK
              ELSE
                 READ timposte NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-timposte TO TOTEM-ERR-STAT
           MOVE "timposte" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-timposte-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-timposte TO TOTEM-ERR-STAT
           MOVE "timposte" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-timposte-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-timposte TO TOTEM-ERR-STAT
           MOVE "timposte" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-timposte-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-timposte TO TOTEM-ERR-STAT
           MOVE "timposte" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterDelete>
      * <TOTEM:END>
           .

       zoom-distinteb-k-des-MERGE-SPLITBUF.
           INITIALIZE zoom-distinteb-k-des-SPLITBUF
           MOVE zoom-dis-art-descrizione(1:50) TO 
           zoom-distinteb-k-des-SPLITBUF(1:50)
           MOVE zoom-dis-chiave(1:5) TO 
           zoom-distinteb-k-des-SPLITBUF(51:5)
           .

       DataSet1-zoom-distinteb-INITSTART.
           IF DataSet1-zoom-distinteb-KEY-Asc
              MOVE Low-Value TO zoom-dis-chiave
           ELSE
              MOVE High-Value TO zoom-dis-chiave
           END-IF
           .

       DataSet1-zoom-distinteb-INITEND.
           IF DataSet1-zoom-distinteb-KEY-Asc
              MOVE High-Value TO zoom-dis-chiave
           ELSE
              MOVE Low-Value TO zoom-dis-chiave
           END-IF
           .

      * zoom-distinteb
       DataSet1-zoom-distinteb-START.
           IF DataSet1-zoom-distinteb-KEY-Asc
              START zoom-distinteb KEY >= zoom-dis-chiave
           ELSE
              START zoom-distinteb KEY <= zoom-dis-chiave
           END-IF
           .

       DataSet1-zoom-distinteb-START-NOTGREATER.
           IF DataSet1-zoom-distinteb-KEY-Asc
              START zoom-distinteb KEY <= zoom-dis-chiave
           ELSE
              START zoom-distinteb KEY >= zoom-dis-chiave
           END-IF
           .

       DataSet1-zoom-distinteb-START-GREATER.
           IF DataSet1-zoom-distinteb-KEY-Asc
              START zoom-distinteb KEY > zoom-dis-chiave
           ELSE
              START zoom-distinteb KEY < zoom-dis-chiave
           END-IF
           .

       DataSet1-zoom-distinteb-START-LESS.
           IF DataSet1-zoom-distinteb-KEY-Asc
              START zoom-distinteb KEY < zoom-dis-chiave
           ELSE
              START zoom-distinteb KEY > zoom-dis-chiave
           END-IF
           .

       DataSet1-zoom-distinteb-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-distinteb, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-distinteb, BeforeReadRecord>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-distinteb, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-distinteb, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-zoom-distinteb-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-distinteb, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-distinteb, BeforeReadNext>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-distinteb, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-distinteb, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-zoom-distinteb-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-distinteb, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-distinteb, BeforeReadPrev>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-distinteb, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-distinteb, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-zoom-distinteb-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-distinteb, BeforeWrite>
      * <TOTEM:END>
           WRITE zoom-dis-rec OF zoom-distinteb.
           MOVE STATUS-zoom-distinteb TO TOTEM-ERR-STAT
           MOVE "zoom-distinteb" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-distinteb, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-zoom-distinteb-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-distinteb, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-zoom-distinteb TO TOTEM-ERR-STAT
           MOVE "zoom-distinteb" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-distinteb, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-zoom-distinteb-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-distinteb, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-zoom-distinteb TO TOTEM-ERR-STAT
           MOVE "zoom-distinteb" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-distinteb, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-INIT-RECORD.
           INITIALIZE dis-rec OF distinteb
           INITIALIZE art-rec OF articoli
           INITIALIZE mag-rec OF tmagaz
           INITIALIZE prg-rec OF progmag
           INITIALIZE imb-rec OF timballi
           INITIALIZE imq-rec OF timbalqta
           INITIALIZE tmp-prg-z-rec OF tmp-progmag-zoom
           INITIALIZE mar-rec OF tmarche
           INITIALIZE imp-rec OF timposte
           INITIALIZE zoom-dis-rec OF zoom-distinteb
           .


      * GRID
       form1-Gd-1-Content.
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 1, Y = 1,
                CELL-DATA = "N°",
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 2, Y = 1,
                CELL-DATA = "Articolo",
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 3, Y = 1,
                CELL-DATA = "Magazzino",
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 4, Y = 1,
                CELL-DATA = "Imballo",
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 5, Y = 1,
                CELL-DATA = "Peso",
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 6, Y = 1,
                CELL-DATA = "Descrizione",
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 7, Y = 1,
                CELL-DATA = "UTF",
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 8, Y = 1,
                CELL-DATA = "Non UTF",
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 9, Y = 1,
                CELL-DATA = "Prezzo MP",
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 10, Y = 1,
                CELL-DATA = "Quantità",
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 11, Y = 1,
                CELL-DATA = "Oneri",
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 12, Y = 1,
                CELL-DATA = "+ Peso",
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 1, Y = 2,
                CELL-DATA = "1",
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 1, Y = 3,
                CELL-DATA = "2",
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 1, Y = 4,
                CELL-DATA = "3",
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 1, Y = 5,
                CELL-DATA = "4",
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 1, Y = 6,
                CELL-DATA = "5",
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 1, Y = 7,
                CELL-DATA = "6",
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 1, Y = 8,
                CELL-DATA = "7",
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 1, Y = 9,
                CELL-DATA = "8",
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 1, Y = 10,
                CELL-DATA = "9",
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 1, Y = 11,
                CELL-DATA = "10",
           .

      * FD's Initialize Paragraph
       DataSet1-distinteb-INITREC.
           INITIALIZE dis-rec OF distinteb
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-articoli-INITREC.
           INITIALIZE art-rec OF articoli
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tmagaz-INITREC.
           INITIALIZE mag-rec OF tmagaz
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-progmag-INITREC.
           INITIALIZE prg-rec OF progmag
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-timballi-INITREC.
           INITIALIZE imb-rec OF timballi
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-timbalqta-INITREC.
           INITIALIZE imq-rec OF timbalqta
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tmp-progmag-zoom-INITREC.
           INITIALIZE tmp-prg-z-rec OF tmp-progmag-zoom
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tmarche-INITREC.
           INITIALIZE mar-rec OF tmarche
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-timposte-INITREC.
           INITIALIZE imp-rec OF timposte
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-zoom-distinteb-INITREC.
           INITIALIZE zoom-dis-rec OF zoom-distinteb
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      *
       DataSet1-DISPATCH-BUFTOFLD.
           EVALUATE TOTEM-Form-Index ALSO TOTEM-Frame-Index
              WHEN 1 ALSO 0
                  PERFORM Form1-Buf-To-Fld
           END-EVALUATE
           .

       Form1-DISPLAY-STATUS-MSG.
            MODIFY Form1-St-1-Handle PANEL-INDEX = 1
                PANEL-TEXT = TOTEM-HINT-TEXT
           .

       Form1-CLEAR-STATUS-MSG.
           MOVE SPACES TO TOTEM-MSG-1, TOTEM-MSG-2, TOTEM-MSG-3, 
           TOTEM-MSG-TEXT
           PERFORM Form1-DISPLAY-STATUS-MSG
           .

       Form1-Open-Routine.
           PERFORM Form1-Scrn
           PERFORM Form1-Proc
           .

       Form1-Scrn.
           PERFORM Form1-Create-Win
           PERFORM Form1-Init-Value
           PERFORM Form1-Init-Data
      * Tab keystrok settings
      * Tool Bar
           DISPLAY Form1-Tb-1
           PERFORM Form1-DISPLAY
           .

       Form1-Create-Win.
           Display Independent GRAPHICAL WINDOW
              LINES 43,77,
              SIZE 167,50,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 65793,
              CONTROL FONT Small-Font,
              LABEL-OFFSET 23,
              LINK TO THREAD,
              MODELESS,
              NO SCROLL,
              TITLE-BAR,
              TITLE titolo,
              AUTO-MINIMIZE,
              WITH SYSTEM MENU,
              USER-GRAY,
           VISIBLE v-screen,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE Screen1-Event-Proc,
              HANDLE IS form1-Handle,
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
           DISPLAY TOOL-BAR 
              LINES 2,69,   
              HANDLE IN Form1-Tb-1-Handle
           DISPLAY Form1-Tb-1 UPON Form1-Tb-1-Handle

      * Status-bar
           DISPLAY STATUS-BAR
              FONT IS Small-Font,
              GRIP,
              PANEL-WIDTHS (105, 30, 999),
              PANEL-STYLE  (1, 1, 1),
              PANEL-TEXT   (SPACE, SPACE, SPACE),
              HANDLE IS Form1-St-1-Handle
           DISPLAY Form1 UPON form1-Handle
      * DISPLAY-COLUMNS settings
              MODIFY form1-Gd-1, DISPLAY-COLUMNS (1, 6, 16, 26, 36, 46, 
           86, 96, 106, 126, 136, 156)
           .

       Form1-PROC.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeAccept>
           perform INIT.
           perform ABILITA-TOOLBAR.
           perform ABILITAZIONI.
           perform STATUS-BAR-MSG.
           move 2 to colonna.
           perform HELP-GRID.
           move 78-WinLinesWithout to win-lines.
           modify form1-handle, lines win-lines.
           move 1 to v-screen.
           modify form1-handle, visible = v-screen.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT Form1
                 ON EXCEPTION
                    PERFORM Form1-Evaluate-Func
                 MOVE 1 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY form1-Handle
           INITIALIZE Key-Status
           .

       Form1-Evaluate-Func.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterAccept>
           evaluate key-status
           when 5 |MODIFICA
                inquire tool-modifica, enabled in e-modifica
                if e-modifica = 1
                   if mod = 0 move 1 to mod
                   else       move 0 to mod
                   end-if
                   modify tool-modifica, value = mod
                   perform MODIFICA
                end-if
           end-evaluate.

           .
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM Form1-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM Form1-Exit
                 END-IF
              WHEN Key-Status = 1000
                 PERFORM pb-genera-LinkTo
              WHEN Key-Status = 1001
                 PERFORM pb-azzera-LinkTo
              WHEN Key-Status = 1003
                 PERFORM pb-ritorna-LinkTo
              WHEN Key-Status = 2
                 PERFORM NUOVO-LinkTo
              WHEN Key-Status = 4
                 PERFORM CANCELLA-LinkTo
              WHEN Key-Status = 3
                 PERFORM TOOL-SALVA-LinkTo
              WHEN Key-Status = 6
                 PERFORM ANTEPRIMA-LinkTo
              WHEN Key-Status = 150
                 PERFORM TOOL-MODIFICA-LinkTo
              WHEN Key-Status = 7
                 PERFORM STAMPA-LinkTo
              WHEN Key-Status = 8
                 PERFORM TOOL-CERCA-LinkTo
              WHEN Key-Status = 9
                 PERFORM TOOL-SELEZIONA-LinkTo
              WHEN Key-Status = 1002
                 PERFORM TOOL-PRIMO
              WHEN Key-Status = 67
                 PERFORM TOOL-PRECEDENTE
              WHEN Key-Status = 68
                 PERFORM TOOL-SUCCESSIVO
              WHEN Key-Status = 1006
                 PERFORM TOOL-ULTIMO
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       Form1-CLEAR.
           PERFORM Form1-INIT-VALUE
           PERFORM Form1-DISPLAY
           .

       Form1-DISPLAY.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY Form1-Tb-1
           DISPLAY Form1 UPON form1-Handle
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterDisplay>
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       Form1-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeExit>
           if nuovo and win-lines = 78-WinLinesWith
              display message"Ritornare all'inserimento dei componenti?"
                        title titolo
                         type mb-ok-cancel
                       giving scelta
              evaluate scelta
              when mb-ok move 78-WinLinesWithout to win-lines
                         modify form1-handle, lines win-lines
                         perform PULISCI-ARTICOLO-FINALE
                         perform CANCELLA-COLORE
                         move 78-ID-form1-gd-1 to control-id
                         move 4 to accept-control
                         move 2 to colonna
                         move 2 to riga
                         modify form1-gd-1, cursor-y = riga,
                                            cursor-x = colonna
                         perform COLORE-RIGA
                         move 0 to v-riga
                         display ef-art-2 ef-mag-2 ef-imb-2 ef-peso-2
                                 ef-peso-utf-2 ef-peso-non-utf-2 ef-mp-2
                                 pb-ritorna lab-des-2
                         modify pb-ritorna, bitmap-number = 1
                         move 1 to e-genera
                         move 1 to BitmapNumGenera
                         modify pb-genera, enabled = e-genera
                                     bitmap-number = BitmapNumGenera
              when other continue
              end-evaluate
              move 26 to key-status
              exit paragraph

              move 1 to e-genera
              move 1 to BitmapNumGenera
              modify pb-genera, enabled = e-genera,
                          bitmap-number = BitmapNumGenera
           else          
              perform SALV-MOD

              if errori
                 move 26 to key-status
                 exit paragraph
              end-if

           end-if.

           .
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       Form1-Init-Data.
           MOVE 1 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
      * GRID
           PERFORM form1-Gd-1-Content
           .

       Form1-DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-distinteb-KEY1-ORDER
           END-EVALUATE
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-distinteb-KEY1-ORDER
           END-EVALUATE
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Update-Key.
           MOVE dis-rec OF distinteb TO
                     Form1-MULKEY-TMPBUF
           PERFORM Form1-CLEAR
           PERFORM Form1-INIT-DATA
           MOVE Form1-MULKEY-TMPBUF TO
                     dis-rec OF distinteb
           PERFORM DataSet1-distinteb-Read
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-CURR
           PERFORM Form1-IUD-Display
           .

       Form1-DUPLICATE-MOVEKEY.
           .

       Form1-First.
           PERFORM Form1-DUMMY-FIRST
           PERFORM DataSet1-distinteb-INITSTART
           PERFORM DataSet1-distinteb-START
           IF NOT Valid-STATUS-distinteb
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeFirst>
      * <TOTEM:END>
           PERFORM DataSet1-distinteb-Read-Next
           IF NOT Valid-STATUS-distinteb
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterFirst>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY.
           PERFORM Form1-IUD-Display
           .

       Form1-Previous.
              PERFORM Form1-Buf-To-Fld
              PERFORM DataSet1-distinteb-START-LESS
           IF NOT Valid-STATUS-distinteb
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforePrevious>
      * <TOTEM:END>
           PERFORM DataSet1-distinteb-Read-Prev
           IF NOT Valid-STATUS-distinteb
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterPrevious>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-PREVIOUS
           PERFORM Form1-IUD-Display
           .

       Form1-Next.
              PERFORM Form1-Buf-To-Fld
              PERFORM DataSet1-distinteb-START-GREATER
           IF NOT Valid-STATUS-distinteb
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeNext>
      * <TOTEM:END>
           PERFORM DataSet1-distinteb-Read-Next
           IF NOT Valid-STATUS-distinteb
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterNext>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-NEXT
           PERFORM Form1-IUD-Display
           .
      
       Form1-Last.
           PERFORM Form1-DUMMY-LAST
           PERFORM DataSet1-distinteb-INITEND
           PERFORM DataSet1-distinteb-START-NOTGREATER
           IF NOT Valid-STATUS-distinteb
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeLast>
      * <TOTEM:END>
           PERFORM DataSet1-distinteb-Read-Prev
           IF NOT Valid-STATUS-distinteb
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterLast>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY.
           PERFORM Form1-IUD-Display
           .

       Form1-Curr.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeCurrent>
      * <TOTEM:END>
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-distinteb-Read
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-CURR
           PERFORM Form1-IUD-Display
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterCurrent>
      * <TOTEM:END>
           .

       Form1-IUD-Display.
           IF Valid-STATUS-distinteb
              PERFORM Form1-ALLGRID-RESET
              PERFORM Form1-Fld-To-Buf
              PERFORM Form1-NAVI-FOR-MASTERGRID
              PERFORM Form1-DISPLAY
           ELSE
              IF Form1-FLAG-REFRESH
                 CONTINUE
              ELSE
                 PERFORM Form1-Extended-File-Status
              END-IF
           END-IF
           .

       Form1-Add.
           PERFORM Form1-Buf-To-Fld
           PERFORM Form1-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM Form1-DUMMY-ADD
           PERFORM DataSet1-distinteb-INITREC
           PERFORM Form1-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeAdd>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-distinteb-Rec-Write
           IF Valid-STATUS-distinteb
              PERFORM Form1-RESUMMARY-INS
              PERFORM Form1-DUMMY-UPDATE-INIT
              MOVE "301" TO TOTEM-MSG-ID
              PERFORM Form1-IUD-Display
           END-IF
           PERFORM Form1-ERR-CHECKING
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterAdd>
      * <TOTEM:END>
           .
     
       Form1-Update.
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-distinteb-START              
           IF NOT Valid-STATUS-distinteb
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
           PERFORM DataSet1-distinteb-Read
           PERFORM Form1-Buf-To-Fld
           PERFORM Form1-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM Form1-DUMMY-UPDATE
           PERFORM Form1-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeUpdate>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-distinteb-Rec-Rewrite
           IF Valid-STATUS-distinteb
              PERFORM Form1-RESUMMARY-DEL
              PERFORM Form1-DUMMY-UPDATE-INIT
              MOVE "302" TO TOTEM-MSG-ID
              PERFORM Form1-IUD-Display
           END-IF
           PERFORM Form1-ERR-CHECKING
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterUpdate>
      * <TOTEM:END>
           .

       Form1-Delete.
           MOVE "203" TO TOTEM-MSG-ID
           PERFORM MESSAGE-BOX-DISPLAY
           IF TOTEM-MSG-RETURN-VALUE NOT = 1
              INITIALIZE TOTEM-MSG-TEXT
              EXIT PARAGRAPH 
           END-IF
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDelete>
      * <TOTEM:END>
           PERFORM Form1-DUMMY-DELETE
      * delete
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-distinteb-Rec-Delete
           IF Valid-STATUS-distinteb
              PERFORM Form1-CLEAR
              PERFORM Form1-DUMMY-DELETE-INIT
              MOVE "303" TO TOTEM-MSG-ID
              MOVE "00" to STATUS-distinteb
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterDelete>
      * <TOTEM:END>
           PERFORM Form1-ERR-CHECKING
           .

       Form1-NAVI-FOR-MASTERGRID.
           .

       Form1-ERR-CHECKING.
           IF Valid-STATUS-distinteb
              PERFORM Form1-SHOW-MSG-ROUTINE
           ELSE
              PERFORM Form1-Extended-File-Status
           END-IF
           .

       Form1-RESUMMARY-INS.
           .

       Form1-RESUMMARY-DEL.
           .


       Form1-DUMMY-FIRST.
           .

       Form1-DUMMY-PREVIOUS.
           .

       Form1-DUMMY-NEXT.
           .

       Form1-DUMMY-LAST.
           .

       Form1-DUMMY-CURR.
           .

       Form1-DUMMY-ADD.
           .

       Form1-DUMMY-UPDATE.
           .

       Form1-DUMMY-UPDATE-INIT.
           .

       Form1-DUMMY-DELETE.
           .

       Form1-DUMMY-DELETE-INIT.
           .

       Form1-Init-Value.
           MOVE titolo TO TOTEM-MSG-TITLE
           INITIALIZE Form1-BUF
      * FORM : Form1
           PERFORM DataSet1-INIT-RECORD
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, SetDefault>
      * <TOTEM:END>
           PERFORM Form1-FLD-TO-BUF
           .


       Form1-ALLGRID-RESET.
           .

      * for Form's Validation
       Form1-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
      * ef-art's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-art-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5002 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-art-2's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-art-2-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5003 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-mag-2's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-mag-2-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5004 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-imb-2's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-imb-2-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5005 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-mag's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-mag-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5006 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-imb's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-imb-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5007 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-peso's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-peso-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5008 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-peso-utf's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-peso-utf-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5009 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-peso-non-utf's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-peso-non-utf-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5010 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-mp's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-mp-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5011 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-peso-2's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-peso-2-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5013 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-peso-utf-2's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-peso-utf-2-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5014 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-peso-non-utf-2's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-peso-non-utf-2-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5015 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-mp-2's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-mp-2-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5016 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
           .

       ef-art-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-art, BeforeValidation>
      * <TOTEM:END>
           .

       ef-art-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-art, AfterValidation>
      * <TOTEM:END>
           .

      * ef-art's Validation
       ef-art-VALIDATION.
           PERFORM ef-art-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-art-AFTER-VALIDATION
           .

       ef-art-2-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-art-2, BeforeValidation>
      * <TOTEM:END>
           .

       ef-art-2-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-art-2, AfterValidation>
      * <TOTEM:END>
           .

      * ef-art-2's Validation
       ef-art-2-VALIDATION.
           PERFORM ef-art-2-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-art-2-AFTER-VALIDATION
           .

       ef-mag-2-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-mag-2, BeforeValidation>
      * <TOTEM:END>
           .

       ef-mag-2-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-mag-2, AfterValidation>
      * <TOTEM:END>
           .

      * ef-mag-2's Validation
       ef-mag-2-VALIDATION.
           PERFORM ef-mag-2-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-mag-2-AFTER-VALIDATION
           .

       ef-imb-2-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-imb-2, BeforeValidation>
      * <TOTEM:END>
           .

       ef-imb-2-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-imb-2, AfterValidation>
      * <TOTEM:END>
           .

      * ef-imb-2's Validation
       ef-imb-2-VALIDATION.
           PERFORM ef-imb-2-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-imb-2-AFTER-VALIDATION
           .

       ef-mag-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-mag, BeforeValidation>
      * <TOTEM:END>
           .

       ef-mag-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-mag, AfterValidation>
      * <TOTEM:END>
           .

      * ef-mag's Validation
       ef-mag-VALIDATION.
           PERFORM ef-mag-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-mag-AFTER-VALIDATION
           .

       ef-imb-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-imb, BeforeValidation>
      * <TOTEM:END>
           .

       ef-imb-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-imb, AfterValidation>
      * <TOTEM:END>
           .

      * ef-imb's Validation
       ef-imb-VALIDATION.
           PERFORM ef-imb-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-imb-AFTER-VALIDATION
           .

       ef-peso-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-peso, BeforeValidation>
      * <TOTEM:END>
           .

       ef-peso-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-peso, AfterValidation>
      * <TOTEM:END>
           .

      * ef-peso's Validation
       ef-peso-VALIDATION.
           PERFORM ef-peso-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-peso-AFTER-VALIDATION
           .

       ef-peso-utf-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-peso-utf, BeforeValidation>
      * <TOTEM:END>
           .

       ef-peso-utf-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-peso-utf, AfterValidation>
      * <TOTEM:END>
           .

      * ef-peso-utf's Validation
       ef-peso-utf-VALIDATION.
           PERFORM ef-peso-utf-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-peso-utf-AFTER-VALIDATION
           .

       ef-peso-non-utf-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-peso-non-utf, BeforeValidation>
      * <TOTEM:END>
           .

       ef-peso-non-utf-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-peso-non-utf, AfterValidation>
      * <TOTEM:END>
           .

      * ef-peso-non-utf's Validation
       ef-peso-non-utf-VALIDATION.
           PERFORM ef-peso-non-utf-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-peso-non-utf-AFTER-VALIDATION
           .

       ef-mp-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-mp, BeforeValidation>
      * <TOTEM:END>
           .

       ef-mp-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-mp, AfterValidation>
      * <TOTEM:END>
           .

      * ef-mp's Validation
       ef-mp-VALIDATION.
           PERFORM ef-mp-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-mp-AFTER-VALIDATION
           .

       ef-peso-2-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-peso-2, BeforeValidation>
      * <TOTEM:END>
           .

       ef-peso-2-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-peso-2, AfterValidation>
      * <TOTEM:END>
           .

      * ef-peso-2's Validation
       ef-peso-2-VALIDATION.
           PERFORM ef-peso-2-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-peso-2-AFTER-VALIDATION
           .

       ef-peso-utf-2-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-peso-utf-2, BeforeValidation>
      * <TOTEM:END>
           .

       ef-peso-utf-2-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-peso-utf-2, AfterValidation>
      * <TOTEM:END>
           .

      * ef-peso-utf-2's Validation
       ef-peso-utf-2-VALIDATION.
           PERFORM ef-peso-utf-2-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-peso-utf-2-AFTER-VALIDATION
           .

       ef-peso-non-utf-2-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-peso-non-utf-2, BeforeValidation>
      * <TOTEM:END>
           .

       ef-peso-non-utf-2-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-peso-non-utf-2, AfterValidation>
      * <TOTEM:END>
           .

      * ef-peso-non-utf-2's Validation
       ef-peso-non-utf-2-VALIDATION.
           PERFORM ef-peso-non-utf-2-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-peso-non-utf-2-AFTER-VALIDATION
           .

       ef-mp-2-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-mp-2, BeforeValidation>
      * <TOTEM:END>
           .

       ef-mp-2-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-mp-2, AfterValidation>
      * <TOTEM:END>
           .

      * ef-mp-2's Validation
       ef-mp-2-VALIDATION.
           PERFORM ef-mp-2-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-mp-2-AFTER-VALIDATION
           .


       Form1-Buf-To-Fld.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeBufToFld>
      * <TOTEM:END>
      * DB_Entry-Field : ef-art
           MOVE ef-art-BUF TO dis-articolo-finale
      * DB_Entry-Field : ef-art-2
           MOVE ef-art-2-BUF TO dis-articolo-finale
      * DB_Entry-Field : ef-mag-2
           MOVE ef-mag-2-BUF TO dis-magazzino-finale
      * DB_Entry-Field : ef-imb-2
           MOVE ef-imb-2-BUF TO dis-imballo-finale
      * DB_Entry-Field : ef-mag
           MOVE ef-mag-BUF TO dis-magazzino-finale
      * DB_Entry-Field : ef-imb
           MOVE ef-imb-BUF TO dis-imballo-finale
      * DB_Entry-Field : ef-peso
           MOVE ef-peso-BUF TO dis-peso-finale
      * DB_Entry-Field : ef-peso-utf
           MOVE ef-peso-utf-BUF TO dis-peso-utf
      * DB_Entry-Field : ef-peso-non-utf
           MOVE ef-peso-non-utf-BUF TO dis-peso-non-utf
      * DB_Entry-Field : ef-mp
           MOVE ef-mp-BUF TO dis-prezzo
      * DB_Entry-Field : ef-peso-2
           MOVE ef-peso-2-BUF TO dis-peso-finale
      * DB_Entry-Field : ef-peso-utf-2
           MOVE ef-peso-utf-2-BUF TO dis-peso-utf
      * DB_Entry-Field : ef-peso-non-utf-2
           MOVE ef-peso-non-utf-2-BUF TO dis-peso-non-utf
      * DB_Entry-Field : ef-mp-2
           MOVE ef-mp-2-BUF TO dis-prezzo
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterBufToFld>
           move 1 to riga.
           move 0 to idx.
           perform 10 times
              add 1 to idx
              add 1 to riga
              perform VALORE-RIGA
              perform GRID-TO-FLD
           end-perform.

           if v-riga = 0
              move ef-art-buf             to dis-articolo-finale
              move ef-mag-buf             to dis-magazzino-finale
              move ef-imb-buf             to dis-imballo-finale
              move ef-peso-buf            to dis-peso-finale
              move ef-peso-utf-buf        to dis-peso-utf
              move ef-peso-non-utf-buf    to dis-peso-non-utf
              move ef-mp-buf              to dis-prezzo
           else
              move ef-art-2-buf           to dis-articolo-finale
              move ef-mag-2-buf           to dis-magazzino-finale
              move ef-imb-2-buf           to dis-imballo-finale
              move ef-peso-2-buf          to dis-peso-finale
              move ef-peso-utf-2-buf      to dis-peso-utf
              move ef-peso-non-utf-2-buf  to dis-peso-non-utf
              move ef-mp-2-buf            to dis-prezzo
           end-if.

           .
      * <TOTEM:END>
           .

       Form1-Fld-To-Buf.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeFldToBuf>
      * <TOTEM:END>
      * DB_Entry-Field : ef-art
           MOVE dis-articolo-finale TO ef-art-BUF
      * DB_Entry-Field : ef-art-2
           MOVE dis-articolo-finale TO ef-art-2-BUF
      * DB_Entry-Field : ef-mag-2
           MOVE dis-magazzino-finale TO ef-mag-2-BUF
      * DB_Entry-Field : ef-imb-2
           MOVE dis-imballo-finale TO ef-imb-2-BUF
      * DB_Entry-Field : ef-mag
           MOVE dis-magazzino-finale TO ef-mag-BUF
      * DB_Entry-Field : ef-imb
           MOVE dis-imballo-finale TO ef-imb-BUF
      * DB_Entry-Field : ef-peso
           MOVE dis-peso-finale TO ef-peso-BUF
      * DB_Entry-Field : ef-peso-utf
           MOVE dis-peso-utf TO ef-peso-utf-BUF
      * DB_Entry-Field : ef-peso-non-utf
           MOVE dis-peso-non-utf TO ef-peso-non-utf-BUF
      * DB_Entry-Field : ef-mp
           MOVE dis-prezzo TO ef-mp-BUF
      * DB_Entry-Field : ef-peso-2
           MOVE dis-peso-finale TO ef-peso-2-BUF
      * DB_Entry-Field : ef-peso-utf-2
           MOVE dis-peso-utf TO ef-peso-utf-2-BUF
      * DB_Entry-Field : ef-peso-non-utf-2
           MOVE dis-peso-non-utf TO ef-peso-non-utf-2-BUF
      * DB_Entry-Field : ef-mp-2
           MOVE dis-prezzo TO ef-mp-2-BUF
      * DB_LABEL : lab-numero
              MOVE dis-codice  TO lab-numero-BUF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterFldToBuf>
           perform ABILITAZIONI.

           perform VALORIZZA-OLD.

           perform CARICA-GRID.

           move 0 to e-azzera.
           move 6 to BitmapNumAzzera.
           modify pb-azzera, bitmap-number BitmapNumAzzera,
                             enabled       e-azzera.

           if win-lines = 78-WinLinesWithout and
              status-distinteb = "00"|se ho trovato il record
              move 78-WinLinesWith    to win-lines
              modify form1-handle, lines win-lines
           end-if.

           if nuovo move 1 to v-esc
           else     move 0 to v-esc
           end-if.

           if mod = 1
              if nuovo
                 move 1 to e-genera
                 move 1 to BitmapNumGenera
              else
                 move 0 to e-genera
                 move 3 to BitmapNumGenera
              end-if
           else
              move 0 to e-genera
              move 3 to BitmapNumGenera
           end-if.

           modify pb-genera, bitmap-number BitmapNumGenera,
                             enabled       e-genera.

           move dis-articolo-finale to art-codice.
           perform DESCRIZIONE-ARTICOLO.
           move descr-articolo to lab-des-buf.

           .
      * <TOTEM:END>
           .

       Form1-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform Form1-BUF-TO-FLD.
           move 0 to scelta.
           if dis-prezzo not = old-dis-prezzo
              and SiSalvato
              set NoSalvato to true
              |78-ID-ef-mp è l'ID del campo ef-mp
              move 78-ID-ef-mp to store-id 
           end-if

           .
       Form1-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM Form1-SHOW-MSG-ROUTINE
           .

       Form1-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM Form1-DISPLAY-MESSAGE
           .

       Form1-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       Form1-Save-Status.
           MOVE DataSet1-distinteb-KEY1-ORDER TO TMP-Form1-KEY1-ORDER
           MOVE DataSet1-KEYIS TO TMP-Form1-KEYIS
           MOVE dis-rec OF distinteb TO 
              TMP-Form1-distinteb-RESTOREBUF
           .             

       Form1-Restore-Status.
           MOVE TMP-Form1-KEY1-ORDER TO DataSet1-distinteb-KEY1-ORDER
           MOVE TMP-Form1-KEYIS TO DataSet1-KEYIS
           MOVE TMP-Form1-distinteb-RESTOREBUF TO
              dis-rec OF distinteb
           PERFORM DataSet1-distinteb-START
           IF Valid-STATUS-distinteb
              PERFORM DataSet1-distinteb-Read-Next
           ELSE
              PERFORM DataSet1-distinteb-INITREC
           END-IF
           PERFORM UNTIL NOT Valid-STATUS-distinteb OR
              (Valid-STATUS-distinteb AND
                 dis-rec OF distinteb = 
                   TMP-Form1-distinteb-RESTOREBUF)
              PERFORM DataSet1-distinteb-Read-Next
           END-PERFORM
           .


      * Paragrafo per la struttura del codice in BEFORE sulla screen Form1
      ***---
       Form1-BEFORE-SCREEN.
           evaluate control-id
           |78-ID-ef-art è l'ID del campo ef-art
           when 78-ID-ef-art
                move 1 to StatusHelp
                perform STATUS-HELP
           |78-ID-ef-art-2 è l'ID del campo ef-art-2
           when 78-ID-ef-art-2
                move 1 to StatusHelp
                perform STATUS-HELP
           |78-ID-ef-mag-2 è l'ID del campo ef-mag-2
           when 78-ID-ef-mag-2
                move 1 to StatusHelp
                perform STATUS-HELP
           |78-ID-ef-imb-2 è l'ID del campo ef-imb-2
           when 78-ID-ef-imb-2
                move 1 to StatusHelp
                perform STATUS-HELP
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella BEFORE della screen
           when 99999 continue
           when other continue
           end-evaluate.

      * Generazione settaggio keyboard "." ---> ","

      * Paragrafo per la struttura del codice in AFTER sulla screen Form1
      ***---
       Form1-AFTER-SCREEN.
           evaluate control-id
           |78-ID-ef-art è l'ID del campo ef-art
           when 78-ID-ef-art
                move 0 to StatusHelp
                perform STATUS-HELP

           |78-ID-ef-art-2 è l'ID del campo ef-art-2
           when 78-ID-ef-art-2
                move 0 to StatusHelp
                perform STATUS-HELP

           |78-ID-ef-mag-2 è l'ID del campo ef-mag-2
           when 78-ID-ef-mag-2
                move 0 to StatusHelp
                perform STATUS-HELP

           |78-ID-ef-imb-2 è l'ID del campo ef-imb-2
           when 78-ID-ef-imb-2
                move 0 to StatusHelp
                perform STATUS-HELP

           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER della screen
           when 99999 continue
           when other continue
           end-evaluate.

      * Generazione risettaggio keyboard "." ---> "."

      * Generazione stringa perform CONTROLLO
           evaluate control-id
           |78-ID-ef-art è l'ID del campo ef-art
           when 78-ID-ef-art
                perform CONTROLLO
           |78-ID-ef-art-2 è l'ID del campo ef-art-2
           when 78-ID-ef-art-2
                perform CONTROLLO
           |78-ID-ef-mag-2 è l'ID del campo ef-mag-2
           when 78-ID-ef-mag-2
                perform CONTROLLO
           |78-ID-ef-imb-2 è l'ID del campo ef-imb-2
           when 78-ID-ef-imb-2
                perform CONTROLLO
           |78-ID-ef-mag è l'ID del campo ef-mag
           when 78-ID-ef-mag
                perform CONTROLLO
           |78-ID-ef-imb è l'ID del campo ef-imb
           when 78-ID-ef-imb
                perform CONTROLLO
           |78-ID-ef-peso-2 è l'ID del campo ef-peso-2
           when 78-ID-ef-peso-2
                perform CONTROLLO
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER CONTROLLO della screen
           when 99999 continue
           when other continue
           end-evaluate.



       Form1-BeforeProcedure.
           EVALUATE Control-Id
           WHEN 5001 MOVE totem-hint-text to TOTEM-HINT-TEXT
           WHEN 5002 MOVE "Digitare il codice dell'articolo" to 
           TOTEM-HINT-TEXT
           WHEN 5003 MOVE "Digitare il codice dell'articolo" to 
           TOTEM-HINT-TEXT
           WHEN 5004 MOVE "Digitare il codice Magazzino" to 
           TOTEM-HINT-TEXT
           WHEN 5005 MOVE "Digitare il codice dell'imballaggio" to 
           TOTEM-HINT-TEXT
           WHEN 5006 MOVE "Codice Magazzino" to TOTEM-HINT-TEXT
           WHEN 5007 MOVE "Codice Imballaggio" to TOTEM-HINT-TEXT
           WHEN 5008 MOVE "Valore Peso" to TOTEM-HINT-TEXT
           WHEN 5009 MOVE "Valore Peso UTF" to TOTEM-HINT-TEXT
           WHEN 5010 MOVE "Valore Peso non UTF" to TOTEM-HINT-TEXT
           WHEN 5011 MOVE "Somma Prezzo MP dei componenti" to 
           TOTEM-HINT-TEXT
           WHEN 5012 MOVE "Somma Oneri Accessori dei componenti" to 
           TOTEM-HINT-TEXT
           WHEN 5013 MOVE "Peso totale" to TOTEM-HINT-TEXT
           WHEN 5014 MOVE "Valore Peso UTF" to TOTEM-HINT-TEXT
           WHEN 5015 MOVE "Valore Peso non UTF" to TOTEM-HINT-TEXT
           WHEN 5016 MOVE "Somma Prezzo MP dei componenti" to 
           TOTEM-HINT-TEXT
           WHEN 5017 MOVE "Somma Oneri Accessori dei componenti" to 
           TOTEM-HINT-TEXT
           WHEN OTHER MOVE SPACES TO TOTEM-HINT-TEXT
           END-EVALUATE
           EVALUATE Control-Id
           When 5001 PERFORM form1-Gd-1-BeforeProcedure
           When 5002 PERFORM ef-art-BeforeProcedure
           When 5003 PERFORM ef-art-2-BeforeProcedure
           When 5004 PERFORM ef-mag-2-BeforeProcedure
           When 5005 PERFORM ef-imb-2-BeforeProcedure
           When 5006 PERFORM ef-mag-BeforeProcedure
           When 5007 PERFORM ef-imb-BeforeProcedure
           When 5008 PERFORM ef-peso-BeforeProcedure
           When 5009 PERFORM ef-peso-utf-BeforeProcedure
           When 5010 PERFORM ef-peso-non-utf-BeforeProcedure
           When 5011 PERFORM ef-mp-BeforeProcedure
           When 5012 PERFORM Screen1-Ef-1-BeforeProcedure
           When 5013 PERFORM ef-peso-2-BeforeProcedure
           When 5014 PERFORM ef-peso-utf-2-BeforeProcedure
           When 5015 PERFORM ef-peso-non-utf-2-BeforeProcedure
           When 5016 PERFORM ef-mp-2-BeforeProcedure
           When 5017 PERFORM Screen1-Ef-1-BeforeProcedure
           END-EVALUATE
           PERFORM Form1-DISPLAY-STATUS-MSG
           perform Form1-BEFORE-SCREEN
           .

       Form1-AfterProcedure.
           EVALUATE Control-Id
           When 5002 PERFORM ef-art-AfterProcedure
           When 5003 PERFORM ef-art-2-AfterProcedure
           When 5004 PERFORM ef-mag-2-AfterProcedure
           When 5005 PERFORM ef-imb-2-AfterProcedure
           When 5006 PERFORM ef-mag-AfterProcedure
           When 5007 PERFORM ef-imb-AfterProcedure
           When 5008 PERFORM ef-peso-AfterProcedure
           When 5009 PERFORM ef-peso-utf-AfterProcedure
           When 5010 PERFORM ef-peso-non-utf-AfterProcedure
           When 5011 PERFORM ef-mp-AfterProcedure
           When 5013 PERFORM ef-peso-2-AfterProcedure
           When 5014 PERFORM ef-peso-utf-2-AfterProcedure
           When 5015 PERFORM ef-peso-non-utf-2-AfterProcedure
           When 5016 PERFORM ef-mp-2-AfterProcedure
           END-EVALUATE
           perform Form1-AFTER-SCREEN
           .

       Screen1-Event-Proc.
           .

       Screen1-Gd-1-Event-Proc.
           EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
           WHEN Msg-Begin-Drag ALSO 5001 ALSO
                    form1-Handle 
              PERFORM form1-Gd-1-Ev-Msg-Begin-Drag
           WHEN Msg-Begin-Entry ALSO 5001 ALSO
                    form1-Handle 
              PERFORM form1-Gd-1-Ev-Msg-Begin-Entry
           WHEN Msg-Cancel-Entry ALSO 5001 ALSO
                    form1-Handle 
              PERFORM form1-Gd-1-Ev-Msg-Cancel-Entry
           WHEN Msg-End-Drag ALSO 5001 ALSO
                    form1-Handle 
              PERFORM form1-Gd-1-Ev-Msg-End-Drag
           WHEN Msg-Finish-Entry ALSO 5001 ALSO
                    form1-Handle 
              PERFORM form1-Gd-1-Ev-Msg-Finish-Entry
           WHEN Msg-Goto-Cell ALSO 5001 ALSO
                    form1-Handle 
              PERFORM form1-Gd-1-Ev-Msg-Goto-Cell
           WHEN Msg-Goto-Cell-Drag ALSO 5001 ALSO
                    form1-Handle 
              PERFORM form1-Gd-1-Ev-Msg-Goto-Cell-Drag
           WHEN Msg-Goto-Cell-Mouse ALSO 5001 ALSO
                    form1-Handle 
              PERFORM form1-Gd-1-Ev-Msg-Goto-Cell-Mouse
           END-EVALUATE
           .

      * USER DEFINE PARAGRAPH
       ABILITAZIONI.
      * <TOTEM:PARA. ABILITAZIONI>
           if mod = 1              
              move BitmapDeleteEnabled to BitmapNumDelete
              move BitmapSaveEnabled   to BitmapNumSave
              move 1 to e-salva e-cancella
           else
              move BitmapDeleteDisabled to BitmapNumDelete
              move BitmapSaveDisabled   to BitmapNumSave
              move 0                    to e-salva e-cancella
           end-if.      

      * ISACCO (CORREZIONE SU LIVELLO ABILITAZIONE 2) - 10/11/2003
      * (CANCELLAZIONE NON PERMESSA)
           evaluate livello-abil
           when 1
                move 0 to e-cancella
                move BitmapDeleteDisabled to BitmapNumDelete

                move 0 to e-salva
                move BitmapSaveDisabled   to BitmapNumSave
                
                move 0 to e-nuovo
                move BitmapNewDisabled    to BitmapNumNew

                move 0 to e-modifica
                move BitmapEditDisabled   to BitmapNumEdit
           when 2
                move 0 to e-cancella
                move BitmapDeleteDisabled to BitmapNumDelete
           end-evaluate.
      * FINE

           modify tool-cancella, enabled = e-cancella.
           modify tool-salva,    enabled = e-salva.
       
      * ISACCO (SERVE SEMPRE PER LA MODIFICA PRCEDENTE E PER RIPRISTINARE
      * LE BITMAP DISABILITATE. - 10/11/2003
      *     perform FORM1-DISPLAY.
           display tool-nuovo, tool-salva, tool-cancella, tool-modifica.
      * FINE 
           .
      * <TOTEM:END>

       ANTEPRIMA.
      * <TOTEM:PARA. ANTEPRIMA>
           continue 
           .
      * <TOTEM:END>

       CALCOLA-TOTALI-GRID.
      * <TOTEM:PARA. CALCOLA-TOTALI-GRID>
           move 0 to somma-peso 
                     somma-utf 
                     somma-non-utf 
                     somma-prezzo
                     somma-oneri.

           perform varying riga from 2 by 1
                     until riga > tot-righe
              perform VALORE-RIGA
              move col-peso    to como-peso
              move col-utf     to como-utf
              move col-non-utf to como-non-utf
              move col-mp      to como-prezzo
              move col-qta     to como-qta

              move como-qta to qta-arrotondata
              move como-qta(9:3) to decimali
              if decimali > 500
                 add 1 to qta-arrotondata
              end-if

              compute somma-prezzo =
                      somma-prezzo + ( como-prezzo   * qta-arrotondata )
              compute somma-oneri  =
                      somma-oneri  + ( col-oneri-num * qta-arrotondata )

LUBEXX        if hid-NoSomma move 0 to como-qta end-if

              compute somma-peso    =
                      somma-peso    + ( como-peso     * como-qta )
              compute somma-utf     =
                      somma-utf     + ( como-utf      * como-qta )
              compute somma-non-utf =
                      somma-non-utf + ( como-non-utf  * como-qta )

           end-perform.

           move somma-peso    to ef-peso-buf peso-totale.
           move somma-utf     to ef-peso-utf-buf.
           move somma-non-utf to ef-peso-non-utf-buf.
           move somma-prezzo  to ef-mp-buf.
           move somma-oneri   to ef-oneri-buf.

           display ef-peso 
                   ef-peso-utf 
                   ef-peso-non-utf 
                   ef-mp
                   ef-oneri
                   lab-esc 
           .
      * <TOTEM:END>

       CANCELLA.
      * <TOTEM:PARA. CANCELLA>
           if mod = 0 exit paragraph end-if.
      *
           display message box MSg-Cancellare-il-record-corrente
                   title   titolo
                   type    mb-yes-no 
                   default mb-no
                   giving  scelta

           if scelta = mb-yes
              perform RIEMPI-CHIAVE
              delete distinteb record invalid continue end-delete     
              move 0 to mod
              move 1 to mod-k
              perform FORM1-CLEAR
              set vecchio to true
              perform CANCELLA-COLORE
              perform INIT-OLD-REC

              
              display message box 
           MSG-Cancellazione-avvenuta-con-successo
                      title titolo                         

              unlock distinteb all records

              perform PRIMO 
              move 78-ID-form1-gd-1 to  CONTROL-ID     
              move 4                to  ACCEPT-CONTROL 

              set Statusvisua to true
              perform STATUS-BAR-MSG
              modify TOOL-MODIFICA value = mod
           end-if 
           .
      * <TOTEM:END>

       CARICA-GRID.
      * <TOTEM:PARA. CARICA-GRID>
           inquire form1-gd-1, cursor-y in store-riga, 
                               cursor-x in store-colonna.

           perform RESETTA-GRID.

           move 1 to idx.
           move 1 to riga.
           move 0 to como-oneri
                     somma-oneri 
                     somma-utf 
                     somma-non-utf 
                     somma-prezzo.

           modify form1-gd-1, mass-update = 1.
           perform varying idx from 1 by 1
                     until idx > 10
              add 1 to riga
              initialize rec-grid replacing numeric data by zeroes
                                       alphanumeric data by spaces
              if dis-articolo(idx) = 0 exit perform end-if
              move dis-articolo(idx)   to   col-art art-codice
              move dis-magazzino(idx)  to   col-mag
              move dis-peso(idx)       to   col-peso
              move dis-imballo(idx)    to   col-imb
              move dis-qta(idx)        to   col-qta
              move dis-oneri(idx)      to   col-oneri

LUBEXX        move dis-somma-peso(idx) to   hid-somma
LUBEXX        if dis-si-somma(idx)
LUBEXX           modify form1-gd-1(riga, 12), bitmap spunta-bmp,
LUBEXX                                        bitmap-number = 1,
LUBEXX                                        bitmap-width 16
LUBEXX        else
LUBEXX           modify form1-gd-1(riga, 12), bitmap spunta-bmp
LUBEXX                                        bitmap-number = 2
LUBEXX                                        bitmap-width 16
LUBEXX        end-if
              move art-cod-doganale    to hid-cod-doganale
              move dis-chiave-progmag-el(idx) to prg-chiave
              read progmag  no lock invalid continue end-read

              perform DESCRIZIONE-ARTICOLO
              move descr-articolo      to col-des

              move prg-peso-utf     to col-utf
              move prg-peso-non-utf to col-non-utf
              move spaces to prg-cod-magazzino
              move spaces to prg-tipo-imballo
              move 0      to prg-peso
              read progmag no lock invalid continue end-read
              perform CALCOLA-COSTO-MP
              accept imp-data from century-date

              start timposte key <= imp-chiave
                    invalid continue
                not invalid
                    read timposte previous
              end-start

              perform CALCOLA-COSTO-MP-WHEN-ZERO
              move costo-mp to col-mp
              modify form1-gd-1(riga, 2),  cell-data = col-art
              modify form1-gd-1(riga, 3),  cell-data = col-mag
              modify form1-gd-1(riga, 4),  cell-data = col-imb
              modify form1-gd-1(riga, 5),  cell-data = col-peso
              modify form1-gd-1(riga, 6),  cell-data = col-des 
              modify form1-gd-1(riga, 7),  cell-data = col-utf
              modify form1-gd-1(riga, 8),  cell-data = col-non-utf
              modify form1-gd-1(riga, 9),  cell-data = col-mp
              modify form1-gd-1(riga, 10), cell-data = col-qta
              modify form1-gd-1(riga, 11), cell-data = col-oneri

              modify form1-gd-1(riga, 12), hidden-data = hid-somma
              modify form1-gd-1(riga, 1)   hidden-data = 
           hid-cod-doganale

              move col-qta       to como-qta
              
              move col-utf       to como-utf
              add  como-utf      to somma-utf
              
              move col-non-utf   to como-non-utf
              add  como-non-utf  to somma-non-utf
              
              move col-mp        to como-prezzo
              add  como-prezzo   to somma-prezzo

              move col-oneri     to col-oneri-num
              add  col-oneri-num to somma-oneri

              compute como-oneri = 
                    ( como-qta * col-oneri-num ) + como-oneri
           end-perform.
           move somma-oneri    to ef-tot-oneri-buf.
           move somma-utf      to ef-tot-utf-buf.
           move somma-non-utf  to ef-tot-non-utf-buf.
           move somma-prezzo       to ef-tot-prezzo-buf.

           move como-oneri  to ef-oneri-buf.
           modify form1-gd-1, mass-update = 0.

           perform X-Y.
           if store-riga > tot-righe
              move tot-righe to store-riga
           end-if.

           if store-riga < 2
              move 2 to store-riga
           end-if.

           move store-riga to riga.
           perform COLORE-RIGA.
           modify form1-gd-1, cursor-y = riga, cursor-x = store-colonna 
           .
      * <TOTEM:END>

       CERCA.
      * <TOTEM:PARA. CERCA>
           evaluate control-id
           when 78-ID-form1-gd-1
                perform X-Y
                evaluate colonna
                when 2 
                     inquire form1-gd-1(riga, 2), cell-data in col-art
                     move col-art to SaveArticolo
LUBEXX               set hid-SiSomma to true
                     perform ZOOM-SU-PROGMAG
                     if stato-zoom = 0
                        if vecchio and win-lines = 78-WinLinesWith
                           set FromFinishEntry to true
                        else
                           set FromFinishEntry to false
                        end-if
                        move mb-yes to scelta
                        if SaveProgmagKey not = prg-chiave and
                           FromFinishEntry
                           perform VALORE-OLD-RIGA
                           perform CHIEDI-RIGENERA
                        end-if
                        if scelta = mb-yes
                           move prg-cod-articolo to art-codice
                           perform DESCRIZIONE-ARTICOLO
                           move descr-articolo to col-des
                           modify form1-gd-1(riga, 6), cell-data col-des
                           perform VALORIZZA-FROM-PROGMAG
                           if FromFinishEntry
                              perform CHECK-2-ARTICOLI
                           end-if
                        end-if
                     end-if
                end-evaluate

           when 78-ID-ef-art
                inquire ef-art, value in ef-art-buf
                move ef-art-buf to art-codice SaveArticolo
LUBEXX          set hid-NoSomma to true
                perform ZOOM-SU-PROGMAG
                if stato-zoom = 0
                   if prg-peso not  = peso-totale
                      move 1 to v-riga
                      perform VALORIZZA-ENTRY-FROM-PROGMAG
                   else
                      move 0 to v-riga
                   end-if
                   move prg-cod-articolo  to ef-art-buf art-codice
                   perform DESCRIZIONE-ARTICOLO
                   move descr-articolo    to lab-des-buf

                   move prg-cod-magazzino to ef-mag-buf
                   move prg-tipo-imballo  to ef-imb-buf
                   move prg-peso          to ef-peso-buf
                   move prg-peso-utf      to ef-peso-utf-buf
                   move prg-peso-non-utf  to ef-peso-non-utf-buf

                   display ef-art lab-des ef-imb ef-mag lab-des
                           ef-peso ef-peso-utf ef-peso-non-utf
                           ef-mp ef-oneri
                end-if

           when 78-ID-ef-art-2
                inquire ef-art-2, value in art-codice
                move "articoli"       to como-file
                call "zoom-gt"     using como-file, art-rec
                                  giving stato-zoom
                end-call
                cancel "zoom-gt"
                if stato-zoom = 0
                   move art-codice      to ef-art-2-buf
                   perform DESCRIZIONE-ARTICOLO
                   move descr-articolo  to lab-des-2-buf
                   display ef-art-2 lab-des-2
                end-if

           when 78-ID-ef-mag-2
                inquire ef-mag-2, value in mag-codice
                move "tmagaz"      to como-file
                call "zoom-gt"     using como-file, mag-rec
                                  giving stato-zoom
                end-call
                cancel "zoom-gt"     
                if stato-zoom = 0
                   move mag-codice      to ef-mag-2-buf
                   display ef-mag-2
                end-if

           when 78-ID-ef-imb-2
                inquire ef-imb-2, value in imq-codice
                move "timbalqta"      to como-file
                call "zoom-gt"     using como-file, imq-rec
                                  giving stato-zoom
                end-call
                cancel "zoom-gt"
                if stato-zoom = 0
                   move imq-codice      to ef-imb-2-buf
                   display ef-imb-2
                end-if
           end-evaluate 
           .
      * <TOTEM:END>

       CHECK-2-ARTICOLI.
      * <TOTEM:PARA. CHECK-2-ARTICOLI>
           perform X-Y.
           evaluate true
           when tot-righe < 3
                move 0 to e-genera
                move 3 to BitmapNumGenera
                modify pb-genera, enabled = e-genera,
                            bitmap-number = BitmapNumGenera
           when tot-righe > 3
                if nuovo
                   move 1 to e-genera
                   move 1 to BitmapNumGenera
                   modify pb-genera, enabled = e-genera,
                               bitmap-number = BitmapNumGenera
                end-if
           when tot-righe = 3
                move    1 to riga
                perform 2 times
                   add  1 to riga
                   inquire form1-gd-1(riga, 10), cell-data in como-qta
                   |vuol dire che ho completato 2 righe. La q.tà infatti
                   |per essere maggiore di 0 significa che ho inserito
                   |l'articolo altrimenti non posso nemmeno digitare
                   if como-qta = 0 exit perform end-if
                end-perform
                if como-qta not = 0 and nuovo
                   move 1 to e-genera
                   move 1 to BitmapNumGenera
                   modify pb-genera, enabled = e-genera,
                               bitmap-number = BitmapNumGenera
                end-if
           end-evaluate 
           .
      * <TOTEM:END>

       CHECK-INSERIMENTO.
      * <TOTEM:PARA. CHECK-INSERIMENTO>
      * MODIFICA LA STATUS-BAR
      * CONTROLLO SE DA INSERIMENTO SCORRO. ALLORA DEVO SEGNALARE CHE
      * SONO TORNATO IN MODIFICA.
           inquire tool-modifica, value in mod.

           evaluate mod
           when 1   set StatusModifica to true
           when 0   set StatusVisua    to true   
           end-evaluate.
      
           perform STATUS-BAR-MSG 
           .
      * <TOTEM:END>

       CHIEDI-RIGENERA.
      * <TOTEM:PARA. CHIEDI-RIGENERA>
           display message "Abbinamento non più valido."
                    x"0d0a""Nuovo inserimento?"
                     title titolo
                      type mb-yes-no
                      icon 2
                    giving scelta.
           
           if scelta = mb-no
              move SaveArticolo  to col-art como-articolo art-codice
              move SaveMagazzino to col-mag     
              move SaveImballo   to col-imb     
              move SavePeso      to col-peso    
              move old-utf       to col-utf     
              move old-non-utf   to col-non-utf 
              move old-mp        to col-mp      
              move old-qta       to col-qta     
              move old-oneri     to col-oneri
LUBEXX        move old-somma     to hid-somma
              modify form1-gd-1(riga, 2),  cell-data = col-art
              modify form1-gd-1(riga, 3),  cell-data = col-mag
              modify form1-gd-1(riga, 4),  cell-data = col-imb
              modify form1-gd-1(riga, 5),  cell-data = col-peso
              modify form1-gd-1(riga, 6),  cell-data = col-des
              modify form1-gd-1(riga, 7),  cell-data = col-utf
              modify form1-gd-1(riga, 8),  cell-data = col-non-utf
              modify form1-gd-1(riga, 9),  cell-data = col-mp
              modify form1-gd-1(riga, 10), cell-data = col-qta
              modify form1-gd-1(riga, 11), cell-data = col-oneri
LUBEXX        modify form1-gd-1(riga, 12), hidden-data = hid-somma
LUBEXX        if hid-SiSomma
LUBEXX           modify form1-gd-1(riga, 12), bitmap spunta-bmp,
LUBEXX                                        bitmap-number = 1,
LUBEXX                                        bitmap-width 16
LUBEXX        else
LUBEXX           modify form1-gd-1(riga, 12), bitmap spunta-bmp
LUBEXX                                        bitmap-number = 2
LUBEXX                                        bitmap-width 16
LUBEXX        end-if
           else
              if FromFinishEntryCancPressed
                 modify form1-gd-1, record-to-delete = riga
                 perform FORM1-GD-1-CONTENT
                 move 0 to col-oneri-num
                           prg-peso-non-utf
                           prg-peso-utf
                           costo-mp
                 move col-oneri   to old-oneri
                 move col-mp      to old-mp
                 move col-utf     to old-utf
                 move col-non-utf to old-non-utf
                 set FromFinishEntryCancPressed to false

                 perform SOMMA-TOTALI
                 set hid-NoSomma to true
              else
                 set hid-SiSomma to true
              end-if
              set nuovo to true
              perform INIT-OLD-REC
              perform TROVA-CHIAVE
              perform PULISCI-ARTICOLO-FINALE
              set StatusIns to true
              perform STATUS-BAR-MSG  
              set nuovo to true       
              unlock distinteb all records
              move 1 to e-azzera
              move 4 to BitmapNumAzzera
              modify pb-azzera, bitmap-number BitmapNumAzzera,
                                enabled       e-azzera

              move 0 to e-genera
              move 3 to BitmapNumGenera
              modify pb-genera, bitmap-number BitmapNumGenera,
                                enabled       e-genera

              move 78-WinLinesWithout to win-lines
              modify form1-handle, lines win-lines
           end-if 
           .
      * <TOTEM:END>

       CLEAR-SCREEN.
      * <TOTEM:PARA. CLEAR-SCREEN>
           move dis-codice to old-dis-codice.

           initialize dis-dati replacing numeric data by zeroes
                                    alphanumeric data by spaces.
                         
           perform FORM1-FLD-TO-BUF. 

           perform INIT-OLD-REC.
                                          
           display form1. 
  
           unlock distinteb all records 
           .
      * <TOTEM:END>

       COLORE-RIGA.
      * <TOTEM:PARA. COLORE-RIGA>
           modify form1-gd-1, start-x = 2,
                                    x = 12,
                              start-y = riga,
                                    y = riga,
                         region-color = 257,
                         cursor-color = 481 
           .
      * <TOTEM:END>

       CONTROLLA-ARTICOLO-GIA-INSERITO.
      * <TOTEM:PARA. CONTROLLA-ARTICOLO-GIA-INSERITO>
LUBEXX*****           set tutto-ok to true.
LUBEXX*****           perform X-Y.
LUBEXX*****           perform varying store-riga from 2 by 1 
LUBEXX*****                     until store-riga > tot-righe
LUBEXX*****              inquire form1-gd-1(store-riga, 2), cell-data in articolo
LUBEXX*****              inquire form1-gd-1(store-riga, 3), cell-data in magazzino
LUBEXX*****              inquire form1-gd-1(store-riga, 4), cell-data in imballo
LUBEXX*****              inquire form1-gd-1(store-riga, 5), cell-data in peso
LUBEXX*****              if store-riga not = riga
LUBEXX*****                 if prg-cod-articolo  = articolo  and
LUBEXX*****                    prg-cod-magazzino = magazzino and
LUBEXX*****                    prg-tipo-imballo  = imballo   and
LUBEXX*****                    prg-peso          = peso
LUBEXX*****                    set errori  to true

LUBEXX*****                    inquire form1-gd-1(riga, 7),  
LUBEXX*****                            cell-data in como-utf
LUBEXX*****                    inquire form1-gd-1(riga, 8), 
LUBEXX*****                            cell-data in como-non-utf
LUBEXX*****                    inquire form1-gd-1(riga, 9),  
LUBEXX*****                            cell-data in como-prezzo
LUBEXX*****                    inquire form1-gd-1(riga, 11), 
LUBEXX*****                            cell-data in como-oneri
LUBEXX*****                    inquire ef-tot-utf,     value in somma-utf
LUBEXX*****                    inquire ef-tot-non-utf, value in somma-non-utf
LUBEXX*****                    inquire ef-tot-prezzo,  value in somma-prezzo
LUBEXX*****                    inquire ef-tot-oneri,   value in somma-oneri
LUBEXX*****                    subtract como-utf           from somma-utf
LUBEXX*****                    subtract como-non-utf       from somma-non-utf
LUBEXX*****                    subtract como-prezzo        from somma-prezzo
LUBEXX*****                    subtract como-oneri         from somma-oneri
LUBEXX*****                    move somma-utf     to ef-tot-utf-buf
LUBEXX*****                    move somma-non-utf to ef-tot-non-utf-buf
LUBEXX*****                    move somma-prezzo  to ef-tot-prezzo-buf
LUBEXX*****                    move somma-oneri   to ef-tot-oneri-buf
LUBEXX*****                    subtract 1 from store-riga
LUBEXX*****                    move store-riga to riga-edit
LUBEXX*****                    display message "Articolo già inserito a riga: "
LUBEXX*****                                    riga-edit
LUBEXX*****                              title tit-err
LUBEXX*****                               icon 2
LUBEXX*****                    display ef-tot-utf    ef-tot-non-utf 
LUBEXX*****                            ef-tot-prezzo ef-tot-oneri
LUBEXX*****                    move spaces to col-mag     col-imb col-des
LUBEXX*****                    move 0      to col-peso    col-utf
LUBEXX*****                                   col-non-utf col-mp 
LUBEXX*****                                   col-qta     col-oneri
LUBEXX*****                                   old-utf old-non-utf old-oneri old-mp
LUBEXX*****                    modify form1-gd-1(riga, 3),  cell-data = col-mag
LUBEXX*****                    modify form1-gd-1(riga, 4),  cell-data = col-imb
LUBEXX*****                    modify form1-gd-1(riga, 5),  cell-data = col-peso
LUBEXX*****                    modify form1-gd-1(riga, 6),  cell-data = col-des
LUBEXX*****                    modify form1-gd-1(riga, 7),  cell-data = col-utf
LUBEXX*****                    modify form1-gd-1(riga, 8),  cell-data = col-non-utf
LUBEXX*****                    modify form1-gd-1(riga, 9),  cell-data = col-mp
LUBEXX*****                    modify form1-gd-1(riga, 10), cell-data = col-qta
LUBEXX*****                    modify form1-gd-1(riga, 11), cell-data = col-oneri
LUBEXX*****                    exit perform
LUBEXX*****                 end-if
LUBEXX*****              end-if
LUBEXX*****           end-perform 
           .
      * <TOTEM:END>

       CONTROLLO.
      * <TOTEM:PARA. CONTROLLO>
           set tutto-ok to true.
      
           evaluate CONTROL-ID
           when 78-ID-ef-art
                if win-lines = 78-WinLinesWith
                   inquire ef-art, value in art-codice
                   if art-codice = 0
                      display message "Nuovo articolo?"
                                title titolo
                                 type mb-yes-no
                               giving scelta
                      evaluate scelta 
                      when mb-no  set errori to true
                      when mb-yes
                           initialize insarticoli-linkage
                                      replacing numeric data by zeroes
                                           alphanumeric data by spaces
                           perform IMPOSTA-CODICE-DOGANALE
                           move user-codi           to link-insart-user
                           move livello-abil        to link-insart-abil
                           move ef-peso-buf         to link-insart-peso
                           move ef-peso-utf-buf     to link-insart-utf
                           move ef-peso-non-utf-buf to 
           link-insart-non-utf
                           call   "insarticoli" using 
           insarticoli-linkage
                           cancel "insarticoli"
                           move 4 to accept-control
                           if link-insart-status = 0
                              move link-insart-codice to art-codice
                                                         ef-art-buf
                              perform DESCRIZIONE-ARTICOLO
                              move descr-articolo      to lab-des-buf
                              move link-insart-imballo to ef-imb-buf
                              move link-insart-mag     to ef-mag-buf
                              display ef-art lab-des ef-imb ef-mag
                              perform SALVA
                           end-if
                      end-evaluate
                   else
                      read articoli no lock
                           invalid
                           set errori to true
                       not invalid
                           if ef-mag-buf = spaces
                              perform FIND-MORE-ARTICOLI-ON-PROGMAG
                              evaluate true
                              when num-articoli = 0
                                   set errori to true
                              when num-articoli = 1
                                   move SaveProgmagKey to prg-chiave
                                   move SaveUTF      to prg-peso-utf
                                   move SaveNonUTF   to prg-peso-non-utf
                                   perform VALORIZZA-ENTRY-FROM-PROGMAG
                              when num-articoli > 1
LUBEXX                             set hid-NoSomma to true
                                   perform ZOOM-SU-PROGMAG
                                   perform VALORIZZA-ENTRY-FROM-PROGMAG
                              end-evaluate
                           end-if
                      end-read
                      if errori
                         display message "Articolo NON valido"
                                   title tit-err
                                    icon 2
                      end-if
                      perform DESCRIZIONE-ARTICOLO
                      move descr-articolo to lab-des-buf
                      display lab-des
                   end-if
                end-if

           when 78-ID-ef-mag
                inquire ef-mag, value in mag-codice
                read tmagaz no lock
                     invalid
                     set errori to true
                     display message box "Magazzino NON valido"
                               title tit-err
                                icon 2
                end-read

           when 78-ID-ef-imb
                inquire ef-imb, value in imq-codice
                read timbalqta no lock 
                     invalid
                     set errori to true
                 not invalid
                     move imq-tipo to imb-codice
                     read timballi no lock
                          invalid set errori to true
                     end-read
                end-read
                if errori
                   display message "Codice imballaggio NON valido"
                             title tit-err
                              icon 2
                end-if

           when 78-ID-ef-art-2 
                if v-riga = 1
                   inquire ef-art-2, value in art-codice
                   read articoli no lock
                        invalid
                        set errori to true
                        display message "Articolo NON valido"
                                  title tit-err
                                   icon 2
                        move spaces to art-descrizione
                   end-read
                   perform DESCRIZIONE-ARTICOLO
                   move descr-articolo to lab-des-2-buf
                   display lab-des-2
                end-if

           when 78-ID-ef-mag-2
                if v-riga = 1
                   inquire ef-mag-2, value in mag-codice
                   read tmagaz no lock
                        invalid
                        set errori to true
                        display message box "Magazzino NON valido"
                                  title tit-err
                                   icon 2
                   end-read
                end-if

           when 78-ID-ef-imb-2
                if v-riga = 1
                   inquire ef-imb-2, value in imq-codice
                   read timbalqta no lock 
                        invalid
                        set errori to true
                    not invalid
                        move imq-tipo to imb-codice
                        read timballi no lock
                             invalid set errori to true
                        end-read
                   end-read
                   if errori
                      display message "Codice imballaggio NON valido"
                                title tit-err
                                 icon 2
                   end-if
                end-if
             
           when 78-ID-ef-peso-2
                if v-riga = 1
                   inquire ef-art-2,  value in prg-cod-articolo
                   inquire ef-mag-2,  value in prg-cod-magazzino
                   inquire ef-imb-2,  value in prg-tipo-imballo
                   inquire ef-peso-2, value in prg-peso
                   read progmag no lock
                        invalid continue
                    not invalid
                        if nuovo
                           set errori to true
                           display message "Progressivo di magazzino"
                                           " già esistente"
                                     title tit-err
                                      icon 2
                        end-if
                   end-read
                end-if
           end-evaluate.
      
           if errori
              perform CANCELLA-COLORE
              move control-id to store-id
              move 4          to accept-control
           end-if 
           .
      * <TOTEM:END>

       CONTROLLO-RIGA.
      * <TOTEM:PARA. CONTROLLO-RIGA>
           set tutto-ok to true.

           evaluate colonna
           when 2
                move spaces   to art-descrizione
                move col-art  to prg-cod-articolo art-codice
                move col-mag  to prg-cod-magazzino
                move col-imb  to prg-tipo-imballo
                move col-peso to prg-peso

                if SaveProgmagKey not = prg-chiave
                   move "Articolo NON valido" to msg-err
                   move mb-yes to scelta
                   if FromFinishEntry
                      perform CHIEDI-RIGENERA
                   end-if
                   if scelta = mb-yes
                      read articoli no lock
                           invalid
                           set errori  to true
                           move spaces to art-descrizione
                       not invalid
                           if art-attivo
                              perform FIND-MORE-ARTICOLI-ON-PROGMAG
                              evaluate true
                              when num-articoli = 0
                                   set hid-NoSomma to true
                                   set errori to true
                              when num-articoli = 1
                                   set hid-SiSomma to true
                                   move SaveProgmagKey to prg-chiave
                                   move SaveUTF        to prg-peso-utf
                                   move SaveNonUTF     to 
           prg-peso-non-utf
                                   perform VALORIZZA-FROM-PROGMAG
                              when num-articoli > 1
LUBEXX                             set hid-SiSomma to true
                                   set event-action to 
           event-action-terminate
                                   perform ZOOM-SU-PROGMAG
                                   if stato-zoom = 0
                                      perform VALORIZZA-FROM-PROGMAG
                                   else
                                      perform PULISCI-RIGA
                                   end-if
                              end-evaluate
                           else
                              set errori  to true
                              move spaces to art-descrizione
                              move "Articolo NON attivo" to msg-err
                           end-if                
                      end-read
      *****                if FromFinishEntry
      *****                   move riga to store-riga
      *****                   perform PB-GENERA-LINKTO
      *****                   move store-riga to riga
      *****                end-if
                   else
                      set event-action to event-action-terminate
                   end-if
                   if errori
                      display message msg-err
                                title tit-err
                                 icon 2
LUBEXX             else
LUBEXX                modify form1-gd-1(riga, 12), hidden-data hid-somma
LUBEXX                if hid-SiSomma
LUBEXX                   modify form1-gd-1(riga, 12), bitmap spunta-bmp,
LUBEXX                                                bitmap-number = 1,
LUBEXX                                                bitmap-width 16
LUBEXX                else
LUBEXX                   modify form1-gd-1(riga, 12), bitmap spunta-bmp
LUBEXX                                                bitmap-number = 2
LUBEXX                                                bitmap-width 16
LUBEXX                end-if
                   end-if
                   perform DESCRIZIONE-ARTICOLO
                   move descr-articolo  to col-des
                   modify form1-gd-1(riga, 6), cell-data = col-des
                else
                   if col-des = spaces
                      perform DESCRIZIONE-ARTICOLO
                      move descr-articolo  to col-des
                      modify form1-gd-1(riga, 6), cell-data = col-des
                   end-if   
                end-if

           when 3
                move col-mag to mag-codice
                read tmagaz no lock 
                     invalid
                     set errori to true
                     display message "Codice magazzino NON valido"
                               title tit-err
                                icon 2
                end-read

           when 4
                move col-imb to imq-codice
                read timbalqta no lock 
                     invalid
                     set errori to true
                 not invalid
                     move imq-tipo to imb-codice
                     read timballi no lock
                          invalid set errori to true
                     end-read
                end-read
                if errori
                   display message "Codice imballaggio NON valido"
                             title tit-err
                              icon 2
                end-if

           when 10
                if como-qta = 0
                   set errori to true
                   display message "Inserimento quantità mancante"
                             title tit-err
                              icon  2
                else
                   if FromFinishEntry and como-qta not = old-qta
                      perform CHIEDI-RIGENERA
      *****                if scelta = mb-yes
      *****                   perform PB-GENERA-LINKTO
      *****                end-if
                   end-if
                end-if

           when 11
                perform SOMMA-ONERI
                if vecchio
                   perform CALCOLA-TOTALI-GRID
                end-if

           end-evaluate.

           if errori
              move 78-ID-Form1-Gd-1 to store-id
           end-if.

           set FromFinishEntry to false 
           .
      * <TOTEM:END>

       CURRENT-RECORD.
      * <TOTEM:PARA. CURRENT-RECORD>
           perform RIEMPI-CHIAVE.
           set tutto-ok  to true.
           set ReadSecca to true.
           if mod = 1
              read distinteb    lock invalid set errori to true end-read
           else
              read distinteb no lock invalid set errori to true end-read
           end-if.

           set ReadSecca to false.

           if RecLocked
              set RecLocked to false
           else
              if tutto-ok    
                 if nuovo
                    move 0                to mod
                    move 1                to mod-k
                    move 78-ID-form1-gd-1 to CONTROL-ID
                    move 4                to ACCEPT-CONTROL
                 end-if
                 perform FORM1-IUD-DISPLAY
                 set vecchio to true
                 if mod = 1  set StatusModifica to true
                 else        set StatusVisua    to true
                 end-if
                 perform STATUS-BAR-MSG
                 perform VALORIZZA-OLD
              else
                 move 0 to mod
                 move 1 to mod-k
                 if vecchio
                    perform CLEAR-SCREEN
                    if YesMessage
                       move 78-ID-form1-gd-1 to CONTROL-ID
                       move 4                to ACCEPT-CONTROL
                       display message box MSG-Record-inesistente
                               title = tit-err
                               icon mb-warning-icon
                    end-if
                 end-if
              end-if
           end-if.

           if control-id = 78-ID-form1-gd-1
              if mod = 1 move 1 to StatusHelp
              else       move 0 to StatusHelp
              end-if
              perform STATUS-HELP
           end-if 
           .
      * <TOTEM:END>

       DESCRIZIONE-ARTICOLO.
      * <TOTEM:PARA. DESCRIZIONE-ARTICOLO>
           initialize descr-articolo.
           read articoli no lock 
                invalid continue
            not invalid
LUBEXX*****                move art-imballo-standard to imq-codice
LUBEXX          move prg-tipo-imballo to imq-codice
                read timbalqta  no lock invalid continue end-read
                move imq-qta-imb     to imballi-ed
                call "C$JUSTIFY"  using imballi-ed, "L"
                move imq-tipo        to imb-codice
                read timballi   no lock
                     invalid initialize imb-descrizione
                end-read
                inspect imb-descrizione replacing trailing 
                                           spaces by low-value
                inspect art-descrizione replacing trailing 
                                           spaces by low-value
                string  art-descrizione delimited by low-value
                        " - "           delimited by size
                        imb-descrizione delimited by low-value
                        " da "          delimited by size
                        imballi-ed      delimited by spaces
                        " x "           delimited by size
                        art-udm-imballo delimited by size
                        into descr-articolo
                end-string
           end-read 
           .
      * <TOTEM:END>

       FIND-MORE-ARTICOLI-ON-PROGMAG.
      * <TOTEM:PARA. FIND-MORE-ARTICOLI-ON-PROGMAG>
           set tutto-ok to true.
           move 0 to num-articoli.
           initialize prg-chiave replacing numeric data by zeroes
                                      alphanumeric data by spaces.
           move art-codice to prg-cod-articolo.
           start progmag key is >= prg-chiave
                 invalid set errori to true
           end-start.

           if tutto-ok
              perform until 1 = 2
                 read progmag next at end exit perform end-read
                 if prg-cod-articolo not = art-codice 
                    exit perform 
                 end-if
                 if prg-cod-magazzino not = spaces
                    add 1 to num-articoli
                 else
                    perform CALCOLA-COSTO-MP
                    accept imp-data from century-date
                    start timposte key <= imp-chiave
                          invalid continue
                      not invalid
                          read timposte previous
                    end-start
                    perform CALCOLA-COSTO-MP-WHEN-ZERO
                 end-if
                 evaluate true
                 |SALVO LA CHIAVE
                 when num-articoli = 1
                      move prg-chiave       to SaveProgmagKey
                      move prg-peso-utf     to SaveUtf
                      move prg-peso-non-utf to SaveNonUtf
                 |NE HO PIÙ DI UNO QUINDI DEVO SCEGLIERLO
                 when num-articoli > 1
                      exit perform
                 end-evaluate
              end-perform
           end-if 
           .
      * <TOTEM:END>

       FROM-2-TO-1.
      * <TOTEM:PARA. FROM-2-TO-1>
           
           move 0 to ef-art-buf.
           move spaces to ef-mag-buf ef-imb-buf lab-des-buf.
           move ef-art-2-buf          to ef-art-buf.
           move ef-peso-2-buf         to ef-peso-buf.
           move ef-peso-utf-2-buf     to ef-peso-utf-buf.
           move ef-peso-non-utf-2-buf to ef-peso-non-utf-buf.
           move ef-mp-2-buf           to ef-mp-buf.
           move ef-oneri-2-buf        to ef-oneri-buf.
           display ef-art-2 ef-mag-2 ef-imb-2 ef-peso-2
                   ef-peso-utf-2 ef-peso-non-utf-2 ef-mp-2
                   ef-oneri-2 pb-ritorna lab-des-2.
           display ef-art ef-mag ef-imb ef-peso lab-des
                   ef-peso-utf ef-peso-non-utf ef-mp 
           .
      * <TOTEM:END>

       GRID-TO-FLD.
      * <TOTEM:PARA. GRID-TO-FLD>
           move col-art    to dis-articolo(idx).
           move col-mag    to dis-magazzino(idx).
           move col-imb    to dis-imballo(idx).
           move col-peso   to dis-peso(idx).
           move col-qta    to dis-qta(idx).
           move col-oneri  to dis-oneri(idx).
           move hid-somma  to dis-somma-peso(idx) 
           .
      * <TOTEM:END>

       HELP-GRID.
      * <TOTEM:PARA. HELP-GRID>
           move 0 to StatusHelp.

           evaluate colonna
           when 2   move "Inserire il codice articolo" 
                      to totem-hint-text
                    if mod = 1 move 1 to StatusHelp end-if
           when 3   move "Codice Magazzino dell'articolo"
                      to totem-hint-text
           when 4   move "Codice Imballaggio dell'articolo"
                      to totem-hint-text
           when 5   move "Peso totale dell'articolo"
                      to totem-hint-text
           when 6   move "Descrizione articolo"
                      to totem-hint-text
           when 7   move "Importo peso UTF" 
                      to totem-hint-text
           when 8   move "Importo peso non UTF" 
                      to totem-hint-text
           when 9   move "Importo prezzo MEDIO PONDERATO" 
                      to totem-hint-text
           when 10  move "Inserire la quantità"
                      to totem-hint-text
           when 11  move "Inserire gli oneri"
                      to totem-hint-text
           end-evaluate.

           modify Form1-St-1-Handle, panel-index = 1,
                                     panel-text  = totem-hint-text.
           perform STATUS-HELP 
           .
      * <TOTEM:END>

       IMPOSTA-CODICE-DOGANALE.
      * <TOTEM:PARA. IMPOSTA-CODICE-DOGANALE>
           perform X-Y.
           move 0 to link-insart-cod-doganale.
           perform varying store-riga from 2 by 1 
                     until store-riga > tot-righe
              inquire form1-gd-1(store-riga, 1), 
                      hidden-data in hid-cod-doganale
              if link-insart-cod-doganale = 0
                 move hid-cod-doganale to link-insart-cod-doganale
              else
                 evaluate hid-cod-doganale
                 when 2710
                 when 27100000
                      move hid-cod-doganale 
                        to link-insart-cod-doganale
                 when 3403
                 when 34030000
                      evaluate link-insart-cod-doganale
                      when 2710
                      when 27100000 continue
                      when other
                           move hid-cod-doganale 
                             to link-insart-cod-doganale
                      end-evaluate
                 when 8507
                 when 85070000
                      evaluate link-insart-cod-doganale
                      when 2710
                      when 27100000 continue
                      when 3404
                      when 30400000 continue
                      when other
                           move hid-cod-doganale 
                             to link-insart-cod-doganale
                      end-evaluate
                 when 9999
                 when 99990000
                      evaluate link-insart-cod-doganale
                      when 2710
                      when 27100000 continue
                      when 3404
                      when 30400000 continue
                      when 8507
                      when 85070000 continue
                      when other
                           move hid-cod-doganale 
                             to link-insart-cod-doganale
                      end-evaluate
                 end-evaluate
              end-if
           end-perform 
           .
      * <TOTEM:END>

       INIT.
      * <TOTEM:PARA. INIT>
           move 0 to StatusHelp.
           move 1 to mod-k.
           set StatusVisua to true 
           .
      * <TOTEM:END>

       INIT-OLD-REC.
      * <TOTEM:PARA. INIT-OLD-REC>
           initialize old-dis-rec replacing numeric data by zeroes
                                       alphanumeric data by spaces 
           .
      * <TOTEM:END>

       MODIFICA.
      * <TOTEM:PARA. MODIFICA>
           move 5 to key-status.
           inquire tool-modifica, value in mod.
           set tutto-ok to true.

           if nuovo
              move 1 to mod                  
              modify tool-modifica, value mod
           else
      *  SE L'UTENTE E' ABILITATO PUO' MODIFICARE UN RECORD
              if mod = 1
                 set YesMessage to true
                 perform CURRENT-RECORD
                 if tutto-ok
      *****              if CONTROL-ID < 78-ID-ef-descrizione1
      *****                 move 78-ID-ef-descrizione1 to control-id
      *****              end-if
                    move 0 to mod-k
                    move 1 to mod
                    set StatusModifica to true
                    perform STATUS-BAR-MSG
                 end-if
              else
                 move 1 to mod
                 perform SALV-MOD            
                 move 0 to mod
                 move 1 to mod-k
                 if errori
                    move 1 to mod
                    move 0 to mod-k
                 else
                    move 78-ID-form1-gd-1 to CONTROL-ID
                    set NoMessage to true
                    perform CURRENT-RECORD
                    set StatusVisua to true
                    perform STATUS-BAR-MSG 
                    unlock distinteb all records
                 end-if
              end-if
                        
              display form1
              modify tool-modifica,  value mod
              perform CANCELLA-COLORE 

              move 4 to accept-control
           end-if 
           .
      * <TOTEM:END>

       NUOVO.
      * <TOTEM:PARA. NUOVO>
           perform SALV-MOD.

           if tutto-ok 
              move 78-ID-form1-gd-1 to CONTROL-ID
              move 2 to riga 
              move 2 to colonna
              modify form1-gd-1, cursor-y = riga, cursor-x = colonna
              perform COLORE-RIGA
              move 4                to ACCEPT-CONTROL   
              move 1                to mod mod-k
              modify  tool-modifica value = mod
              perform CANCELLA-COLORE                  
              perform VALORIZZA-NUOVO
              perform INIT-OLD-REC
              perform RESETTA-GRID
              perform PULISCI-CAMPI-TOTALI
              perform PULISCI-ARTICOLO-FINALE
              set StatusIns to true
              perform STATUS-BAR-MSG  
              set nuovo to true       
              unlock distinteb all records
              move 1 to e-azzera
              move 4 to BitmapNumAzzera
              modify pb-azzera, bitmap-number BitmapNumAzzera,
                                enabled       e-azzera

              move 0 to e-genera
              move 3 to BitmapNumGenera
              modify pb-genera, bitmap-number BitmapNumGenera,
                                enabled       e-genera

              move 78-WinLinesWithout to win-lines
              modify form1-handle, lines win-lines
           end-if 
           .
      * <TOTEM:END>

       PARAGRAFO-COPY.
      * <TOTEM:PARA. PARAGRAFO-COPY>
           copy "abilita-toolbar.cpy".
           copy "color-custom.cpy".
           copy "status.cpy".
           copy "costo-medio.cpy".
           copy "calcola-costo-mp-when-zero.cpy".
           copy "riempi-zoom-distinteb.cpy" 
           .
      * <TOTEM:END>

       PRECEDENTE.
      * <TOTEM:PARA. PRECEDENTE>
           perform SALV-MOD.           
           if tutto-ok

              perform CHECK-INSERIMENTO
              unlock distinteb all records

              if mod = 1
                 move ZERO to mod-k
                 set dataset1-distinteb-lock to true
              else              
                 move 1    to mod-k     
                 initialize dataset1-distinteb-lock-flag
              end-if
                    
              perform CANCELLA-COLORE
              perform FORM1-PREVIOUS

              if RecLocked
                 set RecLocked to false             
                 initialize dataset1-distinteb-lock-flag
                 move 1 to mod-k
                 perform FORM1-PREVIOUS
              end-if
           end-if 
           .
      * <TOTEM:END>

       PRIMO.
      * <TOTEM:PARA. PRIMO>
           perform SALV-MOD.           
           if tutto-ok    
 
              perform CHECK-INSERIMENTO
              unlock distinteb all records

              if mod = 1
                 move 0 to mod-k
                 set dataset1-distinteb-lock to true
              else              
                 move 1 to mod-k     
                 initialize dataset1-distinteb-lock-flag
              end-if
                                  
              perform CANCELLA-COLORE
              perform FORM1-FIRST

              if RecLocked
                 set RecLocked to false             
                 initialize dataset1-distinteb-lock-flag
                 move 1 to mod-k
                 perform FORM1-FIRST
              end-if
           end-if 
           .
      * <TOTEM:END>

       PULISCI-ARTICOLO-FINALE.
      * <TOTEM:PARA. PULISCI-ARTICOLO-FINALE>
           move 0      to ef-art-buf             ef-peso-buf 
                          ef-peso-utf-buf        ef-peso-non-utf-buf
                          ef-mp-buf              ef-oneri-buf
                          ef-art-2-buf           ef-peso-2-buf
                          ef-peso-utf-2-buf      ef-peso-non-utf-2-buf
                          ef-mp-2-buf            ef-oneri-2-buf.

           move spaces to lab-des-2-buf lab-des-buf
                          ef-mag-buf    ef-imb-buf
                          ef-mag-2-buf  ef-imb-2-buf.

           display ef-art lab-des     ef-mag
                   ef-imb             ef-peso
                   ef-peso-utf        ef-peso-non-utf
                   ef-mp              ef-oneri
                   ef-art-2 lab-des-2 ef-mag-2
                   ef-imb-2           ef-peso-2
                   ef-peso-utf-2      ef-peso-non-utf-2
                   ef-mp-2            ef-oneri-2
                   pb-ritorna.
           modify pb-ritorna, bitmap-number = 1 
           .
      * <TOTEM:END>

       PULISCI-CAMPI-TOTALI.
      * <TOTEM:PARA. PULISCI-CAMPI-TOTALI>
           move 0 to ef-tot-utf-buf         ef-tot-non-utf-buf
                     ef-tot-prezzo-buf      ef-tot-oneri-buf.          

           display   ef-tot-utf         ef-tot-non-utf
                     ef-tot-prezzo      ef-tot-oneri 
           .
      * <TOTEM:END>

       PULISCI-RIGA.
      * <TOTEM:PARA. PULISCI-RIGA>
           move 0 to art-codice.
           move spaces to col-art.
           move spaces to col-mag.
           move spaces to col-imb.
           move spaces to col-peso.
           move spaces to col-des.
           move spaces to col-utf.
           move spaces to col-non-utf.
           move spaces to col-mp.
           move spaces to col-qta.
           move spaces to col-oneri.
LUBEXX     set hid-NoSomma to true.
LUBEXX     modify form1-gd-1(riga, 12), bitmap spunta-bmp
LUBEXX                                  bitmap-number  2
LUBEXX                                  bitmap-width  16.

           modify form1-gd-1(riga, 2), cell-data = col-art.
           modify form1-gd-1(riga, 3), cell-data = col-mag
           modify form1-gd-1(riga, 4), cell-data = col-imb.
           modify form1-gd-1(riga, 5), cell-data = col-peso.
           modify form1-gd-1(riga, 6), cell-data = col-des.
           modify form1-gd-1(riga, 7), cell-data = col-utf.
           modify form1-gd-1(riga, 8), cell-data = col-non-utf.
           modify form1-gd-1(riga, 9), cell-data = col-mp.
           modify form1-gd-1(riga,10), cell-data = col-qta.
           modify form1-gd-1(riga,11), cell-data = col-oneri.
           modify form1-gd-1(riga,12), hidden-data = hid-somma 
           .
      * <TOTEM:END>

       RESETTA-GRID.
      * <TOTEM:PARA. RESETTA-GRID>
           modify form1-gd-1, mass-update = 1.
           modify form1-gd-1, reset-grid  = 1.
           perform INTESTAZIONE.
           modify form1-gd-1, mass-update = 0.

      ***---
       INTESTAZIONE.
           modify form1-gd-1, record-to-add = 11.
           perform FORM1-GD-1-CONTENT.
           if mod = 1 move 1 to StatusHelp
           else       move 0 to StatusHelp
           end-if.

           perform STATUS-HELP 
           .
      * <TOTEM:END>

       RESETTA-VIRGOLA.
      * <TOTEM:PARA. RESETTA-VIRGOLA>
           set environment "KEYSTROKE" to "DATA=46 44" 
           .
      * <TOTEM:END>

       RIEMPI-CHIAVE.
      * <TOTEM:PARA. RIEMPI-CHIAVE>
           move lab-numero-buf to dis-codice 
           .
      * <TOTEM:END>

       SALVA.
      * <TOTEM:PARA. SALVA>
           if mod = 0 exit paragraph end-if.

           set tutto-ok to true.

           if tutto-ok
              if win-lines = 78-WinLinesWithout
                 display message "Nessun articolo in distinta"
                           title tit-err
                            icon 2
                 set errori to true
              end-if
           end-if.

      *****     if tutto-ok
      *****        move 1 to riga
      *****        perform 10 times
      *****           add 1 to riga
      *****           perform VALORE-RIGA
      *****           perform varying colonna from 2 by 1
      *****                     until colonna > 11
      *****              if col-art = 0 exit perform end-if
      *****              perform CONTROLLO-RIGA
      *****              if errori      exit perform end-if
      *****           end-perform
      *****           if errori exit perform end-if
      *****        end-perform
      *****     end-if.

           if tutto-ok
              perform varying control-id from 78-ID-ef-art by 1
                        until control-id > 78-ID-ef-peso-2
                 perform CONTROLLO
                 if errori
                    exit perform
                 end-if
              end-perform
           end-if.

           if errori
              perform CANCELLA-COLORE
              perform ABILITAZIONI
              move store-id to control-id
              move 4        to accept-control
              if store-id = 78-ID-form1-Gd-1
                 modify form1-gd-1, cursor-y = riga,
                                    cursor-x = colonna
                 perform COLORE-RIGA
                 perform HELP-GRID
              end-if
           else
              perform FORM1-BUF-TO-FLD
              perform CANCELLA-COLORE

              if v-riga = 1
                 move ef-oneri-2-buf to como-oneri
              else
                 move ef-oneri-buf   to como-oneri
              end-if

              move dis-chiave-progmag to link-key

              add como-oneri         to dis-prezzo
                                 giving link-valore-costo
              move dis-peso-utf      to link-utf
              move dis-peso-non-utf  to link-non-utf
              set link-costo-ultimo  to true
              move user-codi         to link-user of link-wprogmag
              call   "wprogmag"   using link-wprogmag
              cancel "wprogmag"

              if link-wprogmag-status = -1
                 display message box
                         "Progressivo non registrato correttamente."
                  x"0d0a""Proseguire comunque con l'inserimento?"
                           title tit-err
                            icon 2
                            type mb-yes-no
                          giving scelta
                 if scelta = mb-no set errori to true end-if
              end-if

              if tutto-ok
                 accept como-ora  from time
                 accept como-data from century-date
                 if nuovo
                    move data-oggi to dis-data-creazione
                    move como-ora  to dis-ora-creazione
                    move user-codi to dis-utente-creazione
                 else
                    move data-oggi to dis-data-ultima-modifica
                    move como-ora  to dis-ora-ultima-modifica
                    move user-codi to dis-utente-ultima-modifica
                 end-if

                 write dis-rec invalid rewrite dis-rec end-write

                 set vecchio to true
                 perform TORNA-IN-VISUA
              end-if
           end-if.

           display form1 
           .
      * <TOTEM:END>

       SALV-MOD.
      * <TOTEM:PARA. SALV-MOD>
           set tutto-ok to true.
           if mod = 0 exit paragraph end-if.
           perform Form1-CONTROLLO-OLD.
      
           if SiSalvato
              move 0 to idx
              perform 10 times
                 add   1 to idx
                 if dis-riga(idx) not = old-dis-riga(idx) 
                    set NoSalvato         to true
                    move 78-ID-form1-Gd-1 to control-id store-id
                    exit perform
                 end-if
              end-perform
           end-if.
      
           if NoSalvato
              display message box MSG-Salvare-le-modifiche
                            title titolo
                            type mb-yes-no-cancel 
                            giving scelta       
       
              evaluate scelta
              when mb-yes 
                   perform SALVA
              when mb-no  
                   continue
              when other                
                   perform CANCELLA-COLORE
                   set errori to true
                   move store-id to CONTROL-ID       
                   move 4        to ACCEPT-CONTROL   
              end-evaluate
           end-if 
           .
      * <TOTEM:END>

       SELEZIONA.
      * <TOTEM:PARA. SELEZIONA>
           move 0 to como-articolo.
           perform RIEMPI-TMP-DISTINTEB.
           perform RIEMPI-CHIAVE.
           move path-zoom-distinteb to ext-file.
           move dis-chiave          to zoom-dis-chiave.
           move lab-des-buf         to zoom-dis-art-descrizione.

           move   "zoom-distinteb" to como-file.
           call   "zoom-gt"     using como-file, zoom-dis-rec
                               giving stato-zoom.
           cancel "zoom-gt".

           if stato-zoom = 0
              move zoom-dis-chiave to dis-chiave
              if old-dis-codice not = dis-codice
                 move dis-chiave to save-key
                 perform SALV-MOD
                 if tutto-ok
                    move save-key   to dis-chiave
                    set ReadSecca   to true
                    move dis-codice to lab-numero-buf
                    display lab-numero
                    perform CURRENT-RECORD
                    perform CANCELLA-COLORE
                    move 78-ID-form1-gd-1 to control-id
                    move 4                to accept-control
                 end-if
              end-if
           end-if.

           delete file zoom-distinteb 
           .
      * <TOTEM:END>

       SELEZIONA-DESELEZIONA.
      * <TOTEM:PARA. SELEZIONA-DESELEZIONA>
LUBEXX     if vecchio
LUBEXX        perform CHIEDI-RIGENERA
LUBEXX     else
LUBEXX        inquire form1-gd-1(event-data-2, 12)
LUBEXX                hidden-data in hid-somma
LUBEXX        if hid-SiSomma
LUBEXX           modify form1-gd-1(event-data-2, 12), bitmap spunta-bmp,
LUBEXX                                                bitmap-number = 2,
LUBEXX                                                bitmap-width 16
LUBEXX           set hid-NoSomma to true
LUBEXX        else
LUBEXX           modify form1-gd-1(event-data-2, 12), bitmap spunta-bmp
LUBEXX                                                bitmap-number = 1
LUBEXX                                                bitmap-width 16
LUBEXX           set hid-SiSomma to true
LUBEXX        end-if
LUBEXX        modify form1-gd-1(event-data-2, 12), hidden-data hid-somma
LUBEXX        perform CALCOLA-TOTALI-GRID
LUBEXX     end-if 
           .
      * <TOTEM:END>

       SETTA-VIRGOLA.
      * <TOTEM:PARA. SETTA-VIRGOLA>
           set environment "KEYSTROKE" to "DATA=44 46" 
           .
      * <TOTEM:END>

       SOMMA-TOTALI.
      * <TOTEM:PARA. SOMMA-TOTALI>
           perform SOMMA-UTF.
           perform SOMMA-NON-UTF.
           perform SOMMA-MP.
           perform SOMMA-ONERI.

      ***---
       SOMMA-UTF.
           move 0 to somma-utf.
           move ef-tot-utf-buf     to como-utf.
           compute somma-utf     =
                   prg-peso-utf     + como-utf     - old-utf.
           move somma-utf to ef-tot-utf-buf.
           display ef-tot-utf.

      ***---
       SOMMA-NON-UTF.
           move 0 to somma-non-utf.
           move ef-tot-non-utf-buf to como-non-utf.
           compute somma-non-utf =
                   prg-peso-non-utf + como-non-utf - old-non-utf.
           move somma-non-utf      to ef-tot-non-utf-buf.
           display ef-tot-non-utf.

      ***---
       SOMMA-MP.
           move 0 to somma-prezzo.
           move ef-tot-prezzo-buf  to como-prezzo.
           compute somma-prezzo  =
                   costo-mp         + como-prezzo  - old-mp.
           move somma-prezzo       to ef-tot-prezzo-buf.
           display ef-tot-prezzo.

      ***---
       SOMMA-ONERI.
           move 0 to somma-oneri.
           move ef-tot-oneri-buf     to como-oneri.
           compute somma-oneri     =
                   col-oneri-num   + como-oneri   - old-oneri.
           move somma-oneri to ef-tot-oneri-buf.
           display ef-tot-oneri 
           .
      * <TOTEM:END>

       SPOSTAMENTO.
      * <TOTEM:PARA. SPOSTAMENTO>
           set tutto-ok to true.
           perform X-Y.

           if event-data-2 not = riga

              perform VALORE-RIGA
              perform VALORE-OLD-RIGA

              if como-articolo not = 0
                 perform varying colonna from 2 by 1
                           until colonna > 11
                    perform CONTROLLO-RIGA
                    if errori exit perform end-if
                 end-perform
              end-if

              if tutto-ok
                 evaluate true
                 when event-data-2 < 2 
                      move 2            to riga
                      move event-data-1 to colonna

                 when event-data-2 > tot-righe
                      add  1                to tot-righe giving riga
                      move 2                to colonna
                      move 78-ID-form1-gd-1 to control-id
                      move 4                to accept-control
                      set event-action      to event-action-fail
                      modify form1-gd-1, cursor-y = riga,
                                         cursor-x = colonna
                 when other
                      move event-data-2 to riga
                      move event-data-1 to colonna
                 end-evaluate
                 perform VALORE-RIGA
                 perform VALORE-OLD-RIGA
              else
                 move 78-ID-form1-gd-1 to control-id
                 move 4                to accept-control
                 set event-action      to event-action-fail
                 modify form1-gd-1, cursor-y = riga,
                                    cursor-x = colonna
              end-if
           else
              move event-data-1 to colonna
           end-if.

           perform COLORE-RIGA.
           perform HELP-GRID 
           .
      * <TOTEM:END>

       STAMPA.
      * <TOTEM:PARA. STAMPA>
           continue 
           .
      * <TOTEM:END>

       SUCCESSIVO.
      * <TOTEM:PARA. SUCCESSIVO>
           perform SALV-MOD.
           if tutto-ok

              perform CHECK-INSERIMENTO
              unlock distinteb all records

              if mod = 1
                 move ZERO to mod-k
                 set dataset1-distinteb-lock to true
              else              
                 move 1    to mod-k     
                 initialize dataset1-distinteb-lock-flag
              end-if
                                     
              perform CANCELLA-COLORE
              perform FORM1-NEXT
 
              if RecLocked
                 set RecLocked to false             
                 initialize dataset1-distinteb-lock-flag
                 move 1 to mod-k
                 perform FORM1-NEXT
              end-if
           end-if 
           .
      * <TOTEM:END>

       TORNA-IN-VISUA.
      * <TOTEM:PARA. TORNA-IN-VISUA>
           move 0 to mod.
           move 1 to mod-k.
           move 78-ID-form1-gd-1 to CONTROL-ID.
           set NoMessage to true.
           perform ABILITAZIONI.
           set StatusVisua to true.
           perform STATUS-BAR-MSG.
           unlock distinteb all records.
                        
           modify tool-modifica,  value mod.
           perform CANCELLA-COLORE.
           move 4 to ACCEPT-CONTROL.

           move 0 to e-azzera.
           move 6 to BitmapNumAzzera.
           modify pb-azzera, bitmap-number BitmapNumAzzera,
                             enabled       e-azzera.

           move 0 to e-genera.
           move 3 to BitmapNumGenera.
           modify pb-genera, bitmap-number BitmapNumGenera,
                             enabled       e-genera.

           if v-riga = 1
              perform FROM-2-TO-1
              move lab-des-2-buf to lab-des-buf
              move ef-art-2-buf  to ef-art-buf
              move ef-mag-2-buf  to ef-mag-buf
              move ef-imb-2-buf  to ef-imb-buf
              display lab-des ef-art ef-mag ef-imb
           end-if.
              
           move 0 to v-riga v-esc 
           .
      * <TOTEM:END>

       ULTIMO.
      * <TOTEM:PARA. ULTIMO>
           perform SALV-MOD.
           if tutto-ok

              perform CHECK-INSERIMENTO
              unlock distinteb all records 

              if mod = 1
                 move ZERO to mod-k
                 set dataset1-distinteb-lock to true
              else              
                 move 1    to mod-k     
                 initialize dataset1-distinteb-lock-flag
              end-if
                               
              perform CANCELLA-COLORE
              perform FORM1-LAST 
 
              if RecLocked
                 set RecLocked to false             
                 initialize dataset1-distinteb-lock-flag
                 move 1 to mod-k
                 perform FORM1-LAST
              end-if
           end-if 
           .
      * <TOTEM:END>

       VALORE-OLD-RIGA.
      * <TOTEM:PARA. VALORE-OLD-RIGA>
           move col-art     to SaveArticolo.
           move col-mag     to SaveMagazzino.
           move col-imb     to SaveImballo.
           move col-peso    to SavePeso.
           move col-utf     to old-utf.
           move col-non-utf to old-non-utf.
           move col-mp      to old-mp.
           move col-qta     to old-qta.
           move col-oneri   to old-oneri.
           move hid-somma   to old-somma 
           .
      * <TOTEM:END>

       VALORE-RIGA.
      * <TOTEM:PARA. VALORE-RIGA>
           inquire form1-gd-1(riga, 2),  cell-data in col-art.
           inquire form1-gd-1(riga, 3),  cell-data in col-mag.
           inquire form1-gd-1(riga, 4),  cell-data in col-imb.
           inquire form1-gd-1(riga, 5),  cell-data in col-peso.
           inquire form1-gd-1(riga, 6),  cell-data in col-des.
           inquire form1-gd-1(riga, 7),  cell-data in col-utf.
           inquire form1-gd-1(riga, 8),  cell-data in col-non-utf.
           inquire form1-gd-1(riga, 9),  cell-data in col-mp.
           inquire form1-gd-1(riga, 10), cell-data in col-qta. 
           inquire form1-gd-1(riga, 11), cell-data in col-oneri.
           inquire form1-gd-1(riga, 12), hidden-data in hid-somma.
           move col-qta   to como-qta.
           move col-oneri to col-oneri-num.
           move col-art   to como-articolo 
           .
      * <TOTEM:END>

       VALORIZZA-ENTRY-FROM-PROGMAG.
      * <TOTEM:PARA. VALORIZZA-ENTRY-FROM-PROGMAG>
           if peso-totale not = prg-peso
              move 1 to v-riga
              move ef-peso-buf         to ef-peso-2-buf
              move ef-peso-utf-buf     to ef-peso-utf-2-buf
              move ef-peso-non-utf-buf to ef-peso-non-utf-2-buf
              move ef-mp-buf           to ef-mp-2-buf
              move ef-oneri-buf        to ef-oneri-2-buf
              display ef-art-2 ef-mag-2 ef-imb-2 ef-peso-2
                      ef-peso-utf-2 ef-peso-non-utf-2 ef-mp-2
                      ef-oneri-2 pb-ritorna lab-des-2
              modify pb-ritorna, bitmap-number = 1

              move 0 to e-genera
              move 3 to BitmapNumGenera
              modify pb-genera, enabled = e-genera,
                          bitmap-number = BitmapNumGenera
           end-if.
           move prg-cod-articolo  to ef-art-buf.
           move prg-cod-magazzino to ef-mag-buf.
           move prg-tipo-imballo  to ef-imb-buf.
           move prg-peso          to ef-peso-buf.
           move prg-peso-utf      to ef-peso-utf-buf.
           move prg-peso-non-utf  to ef-peso-non-utf-buf.
           display ef-art ef-mag ef-imb ef-peso 
                   ef-peso-utf ef-peso-non-utf ef-mp 
           .
      * <TOTEM:END>

       VALORIZZA-FROM-PROGMAG.
      * <TOTEM:PARA. VALORIZZA-FROM-PROGMAG>
           move prg-cod-articolo  to col-art.
           move prg-cod-magazzino to col-mag.
           move prg-tipo-imballo  to col-imb.
           move prg-peso          to col-peso.
           move prg-peso-utf      to col-utf.
           move prg-peso-non-utf  to col-non-utf.
           move costo-mp          to col-mp.
           move art-cod-doganale  to hid-cod-doganale.
           modify form1-gd-1(riga, 2),   cell-data = col-art.
           modify form1-gd-1(riga, 3),   cell-data = col-mag.
           modify form1-gd-1(riga, 4),   cell-data = col-imb.
           modify form1-gd-1(riga, 5),   cell-data = col-peso.
           modify form1-gd-1(riga, 7),   cell-data = col-utf.
           modify form1-gd-1(riga, 8),   cell-data = col-non-utf.
           modify form1-gd-1(riga, 9),   cell-data = col-mp.
           modify form1-gd-1(riga, 1), hidden-data = hid-cod-doganale.
           perform SOMMA-TOTALI 
           .
      * <TOTEM:END>

       VALORIZZA-NUOVO.
      * <TOTEM:PARA. VALORIZZA-NUOVO>
           initialize dis-rec replacing numeric data by zeroes
                                   alphanumeric data by spaces.
           
           perform TROVA-CHIAVE.
           move "00"    to status-distinteb.
           move 78-WinLinesWith to win-lines.
           initialize dis-dati replacing numeric data by zeroes
                                    alphanumeric data by spaces.
           perform FORM1-IUD-DISPLAY.

      ***---
       TROVA-CHIAVE.
           move high-value to dis-codice.
           start distinteb key is <= dis-codice
                 invalid move 0 to dis-codice
             not invalid
                 read distinteb previous
                      at end move 0 to dis-codice
                 end-read
           end-start.
           add 1 to dis-codice.
           move dis-codice to lab-numero-buf.
           display lab-numero 
           .
      * <TOTEM:END>

       VALORIZZA-OLD.
      * <TOTEM:PARA. VALORIZZA-OLD>
           move dis-rec to old-dis-rec.
           set vecchio to true.

           move 0 to StatusHelp
           perform STATUS-HELP 
           .
      * <TOTEM:END>

       X-Y.
      * <TOTEM:PARA. X-Y>
           inquire form1-gd-1, cursor-y in riga, cursor-x in colonna,
                               last-row in tot-righe 
           .
      * <TOTEM:END>

       COMPONI-TMP.
      * <TOTEM:PARA. COMPONI-TMP>
           move 0 to num-articoli.
           call "W$MOUSE" using set-mouse-shape, wait-pointer.
           set record-ok to true.
           accept  path-tmp-progmag-zoom from environment "PATH_ST".
           accept  como-data             from century-date.
           accept  como-ora              from time.
           inspect path-tmp-progmag-zoom replacing trailing
                                         spaces by low-value.
           string path-tmp-progmag-zoom  delimited by low-value
                  "tmp-progmag-zoom"     delimited by size
                  "_"                    delimited by size
                  como-data              delimited by size
                  "_"                    delimited by size
                  como-ora               delimited by size
                  into path-tmp-progmag-zoom
           end-string.
      
           set trovato to false.
           open output tmp-progmag-zoom.
           initialize prg-rec.
           move SaveArticolo  to prg-cod-articolo.
           start progmag key  is >= prg-chiave
                 invalid continue 
             not invalid perform CICLO-READ
           end-start.
      
           close tmp-progmag-zoom.
           call "W$MOUSE" using set-mouse-shape, arrow-pointer.
      
      ***---
       CICLO-READ.
           perform until 1 = 2
              read progmag next no lock at end exit perform end-read
              if prg-cod-articolo not = SaveArticolo
                 exit perform
              end-if
              set record-ok to false
              if prg-cod-magazzino not = spaces and
                 prg-tipo-imballo  not = spaces and
                 prg-peso          not = 0
                 move prg-cod-articolo  to art-codice
                 read articoli no lock 
                      invalid continue 
                  not invalid set record-ok to true
                 end-read
      
                 if record-ok
                                          
                    initialize imb-rec imq-rec mag-rec
                    move prg-cod-magazzino to mag-codice
                    move prg-tipo-imballo  to imb-codice
                                              imq-codice
                    read timballi  no lock invalid continue end-read
                    read timbalqta no lock invalid continue end-read
                    read tmagaz    no lock invalid continue end-read
      
                    move imq-qta-imb      to imballi-ed
                    move imq-tipo         to imb-codice
                    read timballi no lock
                         invalid  initialize imb-descrizione
                    end-read
                    inspect imb-descrizione replacing trailing spaces
                                                         by low-value
                    move imq-qta-imb    to imballi-ed
                    call "C$JUSTIFY" using imballi-ed, "L"
                    initialize imballo-descrizione
                    string  imb-descrizione delimited by low-value
                            " da "          delimited by size
                            imballi-ed      delimited by spaces
                            " x "           delimited by size
                            art-udm-imballo delimited by size
                            into imballo-descrizione
                    end-string
      
                    move art-codice          to tmp-prg-z-cod-articolo
                    move art-descrizione     to tmp-prg-z-art-des
                    move prg-cod-magazzino   to tmp-prg-z-cod-magazzino
                    move mag-descrizione     to tmp-prg-z-mag-des
                    move prg-tipo-imballo    to tmp-prg-z-tipo-imballo
                    move imballo-descrizione to tmp-prg-z-imb-des
                    move prg-peso            to tmp-prg-z-peso
                    move prg-giacenza        to tmp-prg-z-giacenza
                    move prg-impegnato       to tmp-prg-z-impegnato
                    move prg-ordinato-1      to tmp-prg-z-ordinato
      
                    write tmp-prg-z-rec invalid continue end-write
                    set trovato to true
                    add 1 to num-articoli
                    if num-articoli = 1
                       move prg-chiave to GiacenzaKey
                    end-if
                 end-if
      
              end-if
      
           end-perform 
           .
      * <TOTEM:END>

       ZOOM-SU-PROGMAG.
      * <TOTEM:PARA. ZOOM-SU-PROGMAG>
           move 0 to num-articoli.
           move SaveArticolo to art-codice.
           if art-codice = 0
              move "articoli"    to como-file
              call "zoom-gt"  using como-file, art-rec
                             giving stato-zoom
              end-call
              cancel "zoom-gt"
           else
              move 0 to stato-zoom
              read articoli no lock
                   invalid move spaces to art-descrizione
              end-read
           end-if.
           if stato-zoom = 0

LUBEXX        if SaveArticolo = 0
LUBEXX           if Hid-SiSomma
LUBEXX              modify form1-gd-1(riga, 12), bitmap spunta-bmp
LUBEXX                                           bitmap-number = 1
LUBEXX                                           bitmap-width 16
LUBEXX           else
LUBEXX              modify form1-gd-1(riga, 12), bitmap spunta-bmp
LUBEXX                                           bitmap-number = 2
LUBEXX                                           bitmap-width 16
LUBEXX           end-if
LUBEXX           modify form1-gd-1(riga, 12), 
LUBEXX                  hidden-data hid-somma
LUBEXX        end-if

              move art-codice     to SaveArticolo
              set filtro-articoli to true
              perform COMPONI-TMP
              if trovato
                 if num-articoli > 1
                    perform POSITION-ON-MAJOR-GIACENZA
                    move path-tmp-progmag-zoom to ext-file
                    move "tmp-progmag-zoom"    to como-file
                    call "zoom-gt"          using como-file, 
                                                  tmp-prg-z-rec
                                           giving stato-zoom
                    end-call
                    cancel "zoom-gt"
                    if stato-zoom = 0 
                       initialize prg-rec replacing numeric data by 
           zeroes
                                               alphanumeric data by 
           spaces
                       move tmp-prg-z-cod-articolo to prg-cod-articolo
                       read progmag no lock invalid continue end-read
                       perform CALCOLA-COSTO-MP
                       accept imp-data from century-date
                       start timposte key <= imp-chiave
                             invalid continue
                         not invalid
                             read timposte previous
                       end-start

                       perform CALCOLA-COSTO-MP-WHEN-ZERO
                       move tmp-prg-z-chiave to prg-chiave
                       read progmag no lock invalid continue end-read
                    end-if
                 else
                    perform UN-SOLO-ARTICOLO-SU-PROGMAG
                 end-if
              else
                 display message "Articolo NON valido"
                           title tit-err
                            icon 2
                 set errori to true
                 move 1 to stato-zoom
              end-if
              delete file tmp-progmag-zoom
           end-if 
           .
      * <TOTEM:END>

       UN-SOLO-ARTICOLO-SU-PROGMAG.
      * <TOTEM:PARA. UN-SOLO-ARTICOLO-SU-PROGMAG>
           |Se c'è un solo rec. su progmag con quel codice articolo
           |simulo la scelta di progmag da zoom con il rec. in linea
           initialize prg-rec replacing numeric data by zeroes
                                   alphanumeric data by spaces.
           move art-codice to prg-cod-articolo.
           read progmag no lock invalid continue end-read.
           perform CALCOLA-COSTO-MP.
           accept imp-data from century-date.
           start timposte key <= imp-chiave
                 invalid continue
             not invalid
                 read timposte previous
           end-start.
           perform CALCOLA-COSTO-MP-WHEN-ZERO.
           move GiacenzaKey   to prg-chiave.
           read progmag no  lock invalid continue end-read 
           .
      * <TOTEM:END>

       POSITION-ON-FIRST-RECORD.
      * <TOTEM:PARA. POSITION-ON-FIRST-RECORD>
           |Mi posiziono sul PRIMO record
           open input tmp-progmag-zoom.
           move low-value to tmp-prg-z-rec.
           start tmp-progmag-zoom key is >= key-des
                 invalid continue
           end-start.
           read tmp-progmag-zoom next end-read.
           close tmp-progmag-zoom 
           .
      * <TOTEM:END>

       POSITION-ON-MAJOR-GIACENZA.
      * <TOTEM:PARA. POSITION-ON-MAJOR-GIACENZA>
           open input tmp-progmag-zoom.
           move low-value               to tmp-prg-z-rec.
           move SaveArticolo            to tmp-prg-z-cod-articolo
                                           como-articolo.
           move 0      to como-giacenza.
           move spaces to como-record.
           start tmp-progmag-zoom key is >=  key-des
                 invalid continue
             not invalid
                 perform until 1 = 2
                    read tmp-progmag-zoom next at end exit perform
                    end-read
                    if tmp-prg-z-cod-articolo  not = como-articolo
                       exit perform
                    end-if
                    if tmp-prg-z-giacenza > como-giacenza or
                                            como-record = spaces
                       move tmp-prg-z-giacenza to como-giacenza
                       move tmp-prg-z-rec      to como-record
                    end-if
                 end-perform
           end-start.
           if como-record not = spaces
              move como-record to tmp-prg-z-rec
           end-if.
           close tmp-progmag-zoom 
           .
      * <TOTEM:END>

      * EVENT PARAGRAPH
       NUOVO-LinkTo.
      * <TOTEM:PARA. NUOVO-LinkTo>
           INQUIRE TOOL-NUOVO, ENABLED IN E-NUOVO.

           IF E-NUOVO = 1
              PERFORM NUOVO
           END-IF                    
           .
      * <TOTEM:END>
       CANCELLA-LinkTo.
      * <TOTEM:PARA. CANCELLA-LinkTo>
           INQUIRE TOOL-MODIFICA, VALUE IN MOD.
                              
           INQUIRE TOOL-CANCELLA, ENABLED IN E-CANCELLA
           IF E-CANCELLA = 1
              PERFORM CANCELLA
           END-IF                                                
           .
      * <TOTEM:END>
       TOOL-SALVA-LinkTo.
      * <TOTEM:PARA. TOOL-SALVA-LinkTo>
           INQUIRE TOOL-MODIFICA, VALUE IN MOD           

           INQUIRE TOOL-SALVA, ENABLED IN E-SALVA
           IF E-SALVA = 1
              PERFORM SALVA
           END-IF           
           .
      * <TOTEM:END>
       ANTEPRIMA-LinkTo.
      * <TOTEM:PARA. ANTEPRIMA-LinkTo>
           INQUIRE TOOL-ANTEPRIMA, ENABLED IN E-ANTEPRIMA.
           IF E-ANTEPRIMA = 1
                PERFORM ANTEPRIMA
           END-IF 
           .
      * <TOTEM:END>
       TOOL-MODIFICA-BeforeProcedure.
      * <TOTEM:PARA. TOOL-MODIFICA-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       TOOL-MODIFICA-AfterProcedure.
      * <TOTEM:PARA. TOOL-MODIFICA-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       TOOL-MODIFICA-LinkTo.
      * <TOTEM:PARA. TOOL-MODIFICA-LinkTo>
           INQUIRE TOOL-MODIFICA, ENABLED IN E-MODIFICA.

           IF E-MODIFICA = 1
              PERFORM MODIFICA
           END-IF 
           .
      * <TOTEM:END>
       STAMPA-LinkTo.
      * <TOTEM:PARA. STAMPA-LinkTo>
           INQUIRE TOOL-STAMPA, ENABLED IN E-STAMPA
           IF E-STAMPA = 1
                PERFORM STAMPA
           END-IF 
           .
      * <TOTEM:END>
       TOOL-CERCA-LinkTo.
      * <TOTEM:PARA. TOOL-CERCA-LinkTo>
           inquire tool-cerca, enabled in e-cerca
           if e-cerca = 1
              perform CERCA
           end-if 
           .
      * <TOTEM:END>
       TOOL-SELEZIONA-LinkTo.
      * <TOTEM:PARA. TOOL-SELEZIONA-LinkTo>
           inquire tool-seleziona, enabled in e-seleziona
           if e-seleziona = 1
              perform SELEZIONA
           end-if 
           .
      * <TOTEM:END>
       TOOL-PRIMO.
      * <TOTEM:PARA. TOOL-PRIMO>
           PERFORM PRIMO 
           .
      * <TOTEM:END>
       TOOL-PRECEDENTE.
      * <TOTEM:PARA. TOOL-PRECEDENTE>
           if nuovo             
              perform PRIMO
           else
              perform PRECEDENTE
           end-if 
           .
      * <TOTEM:END>
       TOOL-SUCCESSIVO.
      * <TOTEM:PARA. TOOL-SUCCESSIVO>
           if nuovo             
              perform ULTIMO
           else
              perform SUCCESSIVO
           end-if 
           .
      * <TOTEM:END>
       TOOL-ULTIMO.
      * <TOTEM:PARA. TOOL-ULTIMO>
           PERFORM ULTIMO 
           .
      * <TOTEM:END>
       ginqui-Ev-Before-Program.
      * <TOTEM:PARA. ginqui-Ev-Before-Program>
           move LK-BL-PROG-ID    TO COMO-PROG-ID.
           copy resource "spunta.bmp".
           call "W$BITMAP" using wbitmap-load "spunta.bmp"
                          giving spunta-bmp 
           .
      * <TOTEM:END>
       ginqui-Ev-After-Program.
      * <TOTEM:PARA. ginqui-Ev-After-Program>
           SET LK-BL-CANCELLAZIONE TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           call "W$BITMAP" using wbitmap-destroy, spunta-bmp 
           .
      * <TOTEM:END>
       form1-Gd-1-Ev-Msg-Begin-Entry.
      * <TOTEM:PARA. form1-Gd-1-Ev-Msg-Begin-Entry>
           if mod = 0 
              set event-action to event-action-fail 
           else
              if win-lines = 78-WinLinesWith and nuovo
                 set event-action to event-action-fail
              else
                 perform X-Y
                 perform VALORE-RIGA
                 evaluate colonna
                 when  2 
                       perform VALORE-OLD-RIGA
                 when 10
                 when 11
                      perform SETTA-VIRGOLA
                      perform VALORE-OLD-RIGA
                      if como-articolo = 0
                         set event-action to event-action-fail
                         modify form1-gd-1, 
                                cursor-y = riga, 
                                cursor-x = 2
                         perform COLORE-RIGA
                      else
                         move col-qta   to old-qta
                         move col-oneri to old-oneri
                      end-if
                 when 3
                 when 4
                 when 5
                 when 6
                 when 7
                 when 8
                 when 9  set event-action to event-action-fail
                         modify form1-gd-1, cursor-y = riga, 
                                            cursor-x = 2
                         perform COLORE-RIGA
                 when 12 set event-action to event-action-fail
                         inquire form1-gd-1, entry-reason in EntryReason
                         evaluate EntryReason
                         when x"20"
                         when x"0D"
                              perform SELEZIONA-DESELEZIONA
                         end-evaluate
                         move event-data-2 to riga
                         perform COLORE-RIGA
                 end-evaluate
              end-if
           end-if 
           .
      * <TOTEM:END>
       form1-Gd-1-Ev-Msg-Begin-Drag.
      * <TOTEM:PARA. form1-Gd-1-Ev-Msg-Begin-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       form1-Gd-1-Ev-Msg-End-Drag.
      * <TOTEM:PARA. form1-Gd-1-Ev-Msg-End-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       form1-Gd-1-Ev-Msg-Goto-Cell.
      * <TOTEM:PARA. form1-Gd-1-Ev-Msg-Goto-Cell>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       form1-Gd-1-Ev-Msg-Goto-Cell-Drag.
      * <TOTEM:PARA. form1-Gd-1-Ev-Msg-Goto-Cell-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       form1-Gd-1-Ev-Msg-Goto-Cell-Mouse.
      * <TOTEM:PARA. form1-Gd-1-Ev-Msg-Goto-Cell-Mouse>
           perform SPOSTAMENTO.
LUBEXX     if tutto-ok          and
LUBEXX        mod          = 1  and 
LUBEXX        event-data-1 = 12 and
LUBEXX        win-lines    = 78-WinLinesWithout
LUBEXX        perform SELEZIONA-DESELEZIONA
LUBEXX     end-if 
           .
      * <TOTEM:END>
       form1-Gd-1-Ev-Msg-Finish-Entry.
      * <TOTEM:PARA. form1-Gd-1-Ev-Msg-Finish-Entry>
           set trovato to false.
           move mb-no to scelta.
           perform X-Y.
           perform VALORE-RIGA.
           evaluate colonna
           when 2
                set trovato to true
                if como-articolo = 0 and col-mag not = spaces
                   if vecchio
                      if win-lines = 78-WinLinesWith
                         set FromFinishEntryCancPressed to true
                      end-if
                      perform CHIEDI-RIGENERA
                   else
                      display message box "Cancellare l'intera riga?"
                                 type mb-yes-no
                                title titolo
                              default mb-no
                                 icon 2
                               giving scelta
                      if scelta = mb-yes
                         modify form1-gd-1, record-to-delete = riga
                         perform FORM1-GD-1-CONTENT
                         move 0 to col-oneri-num 
                                   prg-peso-non-utf 
                                   prg-peso-utf
                                   costo-mp
                         move col-oneri   to old-oneri
                         move col-mp      to old-mp
                         move col-utf     to old-utf
                         move col-non-utf to col-non-utf
                         perform SOMMA-TOTALI
                      else
                         move SaveArticolo to col-art
                         modify form1-gd-1(riga, 2), cell-data = col-art
                      end-if
                   end-if
                end-if
           when 10 set trovato to true
                   perform RESETTA-VIRGOLA
           when 11 modify form1-gd-1(riga, 11), cell-data = col-oneri
                   perform RESETTA-VIRGOLA
           end-evaluate.

           if scelta = mb-no
              if win-lines = 78-WinLinesWith and vecchio
                 set FromFinishEntry to true
              end-if
              perform CONTROLLO-RIGA
              if errori
                 set event-action to event-action-fail
              else
                 if colonna = 2 and como-articolo not = 0
                    perform CONTROLLA-ARTICOLO-GIA-INSERITO
                    if errori
                       move mb-yes to scelta
                       set event-action to event-action-fail
                    end-if
                 end-if
              end-if
           end-if.

           if trovato
              |Sono le uniche ad avere un controllo di validità
              perform CHECK-2-ARTICOLI
           end-if.

           set FromFinishEntry to false 
           .
      * <TOTEM:END>
       TOOL-ORD-BeforeProcedure.
      * <TOTEM:PARA. TOOL-ORD-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       TOOL-ORD-AfterProcedure.
      * <TOTEM:PARA. TOOL-ORD-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       Screen1-Ef-1-BeforeProcedure.
      * <TOTEM:PARA. Screen1-Ef-1-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       Screen1-Ef-1-AfterProcedure.
      * <TOTEM:PARA. Screen1-Ef-1-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       pb-genera-BeforeProcedure.
      * <TOTEM:PARA. pb-genera-BeforeProcedure>
           move 2 to BitmapNumGenera.
           modify pb-genera, bitmap-number = BitmapNumGenera 
           .
      * <TOTEM:END>
       pb-genera-AfterProcedure.
      * <TOTEM:PARA. pb-genera-AfterProcedure>
           move 1 to BitmapNumGenera.
           modify pb-genera, bitmap-number = BitmapNumGenera 
           .
      * <TOTEM:END>
       pb-genera-LinkTo.
      * <TOTEM:PARA. pb-genera-LinkTo>
           perform PULISCI-ARTICOLO-FINALE.
           perform X-Y.
           move 78-WinLinesWith    to win-lines.
           modify form1-handle, lines win-lines.

           perform CALCOLA-TOTALI-GRID.
                                              
           move 1 to v-esc.
           move 0 to e-genera.
           move 3 to BitmapNumGenera.
           modify pb-genera, bitmap-number BitmapNumGenera,
                                   enabled e-genera.
           move 78-ID-ef-art to control-id.
           move 4 to accept-control.
           display lab-esc 
           .
      * <TOTEM:END>
       pb-azzera-BeforeProcedure.
      * <TOTEM:PARA. pb-azzera-BeforeProcedure>
           move 5 to BitmapNumAzzera.
           modify pb-azzera, bitmap-number = BitmapNumAzzera 
           .
      * <TOTEM:END>
       pb-azzera-AfterProcedure.
      * <TOTEM:PARA. pb-azzera-AfterProcedure>
           move 4 to BitmapNumAzzera.
           modify pb-azzera, bitmap-number = BitmapNumAzzera 
           .
      * <TOTEM:END>
       pb-azzera-LinkTo.
      * <TOTEM:PARA. pb-azzera-LinkTo>
           if mod = 0 exit paragraph end-if.
           perform X-Y.
           if tot-righe > 1
              display message "Reinserire i componenti?"
                        title titolo
                         type mb-yes-no
                      default mb-no
                       giving scelta
              if scelta = mb-yes
                 perform RESETTA-GRID
                 move 78-ID-form1-gd-1 to control-id
                 move 4                to accept-control
                 move 2                to riga
                 move 2                to colonna
                 modify form1-gd-1,    cursor-y = riga, 
                                       cursor-x = colonna
                 perform HELP-GRID
                 perform COLORE-RIGA
                 perform PULISCI-CAMPI-TOTALI
                 perform PULISCI-ARTICOLO-FINALE
                 move 78-WinLinesWithout to win-lines
                 modify form1-handle, lines win-lines

                 move 4 to BitmapNumAzzera
                 move 3 to BitmapNumGenera
                 move 0 to e-genera
                 move 1 to e-azzera
                 move 0 to v-riga
                 display ef-art-2 ef-mag-2 ef-imb-2 ef-peso-2 pb-ritorna
                         ef-peso-utf-2 ef-peso-non-utf-2 ef-mp-2 
                         lab-des-2
                 modify pb-ritorna, bitmap-number = 1
                 modify pb-genera,  enabled       e-genera,
                                    bitmap-number BitmapNumGenera
                 modify pb-azzera,  enabled       e-azzera,
                                    bitmap-number BitmapNumAzzera
              end-if
           end-if 
           .
      * <TOTEM:END>
       form1-Gd-1-Ev-Msg-Cancel-Entry.
      * <TOTEM:PARA. form1-Gd-1-Ev-Msg-Cancel-Entry>
           perform X-Y.
           evaluate colonna 
           when 2
                inquire form1-gd-1(riga, 3), cell-data in col-mag
                if col-mag = spaces
                   move 0 to col-art
                   modify form1-gd-1(riga, 2), cell-data = col-art
                   modify form1-gd-1, record-to-delete = riga
                   perform FORM1-GD-1-CONTENT
                end-if
           when 10
           when 11 perform RESETTA-VIRGOLA
           end-evaluate 
           .
      * <TOTEM:END>
       pb-ritorna-BeforeProcedure.
      * <TOTEM:PARA. pb-ritorna-BeforeProcedure>
           modify pb-ritorna, bitmap-number = 2 
           .
      * <TOTEM:END>
       pb-ritorna-AfterProcedure.
      * <TOTEM:PARA. pb-ritorna-AfterProcedure>
           modify pb-ritorna, bitmap-number = 1 
           .
      * <TOTEM:END>
       ef-art-BeforeProcedure.
      * <TOTEM:PARA. ef-art-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           evaluate true
           when v-riga = 1
                perform CANCELLA-COLORE
                move 78-ID-ef-art-2 to control-id
                move 4              to accept-control
           when vecchio
                perform CANCELLA-COLORE
                move 78-ID-form1-gd-1 to control-id
                move 4                to accept-control
                perform HELP-GRID
           end-evaluate 
           .
      * <TOTEM:END>
       ef-art-2-BeforeProcedure.
      * <TOTEM:PARA. ef-art-2-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-mag-2-BeforeProcedure.
      * <TOTEM:PARA. ef-mag-2-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-imb-2-BeforeProcedure.
      * <TOTEM:PARA. ef-imb-2-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-mag-BeforeProcedure.
      * <TOTEM:PARA. ef-mag-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-imb-BeforeProcedure.
      * <TOTEM:PARA. ef-imb-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-peso-BeforeProcedure.
      * <TOTEM:PARA. ef-peso-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-peso-utf-BeforeProcedure.
      * <TOTEM:PARA. ef-peso-utf-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-peso-non-utf-BeforeProcedure.
      * <TOTEM:PARA. ef-peso-non-utf-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-mp-BeforeProcedure.
      * <TOTEM:PARA. ef-mp-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-peso-2-BeforeProcedure.
      * <TOTEM:PARA. ef-peso-2-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-peso-utf-2-BeforeProcedure.
      * <TOTEM:PARA. ef-peso-utf-2-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-peso-non-utf-2-BeforeProcedure.
      * <TOTEM:PARA. ef-peso-non-utf-2-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-mp-2-BeforeProcedure.
      * <TOTEM:PARA. ef-mp-2-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-art-AfterProcedure.
      * <TOTEM:PARA. ef-art-AfterProcedure>
              INQUIRE ef-art, VALUE IN dis-articolo-finale
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-art-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-art-2-AfterProcedure.
      * <TOTEM:PARA. ef-art-2-AfterProcedure>
              INQUIRE ef-art-2, VALUE IN dis-articolo-finale
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-art-2-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-mag-2-AfterProcedure.
      * <TOTEM:PARA. ef-mag-2-AfterProcedure>
              INQUIRE ef-mag-2, VALUE IN dis-magazzino-finale
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-mag-2-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-imb-2-AfterProcedure.
      * <TOTEM:PARA. ef-imb-2-AfterProcedure>
              INQUIRE ef-imb-2, VALUE IN dis-imballo-finale
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-imb-2-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-mag-AfterProcedure.
      * <TOTEM:PARA. ef-mag-AfterProcedure>
              INQUIRE ef-mag, VALUE IN dis-magazzino-finale
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-mag-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-imb-AfterProcedure.
      * <TOTEM:PARA. ef-imb-AfterProcedure>
              INQUIRE ef-imb, VALUE IN dis-imballo-finale
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-imb-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-peso-AfterProcedure.
      * <TOTEM:PARA. ef-peso-AfterProcedure>
              INQUIRE ef-peso, VALUE IN dis-peso-finale
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-peso-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-peso-utf-AfterProcedure.
      * <TOTEM:PARA. ef-peso-utf-AfterProcedure>
              INQUIRE ef-peso-utf, VALUE IN dis-peso-utf
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-peso-utf-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-peso-non-utf-AfterProcedure.
      * <TOTEM:PARA. ef-peso-non-utf-AfterProcedure>
              INQUIRE ef-peso-non-utf, VALUE IN dis-peso-non-utf
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-peso-non-utf-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-mp-AfterProcedure.
      * <TOTEM:PARA. ef-mp-AfterProcedure>
              INQUIRE ef-mp, VALUE IN dis-prezzo
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-mp-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-peso-2-AfterProcedure.
      * <TOTEM:PARA. ef-peso-2-AfterProcedure>
              INQUIRE ef-peso-2, VALUE IN dis-peso-finale
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-peso-2-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-peso-utf-2-AfterProcedure.
      * <TOTEM:PARA. ef-peso-utf-2-AfterProcedure>
              INQUIRE ef-peso-utf-2, VALUE IN dis-peso-utf
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-peso-utf-2-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-peso-non-utf-2-AfterProcedure.
      * <TOTEM:PARA. ef-peso-non-utf-2-AfterProcedure>
              INQUIRE ef-peso-non-utf-2, VALUE IN dis-peso-non-utf
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-peso-non-utf-2-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-mp-2-AfterProcedure.
      * <TOTEM:PARA. ef-mp-2-AfterProcedure>
              INQUIRE ef-mp-2, VALUE IN dis-prezzo
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-mp-2-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       pb-ritorna-LinkTo.
      * <TOTEM:PARA. pb-ritorna-LinkTo>
           perform CANCELLA-COLORE.
           move 0 to v-riga.           
           perform FROM-2-TO-1.

           move 78-ID-ef-art to control-id.
           move 4 to accept-control.

           move 1 to e-genera.
           move 1 to BitmapNumGenera.
           modify pb-genera, enabled = e-genera,
                       bitmap-number = BitmapNumGenera 
           .
      * <TOTEM:END>
       form1-Gd-1-BeforeProcedure.
      * <TOTEM:PARA. form1-Gd-1-BeforeProcedure>
           if win-lines = 78-WinLinesWith and nuovo
              move 78-ID-ef-art to control-id
              move 4            to accept-control
           end-if 
           .
      * <TOTEM:END>

      *{TOTEM}END

      *{TOTEM}SHOW-MSG
       MESSAGE-FOR-FILEERROR.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
              MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           .

       SHOW-TRANSACTION-ROUTINE.
           IF TOTEM-TRANSACTION-FLAG = SPACES
              IF TRANSACTION-STATUS NOT = 0
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-1
              END-IF
           ELSE
              PERFORM SHOW-MSG-ROUTINE
              IF TRANSACTION-STATUS = 0
                 MOVE "Transazione terminata con Rollback." TO 
           TOTEM-MSG-3
              ELSE
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-3
              END-IF
           END-IF
           .

       SHOW-MSG-ROUTINE.
           MOVE SPACE TO TOTEM-MSG-1 TOTEM-MSG-2 TOTEM-MSG-3
           EVALUATE TOTEM-MSG-ID
               WHEN "10"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Nessun altro dato." TO TOTEM-MSG-2
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "22"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Chiave Duplicata." TO TOTEM-MSG-2
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "23"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Raggiunta fine file." TO TOTEM-MSG-2
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "101"
                    MOVE "Terminare l'applicazione?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "201"
                    MOVE "Aggiungere un nuovo record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "202"
                    MOVE "Aggiornare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "203"
                    MOVE "Cancellare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "204"
                    MOVE "Chiave duplicata." TO TOTEM-MSG-1
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "301"
                    MOVE "Inserimento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "302"
                    MOVE "Aggiornamento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "303"
                    MOVE "Cancellazione avvenuta con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "401"
                    MOVE "Shell non trovata." TO TOTEM-MSG-1
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN OTHER
                    MOVE TEXT-MESSAGE TO TOTEM-MSG-1
                    STRING "FILE:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-3
                    MOVE 0 TO TOTEM-IDX1
                    INSPECT TOTEM-MSG-3 TALLYING TOTEM-IDX1
                       FOR TRAILING SPACE
                    STRING TOTEM-MSG-3(1:TOTEM-MSG-LENGTH - 
           TOTEM-IDX1), 
                       ", FILE STATUS ", PRIMARY-ERROR "," 
                       SECONDARY-ERROR
                    DELIMITED BY SIZE INTO TOTEM-MSG-2
                    MOVE SPACES TO TOTEM-MSG-3
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
           END-EVALUATE
           PERFORM MESSAGE-BOX-ROUTINE
           .

       MESSAGE-BOX-ROUTINE.
           MOVE 1 TO TOTEM-MSG-TEXT-POINTER
           IF TOTEM-MSG-1 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-1 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              STRING TOTEM-MSG-1( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                 DELIMITED BY SIZE
                 INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-2 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-2 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-2( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-3 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-3 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-3( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-TEXT-POINTER = 1
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-TEXT TALLYING TOTEM-MSG-SIZE FOR 
           TRAILING SPACE
                  COMPUTE TOTEM-MSG-TEXT-POINTER = 
           TOTEM-MSG-FULL-LENGTH - TOTEM-MSG-SIZE + 1
           END-IF
           MOVE LOW-VALUES TO TOTEM-MSG-TEXT(TOTEM-MSG-TEXT-POINTER : 1 
           )
           .

       MESSAGE-BOX-DISPLAY.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

      *{TOTEM}END

