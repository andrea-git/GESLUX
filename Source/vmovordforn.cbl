      *{TOTEM}PRG-COMMENT
      * vmovordforn.Cbl
      * vmovordforn.Cbl is generated by TOTEM
      * This is a generated file. DO NOT modify this file directly.
      *{TOTEM}END
       IDENTIFICATION       DIVISION.
      *{TOTEM}PRGID
       PROGRAM-ID.          vmovordforn.
       AUTHOR.              andre.
       DATE-WRITTEN.        giovedì 10 settembre 2020 10:33:46.
       REMARKS.
      *{TOTEM}END

       ENVIRONMENT          DIVISION.
       CONFIGURATION        SECTION.
       SPECIAL-NAMES.
      *{TOTEM}SPECIAL-NAME
      * <TOTEM:EPT. INIT:vmovordforn, INIT:vmovordforn, SpecialName>
      * <TOTEM:END>
      *{TOTEM}END
      *{TOTEM}ACTIVEX-DEF
      *{TOTEM}END
      *{TOTEM}DECIMAL-POINT
           DECIMAL-POINT IS COMMA.
      *{TOTEM}END

       INPUT-OUTPUT         SECTION.
       FILE-CONTROL.
      *{TOTEM}FILE-CONTROL
           COPY "articoli.sl".
           COPY "tmarche.sl".
           COPY "tmp-movmagforn.sl".
           COPY "tparamge.sl".
           COPY "tcaumag.sl".
           COPY "lineseq.sl".
           COPY "tordforn.sl".
           COPY "rordforn.sl".
           COPY "destinif.sl".
           COPY "clienti.sl".
           COPY "clienti.sl"
                REPLACING ==clienti== BY ==clienti1==,
                          ==STATUS-clienti== BY ==STATUS-clienti1==
                .
           COPY "destini.sl".
      *{TOTEM}END
       DATA                 DIVISION.
       FILE                 SECTION.
      *{TOTEM}FILE
           COPY "articoli.fd".
           COPY "tmarche.fd".
           COPY "tmp-movmagforn.fd".
           COPY "tparamge.fd".
           COPY "tcaumag.fd".
           COPY "lineseq.fd".
           COPY "tordforn.fd".
           COPY "rordforn.fd".
           COPY "destinif.fd".
           COPY "clienti.fd".
           COPY "clienti.fd"
                REPLACING ==clienti== BY ==clienti1==,
                          ==STATUS-clienti== BY ==STATUS-clienti1==
                .
           COPY "destini.fd".
      *{TOTEM}END

       WORKING-STORAGE      SECTION.
      *{TOTEM}ACU-DEF
               COPY "acugui.def".
               COPY "acucobol.def".
               COPY "fonts.def".
               COPY "crtvars.def".
               COPY "showmsg.def".
               COPY "totem.def".
               COPY "standard.def".
      *{TOTEM}END

      *{TOTEM}COPY-WORKING
      * Key Status
       77 Key-Status IS SPECIAL-NAMES CRT STATUS PIC 9(5) VALUE 0.
          88 Enter-Pushed VALUE 13.
          88 Exit-Pushed VALUE 27.
          88 Message-Received VALUE 95.
          88 Event-Occurred VALUE 96.
          88 Screen-No-Input-Field VALUE 97.
          88 Screen-Time-Out VALUE 99.
      * Properties & User defined Working Stoarge
       77 STATUS-clienti   PIC  X(2).
           88 Valid-STATUS-clienti VALUE IS "00" THRU "09". 
       77 STATUS-tordforn  PIC  X(2).
           88 Valid-STATUS-tordforn VALUE IS "00" THRU "09". 
       78 titolo VALUE IS "Geslux - Interrogazione sui movimenti". 
       77 counter          PIC  9(10).
       77 counter2         PIC  9(10).
       77 counter-edit     PIC  z(10).
       77 RecCounter       PIC  9(10)
                  VALUE IS 0.
       77 toolbar-bmp      PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 E-ESCI           PIC  9
                  VALUE IS 1.
       77 FILLER           PIC  9.
           88 CallManutenzione VALUE IS 1    WHEN SET TO FALSE  0. 
       77 Small-Font
                  USAGE IS HANDLE OF FONT SMALL-FONT.
       77 form1-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 AUTO-ID          PIC  9(6)
                  VALUE IS 0.
       77 BLUE-FINO-28X24-BMP          PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 BLUE-DA-28X24-BMP            PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 form2-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 como-riga        PIC  9(6).
       77 SaveArticolo     PIC  9(5).
       77 como-data-to     PIC  9(8).
       77 como-data-from   PIC  9(8).
       77 hid-riga         PIC  9(5).
       77 hid-movim        PIC  9(8).
       77 hid-anno         PIC  9(4).
       77 elemento-bmp
                  USAGE IS HANDLE OF BITMAP.
       77 como-user        PIC  x(20).
       01 FILLER           PIC  9.
           88 prima-volta VALUE IS 1    WHEN SET TO FALSE  0. 
       01 GruppoHidden.
           05 hid-clifor       PIC  x(9).
           05 hid-codice       PIC  9(5).
           05 hid-ragsoc       PIC  x(80).
           05 hid-des-prog     PIC  9(5).
           05 hid-ragsoc-des   PIC  x(40).
           05 hid-citta-des    PIC  x(35).
           05 hid-cod-marca    PIC  9(4).
           05 hid-marca        PIC  x(40).
       77 FILLER           PIC  9.
           88 BeginEntry VALUE IS 1    WHEN SET TO FALSE  0. 
       01 FILLER           PIC  9.
           88 FileOpen VALUE IS 1    WHEN SET TO FALSE  0. 
       01 FILLER           PIC  x.
           88 record-ok VALUE IS "O"    WHEN SET TO FALSE  "k". 
       77 Verdana10B-Occidentale
                  USAGE IS HANDLE OF FONT DEFAULT-FONT.
       77 como-x           PIC  x.
       77 Form3-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 Verdana12BI-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 font-evidenzia-griglia
                  USAGE IS HANDLE OF FONT.
       77 e-des            PIC  9
                  VALUE IS 1.
       77 Form1-Tb-1-Handlea
                  USAGE IS HANDLE OF WINDOW.
       77 E-CERCA          PIC  9
                  VALUE IS 0.
       77 STATUS-articoli  PIC  X(2).
           88 Valid-STATUS-articoli VALUE IS "00" THRU "09". 
       77 STATUS-tmarche   PIC  X(2).
           88 Valid-STATUS-tmarche VALUE IS "00" THRU "09". 
       77 ef-data-from-buf PIC  99/99/9999.
       77 ef-data-to-buf   PIC  99/99/9999.
       77 path-tmp-movmagforn          PIC  X(256).
       77 STATUS-tmp-movmagforn        PIC  X(2).
           88 Valid-STATUS-tmp-movmagforn VALUE IS "00" THRU "09". 
       77 STATUS-tcaumag   PIC  X(2).
           88 Valid-STATUS-tcaumag VALUE IS "00" THRU "09". 
       77 lab-tot-kg-buf   PIC  ----.---.--9,999.
       77 lab-tot-imp-buf  PIC  ----.---.---.--9,99.
       77 tot-kg           PIC  s9(12)v999.
       77 tot-imp          PIC  s9(12)v99.
       77 tot-colimp       PIC  s9(12)v99.
       77 tot-add-pb       PIC  s9(12)v99.
       77 tot-cons         PIC  s9(12)v99.
       77 tot-coubat       PIC  s9(12)v99.
       77 STATUS-tparamge  PIC  X(2).
           88 Valid-STATUS-tparamge VALUE IS "00" THRU "09". 
       77 Arial10BI-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 lab-tot-coubat-buf           PIC  ----.---.--9,99.
       77 lab-tot-add-buf  PIC  ----.---.--9,99.
       77 lab-tot-cons-buf PIC  ----.---.--9,99.
       77 lab-tot-colimp-buf           PIC  ----.---.---.--9,99.
       77 tmo-codmag       PIC  x(3).
       77 bottone-ok-bmp   PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 bottone-cancel-bmp           PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 BOTTONE-EXIT-BMP PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 Verdana12-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 STATUS-destinif  PIC  X(2).
           88 Valid-STATUS-destinif VALUE IS "00" THRU "09". 
       77 lab-codfor-buf   PIC  X(9).
       77 lab-ragsoc-buf   PIC  X(80).
       77 lab-citta-buf    PIC  X(35).
       77 lab-marca-2-buf  PIC  X(40).
       77 lab-codice-buf   PIC  z(5).
       77 lab-des-prog-buf PIC  z(5).
       77 lab-cod-marca-buf            PIC  z(4).
       77 EXCEL-BMP        PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 como-numero      PIC  s9(12)v999.
       77 stampa-tipo      PIC  9
                  VALUE IS 0.
           88 stampa-excel VALUE IS 1    WHEN SET TO FALSE  0. 
       77 wstampa          PIC  X(256).
       77 STATUS-lineseq   PIC  X(2).
           88 Valid-STATUS-lineseq VALUE IS "00" THRU "09". 
       77 STATUS-rordforn  PIC  X(2).
           88 Valid-STATUS-rordforn VALUE IS "00" THRU "09". 
       01 gd-mov-record.
           05 col-nulla        PIC  x.
           05 col-magazzino    PIC  x(3).
           05 col-forn         PIC  X(80).
           05 col-cod-art      PIC  z(6).
           05 col-desart       PIC  x(50).
           05 col-movim        PIC  z(8).
           05 col-data-movim   PIC  99/99/9999.
           05 col-qta-ord      PIC  ---.---.--9.
           05 col-qta-eva      PIC  ---.---.--9.
           05 col-imp          PIC  ----.---.--9,9999.
           05 col-add          PIC  --.--9,9999.
           05 col-cons         PIC  --.--9,9999.
           05 col-coubat       PIC  --.--9,9999.
           05 col-prz-finito   PIC  ----.---.--9,9999.
       77 lab-dest-buf     PIC  X(35).
       77 Arial8-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 Arial8B-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 STATUS-clienti1  PIC  X(2).
           88 VALID-STATUS-clienti1 VALUE IS "00" THRU "09". 
       77 STATUS-destini   PIC  X(2).
           88 Valid-STATUS-destini VALUE IS "00" THRU "09". 
       77 Verdana12B-Occidentale
                  USAGE IS HANDLE OF FONT.

      ***********************************************************
      *   Code Gen's Buffer                                     *
      ***********************************************************
       77 STATUS-Form2-FLAG-REFRESH PIC  9.
          88 Form2-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 TMP-Form2-KEY1-ORDER  PIC X VALUE "A".
       77 TMP-Form2-tordforn-RESTOREBUF  PIC X(556).
       77 TMP-Form2-KEYIS  PIC 9(3) VALUE 1.
       77 Form2-MULKEY-TMPBUF   PIC X(556).
       77 STATUS-Form1-FLAG-REFRESH PIC  9.
          88 Form1-FLAG-REFRESH  VALUE 1 FALSE 0. 
      * DATA CONTROL BUFFER
       01 Form1-BUF.
      * Data.Entry-Field
              05 ef-cod-BUF PIC z(5).
      * Data.Entry-Field
              05 ef-des-forn-BUF PIC z(5).
      * Data.Entry-Field
              05 ef-cliente-BUF PIC z(5).
      * Data.Entry-Field
              05 ef-des-cli-BUF PIC z(5).
      * Data.Entry-Field
              05 ef-marca-BUF PIC z(4).
      * Data.Entry-Field
              05 ef-art-BUF PIC z(6).
      * Data.Label
              05 lab-forn-BUF PIC X(40).
      * Data.Label
              05 lab-marca-BUF PIC X(30).
      * Data.Label
              05 lab-art-BUF PIC X(50).
      * Data.Label
              05 lab-des-forn-BUF PIC X(40).
      * Data.Label
              05 lab-des-cli-BUF PIC X(40).
      * Data.Label
              05 lab-cli-BUF PIC X(40).

       77 STATUS-form3-FLAG-REFRESH PIC  9.
          88 form3-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 TMP-DataSet1-articoli-BUF     PIC X(3669).
       77 TMP-DataSet1-tmarche-BUF     PIC X(217).
       77 TMP-DataSet1-tmp-movmagforn-BUF     PIC X(226).
       77 TMP-DataSet1-tparamge-BUF     PIC X(815).
       77 TMP-DataSet1-tcaumag-BUF     PIC X(254).
       77 TMP-DataSet1-lineseq-BUF     PIC X(900).
       77 TMP-DataSet1-tordforn-BUF     PIC X(556).
       77 TMP-DataSet1-rordforn-BUF     PIC X(544).
       77 TMP-DataSet1-destinif-BUF     PIC X(1322).
       77 TMP-DataSet1-clienti-BUF     PIC X(1910).
       77 TMP-DataSet1-clienti1-BUF     PIC X(1910).
       77 TMP-DataSet1-destini-BUF     PIC X(3386).
      * VARIABLES FOR RECORD LENGTH.
       77  TotemFdSlRecordClearOffset   PIC 9(5) COMP-4.
       77  TotemFdSlRecordLength        PIC 9(5) COMP-4.
      * FILE'S LOCK MODE FLAG
       77 DataSet1-articoli-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-articoli-LOCK  VALUE "Y".
       77 DataSet1-articoli-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-articoli-KEY-Asc  VALUE "A".
          88 DataSet1-articoli-KEY-Desc VALUE "D".
       77 DataSet1-tmarche-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tmarche-LOCK  VALUE "Y".
       77 DataSet1-tmarche-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tmarche-KEY-Asc  VALUE "A".
          88 DataSet1-tmarche-KEY-Desc VALUE "D".
       77 DataSet1-tmp-movmagforn-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tmp-movmagforn-LOCK  VALUE "Y".
       77 DataSet1-tmp-movmagforn-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tmp-movmagforn-KEY-Asc  VALUE "A".
          88 DataSet1-tmp-movmagforn-KEY-Desc VALUE "D".
       77 DataSet1-tparamge-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tparamge-LOCK  VALUE "Y".
       77 DataSet1-tparamge-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tparamge-KEY-Asc  VALUE "A".
          88 DataSet1-tparamge-KEY-Desc VALUE "D".
       77 DataSet1-tcaumag-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tcaumag-LOCK  VALUE "Y".
       77 DataSet1-tcaumag-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tcaumag-KEY-Asc  VALUE "A".
          88 DataSet1-tcaumag-KEY-Desc VALUE "D".
       77 DataSet1-lineseq-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-lineseq-LOCK  VALUE "Y".
       77 DataSet1-lineseq-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-lineseq-KEY-Asc  VALUE "A".
          88 DataSet1-lineseq-KEY-Desc VALUE "D".
       77 DataSet1-tordforn-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tordforn-LOCK  VALUE "Y".
       77 DataSet1-KEYIS   PIC 9(3) VALUE 1.
       77 DataSet1-tordforn-KEY1-ORDER  PIC X VALUE "A".
          88 DataSet1-tordforn-KEY1-Asc  VALUE "A".
          88 DataSet1-tordforn-KEY1-Desc VALUE "D".
       77 DataSet1-rordforn-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-rordforn-LOCK  VALUE "Y".
       77 DataSet1-rordforn-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-rordforn-KEY-Asc  VALUE "A".
          88 DataSet1-rordforn-KEY-Desc VALUE "D".
       77 DataSet1-destinif-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-destinif-LOCK  VALUE "Y".
       77 DataSet1-destinif-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-destinif-KEY-Asc  VALUE "A".
          88 DataSet1-destinif-KEY-Desc VALUE "D".
       77 DataSet1-clienti-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-clienti-LOCK  VALUE "Y".
       77 DataSet1-clienti-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-clienti-KEY-Asc  VALUE "A".
          88 DataSet1-clienti-KEY-Desc VALUE "D".
       77 DataSet1-clienti1-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-clienti1-LOCK  VALUE "Y".
       77 DataSet1-clienti1-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-clienti1-KEY-Asc  VALUE "A".
          88 DataSet1-clienti1-KEY-Desc VALUE "D".
       77 DataSet1-destini-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-destini-LOCK  VALUE "Y".
       77 DataSet1-destini-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-destini-KEY-Asc  VALUE "A".
          88 DataSet1-destini-KEY-Desc VALUE "D".

       77 articoli-art-k1-SPLITBUF  PIC X(51).
       77 articoli-art-k-frn-SPLITBUF  PIC X(16).
       77 tmp-movmagforn-tmp-movf-k1-SPLITBUF  PIC X(20).
       77 tcaumag-k-mag-SPLITBUF  PIC X(5).
       77 tordforn-tof-k-causale-SPLITBUF  PIC X(17).
       77 tordforn-tof-k-stato-SPLITBUF  PIC X(14).
       77 tordforn-k-fornitore-SPLITBUF  PIC X(24).
       77 tordforn-tof-k-data-SPLITBUF  PIC X(21).
       77 rordforn-rof-k-articolo-SPLITBUF  PIC X(24).
       77 rordforn-rof-k-art-mag-SPLITBUF  PIC X(27).
       77 destinif-K1-SPLITBUF  PIC X(51).
       77 destinif-desf-k2-SPLITBUF  PIC X(51).
       77 clienti-cli-K1-SPLITBUF  PIC X(47).
       77 clienti-cli-K3-SPLITBUF  PIC X(12).
       77 clienti-cli-K4-SPLITBUF  PIC X(8).
       77 clienti1-cli-K1-SPLITBUF  PIC X(47).
       77 clienti1-cli-K3-SPLITBUF  PIC X(12).
       77 clienti1-cli-K4-SPLITBUF  PIC X(8).
       77 destini-K1-SPLITBUF  PIC X(51).
       77 destini-k-localita-SPLITBUF  PIC X(36).

           COPY "COMMON-EXCEL.DEF".
           COPY "ACCETTA-NUM-REC-THIN.DEF".
           COPY "LINK-GESLOCK.DEF".
           copy "link-st-ordforn.def".
       01 r-riga.
           05 r-mag            pic x(3).
           05 r-codice         pic z(5).
           05 r-ragsoc         pic x(80).
           05 r-destino        pic z(5).
           05 r-ragsoc-dest    pic x(80).
           05 r-localita       pic x(40).
           05 r-numero         pic z(8).
           05 r-data-mov       pic 99/99/9999.
           05 r-marca          pic z(4).
           05 r-articolo       pic z(6).
           05 r-desart         pic x(50).
           05 r-imp-merce      pic ----.---.---.--9,9999.
           05 r-add-pb         pic ----.---.---.--9,9999.
           05 r-cons           pic ----.---.---.--9,9999.
           05 r-coubat         pic ----.---.---.--9,9999.
           05 r-qta-ord        pic ---.---.--9.
           05 r-qta-eva        pic ---.---.--9.
           05 r-prezzo         pic ----.---.---.--9,9999.
           05 r-tot            pic ----.---.---.--9,9999.
           05 r-peso           pic zzz.zzz.zz9,999.
           05 r-utf            pic x.
           05 r-promo          pic 9(15).
           05 r-stato          pic x(20).
           05 r-codartfrn      pic 9(5).

       78  78-colore-inevasa    value 513.
       78  78-colore-paraziale  value 481.
       78  78-colore-evasa      value 112.

       78  78-col-evava         value 9.
      *{TOTEM}END

      *{TOTEM}ID-LOGICI
      ***** Elenco ID Logici *****
       78  78-ID-ef-data-from VALUE 5001.
       78  78-ID-ef-data-to VALUE 5002.
       78  78-ID-ef-cod VALUE 5003.
       78  78-ID-ef-des-forn VALUE 5004.
       78  78-ID-ef-cliente VALUE 5005.
       78  78-ID-ef-des-cli VALUE 5006.
       78  78-ID-ef-marca VALUE 5007.
       78  78-ID-ef-art VALUE 5008.
      ***** Fine ID Logici *****
      *{TOTEM}END

       LINKAGE          SECTION.
      *{TOTEM}LINKAGE
           COPY  "COMMON-LINKAGE.DEF".

      *{TOTEM}END

       SCREEN           SECTION.
      *{TOTEM}COPY-SCREEN
      * FORM
       01 
           Form2, 
           .

      * FRAME
       05
           Screen1-Fr-1, 
           Frame, 
           COL 1,17, 
           LINE 46,46,
           LINES 3,54 ,
           SIZE 33,00 ,
           LOWERED,
           FULL-HEIGHT,
           ID IS 2,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           .

      * LABEL
       05
           Screen1-La-3, 
           Label, 
           COL 4,17, 
           LINE 46,69,
           LINES 1,38 ,
           SIZE 27,00 ,
           COLOR IS 304,
           FONT IS Verdana12B-Occidentale,
           ID IS 10,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TITLE "ORDINE CHIUSO",
           .

      * LABEL
       05
           Screen1-La-3c, 
           Label, 
           COL 4,17, 
           LINE 48,38,
           LINES 1,38 ,
           SIZE 27,00 ,
           COLOR IS 513,
           FONT IS Verdana12B-Occidentale,
           ID IS 11,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TITLE "ORDINE APERTO",
           .

      * GRID
       05
           gd-mov, 
           Grid, 
           COL 1,83, 
           LINE 2,00,
           LINES 35,54 ,
           SIZE 166,17 ,
           ADJUSTABLE-COLUMNS,
           BOXED,
           CENTERED-HEADINGS,
           DATA-COLUMNS (1, 2, 5, 85, 91, 141, 149, 159, 170, 181, 198, 
           209, 220, 231),
           ALIGNMENT ("C", "L", "L", "R", "L", "R", "C", "R", "R", "R", 
           "R", "R", "R", "R"),
           SEPARATION (5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5),
           DATA-TYPES ("X", "X", "x(80)", "9(6)", "X", "X", "X", "9(11)"
           , "9(11)", "9(15)", "9(10)", "9(9)", "9(9)", "9(15)"),
           NUM-COL-HEADINGS 1,
           COLUMN-HEADINGS,
           CURSOR-FRAME-WIDTH 0,
           DIVIDER-COLOR 1,
           FONT IS Arial8-Occidentale,
           HEADING-COLOR 257,
           HEADING-DIVIDER-COLOR 1,
           HEADING-FONT IS Arial8B-Occidentale,
           ID IS 1,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           ROW-HEADINGS,
           TILED-HEADINGS,
           VIRTUAL-WIDTH 163,
           VPADDING 50,
           VSCROLL,
           EVENT PROCEDURE Screen1-Gd-1-Event-Proc,
           .

      * FRAME
       05
           Screen1-Fr-1a, 
           Frame, 
           COL 34,54, 
           LINE 46,46,
           LINES 3,54 ,
           SIZE 107,17 ,
           LOWERED,
           FULL-HEIGHT,
           ID IS 202,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           .

      * LABEL
       05
           lab-action, 
           Label, 
           COL 36,54, 
           LINE 47,31,
           LINES 1,31 ,
           SIZE 102,00 ,
           FONT IS Arial10BI-Occidentale,
           ID IS 203,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Doppio Click o Invio per visualizzare l'anteprima dell
      -    "'intero ordine",
           .

      * FRAME
       05
           Screen1-Fr-1aa, 
           Frame, 
           COL 141,83, 
           LINE 46,46,
           LINES 3,54 ,
           SIZE 27,00 ,
           LOWERED,
           FULL-HEIGHT,
           ID IS 6,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           .

      * PUSH BUTTON
       05
           pb-ok2, 
           Push-Button, 
           COL 142,33, 
           LINE 46,92,
           LINES 30,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE BOTTONE-OK-BMP,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 1000,
           FLAT,
           ID IS 200,
           AFTER PROCEDURE pb-ok2-AfterProcedure, 
           BEFORE PROCEDURE pb-ok2-BeforeProcedure, 
           .

      * PUSH BUTTON
       05
           pb-annulla2, 
           Push-Button, 
           COL 155,33, 
           LINE 46,92,
           LINES 30,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE BOTTONE-CANCEL-BMP,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 27,
           FLAT,
           ID IS 201,
           SELF-ACT,
           ESCAPE-BUTTON,
           AFTER PROCEDURE pb-annulla2-AfterProcedure, 
           BEFORE PROCEDURE pb-annulla2-BeforeProcedure, 
           .

      * LABEL
       05
           Screen1-La-1, 
           Label, 
           COL 96,67, 
           LINE 44,00,
           LINES 1,31 ,
           SIZE 9,00 ,
           FONT IS Arial10BI-Occidentale,
           ID IS 204,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Tot. Kg.",
           VISIBLE 0,
           .

      * LABEL
       05
           Screen1-La-2, 
           Label, 
           COL 128,67, 
           LINE 44,00,
           LINES 1,31 ,
           SIZE 17,00 ,
           FONT IS Arial10BI-Occidentale,
           ID IS 205,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           TRANSPARENT,
           TITLE "Tot. Imponibile",
           VISIBLE 0,
           .

      * LABEL
       05
           lab-tot-kg, 
           Label, 
           COL 111,33, 
           LINE 44,00,
           LINES 1,31 ,
           SIZE 17,00 ,
           COLOR IS 5,
           FONT IS Arial10BI-Occidentale,
           ID IS 206,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           TRANSPARENT,
           TITLE lab-tot-kg-buf,
           VISIBLE 0,
           .

      * LABEL
       05
           lab-tot-imp, 
           Label, 
           COL 147,67, 
           LINE 44,00,
           LINES 1,31 ,
           SIZE 20,00 ,
           COLOR IS 5,
           FONT IS Arial10BI-Occidentale,
           ID IS 207,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           TRANSPARENT,
           TITLE lab-tot-imp-buf,
           VISIBLE 0,
           .

      * LABEL
       05
           lab-tot-coubat, 
           Label, 
           COL 147,67, 
           LINE 41,00,
           LINES 1,31 ,
           SIZE 20,00 ,
           COLOR IS 5,
           FONT IS Arial10BI-Occidentale,
           ID IS 208,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           TRANSPARENT,
           TITLE lab-tot-coubat-buf,
           VISIBLE 0,
           .

      * LABEL
       05
           lab-tot-cons, 
           Label, 
           COL 130,67, 
           LINE 41,00,
           LINES 1,31 ,
           SIZE 15,00 ,
           COLOR IS 5,
           FONT IS Arial10BI-Occidentale,
           ID IS 209,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           TRANSPARENT,
           TITLE lab-tot-cons-buf,
           VISIBLE 0,
           .

      * LABEL
       05
           lab-tot-colimp, 
           Label, 
           COL 106,33, 
           LINE 41,00,
           LINES 1,31 ,
           SIZE 20,00 ,
           COLOR IS 5,
           FONT IS Arial10BI-Occidentale,
           ID IS 210,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           TRANSPARENT,
           TITLE lab-tot-colimp-buf,
           VISIBLE 0,
           .

      * LABEL
       05
           Screen1-La-1a, 
           Label, 
           COL 96,67, 
           LINE 41,00,
           LINES 1,31 ,
           SIZE 7,00 ,
           FONT IS Arial10BI-Occidentale,
           ID IS 211,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Totali",
           VISIBLE 0,
           .

      * BAR
       05
           Screen1-Br-1, 
           Bar,
           COL 96,33, 
           LINE 40,00,
           SIZE 72,17 ,
           ID IS 3,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           COLORS (8, 8),
           SHADING (-1, 1),
           WIDTH 2,
           VISIBLE 0,
           .

      * BAR
       05
           Screen1-Br-1a, 
           Bar,
           COL 96,33, 
           LINE 43,00,
           SIZE 72,17 ,
           ID IS 4,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           COLORS (8, 8),
           SHADING (-1, 1),
           WIDTH 2,
           VISIBLE 0,
           .

      * BAR
       05
           Screen1-Br-1aa, 
           Bar,
           COL 96,33, 
           LINE 43,38,
           SIZE 72,17 ,
           ID IS 5,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           COLORS (8, 8),
           SHADING (-1, 1),
           WIDTH 2,
           VISIBLE 0,
           .

      * LABEL
       05
           lab-codfor, 
           Label, 
           COL 3,00, 
           LINE 38,00,
           LINES 1,31 ,
           SIZE 10,00 ,
           COLOR IS 5,
           FONT IS Arial10BI-Occidentale,
           ID IS 7,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Fornitore",
           .

      * LABEL
       05
           lab-ragsoc, 
           Label, 
           COL 20,00, 
           LINE 38,00,
           LINES 1,31 ,
           SIZE 75,00 ,
           COLOR IS 5,
           FONT IS Arial10BI-Occidentale,
           ID IS 8,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-ragsoc-buf,
           .

      * LABEL
       05
           Screen1-La-3a, 
           Label, 
           COL 3,00, 
           LINE 40,00,
           LINES 1,31 ,
           SIZE 8,00 ,
           COLOR IS 5,
           FONT IS Arial10BI-Occidentale,
           ID IS 9,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Destino",
           .

      * LABEL
       05
           Screen1-La-3b, 
           Label, 
           COL 3,00, 
           LINE 44,00,
           LINES 1,31 ,
           SIZE 8,00 ,
           COLOR IS 5,
           FONT IS Arial10BI-Occidentale,
           ID IS 12,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Marca",
           .

      * LABEL
       05
           lab-marca-2, 
           Label, 
           COL 20,00, 
           LINE 44,00,
           LINES 1,31 ,
           SIZE 75,00 ,
           COLOR IS 5,
           FONT IS Arial10BI-Occidentale,
           ID IS 13,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-marca-2-buf,
           .

      * LABEL
       05
           lab-citta, 
           Label, 
           COL 20,00, 
           LINE 42,00,
           LINES 1,31 ,
           SIZE 75,00 ,
           COLOR IS 5,
           FONT IS Arial10BI-Occidentale,
           ID IS 14,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-citta-buf,
           .

      * LABEL
       05
           lab-codice, 
           Label, 
           COL 12,00, 
           LINE 38,00,
           LINES 1,31 ,
           SIZE 6,00 ,
           COLOR IS 5,
           FONT IS Arial10BI-Occidentale,
           ID IS 15,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           TRANSPARENT,
           TITLE lab-codice-buf,
           .

      * LABEL
       05
           lab-des-prog, 
           Label, 
           COL 12,00, 
           LINE 40,00,
           LINES 1,31 ,
           SIZE 6,00 ,
           COLOR IS 5,
           FONT IS Arial10BI-Occidentale,
           ID IS 16,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           TRANSPARENT,
           TITLE lab-des-prog-buf,
           .

      * LABEL
       05
           lab-cod-marca, 
           Label, 
           COL 12,00, 
           LINE 44,00,
           LINES 1,31 ,
           SIZE 6,00 ,
           COLOR IS 5,
           FONT IS Arial10BI-Occidentale,
           ID IS 17,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           TRANSPARENT,
           TITLE lab-cod-marca-buf,
           .

      * LABEL
       05
           Screen1-La-1aa, 
           Label, 
           COL 111,33, 
           LINE 38,08,
           LINES 1,31 ,
           SIZE 15,00 ,
           FONT IS Arial10BI-Occidentale,
           ID IS 18,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           TRANSPARENT,
           TITLE "Imponibile",
           VISIBLE 0,
           .

      * LABEL
       05
           Screen1-La-1aaa, 
           Label, 
           COL 130,67, 
           LINE 38,08,
           LINES 1,31 ,
           SIZE 15,00 ,
           FONT IS Arial10BI-Occidentale,
           ID IS 19,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           TRANSPARENT,
           TITLE "I. Consumo",
           VISIBLE 0,
           .

      * LABEL
       05
           Screen1-La-1aaaa, 
           Label, 
           COL 152,67, 
           LINE 38,08,
           LINES 1,31 ,
           SIZE 15,00 ,
           FONT IS Arial10BI-Occidentale,
           ID IS 20,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           TRANSPARENT,
           TITLE "Cou/Cobat",
           VISIBLE 0,
           .

      * LABEL
       05
           lab-dest, 
           Label, 
           COL 20,00, 
           LINE 40,00,
           LINES 1,31 ,
           SIZE 75,00 ,
           COLOR IS 5,
           FONT IS Arial10BI-Occidentale,
           ID IS 21,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-dest-buf,
           .

      * FORM
       01 
           Form1, 
           AFTER PROCEDURE Form1-AfterProcedure,
           BEFORE PROCEDURE Form1-BeforeProcedure,
           .

      * FRAME
       05
           frame-limiti, 
           Frame, 
           COL 1,50, 
           LINE 1,50,
           LINES 21,00 ,
           SIZE 44,60 ,
           ID IS 9,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Selezione limiti",
           TITLE-POSITION 2,
           .

      * ENTRY FIELD
       05
           ef-data-from, 
           Entry-Field, 
           COL 2,50, 
           LINE 3,27,
           LINES 1,33 ,
           SIZE 11,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED e-des,
           ID IS 78-ID-ef-data-from,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           NUMERIC,
           VALUE ef-data-from-buf,
           AFTER PROCEDURE ef-data-from-AfterProcedure, 
           BEFORE PROCEDURE ef-data-from-BeforeProcedure, 
           .


      * ENTRY FIELD
       05
           ef-data-to, 
           Entry-Field, 
           COL 30,50, 
           LINE 3,27,
           LINES 1,33 ,
           SIZE 11,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED e-des,
           ID IS 78-ID-ef-data-to,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           NUMERIC,
           VALUE ef-data-to-buf,
           AFTER PROCEDURE ef-data-to-AfterProcedure, 
           BEFORE PROCEDURE ef-data-to-BeforeProcedure, 
           .


      * CHECK BOX
       05
           chk-excel, 
           Check-Box, 
           COL 41,80, 
           LINE 3,00,
           LINES 28,00 ,
           SIZE 28,00 ,
           BITMAP-HANDLE EXCEL-BMP,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           FLAT,
           ID IS 2,
           TITLE "Generazione di file E&xcel",
           VALUE stampa-tipo,
           AFTER PROCEDURE scr-stampa-Cb-1-AfterProcedure,
           BEFORE PROCEDURE scr-stampa-Cb-1-BeforeProcedure, 
           .
      * ENTRY FIELD
       05
           ef-cod, 
           Entry-Field, 
           COL 13,00, 
           LINE 6,00,
           LINES 1,33 ,
           SIZE 7,00 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-ef-cod,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 5,
           VALUE ef-cod-BUF,
           .

      * ENTRY FIELD
       05
           ef-des-forn, 
           Entry-Field, 
           COL 13,00, 
           LINE 8,50,
           LINES 1,33 ,
           SIZE 7,00 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-ef-des-forn,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 5,
           VALUE ef-des-forn-BUF,
           .

      * ENTRY FIELD
       05
           ef-cliente, 
           Entry-Field, 
           COL 13,00, 
           LINE 11,56,
           LINES 1,33 ,
           SIZE 7,00 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-ef-cliente,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 5,
           VALUE ef-cliente-BUF,
           .

      * ENTRY FIELD
       05
           ef-des-cli, 
           Entry-Field, 
           COL 13,00, 
           LINE 14,06,
           LINES 1,33 ,
           SIZE 7,00 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-ef-des-cli,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 5,
           VALUE ef-des-cli-BUF,
           .

      * ENTRY FIELD
       05
           ef-marca, 
           Entry-Field, 
           COL 13,00, 
           LINE 17,11,
           LINES 1,33 ,
           SIZE 7,00 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-ef-marca,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 4,
           VALUE ef-marca-BUF,
           .

      * ENTRY FIELD
       05
           ef-art, 
           Entry-Field, 
           COL 13,00, 
           LINE 19,61,
           LINES 1,33 ,
           SIZE 7,00 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-ef-art,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 6,
           VALUE ef-art-BUF,
           .

      * LABEL
       05
           Screen3-La-1a, 
           Label, 
           COL 18,50, 
           LINE 3,42,
           LINES 1,17 ,
           SIZE 7,00 ,
           ID IS 100,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Data",
           .

      * BITMAP
       05
           Bitmap-freccia-fino, 
           Bitmap, 
           COL 26,50, 
           LINE 3,27,
           LINES 24,00 ,
           SIZE 28,00 ,
           TRANSPARENT-COLOR TR-COLOR,
           BITMAP-HANDLE BLUE-FINO-28X24-BMP,
           BITMAP-NUMBER 1,
           ID IS 13,
           .

      * BITMAP
       05
           Bitmap-freccia-da, 
           Bitmap, 
           COL 14,50, 
           LINE 3,27,
           LINES 24,00 ,
           SIZE 28,00 ,
           TRANSPARENT-COLOR TR-COLOR,
           BITMAP-HANDLE BLUE-DA-28X24-BMP,
           BITMAP-NUMBER 1,
           ID IS 14,
           .

      * LABEL
       05
           Screen4-blockpgm-1, 
           Label, 
           COL 20,00, 
           LINE 2,50,
           LINES 0,44 ,
           SIZE 1,60 ,
           ID IS 1,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "BlockPgm",
           VISIBLE v-custom,
           .

      * LABEL
       05
           Screen3-La-1ac, 
           Label, 
           COL 4,50, 
           LINE 6,00,
           LINES 1,33 ,
           SIZE 8,00 ,
           ID IS 5,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Fornitore",
           .

      * LABEL
       05
           Screen4-Custom1-2, 
           Label, 
           COL 4,00, 
           LINE 2,39,
           LINES 0,50 ,
           SIZE 2,20 ,
           ID IS 8,
           TRANSPARENT,
           TITLE "CUSTOM CONTROL",
           VISIBLE v-custom,
           .

      * LABEL
       05
           Screen4-La-3, 
           Label, 
           COL 4,50, 
           LINE 17,11,
           LINES 1,33 ,
           SIZE 8,00 ,
           ID IS 16,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Marca",
           .

      * LABEL
       05
           Screen4-La-4, 
           Label, 
           COL 4,50, 
           LINE 19,61,
           LINES 1,33 ,
           SIZE 8,00 ,
           ID IS 21,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Articolo",
           .

      * DB_LABEL
       05
           lab-forn, 
           Label, 
           COL 20,50, 
           LINE 6,00,
           LINES 2,00 ,
           SIZE 24,00 ,
           COLOR IS 5,
           ID IS 22,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-forn-BUF,
           TRANSPARENT,
           .

      * DB_LABEL
       05
           lab-marca, 
           Label, 
           COL 20,50, 
           LINE 17,11,
           LINES 2,00 ,
           SIZE 24,00 ,
           COLOR IS 5,
           ID IS 23,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-marca-BUF,
           TRANSPARENT,
           .

      * DB_LABEL
       05
           lab-art, 
           Label, 
           COL 20,50, 
           LINE 19,61,
           LINES 2,00 ,
           SIZE 24,00 ,
           COLOR IS 5,
           ID IS 24,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-art-BUF,
           TRANSPARENT,
           .

      * LABEL
       05
           Screen4-La-5, 
           Label, 
           COL 4,50, 
           LINE 8,50,
           LINES 1,33 ,
           SIZE 8,00 ,
           ID IS 26,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Destino",
           VISIBLE 1,
           .

      * DB_LABEL
       05
           lab-des-forn, 
           Label, 
           COL 20,50, 
           LINE 8,50,
           LINES 2,00 ,
           SIZE 24,00 ,
           COLOR IS 5,
           ID IS 27,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-des-forn-BUF,
           TRANSPARENT,
           VISIBLE 1,
           .

      * DB_LABEL
       05
           lab-des-cli, 
           Label, 
           COL 20,50, 
           LINE 14,06,
           LINES 2,00 ,
           SIZE 24,00 ,
           COLOR IS 5,
           ID IS 28,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-des-cli-BUF,
           TRANSPARENT,
           VISIBLE 1,
           .

      * LABEL
       05
           Screen4-La-5a, 
           Label, 
           COL 4,50, 
           LINE 14,06,
           LINES 1,33 ,
           SIZE 8,00 ,
           ID IS 29,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Destino",
           VISIBLE 1,
           .

      * DB_LABEL
       05
           lab-cli, 
           Label, 
           COL 20,50, 
           LINE 11,56,
           LINES 2,00 ,
           SIZE 24,00 ,
           COLOR IS 5,
           ID IS 30,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-cli-BUF,
           TRANSPARENT,
           .

      * LABEL
       05
           Screen3-La-1aca, 
           Label, 
           COL 4,50, 
           LINE 11,56,
           LINES 1,33 ,
           SIZE 8,00 ,
           ID IS 31,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Cliente",
           .

      * BAR
       05
           Screen4-Br-1, 
           Bar,
           COL 3,00, 
           LINE 10,94,
           SIZE 41,50 ,
           ID IS 4,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           WIDTH 1,
           .

      * BAR
       05
           Screen4-Br-1a, 
           Bar,
           COL 3,00, 
           LINE 16,50,
           SIZE 41,50 ,
           ID IS 6,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           WIDTH 1,
           .

      * FRAME
       05
           Screen4-Fr-1, 
           Frame, 
           COL 1,00, 
           LINE 22,82,
           LINES 2,78 ,
           SIZE 45,90 ,
           ID IS 32,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           .

      * PUSH BUTTON
       05
           pb-ok, 
           Push-Button, 
           COL 30,80, 
           LINE 23,43,
           LINES 30,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE BOTTONE-OK-BMP,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 1000,
           FLAT,
           ID IS 200,
           AFTER PROCEDURE pb-ok-AfterProcedure, 
           BEFORE PROCEDURE pb-ok-BeforeProcedure, 
           .

      * PUSH BUTTON
       05
           pb-annulla, 
           Push-Button, 
           COL 38,70, 
           LINE 23,43,
           LINES 30,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE BOTTONE-CANCEL-BMP,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 27,
           FLAT,
           ID IS 201,
           SELF-ACT,
           ESCAPE-BUTTON,
           AFTER PROCEDURE pb-annulla-AfterProcedure, 
           BEFORE PROCEDURE pb-annulla-BeforeProcedure, 
           .

      * TOOLBAR
       01
           Form1-Tb-1a,
           .    

      * PUSH BUTTON
       05
           TOOL-ESCI, 
           Push-Button, 
           COL 1,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           ENABLED E-ESCI,
           EXCEPTION-VALUE 27,
           FLAT,
           ID IS 202,
           SELF-ACT,
           ESCAPE-BUTTON,
           TITLE "&Esci",
           .

      * PUSH BUTTON
       05
           TOOL-CERCA, 
           Push-Button, 
           COL 6,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           BITMAP-NUMBER 8,
           UNFRAMED,
           SQUARE,
           ENABLED E-CERCA,
           EXCEPTION-VALUE 8,
           FLAT,
           ID IS 203,
           SELF-ACT,
           TITLE "Cerca (F8)",
           .

      * FORM
       01 
           form3, 
           AFTER PROCEDURE  form3-AFTER-SCREEN
           BEFORE PROCEDURE  form3-BEFORE-SCREEN
           .

      * LABEL
       05
           form3-La-1, 
           Label, 
           COL 2,00, 
           LINE 1,67,
           LINES 1,00 ,
           SIZE 30,00 ,
           ID IS 2,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Caricamento ordini F in corso...",
           .

      *{TOTEM}END

      *{TOTEM}LINKPARA
       PROCEDURE  DIVISION USING LK-BLOCKPGM, USER-CODI, LIVELLO-ABIL.
      *{TOTEM}END

      *{TOTEM}DECLARATIVE
       DECLARATIVES.
      * <TOTEM:EPT. INIT:vmovordforn, INIT:vmovordforn, BeforeDeclarative>
       LINESEQ-ERR SECTION.
           use after error procedure on lineseq.
           set tutto-ok  to true.
           evaluate status-lineseq
           when "35"
                display message "File [LINESEQ] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [LINESEQ] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[LINESEQ] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           when "93"
                initialize geslock-messaggio
                if stampa-excel
                   string   "Chiudere il file Excel!"
                     x"0d0a""Impossibile procedere!" delimited size
                         into geslock-messaggio
                   end-string
                else
                   string   "File già in uso!"
                     x"0d0a""Impossibile procedere!" delimited size
                         into geslock-messaggio
                   end-string
                end-if
                move 1 to geslock-v-riprova
                move 0 to geslock-v-ignora
                move 1 to geslock-v-termina
                move   "File TXT"   to geslock-nome-file
                call   "geslock" using geslock-linkage
                cancel "geslock"
                evaluate true
                when riprova
                     open output lineseq
                when termina
                     set errori to true
                end-evaluate
           end-evaluate.
 
      ***---
       TORDFORN-ERR SECTION.
           use after error procedure on tordforn.
           set tutto-ok  to true.
           evaluate status-tordforn
           when "35"
                display message "File [TORDFORN] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TORDFORN] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TORDFORN] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       RORDFORN-ERR SECTION.
           use after error procedure on rordforn.
           set tutto-ok  to true.
           evaluate status-rordforn
           when "35"
                display message "File [RORDFORN] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [RORDFORN] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[RORDFORN] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       ARTICOLI-ERR SECTION.
           use after error procedure on articoli.
           set tutto-ok  to true.
           evaluate status-articoli
           when "35"
                display message "File [ARTICOLI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [ARTICOLI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[ARTICOLI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       TMARCHE-ERR SECTION.
           use after error procedure on tmarche.
           set tutto-ok  to true.
           evaluate status-tmarche
           when "35"
                display message "File [TMARCHE] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TMARCHE] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TMARCHE] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       CLIENTI-ERR SECTION.
           use after error procedure on clienti.
           set tutto-ok  to true.
           evaluate status-clienti
           when "35"
                display message "File [CLIENTI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [CLIENTI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[CLIENTI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       tmp-movmagforn-ERR SECTION.
           use after error procedure on tmp-movmagforn.
           set tutto-ok  to true.
           evaluate status-tmp-movmagforn
           when "35"
                display message "File [tmp-movmagforn] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [tmp-movmagforn] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[tmp-movmagforn] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       TPARAMGE-ERR SECTION.
           use after error procedure on tparamge.
           set tutto-ok  to true.
           evaluate status-tparamge
           when "35"
                display message "File [TPARAMGE] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TPARAMGE] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TPARAMGE] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       TCAUMAG-ERR SECTION.
           use after error procedure on tcaumag.
           set tutto-ok  to true.
           evaluate status-tcaumag
           when "35"
                display message "File [TCAUMAG] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TCAUMAG] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TCAUMAG] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       DESTINIF-ERR SECTION.
           use after error procedure on destinif.
           set tutto-ok  to true.
           evaluate status-destinif
           when "35"
                display message "File [DESTINIF] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [DESTINIF] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[DESTINIF] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.

      * <TOTEM:END>
       INPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON INPUT.
       0100-DECL.
           EXIT.
       I-O-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON I-O.
       0200-DECL.
           EXIT.
       OUTPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON OUTPUT.
       0300-DECL.
           EXIT.
       TRANSACTION-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON TRANSACTION.
       0400-DECL.
           EXIT.
       END DECLARATIVES.
      *{TOTEM}END

       MAIN-LOGIC.
      *{TOTEM}ENTRY-BEFPRG
      *    Before-Program
           PERFORM ginqui-Ev-Before-Program
      *{TOTEM}END
           PERFORM INITIALIZE-ROUTINE.
      * run main screen
      *{TOTEM}RUN-MAINSCR
           PERFORM Form1-OPEN-ROUTINE.
      *{TOTEM}END

      *{TOTEM}COPY-PROCEDURE
       EXIT-STOP-ROUTINE.
           PERFORM CLOSE-FILE-RTN
      * <TOTEM:EPT. INIT:vmovordforn, INIT:vmovordforn, BeforeDestroyResource>
      * <TOTEM:END>
           DESTROY Verdana12B-Occidentale
           DESTROY Arial8-Occidentale
           DESTROY Arial8B-Occidentale
           DESTROY Arial10BI-Occidentale
           DESTROY Verdana12-Occidentale
           DESTROY Verdana12BI-Occidentale
           CALL "w$bitmap" USING WBITMAP-DESTROY, BOTTONE-OK-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, BOTTONE-CANCEL-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, EXCEL-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, BLUE-FINO-28X24-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, BLUE-DA-28X24-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, toolbar-bmp
           CALL "w$bitmap" USING WBITMAP-DESTROY, TOOLBAR-BMP
      *    After-Program
           PERFORM ginqui-Ev-After-Program
           EXIT PROGRAM TOTEM-PgmStatus
           STOP RUN.

       INITIALIZE-ROUTINE.
      *    Before Init
      * initialize program status variable
           Initialize TOTEM-PgmStatus.
      * get system information
           ACCEPT SYSTEM-INFORMATION FROM SYSTEM-INFO.
      * get terminal information
           ACCEPT TERMINAL-ABILITIES FROM TERMINAL-INFO.
      * set font
           PERFORM INIT-FONT.
      * load bitmap
           PERFORM INIT-BMP.
      * load resource
           PERFORM INIT-RES.
      * create pop-up menu
           PERFORM INIT-POPUP.
      * open files
           PERFORM OPEN-FILE-RTN.
      *    After Init
           .
    
       INIT-FONT.
      * Verdana12B-Occidentale
           INITIALIZE WFONT-DATA Verdana12B-Occidentale
           MOVE 12 TO WFONT-SIZE
           MOVE "Verdana" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO TRUE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Verdana12B-Occidentale, WFONT-DATA
      * Arial8-Occidentale
           INITIALIZE WFONT-DATA Arial8-Occidentale
           MOVE 8 TO WFONT-SIZE
           MOVE "Arial" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO FALSE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Arial8-Occidentale, WFONT-DATA
      * Arial8B-Occidentale
           INITIALIZE WFONT-DATA Arial8B-Occidentale
           MOVE 8 TO WFONT-SIZE
           MOVE "Arial" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO TRUE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Arial8B-Occidentale, WFONT-DATA
      * Arial10BI-Occidentale
           INITIALIZE WFONT-DATA Arial10BI-Occidentale
           MOVE 10 TO WFONT-SIZE
           MOVE "Arial" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO TRUE
           SET WFONT-ITALIC TO TRUE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Arial10BI-Occidentale, WFONT-DATA
      * Verdana12-Occidentale
           INITIALIZE WFONT-DATA Verdana12-Occidentale
           MOVE 12 TO WFONT-SIZE
           MOVE "Verdana" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO FALSE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Verdana12-Occidentale, WFONT-DATA
      * Verdana12BI-Occidentale
           INITIALIZE WFONT-DATA Verdana12BI-Occidentale
           MOVE 12 TO WFONT-SIZE
           MOVE "Verdana" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO TRUE
           SET WFONT-ITALIC TO TRUE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Verdana12BI-Occidentale, WFONT-DATA
           .

       INIT-BMP.
      * pb-ok2
           COPY RESOURCE "BOTTONE-OK.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "BOTTONE-OK.BMP", 
                   GIVING BOTTONE-OK-BMP.
      * pb-annulla2
           COPY RESOURCE "BOTTONE-CANCEL.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "BOTTONE-CANCEL.BMP", 
                   GIVING BOTTONE-CANCEL-BMP.
      * chk-excel
           COPY RESOURCE "EXCEL.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "EXCEL.BMP", 
                   GIVING EXCEL-BMP.
      * Bitmap-freccia-fino
           COPY RESOURCE "BLUE-FINO-28X24.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "BLUE-FINO-28X24.BMP", 
                   GIVING BLUE-FINO-28X24-BMP.
      * Bitmap-freccia-da
           COPY RESOURCE "BLUE-DA-28X24.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "BLUE-DA-28X24.BMP", 
                   GIVING BLUE-DA-28X24-BMP.
      * TOOL-ESCI
           COPY RESOURCE "toolbar.bmp".
           CALL "w$bitmap" USING WBITMAP-LOAD "toolbar.bmp", 
                   GIVING toolbar-bmp.
      * TOOL-CERCA
           COPY RESOURCE "TOOLBAR.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "TOOLBAR.BMP", 
                   GIVING TOOLBAR-BMP.
           .

       INIT-RES.
           .

       INIT-POPUP.
           .

       OPEN-FILE-RTN.
      *    Before Open
           PERFORM OPEN-articoli
           PERFORM OPEN-tmarche
      *    tmp-movmagforn OPEN MODE IS FALSE
      *    PERFORM OPEN-tmp-movmagforn
           PERFORM OPEN-tparamge
           PERFORM OPEN-tcaumag
      *    lineseq OPEN MODE IS FALSE
      *    PERFORM OPEN-lineseq
           PERFORM OPEN-tordforn
           PERFORM OPEN-rordforn
           PERFORM OPEN-destinif
           PERFORM OPEN-clienti
           PERFORM OPEN-clienti1
           PERFORM OPEN-destini
      *    After Open
           .

       OPEN-articoli.
      * <TOTEM:EPT. INIT:vmovordforn, FD:articoli, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT articoli
           IF NOT Valid-STATUS-articoli
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:vmovordforn, FD:articoli, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tmarche.
      * <TOTEM:EPT. INIT:vmovordforn, FD:tmarche, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tmarche
           IF NOT Valid-STATUS-tmarche
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:vmovordforn, FD:tmarche, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tmp-movmagforn.
      * <TOTEM:EPT. INIT:vmovordforn, FD:tmp-movmagforn, BeforeOpen>
      * <TOTEM:END>
           OPEN  OUTPUT tmp-movmagforn
           IF NOT Valid-STATUS-tmp-movmagforn
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:vmovordforn, FD:tmp-movmagforn, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tparamge.
      * <TOTEM:EPT. INIT:vmovordforn, FD:tparamge, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tparamge
           IF NOT Valid-STATUS-tparamge
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:vmovordforn, FD:tparamge, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tcaumag.
      * <TOTEM:EPT. INIT:vmovordforn, FD:tcaumag, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tcaumag
           IF NOT Valid-STATUS-tcaumag
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:vmovordforn, FD:tcaumag, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-lineseq.
      * <TOTEM:EPT. INIT:vmovordforn, FD:lineseq, BeforeOpen>
      * <TOTEM:END>
           OPEN  OUTPUT lineseq
           IF NOT Valid-STATUS-lineseq
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:vmovordforn, FD:lineseq, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tordforn.
      * <TOTEM:EPT. INIT:vmovordforn, FD:tordforn, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tordforn
           IF NOT Valid-STATUS-tordforn
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:vmovordforn, FD:tordforn, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-rordforn.
      * <TOTEM:EPT. INIT:vmovordforn, FD:rordforn, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT rordforn
           IF NOT Valid-STATUS-rordforn
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:vmovordforn, FD:rordforn, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-destinif.
      * <TOTEM:EPT. INIT:vmovordforn, FD:destinif, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT destinif
           IF NOT Valid-STATUS-destinif
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:vmovordforn, FD:destinif, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-clienti.
      * <TOTEM:EPT. INIT:vmovordforn, FD:clienti, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT clienti
           IF NOT Valid-STATUS-clienti
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:vmovordforn, FD:clienti, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-clienti1.
      * <TOTEM:EPT. INIT:vmovordforn, FD:clienti1, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT clienti1
           IF NOT VALID-STATUS-clienti1
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:vmovordforn, FD:clienti1, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-destini.
      * <TOTEM:EPT. INIT:vmovordforn, FD:destini, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT destini
           IF NOT Valid-STATUS-destini
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:vmovordforn, FD:destini, AfterOpen>
      * <TOTEM:END>
           .

       CLOSE-FILE-RTN.
      *    Before Close
           PERFORM CLOSE-articoli
           PERFORM CLOSE-tmarche
      *    tmp-movmagforn CLOSE MODE IS FALSE
      *    PERFORM CLOSE-tmp-movmagforn
           PERFORM CLOSE-tparamge
           PERFORM CLOSE-tcaumag
      *    lineseq CLOSE MODE IS FALSE
      *    PERFORM CLOSE-lineseq
           PERFORM CLOSE-tordforn
           PERFORM CLOSE-rordforn
           PERFORM CLOSE-destinif
           PERFORM CLOSE-clienti
           PERFORM CLOSE-clienti1
           PERFORM CLOSE-destini
      *    After Close
           .

       CLOSE-articoli.
      * <TOTEM:EPT. INIT:vmovordforn, FD:articoli, BeforeClose>
      * <TOTEM:END>
           CLOSE articoli
           .

       CLOSE-tmarche.
      * <TOTEM:EPT. INIT:vmovordforn, FD:tmarche, BeforeClose>
      * <TOTEM:END>
           CLOSE tmarche
           .

       CLOSE-tmp-movmagforn.
      * <TOTEM:EPT. INIT:vmovordforn, FD:tmp-movmagforn, BeforeClose>
      * <TOTEM:END>
           .

       CLOSE-tparamge.
      * <TOTEM:EPT. INIT:vmovordforn, FD:tparamge, BeforeClose>
      * <TOTEM:END>
           CLOSE tparamge
           .

       CLOSE-tcaumag.
      * <TOTEM:EPT. INIT:vmovordforn, FD:tcaumag, BeforeClose>
      * <TOTEM:END>
           CLOSE tcaumag
           .

       CLOSE-lineseq.
      * <TOTEM:EPT. INIT:vmovordforn, FD:lineseq, BeforeClose>
      * <TOTEM:END>
           .

       CLOSE-tordforn.
      * <TOTEM:EPT. INIT:vmovordforn, FD:tordforn, BeforeClose>
      * <TOTEM:END>
           CLOSE tordforn
           .

       CLOSE-rordforn.
      * <TOTEM:EPT. INIT:vmovordforn, FD:rordforn, BeforeClose>
      * <TOTEM:END>
           CLOSE rordforn
           .

       CLOSE-destinif.
      * <TOTEM:EPT. INIT:vmovordforn, FD:destinif, BeforeClose>
      * <TOTEM:END>
           CLOSE destinif
           .

       CLOSE-clienti.
      * <TOTEM:EPT. INIT:vmovordforn, FD:clienti, BeforeClose>
      * <TOTEM:END>
           CLOSE clienti
           .

       CLOSE-clienti1.
      * <TOTEM:EPT. INIT:vmovordforn, FD:clienti1, BeforeClose>
      * <TOTEM:END>
           CLOSE clienti1
           .

       CLOSE-destini.
      * <TOTEM:EPT. INIT:vmovordforn, FD:destini, BeforeClose>
      * <TOTEM:END>
           CLOSE destini
           .

       articoli-art-k1-MERGE-SPLITBUF.
           INITIALIZE articoli-art-k1-SPLITBUF
           MOVE art-descrizione OF articoli(1:50) TO 
           articoli-art-k1-SPLITBUF(1:50)
           .

       articoli-art-k-frn-MERGE-SPLITBUF.
           INITIALIZE articoli-art-k-frn-SPLITBUF
           MOVE art-cod-art-frn OF articoli(1:15) TO 
           articoli-art-k-frn-SPLITBUF(1:15)
           .

       DataSet1-articoli-INITSTART.
           IF DataSet1-articoli-KEY-Asc
              MOVE Low-Value TO art-chiave OF articoli
           ELSE
              MOVE High-Value TO art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-INITEND.
           IF DataSet1-articoli-KEY-Asc
              MOVE High-Value TO art-chiave OF articoli
           ELSE
              MOVE Low-Value TO art-chiave OF articoli
           END-IF
           .

      * articoli
       DataSet1-articoli-START.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY >= art-chiave OF articoli
           ELSE
              START articoli KEY <= art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-START-NOTGREATER.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY <= art-chiave OF articoli
           ELSE
              START articoli KEY >= art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-START-GREATER.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY > art-chiave OF articoli
           ELSE
              START articoli KEY < art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-START-LESS.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY < art-chiave OF articoli
           ELSE
              START articoli KEY > art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-articoli-LOCK
              READ articoli WITH LOCK 
              KEY art-chiave OF articoli
           ELSE
              READ articoli WITH NO LOCK 
              KEY art-chiave OF articoli
           END-IF
           PERFORM articoli-art-k1-MERGE-SPLITBUF
           PERFORM articoli-art-k-frn-MERGE-SPLITBUF
           MOVE STATUS-articoli TO TOTEM-ERR-STAT 
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-articoli-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-articoli-KEY-Asc
              IF DataSet1-articoli-LOCK
                 READ articoli NEXT WITH LOCK
              ELSE
                 READ articoli NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-articoli-LOCK
                 READ articoli PREVIOUS WITH LOCK
              ELSE
                 READ articoli PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM articoli-art-k1-MERGE-SPLITBUF
           PERFORM articoli-art-k-frn-MERGE-SPLITBUF
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-articoli-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-articoli-KEY-Asc
              IF DataSet1-articoli-LOCK
                 READ articoli PREVIOUS WITH LOCK
              ELSE
                 READ articoli PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-articoli-LOCK
                 READ articoli NEXT WITH LOCK
              ELSE
                 READ articoli NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM articoli-art-k1-MERGE-SPLITBUF
           PERFORM articoli-art-k-frn-MERGE-SPLITBUF
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-articoli-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-articoli-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-articoli-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tmarche-INITSTART.
           IF DataSet1-tmarche-KEY-Asc
              MOVE Low-Value TO mar-chiave
           ELSE
              MOVE High-Value TO mar-chiave
           END-IF
           .

       DataSet1-tmarche-INITEND.
           IF DataSet1-tmarche-KEY-Asc
              MOVE High-Value TO mar-chiave
           ELSE
              MOVE Low-Value TO mar-chiave
           END-IF
           .

      * tmarche
       DataSet1-tmarche-START.
           IF DataSet1-tmarche-KEY-Asc
              START tmarche KEY >= mar-chiave
           ELSE
              START tmarche KEY <= mar-chiave
           END-IF
           .

       DataSet1-tmarche-START-NOTGREATER.
           IF DataSet1-tmarche-KEY-Asc
              START tmarche KEY <= mar-chiave
           ELSE
              START tmarche KEY >= mar-chiave
           END-IF
           .

       DataSet1-tmarche-START-GREATER.
           IF DataSet1-tmarche-KEY-Asc
              START tmarche KEY > mar-chiave
           ELSE
              START tmarche KEY < mar-chiave
           END-IF
           .

       DataSet1-tmarche-START-LESS.
           IF DataSet1-tmarche-KEY-Asc
              START tmarche KEY < mar-chiave
           ELSE
              START tmarche KEY > mar-chiave
           END-IF
           .

       DataSet1-tmarche-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tmarche-LOCK
              READ tmarche WITH LOCK 
              KEY mar-chiave
           ELSE
              READ tmarche WITH NO LOCK 
              KEY mar-chiave
           END-IF
           MOVE STATUS-tmarche TO TOTEM-ERR-STAT 
           MOVE "tmarche" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tmarche-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tmarche-KEY-Asc
              IF DataSet1-tmarche-LOCK
                 READ tmarche NEXT WITH LOCK
              ELSE
                 READ tmarche NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tmarche-LOCK
                 READ tmarche PREVIOUS WITH LOCK
              ELSE
                 READ tmarche PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tmarche TO TOTEM-ERR-STAT
           MOVE "tmarche" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tmarche-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tmarche-KEY-Asc
              IF DataSet1-tmarche-LOCK
                 READ tmarche PREVIOUS WITH LOCK
              ELSE
                 READ tmarche PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tmarche-LOCK
                 READ tmarche NEXT WITH LOCK
              ELSE
                 READ tmarche NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tmarche TO TOTEM-ERR-STAT
           MOVE "tmarche" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tmarche-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tmarche TO TOTEM-ERR-STAT
           MOVE "tmarche" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tmarche-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tmarche TO TOTEM-ERR-STAT
           MOVE "tmarche" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tmarche-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tmarche TO TOTEM-ERR-STAT
           MOVE "tmarche" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterDelete>
      * <TOTEM:END>
           .

       tmp-movmagforn-tmp-movf-k1-MERGE-SPLITBUF.
           INITIALIZE tmp-movmagforn-tmp-movf-k1-SPLITBUF
           MOVE tmp-movf-codice(1:5) TO 
           tmp-movmagforn-tmp-movf-k1-SPLITBUF(1:5)
           MOVE tmp-movf-articolo(1:6) TO 
           tmp-movmagforn-tmp-movf-k1-SPLITBUF(6:6)
           MOVE tmp-movf-data-movim(1:8) TO 
           tmp-movmagforn-tmp-movf-k1-SPLITBUF(12:8)
           .

       DataSet1-tmp-movmagforn-INITSTART.
           IF DataSet1-tmp-movmagforn-KEY-Asc
              MOVE Low-Value TO tmp-movf-chiave
           ELSE
              MOVE High-Value TO tmp-movf-chiave
           END-IF
           .

       DataSet1-tmp-movmagforn-INITEND.
           IF DataSet1-tmp-movmagforn-KEY-Asc
              MOVE High-Value TO tmp-movf-chiave
           ELSE
              MOVE Low-Value TO tmp-movf-chiave
           END-IF
           .

      * tmp-movmagforn
       DataSet1-tmp-movmagforn-START.
           IF DataSet1-tmp-movmagforn-KEY-Asc
              START tmp-movmagforn KEY >= tmp-movf-chiave
           ELSE
              START tmp-movmagforn KEY <= tmp-movf-chiave
           END-IF
           .

       DataSet1-tmp-movmagforn-START-NOTGREATER.
           IF DataSet1-tmp-movmagforn-KEY-Asc
              START tmp-movmagforn KEY <= tmp-movf-chiave
           ELSE
              START tmp-movmagforn KEY >= tmp-movf-chiave
           END-IF
           .

       DataSet1-tmp-movmagforn-START-GREATER.
           IF DataSet1-tmp-movmagforn-KEY-Asc
              START tmp-movmagforn KEY > tmp-movf-chiave
           ELSE
              START tmp-movmagforn KEY < tmp-movf-chiave
           END-IF
           .

       DataSet1-tmp-movmagforn-START-LESS.
           IF DataSet1-tmp-movmagforn-KEY-Asc
              START tmp-movmagforn KEY < tmp-movf-chiave
           ELSE
              START tmp-movmagforn KEY > tmp-movf-chiave
           END-IF
           .

       DataSet1-tmp-movmagforn-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-movmagforn, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-movmagforn, BeforeReadRecord>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-movmagforn, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-movmagforn, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tmp-movmagforn-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-movmagforn, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-movmagforn, BeforeReadNext>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-movmagforn, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-movmagforn, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tmp-movmagforn-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-movmagforn, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-movmagforn, BeforeReadPrev>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-movmagforn, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-movmagforn, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tmp-movmagforn-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-movmagforn, BeforeWrite>
      * <TOTEM:END>
           WRITE tmp-movf-rec OF tmp-movmagforn.
           MOVE STATUS-tmp-movmagforn TO TOTEM-ERR-STAT
           MOVE "tmp-movmagforn" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-movmagforn, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tmp-movmagforn-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-movmagforn, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tmp-movmagforn TO TOTEM-ERR-STAT
           MOVE "tmp-movmagforn" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-movmagforn, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tmp-movmagforn-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-movmagforn, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tmp-movmagforn TO TOTEM-ERR-STAT
           MOVE "tmp-movmagforn" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-movmagforn, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tparamge-INITSTART.
           IF DataSet1-tparamge-KEY-Asc
              MOVE Low-Value TO tge-chiave
           ELSE
              MOVE High-Value TO tge-chiave
           END-IF
           .

       DataSet1-tparamge-INITEND.
           IF DataSet1-tparamge-KEY-Asc
              MOVE High-Value TO tge-chiave
           ELSE
              MOVE Low-Value TO tge-chiave
           END-IF
           .

      * tparamge
       DataSet1-tparamge-START.
           IF DataSet1-tparamge-KEY-Asc
              START tparamge KEY >= tge-chiave
           ELSE
              START tparamge KEY <= tge-chiave
           END-IF
           .

       DataSet1-tparamge-START-NOTGREATER.
           IF DataSet1-tparamge-KEY-Asc
              START tparamge KEY <= tge-chiave
           ELSE
              START tparamge KEY >= tge-chiave
           END-IF
           .

       DataSet1-tparamge-START-GREATER.
           IF DataSet1-tparamge-KEY-Asc
              START tparamge KEY > tge-chiave
           ELSE
              START tparamge KEY < tge-chiave
           END-IF
           .

       DataSet1-tparamge-START-LESS.
           IF DataSet1-tparamge-KEY-Asc
              START tparamge KEY < tge-chiave
           ELSE
              START tparamge KEY > tge-chiave
           END-IF
           .

       DataSet1-tparamge-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tparamge-LOCK
              READ tparamge WITH LOCK 
              KEY tge-chiave
           ELSE
              READ tparamge WITH NO LOCK 
              KEY tge-chiave
           END-IF
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT 
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tparamge-KEY-Asc
              IF DataSet1-tparamge-LOCK
                 READ tparamge NEXT WITH LOCK
              ELSE
                 READ tparamge NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tparamge-LOCK
                 READ tparamge PREVIOUS WITH LOCK
              ELSE
                 READ tparamge PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tparamge-KEY-Asc
              IF DataSet1-tparamge-LOCK
                 READ tparamge PREVIOUS WITH LOCK
              ELSE
                 READ tparamge PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tparamge-LOCK
                 READ tparamge NEXT WITH LOCK
              ELSE
                 READ tparamge NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterDelete>
      * <TOTEM:END>
           .

       tcaumag-k-mag-MERGE-SPLITBUF.
           INITIALIZE tcaumag-k-mag-SPLITBUF
           MOVE tca-cod-magaz(1:3) TO tcaumag-k-mag-SPLITBUF(1:3)
           MOVE tca-ord-forn(1:1) TO tcaumag-k-mag-SPLITBUF(4:1)
           .

       DataSet1-tcaumag-INITSTART.
           IF DataSet1-tcaumag-KEY-Asc
              MOVE Low-Value TO tca-chiave
           ELSE
              MOVE High-Value TO tca-chiave
           END-IF
           .

       DataSet1-tcaumag-INITEND.
           IF DataSet1-tcaumag-KEY-Asc
              MOVE High-Value TO tca-chiave
           ELSE
              MOVE Low-Value TO tca-chiave
           END-IF
           .

      * tcaumag
       DataSet1-tcaumag-START.
           IF DataSet1-tcaumag-KEY-Asc
              START tcaumag KEY >= tca-chiave
           ELSE
              START tcaumag KEY <= tca-chiave
           END-IF
           .

       DataSet1-tcaumag-START-NOTGREATER.
           IF DataSet1-tcaumag-KEY-Asc
              START tcaumag KEY <= tca-chiave
           ELSE
              START tcaumag KEY >= tca-chiave
           END-IF
           .

       DataSet1-tcaumag-START-GREATER.
           IF DataSet1-tcaumag-KEY-Asc
              START tcaumag KEY > tca-chiave
           ELSE
              START tcaumag KEY < tca-chiave
           END-IF
           .

       DataSet1-tcaumag-START-LESS.
           IF DataSet1-tcaumag-KEY-Asc
              START tcaumag KEY < tca-chiave
           ELSE
              START tcaumag KEY > tca-chiave
           END-IF
           .

       DataSet1-tcaumag-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tcaumag-LOCK
              READ tcaumag WITH LOCK 
              KEY tca-chiave
           ELSE
              READ tcaumag WITH NO LOCK 
              KEY tca-chiave
           END-IF
           PERFORM tcaumag-k-mag-MERGE-SPLITBUF
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT 
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tcaumag-KEY-Asc
              IF DataSet1-tcaumag-LOCK
                 READ tcaumag NEXT WITH LOCK
              ELSE
                 READ tcaumag NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tcaumag-LOCK
                 READ tcaumag PREVIOUS WITH LOCK
              ELSE
                 READ tcaumag PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tcaumag-k-mag-MERGE-SPLITBUF
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tcaumag-KEY-Asc
              IF DataSet1-tcaumag-LOCK
                 READ tcaumag PREVIOUS WITH LOCK
              ELSE
                 READ tcaumag PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tcaumag-LOCK
                 READ tcaumag NEXT WITH LOCK
              ELSE
                 READ tcaumag NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tcaumag-k-mag-MERGE-SPLITBUF
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-lineseq-INITSTART.
           .

       DataSet1-lineseq-INITEND.
           .

       DataSet1-lineseq-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeReadRecord>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-lineseq-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeReadNext>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-lineseq-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeReadPrev>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-lineseq-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeWrite>
      * <TOTEM:END>
           WRITE line-riga OF lineseq.
           MOVE STATUS-lineseq TO TOTEM-ERR-STAT
           MOVE "lineseq" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-lineseq-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-lineseq TO TOTEM-ERR-STAT
           MOVE "lineseq" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-lineseq-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-lineseq TO TOTEM-ERR-STAT
           MOVE "lineseq" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterDelete>
      * <TOTEM:END>
           .

       tordforn-tof-k-causale-MERGE-SPLITBUF.
           INITIALIZE tordforn-tof-k-causale-SPLITBUF
           MOVE tof-causale(1:4) TO tordforn-tof-k-causale-SPLITBUF(1:4)
           MOVE tof-chiave(1:12) TO 
           tordforn-tof-k-causale-SPLITBUF(5:12)
           .

       tordforn-tof-k-stato-MERGE-SPLITBUF.
           INITIALIZE tordforn-tof-k-stato-SPLITBUF
           MOVE tof-stato(1:1) TO tordforn-tof-k-stato-SPLITBUF(1:1)
           MOVE tof-chiave(1:12) TO tordforn-tof-k-stato-SPLITBUF(2:12)
           .

       tordforn-k-fornitore-MERGE-SPLITBUF.
           INITIALIZE tordforn-k-fornitore-SPLITBUF
           MOVE tof-cod-forn(1:5) TO tordforn-k-fornitore-SPLITBUF(1:5)
           MOVE tof-destino(1:5) TO tordforn-k-fornitore-SPLITBUF(6:5)
           MOVE tof-stato(1:1) TO tordforn-k-fornitore-SPLITBUF(11:1)
           MOVE tof-chiave(1:12) TO tordforn-k-fornitore-SPLITBUF(12:12)
           .

       tordforn-tof-k-data-MERGE-SPLITBUF.
           INITIALIZE tordforn-tof-k-data-SPLITBUF
           MOVE tof-data-ordine OF tordforn(1:8) TO 
           tordforn-tof-k-data-SPLITBUF(1:8)
           MOVE tof-chiave OF tordforn(1:12) TO 
           tordforn-tof-k-data-SPLITBUF(9:12)
           .

       DataSet1-tordforn-INITSTART.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tordforn-KEY1-Asc
                 MOVE Low-Value TO tof-chiave
              ELSE
                 MOVE High-Value TO tof-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tordforn-INITEND.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tordforn-KEY1-Asc
                 MOVE High-Value TO tof-chiave
              ELSE
                 MOVE Low-Value TO tof-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           .   

       DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-tordforn-KEY1-ORDER
           END-EVALUATE
           .

       DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-tordforn-KEY1-ORDER
           END-EVALUATE
           .

      * tordforn
       DataSet1-tordforn-START.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tordforn-KEY1-Asc
                 START tordforn KEY >= tof-chiave
              ELSE
                 START tordforn KEY <= tof-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tordforn-START-NOTGREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tordforn-KEY1-Asc
                 START tordforn KEY <= tof-chiave
              ELSE
                 START tordforn KEY >= tof-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tordforn-START-GREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tordforn-KEY1-Asc
                 START tordforn KEY > tof-chiave
              ELSE
                 START tordforn KEY < tof-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tordforn-START-LESS.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tordforn-KEY1-Asc
                 START tordforn KEY < tof-chiave
              ELSE
                 START tordforn KEY > tof-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tordforn-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, BeforeReadRecord>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tordforn-LOCK
                 READ tordforn WITH LOCK 
                 KEY tof-chiave
              ELSE
                 READ tordforn WITH NO LOCK 
                 KEY tof-chiave
              END-IF
           END-EVALUATE
           PERFORM tordforn-tof-k-causale-MERGE-SPLITBUF
           PERFORM tordforn-tof-k-stato-MERGE-SPLITBUF
           PERFORM tordforn-k-fornitore-MERGE-SPLITBUF
           PERFORM tordforn-tof-k-data-MERGE-SPLITBUF
           MOVE STATUS-tordforn TO TOTEM-ERR-STAT 
           MOVE "tordforn" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tordforn-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, BeforeReadNext>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tordforn-KEY1-Asc
                 IF DataSet1-tordforn-LOCK
                    READ tordforn NEXT WITH LOCK
                 ELSE
                    READ tordforn NEXT WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-tordforn-LOCK
                    READ tordforn PREVIOUS WITH LOCK
                 ELSE
                    READ tordforn PREVIOUS WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           PERFORM tordforn-tof-k-causale-MERGE-SPLITBUF
           PERFORM tordforn-tof-k-stato-MERGE-SPLITBUF
           PERFORM tordforn-k-fornitore-MERGE-SPLITBUF
           PERFORM tordforn-tof-k-data-MERGE-SPLITBUF
           MOVE STATUS-tordforn TO TOTEM-ERR-STAT
           MOVE "tordforn" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tordforn-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, BeforeReadPrev>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tordforn-KEY1-Asc
                 IF DataSet1-tordforn-LOCK
                    READ tordforn PREVIOUS WITH LOCK
                 ELSE
                    READ tordforn PREVIOUS WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-tordforn-LOCK
                    READ tordforn NEXT WITH LOCK
                 ELSE
                    READ tordforn NEXT WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           PERFORM tordforn-tof-k-causale-MERGE-SPLITBUF
           PERFORM tordforn-tof-k-stato-MERGE-SPLITBUF
           PERFORM tordforn-k-fornitore-MERGE-SPLITBUF
           PERFORM tordforn-tof-k-data-MERGE-SPLITBUF
           MOVE STATUS-tordforn TO TOTEM-ERR-STAT
           MOVE "tordforn" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tordforn-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tordforn TO TOTEM-ERR-STAT
           MOVE "tordforn" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tordforn-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tordforn TO TOTEM-ERR-STAT
           MOVE "tordforn" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tordforn-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tordforn TO TOTEM-ERR-STAT
           MOVE "tordforn" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, AfterDelete>
      * <TOTEM:END>
           .

       rordforn-rof-k-articolo-MERGE-SPLITBUF.
           INITIALIZE rordforn-rof-k-articolo-SPLITBUF
           MOVE rof-cod-articolo OF rordforn(1:6) TO 
           rordforn-rof-k-articolo-SPLITBUF(1:6)
           MOVE rof-chiave OF rordforn(1:17) TO 
           rordforn-rof-k-articolo-SPLITBUF(7:17)
           .

       rordforn-rof-k-art-mag-MERGE-SPLITBUF.
           INITIALIZE rordforn-rof-k-art-mag-SPLITBUF
           MOVE rof-cod-articolo OF rordforn(1:6) TO 
           rordforn-rof-k-art-mag-SPLITBUF(1:6)
           MOVE rof-cod-magazzino OF rordforn(1:3) TO 
           rordforn-rof-k-art-mag-SPLITBUF(7:3)
           MOVE rof-chiave OF rordforn(1:17) TO 
           rordforn-rof-k-art-mag-SPLITBUF(10:17)
           .

       DataSet1-rordforn-INITSTART.
           IF DataSet1-rordforn-KEY-Asc
              MOVE Low-Value TO rof-chiave OF rordforn
           ELSE
              MOVE High-Value TO rof-chiave OF rordforn
           END-IF
           .

       DataSet1-rordforn-INITEND.
           IF DataSet1-rordforn-KEY-Asc
              MOVE High-Value TO rof-chiave OF rordforn
           ELSE
              MOVE Low-Value TO rof-chiave OF rordforn
           END-IF
           .

      * rordforn
       DataSet1-rordforn-START.
           IF DataSet1-rordforn-KEY-Asc
              START rordforn KEY >= rof-chiave OF rordforn
           ELSE
              START rordforn KEY <= rof-chiave OF rordforn
           END-IF
           .

       DataSet1-rordforn-START-NOTGREATER.
           IF DataSet1-rordforn-KEY-Asc
              START rordforn KEY <= rof-chiave OF rordforn
           ELSE
              START rordforn KEY >= rof-chiave OF rordforn
           END-IF
           .

       DataSet1-rordforn-START-GREATER.
           IF DataSet1-rordforn-KEY-Asc
              START rordforn KEY > rof-chiave OF rordforn
           ELSE
              START rordforn KEY < rof-chiave OF rordforn
           END-IF
           .

       DataSet1-rordforn-START-LESS.
           IF DataSet1-rordforn-KEY-Asc
              START rordforn KEY < rof-chiave OF rordforn
           ELSE
              START rordforn KEY > rof-chiave OF rordforn
           END-IF
           .

       DataSet1-rordforn-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-rordforn-LOCK
              READ rordforn WITH LOCK 
              KEY rof-chiave OF rordforn
           ELSE
              READ rordforn WITH NO LOCK 
              KEY rof-chiave OF rordforn
           END-IF
           PERFORM rordforn-rof-k-articolo-MERGE-SPLITBUF
           PERFORM rordforn-rof-k-art-mag-MERGE-SPLITBUF
           MOVE STATUS-rordforn TO TOTEM-ERR-STAT 
           MOVE "rordforn" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-rordforn-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-rordforn-KEY-Asc
              IF DataSet1-rordforn-LOCK
                 READ rordforn NEXT WITH LOCK
              ELSE
                 READ rordforn NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-rordforn-LOCK
                 READ rordforn PREVIOUS WITH LOCK
              ELSE
                 READ rordforn PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM rordforn-rof-k-articolo-MERGE-SPLITBUF
           PERFORM rordforn-rof-k-art-mag-MERGE-SPLITBUF
           MOVE STATUS-rordforn TO TOTEM-ERR-STAT
           MOVE "rordforn" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-rordforn-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-rordforn-KEY-Asc
              IF DataSet1-rordforn-LOCK
                 READ rordforn PREVIOUS WITH LOCK
              ELSE
                 READ rordforn PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-rordforn-LOCK
                 READ rordforn NEXT WITH LOCK
              ELSE
                 READ rordforn NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM rordforn-rof-k-articolo-MERGE-SPLITBUF
           PERFORM rordforn-rof-k-art-mag-MERGE-SPLITBUF
           MOVE STATUS-rordforn TO TOTEM-ERR-STAT
           MOVE "rordforn" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-rordforn-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-rordforn TO TOTEM-ERR-STAT
           MOVE "rordforn" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-rordforn-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-rordforn TO TOTEM-ERR-STAT
           MOVE "rordforn" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-rordforn-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-rordforn TO TOTEM-ERR-STAT
           MOVE "rordforn" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, AfterDelete>
      * <TOTEM:END>
           .

       destinif-K1-MERGE-SPLITBUF.
           INITIALIZE destinif-K1-SPLITBUF
           MOVE desf-ragsoc-1(1:40) TO destinif-K1-SPLITBUF(1:40)
           MOVE desf-codice(1:5) TO destinif-K1-SPLITBUF(41:5)
           MOVE desf-prog(1:5) TO destinif-K1-SPLITBUF(46:5)
           .

       destinif-desf-k2-MERGE-SPLITBUF.
           INITIALIZE destinif-desf-k2-SPLITBUF
           MOVE desf-codice(1:5) TO destinif-desf-k2-SPLITBUF(1:5)
           MOVE desf-ragsoc-1(1:40) TO destinif-desf-k2-SPLITBUF(6:40)
           MOVE desf-prog(1:5) TO destinif-desf-k2-SPLITBUF(46:5)
           .

       DataSet1-destinif-INITSTART.
           IF DataSet1-destinif-KEY-Asc
              MOVE Low-Value TO desf-chiave
           ELSE
              MOVE High-Value TO desf-chiave
           END-IF
           .

       DataSet1-destinif-INITEND.
           IF DataSet1-destinif-KEY-Asc
              MOVE High-Value TO desf-chiave
           ELSE
              MOVE Low-Value TO desf-chiave
           END-IF
           .

      * destinif
       DataSet1-destinif-START.
           IF DataSet1-destinif-KEY-Asc
              START destinif KEY >= desf-chiave
           ELSE
              START destinif KEY <= desf-chiave
           END-IF
           .

       DataSet1-destinif-START-NOTGREATER.
           IF DataSet1-destinif-KEY-Asc
              START destinif KEY <= desf-chiave
           ELSE
              START destinif KEY >= desf-chiave
           END-IF
           .

       DataSet1-destinif-START-GREATER.
           IF DataSet1-destinif-KEY-Asc
              START destinif KEY > desf-chiave
           ELSE
              START destinif KEY < desf-chiave
           END-IF
           .

       DataSet1-destinif-START-LESS.
           IF DataSet1-destinif-KEY-Asc
              START destinif KEY < desf-chiave
           ELSE
              START destinif KEY > desf-chiave
           END-IF
           .

       DataSet1-destinif-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:destinif, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destinif, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-destinif-LOCK
              READ destinif WITH LOCK 
              KEY desf-chiave
           ELSE
              READ destinif WITH NO LOCK 
              KEY desf-chiave
           END-IF
           PERFORM destinif-K1-MERGE-SPLITBUF
           PERFORM destinif-desf-k2-MERGE-SPLITBUF
           MOVE STATUS-destinif TO TOTEM-ERR-STAT 
           MOVE "destinif" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destinif, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destinif, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-destinif-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:destinif, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destinif, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-destinif-KEY-Asc
              IF DataSet1-destinif-LOCK
                 READ destinif NEXT WITH LOCK
              ELSE
                 READ destinif NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-destinif-LOCK
                 READ destinif PREVIOUS WITH LOCK
              ELSE
                 READ destinif PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM destinif-K1-MERGE-SPLITBUF
           PERFORM destinif-desf-k2-MERGE-SPLITBUF
           MOVE STATUS-destinif TO TOTEM-ERR-STAT
           MOVE "destinif" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destinif, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destinif, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-destinif-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:destinif, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destinif, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-destinif-KEY-Asc
              IF DataSet1-destinif-LOCK
                 READ destinif PREVIOUS WITH LOCK
              ELSE
                 READ destinif PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-destinif-LOCK
                 READ destinif NEXT WITH LOCK
              ELSE
                 READ destinif NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM destinif-K1-MERGE-SPLITBUF
           PERFORM destinif-desf-k2-MERGE-SPLITBUF
           MOVE STATUS-destinif TO TOTEM-ERR-STAT
           MOVE "destinif" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destinif, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destinif, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-destinif-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:destinif, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-destinif TO TOTEM-ERR-STAT
           MOVE "destinif" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destinif, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-destinif-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:destinif, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-destinif TO TOTEM-ERR-STAT
           MOVE "destinif" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destinif, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-destinif-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:destinif, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-destinif TO TOTEM-ERR-STAT
           MOVE "destinif" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destinif, AfterDelete>
      * <TOTEM:END>
           .

       clienti-cli-K1-MERGE-SPLITBUF.
           INITIALIZE clienti-cli-K1-SPLITBUF
           MOVE cli-tipo-CF OF clienti(1:1) TO 
           clienti-cli-K1-SPLITBUF(1:1)
           MOVE cli-ragsoc-1 OF clienti(1:40) TO 
           clienti-cli-K1-SPLITBUF(2:40)
           MOVE cli-codice OF clienti(1:5) TO 
           clienti-cli-K1-SPLITBUF(42:5)
           .

       clienti-cli-K3-MERGE-SPLITBUF.
           INITIALIZE clienti-cli-K3-SPLITBUF
           MOVE cli-gdo OF clienti(1:5) TO clienti-cli-K3-SPLITBUF(1:5)
           MOVE cli-chiave OF clienti(1:6) TO 
           clienti-cli-K3-SPLITBUF(6:6)
           .

       clienti-cli-K4-MERGE-SPLITBUF.
           INITIALIZE clienti-cli-K4-SPLITBUF
           MOVE cli-utf OF clienti(1:1) TO clienti-cli-K4-SPLITBUF(1:1)
           MOVE cli-chiave OF clienti(1:6) TO 
           clienti-cli-K4-SPLITBUF(2:6)
           .

       DataSet1-clienti-INITSTART.
           IF DataSet1-clienti-KEY-Asc
              MOVE Low-Value TO cli-chiave OF clienti
           ELSE
              MOVE High-Value TO cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-INITEND.
           IF DataSet1-clienti-KEY-Asc
              MOVE High-Value TO cli-chiave OF clienti
           ELSE
              MOVE Low-Value TO cli-chiave OF clienti
           END-IF
           .

      * clienti
       DataSet1-clienti-START.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY >= cli-chiave OF clienti
           ELSE
              START clienti KEY <= cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-START-NOTGREATER.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY <= cli-chiave OF clienti
           ELSE
              START clienti KEY >= cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-START-GREATER.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY > cli-chiave OF clienti
           ELSE
              START clienti KEY < cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-START-LESS.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY < cli-chiave OF clienti
           ELSE
              START clienti KEY > cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-clienti-LOCK
              READ clienti WITH LOCK 
              KEY cli-chiave OF clienti
           ELSE
              READ clienti WITH NO LOCK 
              KEY cli-chiave OF clienti
           END-IF
           PERFORM clienti-cli-K1-MERGE-SPLITBUF
           PERFORM clienti-cli-K3-MERGE-SPLITBUF
           PERFORM clienti-cli-K4-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT 
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-clienti-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-clienti-KEY-Asc
              IF DataSet1-clienti-LOCK
                 READ clienti NEXT WITH LOCK
              ELSE
                 READ clienti NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-clienti-LOCK
                 READ clienti PREVIOUS WITH LOCK
              ELSE
                 READ clienti PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM clienti-cli-K1-MERGE-SPLITBUF
           PERFORM clienti-cli-K3-MERGE-SPLITBUF
           PERFORM clienti-cli-K4-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-clienti-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-clienti-KEY-Asc
              IF DataSet1-clienti-LOCK
                 READ clienti PREVIOUS WITH LOCK
              ELSE
                 READ clienti PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-clienti-LOCK
                 READ clienti NEXT WITH LOCK
              ELSE
                 READ clienti NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM clienti-cli-K1-MERGE-SPLITBUF
           PERFORM clienti-cli-K3-MERGE-SPLITBUF
           PERFORM clienti-cli-K4-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterDelete>
      * <TOTEM:END>
           .

       clienti1-cli-K1-MERGE-SPLITBUF.
           INITIALIZE clienti1-cli-K1-SPLITBUF
           MOVE cli-tipo-CF OF clienti(1:1) TO 
           clienti1-cli-K1-SPLITBUF(1:1)
           MOVE cli-ragsoc-1 OF clienti(1:40) TO 
           clienti1-cli-K1-SPLITBUF(2:40)
           MOVE cli-codice OF clienti(1:5) TO 
           clienti1-cli-K1-SPLITBUF(42:5)
           .

       clienti1-cli-K3-MERGE-SPLITBUF.
           INITIALIZE clienti1-cli-K3-SPLITBUF
           MOVE cli-gdo OF clienti(1:5) TO clienti1-cli-K3-SPLITBUF(1:5)
           MOVE cli-chiave OF clienti(1:6) TO 
           clienti1-cli-K3-SPLITBUF(6:6)
           .

       clienti1-cli-K4-MERGE-SPLITBUF.
           INITIALIZE clienti1-cli-K4-SPLITBUF
           MOVE cli-utf OF clienti(1:1) TO clienti1-cli-K4-SPLITBUF(1:1)
           MOVE cli-chiave OF clienti(1:6) TO 
           clienti1-cli-K4-SPLITBUF(2:6)
           .

       DataSet1-clienti1-INITSTART.
           IF DataSet1-clienti1-KEY-Asc
              MOVE Low-Value TO cli-chiave OF clienti1
           ELSE
              MOVE High-Value TO cli-chiave OF clienti1
           END-IF
           .

       DataSet1-clienti1-INITEND.
           IF DataSet1-clienti1-KEY-Asc
              MOVE High-Value TO cli-chiave OF clienti1
           ELSE
              MOVE Low-Value TO cli-chiave OF clienti1
           END-IF
           .

      * clienti1
       DataSet1-clienti1-START.
           IF DataSet1-clienti1-KEY-Asc
              START clienti1 KEY >= cli-chiave OF clienti1
           ELSE
              START clienti1 KEY <= cli-chiave OF clienti1
           END-IF
           .

       DataSet1-clienti1-START-NOTGREATER.
           IF DataSet1-clienti1-KEY-Asc
              START clienti1 KEY <= cli-chiave OF clienti1
           ELSE
              START clienti1 KEY >= cli-chiave OF clienti1
           END-IF
           .

       DataSet1-clienti1-START-GREATER.
           IF DataSet1-clienti1-KEY-Asc
              START clienti1 KEY > cli-chiave OF clienti1
           ELSE
              START clienti1 KEY < cli-chiave OF clienti1
           END-IF
           .

       DataSet1-clienti1-START-LESS.
           IF DataSet1-clienti1-KEY-Asc
              START clienti1 KEY < cli-chiave OF clienti1
           ELSE
              START clienti1 KEY > cli-chiave OF clienti1
           END-IF
           .

       DataSet1-clienti1-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti1, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti1, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-clienti1-LOCK
              READ clienti1 WITH LOCK 
              KEY cli-chiave OF clienti1
           ELSE
              READ clienti1 WITH NO LOCK 
              KEY cli-chiave OF clienti1
           END-IF
           PERFORM clienti1-cli-K1-MERGE-SPLITBUF
           PERFORM clienti1-cli-K3-MERGE-SPLITBUF
           PERFORM clienti1-cli-K4-MERGE-SPLITBUF
           MOVE STATUS-clienti1 TO TOTEM-ERR-STAT 
           MOVE "clienti1" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti1, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti1, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-clienti1-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti1, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti1, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-clienti1-KEY-Asc
              IF DataSet1-clienti1-LOCK
                 READ clienti1 NEXT WITH LOCK
              ELSE
                 READ clienti1 NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-clienti1-LOCK
                 READ clienti1 PREVIOUS WITH LOCK
              ELSE
                 READ clienti1 PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM clienti1-cli-K1-MERGE-SPLITBUF
           PERFORM clienti1-cli-K3-MERGE-SPLITBUF
           PERFORM clienti1-cli-K4-MERGE-SPLITBUF
           MOVE STATUS-clienti1 TO TOTEM-ERR-STAT
           MOVE "clienti1" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti1, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti1, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-clienti1-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti1, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti1, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-clienti1-KEY-Asc
              IF DataSet1-clienti1-LOCK
                 READ clienti1 PREVIOUS WITH LOCK
              ELSE
                 READ clienti1 PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-clienti1-LOCK
                 READ clienti1 NEXT WITH LOCK
              ELSE
                 READ clienti1 NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM clienti1-cli-K1-MERGE-SPLITBUF
           PERFORM clienti1-cli-K3-MERGE-SPLITBUF
           PERFORM clienti1-cli-K4-MERGE-SPLITBUF
           MOVE STATUS-clienti1 TO TOTEM-ERR-STAT
           MOVE "clienti1" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti1, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti1, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-clienti1-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti1, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-clienti1 TO TOTEM-ERR-STAT
           MOVE "clienti1" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti1, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-clienti1-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti1, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-clienti1 TO TOTEM-ERR-STAT
           MOVE "clienti1" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti1, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-clienti1-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti1, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-clienti1 TO TOTEM-ERR-STAT
           MOVE "clienti1" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti1, AfterDelete>
      * <TOTEM:END>
           .

       destini-K1-MERGE-SPLITBUF.
           INITIALIZE destini-K1-SPLITBUF
           MOVE des-ragsoc-1(1:40) TO destini-K1-SPLITBUF(1:40)
           MOVE des-codice(1:5) TO destini-K1-SPLITBUF(41:5)
           MOVE des-prog(1:5) TO destini-K1-SPLITBUF(46:5)
           .

       destini-k-localita-MERGE-SPLITBUF.
           INITIALIZE destini-k-localita-SPLITBUF
           MOVE des-localita(1:35) TO destini-k-localita-SPLITBUF(1:35)
           .

       DataSet1-destini-INITSTART.
           IF DataSet1-destini-KEY-Asc
              MOVE Low-Value TO des-chiave
           ELSE
              MOVE High-Value TO des-chiave
           END-IF
           .

       DataSet1-destini-INITEND.
           IF DataSet1-destini-KEY-Asc
              MOVE High-Value TO des-chiave
           ELSE
              MOVE Low-Value TO des-chiave
           END-IF
           .

      * destini
       DataSet1-destini-START.
           IF DataSet1-destini-KEY-Asc
              START destini KEY >= des-chiave
           ELSE
              START destini KEY <= des-chiave
           END-IF
           .

       DataSet1-destini-START-NOTGREATER.
           IF DataSet1-destini-KEY-Asc
              START destini KEY <= des-chiave
           ELSE
              START destini KEY >= des-chiave
           END-IF
           .

       DataSet1-destini-START-GREATER.
           IF DataSet1-destini-KEY-Asc
              START destini KEY > des-chiave
           ELSE
              START destini KEY < des-chiave
           END-IF
           .

       DataSet1-destini-START-LESS.
           IF DataSet1-destini-KEY-Asc
              START destini KEY < des-chiave
           ELSE
              START destini KEY > des-chiave
           END-IF
           .

       DataSet1-destini-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-destini-LOCK
              READ destini WITH LOCK 
              KEY des-chiave
           ELSE
              READ destini WITH NO LOCK 
              KEY des-chiave
           END-IF
           PERFORM destini-K1-MERGE-SPLITBUF
           PERFORM destini-k-localita-MERGE-SPLITBUF
           MOVE STATUS-destini TO TOTEM-ERR-STAT 
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-destini-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-destini-KEY-Asc
              IF DataSet1-destini-LOCK
                 READ destini NEXT WITH LOCK
              ELSE
                 READ destini NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-destini-LOCK
                 READ destini PREVIOUS WITH LOCK
              ELSE
                 READ destini PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM destini-K1-MERGE-SPLITBUF
           PERFORM destini-k-localita-MERGE-SPLITBUF
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-destini-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-destini-KEY-Asc
              IF DataSet1-destini-LOCK
                 READ destini PREVIOUS WITH LOCK
              ELSE
                 READ destini PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-destini-LOCK
                 READ destini NEXT WITH LOCK
              ELSE
                 READ destini NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM destini-K1-MERGE-SPLITBUF
           PERFORM destini-k-localita-MERGE-SPLITBUF
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-destini-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-destini-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-destini-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-INIT-RECORD.
           INITIALIZE art-rec OF articoli
           INITIALIZE mar-rec OF tmarche
           INITIALIZE tmp-movf-rec OF tmp-movmagforn
           INITIALIZE tge-rec OF tparamge
           INITIALIZE tca-rec OF tcaumag
           INITIALIZE line-riga OF lineseq
           INITIALIZE tof-rec OF tordforn
           INITIALIZE rof-rec OF rordforn
           INITIALIZE desf-rec OF destinif
           INITIALIZE cli-rec OF clienti
           INITIALIZE cli-rec OF clienti1
           INITIALIZE des-rec OF destini
           .


      * GRID
       gd-mov-Content.
      * CELLS' SETTING
              MODIFY gd-mov, X = 2, Y = 1,
                CELL-DATA = "Mag.",
      * CELLS' SETTING
              MODIFY gd-mov, X = 3, Y = 1,
                CELL-DATA = "Fornitore",
      * CELLS' SETTING
              MODIFY gd-mov, X = 4, Y = 1,
                CELL-DATA = "Art.",
      * CELLS' SETTING
              MODIFY gd-mov, X = 5, Y = 1,
                CELL-DATA = "Descrizione articolo",
      * CELLS' SETTING
              MODIFY gd-mov, X = 6, Y = 1,
                CELL-DATA = "N. Ord.",
      * CELLS' SETTING
              MODIFY gd-mov, X = 7, Y = 1,
                CELL-DATA = "Dt Ord.",
      * CELLS' SETTING
              MODIFY gd-mov, X = 8, Y = 1,
                CELL-DATA = "Q.ta Ord",
      * CELLS' SETTING
              MODIFY gd-mov, X = 9, Y = 1,
                CELL-DATA = "Q.ta Eva",
      * CELLS' SETTING
              MODIFY gd-mov, X = 10, Y = 1,
                CELL-DATA = "I.Merce",
      * CELLS' SETTING
              MODIFY gd-mov, X = 11, Y = 1,
                CELL-DATA = "Add. Pb",
      * CELLS' SETTING
              MODIFY gd-mov, X = 12, Y = 1,
                CELL-DATA = "I. Consumo",
      * CELLS' SETTING
              MODIFY gd-mov, X = 13, Y = 1,
                CELL-DATA = "Cou/Cob",
      * CELLS' SETTING
              MODIFY gd-mov, X = 14, Y = 1,
                CELL-DATA = "Prz. Finito",
           .

      * FD's Initialize Paragraph
       DataSet1-articoli-INITREC.
           INITIALIZE art-rec OF articoli
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tmarche-INITREC.
           INITIALIZE mar-rec OF tmarche
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tmp-movmagforn-INITREC.
           INITIALIZE tmp-movf-rec OF tmp-movmagforn
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tparamge-INITREC.
           INITIALIZE tge-rec OF tparamge
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tcaumag-INITREC.
           INITIALIZE tca-rec OF tcaumag
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-lineseq-INITREC.
           INITIALIZE line-riga OF lineseq
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tordforn-INITREC.
           INITIALIZE tof-rec OF tordforn
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-rordforn-INITREC.
           INITIALIZE rof-rec OF rordforn
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-destinif-INITREC.
           INITIALIZE desf-rec OF destinif
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-clienti-INITREC.
           INITIALIZE cli-rec OF clienti
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-clienti1-INITREC.
           INITIALIZE cli-rec OF clienti1
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-destini-INITREC.
           INITIALIZE des-rec OF destini
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      *
       DataSet1-DISPATCH-BUFTOFLD.
           EVALUATE TOTEM-Form-Index ALSO TOTEM-Frame-Index
              WHEN 1 ALSO 0
                  PERFORM Form2-Buf-To-Fld
           END-EVALUATE
           .

       Form2-Open-Routine.
           PERFORM Form2-Scrn
           PERFORM Form2-Proc
           .

       Form2-Scrn.
           PERFORM Form2-Create-Win
           PERFORM Form2-Init-Value
           PERFORM Form2-Init-Data
      * Tab keystrok settings
      * Tool Bar
           PERFORM Form2-DISPLAY
           .

       Form2-Create-Win.
           Display Floating GRAPHICAL WINDOW
              LINES 49,00,
              SIZE 167,83,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 65793,
              CONTROL FONT Small-Font,
              LABEL-OFFSET 23,
              LINK TO THREAD,
              MODELESS,
              NO SCROLL,
              TITLE-BAR,
              TITLE titolo,
              WITH SYSTEM MENU,
              USER-GRAY,
           VISIBLE 0,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE Screen1-Event-Proc,
              HANDLE IS form2-Handle,
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterCreateWin>
      *<<** Customized_Default, SP-G, Screen4-blockpgm-1, Disable **>>

           .
      * <TOTEM:END>


      * Tool Bar    
      * Status-bar
           DISPLAY Form2 UPON form2-Handle
      * DISPLAY-COLUMNS settings
              MODIFY gd-mov, DISPLAY-COLUMNS (1, 4, 9, 34, 40, 75, 82, 
           92, 101, 110, 120, 130, 142, 152)
           .

       Form2-PROC.
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeAccept>
           set CallManutenzione to false.
           perform FORM3-OPEN-ROUTINE.

           if not trovato       
              display message box 
              "Nessun elemento presente nei limiti di ricerca impostati"
                      title = titolo
              perform FORM2-EXIT
           else
              if stampa-excel
                 perform FORM2-EXIT
              else
                 modify form2-Handle, visible = 1 
                 move 2 to riga event-data-2
                 modify gd-mov, cursor-y = riga
                 perform CAMBIA-FONT-RIGA
                 perform VALORIZZA-LABELS
              end-if
           end-if.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT Form2
                 ON EXCEPTION
                    PERFORM Form2-Evaluate-Func
                 MOVE 1 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY form2-Handle
           INITIALIZE Key-Status
           .

       Form2-Evaluate-Func.
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterAccept>
           if CallManutenzione
              perform ORDINE-DA-GRIGLIA
              set CallManutenzione to false
           end-if

           .
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM Form2-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM Form2-Exit
                 END-IF
              WHEN Key-Status = 1000
                 PERFORM pb-ok2-LinkTo
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       Form2-CLEAR.
           PERFORM Form2-INIT-VALUE
           PERFORM Form2-DISPLAY
           .

       Form2-DISPLAY.
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY Form2 UPON form2-Handle
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterDisplay>
      *<<** Customized_Default, SP-G, Screen4-blockpgm-1, Disable **>>

           .
      * <TOTEM:END>
           .

       Form2-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeExit>
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       Form2-Init-Data.
           MOVE 1 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
      * GRID
           PERFORM gd-mov-Content
           .

       Form2-DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           PERFORM Form2-DataSet1-Update-Key
           .

       Form2-DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-tordforn-KEY1-ORDER
           END-EVALUATE
           PERFORM Form2-DataSet1-Update-Key
           .

       Form2-DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-tordforn-KEY1-ORDER
           END-EVALUATE
           PERFORM Form2-DataSet1-Update-Key
           .

       Form2-DataSet1-Update-Key.
           MOVE tof-rec OF tordforn TO
                     Form2-MULKEY-TMPBUF
           PERFORM Form2-CLEAR
           PERFORM Form2-INIT-DATA
           MOVE Form2-MULKEY-TMPBUF TO
                     tof-rec OF tordforn
           PERFORM DataSet1-tordforn-Read
           PERFORM Form2-DUPLICATE-MOVEKEY
           PERFORM Form2-DUMMY-CURR
           PERFORM Form2-IUD-Display
           .

       Form2-DUPLICATE-MOVEKEY.
           .

       Form2-First.
           PERFORM Form2-DUMMY-FIRST
           PERFORM DataSet1-tordforn-INITSTART
           PERFORM DataSet1-tordforn-START
           IF NOT Valid-STATUS-tordforn
              PERFORM Form2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeFirst>
      * <TOTEM:END>
           PERFORM DataSet1-tordforn-Read-Next
           IF NOT Valid-STATUS-tordforn
              PERFORM Form2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterFirst>
      * <TOTEM:END>
           PERFORM Form2-DUPLICATE-MOVEKEY.
           PERFORM Form2-IUD-Display
           .

       Form2-Previous.
              PERFORM Form2-Buf-To-Fld
              PERFORM DataSet1-tordforn-START-LESS
           IF NOT Valid-STATUS-tordforn
              PERFORM Form2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforePrevious>
      * <TOTEM:END>
           PERFORM DataSet1-tordforn-Read-Prev
           IF NOT Valid-STATUS-tordforn
              PERFORM Form2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterPrevious>
      * <TOTEM:END>
           PERFORM Form2-DUPLICATE-MOVEKEY
           PERFORM Form2-DUMMY-PREVIOUS
           PERFORM Form2-IUD-Display
           .

       Form2-Next.
              PERFORM Form2-Buf-To-Fld
              PERFORM DataSet1-tordforn-START-GREATER
           IF NOT Valid-STATUS-tordforn
              PERFORM Form2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeNext>
      * <TOTEM:END>
           PERFORM DataSet1-tordforn-Read-Next
           IF NOT Valid-STATUS-tordforn
              PERFORM Form2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterNext>
      * <TOTEM:END>
           PERFORM Form2-DUPLICATE-MOVEKEY
           PERFORM Form2-DUMMY-NEXT
           PERFORM Form2-IUD-Display
           .
      
       Form2-Last.
           PERFORM Form2-DUMMY-LAST
           PERFORM DataSet1-tordforn-INITEND
           PERFORM DataSet1-tordforn-START-NOTGREATER
           IF NOT Valid-STATUS-tordforn
              PERFORM Form2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeLast>
      * <TOTEM:END>
           PERFORM DataSet1-tordforn-Read-Prev
           IF NOT Valid-STATUS-tordforn
              PERFORM Form2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterLast>
      * <TOTEM:END>
           PERFORM Form2-DUPLICATE-MOVEKEY.
           PERFORM Form2-IUD-Display
           .

       Form2-Curr.
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeCurrent>
      * <TOTEM:END>
           PERFORM Form2-Buf-To-Fld
           PERFORM DataSet1-tordforn-Read
           PERFORM Form2-DUPLICATE-MOVEKEY
           PERFORM Form2-DUMMY-CURR
           PERFORM Form2-IUD-Display
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterCurrent>
      * <TOTEM:END>
           .

       Form2-IUD-Display.
           IF Valid-STATUS-tordforn
              PERFORM Form2-ALLGRID-RESET
              PERFORM Form2-Fld-To-Buf
              PERFORM Form2-NAVI-FOR-MASTERGRID
              PERFORM Form2-DISPLAY
           ELSE
              IF Form2-FLAG-REFRESH
                 CONTINUE
              ELSE
                 PERFORM Form2-Extended-File-Status
              END-IF
           END-IF
           .

       Form2-Add.
           PERFORM Form2-Buf-To-Fld
           PERFORM Form2-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM Form2-DUMMY-ADD
           PERFORM DataSet1-tordforn-INITREC
           PERFORM Form2-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeAdd>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-tordforn-Rec-Write
           IF Valid-STATUS-tordforn
              PERFORM Form2-RESUMMARY-INS
              PERFORM Form2-DUMMY-UPDATE-INIT
              MOVE "301" TO TOTEM-MSG-ID
              PERFORM Form2-IUD-Display
           END-IF
           PERFORM Form2-ERR-CHECKING
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterAdd>
      * <TOTEM:END>
           .
     
       Form2-Update.
           PERFORM Form2-Buf-To-Fld
           PERFORM DataSet1-tordforn-START              
           IF NOT Valid-STATUS-tordforn
              PERFORM Form2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
           PERFORM DataSet1-tordforn-Read
           PERFORM Form2-Buf-To-Fld
           PERFORM Form2-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM Form2-DUMMY-UPDATE
           PERFORM Form2-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeUpdate>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-tordforn-Rec-Rewrite
           IF Valid-STATUS-tordforn
              PERFORM Form2-RESUMMARY-DEL
              PERFORM Form2-DUMMY-UPDATE-INIT
              MOVE "302" TO TOTEM-MSG-ID
              PERFORM Form2-IUD-Display
           END-IF
           PERFORM Form2-ERR-CHECKING
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterUpdate>
      * <TOTEM:END>
           .

       Form2-Delete.
           MOVE "203" TO TOTEM-MSG-ID
           PERFORM MESSAGE-BOX-DISPLAY
           IF TOTEM-MSG-RETURN-VALUE NOT = 1
              INITIALIZE TOTEM-MSG-TEXT
              EXIT PARAGRAPH 
           END-IF
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeDelete>
      * <TOTEM:END>
           PERFORM Form2-DUMMY-DELETE
      * delete
           PERFORM Form2-Buf-To-Fld
           PERFORM DataSet1-tordforn-Rec-Delete
           IF Valid-STATUS-tordforn
              PERFORM Form2-CLEAR
              PERFORM Form2-DUMMY-DELETE-INIT
              MOVE "303" TO TOTEM-MSG-ID
              MOVE "00" to STATUS-tordforn
           END-IF
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterDelete>
      * <TOTEM:END>
           PERFORM Form2-ERR-CHECKING
           .

       Form2-NAVI-FOR-MASTERGRID.
           .

       Form2-ERR-CHECKING.
           IF Valid-STATUS-tordforn
              PERFORM Form2-SHOW-MSG-ROUTINE
           ELSE
              PERFORM Form2-Extended-File-Status
           END-IF
           .

       Form2-RESUMMARY-INS.
           .

       Form2-RESUMMARY-DEL.
           .


       Form2-DUMMY-FIRST.
           .

       Form2-DUMMY-PREVIOUS.
           .

       Form2-DUMMY-NEXT.
           .

       Form2-DUMMY-LAST.
           .

       Form2-DUMMY-CURR.
           .

       Form2-DUMMY-ADD.
           .

       Form2-DUMMY-UPDATE.
           .

       Form2-DUMMY-UPDATE-INIT.
           .

       Form2-DUMMY-DELETE.
           .

       Form2-DUMMY-DELETE-INIT.
           .

       Form2-Init-Value.
      * FORM : Form2
           PERFORM DataSet1-INIT-RECORD
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, SetDefault>
      * <TOTEM:END>
           PERFORM Form2-FLD-TO-BUF
           .


       Form2-ALLGRID-RESET.
           .

      * for Form's Validation
       Form2-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       Form2-Buf-To-Fld.
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterBufToFld>
      * <TOTEM:END>
           .

       Form2-Fld-To-Buf.
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeFldToBuf>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterFldToBuf>
      * <TOTEM:END>
           .

       Form2-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform Form2-BUF-TO-FLD.
           move 0 to scelta.
           .
       Form2-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM Form2-SHOW-MSG-ROUTINE
           .

       Form2-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM Form2-DISPLAY-MESSAGE
           .

       Form2-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       Form2-Save-Status.
           MOVE DataSet1-tordforn-KEY1-ORDER TO TMP-Form2-KEY1-ORDER
           MOVE DataSet1-KEYIS TO TMP-Form2-KEYIS
           MOVE tof-rec OF tordforn TO 
              TMP-Form2-tordforn-RESTOREBUF
           .             

       Form2-Restore-Status.
           MOVE TMP-Form2-KEY1-ORDER TO DataSet1-tordforn-KEY1-ORDER
           MOVE TMP-Form2-KEYIS TO DataSet1-KEYIS
           MOVE TMP-Form2-tordforn-RESTOREBUF TO
              tof-rec OF tordforn
           PERFORM DataSet1-tordforn-START
           IF Valid-STATUS-tordforn
              PERFORM DataSet1-tordforn-Read-Next
           ELSE
              PERFORM DataSet1-tordforn-INITREC
           END-IF
           PERFORM UNTIL NOT Valid-STATUS-tordforn OR
              (Valid-STATUS-tordforn AND
                 tof-rec OF tordforn = 
                   TMP-Form2-tordforn-RESTOREBUF)
              PERFORM DataSet1-tordforn-Read-Next
           END-PERFORM
           .

       Form1-Open-Routine.
           PERFORM Form1-Scrn
           PERFORM Form1-Proc
           .

       Form1-Scrn.
           PERFORM Form1-Create-Win
           PERFORM Form1-Init-Value
           PERFORM Form1-Init-Data
      * Tab keystrok settings
      * Tool Bar
           DISPLAY Form1-Tb-1a
           PERFORM Form1-DISPLAY
           .

       Form1-Create-Win.
           Display Independent GRAPHICAL WINDOW
              LINES 24,61,
              SIZE 45,90,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 65793,
              CONTROL FONT Verdana12-Occidentale,
              LABEL-OFFSET 23,
              LINK TO THREAD,
              NO SCROLL,
              TITLE-BAR,
              TITLE TITOLO,
              WITH SYSTEM MENU,
              USER-GRAY,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE Screen4-Event-Proc,
              HANDLE IS form1-Handle,
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
           DISPLAY TOOL-BAR 
              LINES 2,67,   
              HANDLE IN Form1-Tb-1-Handlea
           DISPLAY Form1-Tb-1a UPON Form1-Tb-1-Handlea

      * Status-bar
           DISPLAY Form1 UPON form1-Handle
      * DISPLAY-COLUMNS settings
           .

       Form1-PROC.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeAccept>
           set stampa-excel to false.
      * SPECIFICO PER PROGRAMMI CON SCREEN DI ACCETTAZIONE LIMITI

           move spaces  to tge-codice.
           read tparamge no lock
                invalid  move zero    to ef-data-from-buf
                         move all "9" to ef-data-to-buf
            not invalid  string "0101"   delimited by size
                                tge-anno delimited by size
                                into como-data
                         end-string
                         move como-data  to ef-data-from-buf
                         string "3112"   delimited by size
                                tge-anno delimited by size
                                into como-data
                         end-string
                         move como-data to ef-data-to-buf
           end-read.
                                                                     
           display Form1.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT Form1
                 ON EXCEPTION
                    PERFORM Form1-Evaluate-Func
                 MOVE 2 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY form1-Handle
           INITIALIZE Key-Status
           .

       Form1-Evaluate-Func.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM Form1-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM Form1-Exit
                 END-IF
              WHEN Key-Status = 1000
                 PERFORM pb-ok-LinkTo
              WHEN Key-Status = 8
                 PERFORM TOOL-CERCA-LinkTo
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       Form1-CLEAR.
           PERFORM Form1-INIT-VALUE
           PERFORM Form1-DISPLAY
           .

       Form1-DISPLAY.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY Form1-Tb-1a
           DISPLAY Form1 UPON form1-Handle
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterDisplay>
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       Form1-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeExit>
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       Form1-Init-Data.
           MOVE 2 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
           .

       Form1-Init-Value.
           MOVE TITOLO TO TOTEM-MSG-TITLE
           INITIALIZE Form1-BUF
      * DB_LABEL
              MOVE "<<HELP>> Blank = TUTTI I FORNITORI" TO cli-ragsoc-1 
           of clienti
      * DB_LABEL
              MOVE "<<HELP>> Blank = TUTTI I DESTINI" TO desf-ragsoc-1
      * DB_LABEL
              MOVE "<<HELP>> Blank = TUTTI I DESTINI" TO des-ragsoc-1
      * DB_LABEL
              MOVE "<<HELP>> Blank = TUTTI I CLIENTI" TO cli-ragsoc-1 
           of clienti1
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, SetDefault>
      * <TOTEM:END>
           PERFORM Form1-FLD-TO-BUF
           .


       Form1-ALLGRID-RESET.
           .

      * for Form's Validation
       Form1-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
      * ef-cod's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-cod-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5003 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-des-forn's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-des-forn-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5004 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-cliente's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-cliente-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5005 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-des-cli's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-des-cli-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5006 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-marca's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-marca-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5007 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-art's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-art-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5008 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
           .

       ef-cod-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-cod, BeforeValidation>
      * <TOTEM:END>
           .

       ef-cod-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-cod, AfterValidation>
      * <TOTEM:END>
           .

      * ef-cod's Validation
       ef-cod-VALIDATION.
           PERFORM ef-cod-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-cod-AFTER-VALIDATION
           .

       ef-des-forn-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-des-forn, BeforeValidation>
      * <TOTEM:END>
           .

       ef-des-forn-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-des-forn, AfterValidation>
      * <TOTEM:END>
           .

      * ef-des-forn's Validation
       ef-des-forn-VALIDATION.
           PERFORM ef-des-forn-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-des-forn-AFTER-VALIDATION
           .

       ef-cliente-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-cliente, BeforeValidation>
      * <TOTEM:END>
           .

       ef-cliente-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-cliente, AfterValidation>
      * <TOTEM:END>
           .

      * ef-cliente's Validation
       ef-cliente-VALIDATION.
           PERFORM ef-cliente-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-cliente-AFTER-VALIDATION
           .

       ef-des-cli-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-des-cli, BeforeValidation>
      * <TOTEM:END>
           .

       ef-des-cli-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-des-cli, AfterValidation>
      * <TOTEM:END>
           .

      * ef-des-cli's Validation
       ef-des-cli-VALIDATION.
           PERFORM ef-des-cli-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-des-cli-AFTER-VALIDATION
           .

       ef-marca-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-marca, BeforeValidation>
      * <TOTEM:END>
           .

       ef-marca-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-marca, AfterValidation>
      * <TOTEM:END>
           .

      * ef-marca's Validation
       ef-marca-VALIDATION.
           PERFORM ef-marca-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-marca-AFTER-VALIDATION
           .

       ef-art-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-art, BeforeValidation>
      * <TOTEM:END>
           .

       ef-art-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-art, AfterValidation>
      * <TOTEM:END>
           .

      * ef-art's Validation
       ef-art-VALIDATION.
           PERFORM ef-art-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-art-AFTER-VALIDATION
           .


       Form1-Buf-To-Fld.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeBufToFld>
      * <TOTEM:END>
      * DB_Entry-Field : ef-cod
           MOVE ef-cod-BUF TO cli-codice of clienti
      * DB_Entry-Field : ef-des-forn
           MOVE ef-des-forn-BUF TO desf-codice
      * DB_Entry-Field : ef-cliente
           MOVE ef-cliente-BUF TO cli-codice of clienti1
      * DB_Entry-Field : ef-des-cli
           MOVE ef-des-cli-BUF TO des-codice
      * DB_Entry-Field : ef-marca
           MOVE ef-marca-BUF TO mar-codice
      * DB_Entry-Field : ef-art
           MOVE ef-art-BUF TO art-codice
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterBufToFld>
      * <TOTEM:END>
           .

       Form1-Fld-To-Buf.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeFldToBuf>
      * <TOTEM:END>
      * DB_Entry-Field : ef-cod
           MOVE cli-codice of clienti TO ef-cod-BUF
      * DB_Entry-Field : ef-des-forn
           MOVE desf-codice TO ef-des-forn-BUF
      * DB_Entry-Field : ef-cliente
           MOVE cli-codice of clienti1 TO ef-cliente-BUF
      * DB_Entry-Field : ef-des-cli
           MOVE des-codice TO ef-des-cli-BUF
      * DB_Entry-Field : ef-marca
           MOVE mar-codice TO ef-marca-BUF
      * DB_Entry-Field : ef-art
           MOVE art-codice TO ef-art-BUF
      * DB_LABEL : lab-forn
              MOVE cli-ragsoc-1 of clienti  TO lab-forn-BUF
      * DB_LABEL : lab-marca
              MOVE mar-descrizione  TO lab-marca-BUF
      * DB_LABEL : lab-art
              MOVE art-descrizione  TO lab-art-BUF
      * DB_LABEL : lab-des-forn
              MOVE desf-ragsoc-1  TO lab-des-forn-BUF
      * DB_LABEL : lab-des-cli
              MOVE des-ragsoc-1  TO lab-des-cli-BUF
      * DB_LABEL : lab-cli
              MOVE cli-ragsoc-1 of clienti1  TO lab-cli-BUF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterFldToBuf>
      * <TOTEM:END>
           .

       Form1-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform Form1-BUF-TO-FLD.
           move 0 to scelta.
           .
       Form1-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM Form1-SHOW-MSG-ROUTINE
           .

       Form1-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM Form1-DISPLAY-MESSAGE
           .

       Form1-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       Form1-Save-Status.
           .             

       Form1-Restore-Status.
           .


      * Paragrafo per la struttura del codice in BEFORE sulla screen Form1
      ***---
       Form1-BEFORE-SCREEN.
           evaluate control-id
           |78-ID-ef-cod è l'ID del campo ef-cod
           when 78-ID-ef-cod
                move 1 to StatusHelp
                perform STATUS-HELP
           |78-ID-ef-des-forn è l'ID del campo ef-des-forn
           when 78-ID-ef-des-forn
                move 1 to StatusHelp
                perform STATUS-HELP
           |78-ID-ef-cliente è l'ID del campo ef-cliente
           when 78-ID-ef-cliente
                move 1 to StatusHelp
                perform STATUS-HELP
           |78-ID-ef-des-cli è l'ID del campo ef-des-cli
           when 78-ID-ef-des-cli
                move 1 to StatusHelp
                perform STATUS-HELP
           |78-ID-ef-marca è l'ID del campo ef-marca
           when 78-ID-ef-marca
                move 1 to StatusHelp
                perform STATUS-HELP
           |78-ID-ef-art è l'ID del campo ef-art
           when 78-ID-ef-art
                move 1 to StatusHelp
                perform STATUS-HELP
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella BEFORE della screen
           when 99999 continue
           when other continue
           end-evaluate.

      * Generazione settaggio keyboard "." ---> ","

      * Paragrafo per la struttura del codice in AFTER sulla screen Form1
      ***---
       Form1-AFTER-SCREEN.
           evaluate control-id
           |78-ID-ef-cod è l'ID del campo ef-cod
           when 78-ID-ef-cod
                move 0 to StatusHelp
                perform STATUS-HELP

           |78-ID-ef-des-forn è l'ID del campo ef-des-forn
           when 78-ID-ef-des-forn
                move 0 to StatusHelp
                perform STATUS-HELP

           |78-ID-ef-cliente è l'ID del campo ef-cliente
           when 78-ID-ef-cliente
                move 0 to StatusHelp
                perform STATUS-HELP

           |78-ID-ef-des-cli è l'ID del campo ef-des-cli
           when 78-ID-ef-des-cli
                move 0 to StatusHelp
                perform STATUS-HELP

           |78-ID-ef-marca è l'ID del campo ef-marca
           when 78-ID-ef-marca
                move 0 to StatusHelp
                perform STATUS-HELP

           |78-ID-ef-art è l'ID del campo ef-art
           when 78-ID-ef-art
                move 0 to StatusHelp
                perform STATUS-HELP

           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER della screen
           when 99999 continue
           when other continue
           end-evaluate.

      * Generazione risettaggio keyboard "." ---> "."

      * Generazione stringa perform CONTROLLO
           evaluate control-id
           |78-ID-ef-data-from è l'ID del campo ef-data-from
           when 78-ID-ef-data-from
                perform CONTROLLO
           |78-ID-ef-data-to è l'ID del campo ef-data-to
           when 78-ID-ef-data-to
                perform CONTROLLO
           |78-ID-ef-cod è l'ID del campo ef-cod
           when 78-ID-ef-cod
                perform CONTROLLO
           |78-ID-ef-des-forn è l'ID del campo ef-des-forn
           when 78-ID-ef-des-forn
                perform CONTROLLO
           |78-ID-ef-cliente è l'ID del campo ef-cliente
           when 78-ID-ef-cliente
                perform CONTROLLO
           |78-ID-ef-des-cli è l'ID del campo ef-des-cli
           when 78-ID-ef-des-cli
                perform CONTROLLO
           |78-ID-ef-marca è l'ID del campo ef-marca
           when 78-ID-ef-marca
                perform CONTROLLO
           |78-ID-ef-art è l'ID del campo ef-art
           when 78-ID-ef-art
                perform CONTROLLO
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER CONTROLLO della screen
           when 99999 continue
           when other continue
           end-evaluate.

       form3-Open-Routine.
           PERFORM form3-Scrn
           PERFORM form3-Proc
           .

       form3-Scrn.
           PERFORM form3-Create-Win
           PERFORM form3-Init-Value
           PERFORM form3-Init-Data
      * Tab keystrok settings
      * Tool Bar
           PERFORM form3-DISPLAY
           .

       form3-Create-Win.
           Display Floating GRAPHICAL WINDOW
              LINES 3,00,
              SIZE 32,00,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 65793,
              CONTROL FONT Verdana12BI-Occidentale,
              LINK TO THREAD,
              MODELESS,
              NO SCROLL,
              USER-GRAY,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE form3-Event-Proc,
              HANDLE IS form3-Handle,
      * <TOTEM:EPT. FORM:form3, FORM:form3, AfterCreateWin>
      *<<** Customized_Default, SP-G, Screen4-blockpgm-1, Disable **>>

           .
      * <TOTEM:END>


      * Tool Bar    
      * Status-bar
           DISPLAY form3 UPON form3-Handle
      * DISPLAY-COLUMNS settings
           .

       form3-PROC.
      * <TOTEM:EPT. FORM:form3, FORM:form3, BeforeAccept>
           call "w$mouse"       using SET-MOUSE-SHAPE, WAIT-POINTER.
           inquire ef-cod,      value in cli-codice of clienti.
           inquire ef-des-forn, value in desf-prog.
           inquire ef-cliente,  value in cli-codice of clienti1.
           inquire ef-des-cli,  value in des-prog.
           inquire ef-marca, value in mar-codice.
           inquire ef-art,   value in art-codice.
           move cli-codice of clienti    to desf-codice.
           move cli-codice of clienti1   to des-codice.
           perform RIEMPI-TMP.

           call "w$mouse" using SET-MOUSE-SHAPE, ARROW-POINTER.

           perform FORM3-EXIT.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT OMITTED LINE 1 COL 1
                 ON EXCEPTION
                    PERFORM form3-Evaluate-Func
                 MOVE 3 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:form3, FORM:form3, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:form3, FORM:form3, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY form3-Handle
           INITIALIZE Key-Status
           .

       form3-Evaluate-Func.
      * <TOTEM:EPT. FORM:form3, FORM:form3, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM form3-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM form3-Exit
                 END-IF
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       form3-CLEAR.
           PERFORM form3-INIT-VALUE
           PERFORM form3-DISPLAY
           .

       form3-DISPLAY.
      * <TOTEM:EPT. FORM:form3, FORM:form3, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY form3 UPON form3-Handle
      * <TOTEM:EPT. FORM:form3, FORM:form3, AfterDisplay>
      *<<** Customized_Default, SP-G, Screen4-blockpgm-1, Disable **>>

           .
      * <TOTEM:END>
           .

       form3-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:form3, FORM:form3, BeforeExit>
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       form3-Init-Data.
           MOVE 3 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
           .

       form3-Init-Value.
      * <TOTEM:EPT. FORM:form3, FORM:form3, SetDefault>
      * <TOTEM:END>
           PERFORM form3-FLD-TO-BUF
           .


       form3-ALLGRID-RESET.
           .

      * for Form's Validation
       form3-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       form3-Buf-To-Fld.
      * <TOTEM:EPT. FORM:form3, FORM:form3, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:form3, FORM:form3, AfterBufToFld>
      * <TOTEM:END>
           .

       form3-Fld-To-Buf.
      * <TOTEM:EPT. FORM:form3, FORM:form3, BeforeFldToBuf>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:form3, FORM:form3, AfterFldToBuf>
      * <TOTEM:END>
           .

       form3-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform form3-BUF-TO-FLD.
           move 0 to scelta.
           .
       form3-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM form3-SHOW-MSG-ROUTINE
           .

       form3-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM form3-DISPLAY-MESSAGE
           .

       form3-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       form3-Save-Status.
           .             

       form3-Restore-Status.
           .


      * Paragrafo per la struttura del codice in BEFORE sulla screen form3
      ***---
       form3-BEFORE-SCREEN.
           evaluate control-id
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella BEFORE della screen
           when 99999 continue
           when other continue
           end-evaluate.

      * Generazione settaggio keyboard "." ---> ","

      * Paragrafo per la struttura del codice in AFTER sulla screen form3
      ***---
       form3-AFTER-SCREEN.
           evaluate control-id
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER della screen
           when 99999 continue
           when other continue
           end-evaluate.

      * Generazione risettaggio keyboard "." ---> "."

      * Generazione stringa perform CONTROLLO
           evaluate control-id
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER CONTROLLO della screen
           when 99999 continue
           when other continue
           end-evaluate.



       Form1-BeforeProcedure.
           EVALUATE Control-Id
           WHEN 5003 MOVE "." to TOTEM-HINT-TEXT
           WHEN 5004 MOVE "." to TOTEM-HINT-TEXT
           WHEN 5005 MOVE "." to TOTEM-HINT-TEXT
           WHEN 5006 MOVE "." to TOTEM-HINT-TEXT
           WHEN 5007 MOVE "." to TOTEM-HINT-TEXT
           WHEN 5008 MOVE "." to TOTEM-HINT-TEXT
           WHEN OTHER MOVE SPACES TO TOTEM-HINT-TEXT
           END-EVALUATE
           EVALUATE Control-Id
           When 5003 PERFORM ef-cod-BeforeProcedure
           When 5004 PERFORM ef-des-BeforeProcedure
           When 5005 PERFORM ef-cod-BeforeProcedure
           When 5006 PERFORM ef-des-BeforeProcedure
           When 5007 PERFORM ef-marca-BeforeProcedure
           When 5008 PERFORM ef-art-BeforeProcedure
           END-EVALUATE
           perform Form1-BEFORE-SCREEN
           .

       Form1-AfterProcedure.
           EVALUATE Control-Id
           When 5003 PERFORM ef-cod-AfterProcedure
           When 5004 PERFORM ef-des-AfterProcedure
           When 5005 PERFORM ef-cod-AfterProcedure
           When 5006 PERFORM ef-des-AfterProcedure
           When 5007 PERFORM ef-marca-AfterProcedure
           When 5008 PERFORM ef-art-AfterProcedure
           END-EVALUATE
           perform Form1-AFTER-SCREEN
           .

       Screen1-Event-Proc.
           .

       Screen1-Gd-1-Event-Proc.
           EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
           WHEN Msg-Begin-Drag ALSO 1 ALSO
                    form2-Handle 
              PERFORM gd-ordini-Ev-Msg-Begin-Drag
           WHEN Msg-Begin-Entry ALSO 1 ALSO
                    form2-Handle 
              PERFORM gd-ordini-Ev-Msg-Begin-Entry
           WHEN Msg-End-Drag ALSO 1 ALSO
                    form2-Handle 
              PERFORM gd-ordini-Ev-Msg-End-Drag
           WHEN Msg-Goto-Cell ALSO 1 ALSO
                    form2-Handle 
              PERFORM gd-ordini-Ev-Msg-Goto-Cell
           WHEN Msg-Goto-Cell-Drag ALSO 1 ALSO
                    form2-Handle 
              PERFORM gd-ordini-Ev-Msg-Goto-Cell-Drag
           WHEN Msg-Goto-Cell-Mouse ALSO 1 ALSO
                    form2-Handle 
              PERFORM gd-ordini-Ev-Msg-Goto-Cell-Mouse
           END-EVALUATE
           .

       Screen4-Event-Proc.
           .

       form3-Event-Proc.
           .

      * USER DEFINE PARAGRAPH
       CERCA.
      * <TOTEM:PARA. CERCA>
           evaluate CONTROL-ID   
           when 78-ID-ef-cod
                set cli-tipo-F of clienti to true
                inquire ef-cod    value cli-codice of clienti
                move "clienti-CF-all"    to Como-File
                call   "zoom-gt" using como-file, cli-rec of clienti
                                giving stato-zoom
                cancel "zoom-gt"
                if stato-zoom = ZERO  
                   modify ef-cod,   value cli-codice of clienti
                   modify lab-forn,  value cli-ragsoc-1 of clienti
                end-if           
      *
           when 78-ID-ef-des-forn
                inquire ef-cod        value desf-codice
                inquire ef-des-forn   value desf-prog
                move "destinif-forn"   to Como-File
                call   "zoom-gt" using como-file, desf-rec
                                giving stato-zoom
                cancel "zoom-gt"
                if stato-zoom = 0
                   modify ef-des-forn,   value desf-prog
                   modify lab-des-forn,  value desf-ragsoc-1
                end-if
      *
           when 78-ID-ef-cliente
                set cli-tipo-C of clienti to true
                inquire ef-cliente    value cli-codice of clienti1
                move "clienti-CF-all"    to Como-File
                call   "zoom-gt" using como-file, cli-rec of clienti1
                                giving stato-zoom
                cancel "zoom-gt"
                if stato-zoom = ZERO  
                   modify ef-cliente,   value cli-codice of clienti1
                   modify lab-cli,  value cli-ragsoc-1 of clienti1
                end-if           

           when 78-ID-ef-des-cli
                inquire ef-cliente   value des-codice
                inquire ef-des-cli   value des-prog
                move "clienti-des"   to Como-File
                call   "zoom-gt" using como-file, des-rec
                                giving stato-zoom
                cancel "zoom-gt"
                if stato-zoom = 0
                   modify ef-des-cli,   value des-prog
                   modify lab-des-cli,  value des-ragsoc-1
                end-if

           when 78-ID-ef-marca
                inquire ef-marca value mar-codice
                move "tmarche"    to Como-File
                call   "zoom-gt" using como-file, mar-rec
                                giving stato-zoom
                cancel "zoom-gt"
                if stato-zoom = 0
                   modify ef-marca,   value mar-codice
                end-if           
      *
           when 78-ID-ef-art                      
                inquire ef-marca  value art-marca-prodotto
                inquire ef-art    value art-codice
                if art-marca-prodotto = 0
                   move "articoli"  to Como-File
                   call   "zoom-gt" using como-file, art-rec
                                   giving stato-zoom
                else
                   move "articoli-marche"  to Como-File
                   call   "zoom-gt" using como-file, art-rec
                                   giving stato-zoom
                end-if                              
                cancel "zoom-gt"
                if stato-zoom = 0
                   modify ef-art,   value art-codice
                end-if
      *
           end-evaluate 
           .
      * <TOTEM:END>

       CONTROLLO.
      * <TOTEM:PARA. CONTROLLO>
           set tutto-ok to true.

           evaluate CONTROL-ID
           when 78-ID-ef-data-from                          
                inquire ef-data-from, value in ef-data-from-buf
                move ef-data-from-buf to como-data
                if como-data not = 0
                   perform DATE-FORMAT
                   move como-data to ef-data-from-buf
                   display ef-data-from
                end-if
      *                       
           when 78-ID-ef-data-to                              
                inquire ef-data-from, value in ef-data-from-buf
                inquire ef-data-to,   value in ef-data-to-buf
                move ef-data-to-buf to como-data
                if como-data = 0
                   move all "9" to como-data
                else
                   if como-data not = 99999999
                      perform DATE-FORMAT
                   end-if
                end-if
                move como-data to ef-data-to-buf
                display ef-data-to
                perform DATE-TO-FILE
                move como-data        to como-data-to
                move ef-data-from-buf to como-data
                perform DATE-TO-FILE
                move como-data    to como-data-from
                if como-data-to < como-data-from
                   set errori to true
                   display message box "Intervallo limiti data errato!"
                           title = tit-err
                           icon 2
                   move 78-ID-ef-data-from to control-id
                end-if
      *
           when 78-ID-ef-cod
                set cli-tipo-F of clienti to true

                inquire ef-cod,   value in cli-codice of clienti
                move spaces to cli-ragsoc-1 of clienti
                if cli-codice of clienti not = 0
                   read clienti no lock
                        invalid
                        set errori to true
                        display message "Inserimento fornitore NON valid
      -    "o"
                                  title tit-err
                                   icon 2
                        move 78-ID-ef-cod to control-id 
                   end-read
                else
                   move "TUTTI I FORNITORI" to cli-ragsoc-1 of clienti
                end-if     
                move cli-ragsoc-1 of clienti to lab-forn-buf
                display lab-forn
           when 78-ID-ef-des-forn
                inquire ef-des-forn,   value in desf-prog
                move spaces to desf-ragsoc-1 desf-ragsoc-1
                if desf-prog not = 0
                   inquire ef-cod,   value in desf-codice
                   read destinif no lock
                        invalid
                           set errori to true
                   end-read  
      *             move desf-localita to lab-des-buf
                   move desf-ragsoc-1 to lab-des-forn-buf
                   if errori
                      display message "Inserimento destino NON valido"
                                title tit-err
                                 icon 2
                      move 78-ID-ef-des-forn to control-id 
                   end-if
                else
                   move 0 to desf-prog desf-prog
                   move "TUTTI I DESTINI" to lab-des-forn-buf
                end-if   
                display lab-des-forn
      *
           when 78-ID-ef-cliente
                set cli-tipo-C of clienti1 to true

                inquire ef-cliente,   value in cli-codice of clienti1
                move spaces to cli-ragsoc-1 of clienti1
                if cli-codice of clienti1 not = 0
                   read clienti1 no lock
                        invalid
                        set errori to true
                        display message "Inserimento cliente NON valido"
                                  title tit-err
                                   icon 2
                        move 78-ID-ef-cliente to control-id 
                   end-read
                else
                   move "TUTTI I CLIENTI" to cli-ragsoc-1 of clienti1
                end-if     
                move cli-ragsoc-1 of clienti1 to lab-cli-buf
                display lab-cli

           when 78-ID-ef-des-cli
                inquire ef-des-cli,   value in des-prog
                move spaces to des-ragsoc-1 
                if des-prog not = 0
                   inquire ef-cliente,   value in des-codice
                   read destini no lock
                        invalid
                           set errori to true
                   end-read  
      *             move desf-localita to lab-des-buf
                   move des-ragsoc-1 to lab-des-cli-buf
                   if errori
                      display message "Inserimento destino NON valido"
                                title tit-err
                                 icon 2
                      move 78-ID-ef-des-cli to control-id 
                   end-if
                else
                   move 0 to des-prog des-prog
                   move "TUTTI I DESTINI" to lab-des-cli-buf
                end-if   
                display lab-des-cli

           when 78-ID-ef-marca
                inquire ef-marca,   value in mar-codice
                move spaces to mar-descrizione
                if mar-codice not = 0
                   read tmarche no lock
                        invalid
                           set errori to true
                           display message"Inserimento marca NON valido"
                                   title = tit-err
                                   icon 2
                           move 78-ID-ef-marca to control-id 
                   end-read
                end-if     
                move mar-descrizione to lab-marca-buf
                display lab-marca
      *                        
           when 78-ID-ef-art
                inquire ef-art,   value in art-codice
                move spaces to art-descrizione
                if art-codice not = 0   
                   read articoli no lock
                        invalid
                           set errori to true
                           display message box "Inserimento articolo NON
      -    " valido"
                                   title = tit-err
                                   icon 2
                           move 78-ID-ef-art to control-id 
                    not invalid
                        inquire ef-marca,   value in mar-codice
                        if mar-codice not = art-marca-prodotto
                           move art-marca-prodotto to ef-marca-buf 
                                                      mar-codice
                           read tmarche no lock
                                invalid move spaces          to 
           lab-marca-buf
                            not invalid move mar-descrizione to 
           lab-marca-buf
                           end-read
                           display ef-marca lab-marca
                        end-if
                   end-read    
                end-if     
                move art-descrizione to lab-art-buf
                display lab-art
                move art-codice to SaveArticolo
      *               
           end-evaluate.

           if errori
              perform CANCELLA-COLORE
              move CONTROL-ID to STORE-ID        
              move 4          to ACCEPT-CONTROL  
           end-if.

           display form1 
           .
      * <TOTEM:END>

       CAMBIA-FONT-RIGA.
      * <TOTEM:PARA. CAMBIA-FONT-RIGA>
           modify gd-mov(riga), ROW-FONT = Arial8-Occidentale|small-font.
           modify gd-mov, (riga, 1),
                  bitmap        = elemento-bmp,
                  bitmap-number = 1,
                  bitmap-width  = 16.

           move event-data-2 to riga.
           modify gd-mov(riga), ROW-FONT = font-evidenzia-griglia.

           modify gd-mov, (riga, 1),
                  bitmap        = elemento-bmp,
                  bitmap-number = 2,
                  bitmap-width  = 16 
           .
      * <TOTEM:END>

       CHIAMA-MANUTENZIONE.
      * <TOTEM:PARA. CHIAMA-MANUTENZIONE>
           call   "W$MOUSE"     using set-mouse-shape, wait-pointer.

           initialize st-ordforn-linkage.

           move hid-anno  to tof-anno.
           move hid-movim to tof-numero.
           move tof-chiave   to stof-tof-chiave.
           set stof-normale  to true.

           set stof-anteprima   to true

           call   "st-ordforn" using st-ordforn-linkage.
           cancel "st-ordforn".

           call   "W$MOUSE"     using set-mouse-shape, arrow-pointer 
           .
      * <TOTEM:END>

       ORDINE-DA-GRIGLIA.
      * <TOTEM:PARA. ORDINE-DA-GRIGLIA>
           inquire gd-mov(riga, 2), hidden-data in hid-anno.
           inquire gd-mov(riga, 3), hidden-data in hid-movim.

           move riga to como-riga.
           perform CHIAMA-MANUTENZIONE.

           move como-riga to event-data-2.
           modify gd-mov, cursor-y = event-data-2.
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>

       PARAGRAFO-COPY.
      * <TOTEM:PARA. PARAGRAFO-COPY>
           copy "color-custom.cpy".
           copy "calcola-colore-trasparente.cpy".
           copy "riempi-tmp-movmag-ordforn.cpy".
           copy "utydata.cpy".
           copy "common-excel.cpy".
           copy "accetta-num-rec-thin.cpy".

       STATUS-HELP.    |||--> DUMMY. NON TOCCARE
           if StatusHelp = 1
              move BitmapZoomEnabled to BitmapNumZoom
           else
              move BitmapZoomDisabled to BitmapNumZoom
           end-if.
           move StatusHelp to e-cerca.
           modify tool-cerca, enabled = e-cerca.
           modify tool-cerca, bitmap-number = BitmapNumZoom.

       STATUS-BAR-MSG. |||--> DUMMY. NON TOCCARE
           .
      * <TOTEM:END>

       SECCA-TMP.
      * <TOTEM:PARA. SECCA-TMP>
           if FileOpen
              close tmp-movmagforn
              call "C$DELETE" using path-tmp-movmagforn, "I"
              set FileOpen to false
           end-if 
           .
      * <TOTEM:END>

       SPOSTAMENTO.
      * <TOTEM:PARA. SPOSTAMENTO>
           inquire gd-mov, last-row in tot-righe.
           if event-data-2 < 2 move 2 to event-data-2 end-if.
           if event-data-2 > tot-righe move tot-righe to event-data-2 
           end-if.
           if riga not = event-data-2 
              perform CAMBIA-FONT-RIGA
              move event-data-2 to riga
              perform VALORIZZA-LABELS
           end-if 
           .
      * <TOTEM:END>

       VALORIZZA-LABELS.
      * <TOTEM:PARA. VALORIZZA-LABELS>
           inquire gd-mov(riga, 4), hidden-data in GruppoHidden.
           move hid-clifor      to lab-codfor-buf.
           move hid-codice      to lab-codice-buf.
           move hid-ragsoc      to lab-ragsoc-buf.
           move hid-des-prog    to lab-des-prog-buf.
           move hid-ragsoc-des  to lab-dest-buf     
           move hid-citta-des   to lab-citta-buf.
           move hid-cod-marca   to lab-cod-marca-buf.
           move hid-marca       to lab-marca-2-buf.



           display lab-codfor
                   lab-codice
                   lab-ragsoc
                   lab-des-prog
                   lab-citta
                   lab-cod-marca
                   lab-marca-2
                   lab-dest 
           .
      * <TOTEM:END>

      * EVENT PARAGRAPH
       ginqui-Ev-Before-Program.
      * <TOTEM:PARA. ginqui-Ev-Before-Program>
           perform ACCETTA-NUM-REC-THIN.
           perform CALCOLA-COLORE-TRASPARENTE.

      * Verdana10B-Occidentale
           INITIALIZE WFONT-DATA font-evidenzia-griglia
           MOVE 8 TO WFONT-SIZE
           MOVE "Arial" TO WFONT-NAME
           SET WFONT-BOLD TO true
           SET WFONT-ITALIC TO true
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     font-evidenzia-griglia, WFONT-DATA
           move LK-BL-PROG-ID    TO COMO-PROG-ID.

           copy resource "elemento.bmp".
           call "W$BITMAP" using wbitmap-load, "elemento.bmp"
                          giving elemento-bmp 
           .
      * <TOTEM:END>
       ginqui-Ev-After-Program.
      * <TOTEM:PARA. ginqui-Ev-After-Program>
           DESTROY font-evidenzia-griglia.
           perform SECCA-TMP.
           SET LK-BL-CANCELLAZIONE TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           call "W$BITMAP" using wbitmap-destroy, elemento-bmp 
           .
      * <TOTEM:END>
       gd-ordini-Ev-Msg-Begin-Entry.
      * <TOTEM:PARA. gd-ordini-Ev-Msg-Begin-Entry>
           inquire gd-mov, entry-reason in como-x.

           set EVENT-ACTION to EVENT-ACTION-FAIL-TERMINATE.
           evaluate como-x
           when X"00"|doppio click
           when X"0D"|invio
                inquire gd-mov, CURSOR-Y = riga
                set CallManutenzione to true
           end-evaluate 
           .
      * <TOTEM:END>
       gd-ordini-Ev-Msg-Goto-Cell.
      * <TOTEM:PARA. gd-ordini-Ev-Msg-Goto-Cell>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd-ordini-Ev-Msg-Goto-Cell-Mouse.
      * <TOTEM:PARA. gd-ordini-Ev-Msg-Goto-Cell-Mouse>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd-ordini-Ev-Msg-End-Drag.
      * <TOTEM:PARA. gd-ordini-Ev-Msg-End-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd-ordini-Ev-Msg-Begin-Drag.
      * <TOTEM:PARA. gd-ordini-Ev-Msg-Begin-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd-ordini-Ev-Msg-Goto-Cell-Drag.
      * <TOTEM:PARA. gd-ordini-Ev-Msg-Goto-Cell-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       TOOL-CERCA-LinkTo.
      * <TOTEM:PARA. TOOL-CERCA-LinkTo>
           inquire tool-cerca, enabled in e-cerca.
           if e-cerca = 1 perform CERCA end-if 
           .
      * <TOTEM:END>
       ef-cod-BeforeProcedure.
      * <TOTEM:PARA. ef-cod-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-des-BeforeProcedure.
      * <TOTEM:PARA. ef-des-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-marca-BeforeProcedure.
      * <TOTEM:PARA. ef-marca-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-art-BeforeProcedure.
      * <TOTEM:PARA. ef-art-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-cod-AfterProcedure.
      * <TOTEM:PARA. ef-cod-AfterProcedure>
              INQUIRE ef-cod, VALUE IN cli-codice of clienti
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-cod-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
              INQUIRE ef-cliente, VALUE IN cli-codice of clienti1
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-cliente-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-des-AfterProcedure.
      * <TOTEM:PARA. ef-des-AfterProcedure>
              INQUIRE ef-des-forn, VALUE IN desf-codice
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-des-forn-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
              INQUIRE ef-des-cli, VALUE IN des-codice
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-des-cli-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-marca-AfterProcedure.
      * <TOTEM:PARA. ef-marca-AfterProcedure>
              INQUIRE ef-marca, VALUE IN mar-codice
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-marca-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-art-AfterProcedure.
      * <TOTEM:PARA. ef-art-AfterProcedure>
              INQUIRE ef-art, VALUE IN art-codice
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-art-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       pb-ok2-LinkTo.
      * <TOTEM:PARA. pb-ok2-LinkTo>
           perform ORDINE-DA-GRIGLIA 
           .
      * <TOTEM:END>
       ef-data-from-BeforeProcedure.
      * <TOTEM:PARA. ef-data-from-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-data-to-BeforeProcedure.
      * <TOTEM:PARA. ef-data-to-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-data-from-AfterProcedure.
      * <TOTEM:PARA. ef-data-from-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO 
           .
      * <TOTEM:END>
       ef-data-to-AfterProcedure.
      * <TOTEM:PARA. ef-data-to-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO 
           .
      * <TOTEM:END>
       pb-annulla2-BeforeProcedure.
      * <TOTEM:PARA. pb-annulla2-BeforeProcedure>
           modify pb-annulla2, bitmap-number 2
           .
      * <TOTEM:END>
       pb-annulla2-AfterProcedure.
      * <TOTEM:PARA. pb-annulla2-AfterProcedure>
           modify pb-annulla2, bitmap-number 1
           .
      * <TOTEM:END>
       pb-ok2-BeforeProcedure.
      * <TOTEM:PARA. pb-ok2-BeforeProcedure>
           modify pb-ok2, bitmap-number 2
           .
      * <TOTEM:END>
       pb-ok2-AfterProcedure.
      * <TOTEM:PARA. pb-ok2-AfterProcedure>
           modify pb-ok2, bitmap-number 1
           .
      * <TOTEM:END>
       pb-ok-BeforeProcedure.
      * <TOTEM:PARA. pb-ok-BeforeProcedure>
           modify pb-ok, bitmap-number 2 
           .
      * <TOTEM:END>
       pb-ok-AfterProcedure.
      * <TOTEM:PARA. pb-ok-AfterProcedure>
           modify pb-ok, bitmap-number 1 
           .
      * <TOTEM:END>
       pb-ok-LinkTo.
      * <TOTEM:PARA. pb-ok-LinkTo>
           move CONTROL-ID to mem-id.

           perform  varying CONTROL-ID from 78-ID-ef-data-from by 1
                      until CONTROL-ID > 78-ID-ef-art
              perform CONTROLLO
              if errori exit perform end-if
           end-perform.

           if tutto-ok
              modify form1-Handle, visible 0
              perform FORM2-OPEN-ROUTINE                       
              modify form1-Handle, visible 1
              move 78-ID-ef-data-from to CONTROL-ID     
              move 4                  to ACCEPT-CONTROL 
           end-if 
           .
      * <TOTEM:END>
       pb-annulla-BeforeProcedure.
      * <TOTEM:PARA. pb-annulla-BeforeProcedure>
           modify pb-annulla, bitmap-number 2 
           .
      * <TOTEM:END>
       pb-annulla-AfterProcedure.
      * <TOTEM:PARA. pb-annulla-AfterProcedure>
           modify pb-annulla, bitmap-number 1 
           .
      * <TOTEM:END>
       scr-stampa-Cb-1-BeforeProcedure.
      * <TOTEM:PARA. scr-stampa-Cb-1-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           modify chk-excel, bitmap-number = 2 
           .
      * <TOTEM:END>
       scr-stampa-Cb-1-AfterProcedure.
      * <TOTEM:PARA. scr-stampa-Cb-1-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           modify chk-excel, bitmap-number = 1 
           .
      * <TOTEM:END>

      *{TOTEM}END

      *{TOTEM}SHOW-MSG
       MESSAGE-FOR-FILEERROR.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
              MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           .

       SHOW-TRANSACTION-ROUTINE.
           IF TOTEM-TRANSACTION-FLAG = SPACES
              IF TRANSACTION-STATUS NOT = 0
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-1
              END-IF
           ELSE
              PERFORM SHOW-MSG-ROUTINE
              IF TRANSACTION-STATUS = 0
                 MOVE "Transazione terminata con Rollback." TO 
           TOTEM-MSG-3
              ELSE
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-3
              END-IF
           END-IF
           .

       SHOW-MSG-ROUTINE.
           MOVE SPACE TO TOTEM-MSG-1 TOTEM-MSG-2 TOTEM-MSG-3
           EVALUATE TOTEM-MSG-ID
               WHEN "10"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Nessun altro dato." TO TOTEM-MSG-2
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "22"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Chiave Duplicata." TO TOTEM-MSG-2
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "23"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Raggiunta fine file." TO TOTEM-MSG-2
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "101"
                    MOVE "Terminare l'applicazione?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "201"
                    MOVE "Aggiungere un nuovo record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "202"
                    MOVE "Aggiornare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "203"
                    MOVE "Cancellare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "204"
                    MOVE "Chiave duplicata." TO TOTEM-MSG-1
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "301"
                    MOVE "Inserimento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "302"
                    MOVE "Aggiornamento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "303"
                    MOVE "Cancellazione avvenuta con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "401"
                    MOVE "Shell non trovata." TO TOTEM-MSG-1
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN OTHER
                    MOVE TEXT-MESSAGE TO TOTEM-MSG-1
                    STRING "FILE:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-3
                    MOVE 0 TO TOTEM-IDX1
                    INSPECT TOTEM-MSG-3 TALLYING TOTEM-IDX1
                       FOR TRAILING SPACE
                    STRING TOTEM-MSG-3(1:TOTEM-MSG-LENGTH - 
           TOTEM-IDX1), 
                       ", FILE STATUS ", PRIMARY-ERROR "," 
                       SECONDARY-ERROR
                    DELIMITED BY SIZE INTO TOTEM-MSG-2
                    MOVE SPACES TO TOTEM-MSG-3
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
           END-EVALUATE
           PERFORM MESSAGE-BOX-ROUTINE
           .

       MESSAGE-BOX-ROUTINE.
           MOVE 1 TO TOTEM-MSG-TEXT-POINTER
           IF TOTEM-MSG-1 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-1 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              STRING TOTEM-MSG-1( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                 DELIMITED BY SIZE
                 INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-2 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-2 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-2( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-3 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-3 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-3( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-TEXT-POINTER = 1
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-TEXT TALLYING TOTEM-MSG-SIZE FOR 
           TRAILING SPACE
                  COMPUTE TOTEM-MSG-TEXT-POINTER = 
           TOTEM-MSG-FULL-LENGTH - TOTEM-MSG-SIZE + 1
           END-IF
           MOVE LOW-VALUES TO TOTEM-MSG-TEXT(TOTEM-MSG-TEXT-POINTER : 1 
           )
           .

       MESSAGE-BOX-DISPLAY.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

      *{TOTEM}END

