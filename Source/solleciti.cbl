      *{TOTEM}PRG-COMMENT
      * solleciti.Cbl
      * solleciti.Cbl is generated by TOTEM
      * This is a generated file. DO NOT modify this file directly.
      *{TOTEM}END
       IDENTIFICATION       DIVISION.
      *{TOTEM}PRGID
       PROGRAM-ID.          solleciti.
       AUTHOR.              andre.
       DATE-WRITTEN.        martedì 11 aprile 2023 17:56:17.
       REMARKS.
      *{TOTEM}END

       ENVIRONMENT          DIVISION.
       CONFIGURATION        SECTION.
       SPECIAL-NAMES.
      *{TOTEM}SPECIAL-NAME
      * <TOTEM:EPT. INIT:solleciti, INIT:solleciti, SpecialName>
      * <TOTEM:END>
      *{TOTEM}END
      *{TOTEM}ACTIVEX-DEF
      *{TOTEM}END
      *{TOTEM}DECIMAL-POINT
           DECIMAL-POINT IS COMMA.
      *{TOTEM}END

       INPUT-OUTPUT         SECTION.
       FILE-CONTROL.
      *{TOTEM}FILE-CONTROL
           COPY "agenti.sl".
           COPY "tordini.sl".
           COPY "mtordini.sl".
           COPY "mrordini.sl".
           COPY "articoli.sl".
           COPY "destini.sl".
           COPY "tescons.sl".
           COPY "clienti.sl".
           COPY "tvettori.sl".
           COPY "rordini.sl".
           COPY "tpromo.sl".
           COPY "tmp-sol.sl"
                REPLACING ==tmp-sol== BY ==tmp-sol1==,
                          ==status-tmp-solleciti-m== BY 
           ==status-tmp-sol1leciti-m==
                .
           COPY "tmp-sol.sl".
           COPY "tmp-sol.sl"
                REPLACING ==tmp-sol== BY ==tmp-sol2==,
                          ==status-tmp-solleciti-m== BY 
           ==status-tmp-sol2leciti-m==
                .
           COPY "tmp-ordf-art.sl".
           COPY "tordforn.sl".
           COPY "rordforn.sl".
           COPY "tgrupgdo.sl".
           COPY "sordforn.sl".
           COPY "tcaumag.sl".
           COPY "ttipocli.sl".
      *{TOTEM}END
       DATA                 DIVISION.
       FILE                 SECTION.
      *{TOTEM}FILE
           COPY "agenti.fd".
           COPY "tordini.fd".
           COPY "mtordini.fd".
           COPY "mrordini.fd".
           COPY "articoli.fd".
           COPY "destini.fd".
           COPY "tescons.fd".
           COPY "clienti.fd".
           COPY "tvettori.fd".
           COPY "rordini.fd".
           COPY "tpromo.fd".
           COPY "tmp-sol.fd"
                REPLACING ==tmp-sol== BY ==tmp-sol1==,
                          ==status-tmp-solleciti-m== BY 
           ==status-tmp-sol1leciti-m==
                .
           COPY "tmp-sol.fd".
           COPY "tmp-sol.fd"
                REPLACING ==tmp-sol== BY ==tmp-sol2==,
                          ==status-tmp-solleciti-m== BY 
           ==status-tmp-sol2leciti-m==
                .
           COPY "tmp-ordf-art.fd".
           COPY "tordforn.fd".
           COPY "rordforn.fd".
           COPY "tgrupgdo.fd".
           COPY "sordforn.fd".
           COPY "tcaumag.fd".
           COPY "ttipocli.fd".
      *{TOTEM}END

       WORKING-STORAGE      SECTION.
      *{TOTEM}ACU-DEF
               COPY "acugui.def".
               COPY "acucobol.def".
               COPY "fonts.def".
               COPY "crtvars.def".
               COPY "showmsg.def".
               COPY "totem.def".
               COPY "standard.def".
      *{TOTEM}END

      *{TOTEM}COPY-WORKING
      * Key Status
       77 Key-Status IS SPECIAL-NAMES CRT STATUS PIC 9(5) VALUE 0.
          88 Enter-Pushed VALUE 13.
          88 Exit-Pushed VALUE 27.
          88 Message-Received VALUE 95.
          88 Event-Occurred VALUE 96.
          88 Screen-No-Input-Field VALUE 97.
          88 Screen-Time-Out VALUE 99.
      * Properties & User defined Working Stoarge
       77 Small-Font
                  USAGE IS HANDLE OF FONT SMALL-FONT.
           COPY  "LINK-INVIO-SOL.DEF".
           COPY  "EXTERNALS.DEF".
           COPY  "LINK-STFATT.DEF".
           COPY  "SPLCRT2GRAF.LKS".
           COPY  "LINK-STORDCP.DEF".
           COPY  "LINK-STBOLLE.DEF".
           COPY  "LINK-STSOLLECITI.DEF".
           COPY  "COLOR-STATO-M.DEF".
       77 STATUS-tordini   PIC  X(2).
           88 Valid-STATUS-tordini VALUE IS "00" THRU "09". 
       77 Default-Font
                  USAGE IS HANDLE OF FONT DEFAULT-FONT.
       77 Form1-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 TITOLO           PIC  X(100)
                  VALUE IS "GESLUX - Solleciti".
       77 como-x           PIC  x.
       77 num  PIC  9.
       77 mese-esteso      PIC  x(15).
       77 NomeFile         PIC  x(10).
       77 PathPod          PIC  x(256).
       77 FilePod          PIC  x(256).
       77 mese PIC  99.
       77 riga-padre       PIC  9(5).
       77 riga-figlio      PIC  9(5).
       77 status-code
                  USAGE IS SIGNED-SHORT.
       77 data-num         PIC  9(8).
       77 como-data-1      PIC  9(8).
       77 como-data-2      PIC  9(8).
       77 num-screen       PIC  9.
       77 num-evasioni     PIC  999.
       77 tot-evasa        PIC  9(10).
       77 multi-s-bmp
                  USAGE IS HANDLE OF BITMAP.
       77 invio-sol-bmp
                  USAGE IS HANDLE OF BITMAP.
       77 bloccato-bmp
                  USAGE IS HANDLE OF BITMAP.
       77 bloccato-REG-bmp
                  USAGE IS HANDLE OF BITMAP.
       77 bloccato-LAV-bmp
                  USAGE IS HANDLE OF BITMAP.
       77 bloccato-SP-bmp
                  USAGE IS HANDLE OF BITMAP.
       77 bloccato-ST-bmp
                  USAGE IS HANDLE OF BITMAP.
       77 bloccato-FT-bmp
                  USAGE IS HANDLE OF BITMAP.
       77 bloccato-FP-bmp
                  USAGE IS HANDLE OF BITMAP.
       77 bloccato-CHIUSO-bmp
                  USAGE IS HANDLE OF BITMAP.
       77 old-gdo-buf      PIC  x(5).
       77 como-esito       PIC  x(20).
       77 colore           PIC  999.
       77 codice-x         PIC  x(6).
       77 tpr-codice-x     PIC  x(15).
       77 save-stato       PIC  x(10).
       77 tot-idx-art      PIC  9(5).
       77 evasioni-valide  PIC  9(5).
       77 articoli-validi  PIC  9(5).
       01 FILLER           PIC  9.
           88 riga-chiusa VALUE IS 1    WHEN SET TO FALSE  0. 
       77 como-evasa       PIC  9(8).
       77 FILLER           PIC  9.
           88 RiepilogoOrdini VALUE IS 1    WHEN SET TO FALSE  0. 
       77 hid-articolo     PIC  9(6).
       01 hid-documenti.
           05 hid-eva.
               10 hid-anno-e       PIC  9(4).
               10 hid-num-e        PIC  9(8).
           05 hid-bolla.
               10 hid-anno-b       PIC  9(4).
               10 hid-num-b        PIC  9(8).
           05 hid-fattura.
               10 hid-anno-f       PIC  9(4).
               10 hid-num-f        PIC  9(8).
       78 78-tutti-vol VALUE IS "Tutti i volantini". 
       01 FILLER           PIC  9
                  VALUE IS 0.
           88 StampaEvasione VALUE IS 1    WHEN SET TO FALSE  0. 
           88 StampaBolla VALUE IS 2    WHEN SET TO FALSE  0. 
           88 StampaFattura VALUE IS 3    WHEN SET TO FALSE  0. 
           88 StampaPOD VALUE IS 4    WHEN SET TO FALSE  0. 
           88 InvioSol VALUE IS 5    WHEN SET TO FALSE  0. 
       01 FILLER           PIC  9
                  VALUE IS 0.
           88 CheckPressed VALUE IS 1    WHEN SET TO FALSE  0. 
       01 FILLER           PIC  9.
           88 valuta VALUE IS 1    WHEN SET TO FALSE  0. 
           88 annulla VALUE IS 2    WHEN SET TO FALSE  0. 
       01 FILLER           PIC  9.
           88 scelta-articoli VALUE IS 1    WHEN SET TO FALSE  0. 
       01 FILLER           PIC  9.
           88 filtra-evasioni VALUE IS 1    WHEN SET TO FALSE  0. 
       01 FILLER           PIC  9.
           88 FromFile VALUE IS 1    WHEN SET TO FALSE  0. 
           88 FromGrid VALUE IS 2    WHEN SET TO FALSE  0. 
       01 FILLER           PIC  9.
           88 trovata-riga VALUE IS 1    WHEN SET TO FALSE  0. 
       01 tab-presenti.
           05 el-chiave
                      OCCURS 10000 TIMES
                      INDEXED  idx-presenti.
               10 el-anno          PIC  9(4).
               10 el-numero        PIC  9(8).
       01 tab-articoli.
           05 el-art           PIC  9(6)
                      OCCURS 10000 TIMES
                      INDEXED  idx-art.
       01 old-tab-articoli.
           05 old-el-art       PIC  9(6)
                      OCCURS 10000 TIMES.
       01 FILLER           PIC  9.
           88 evasa-tutto VALUE IS 1    WHEN SET TO FALSE  0. 
       77 save-blocco      PIC  x.
           88 save-blocco-si VALUE IS "S". 
           88 save-blocco-no VALUE IS "N". 
       01 FILLER           PIC  9.
           88 sostituito VALUE IS 1    WHEN SET TO FALSE  0. 
       01 FILLER           PIC  9.
           88 ActionGrid VALUE IS 1    WHEN SET TO FALSE  0. 
       01 gd-hidden.
           05 hid-tipo         PIC  x.
               88 hid-padre VALUE IS "P". 
               88 hid-figlio VALUE IS "F". 
           05 hid-OpenClose    PIC  x.
               88 hid-close VALUE IS "C". 
               88 hid-open VALUE IS "O". 
           05 hid-chiave.
               10 hid-anno         PIC  9(4).
               10 hid-numero       PIC  9(8).
           05 hid-data-ordine  PIC  9(8).
           05 hid-chiave-eva.
               10 hid-anno-eva     PIC  9(4).
               10 hid-numero-eva   PIC  9(8).
               10 hid-riga-eva     PIC  9(8).
       01 rec-gd-art.
           05 cod-art          PIC  z(6).
           05 des-art          PIC  x(40).
       01 k    PIC  9.
           88 k-agente VALUE IS 1. 
           88 k-clides VALUE IS 2. 
           88 k-gdo VALUE IS 3. 
           88 k-tipo VALUE IS 4. 
       77 OK-73X21-BMP     PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 CANCEL-73X21-BMP PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 Form1-Tb-1-Handlea
                  USAGE IS HANDLE OF WINDOW.
       77 toolbar-bmp      PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 E-ESCI           PIC  9
                  VALUE IS 1.
       77 E-CERCA          PIC  9
                  VALUE IS 0.
       77 AUTO-ID          PIC  9(6)
                  VALUE IS 1002.
       01 filler           PIC  9.
           88 ApriRighe VALUE IS 1,    WHEN SET TO FALSE  0. 
       01 filler           PIC  9.
           88 record-ok VALUE IS 1,    WHEN SET TO FALSE  0. 
       77 STATUS-clienti   PIC  X(2).
           88 Valid-STATUS-clienti VALUE IS "00" THRU "09". 
       77 BLUE-DA-28X24-BMP            PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 BLUE-FINO-28X24-BMP          PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 ef-cli-buf       PIC  9(5).
       77 ef-dest-buf      PIC  9(5).
       77 ef-data-from-buf PIC  99/99/9999.
       77 ef-data-to-buf   PIC  99/99/9999.
       77 lab-dest-buf     PIC  x(50).
       77 lab-cli-buf      PIC  x(50).
       77 STATUS-destini   PIC  X(2).
           88 Valid-STATUS-destini VALUE IS "00" THRU "09". 
       77 BOTTONE-CANCEL-BMP           PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 BOTTONE-OK-BMP   PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 Verdana12BI-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 path-tmp-solleciti-m         PIC  X(256).
       77 status-tmp-solleciti-m       PIC  X(2).
           88 Valid-status-tmp-solleciti-m VALUE IS "00" THRU "09". 
       77 STATUS-tescons   PIC  X(2).
           88 Valid-STATUS-tescons VALUE IS "00" THRU "09". 
       77 STATUS-agenti    PIC  X(2).
           88 Valid-STATUS-agenti VALUE IS "00" THRU "09". 
       77 STATUS-articoli  PIC  X(2).
           88 Valid-STATUS-articoli VALUE IS "00" THRU "09". 
       77 ef-age-buf       PIC  9(5).
       77 lab-age-buf      PIC  x(50).
       77 ef-art-buf       PIC  9(5).
       77 STATUS-mrordini  PIC  X(2).
           88 Valid-STATUS-mrordini VALUE IS "00" THRU "09". 
       77 STATUS-mtordini  PIC  X(2).
           88 Valid-STATUS-mtordini VALUE IS "00" THRU "09". 
       77 STATUS-tvettori  PIC  X(2).
           88 Valid-STATUS-tvettori VALUE IS "00" THRU "09". 
       77 scr-elab-SF-HANDLE
                  USAGE IS HANDLE OF WINDOW.
       77 scr-ordini-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 Screen1-Pg-2-Visible         PIC  9
                  VALUE IS 0.
       77 Verdana10-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 chk-reg-buf      PIC  9
                  VALUE IS 1.
       77 chk-il-buf       PIC  9
                  VALUE IS 1.
       77 chk-sp-buf       PIC  9
                  VALUE IS 1.
       77 chk-st-buf       PIC  9
                  VALUE IS 1.
       77 chk-fp-buf       PIC  9
                  VALUE IS 1.
       77 chk-ft-buf       PIC  9
                  VALUE IS 1.
       77 chk-chiuso-buf   PIC  9
                  VALUE IS 1.
       77 Verdana10B-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 ini-vol          PIC  99/99/9999.
       77 fine-vol         PIC  99/99/9999.
       77 lab-dest-m-buf   PIC  x(50)
                  VALUE IS "<<HELP>> 0 = Tutti i destini del Cliente".
       77 lab-cli-m-buf    PIC  x(50).
       77 Arial8-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 lab-descr-buf    PIC  X(100).
       77 lab-descr2-buf   PIC  X(100).
       77 lab-descr3-buf   PIC  X(100).
       01 save-chiave.
           10 save-data        PIC  9(8).
           10 save-ordine.
               15 save-anno        PIC  9(4).
               15 save-numero      PIC  9(8).
           10 save-prog-art    PIC  9(8).
           10 save-prog-eva    PIC  9(8).
           10 save-tipo        PIC  9.
               88 save-testa VALUE IS 1. 
               88 save-evasione VALUE IS 2. 
       01 rec-grid.
           05 col-nulla        PIC  x.
           05 col-num          PIC  z(5).
           05 col-clides       PIC  x(40).
           05 col-localita     PIC  x(40).
           05 col-ord-cli      PIC  x(50).
           05 col-data-ord     PIC  x(10).
           05 col-stato        PIC  x(10).
           05 col-nr-e         PIC  z(8).
           05 col-data-e       PIC  x(8).
           05 col-nr-b         PIC  z(8).
           05 col-data-b       PIC  x(8).
           05 col-nr-f         PIC  z(8).
           05 col-data-f       PIC  x(8).
           05 col-pod          PIC  x(6).
           05 col-esito        PIC  x(30).
           05 col-invio        PIC  s9.
       77 como-numero      PIC  9(8).
       77 como-data-x8     PIC  x(8).
       77 scr-elab-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 Arial8B-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 cbo-promo-buf    PIC  x(100).
       77 STATUS-rordini   PIC  X(2).
           88 Valid-STATUS-rordini VALUE IS "00" THRU "09". 
       77 STATUS-tpromo    PIC  X(2).
           88 Valid-STATUS-tpromo VALUE IS "00" THRU "09". 
       78 78-tutti VALUE IS "*". 
       01 cbo-esito-buf    PIC  X(20).
       01 cbo-vett-buf     PIC  X(3).
       01 cbo-data-f-buf   PIC  X(8).
       01 cbo-num-f-buf    PIC  z(8).
       01 cbo-data-b-buf   PIC  x(8).
       01 cbo-num-b-buf    PIC  z(8).
       01 cbo-data-e-buf   PIC  x(8).
       01 cbo-num-e-buf    PIC  z(8).
       01 cbo-stato-buf    PIC  X(10).
       01 cbo-data-buf     PIC  x(10).
       01 cbo-numord-buf   PIC  X(50).
       01 cbo-loca-buf     PIC  X(40).
       01 cbo-clides-buf   PIC  X(40).
       01 cbo-num-buf      PIC  z(5).
       77 status-tmp-sol1leciti-m      PIC  X(2).
           88 VALID-status-tmp-sol1leciti-m VALUE IS "00" THRU "09". 
       01 OLD-lab-esito-buf            PIC  X(20).
       01 OLD-lab-vett-buf PIC  X(3).
       01 OLD-lab-data-f-buf           PIC  X(8).
       01 OLD-lab-num-f-buf            PIC  z(8).
       01 OLD-lab-data-b-buf           PIC  x(8).
       01 OLD-lab-num-b-buf            PIC  z(8).
       01 OLD-lab-data-e-buf           PIC  x(8).
       01 OLD-lab-num-e-buf            PIC  z(8).
       01 OLD-lab-stato-buf            PIC  X(10).
       01 OLD-lab-data-buf PIC  x(10).
       01 OLD-lab-numord-buf           PIC  X(12).
       01 OLD-lab-loca-buf PIC  X(40).
       01 OLD-lab-clides-buf           PIC  X(40).
       01 OLD-lab-num-buf  PIC  z(5).
       01 OLD-cbo-promo-buf            PIC  X(100).
       77 status-tmp-sol11leciti-m     PIC  X(2).
           88 VALID-status-tmp-sol11leciti-m VALUE IS "00" THRU "09". 
       77 status-tmp-sol2leciti-m      PIC  X(2).
           88 VALID-status-tmp-sol2leciti-m VALUE IS "00" THRU "09". 
       77 lab-esito-buf    PIC  X(20).
       77 lab-vett-buf     PIC  X(3).
       77 lab-data-f-buf   PIC  X(8).
       77 lab-num-f-buf    PIC  z(8).
       77 lab-data-b-buf   PIC  X(8).
       77 lab-num-b-buf    PIC  z(8).
       77 lab-data-e-buf   PIC  X(10).
       77 lab-num-e-buf    PIC  z(8).
       77 lab-stato-buf    PIC  X(10).
       77 lab-data-buf     PIC  X(8).
       77 lab-numord-buf   PIC  X(50).
       77 lab-loca-buf     PIC  X(40).
       77 lab-clides-buf   PIC  X(40).
       77 lab-num-buf      PIC  z(5).
       77 lab-num-val      PIC  z(5).
       77 tot-idx-num      PIC  9(5).
       77 tot-idx-num-b    PIC  9(5).
       77 tot-idx-num-f    PIC  9(5).
       77 tot-idx-num-e    PIC  9(5).
       77 tot-idx-data     PIC  9(5).
       77 tot-idx-data-e   PIC  9(5).
       77 tot-idx-data-b   PIC  9(5).
       77 tot-idx-data-f   PIC  9(5).
       77 tot-idx-clides   PIC  9(5).
       77 tot-idx-loca     PIC  9(5).
       77 tot-idx-esito    PIC  9(5).
       77 tot-idx-stato    PIC  9(5).
       77 tot-idx-vett     PIC  9(5).
       77 tot-idx-numord   PIC  9(5).
       77 tot-idx-promo    PIC  9(5).
       77 Form1-Tb-1-Handleaa
                  USAGE IS HANDLE OF WINDOW.
       01 tab1.
           05 cbo-esito-val    PIC  X(20)
                      OCCURS 10000 TIMES
                      INDEXED  idx-esito.
       01 tab2.
           05 cbo-vett-val     PIC  X(3)
                      OCCURS 10000 TIMES
                      INDEXED  idx-vett.
       01 tab3.
           05 cbo-data-f-val   PIC  X(8)
                      OCCURS 10000 TIMES
                      INDEXED  idx-data-f.
       01 tab4.
           05 cbo-num-f-val    PIC  z(8)
                      OCCURS 10000 TIMES
                      INDEXED  idx-num-f.
       01 tab5.
           05 cbo-data-b-val   PIC  x(8)
                      OCCURS 10000 TIMES
                      INDEXED  idx-data-b.
       01 tab6.
           05 cbo-num-b-val    PIC  z(8)
                      OCCURS 10000 TIMES
                      INDEXED  idx-num-b.
       01 tab7.
           05 cbo-data-e-val   PIC  x(8)
                      OCCURS 10000 TIMES
                      INDEXED  idx-data-e.
       01 tab8.
           05 cbo-num-e-val    PIC  z(8)
                      OCCURS 10000 TIMES
                      INDEXED  idx-num-e.
       01 tab9.
           05 cbo-stato-val    PIC  X(10)
                      OCCURS 10000 TIMES
                      INDEXED  idx-stato.
       01 tab10.
           05 cbo-data-val     PIC  x(10)
                      OCCURS 10000 TIMES
                      INDEXED  idx-data.
       01 tab11.
           05 cbo-numord-val   PIC  X(10)
                      OCCURS 10000 TIMES
                      INDEXED  idx-numord.
       01 tab12.
           05 cbo-loca-val     PIC  X(40)
                      OCCURS 10000 TIMES
                      INDEXED  idx-loca.
       01 tab13.
           05 cbo-clides-val   PIC  X(40)
                      OCCURS 10000 TIMES
                      INDEXED  idx-clides.
       01 tab14.
           05 cbo-num-val      PIC  z(5)
                      OCCURS 10000 TIMES
                      INDEXED  idx-num.
       01 tab15.
           05 cbo-promo-val    PIC  x(100)
                      OCCURS 10000 TIMES
                      INDEXED  idx-promo.
       77 lab-art-buf      PIC  x(50).
       77 e-destini        PIC  9
                  VALUE IS 0.
       77 FILLER           PIC  9
                  VALUE IS 1.
           88 tutti-stati VALUE IS 1    WHEN SET TO FALSE  0. 
       77 path-tmp-ordf-art            PIC  x(256).
       01 file-info.
           05 file-size        PIC  X(8)
                      USAGE IS COMP-X.
           05 file-date        PIC  9(8)
                      USAGE IS COMP-X.
           05 file-time        PIC  9(8)
                      USAGE IS COMP-X.
       77 STATUS-tmp-ordf-art          PIC  X(2).
           88 Valid-STATUS-tmp-ordf-art VALUE IS "00" THRU "09". 
       77 STATUS-rordforn  PIC  X(2).
           88 Valid-STATUS-rordforn VALUE IS "00" THRU "09". 
       77 STATUS-tordforn  PIC  X(2).
           88 Valid-STATUS-tordforn VALUE IS "00" THRU "09". 
       77 ef-gdo-buf       PIC  x(5).
       77 STATUS-tgrupgdo  PIC  X(2).
           88 Valid-STATUS-tgrupgdo VALUE IS "00" THRU "09". 
       77 lab-gdo-buf      PIC  x(50).
       77 MS-Sans-Serif9BU-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 STATUS-sordforn  PIC  X(2).
           88 Valid-STATUS-sordforn VALUE IS "00" THRU "09". 
       77 Arial8U-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 Arial8BU-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 STATUS-tcaumag   PIC  X(2).
           88 Valid-STATUS-tcaumag VALUE IS "00" THRU "09". 
       77 lab-tipo-buf     PIC  x(50).
       77 STATUS-ttipocli  PIC  X(2).
           88 Valid-STATUS-ttipocli VALUE IS "00" THRU "09". 
       77 ef-tipo-buf      PIC  x(2).
       77 STATUS-stato-invio           PIC  X(2).
           88 Valid-STATUS-stato-invio VALUE IS "00" THRU "09". 
       77 excel-bmp        PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 Verdana14I-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 tit-elab         PIC  X(30).

      ***********************************************************
      *   Code Gen's Buffer                                     *
      ***********************************************************
       77 Screen1-Ta-1-TAB-VALUE  PIC  99  VALUE 1.
       78 KEY-KT-VALUE   VALUE 32001.
       78 KEY-KB-VALUE   VALUE 32002.
       77 STATUS-Form1-FLAG-REFRESH PIC  9.
          88 Form1-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 STATUS-scr-elab-FLAG-REFRESH PIC  9.
          88 scr-elab-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 STATUS-scr-ordini-FLAG-REFRESH PIC  9.
          88 scr-ordini-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 TMP-scr-ordini-KEY1-ORDER  PIC X VALUE "A".
       77 TMP-scr-ordini-mtordini-RESTOREBUF  PIC X(2122).
       77 TMP-scr-ordini-KEYIS  PIC 9(3) VALUE 1.
       77 scr-ordini-MULKEY-TMPBUF   PIC X(2122).
       77 STATUS-scr-excel-FLAG-REFRESH PIC  9.
          88 scr-excel-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 TMP-DataSet1-agenti-BUF     PIC X(1233).
       77 TMP-DataSet1-tordini-BUF     PIC X(3938).
       77 TMP-DataSet1-mtordini-BUF     PIC X(2122).
       77 TMP-DataSet1-mrordini-BUF     PIC X(891).
       77 TMP-DataSet1-articoli-BUF     PIC X(3669).
       77 TMP-DataSet1-destini-BUF     PIC X(3676).
       77 TMP-DataSet1-tescons-BUF     PIC X(226).
       77 TMP-DataSet1-clienti-BUF     PIC X(3610).
       77 TMP-DataSet1-tvettori-BUF     PIC X(1847).
       77 TMP-DataSet1-rordini-BUF     PIC X(667).
       77 TMP-DataSet1-tpromo-BUF     PIC X(263).
       77 TMP-DataSet1-tmp-sol1-BUF     PIC X(480).
       77 TMP-DataSet1-tmp-sol-BUF     PIC X(480).
       77 TMP-DataSet1-tmp-sol2-BUF     PIC X(480).
       77 TMP-DataSet1-tmp-ordf-art-BUF     PIC X(113).
       77 TMP-DataSet1-tordforn-BUF     PIC X(556).
       77 TMP-DataSet1-rordforn-BUF     PIC X(544).
       77 TMP-DataSet1-tgrupgdo-BUF     PIC X(1206).
       77 TMP-DataSet1-sordforn-BUF     PIC X(1139).
       77 TMP-DataSet1-tcaumag-BUF     PIC X(254).
       77 TMP-DataSet1-ttipocli-BUF     PIC X(889).
      * VARIABLES FOR RECORD LENGTH.
       77  TotemFdSlRecordClearOffset   PIC 9(5) COMP-4.
       77  TotemFdSlRecordLength        PIC 9(5) COMP-4.
      * FILE'S LOCK MODE FLAG
       77 DataSet1-agenti-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-agenti-LOCK  VALUE "Y".
       77 DataSet1-agenti-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-agenti-KEY-Asc  VALUE "A".
          88 DataSet1-agenti-KEY-Desc VALUE "D".
       77 DataSet1-tordini-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tordini-LOCK  VALUE "Y".
       77 DataSet1-tordini-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tordini-KEY-Asc  VALUE "A".
          88 DataSet1-tordini-KEY-Desc VALUE "D".
       77 DataSet1-mtordini-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-mtordini-LOCK  VALUE "Y".
       77 DataSet1-KEYIS   PIC 9(3) VALUE 1.
       77 DataSet1-mtordini-KEY1-ORDER  PIC X VALUE "A".
          88 DataSet1-mtordini-KEY1-Asc  VALUE "A".
          88 DataSet1-mtordini-KEY1-Desc VALUE "D".
       77 DataSet1-mrordini-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-mrordini-LOCK  VALUE "Y".
       77 DataSet1-mrordini-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-mrordini-KEY-Asc  VALUE "A".
          88 DataSet1-mrordini-KEY-Desc VALUE "D".
       77 DataSet1-articoli-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-articoli-LOCK  VALUE "Y".
       77 DataSet1-articoli-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-articoli-KEY-Asc  VALUE "A".
          88 DataSet1-articoli-KEY-Desc VALUE "D".
       77 DataSet1-destini-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-destini-LOCK  VALUE "Y".
       77 DataSet1-destini-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-destini-KEY-Asc  VALUE "A".
          88 DataSet1-destini-KEY-Desc VALUE "D".
       77 DataSet1-tescons-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tescons-LOCK  VALUE "Y".
       77 DataSet1-tescons-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tescons-KEY-Asc  VALUE "A".
          88 DataSet1-tescons-KEY-Desc VALUE "D".
       77 DataSet1-clienti-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-clienti-LOCK  VALUE "Y".
       77 DataSet1-clienti-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-clienti-KEY-Asc  VALUE "A".
          88 DataSet1-clienti-KEY-Desc VALUE "D".
       77 DataSet1-tvettori-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tvettori-LOCK  VALUE "Y".
       77 DataSet1-tvettori-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tvettori-KEY-Asc  VALUE "A".
          88 DataSet1-tvettori-KEY-Desc VALUE "D".
       77 DataSet1-rordini-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-rordini-LOCK  VALUE "Y".
       77 DataSet1-rordini-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-rordini-KEY-Asc  VALUE "A".
          88 DataSet1-rordini-KEY-Desc VALUE "D".
       77 DataSet1-tpromo-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tpromo-LOCK  VALUE "Y".
       77 DataSet1-tpromo-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tpromo-KEY-Asc  VALUE "A".
          88 DataSet1-tpromo-KEY-Desc VALUE "D".
       77 DataSet1-tmp-sol1-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tmp-sol1-LOCK  VALUE "Y".
       77 DataSet1-tmp-sol1-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tmp-sol1-KEY-Asc  VALUE "A".
          88 DataSet1-tmp-sol1-KEY-Desc VALUE "D".
       77 DataSet1-tmp-sol-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tmp-sol-LOCK  VALUE "Y".
       77 DataSet1-tmp-sol-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tmp-sol-KEY-Asc  VALUE "A".
          88 DataSet1-tmp-sol-KEY-Desc VALUE "D".
       77 DataSet1-tmp-sol2-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tmp-sol2-LOCK  VALUE "Y".
       77 DataSet1-tmp-sol2-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tmp-sol2-KEY-Asc  VALUE "A".
          88 DataSet1-tmp-sol2-KEY-Desc VALUE "D".
       77 DataSet1-tmp-ordf-art-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tmp-ordf-art-LOCK  VALUE "Y".
       77 DataSet1-tmp-ordf-art-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tmp-ordf-art-KEY-Asc  VALUE "A".
          88 DataSet1-tmp-ordf-art-KEY-Desc VALUE "D".
       77 DataSet1-tordforn-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tordforn-LOCK  VALUE "Y".
       77 DataSet1-tordforn-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tordforn-KEY-Asc  VALUE "A".
          88 DataSet1-tordforn-KEY-Desc VALUE "D".
       77 DataSet1-rordforn-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-rordforn-LOCK  VALUE "Y".
       77 DataSet1-rordforn-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-rordforn-KEY-Asc  VALUE "A".
          88 DataSet1-rordforn-KEY-Desc VALUE "D".
       77 DataSet1-tgrupgdo-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tgrupgdo-LOCK  VALUE "Y".
       77 DataSet1-tgrupgdo-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tgrupgdo-KEY-Asc  VALUE "A".
          88 DataSet1-tgrupgdo-KEY-Desc VALUE "D".
       77 DataSet1-sordforn-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-sordforn-LOCK  VALUE "Y".
       77 DataSet1-sordforn-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-sordforn-KEY-Asc  VALUE "A".
          88 DataSet1-sordforn-KEY-Desc VALUE "D".
       77 DataSet1-tcaumag-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tcaumag-LOCK  VALUE "Y".
       77 DataSet1-tcaumag-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tcaumag-KEY-Asc  VALUE "A".
          88 DataSet1-tcaumag-KEY-Desc VALUE "D".
       77 DataSet1-ttipocli-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-ttipocli-LOCK  VALUE "Y".
       77 DataSet1-ttipocli-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-ttipocli-KEY-Asc  VALUE "A".
          88 DataSet1-ttipocli-KEY-Desc VALUE "D".

       77 tordini-k-causale-SPLITBUF  PIC X(17).
       77 tordini-k1-SPLITBUF  PIC X(23).
       77 tordini-k2-SPLITBUF  PIC X(21).
       77 tordini-k-bolla-SPLITBUF  PIC X(13).
       77 tordini-k3-SPLITBUF  PIC X(22).
       77 tordini-k-fattura-SPLITBUF  PIC X(13).
       77 tordini-k4-SPLITBUF  PIC X(30).
       77 tordini-k-contab-SPLITBUF  PIC X(14).
       77 tordini-k-tipo-SPLITBUF  PIC X(14).
       77 tordini-k-data-SPLITBUF  PIC X(17).
       77 tordini-k-agfatt-SPLITBUF  PIC X(42).
       77 tordini-k-stbolle-SPLITBUF  PIC X(34).
       77 tordini-k-andamento-data-SPLITBUF  PIC X(10).
       77 tordini-k-andamento-cliente-SPLITBUF  PIC X(15).
       77 tordini-k-andamento-clides-SPLITBUF  PIC X(20).
       77 tordini-k-promo-SPLITBUF  PIC X(29).
       77 tordini-k-or-SPLITBUF  PIC X(61).
       77 tordini-k-tor-inviare-SPLITBUF  PIC X(14).
       77 tordini-k-tor-tipocli-SPLITBUF  PIC X(25).
       77 tordini-k-tor-gdo-SPLITBUF  PIC X(28).
       77 mtordini-mto-k-ord-cli-SPLITBUF  PIC X(55).
       77 mtordini-mto-k-data-SPLITBUF  PIC X(21).
       77 mtordini-mto-k-clides-SPLITBUF  PIC X(19).
       77 mtordini-mto-k-age-SPLITBUF  PIC X(14).
       77 mtordini-k-mto-stato-sel-SPLITBUF  PIC X(15).
       77 mtordini-k-mto-stato-SPLITBUF  PIC X(14).
       77 mtordini-mto-k-gdo-SPLITBUF  PIC X(26).
       77 mtordini-mto-k-bloc-SPLITBUF  PIC X(20).
       77 mtordini-k-giang-SPLITBUF  PIC X(21).
       77 mtordini-mto-k-promo-SPLITBUF  PIC X(25).
       77 mrordini-mro-k-promo-SPLITBUF  PIC X(33).
       77 mrordini-mro-k-articolo-SPLITBUF  PIC X(24).
       77 mrordini-mro-k-progr-SPLITBUF  PIC X(18).
       77 mrordini-mro-k-tprev-SPLITBUF  PIC X(39).
       77 mrordini-mro-k-ord-art-SPLITBUF  PIC X(19).
       77 articoli-art-k1-SPLITBUF  PIC X(51).
       77 articoli-art-k-frn-SPLITBUF  PIC X(16).
       77 destini-K1-SPLITBUF  PIC X(111).
       77 destini-k-localita-SPLITBUF  PIC X(36).
       77 clienti-cli-K1-SPLITBUF  PIC X(47).
       77 clienti-cli-K3-SPLITBUF  PIC X(12).
       77 clienti-cli-K4-SPLITBUF  PIC X(8).
       77 tvettori-k-des-SPLITBUF  PIC X(41).
       77 rordini-ror-k-promo-SPLITBUF  PIC X(16).
       77 rordini-ror-k-articolo-SPLITBUF  PIC X(24).
       77 rordini-ror-k-master-SPLITBUF  PIC X(35).
       77 rordini-ror-k-stbolle-SPLITBUF  PIC X(30).
       77 rordini-ror-k-ord-art-SPLITBUF  PIC X(19).
       77 tpromo-tpr-chiave-ricerca-SPLITBUF  PIC X(22).
       77 tpromo-tpr-chiave-gdo-fine-SPLITBUF  PIC X(22).
       77 tpromo-tpr-chiave-fine-SPLITBUF  PIC X(22).
       77 tpromo-tpr-chiave-ini-SPLITBUF  PIC X(22).
       77 tpromo-tpr-chiave-volantino-SPLITBUF  PIC X(22).
       77 tpromo-tpr-k-fine-vol-SPLITBUF  PIC X(22).
       77 tpromo-tpr-k-data-ins-SPLITBUF  PIC X(29).
       77 tmp-sol1-k-dt-testa-SPLITBUF  PIC X(22).
       77 tmp-sol1-k-art-SPLITBUF  PIC X(14).
       77 tmp-sol1-k-eva-SPLITBUF  PIC X(30).
       77 tmp-sol-k-dt-testa-SPLITBUF  PIC X(22).
       77 tmp-sol-k-art-SPLITBUF  PIC X(14).
       77 tmp-sol-k-eva-SPLITBUF  PIC X(30).
       77 tmp-sol2-k-dt-testa-SPLITBUF  PIC X(22).
       77 tmp-sol2-k-art-SPLITBUF  PIC X(14).
       77 tmp-sol2-k-eva-SPLITBUF  PIC X(30).
       77 tordforn-tof-k-causale-SPLITBUF  PIC X(17).
       77 tordforn-tof-k-stato-SPLITBUF  PIC X(14).
       77 tordforn-k-fornitore-SPLITBUF  PIC X(24).
       77 tordforn-tof-k-data-SPLITBUF  PIC X(21).
       77 tordforn-tof-k-consegna-SPLITBUF  PIC X(21).
       77 rordforn-rof-k-articolo-SPLITBUF  PIC X(24).
       77 rordforn-rof-k-art-mag-SPLITBUF  PIC X(27).
       77 tgrupgdo-gdo-k-g2-SPLITBUF  PIC X(9).
       77 tcaumag-k-mag-SPLITBUF  PIC X(5).

      *{TOTEM}END

      *{TOTEM}ID-LOGICI
      ***** Elenco ID Logici *****
       78  78-ID-EF-data-FROM VALUE 5001.
       78  78-ID-EF-DATA-TO VALUE 5002.
       78  78-ID-ef-cli VALUE 5003.
       78  78-ID-ef-dest VALUE 5004.
       78  78-ID-ef-age VALUE 5005.
       78  78-ID-ef-gdo VALUE 5006.
       78  78-ID-ef-tipo VALUE 5007.
       78  78-ID-ef-art VALUE 5008.
       78  78-ID-gd-art2 VALUE 5001.
      ***** Fine ID Logici *****
      *{TOTEM}END

       LINKAGE          SECTION.
      *{TOTEM}LINKAGE
           COPY  "COMMON-LINKAGE.DEF".
      *{TOTEM}END

       SCREEN           SECTION.
      *{TOTEM}COPY-SCREEN
      * FORM
       01 
           Form1, 
           BEFORE PROCEDURE Form1-BeforeProcedure,
           AFTER PROCEDURE  Form1-AFTER-SCREEN
           .

      * TAB
       05
           Screen1-Ta-1, 
           Tab-Control, 
           COL 1,50, 
           LINE 1,00,
           LINES 32,88 ,
           SIZE 97,50 ,
           ID IS 65,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           .

      * PAGE
       05
           Screen1-Pg-2, 
           VISIBLE Screen1-Pg-2-Visible,
           COL 2, 
           LINE 3,
           .

      * ENTRY FIELD
       10
           EF-data-FROM, 
           Entry-Field, 
           COL 31,00, 
           LINE 3,75,
           LINES 1,38 ,
           SIZE 11,00 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-EF-data-FROM,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           MAX-TEXT 10,
           NUMERIC,
           VALUE ef-data-from-buf,
           PIC 99/99/9999
           AFTER PROCEDURE EF-data-FROM-AfterProcedure, 
           .


      * ENTRY FIELD
       10
           EF-DATA-TO, 
           Entry-Field, 
           COL 58,50, 
           LINE 3,75,
           LINES 1,38 ,
           SIZE 11,00 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-EF-DATA-TO,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           MAX-TEXT 10,
           NUMERIC,
           VALUE ef-data-to-buf,
           PIC 99/99/9999
           AFTER PROCEDURE EF-DATA-TO-AfterProcedure, 
           .


      * ENTRY FIELD
       10
           ef-cli, 
           Entry-Field, 
           COL 14,00, 
           LINE 5,62,
           LINES 1,31 ,
           SIZE 7,00 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-ef-cli,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           VALUE ef-cli-buf,
           AFTER PROCEDURE ef-cli-AfterProcedure, 
           .


      * ENTRY FIELD
       10
           ef-dest, 
           Entry-Field, 
           COL 14,00, 
           LINE 7,50,
           LINES 1,33 ,
           SIZE 7,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED e-destini,
           ID IS 78-ID-ef-dest,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           VALUE ef-dest-buf,
           AFTER PROCEDURE ef-dest-AfterProcedure, 
           .


      * ENTRY FIELD
       10
           ef-age, 
           Entry-Field, 
           COL 14,00, 
           LINE 11,25,
           LINES 1,31 ,
           SIZE 7,00 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-ef-age,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           VALUE ef-age-buf,
           AFTER PROCEDURE ef-cli-AfterProcedure, 
           .


      * ENTRY FIELD
       10
           ef-gdo, 
           Entry-Field, 
           COL 14,00, 
           LINE 14,50,
           LINES 1,31 ,
           SIZE 7,00 ,
           BOXED,
           UPPER,
           COLOR IS 513,
           ID IS 78-ID-ef-gdo,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 5,
           VALUE ef-gdo-buf,
           AFTER PROCEDURE ef-cli-AfterProcedure, 
           .


      * COMBO-BOX
       10
           cbo-promoa, 
           Combo-Box, 
           COL 14,00, 
           LINE 16,56,
           LINES 7,13 ,
           SIZE 53,13 ,
           BOXED,
           COLOR IS 513,
           ENABLED 1,
           FONT IS Arial8B-Occidentale,
           ID IS 256,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MASS-UPDATE 0,
           NOTIFY-SELCHANGE,
           DROP-LIST,
           UNSORTED,
           AFTER PROCEDURE cbo-promoa-AfterProcedure, 
           BEFORE PROCEDURE cbo-promoa-BeforeProcedure, 
           .
      * ENTRY FIELD
       10
           ef-tipo, 
           Entry-Field, 
           COL 14,00, 
           LINE 20,12,
           LINES 1,31 ,
           SIZE 7,00 ,
           BOXED,
           UPPER,
           COLOR IS 513,
           ID IS 78-ID-ef-tipo,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           VALUE ef-tipo-buf,
           AFTER PROCEDURE ef-cli-AfterProcedure, 
           .


      * ENTRY FIELD
       10
           ef-art, 
           Entry-Field, 
           COL 14,00, 
           LINE 23,75,
           LINES 1,31 ,
           SIZE 6,00 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-ef-art,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           VALUE ef-art-buf,
           AFTER PROCEDURE ef-cli-AfterProcedure, 
           .


      * CHECK BOX
       10
           chk-reg-ini, 
           Check-Box, 
           COL 14,50, 
           LINE 27,19,
           LINES 1,13 ,
           SIZE 1,88 ,
           ENABLED 1,
           FLAT,
           FONT IS Verdana10-Occidentale,
           ID IS 3,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Check Box",
           VALUE chk-reg-buf,
           AFTER PROCEDURE chk-reg-ini-AfterProcedure,
           BEFORE PROCEDURE chk-reg-ini-BeforeProcedure, 
           .
      * CHECK BOX
       10
           chk-il-ini, 
           Check-Box, 
           COL 14,50, 
           LINE 28,62,
           LINES 1,13 ,
           SIZE 1,88 ,
           ENABLED 1,
           FLAT,
           FONT IS Verdana10-Occidentale,
           ID IS 10,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Check Box",
           VALUE chk-il-buf,
           AFTER PROCEDURE chk-il-ini-AfterProcedure,
           BEFORE PROCEDURE chk-il-ini-BeforeProcedure, 
           .
      * CHECK BOX
       10
           chk-sp-ini, 
           Check-Box, 
           COL 39,50, 
           LINE 27,19,
           LINES 1,13 ,
           SIZE 1,88 ,
           ENABLED 1,
           FLAT,
           FONT IS Verdana10-Occidentale,
           ID IS 25,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Check Box",
           VALUE chk-sp-buf,
           AFTER PROCEDURE chk-sp-ini-AfterProcedure,
           BEFORE PROCEDURE chk-sp-ini-BeforeProcedure, 
           .
      * CHECK BOX
       10
           chk-st-ini, 
           Check-Box, 
           COL 39,50, 
           LINE 28,62,
           LINES 1,13 ,
           SIZE 1,88 ,
           ENABLED 1,
           FLAT,
           FONT IS Verdana10-Occidentale,
           ID IS 27,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Check Box",
           VALUE chk-st-buf,
           AFTER PROCEDURE chk-st-ini-AfterProcedure,
           BEFORE PROCEDURE chk-st-ini-BeforeProcedure, 
           .
      * CHECK BOX
       10
           chk-chiuso-ini, 
           Check-Box, 
           COL 69,50, 
           LINE 27,19,
           LINES 1,13 ,
           SIZE 1,88 ,
           ENABLED 1,
           FLAT,
           FONT IS Verdana10-Occidentale,
           ID IS 33,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Check Box",
           VALUE chk-chiuso-buf,
           AFTER PROCEDURE chk-chiuso-ini-AfterProcedure,
           BEFORE PROCEDURE chk-chiuso-ini-BeforeProcedure, 
           .
      * FRAME
       10
           Screen1-Fr-1a, 
           Frame, 
           COL 2,00, 
           LINE 30,62,
           LINES 3,00 ,
           SIZE 96,50 ,
           COLOR IS 2,
           ID IS 239,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           .

      * PUSH BUTTON
       15
           PB-ESEGUI, 
           Push-Button, 
           COL 78,13, 
           LINE 31,18,
           LINES 30,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE OK_73X21-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           ENABLED 1,
           EXCEPTION-VALUE 1000,
           FLAT,
           ID IS 240,
           SELF-ACT,
           TERMINATION-VALUE 13,
           TITLE "E&segue il programma selezionato",
           AFTER PROCEDURE PB-ESEGUI-m-AfterProcedure, 
           BEFORE PROCEDURE PB-ESEGUI-m-BeforeProcedure, 
           .

      * PUSH BUTTON
       15
           pb-cancel, 
           Push-Button, 
           COL 88,00, 
           LINE 31,18,
           LINES 30,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE CANCEL_73X21-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           ENABLED 1,
           EXCEPTION-VALUE 27,
           FLAT,
           ID IS 241,
           SELF-ACT,
           ESCAPE-BUTTON,
           TITLE "&Esce dall'applicativo",
           AFTER PROCEDURE pb-cancel-AfterProcedure, 
           BEFORE PROCEDURE pb-cancel-BeforeProcedure, 
           .

      * LABEL
       10
           Screen1-La-2ab, 
           Label, 
           COL 5,00, 
           LINE 5,62,
           LINES 1,31 ,
           SIZE 8,00 ,
           ID IS 242,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Cliente",
           .

      * LABEL
       10
           Screen1-La-2aab, 
           Label, 
           COL 5,00, 
           LINE 7,50,
           LINES 1,33 ,
           SIZE 8,00 ,
           ID IS 244,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Destino",
           .

      * BITMAP
       10
           Bitmap-freccia-daaaa, 
           Bitmap, 
           COL 43,00, 
           LINE 3,75,
           LINES 24,00 ,
           SIZE 28,00 ,
           TRANSPARENT-COLOR TR-COLOR,
           BITMAP-HANDLE BLUE-DA-28X24-BMP,
           BITMAP-NUMBER 1,
           ID IS 245,
           .

      * LABEL
       10
           Screen3-La-1acaa, 
           Label, 
           COL 46,75, 
           LINE 3,75,
           LINES 1,19 ,
           SIZE 7,00 ,
           ID IS 246,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Data",
           .

      * BITMAP
       10
           Bitmap-freccia-finoaaa, 
           Bitmap, 
           COL 54,50, 
           LINE 3,75,
           LINES 24,00 ,
           SIZE 28,00 ,
           TRANSPARENT-COLOR TR-COLOR,
           BITMAP-HANDLE BLUE-FINO-28X24-BMP,
           BITMAP-NUMBER 1,
           ID IS 247,
           .

      * LABEL
       10
           lab-cli, 
           Label, 
           COL 22,00, 
           LINE 5,62,
           LINES 1,31 ,
           SIZE 60,00 ,
           COLOR IS 5,
           ID IS 248,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           NO-KEY-LETTER,
           TRANSPARENT,
           TITLE lab-cli-buf,
           .

      * LABEL
       10
           lab-dest, 
           Label, 
           COL 22,00, 
           LINE 7,50,
           LINES 1,31 ,
           SIZE 60,00 ,
           COLOR IS 5,
           ID IS 249,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           NO-KEY-LETTER,
           TRANSPARENT,
           TITLE lab-dest-buf,
           .

      * LABEL
       10
           Screen1-La-2aba, 
           Label, 
           COL 5,00, 
           LINE 11,25,
           LINES 1,33 ,
           SIZE 8,00 ,
           ID IS 253,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Agente",
           .

      * LABEL
       10
           lab-age, 
           Label, 
           COL 22,00, 
           LINE 11,25,
           LINES 1,31 ,
           SIZE 60,00 ,
           COLOR IS 5,
           ID IS 257,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           NO-KEY-LETTER,
           TRANSPARENT,
           TITLE lab-age-buf,
           .

      * LABEL
       10
           Screen1-La-2abaa, 
           Label, 
           COL 5,00, 
           LINE 23,75,
           LINES 1,31 ,
           SIZE 8,00 ,
           ID IS 258,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Articolo",
           .

      * LABEL
       10
           lab-art, 
           Label, 
           COL 21,00, 
           LINE 23,75,
           LINES 1,31 ,
           SIZE 60,00 ,
           COLOR IS 5,
           ID IS 259,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           NO-KEY-LETTER,
           TRANSPARENT,
           TITLE lab-art-buf,
           .

      * LABEL
       10
           Screen1-La-2abaaa, 
           Label, 
           COL 5,00, 
           LINE 16,56,
           LINES 1,31 ,
           SIZE 8,00 ,
           ID IS 260,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Volantino",
           .

      * BAR
       10
           Screen1-Br-1, 
           Bar,
           COL 5,25, 
           LINE 9,81,
           SIZE 90,00 ,
           COLOR IS 2,
           ID IS 261,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           WIDTH 1,
           .

      * BAR
       10
           Screen1-Br-1a, 
           Bar,
           COL 5,25, 
           LINE 19,19,
           SIZE 90,00 ,
           COLOR IS 2,
           ID IS 262,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           WIDTH 1,
           .

      * BAR
       10
           Screen1-Br-1b, 
           Bar,
           COL 5,25, 
           LINE 13,56,
           SIZE 90,00 ,
           COLOR IS 2,
           ID IS 15,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           WIDTH 1,
           .

      * LABEL
       10
           Screen1-La-2abab, 
           Label, 
           COL 5,00, 
           LINE 14,50,
           LINES 1,33 ,
           SIZE 8,00 ,
           ID IS 16,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Gruppo",
           .

      * LABEL
       10
           lab-gdo, 
           Label, 
           COL 22,00, 
           LINE 14,50,
           LINES 1,31 ,
           SIZE 60,00 ,
           COLOR IS 5,
           ID IS 17,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           NO-KEY-LETTER,
           TRANSPARENT,
           TITLE lab-gdo-buf,
           .

      * LABEL
       10
           Screen1-La-2ababa, 
           Label, 
           COL 5,00, 
           LINE 19,75,
           LINES 2,13 ,
           SIZE 8,00 ,
           ID IS 18,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Tipologia Cliente",
           .

      * LABEL
       10
           lab-tipo, 
           Label, 
           COL 22,00, 
           LINE 20,12,
           LINES 1,31 ,
           SIZE 60,00 ,
           COLOR IS 5,
           ID IS 19,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           NO-KEY-LETTER,
           TRANSPARENT,
           TITLE lab-tipo-buf,
           .

      * BAR
       10
           Screen1-Br-1ab, 
           Bar,
           COL 5,25, 
           LINE 22,31,
           SIZE 90,00 ,
           COLOR IS 2,
           ID IS 20,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           WIDTH 1,
           .

      * BAR
       10
           Screen1-Br-1aaa, 
           Bar,
           COL 5,25, 
           LINE 22,56,
           SIZE 90,00 ,
           COLOR IS 2,
           ID IS 14,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           WIDTH 1,
           .

      * LABEL
       10
           Screen1-La-2ja, 
           Label, 
           COL 17,00, 
           LINE 27,12,
           LINES 1,13 ,
           SIZE 19,00 ,
           ID IS 36,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Inevaso / Registrato (REG)",
           .

      * LABEL
       10
           Screen1-La-2bba, 
           Label, 
           COL 17,00, 
           LINE 28,56,
           LINES 1,13 ,
           SIZE 19,00 ,
           ID IS 24,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "In lavorazione (LAV)",
           .

      * LABEL
       10
           Screen1-La-2cba, 
           Label, 
           COL 42,00, 
           LINE 27,12,
           LINES 1,13 ,
           SIZE 22,00 ,
           ID IS 26,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Spedito Parzialmente (SP)",
           .

      * LABEL
       10
           Screen1-La-2daa, 
           Label, 
           COL 42,00, 
           LINE 28,56,
           LINES 1,13 ,
           SIZE 22,00 ,
           ID IS 28,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Spedito Totalmente (ST)",
           .

      * LABEL
       10
           Screen1-La-2gaa, 
           Label, 
           COL 72,00, 
           LINE 27,12,
           LINES 1,13 ,
           SIZE 19,50 ,
           ID IS 34,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Chiuso",
           .

      * BAR
       10
           Screen1-Br-1aa, 
           Bar,
           COL 5,25, 
           LINE 26,06,
           SIZE 90,00 ,
           COLOR IS 2,
           ID IS 35,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           WIDTH 1,
           .

      * LABEL
       10
           Screen1-La-2abaab, 
           Label, 
           COL 5,00, 
           LINE 27,12,
           LINES 1,13 ,
           SIZE 8,00 ,
           ID IS 37,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Stato",
           .

      * LABEL
       05
           Screen1-blockpgm-1, 
           Label, 
           COL 19,00, 
           LINE 1,50,
           LINES 0,50 ,
           SIZE 7,38 ,
           ID IS 2,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "BlockPgm",
           VISIBLE v-custom,
           .

      * LABEL
       05
           Screen1-Custom1-1, 
           Label, 
           COL 31,38, 
           LINE 1,44,
           LINES 0,56 ,
           SIZE 8,63 ,
           FONT IS Default-Font,
           ID IS 4,
           TRANSPARENT,
           TITLE "CUSTOM CONTROL",
           VISIBLE v-custom,
           .

      * TOOLBAR
       01
           Form1-Tb-1a,
           .    

      * PUSH BUTTON
       05
           TOOL-ESCI, 
           Push-Button, 
           COL 1,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           ENABLED E-ESCI,
           EXCEPTION-VALUE 27,
           FLAT,
           ID IS 64,
           SELF-ACT,
           ESCAPE-BUTTON,
           TITLE "&Esci",
           .

      * PUSH BUTTON
       05
           TOOL-CERCA, 
           Push-Button, 
           COL 6,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           BITMAP-NUMBER 8,
           UNFRAMED,
           SQUARE,
           ENABLED E-CERCA,
           EXCEPTION-VALUE 8,
           FLAT,
           ID IS 66,
           SELF-ACT,
           TITLE "Cerca (F8)",
           .

      * FORM
       01 
           scr-elab, 
           AFTER PROCEDURE  scr-elab-AFTER-SCREEN
           .

      * LABEL
       05
           Screen1-La-1b, 
           Label, 
           COL 3,45, 
           LINE 1,67,
           LINES 1,00 ,
           SIZE 25,00 ,
           ID IS 2,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Caricamento Ordini in corso...",
           .

      * FORM
       01 
           scr-ordini, 
           AFTER PROCEDURE  scr-ordini-AFTER-SCREEN
           .

      * FRAME
       05
           Screen2-Fr-1, 
           Frame, 
           COL 21,83, 
           LINE 1,43,
           LINES 10,86 ,
           SIZE 182,50 ,
           COLOR IS 2,
           ID IS 2,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           HEAVY,
           TITLE "Filtri di visualizzazione",
           TITLE-POSITION 2,
           .

      * CHECK BOX
       05
           chk-reg, 
           Check-Box, 
           COL 25,16, 
           LINE 3,36,
           LINES 1,31 ,
           SIZE 2,50 ,
           ENABLED 1,
           EXCEPTION-VALUE 1000
           FLAT,
           FONT IS Verdana10-Occidentale,
           ID IS 3,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Check Box",
           VALUE chk-reg-buf,
           AFTER PROCEDURE chk-reg-AfterProcedure,
           BEFORE PROCEDURE chk-reg-BeforeProcedure, 
           .
      * CHECK BOX
       05
           chk-il, 
           Check-Box, 
           COL 25,16, 
           LINE 5,00,
           LINES 1,31 ,
           SIZE 2,50 ,
           ENABLED 1,
           EXCEPTION-VALUE 1001
           FLAT,
           FONT IS Verdana10-Occidentale,
           ID IS 10,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Check Box",
           VALUE chk-il-buf,
           AFTER PROCEDURE chk-il-AfterProcedure,
           BEFORE PROCEDURE chk-il-BeforeProcedure, 
           .
      * CHECK BOX
       05
           chk-sp, 
           Check-Box, 
           COL 25,16, 
           LINE 6,64,
           LINES 1,31 ,
           SIZE 2,50 ,
           ENABLED 1,
           EXCEPTION-VALUE 1002
           FLAT,
           FONT IS Verdana10-Occidentale,
           ID IS 25,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Check Box",
           VALUE chk-sp-buf,
           AFTER PROCEDURE chk-sp-AfterProcedure,
           BEFORE PROCEDURE chk-sp-BeforeProcedure, 
           .
      * CHECK BOX
       05
           chk-st, 
           Check-Box, 
           COL 25,16, 
           LINE 8,29,
           LINES 1,29 ,
           SIZE 2,50 ,
           ENABLED 1,
           EXCEPTION-VALUE 1003
           FLAT,
           FONT IS Verdana10-Occidentale,
           ID IS 27,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Check Box",
           VALUE chk-st-buf,
           AFTER PROCEDURE chk-st-AfterProcedure,
           BEFORE PROCEDURE chk-st-BeforeProcedure, 
           .
      * CHECK BOX
       05
           chk-chiuso, 
           Check-Box, 
           COL 25,16, 
           LINE 9,79,
           LINES 1,29 ,
           SIZE 2,50 ,
           ENABLED 1,
           EXCEPTION-VALUE 1006
           FLAT,
           FONT IS Verdana10-Occidentale,
           ID IS 33,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Check Box",
           VALUE chk-chiuso-buf,
           AFTER PROCEDURE chk-chiuso-AfterProcedure,
           BEFORE PROCEDURE chk-chiuso-BeforeProcedure, 
           .
      * LABEL
       05
           Screen1-La-2j, 
           Label, 
           COL 28,50, 
           LINE 3,14,
           LINES 1,31 ,
           SIZE 25,00 ,
           FONT IS Arial8B-Occidentale,
           ID IS 36,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Inevaso / Registrato (REG)",
           .

      * LABEL
       05
           Screen1-La-2bb, 
           Label, 
           COL 28,50, 
           LINE 4,79,
           LINES 1,31 ,
           SIZE 25,00 ,
           FONT IS Arial8B-Occidentale,
           ID IS 24,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "In lavorazione (LAV)",
           .

      * LABEL
       05
           Screen1-La-2cb, 
           Label, 
           COL 28,50, 
           LINE 6,43,
           LINES 1,31 ,
           SIZE 25,00 ,
           FONT IS Arial8B-Occidentale,
           ID IS 26,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Spedito Parzialmente (SP)",
           .

      * LABEL
       05
           Screen1-La-2da, 
           Label, 
           COL 28,50, 
           LINE 8,07,
           LINES 1,29 ,
           SIZE 25,00 ,
           FONT IS Arial8B-Occidentale,
           ID IS 28,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Spedito Totalmente (ST)",
           .

      * LABEL
       05
           Screen1-La-2ga, 
           Label, 
           COL 28,50, 
           LINE 9,72,
           LINES 1,29 ,
           SIZE 26,00 ,
           FONT IS Arial8B-Occidentale,
           ID IS 34,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Chiuso",
           .

      * BITMAP
       05
           Bitmap-freccia-daaaaa, 
           Bitmap, 
           COL 102,16, 
           LINE 3,07,
           LINES 24,00 ,
           SIZE 28,00 ,
           TRANSPARENT-COLOR TR-COLOR,
           BITMAP-HANDLE BLUE-DA-28X24-BMP,
           BITMAP-NUMBER 1,
           FONT IS Verdana10-Occidentale,
           ID IS 245,
           .

      * LABEL
       05
           Screen3-La-1acaaa, 
           Label, 
           COL 107,83, 
           LINE 3,22,
           LINES 1,57 ,
           SIZE 7,00 ,
           COLOR IS 5,
           FONT IS Arial8B-Occidentale,
           ID IS 246,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Data",
           .

      * BITMAP
       05
           Bitmap-freccia-finoaaaa, 
           Bitmap, 
           COL 116,00, 
           LINE 3,07,
           LINES 24,00 ,
           SIZE 28,00 ,
           TRANSPARENT-COLOR TR-COLOR,
           BITMAP-HANDLE BLUE-FINO-28X24-BMP,
           BITMAP-NUMBER 1,
           FONT IS Verdana10-Occidentale,
           ID IS 247,
           .

      * LABEL
       05
           lab-data-to, 
           Label, 
           COL 122,50, 
           LINE 3,22,
           LINES 1,57 ,
           SIZE 10,00 ,
           COLOR IS 5,
           FONT IS Arial8B-Occidentale,
           ID IS 4,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE ef-data-to-buf,
           .

      * LABEL
       05
           lab-data-from, 
           Label, 
           COL 90,83, 
           LINE 3,22,
           LINES 1,57 ,
           SIZE 10,00 ,
           COLOR IS 5,
           FONT IS Arial8B-Occidentale,
           ID IS 5,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE ef-data-from-buf,
           .

      * LABEL
       05
           lab-descr, 
           Label, 
           COL 86,66, 
           LINE 5,50,
           LINES 1,21 ,
           SIZE 50,00 ,
           COLOR IS 5,
           FONT IS Arial8B-Occidentale,
           ID IS 7,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE lab-cli-buf,
           .

      * LABEL
       05
           lab-descr2, 
           Label, 
           COL 86,66, 
           LINE 6,93,
           LINES 1,21 ,
           SIZE 50,00 ,
           COLOR IS 5,
           FONT IS Arial8B-Occidentale,
           ID IS 8,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE lab-dest-buf,
           .

      * LABEL
       05
           lab-descr3, 
           Label, 
           COL 86,66, 
           LINE 8,43,
           LINES 1,21 ,
           SIZE 50,00 ,
           COLOR IS 5,
           FONT IS Arial8B-Occidentale,
           ID IS 9,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE lab-age-buf,
           .

      * GRID
       05
           gd-art2, 
           Grid, 
           COL 146,16, 
           LINE 4,36,
           LINES 7,43 ,
           SIZE 56,00 ,
           BOXED,
           DATA-COLUMNS (1, 7),
           ALIGNMENT ("R", "U"),
           SEPARATION (5, 5),
           DATA-TYPES ("9(6)", "X"),
           NUM-COL-HEADINGS 1,
           COLUMN-HEADINGS,
           CURSOR-COLOR 481
           CURSOR-FRAME-WIDTH 2,
           DIVIDER-COLOR 1,
           FONT IS Arial8B-Occidentale,
           HEADING-COLOR 257,
           HEADING-DIVIDER-COLOR 1,
           ID IS 78-ID-gd-art2,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           NUM-ROWS 100,
           TILED-HEADINGS,
           VIRTUAL-WIDTH 53,
           VPADDING 15,
           VSCROLL,
           EVENT PROCEDURE gd-art2-Event-Proc,
           .

      * COMBO-BOX
       05
           cbo-promo, 
           Combo-Box, 
           COL 146,16, 
           LINE 2,36,
           LINES 6,21 ,
           SIZE 56,00 ,
           BOXED,
           COLOR IS 513,
           FONT IS Arial8B-Occidentale,
           ID IS 11,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MASS-UPDATE 0,
           NOTIFY-SELCHANGE,
           DROP-LIST,
           UNSORTED,
           AFTER PROCEDURE Screen2-Cm-1-AfterProcedure, 
           BEFORE PROCEDURE Screen2-Cm-1-BeforeProcedure, 
           EXCEPTION PROCEDURE cbo-promo-Exception-Proc, 
           .
      * LABEL
       05
           lab-descr4, 
           Label, 
           COL 86,66, 
           LINE 5,43,
           LINES 1,21 ,
           SIZE 50,00 ,
           COLOR IS 5,
           FONT IS Arial8B-Occidentale,
           ID IS 12,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE lab-gdo-buf,
           .

      * LABEL
       05
           lab-descr5, 
           Label, 
           COL 86,66, 
           LINE 9,93,
           LINES 1,21 ,
           SIZE 50,00 ,
           COLOR IS 5,
           FONT IS Arial8B-Occidentale,
           ID IS 13,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE lab-tipo-buf,
           .

      * GRID
       05
           gd, 
           Grid, 
           COL 1,00, 
           LINE 15,07,
           LINES 38,07 ,
           SIZE 224,17 ,
           BOXED,
           DATA-COLUMNS (1, 2, 7, 47, 87, 137, 147, 157, 165, 173, 181, 
           189, 197, 205, 211, 241),
           ALIGNMENT ("U", "R", "U", "U", "R", "R", "C", "R", "C", "R", 
           "C", "R", "C", "C", "U", "C"),
           SEPARATION (5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5),
           DATA-TYPES ("X(1)", "9(4)", "X(40)", "X(40)", "X(50)", "X(10)
      -    "", "X(10)", "9(8)", "X(10)", "9(8)", "X(10)", "X", "X", "X(6
      -    ")", "X(30)", "s9"),
           CURSOR-FRAME-WIDTH 2,
           DIVIDER-COLOR 1,
           HEADING-COLOR 257,
           HEADING-DIVIDER-COLOR 1,
           HSCROLL,
           ID IS 6,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RECORD-DATA rec-grid,
           TILED-HEADINGS,
           VIRTUAL-WIDTH 222,
           VPADDING 15,
           VSCROLL,
           EVENT PROCEDURE gd-Event-Proc,
           .

      * COMBO-BOX
       05
           cbo-num, 
           Combo-Box, 
           COL 4,00, 
           LINE 13,64,
           LINES 25,00 ,
           SIZE 7,33 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 14,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MASS-UPDATE 0,
           NOTIFY-DBLCLICK,
           NOTIFY-SELCHANGE,
           DROP-DOWN,
           UNSORTED,
           AFTER PROCEDURE cbo-num-AfterProcedure, 
           BEFORE PROCEDURE Screen2-Cm-1-BeforeProcedure, 
           EVENT PROCEDURE cbo-num-Event-Proc,
           EXCEPTION PROCEDURE cbo-num-Exception-Proc, 
           .
      * COMBO-BOX
       05
           cbo-clides, 
           Combo-Box, 
           COL 10,67, 
           LINE 13,64,
           LINES 25,00 ,
           SIZE 49,67 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 15,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MASS-UPDATE 0,
           NOTIFY-DBLCLICK,
           NOTIFY-SELCHANGE,
           DROP-DOWN,
           UNSORTED,
           AFTER PROCEDURE cbo-clides-AfterProcedure, 
           BEFORE PROCEDURE Screen2-Cm-1-BeforeProcedure, 
           EVENT PROCEDURE cbo-clides-Event-Proc,
           EXCEPTION PROCEDURE cbo-clides-Exception-Proc, 
           .
      * COMBO-BOX
       05
           cbo-loca, 
           Combo-Box, 
           COL 59,67, 
           LINE 13,64,
           LINES 25,00 ,
           SIZE 49,67 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 16,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MASS-UPDATE 0,
           NOTIFY-DBLCLICK,
           NOTIFY-SELCHANGE,
           DROP-DOWN,
           UNSORTED,
           AFTER PROCEDURE cbo-loca-AfterProcedure, 
           BEFORE PROCEDURE Screen2-Cm-1-BeforeProcedure, 
           EVENT PROCEDURE cbo-loca-Event-Proc,
           EXCEPTION PROCEDURE cbo-loca-Exception-Proc, 
           .
      * COMBO-BOX
       05
           cbo-numord, 
           Combo-Box, 
           COL 108,83, 
           LINE 13,64,
           LINES 25,00 ,
           SIZE 17,50 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 17,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MASS-UPDATE 0,
           NOTIFY-DBLCLICK,
           NOTIFY-SELCHANGE,
           DROP-DOWN,
           UNSORTED,
           AFTER PROCEDURE cbo-numord-AfterProcedure, 
           BEFORE PROCEDURE Screen2-Cm-1-BeforeProcedure, 
           EVENT PROCEDURE cbo-numord-Event-Proc,
           EXCEPTION PROCEDURE cbo-numord-Exception-Proc, 
           .
      * COMBO-BOX
       05
           cbo-data, 
           Combo-Box, 
           COL 125,83, 
           LINE 13,64,
           LINES 25,00 ,
           SIZE 8,67 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 18,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MASS-UPDATE 0,
           NOTIFY-DBLCLICK,
           NOTIFY-SELCHANGE,
           DROP-DOWN,
           UNSORTED,
           AFTER PROCEDURE cbo-data-AfterProcedure, 
           BEFORE PROCEDURE Screen2-Cm-1-BeforeProcedure, 
           EVENT PROCEDURE cbo-data-Event-Proc,
           EXCEPTION PROCEDURE cbo-data-Exception-Proc, 
           .
      * COMBO-BOX
       05
           cbo-stato, 
           Combo-Box, 
           COL 134,00, 
           LINE 13,64,
           LINES 25,00 ,
           SIZE 8,33 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 19,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MASS-UPDATE 0,
           NOTIFY-DBLCLICK,
           NOTIFY-SELCHANGE,
           DROP-DOWN,
           UNSORTED,
           AFTER PROCEDURE cbo-stato-AfterProcedure, 
           BEFORE PROCEDURE Screen2-Cm-1-BeforeProcedure, 
           EVENT PROCEDURE cbo-stato-Event-Proc,
           EXCEPTION PROCEDURE cbo-stato-Exception-Proc, 
           .
      * COMBO-BOX
       05
           cbo-num-e, 
           Combo-Box, 
           COL 141,83, 
           LINE 13,64,
           LINES 25,00 ,
           SIZE 7,50 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 20,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MASS-UPDATE 0,
           NOTIFY-DBLCLICK,
           NOTIFY-SELCHANGE,
           DROP-DOWN,
           UNSORTED,
           AFTER PROCEDURE cbo-num-e-AfterProcedure, 
           BEFORE PROCEDURE Screen2-Cm-1-BeforeProcedure, 
           EVENT PROCEDURE cbo-num-e-Event-Proc,
           EXCEPTION PROCEDURE cbo-num-e-Exception-Proc, 
           .
      * COMBO-BOX
       05
           cbo-data-e, 
           Combo-Box, 
           COL 148,83, 
           LINE 13,64,
           LINES 25,00 ,
           SIZE 8,50 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 21,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MASS-UPDATE 0,
           NOTIFY-DBLCLICK,
           NOTIFY-SELCHANGE,
           DROP-DOWN,
           UNSORTED,
           AFTER PROCEDURE cbo-data-e-AfterProcedure, 
           BEFORE PROCEDURE Screen2-Cm-1-BeforeProcedure, 
           EVENT PROCEDURE cbo-data-e-Event-Proc,
           EXCEPTION PROCEDURE cbo-data-e-Exception-Proc, 
           .
      * COMBO-BOX
       05
           cbo-num-b, 
           Combo-Box, 
           COL 156,83, 
           LINE 13,64,
           LINES 25,00 ,
           SIZE 7,50 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 22,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MASS-UPDATE 0,
           NOTIFY-DBLCLICK,
           NOTIFY-SELCHANGE,
           DROP-DOWN,
           UNSORTED,
           AFTER PROCEDURE cbo-num-b-AfterProcedure, 
           BEFORE PROCEDURE Screen2-Cm-1-BeforeProcedure, 
           EVENT PROCEDURE cbo-num-b-Event-Proc,
           EXCEPTION PROCEDURE cbo-num-b-Exception-Proc, 
           .
      * COMBO-BOX
       05
           cbo-data-b, 
           Combo-Box, 
           COL 163,83, 
           LINE 13,64,
           LINES 25,00 ,
           SIZE 8,50 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 23,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MASS-UPDATE 0,
           NOTIFY-DBLCLICK,
           NOTIFY-SELCHANGE,
           DROP-DOWN,
           UNSORTED,
           AFTER PROCEDURE cbo-data-b-AfterProcedure, 
           BEFORE PROCEDURE Screen2-Cm-1-BeforeProcedure, 
           EVENT PROCEDURE cbo-data-b-Event-Proc,
           EXCEPTION PROCEDURE cbo-data-b-Exception-Proc, 
           .
      * COMBO-BOX
       05
           cbo-num-f, 
           Combo-Box, 
           COL 171,83, 
           LINE 13,64,
           LINES 25,00 ,
           SIZE 7,50 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 29,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MASS-UPDATE 0,
           NOTIFY-DBLCLICK,
           NOTIFY-SELCHANGE,
           DROP-DOWN,
           UNSORTED,
           AFTER PROCEDURE cbo-num-f-AfterProcedure, 
           BEFORE PROCEDURE Screen2-Cm-1-BeforeProcedure, 
           EVENT PROCEDURE cbo-num-f-Event-Proc,
           EXCEPTION PROCEDURE cbo-num-f-Exception-Proc, 
           .
      * COMBO-BOX
       05
           cbo-data-f, 
           Combo-Box, 
           COL 178,83, 
           LINE 13,64,
           LINES 25,00 ,
           SIZE 8,50 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 38,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MASS-UPDATE 0,
           NOTIFY-DBLCLICK,
           NOTIFY-SELCHANGE,
           DROP-DOWN,
           UNSORTED,
           AFTER PROCEDURE cbo-data-f-AfterProcedure, 
           BEFORE PROCEDURE Screen2-Cm-1-BeforeProcedure, 
           EVENT PROCEDURE cbo-data-f-Event-Proc,
           EXCEPTION PROCEDURE cbo-data-f-Exception-Proc, 
           .
      * LABEL
       05
           lab-num, 
           Label, 
           COL 4,00, 
           LINE 12,29,
           LINES 0,93 ,
           SIZE 7,33 ,
           COLOR IS 2,
           FONT IS Arial8B-Occidentale,
           ID IS 43,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE lab-num-buf,
           .

      * LABEL
       05
           lab-clides, 
           Label, 
           COL 10,67, 
           LINE 12,29,
           LINES 0,93 ,
           SIZE 49,67 ,
           COLOR IS 2,
           FONT IS Arial8B-Occidentale,
           ID IS 44,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE lab-clides-buf,
           .

      * LABEL
       05
           lab-loca, 
           Label, 
           COL 59,67, 
           LINE 12,29,
           LINES 0,93 ,
           SIZE 49,67 ,
           COLOR IS 2,
           FONT IS Arial8B-Occidentale,
           ID IS 45,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE lab-loca-buf,
           .

      * LABEL
       05
           lab-numord, 
           Label, 
           COL 108,83, 
           LINE 12,29,
           LINES 0,93 ,
           SIZE 16,33 ,
           COLOR IS 2,
           FONT IS Arial8B-Occidentale,
           ID IS 46,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE lab-numord-buf,
           .

      * LABEL
       05
           lab-data, 
           Label, 
           COL 125,83, 
           LINE 12,29,
           LINES 0,93 ,
           SIZE 7,17 ,
           COLOR IS 2,
           FONT IS Arial8B-Occidentale,
           ID IS 47,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE lab-data-buf,
           .

      * LABEL
       05
           lab-stato, 
           Label, 
           COL 134,00, 
           LINE 12,29,
           LINES 0,93 ,
           SIZE 7,17 ,
           COLOR IS 2,
           FONT IS Arial8B-Occidentale,
           ID IS 48,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE lab-stato-buf,
           .

      * LABEL
       05
           lab-num-e, 
           Label, 
           COL 141,83, 
           LINE 12,29,
           LINES 0,93 ,
           SIZE 7,17 ,
           COLOR IS 2,
           FONT IS Arial8B-Occidentale,
           ID IS 49,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE lab-num-e-buf,
           .

      * LABEL
       05
           lab-data-e, 
           Label, 
           COL 148,83, 
           LINE 12,29,
           LINES 0,93 ,
           SIZE 7,17 ,
           COLOR IS 2,
           FONT IS Arial8B-Occidentale,
           ID IS 50,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE lab-data-e-buf,
           .

      * LABEL
       05
           lab-num-b, 
           Label, 
           COL 156,83, 
           LINE 12,29,
           LINES 0,93 ,
           SIZE 7,17 ,
           COLOR IS 2,
           FONT IS Arial8B-Occidentale,
           ID IS 51,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE lab-num-b-buf,
           .

      * LABEL
       05
           lab-data-b, 
           Label, 
           COL 163,83, 
           LINE 12,29,
           LINES 0,93 ,
           SIZE 7,17 ,
           COLOR IS 2,
           FONT IS Arial8B-Occidentale,
           ID IS 52,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE lab-data-b-buf,
           .

      * LABEL
       05
           lab-esito, 
           Label, 
           COL 192,83, 
           LINE 12,29,
           LINES 0,93 ,
           SIZE 7,17 ,
           COLOR IS 2,
           FONT IS Arial8B-Occidentale,
           ID IS 53,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE lab-esito-buf,
           .

      * LABEL
       05
           lab-vett, 
           Label, 
           COL 186,83, 
           LINE 12,29,
           LINES 0,93 ,
           SIZE 6,50 ,
           COLOR IS 2,
           FONT IS Arial8B-Occidentale,
           ID IS 54,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE lab-vett-buf,
           .

      * LABEL
       05
           lab-data-f, 
           Label, 
           COL 178,83, 
           LINE 12,29,
           LINES 0,93 ,
           SIZE 8,50 ,
           COLOR IS 2,
           FONT IS Arial8B-Occidentale,
           ID IS 55,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE lab-data-f-buf,
           .

      * LABEL
       05
           lab-num-f, 
           Label, 
           COL 171,83, 
           LINE 12,29,
           LINES 0,93 ,
           SIZE 7,17 ,
           COLOR IS 2,
           FONT IS Arial8B-Occidentale,
           ID IS 56,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE lab-num-f-buf,
           .

      * TOOLBAR
       01
           Form1-Tb-1aa,
           .    

      * PUSH BUTTON
       05
           TOOL-ESCIa, 
           Push-Button, 
           COL 1,00, 
           LINE 1,43,
           LINES 25,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           ENABLED E-ESCI,
           EXCEPTION-VALUE 27,
           FLAT,
           ID IS 1016,
           SELF-ACT,
           ESCAPE-BUTTON,
           TITLE "Esci (Esc)",
           .

      * PUSH BUTTON
       05
           TOOL-STAMPA, 
           Push-Button, 
           COL 6,00, 
           LINE 1,43,
           LINES 25,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 7,
           FRAMED,
           SQUARE,
           ENABLED 1,
           EXCEPTION-VALUE 7,
           FLAT,
           ID IS 1018,
           SELF-ACT,
           TITLE "Stampa (F7)",
           .

      * PUSH BUTTON
       05
           pb-excel, 
           Push-Button, 
           COL 187,67, 
           LINE 1,43,
           LINES 32,00 ,
           SIZE 28,00 ,
           BITMAP-HANDLE EXCEL-BMP,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 88,
           FLAT,
           FONT IS Small-Font,
           ID IS 30,
           SELF-ACT,
           TITLE "Export Excel",
           VISIBLE 1,
           .

      * FORM
       01 
           scr-excel, 
           HELP-ID 1,
           AFTER PROCEDURE  scr-excel-AFTER-SCREEN
           .

      * LABEL
       05
           scr-elab-La-1, 
           Label, 
           COL 3,90, 
           LINE 1,00,
           LINES 2,20 CELLS,
           SIZE 30,00 CELLS,
           COLOR IS 1,
           FONT IS Verdana14I-Occidentale,
           ID IS 13,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE tit-elab,
           .

      *{TOTEM}END

      *{TOTEM}LINKPARA
       PROCEDURE  DIVISION USING LK-BLOCKPGM, USER-CODI, LIVELLO-ABIL.
      *{TOTEM}END

      *{TOTEM}DECLARATIVE
       DECLARATIVES.
      * <TOTEM:EPT. INIT:solleciti, INIT:solleciti, BeforeDeclarative>
      ***---
       TORDINI-ERR SECTION.
           use after error procedure on tordini.
           evaluate status-tordini
           when "35"
                display message "File [TORDINI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TORDINI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TORDINI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           when "93"
           when "99"
                set RecLocked to true
           end-evaluate.
 
      ***---
       CLIENTI-ERR SECTION.
           use after error procedure on clienti.
           set tutto-ok  to true.
           evaluate status-clienti
           when "35"
                display message "File [CLIENTI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [CLIENTI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[CLIENTI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.   
 
      ***---
       ARTICOLI-ERR SECTION.
           use after error procedure on articoli.
           set tutto-ok  to true.
           evaluate status-articoli
           when "35"
                display message "File [ARTICOLI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [ARTICOLI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[ARTICOLI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       MTORDINI-ERR SECTION.
           use after error procedure on mtordini.
           set tutto-ok  to true.
           evaluate status-mtordini
           when "35"
                display message "File [MTORDINI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [MTORDINI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[MTORDINI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.   
 
      ***---
       MRORDINI-ERR SECTION.
           use after error procedure on mrordini.
           set tutto-ok  to true.
           evaluate status-mrordini
           when "35"
                display message "File [MRORDINI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [MRORDINI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[MRORDINI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.

      * <TOTEM:END>
       INPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON INPUT.
       0100-DECL.
           EXIT.
       I-O-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON I-O.
       0200-DECL.
           EXIT.
       OUTPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON OUTPUT.
       0300-DECL.
           EXIT.
       TRANSACTION-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON TRANSACTION.
       0400-DECL.
           EXIT.
       END DECLARATIVES.
      *{TOTEM}END

       MAIN-LOGIC.
      *{TOTEM}ENTRY-BEFPRG
      *    Before-Program
           PERFORM bprepb-Ev-Before-Program
      *{TOTEM}END
           PERFORM INITIALIZE-ROUTINE.
      * run main screen
      *{TOTEM}RUN-MAINSCR
           PERFORM Form1-OPEN-ROUTINE.
      *{TOTEM}END

      *{TOTEM}COPY-PROCEDURE
       EXIT-STOP-ROUTINE.
           PERFORM CLOSE-FILE-RTN
      * <TOTEM:EPT. INIT:solleciti, INIT:solleciti, BeforeDestroyResource>
      * <TOTEM:END>
           DESTROY Arial8B-Occidentale
           DESTROY Verdana10-Occidentale
           DESTROY Verdana12BI-Occidentale
           DESTROY Arial8-Occidentale
           DESTROY Verdana14I-Occidentale
           CALL "w$bitmap" USING WBITMAP-DESTROY, OK_73X21-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, CANCEL_73X21-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, BLUE-DA-28X24-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, BLUE-FINO-28X24-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, toolbar-bmp
           CALL "w$bitmap" USING WBITMAP-DESTROY, TOOLBAR-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, EXCEL-BMP
      *    After-Program
           PERFORM stdoc-Ev-After-Program
           EXIT PROGRAM TOTEM-PgmStatus
           STOP RUN.

       INITIALIZE-ROUTINE.
      *    Before Init
      * initialize program status variable
           Initialize TOTEM-PgmStatus.
      * get system information
           ACCEPT SYSTEM-INFORMATION FROM SYSTEM-INFO.
      * get terminal information
           ACCEPT TERMINAL-ABILITIES FROM TERMINAL-INFO.
      * set font
           PERFORM INIT-FONT.
      * load bitmap
           PERFORM INIT-BMP.
      * load resource
           PERFORM INIT-RES.
      * create pop-up menu
           PERFORM INIT-POPUP.
      * open files
           PERFORM OPEN-FILE-RTN.
      *    After Init
           .
    
       INIT-FONT.
      * Arial8B-Occidentale
           INITIALIZE WFONT-DATA Arial8B-Occidentale
           MOVE 8 TO WFONT-SIZE
           MOVE "Arial" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO TRUE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Arial8B-Occidentale, WFONT-DATA
      * Verdana10-Occidentale
           INITIALIZE WFONT-DATA Verdana10-Occidentale
           MOVE 10 TO WFONT-SIZE
           MOVE "Verdana" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO FALSE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Verdana10-Occidentale, WFONT-DATA
      * Verdana12BI-Occidentale
           INITIALIZE WFONT-DATA Verdana12BI-Occidentale
           MOVE 12 TO WFONT-SIZE
           MOVE "Verdana" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO TRUE
           SET WFONT-ITALIC TO TRUE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Verdana12BI-Occidentale, WFONT-DATA

      * Arial8-Occidentale
           INITIALIZE WFONT-DATA Arial8-Occidentale
           MOVE 8 TO WFONT-SIZE
           MOVE "Arial" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO FALSE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Arial8-Occidentale, WFONT-DATA
      * Verdana14I-Occidentale
           INITIALIZE WFONT-DATA Verdana14I-Occidentale
           MOVE 14 TO WFONT-SIZE
           MOVE "Verdana" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO FALSE
           SET WFONT-ITALIC TO TRUE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Verdana14I-Occidentale, WFONT-DATA
           .

       INIT-BMP.
      * PB-ESEGUI
           COPY RESOURCE "BOTTONE-OK.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "BOTTONE-OK.BMP", 
                   GIVING OK_73X21-BMP.
      * pb-cancel
           COPY RESOURCE "BOTTONE-CANCEL.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "BOTTONE-CANCEL.BMP", 
                   GIVING CANCEL_73X21-BMP.
      * Bitmap-freccia-daaaa
           COPY RESOURCE "BLUE-DA-28X24.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "BLUE-DA-28X24.BMP", 
                   GIVING BLUE-DA-28X24-BMP.
      * Bitmap-freccia-finoaaa
           COPY RESOURCE "BLUE-FINO-28X24.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "BLUE-FINO-28X24.BMP", 
                   GIVING BLUE-FINO-28X24-BMP.
      * TOOL-ESCI
           COPY RESOURCE "toolbar.bmp".
           CALL "w$bitmap" USING WBITMAP-LOAD "toolbar.bmp", 
                   GIVING toolbar-bmp.
      * TOOL-CERCA
           COPY RESOURCE "TOOLBAR.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "TOOLBAR.BMP", 
                   GIVING TOOLBAR-BMP.
      * pb-excel
           COPY RESOURCE "EXCEL.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "EXCEL.BMP", 
                   GIVING EXCEL-BMP.
           .

       INIT-RES.
           .

       INIT-POPUP.
           .

       OPEN-FILE-RTN.
      *    Before Open
           PERFORM OPEN-agenti
           PERFORM OPEN-tordini
           PERFORM OPEN-mtordini
           PERFORM OPEN-mrordini
           PERFORM OPEN-articoli
           PERFORM OPEN-destini
           PERFORM OPEN-tescons
           PERFORM OPEN-clienti
           PERFORM OPEN-tvettori
           PERFORM OPEN-rordini
           PERFORM OPEN-tpromo
      *    tmp-sol1 OPEN MODE IS FALSE
      *    PERFORM OPEN-tmp-sol1
      *    tmp-sol OPEN MODE IS FALSE
      *    PERFORM OPEN-tmp-sol
      *    tmp-sol2 OPEN MODE IS FALSE
      *    PERFORM OPEN-tmp-sol2
      *    tmp-ordf-art OPEN MODE IS FALSE
      *    PERFORM OPEN-tmp-ordf-art
           PERFORM OPEN-tordforn
           PERFORM OPEN-rordforn
           PERFORM OPEN-tgrupgdo
           PERFORM OPEN-sordforn
           PERFORM OPEN-tcaumag
           PERFORM OPEN-ttipocli
      *    After Open
           .

       OPEN-agenti.
      * <TOTEM:EPT. INIT:solleciti, FD:agenti, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT agenti
           IF NOT Valid-STATUS-agenti
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:solleciti, FD:agenti, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tordini.
      * <TOTEM:EPT. INIT:solleciti, FD:tordini, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tordini
           IF NOT Valid-STATUS-tordini
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:solleciti, FD:tordini, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-mtordini.
      * <TOTEM:EPT. INIT:solleciti, FD:mtordini, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT mtordini
           IF NOT Valid-STATUS-mtordini
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:solleciti, FD:mtordini, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-mrordini.
      * <TOTEM:EPT. INIT:solleciti, FD:mrordini, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT mrordini
           IF NOT Valid-STATUS-mrordini
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:solleciti, FD:mrordini, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-articoli.
      * <TOTEM:EPT. INIT:solleciti, FD:articoli, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT articoli
           IF NOT Valid-STATUS-articoli
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:solleciti, FD:articoli, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-destini.
      * <TOTEM:EPT. INIT:solleciti, FD:destini, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT destini
           IF NOT Valid-STATUS-destini
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:solleciti, FD:destini, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tescons.
      * <TOTEM:EPT. INIT:solleciti, FD:tescons, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tescons
           IF NOT Valid-STATUS-tescons
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:solleciti, FD:tescons, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-clienti.
      * <TOTEM:EPT. INIT:solleciti, FD:clienti, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT clienti
           IF NOT Valid-STATUS-clienti
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:solleciti, FD:clienti, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tvettori.
      * <TOTEM:EPT. INIT:solleciti, FD:tvettori, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tvettori
           IF NOT Valid-STATUS-tvettori
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:solleciti, FD:tvettori, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-rordini.
      * <TOTEM:EPT. INIT:solleciti, FD:rordini, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT rordini
           IF NOT Valid-STATUS-rordini
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:solleciti, FD:rordini, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tpromo.
      * <TOTEM:EPT. INIT:solleciti, FD:tpromo, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tpromo
           IF NOT Valid-STATUS-tpromo
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:solleciti, FD:tpromo, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tmp-sol1.
      * <TOTEM:EPT. INIT:solleciti, FD:tmp-sol1, BeforeOpen>
      * <TOTEM:END>
           OPEN  OUTPUT tmp-sol1
           IF NOT VALID-status-tmp-sol1leciti-m
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:solleciti, FD:tmp-sol1, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tmp-sol.
      * <TOTEM:EPT. INIT:solleciti, FD:tmp-sol, BeforeOpen>
      * <TOTEM:END>
           OPEN  OUTPUT tmp-sol
           IF NOT Valid-status-tmp-solleciti-m
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:solleciti, FD:tmp-sol, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tmp-sol2.
      * <TOTEM:EPT. INIT:solleciti, FD:tmp-sol2, BeforeOpen>
      * <TOTEM:END>
           OPEN  OUTPUT tmp-sol2
           IF NOT VALID-status-tmp-sol2leciti-m
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:solleciti, FD:tmp-sol2, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tmp-ordf-art.
      * <TOTEM:EPT. INIT:solleciti, FD:tmp-ordf-art, BeforeOpen>
      * <TOTEM:END>
           OPEN  OUTPUT tmp-ordf-art
           IF NOT Valid-STATUS-tmp-ordf-art
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:solleciti, FD:tmp-ordf-art, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tordforn.
      * <TOTEM:EPT. INIT:solleciti, FD:tordforn, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tordforn
           IF NOT Valid-STATUS-tordforn
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:solleciti, FD:tordforn, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-rordforn.
      * <TOTEM:EPT. INIT:solleciti, FD:rordforn, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT rordforn
           IF NOT Valid-STATUS-rordforn
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:solleciti, FD:rordforn, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tgrupgdo.
      * <TOTEM:EPT. INIT:solleciti, FD:tgrupgdo, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tgrupgdo
           IF NOT Valid-STATUS-tgrupgdo
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:solleciti, FD:tgrupgdo, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-sordforn.
      * <TOTEM:EPT. INIT:solleciti, FD:sordforn, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT sordforn
           IF NOT Valid-STATUS-sordforn
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:solleciti, FD:sordforn, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tcaumag.
      * <TOTEM:EPT. INIT:solleciti, FD:tcaumag, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tcaumag
           IF NOT Valid-STATUS-tcaumag
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:solleciti, FD:tcaumag, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-ttipocli.
      * <TOTEM:EPT. INIT:solleciti, FD:ttipocli, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT ttipocli
           IF NOT Valid-STATUS-ttipocli
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:solleciti, FD:ttipocli, AfterOpen>
      * <TOTEM:END>
           .

       CLOSE-FILE-RTN.
      *    Before Close
           PERFORM CLOSE-agenti
           PERFORM CLOSE-tordini
           PERFORM CLOSE-mtordini
           PERFORM CLOSE-mrordini
           PERFORM CLOSE-articoli
           PERFORM CLOSE-destini
           PERFORM CLOSE-tescons
           PERFORM CLOSE-clienti
           PERFORM CLOSE-tvettori
           PERFORM CLOSE-rordini
           PERFORM CLOSE-tpromo
      *    tmp-sol1 CLOSE MODE IS FALSE
      *    PERFORM CLOSE-tmp-sol1
      *    tmp-sol CLOSE MODE IS FALSE
      *    PERFORM CLOSE-tmp-sol
      *    tmp-sol2 CLOSE MODE IS FALSE
      *    PERFORM CLOSE-tmp-sol2
      *    tmp-ordf-art CLOSE MODE IS FALSE
      *    PERFORM CLOSE-tmp-ordf-art
           PERFORM CLOSE-tordforn
           PERFORM CLOSE-rordforn
           PERFORM CLOSE-tgrupgdo
           PERFORM CLOSE-sordforn
           PERFORM CLOSE-tcaumag
           PERFORM CLOSE-ttipocli
      *    After Close
           .

       CLOSE-agenti.
      * <TOTEM:EPT. INIT:solleciti, FD:agenti, BeforeClose>
      * <TOTEM:END>
           CLOSE agenti
           .

       CLOSE-tordini.
      * <TOTEM:EPT. INIT:solleciti, FD:tordini, BeforeClose>
      * <TOTEM:END>
           CLOSE tordini
           .

       CLOSE-mtordini.
      * <TOTEM:EPT. INIT:solleciti, FD:mtordini, BeforeClose>
      * <TOTEM:END>
           CLOSE mtordini
           .

       CLOSE-mrordini.
      * <TOTEM:EPT. INIT:solleciti, FD:mrordini, BeforeClose>
      * <TOTEM:END>
           CLOSE mrordini
           .

       CLOSE-articoli.
      * <TOTEM:EPT. INIT:solleciti, FD:articoli, BeforeClose>
      * <TOTEM:END>
           CLOSE articoli
           .

       CLOSE-destini.
      * <TOTEM:EPT. INIT:solleciti, FD:destini, BeforeClose>
      * <TOTEM:END>
           CLOSE destini
           .

       CLOSE-tescons.
      * <TOTEM:EPT. INIT:solleciti, FD:tescons, BeforeClose>
      * <TOTEM:END>
           CLOSE tescons
           .

       CLOSE-clienti.
      * <TOTEM:EPT. INIT:solleciti, FD:clienti, BeforeClose>
      * <TOTEM:END>
           CLOSE clienti
           .

       CLOSE-tvettori.
      * <TOTEM:EPT. INIT:solleciti, FD:tvettori, BeforeClose>
      * <TOTEM:END>
           CLOSE tvettori
           .

       CLOSE-rordini.
      * <TOTEM:EPT. INIT:solleciti, FD:rordini, BeforeClose>
      * <TOTEM:END>
           CLOSE rordini
           .

       CLOSE-tpromo.
      * <TOTEM:EPT. INIT:solleciti, FD:tpromo, BeforeClose>
      * <TOTEM:END>
           CLOSE tpromo
           .

       CLOSE-tmp-sol1.
      * <TOTEM:EPT. INIT:solleciti, FD:tmp-sol1, BeforeClose>
      * <TOTEM:END>
           .

       CLOSE-tmp-sol.
      * <TOTEM:EPT. INIT:solleciti, FD:tmp-sol, BeforeClose>
      * <TOTEM:END>
           .

       CLOSE-tmp-sol2.
      * <TOTEM:EPT. INIT:solleciti, FD:tmp-sol2, BeforeClose>
      * <TOTEM:END>
           .

       CLOSE-tmp-ordf-art.
      * <TOTEM:EPT. INIT:solleciti, FD:tmp-ordf-art, BeforeClose>
      * <TOTEM:END>
           .

       CLOSE-tordforn.
      * <TOTEM:EPT. INIT:solleciti, FD:tordforn, BeforeClose>
      * <TOTEM:END>
           CLOSE tordforn
           .

       CLOSE-rordforn.
      * <TOTEM:EPT. INIT:solleciti, FD:rordforn, BeforeClose>
      * <TOTEM:END>
           CLOSE rordforn
           .

       CLOSE-tgrupgdo.
      * <TOTEM:EPT. INIT:solleciti, FD:tgrupgdo, BeforeClose>
      * <TOTEM:END>
           CLOSE tgrupgdo
           .

       CLOSE-sordforn.
      * <TOTEM:EPT. INIT:solleciti, FD:sordforn, BeforeClose>
      * <TOTEM:END>
           CLOSE sordforn
           .

       CLOSE-tcaumag.
      * <TOTEM:EPT. INIT:solleciti, FD:tcaumag, BeforeClose>
      * <TOTEM:END>
           CLOSE tcaumag
           .

       CLOSE-ttipocli.
      * <TOTEM:EPT. INIT:solleciti, FD:ttipocli, BeforeClose>
      * <TOTEM:END>
           CLOSE ttipocli
           .

       DataSet1-agenti-INITSTART.
           IF DataSet1-agenti-KEY-Asc
              MOVE Low-Value TO age-chiave
           ELSE
              MOVE High-Value TO age-chiave
           END-IF
           .

       DataSet1-agenti-INITEND.
           IF DataSet1-agenti-KEY-Asc
              MOVE High-Value TO age-chiave
           ELSE
              MOVE Low-Value TO age-chiave
           END-IF
           .

      * agenti
       DataSet1-agenti-START.
           IF DataSet1-agenti-KEY-Asc
              START agenti KEY >= age-chiave
           ELSE
              START agenti KEY <= age-chiave
           END-IF
           .

       DataSet1-agenti-START-NOTGREATER.
           IF DataSet1-agenti-KEY-Asc
              START agenti KEY <= age-chiave
           ELSE
              START agenti KEY >= age-chiave
           END-IF
           .

       DataSet1-agenti-START-GREATER.
           IF DataSet1-agenti-KEY-Asc
              START agenti KEY > age-chiave
           ELSE
              START agenti KEY < age-chiave
           END-IF
           .

       DataSet1-agenti-START-LESS.
           IF DataSet1-agenti-KEY-Asc
              START agenti KEY < age-chiave
           ELSE
              START agenti KEY > age-chiave
           END-IF
           .

       DataSet1-agenti-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-agenti-LOCK
              READ agenti WITH LOCK 
              KEY age-chiave
           ELSE
              READ agenti WITH NO LOCK 
              KEY age-chiave
           END-IF
           MOVE STATUS-agenti TO TOTEM-ERR-STAT 
           MOVE "agenti" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-agenti-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-agenti-KEY-Asc
              IF DataSet1-agenti-LOCK
                 READ agenti NEXT WITH LOCK
              ELSE
                 READ agenti NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-agenti-LOCK
                 READ agenti PREVIOUS WITH LOCK
              ELSE
                 READ agenti PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-agenti TO TOTEM-ERR-STAT
           MOVE "agenti" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-agenti-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-agenti-KEY-Asc
              IF DataSet1-agenti-LOCK
                 READ agenti PREVIOUS WITH LOCK
              ELSE
                 READ agenti PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-agenti-LOCK
                 READ agenti NEXT WITH LOCK
              ELSE
                 READ agenti NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-agenti TO TOTEM-ERR-STAT
           MOVE "agenti" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-agenti-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-agenti TO TOTEM-ERR-STAT
           MOVE "agenti" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-agenti-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-agenti TO TOTEM-ERR-STAT
           MOVE "agenti" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-agenti-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-agenti TO TOTEM-ERR-STAT
           MOVE "agenti" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, AfterDelete>
      * <TOTEM:END>
           .

       tordini-k-causale-MERGE-SPLITBUF.
           INITIALIZE tordini-k-causale-SPLITBUF
           MOVE tor-causale(1:4) TO tordini-k-causale-SPLITBUF(1:4)
           MOVE tor-anno(1:4) TO tordini-k-causale-SPLITBUF(5:4)
           MOVE tor-numero(1:8) TO tordini-k-causale-SPLITBUF(9:8)
           .

       tordini-k1-MERGE-SPLITBUF.
           INITIALIZE tordini-k1-SPLITBUF
           MOVE tor-cod-cli(1:5) TO tordini-k1-SPLITBUF(1:5)
           MOVE tor-prg-destino(1:5) TO tordini-k1-SPLITBUF(6:5)
           MOVE tor-anno(1:4) TO tordini-k1-SPLITBUF(11:4)
           MOVE tor-numero(1:8) TO tordini-k1-SPLITBUF(15:8)
           .

       tordini-k2-MERGE-SPLITBUF.
           INITIALIZE tordini-k2-SPLITBUF
           MOVE tor-data-passaggio-ordine(1:8) TO 
           tordini-k2-SPLITBUF(1:8)
           MOVE tor-anno(1:4) TO tordini-k2-SPLITBUF(9:4)
           MOVE tor-numero(1:8) TO tordini-k2-SPLITBUF(13:8)
           .

       tordini-k-bolla-MERGE-SPLITBUF.
           INITIALIZE tordini-k-bolla-SPLITBUF
           MOVE tor-anno-bolla(1:4) TO tordini-k-bolla-SPLITBUF(1:4)
           MOVE tor-num-bolla(1:8) TO tordini-k-bolla-SPLITBUF(5:8)
           .

       tordini-k3-MERGE-SPLITBUF.
           INITIALIZE tordini-k3-SPLITBUF
           MOVE tor-anno-bolla(1:4) TO tordini-k3-SPLITBUF(1:4)
           MOVE tor-data-bolla(1:8) TO tordini-k3-SPLITBUF(5:8)
           MOVE tor-num-bolla(1:8) TO tordini-k3-SPLITBUF(13:8)
           MOVE tor-bolla-prenotata(1:1) TO tordini-k3-SPLITBUF(21:1)
           .

       tordini-k-fattura-MERGE-SPLITBUF.
           INITIALIZE tordini-k-fattura-SPLITBUF
           MOVE tor-anno-fattura(1:4) TO tordini-k-fattura-SPLITBUF(1:4)
           MOVE tor-num-fattura(1:8) TO tordini-k-fattura-SPLITBUF(5:8)
           .

       tordini-k4-MERGE-SPLITBUF.
           INITIALIZE tordini-k4-SPLITBUF
           MOVE tor-anno-fattura(1:4) TO tordini-k4-SPLITBUF(1:4)
           MOVE tor-data-fattura(1:8) TO tordini-k4-SPLITBUF(5:8)
           MOVE tor-num-fattura(1:8) TO tordini-k4-SPLITBUF(13:8)
           MOVE tor-num-prenot(1:8) TO tordini-k4-SPLITBUF(21:8)
           MOVE tor-fatt-prenotata(1:1) TO tordini-k4-SPLITBUF(29:1)
           .

       tordini-k-contab-MERGE-SPLITBUF.
           INITIALIZE tordini-k-contab-SPLITBUF
           MOVE tor-agg-contab(1:1) TO tordini-k-contab-SPLITBUF(1:1)
           MOVE tor-anno-fattura(1:4) TO tordini-k-contab-SPLITBUF(2:4)
           MOVE tor-num-fattura(1:8) TO tordini-k-contab-SPLITBUF(6:8)
           .

       tordini-k-tipo-MERGE-SPLITBUF.
           INITIALIZE tordini-k-tipo-SPLITBUF
           MOVE tor-tipo(1:1) TO tordini-k-tipo-SPLITBUF(1:1)
           MOVE tor-chiave(1:12) TO tordini-k-tipo-SPLITBUF(2:12)
           .

       tordini-k-data-MERGE-SPLITBUF.
           INITIALIZE tordini-k-data-SPLITBUF
           MOVE tor-data-creazione(1:8) TO tordini-k-data-SPLITBUF(1:8)
           MOVE tor-numero(1:8) TO tordini-k-data-SPLITBUF(9:8)
           .

       tordini-k-agfatt-MERGE-SPLITBUF.
           INITIALIZE tordini-k-agfatt-SPLITBUF
           MOVE tor-anno-fattura(1:4) TO tordini-k-agfatt-SPLITBUF(1:4)
           MOVE tor-data-fattura(1:8) TO tordini-k-agfatt-SPLITBUF(5:8)
           MOVE tor-num-fattura(1:8) TO tordini-k-agfatt-SPLITBUF(13:8)
           MOVE tor-num-prenot(1:8) TO tordini-k-agfatt-SPLITBUF(21:8)
           MOVE tor-fatt-prenotata(1:1) TO 
           tordini-k-agfatt-SPLITBUF(29:1)
           MOVE tor-chiave(1:12) TO tordini-k-agfatt-SPLITBUF(30:12)
           .

       tordini-k-stbolle-MERGE-SPLITBUF.
           INITIALIZE tordini-k-stbolle-SPLITBUF
           MOVE tor-anno-bolla(1:4) TO tordini-k-stbolle-SPLITBUF(1:4)
           MOVE tor-data-bolla(1:8) TO tordini-k-stbolle-SPLITBUF(5:8)
           MOVE tor-num-bolla(1:8) TO tordini-k-stbolle-SPLITBUF(13:8)
           MOVE tor-bolla-prenotata(1:1) TO 
           tordini-k-stbolle-SPLITBUF(21:1)
           MOVE tor-chiave(1:12) TO tordini-k-stbolle-SPLITBUF(22:12)
           .

       tordini-k-andamento-data-MERGE-SPLITBUF.
           INITIALIZE tordini-k-andamento-data-SPLITBUF
           MOVE tor-agg-contab(1:1) TO 
           tordini-k-andamento-data-SPLITBUF(1:1)
           MOVE tor-data-fattura(1:8) TO 
           tordini-k-andamento-data-SPLITBUF(2:8)
           .

       tordini-k-andamento-cliente-MERGE-SPLITBUF.
           INITIALIZE tordini-k-andamento-cliente-SPLITBUF
           MOVE tor-cod-cli(1:5) TO 
           tordini-k-andamento-cliente-SPLITBUF(1:5)
           MOVE tor-agg-contab(1:1) TO 
           tordini-k-andamento-cliente-SPLITBUF(6:1)
           MOVE tor-data-fattura(1:8) TO 
           tordini-k-andamento-cliente-SPLITBUF(7:8)
           .

       tordini-k-andamento-clides-MERGE-SPLITBUF.
           INITIALIZE tordini-k-andamento-clides-SPLITBUF
           MOVE tor-cod-cli(1:5) TO 
           tordini-k-andamento-clides-SPLITBUF(1:5)
           MOVE tor-prg-destino(1:5) TO 
           tordini-k-andamento-clides-SPLITBUF(6:5)
           MOVE tor-agg-contab(1:1) TO 
           tordini-k-andamento-clides-SPLITBUF(11:1)
           MOVE tor-data-fattura(1:8) TO 
           tordini-k-andamento-clides-SPLITBUF(12:8)
           .

       tordini-k-promo-MERGE-SPLITBUF.
           INITIALIZE tordini-k-promo-SPLITBUF
           MOVE tor-stato(1:1) TO tordini-k-promo-SPLITBUF(1:1)
           MOVE tor-promo(1:1) TO tordini-k-promo-SPLITBUF(2:1)
           MOVE tor-data-ordine(1:8) TO tordini-k-promo-SPLITBUF(3:8)
           MOVE tor-numero(1:8) TO tordini-k-promo-SPLITBUF(11:8)
           MOVE tor-cod-cli(1:5) TO tordini-k-promo-SPLITBUF(19:5)
           MOVE tor-prg-destino(1:5) TO tordini-k-promo-SPLITBUF(24:5)
           .

       tordini-k-or-MERGE-SPLITBUF.
           INITIALIZE tordini-k-or-SPLITBUF
           MOVE tor-cod-cli(1:5) TO tordini-k-or-SPLITBUF(1:5)
           MOVE tor-prg-destino(1:5) TO tordini-k-or-SPLITBUF(6:5)
           MOVE tor-num-ord-cli(1:50) TO tordini-k-or-SPLITBUF(11:50)
           .

       tordini-k-tor-inviare-MERGE-SPLITBUF.
           INITIALIZE tordini-k-tor-inviare-SPLITBUF
           MOVE tor-da-inviare OF tordini(1:1) TO 
           tordini-k-tor-inviare-SPLITBUF(1:1)
           MOVE tor-chiave OF tordini(1:12) TO 
           tordini-k-tor-inviare-SPLITBUF(2:12)
           .

       tordini-k-tor-tipocli-MERGE-SPLITBUF.
           INITIALIZE tordini-k-tor-tipocli-SPLITBUF
           MOVE tor-tipocli OF tordini(1:2) TO 
           tordini-k-tor-tipocli-SPLITBUF(1:2)
           MOVE tor-cod-cli OF tordini(1:5) TO 
           tordini-k-tor-tipocli-SPLITBUF(3:5)
           MOVE tor-prg-destino OF tordini(1:5) TO 
           tordini-k-tor-tipocli-SPLITBUF(8:5)
           MOVE tor-chiave OF tordini(1:12) TO 
           tordini-k-tor-tipocli-SPLITBUF(13:12)
           .

       tordini-k-tor-gdo-MERGE-SPLITBUF.
           INITIALIZE tordini-k-tor-gdo-SPLITBUF
           MOVE tor-gdo OF tordini(1:5) TO 
           tordini-k-tor-gdo-SPLITBUF(1:5)
           MOVE tor-cod-cli OF tordini(1:5) TO 
           tordini-k-tor-gdo-SPLITBUF(6:5)
           MOVE tor-prg-destino OF tordini(1:5) TO 
           tordini-k-tor-gdo-SPLITBUF(11:5)
           MOVE tor-chiave OF tordini(1:12) TO 
           tordini-k-tor-gdo-SPLITBUF(16:12)
           .

       DataSet1-tordini-INITSTART.
           IF DataSet1-tordini-KEY-Asc
              MOVE Low-Value TO tor-chiave
           ELSE
              MOVE High-Value TO tor-chiave
           END-IF
           .

       DataSet1-tordini-INITEND.
           IF DataSet1-tordini-KEY-Asc
              MOVE High-Value TO tor-chiave
           ELSE
              MOVE Low-Value TO tor-chiave
           END-IF
           .

      * tordini
       DataSet1-tordini-START.
           IF DataSet1-tordini-KEY-Asc
              START tordini KEY >= tor-chiave
           ELSE
              START tordini KEY <= tor-chiave
           END-IF
           .

       DataSet1-tordini-START-NOTGREATER.
           IF DataSet1-tordini-KEY-Asc
              START tordini KEY <= tor-chiave
           ELSE
              START tordini KEY >= tor-chiave
           END-IF
           .

       DataSet1-tordini-START-GREATER.
           IF DataSet1-tordini-KEY-Asc
              START tordini KEY > tor-chiave
           ELSE
              START tordini KEY < tor-chiave
           END-IF
           .

       DataSet1-tordini-START-LESS.
           IF DataSet1-tordini-KEY-Asc
              START tordini KEY < tor-chiave
           ELSE
              START tordini KEY > tor-chiave
           END-IF
           .

       DataSet1-tordini-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tordini-LOCK
              READ tordini WITH LOCK 
              KEY tor-chiave
           ELSE
              READ tordini WITH NO LOCK 
              KEY tor-chiave
           END-IF
           PERFORM tordini-k-causale-MERGE-SPLITBUF
           PERFORM tordini-k1-MERGE-SPLITBUF
           PERFORM tordini-k2-MERGE-SPLITBUF
           PERFORM tordini-k-bolla-MERGE-SPLITBUF
           PERFORM tordini-k3-MERGE-SPLITBUF
           PERFORM tordini-k-fattura-MERGE-SPLITBUF
           PERFORM tordini-k4-MERGE-SPLITBUF
           PERFORM tordini-k-contab-MERGE-SPLITBUF
           PERFORM tordini-k-tipo-MERGE-SPLITBUF
           PERFORM tordini-k-data-MERGE-SPLITBUF
           PERFORM tordini-k-agfatt-MERGE-SPLITBUF
           PERFORM tordini-k-stbolle-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-data-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-cliente-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-clides-MERGE-SPLITBUF
           PERFORM tordini-k-promo-MERGE-SPLITBUF
           PERFORM tordini-k-or-MERGE-SPLITBUF
           PERFORM tordini-k-tor-inviare-MERGE-SPLITBUF
           PERFORM tordini-k-tor-tipocli-MERGE-SPLITBUF
           PERFORM tordini-k-tor-gdo-MERGE-SPLITBUF
           MOVE STATUS-tordini TO TOTEM-ERR-STAT 
           MOVE "tordini" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tordini-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tordini-KEY-Asc
              IF DataSet1-tordini-LOCK
                 READ tordini NEXT WITH LOCK
              ELSE
                 READ tordini NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tordini-LOCK
                 READ tordini PREVIOUS WITH LOCK
              ELSE
                 READ tordini PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tordini-k-causale-MERGE-SPLITBUF
           PERFORM tordini-k1-MERGE-SPLITBUF
           PERFORM tordini-k2-MERGE-SPLITBUF
           PERFORM tordini-k-bolla-MERGE-SPLITBUF
           PERFORM tordini-k3-MERGE-SPLITBUF
           PERFORM tordini-k-fattura-MERGE-SPLITBUF
           PERFORM tordini-k4-MERGE-SPLITBUF
           PERFORM tordini-k-contab-MERGE-SPLITBUF
           PERFORM tordini-k-tipo-MERGE-SPLITBUF
           PERFORM tordini-k-data-MERGE-SPLITBUF
           PERFORM tordini-k-agfatt-MERGE-SPLITBUF
           PERFORM tordini-k-stbolle-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-data-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-cliente-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-clides-MERGE-SPLITBUF
           PERFORM tordini-k-promo-MERGE-SPLITBUF
           PERFORM tordini-k-or-MERGE-SPLITBUF
           PERFORM tordini-k-tor-inviare-MERGE-SPLITBUF
           PERFORM tordini-k-tor-tipocli-MERGE-SPLITBUF
           PERFORM tordini-k-tor-gdo-MERGE-SPLITBUF
           MOVE STATUS-tordini TO TOTEM-ERR-STAT
           MOVE "tordini" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tordini-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tordini-KEY-Asc
              IF DataSet1-tordini-LOCK
                 READ tordini PREVIOUS WITH LOCK
              ELSE
                 READ tordini PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tordini-LOCK
                 READ tordini NEXT WITH LOCK
              ELSE
                 READ tordini NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tordini-k-causale-MERGE-SPLITBUF
           PERFORM tordini-k1-MERGE-SPLITBUF
           PERFORM tordini-k2-MERGE-SPLITBUF
           PERFORM tordini-k-bolla-MERGE-SPLITBUF
           PERFORM tordini-k3-MERGE-SPLITBUF
           PERFORM tordini-k-fattura-MERGE-SPLITBUF
           PERFORM tordini-k4-MERGE-SPLITBUF
           PERFORM tordini-k-contab-MERGE-SPLITBUF
           PERFORM tordini-k-tipo-MERGE-SPLITBUF
           PERFORM tordini-k-data-MERGE-SPLITBUF
           PERFORM tordini-k-agfatt-MERGE-SPLITBUF
           PERFORM tordini-k-stbolle-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-data-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-cliente-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-clides-MERGE-SPLITBUF
           PERFORM tordini-k-promo-MERGE-SPLITBUF
           PERFORM tordini-k-or-MERGE-SPLITBUF
           PERFORM tordini-k-tor-inviare-MERGE-SPLITBUF
           PERFORM tordini-k-tor-tipocli-MERGE-SPLITBUF
           PERFORM tordini-k-tor-gdo-MERGE-SPLITBUF
           MOVE STATUS-tordini TO TOTEM-ERR-STAT
           MOVE "tordini" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tordini-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tordini TO TOTEM-ERR-STAT
           MOVE "tordini" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tordini-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tordini TO TOTEM-ERR-STAT
           MOVE "tordini" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tordini-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tordini TO TOTEM-ERR-STAT
           MOVE "tordini" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterDelete>
      * <TOTEM:END>
           .

       mtordini-mto-k-ord-cli-MERGE-SPLITBUF.
           INITIALIZE mtordini-mto-k-ord-cli-SPLITBUF
           MOVE mto-anno(1:4) TO mtordini-mto-k-ord-cli-SPLITBUF(1:4)
           MOVE mto-num-ord-cli(1:50) TO 
           mtordini-mto-k-ord-cli-SPLITBUF(5:50)
           .

       mtordini-mto-k-data-MERGE-SPLITBUF.
           INITIALIZE mtordini-mto-k-data-SPLITBUF
           MOVE mto-data-ordine(1:8) TO 
           mtordini-mto-k-data-SPLITBUF(1:8)
           MOVE mto-chiave(1:12) TO mtordini-mto-k-data-SPLITBUF(9:12)
           .

       mtordini-mto-k-clides-MERGE-SPLITBUF.
           INITIALIZE mtordini-mto-k-clides-SPLITBUF
           MOVE mto-cod-cli(1:5) TO mtordini-mto-k-clides-SPLITBUF(1:5)
           MOVE mto-prg-destino(1:5) TO 
           mtordini-mto-k-clides-SPLITBUF(6:5)
           MOVE mto-data-ordine(1:8) TO 
           mtordini-mto-k-clides-SPLITBUF(11:8)
           .

       mtordini-mto-k-age-MERGE-SPLITBUF.
           INITIALIZE mtordini-mto-k-age-SPLITBUF
           MOVE mto-cod-agente(1:5) TO mtordini-mto-k-age-SPLITBUF(1:5)
           MOVE mto-data-ordine(1:8) TO mtordini-mto-k-age-SPLITBUF(6:8)
           .

       mtordini-k-mto-stato-sel-MERGE-SPLITBUF.
           INITIALIZE mtordini-k-mto-stato-sel-SPLITBUF
           MOVE mto-stato-ordine(1:1) TO 
           mtordini-k-mto-stato-sel-SPLITBUF(1:1)
           MOVE mto-cod-cli(1:5) TO 
           mtordini-k-mto-stato-sel-SPLITBUF(2:5)
           MOVE mto-data-ordine(1:8) TO 
           mtordini-k-mto-stato-sel-SPLITBUF(7:8)
           .

       mtordini-k-mto-stato-MERGE-SPLITBUF.
           INITIALIZE mtordini-k-mto-stato-SPLITBUF
           MOVE mto-stato-ordine(1:1) TO 
           mtordini-k-mto-stato-SPLITBUF(1:1)
           MOVE mto-chiave(1:12) TO mtordini-k-mto-stato-SPLITBUF(2:12)
           .

       mtordini-mto-k-gdo-MERGE-SPLITBUF.
           INITIALIZE mtordini-mto-k-gdo-SPLITBUF
           MOVE mto-gdo(1:5) TO mtordini-mto-k-gdo-SPLITBUF(1:5)
           MOVE mto-data-ordine(1:8) TO mtordini-mto-k-gdo-SPLITBUF(6:8)
           MOVE mto-chiave(1:12) TO mtordini-mto-k-gdo-SPLITBUF(14:12)
           .

       mtordini-mto-k-bloc-MERGE-SPLITBUF.
           INITIALIZE mtordini-mto-k-bloc-SPLITBUF
           MOVE mto-stato-attivazione(1:1) TO 
           mtordini-mto-k-bloc-SPLITBUF(1:1)
           MOVE mto-data-ordine(1:8) TO 
           mtordini-mto-k-bloc-SPLITBUF(2:8)
           MOVE mto-cod-cli(1:5) TO mtordini-mto-k-bloc-SPLITBUF(10:5)
           MOVE mto-prg-destino(1:5) TO 
           mtordini-mto-k-bloc-SPLITBUF(15:5)
           .

       mtordini-k-giang-MERGE-SPLITBUF.
           INITIALIZE mtordini-k-giang-SPLITBUF
           MOVE mto-data-note1(1:8) TO mtordini-k-giang-SPLITBUF(1:8)
           MOVE mto-chiave(1:12) TO mtordini-k-giang-SPLITBUF(9:12)
           .

       mtordini-mto-k-promo-MERGE-SPLITBUF.
           INITIALIZE mtordini-mto-k-promo-SPLITBUF
           MOVE mto-promo(1:1) TO mtordini-mto-k-promo-SPLITBUF(1:1)
           MOVE mto-tipo-CF(1:1) TO mtordini-mto-k-promo-SPLITBUF(2:1)
           MOVE mto-cod-cli(1:5) TO mtordini-mto-k-promo-SPLITBUF(3:5)
           MOVE mto-prg-destino(1:5) TO 
           mtordini-mto-k-promo-SPLITBUF(8:5)
           MOVE mto-chiave(1:12) TO mtordini-mto-k-promo-SPLITBUF(13:12)
           .

       DataSet1-mtordini-INITSTART.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-mtordini-KEY1-Asc
                 MOVE Low-Value TO mto-chiave
              ELSE
                 MOVE High-Value TO mto-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-mtordini-INITEND.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-mtordini-KEY1-Asc
                 MOVE High-Value TO mto-chiave
              ELSE
                 MOVE Low-Value TO mto-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           .   

       DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-mtordini-KEY1-ORDER
           END-EVALUATE
           .

       DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-mtordini-KEY1-ORDER
           END-EVALUATE
           .

      * mtordini
       DataSet1-mtordini-START.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-mtordini-KEY1-Asc
                 START mtordini KEY >= mto-chiave
              ELSE
                 START mtordini KEY <= mto-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-mtordini-START-NOTGREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-mtordini-KEY1-Asc
                 START mtordini KEY <= mto-chiave
              ELSE
                 START mtordini KEY >= mto-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-mtordini-START-GREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-mtordini-KEY1-Asc
                 START mtordini KEY > mto-chiave
              ELSE
                 START mtordini KEY < mto-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-mtordini-START-LESS.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-mtordini-KEY1-Asc
                 START mtordini KEY < mto-chiave
              ELSE
                 START mtordini KEY > mto-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-mtordini-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, BeforeReadRecord>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-mtordini-LOCK
                 READ mtordini WITH LOCK 
                 KEY mto-chiave
              ELSE
                 READ mtordini WITH NO LOCK 
                 KEY mto-chiave
              END-IF
           END-EVALUATE
           PERFORM mtordini-mto-k-ord-cli-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-data-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-clides-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-age-MERGE-SPLITBUF
           PERFORM mtordini-k-mto-stato-sel-MERGE-SPLITBUF
           PERFORM mtordini-k-mto-stato-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-gdo-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-bloc-MERGE-SPLITBUF
           PERFORM mtordini-k-giang-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-promo-MERGE-SPLITBUF
           MOVE STATUS-mtordini TO TOTEM-ERR-STAT 
           MOVE "mtordini" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-mtordini-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, BeforeReadNext>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-mtordini-KEY1-Asc
                 IF DataSet1-mtordini-LOCK
                    READ mtordini NEXT WITH LOCK
                 ELSE
                    READ mtordini NEXT WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-mtordini-LOCK
                    READ mtordini PREVIOUS WITH LOCK
                 ELSE
                    READ mtordini PREVIOUS WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           PERFORM mtordini-mto-k-ord-cli-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-data-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-clides-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-age-MERGE-SPLITBUF
           PERFORM mtordini-k-mto-stato-sel-MERGE-SPLITBUF
           PERFORM mtordini-k-mto-stato-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-gdo-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-bloc-MERGE-SPLITBUF
           PERFORM mtordini-k-giang-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-promo-MERGE-SPLITBUF
           MOVE STATUS-mtordini TO TOTEM-ERR-STAT
           MOVE "mtordini" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-mtordini-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, BeforeReadPrev>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-mtordini-KEY1-Asc
                 IF DataSet1-mtordini-LOCK
                    READ mtordini PREVIOUS WITH LOCK
                 ELSE
                    READ mtordini PREVIOUS WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-mtordini-LOCK
                    READ mtordini NEXT WITH LOCK
                 ELSE
                    READ mtordini NEXT WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           PERFORM mtordini-mto-k-ord-cli-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-data-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-clides-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-age-MERGE-SPLITBUF
           PERFORM mtordini-k-mto-stato-sel-MERGE-SPLITBUF
           PERFORM mtordini-k-mto-stato-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-gdo-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-bloc-MERGE-SPLITBUF
           PERFORM mtordini-k-giang-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-promo-MERGE-SPLITBUF
           MOVE STATUS-mtordini TO TOTEM-ERR-STAT
           MOVE "mtordini" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-mtordini-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-mtordini TO TOTEM-ERR-STAT
           MOVE "mtordini" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-mtordini-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-mtordini TO TOTEM-ERR-STAT
           MOVE "mtordini" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-mtordini-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-mtordini TO TOTEM-ERR-STAT
           MOVE "mtordini" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, AfterDelete>
      * <TOTEM:END>
           .

       mrordini-mro-k-promo-MERGE-SPLITBUF.
           INITIALIZE mrordini-mro-k-promo-SPLITBUF
           MOVE mro-promo(1:15) TO mrordini-mro-k-promo-SPLITBUF(1:15)
           MOVE mro-chiave(1:17) TO mrordini-mro-k-promo-SPLITBUF(16:17)
           .

       mrordini-mro-k-articolo-MERGE-SPLITBUF.
           INITIALIZE mrordini-mro-k-articolo-SPLITBUF
           MOVE mro-cod-articolo(1:6) TO 
           mrordini-mro-k-articolo-SPLITBUF(1:6)
           MOVE mro-chiave(1:17) TO 
           mrordini-mro-k-articolo-SPLITBUF(7:17)
           .

       mrordini-mro-k-progr-MERGE-SPLITBUF.
           INITIALIZE mrordini-mro-k-progr-SPLITBUF
           MOVE mro-chiave-testa(1:12) TO 
           mrordini-mro-k-progr-SPLITBUF(1:12)
           MOVE mro-progr(1:5) TO mrordini-mro-k-progr-SPLITBUF(13:5)
           .

       mrordini-mro-k-tprev-MERGE-SPLITBUF.
           INITIALIZE mrordini-mro-k-tprev-SPLITBUF
           MOVE mro-promo(1:15) TO mrordini-mro-k-tprev-SPLITBUF(1:15)
           MOVE mro-prg-cod-articolo(1:6) TO 
           mrordini-mro-k-tprev-SPLITBUF(16:6)
           MOVE mro-chiave(1:17) TO mrordini-mro-k-tprev-SPLITBUF(22:17)
           .

       mrordini-mro-k-ord-art-MERGE-SPLITBUF.
           INITIALIZE mrordini-mro-k-ord-art-SPLITBUF
           MOVE mro-chiave-testa(1:12) TO 
           mrordini-mro-k-ord-art-SPLITBUF(1:12)
           MOVE mro-cod-articolo(1:6) TO 
           mrordini-mro-k-ord-art-SPLITBUF(13:6)
           .

       DataSet1-mrordini-INITSTART.
           IF DataSet1-mrordini-KEY-Asc
              MOVE Low-Value TO mro-chiave
           ELSE
              MOVE High-Value TO mro-chiave
           END-IF
           .

       DataSet1-mrordini-INITEND.
           IF DataSet1-mrordini-KEY-Asc
              MOVE High-Value TO mro-chiave
           ELSE
              MOVE Low-Value TO mro-chiave
           END-IF
           .

      * mrordini
       DataSet1-mrordini-START.
           IF DataSet1-mrordini-KEY-Asc
              START mrordini KEY >= mro-chiave
           ELSE
              START mrordini KEY <= mro-chiave
           END-IF
           .

       DataSet1-mrordini-START-NOTGREATER.
           IF DataSet1-mrordini-KEY-Asc
              START mrordini KEY <= mro-chiave
           ELSE
              START mrordini KEY >= mro-chiave
           END-IF
           .

       DataSet1-mrordini-START-GREATER.
           IF DataSet1-mrordini-KEY-Asc
              START mrordini KEY > mro-chiave
           ELSE
              START mrordini KEY < mro-chiave
           END-IF
           .

       DataSet1-mrordini-START-LESS.
           IF DataSet1-mrordini-KEY-Asc
              START mrordini KEY < mro-chiave
           ELSE
              START mrordini KEY > mro-chiave
           END-IF
           .

       DataSet1-mrordini-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-mrordini-LOCK
              READ mrordini WITH LOCK 
              KEY mro-chiave
           ELSE
              READ mrordini WITH NO LOCK 
              KEY mro-chiave
           END-IF
           PERFORM mrordini-mro-k-promo-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-articolo-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-progr-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-tprev-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-ord-art-MERGE-SPLITBUF
           MOVE STATUS-mrordini TO TOTEM-ERR-STAT 
           MOVE "mrordini" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-mrordini-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-mrordini-KEY-Asc
              IF DataSet1-mrordini-LOCK
                 READ mrordini NEXT WITH LOCK
              ELSE
                 READ mrordini NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-mrordini-LOCK
                 READ mrordini PREVIOUS WITH LOCK
              ELSE
                 READ mrordini PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM mrordini-mro-k-promo-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-articolo-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-progr-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-tprev-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-ord-art-MERGE-SPLITBUF
           MOVE STATUS-mrordini TO TOTEM-ERR-STAT
           MOVE "mrordini" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-mrordini-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-mrordini-KEY-Asc
              IF DataSet1-mrordini-LOCK
                 READ mrordini PREVIOUS WITH LOCK
              ELSE
                 READ mrordini PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-mrordini-LOCK
                 READ mrordini NEXT WITH LOCK
              ELSE
                 READ mrordini NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM mrordini-mro-k-promo-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-articolo-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-progr-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-tprev-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-ord-art-MERGE-SPLITBUF
           MOVE STATUS-mrordini TO TOTEM-ERR-STAT
           MOVE "mrordini" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-mrordini-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-mrordini TO TOTEM-ERR-STAT
           MOVE "mrordini" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-mrordini-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-mrordini TO TOTEM-ERR-STAT
           MOVE "mrordini" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-mrordini-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-mrordini TO TOTEM-ERR-STAT
           MOVE "mrordini" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, AfterDelete>
      * <TOTEM:END>
           .

       articoli-art-k1-MERGE-SPLITBUF.
           INITIALIZE articoli-art-k1-SPLITBUF
           MOVE art-descrizione OF articoli(1:50) TO 
           articoli-art-k1-SPLITBUF(1:50)
           .

       articoli-art-k-frn-MERGE-SPLITBUF.
           INITIALIZE articoli-art-k-frn-SPLITBUF
           MOVE art-cod-art-frn OF articoli(1:15) TO 
           articoli-art-k-frn-SPLITBUF(1:15)
           .

       DataSet1-articoli-INITSTART.
           IF DataSet1-articoli-KEY-Asc
              MOVE Low-Value TO art-chiave OF articoli
           ELSE
              MOVE High-Value TO art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-INITEND.
           IF DataSet1-articoli-KEY-Asc
              MOVE High-Value TO art-chiave OF articoli
           ELSE
              MOVE Low-Value TO art-chiave OF articoli
           END-IF
           .

      * articoli
       DataSet1-articoli-START.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY >= art-chiave OF articoli
           ELSE
              START articoli KEY <= art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-START-NOTGREATER.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY <= art-chiave OF articoli
           ELSE
              START articoli KEY >= art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-START-GREATER.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY > art-chiave OF articoli
           ELSE
              START articoli KEY < art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-START-LESS.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY < art-chiave OF articoli
           ELSE
              START articoli KEY > art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-articoli-LOCK
              READ articoli WITH LOCK 
              KEY art-chiave OF articoli
           ELSE
              READ articoli WITH NO LOCK 
              KEY art-chiave OF articoli
           END-IF
           PERFORM articoli-art-k1-MERGE-SPLITBUF
           PERFORM articoli-art-k-frn-MERGE-SPLITBUF
           MOVE STATUS-articoli TO TOTEM-ERR-STAT 
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-articoli-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-articoli-KEY-Asc
              IF DataSet1-articoli-LOCK
                 READ articoli NEXT WITH LOCK
              ELSE
                 READ articoli NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-articoli-LOCK
                 READ articoli PREVIOUS WITH LOCK
              ELSE
                 READ articoli PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM articoli-art-k1-MERGE-SPLITBUF
           PERFORM articoli-art-k-frn-MERGE-SPLITBUF
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-articoli-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-articoli-KEY-Asc
              IF DataSet1-articoli-LOCK
                 READ articoli PREVIOUS WITH LOCK
              ELSE
                 READ articoli PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-articoli-LOCK
                 READ articoli NEXT WITH LOCK
              ELSE
                 READ articoli NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM articoli-art-k1-MERGE-SPLITBUF
           PERFORM articoli-art-k-frn-MERGE-SPLITBUF
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-articoli-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-articoli-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-articoli-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterDelete>
      * <TOTEM:END>
           .

       destini-K1-MERGE-SPLITBUF.
           INITIALIZE destini-K1-SPLITBUF
           MOVE des-ragsoc-1(1:100) TO destini-K1-SPLITBUF(1:100)
           MOVE des-codice(1:5) TO destini-K1-SPLITBUF(101:5)
           MOVE des-prog(1:5) TO destini-K1-SPLITBUF(106:5)
           .

       destini-k-localita-MERGE-SPLITBUF.
           INITIALIZE destini-k-localita-SPLITBUF
           MOVE des-localita(1:35) TO destini-k-localita-SPLITBUF(1:35)
           .

       DataSet1-destini-INITSTART.
           IF DataSet1-destini-KEY-Asc
              MOVE Low-Value TO des-chiave
           ELSE
              MOVE High-Value TO des-chiave
           END-IF
           .

       DataSet1-destini-INITEND.
           IF DataSet1-destini-KEY-Asc
              MOVE High-Value TO des-chiave
           ELSE
              MOVE Low-Value TO des-chiave
           END-IF
           .

      * destini
       DataSet1-destini-START.
           IF DataSet1-destini-KEY-Asc
              START destini KEY >= des-chiave
           ELSE
              START destini KEY <= des-chiave
           END-IF
           .

       DataSet1-destini-START-NOTGREATER.
           IF DataSet1-destini-KEY-Asc
              START destini KEY <= des-chiave
           ELSE
              START destini KEY >= des-chiave
           END-IF
           .

       DataSet1-destini-START-GREATER.
           IF DataSet1-destini-KEY-Asc
              START destini KEY > des-chiave
           ELSE
              START destini KEY < des-chiave
           END-IF
           .

       DataSet1-destini-START-LESS.
           IF DataSet1-destini-KEY-Asc
              START destini KEY < des-chiave
           ELSE
              START destini KEY > des-chiave
           END-IF
           .

       DataSet1-destini-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-destini-LOCK
              READ destini WITH LOCK 
              KEY des-chiave
           ELSE
              READ destini WITH NO LOCK 
              KEY des-chiave
           END-IF
           PERFORM destini-K1-MERGE-SPLITBUF
           PERFORM destini-k-localita-MERGE-SPLITBUF
           MOVE STATUS-destini TO TOTEM-ERR-STAT 
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-destini-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-destini-KEY-Asc
              IF DataSet1-destini-LOCK
                 READ destini NEXT WITH LOCK
              ELSE
                 READ destini NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-destini-LOCK
                 READ destini PREVIOUS WITH LOCK
              ELSE
                 READ destini PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM destini-K1-MERGE-SPLITBUF
           PERFORM destini-k-localita-MERGE-SPLITBUF
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-destini-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-destini-KEY-Asc
              IF DataSet1-destini-LOCK
                 READ destini PREVIOUS WITH LOCK
              ELSE
                 READ destini PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-destini-LOCK
                 READ destini NEXT WITH LOCK
              ELSE
                 READ destini NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM destini-K1-MERGE-SPLITBUF
           PERFORM destini-k-localita-MERGE-SPLITBUF
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-destini-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-destini-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-destini-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tescons-INITSTART.
           IF DataSet1-tescons-KEY-Asc
              MOVE Low-Value TO tec-chiave
           ELSE
              MOVE High-Value TO tec-chiave
           END-IF
           .

       DataSet1-tescons-INITEND.
           IF DataSet1-tescons-KEY-Asc
              MOVE High-Value TO tec-chiave
           ELSE
              MOVE Low-Value TO tec-chiave
           END-IF
           .

      * tescons
       DataSet1-tescons-START.
           IF DataSet1-tescons-KEY-Asc
              START tescons KEY >= tec-chiave
           ELSE
              START tescons KEY <= tec-chiave
           END-IF
           .

       DataSet1-tescons-START-NOTGREATER.
           IF DataSet1-tescons-KEY-Asc
              START tescons KEY <= tec-chiave
           ELSE
              START tescons KEY >= tec-chiave
           END-IF
           .

       DataSet1-tescons-START-GREATER.
           IF DataSet1-tescons-KEY-Asc
              START tescons KEY > tec-chiave
           ELSE
              START tescons KEY < tec-chiave
           END-IF
           .

       DataSet1-tescons-START-LESS.
           IF DataSet1-tescons-KEY-Asc
              START tescons KEY < tec-chiave
           ELSE
              START tescons KEY > tec-chiave
           END-IF
           .

       DataSet1-tescons-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tescons, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tescons, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tescons-LOCK
              READ tescons WITH LOCK 
              KEY tec-chiave
           ELSE
              READ tescons WITH NO LOCK 
              KEY tec-chiave
           END-IF
           MOVE STATUS-tescons TO TOTEM-ERR-STAT 
           MOVE "tescons" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tescons, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tescons, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tescons-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tescons, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tescons, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tescons-KEY-Asc
              IF DataSet1-tescons-LOCK
                 READ tescons NEXT WITH LOCK
              ELSE
                 READ tescons NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tescons-LOCK
                 READ tescons PREVIOUS WITH LOCK
              ELSE
                 READ tescons PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tescons TO TOTEM-ERR-STAT
           MOVE "tescons" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tescons, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tescons, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tescons-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tescons, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tescons, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tescons-KEY-Asc
              IF DataSet1-tescons-LOCK
                 READ tescons PREVIOUS WITH LOCK
              ELSE
                 READ tescons PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tescons-LOCK
                 READ tescons NEXT WITH LOCK
              ELSE
                 READ tescons NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tescons TO TOTEM-ERR-STAT
           MOVE "tescons" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tescons, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tescons, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tescons-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tescons, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tescons TO TOTEM-ERR-STAT
           MOVE "tescons" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tescons, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tescons-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tescons, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tescons TO TOTEM-ERR-STAT
           MOVE "tescons" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tescons, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tescons-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tescons, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tescons TO TOTEM-ERR-STAT
           MOVE "tescons" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tescons, AfterDelete>
      * <TOTEM:END>
           .

       clienti-cli-K1-MERGE-SPLITBUF.
           INITIALIZE clienti-cli-K1-SPLITBUF
           MOVE cli-tipo-CF OF clienti(1:1) TO 
           clienti-cli-K1-SPLITBUF(1:1)
           MOVE cli-ragsoc-1 OF clienti(1:40) TO 
           clienti-cli-K1-SPLITBUF(2:40)
           MOVE cli-codice OF clienti(1:5) TO 
           clienti-cli-K1-SPLITBUF(42:5)
           .

       clienti-cli-K3-MERGE-SPLITBUF.
           INITIALIZE clienti-cli-K3-SPLITBUF
           MOVE cli-gdo OF clienti(1:5) TO clienti-cli-K3-SPLITBUF(1:5)
           MOVE cli-chiave OF clienti(1:6) TO 
           clienti-cli-K3-SPLITBUF(6:6)
           .

       clienti-cli-K4-MERGE-SPLITBUF.
           INITIALIZE clienti-cli-K4-SPLITBUF
           MOVE cli-utf OF clienti(1:1) TO clienti-cli-K4-SPLITBUF(1:1)
           MOVE cli-chiave OF clienti(1:6) TO 
           clienti-cli-K4-SPLITBUF(2:6)
           .

       DataSet1-clienti-INITSTART.
           IF DataSet1-clienti-KEY-Asc
              MOVE Low-Value TO cli-chiave OF clienti
           ELSE
              MOVE High-Value TO cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-INITEND.
           IF DataSet1-clienti-KEY-Asc
              MOVE High-Value TO cli-chiave OF clienti
           ELSE
              MOVE Low-Value TO cli-chiave OF clienti
           END-IF
           .

      * clienti
       DataSet1-clienti-START.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY >= cli-chiave OF clienti
           ELSE
              START clienti KEY <= cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-START-NOTGREATER.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY <= cli-chiave OF clienti
           ELSE
              START clienti KEY >= cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-START-GREATER.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY > cli-chiave OF clienti
           ELSE
              START clienti KEY < cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-START-LESS.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY < cli-chiave OF clienti
           ELSE
              START clienti KEY > cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-clienti-LOCK
              READ clienti WITH LOCK 
              KEY cli-chiave OF clienti
           ELSE
              READ clienti WITH NO LOCK 
              KEY cli-chiave OF clienti
           END-IF
           PERFORM clienti-cli-K1-MERGE-SPLITBUF
           PERFORM clienti-cli-K3-MERGE-SPLITBUF
           PERFORM clienti-cli-K4-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT 
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-clienti-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-clienti-KEY-Asc
              IF DataSet1-clienti-LOCK
                 READ clienti NEXT WITH LOCK
              ELSE
                 READ clienti NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-clienti-LOCK
                 READ clienti PREVIOUS WITH LOCK
              ELSE
                 READ clienti PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM clienti-cli-K1-MERGE-SPLITBUF
           PERFORM clienti-cli-K3-MERGE-SPLITBUF
           PERFORM clienti-cli-K4-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-clienti-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-clienti-KEY-Asc
              IF DataSet1-clienti-LOCK
                 READ clienti PREVIOUS WITH LOCK
              ELSE
                 READ clienti PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-clienti-LOCK
                 READ clienti NEXT WITH LOCK
              ELSE
                 READ clienti NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM clienti-cli-K1-MERGE-SPLITBUF
           PERFORM clienti-cli-K3-MERGE-SPLITBUF
           PERFORM clienti-cli-K4-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterDelete>
      * <TOTEM:END>
           .

       tvettori-k-des-MERGE-SPLITBUF.
           INITIALIZE tvettori-k-des-SPLITBUF
           MOVE vet-descrizione(1:40) TO tvettori-k-des-SPLITBUF(1:40)
           .

       DataSet1-tvettori-INITSTART.
           IF DataSet1-tvettori-KEY-Asc
              MOVE Low-Value TO vet-chiave
           ELSE
              MOVE High-Value TO vet-chiave
           END-IF
           .

       DataSet1-tvettori-INITEND.
           IF DataSet1-tvettori-KEY-Asc
              MOVE High-Value TO vet-chiave
           ELSE
              MOVE Low-Value TO vet-chiave
           END-IF
           .

      * tvettori
       DataSet1-tvettori-START.
           IF DataSet1-tvettori-KEY-Asc
              START tvettori KEY >= vet-chiave
           ELSE
              START tvettori KEY <= vet-chiave
           END-IF
           .

       DataSet1-tvettori-START-NOTGREATER.
           IF DataSet1-tvettori-KEY-Asc
              START tvettori KEY <= vet-chiave
           ELSE
              START tvettori KEY >= vet-chiave
           END-IF
           .

       DataSet1-tvettori-START-GREATER.
           IF DataSet1-tvettori-KEY-Asc
              START tvettori KEY > vet-chiave
           ELSE
              START tvettori KEY < vet-chiave
           END-IF
           .

       DataSet1-tvettori-START-LESS.
           IF DataSet1-tvettori-KEY-Asc
              START tvettori KEY < vet-chiave
           ELSE
              START tvettori KEY > vet-chiave
           END-IF
           .

       DataSet1-tvettori-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tvettori-LOCK
              READ tvettori WITH LOCK 
              KEY vet-chiave
           ELSE
              READ tvettori WITH NO LOCK 
              KEY vet-chiave
           END-IF
           PERFORM tvettori-k-des-MERGE-SPLITBUF
           MOVE STATUS-tvettori TO TOTEM-ERR-STAT 
           MOVE "tvettori" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tvettori-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tvettori-KEY-Asc
              IF DataSet1-tvettori-LOCK
                 READ tvettori NEXT WITH LOCK
              ELSE
                 READ tvettori NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tvettori-LOCK
                 READ tvettori PREVIOUS WITH LOCK
              ELSE
                 READ tvettori PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tvettori-k-des-MERGE-SPLITBUF
           MOVE STATUS-tvettori TO TOTEM-ERR-STAT
           MOVE "tvettori" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tvettori-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tvettori-KEY-Asc
              IF DataSet1-tvettori-LOCK
                 READ tvettori PREVIOUS WITH LOCK
              ELSE
                 READ tvettori PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tvettori-LOCK
                 READ tvettori NEXT WITH LOCK
              ELSE
                 READ tvettori NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tvettori-k-des-MERGE-SPLITBUF
           MOVE STATUS-tvettori TO TOTEM-ERR-STAT
           MOVE "tvettori" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tvettori-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tvettori TO TOTEM-ERR-STAT
           MOVE "tvettori" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tvettori-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tvettori TO TOTEM-ERR-STAT
           MOVE "tvettori" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tvettori-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tvettori TO TOTEM-ERR-STAT
           MOVE "tvettori" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterDelete>
      * <TOTEM:END>
           .

       rordini-ror-k-promo-MERGE-SPLITBUF.
           INITIALIZE rordini-ror-k-promo-SPLITBUF
           MOVE ror-promo OF rordini(1:15) TO 
           rordini-ror-k-promo-SPLITBUF(1:15)
           .

       rordini-ror-k-articolo-MERGE-SPLITBUF.
           INITIALIZE rordini-ror-k-articolo-SPLITBUF
           MOVE ror-cod-articolo OF rordini(1:6) TO 
           rordini-ror-k-articolo-SPLITBUF(1:6)
           MOVE ror-chiave OF rordini(1:17) TO 
           rordini-ror-k-articolo-SPLITBUF(7:17)
           .

       rordini-ror-k-master-MERGE-SPLITBUF.
           INITIALIZE rordini-ror-k-master-SPLITBUF
           MOVE ror-chiave-ordine OF rordini(1:17) TO 
           rordini-ror-k-master-SPLITBUF(1:17)
           MOVE ror-chiave OF rordini(1:17) TO 
           rordini-ror-k-master-SPLITBUF(18:17)
           .

       rordini-ror-k-stbolle-MERGE-SPLITBUF.
           INITIALIZE rordini-ror-k-stbolle-SPLITBUF
           MOVE ror-anno OF rordini(1:4) TO 
           rordini-ror-k-stbolle-SPLITBUF(1:4)
           MOVE ror-num-ordine OF rordini(1:8) TO 
           rordini-ror-k-stbolle-SPLITBUF(5:8)
           MOVE ror-chiave-ordine OF rordini(1:17) TO 
           rordini-ror-k-stbolle-SPLITBUF(13:17)
           .

       rordini-ror-k-ord-art-MERGE-SPLITBUF.
           INITIALIZE rordini-ror-k-ord-art-SPLITBUF
           MOVE ror-anno OF rordini(1:4) TO 
           rordini-ror-k-ord-art-SPLITBUF(1:4)
           MOVE ror-num-ordine OF rordini(1:8) TO 
           rordini-ror-k-ord-art-SPLITBUF(5:8)
           MOVE ror-cod-articolo OF rordini(1:6) TO 
           rordini-ror-k-ord-art-SPLITBUF(13:6)
           .

       DataSet1-rordini-INITSTART.
           IF DataSet1-rordini-KEY-Asc
              MOVE Low-Value TO ror-chiave OF rordini
           ELSE
              MOVE High-Value TO ror-chiave OF rordini
           END-IF
           .

       DataSet1-rordini-INITEND.
           IF DataSet1-rordini-KEY-Asc
              MOVE High-Value TO ror-chiave OF rordini
           ELSE
              MOVE Low-Value TO ror-chiave OF rordini
           END-IF
           .

      * rordini
       DataSet1-rordini-START.
           IF DataSet1-rordini-KEY-Asc
              START rordini KEY >= ror-chiave OF rordini
           ELSE
              START rordini KEY <= ror-chiave OF rordini
           END-IF
           .

       DataSet1-rordini-START-NOTGREATER.
           IF DataSet1-rordini-KEY-Asc
              START rordini KEY <= ror-chiave OF rordini
           ELSE
              START rordini KEY >= ror-chiave OF rordini
           END-IF
           .

       DataSet1-rordini-START-GREATER.
           IF DataSet1-rordini-KEY-Asc
              START rordini KEY > ror-chiave OF rordini
           ELSE
              START rordini KEY < ror-chiave OF rordini
           END-IF
           .

       DataSet1-rordini-START-LESS.
           IF DataSet1-rordini-KEY-Asc
              START rordini KEY < ror-chiave OF rordini
           ELSE
              START rordini KEY > ror-chiave OF rordini
           END-IF
           .

       DataSet1-rordini-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-rordini-LOCK
              READ rordini WITH LOCK 
              KEY ror-chiave OF rordini
           ELSE
              READ rordini WITH NO LOCK 
              KEY ror-chiave OF rordini
           END-IF
           PERFORM rordini-ror-k-promo-MERGE-SPLITBUF
           PERFORM rordini-ror-k-articolo-MERGE-SPLITBUF
           PERFORM rordini-ror-k-master-MERGE-SPLITBUF
           PERFORM rordini-ror-k-stbolle-MERGE-SPLITBUF
           PERFORM rordini-ror-k-ord-art-MERGE-SPLITBUF
           MOVE STATUS-rordini TO TOTEM-ERR-STAT 
           MOVE "rordini" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-rordini-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-rordini-KEY-Asc
              IF DataSet1-rordini-LOCK
                 READ rordini NEXT WITH LOCK
              ELSE
                 READ rordini NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-rordini-LOCK
                 READ rordini PREVIOUS WITH LOCK
              ELSE
                 READ rordini PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM rordini-ror-k-promo-MERGE-SPLITBUF
           PERFORM rordini-ror-k-articolo-MERGE-SPLITBUF
           PERFORM rordini-ror-k-master-MERGE-SPLITBUF
           PERFORM rordini-ror-k-stbolle-MERGE-SPLITBUF
           PERFORM rordini-ror-k-ord-art-MERGE-SPLITBUF
           MOVE STATUS-rordini TO TOTEM-ERR-STAT
           MOVE "rordini" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-rordini-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-rordini-KEY-Asc
              IF DataSet1-rordini-LOCK
                 READ rordini PREVIOUS WITH LOCK
              ELSE
                 READ rordini PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-rordini-LOCK
                 READ rordini NEXT WITH LOCK
              ELSE
                 READ rordini NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM rordini-ror-k-promo-MERGE-SPLITBUF
           PERFORM rordini-ror-k-articolo-MERGE-SPLITBUF
           PERFORM rordini-ror-k-master-MERGE-SPLITBUF
           PERFORM rordini-ror-k-stbolle-MERGE-SPLITBUF
           PERFORM rordini-ror-k-ord-art-MERGE-SPLITBUF
           MOVE STATUS-rordini TO TOTEM-ERR-STAT
           MOVE "rordini" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-rordini-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-rordini TO TOTEM-ERR-STAT
           MOVE "rordini" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-rordini-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-rordini TO TOTEM-ERR-STAT
           MOVE "rordini" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-rordini-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-rordini TO TOTEM-ERR-STAT
           MOVE "rordini" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, AfterDelete>
      * <TOTEM:END>
           .

       tpromo-tpr-chiave-ricerca-MERGE-SPLITBUF.
           INITIALIZE tpromo-tpr-chiave-ricerca-SPLITBUF
           MOVE tpr-chiave-ricerca OF tpromo(1:21) TO 
           tpromo-tpr-chiave-ricerca-SPLITBUF(1:21)
           .

       tpromo-tpr-chiave-gdo-fine-MERGE-SPLITBUF.
           INITIALIZE tpromo-tpr-chiave-gdo-fine-SPLITBUF
           MOVE tpr-gdo OF tpromo(1:5) TO 
           tpromo-tpr-chiave-gdo-fine-SPLITBUF(1:5)
           MOVE tpr-fine-dpo OF tpromo(1:8) TO 
           tpromo-tpr-chiave-gdo-fine-SPLITBUF(6:8)
           MOVE tpr-ini-dpo OF tpromo(1:8) TO 
           tpromo-tpr-chiave-gdo-fine-SPLITBUF(14:8)
           .

       tpromo-tpr-chiave-fine-MERGE-SPLITBUF.
           INITIALIZE tpromo-tpr-chiave-fine-SPLITBUF
           MOVE tpr-fine-dpo OF tpromo(1:8) TO 
           tpromo-tpr-chiave-fine-SPLITBUF(1:8)
           MOVE tpr-ini-dpo OF tpromo(1:8) TO 
           tpromo-tpr-chiave-fine-SPLITBUF(9:8)
           MOVE tpr-gdo OF tpromo(1:5) TO 
           tpromo-tpr-chiave-fine-SPLITBUF(17:5)
           .

       tpromo-tpr-chiave-ini-MERGE-SPLITBUF.
           INITIALIZE tpromo-tpr-chiave-ini-SPLITBUF
           MOVE tpr-ini-dpo OF tpromo(1:8) TO 
           tpromo-tpr-chiave-ini-SPLITBUF(1:8)
           MOVE tpr-fine-dpo OF tpromo(1:8) TO 
           tpromo-tpr-chiave-ini-SPLITBUF(9:8)
           MOVE tpr-gdo OF tpromo(1:5) TO 
           tpromo-tpr-chiave-ini-SPLITBUF(17:5)
           .

       tpromo-tpr-chiave-volantino-MERGE-SPLITBUF.
           INITIALIZE tpromo-tpr-chiave-volantino-SPLITBUF
           MOVE tpr-ini-volantino OF tpromo(1:8) TO 
           tpromo-tpr-chiave-volantino-SPLITBUF(1:8)
           MOVE tpr-fine-volantino OF tpromo(1:8) TO 
           tpromo-tpr-chiave-volantino-SPLITBUF(9:8)
           MOVE tpr-gdo OF tpromo(1:5) TO 
           tpromo-tpr-chiave-volantino-SPLITBUF(17:5)
           .

       tpromo-tpr-k-fine-vol-MERGE-SPLITBUF.
           INITIALIZE tpromo-tpr-k-fine-vol-SPLITBUF
           MOVE tpr-fine-volantino OF tpromo(1:8) TO 
           tpromo-tpr-k-fine-vol-SPLITBUF(1:8)
           MOVE tpr-ini-volantino OF tpromo(1:8) TO 
           tpromo-tpr-k-fine-vol-SPLITBUF(9:8)
           MOVE tpr-gdo OF tpromo(1:5) TO 
           tpromo-tpr-k-fine-vol-SPLITBUF(17:5)
           .

       tpromo-tpr-k-data-ins-MERGE-SPLITBUF.
           INITIALIZE tpromo-tpr-k-data-ins-SPLITBUF
           MOVE tpr-data-creazione OF tpromo(1:8) TO 
           tpromo-tpr-k-data-ins-SPLITBUF(1:8)
           MOVE tpr-codice OF tpromo(1:15) TO 
           tpromo-tpr-k-data-ins-SPLITBUF(9:15)
           MOVE tpr-gdo OF tpromo(1:5) TO 
           tpromo-tpr-k-data-ins-SPLITBUF(24:5)
           .

       DataSet1-tpromo-INITSTART.
           IF DataSet1-tpromo-KEY-Asc
              MOVE Low-Value TO tpr-chiave OF tpromo
           ELSE
              MOVE High-Value TO tpr-chiave OF tpromo
           END-IF
           .

       DataSet1-tpromo-INITEND.
           IF DataSet1-tpromo-KEY-Asc
              MOVE High-Value TO tpr-chiave OF tpromo
           ELSE
              MOVE Low-Value TO tpr-chiave OF tpromo
           END-IF
           .

      * tpromo
       DataSet1-tpromo-START.
           IF DataSet1-tpromo-KEY-Asc
              START tpromo KEY >= tpr-chiave OF tpromo
           ELSE
              START tpromo KEY <= tpr-chiave OF tpromo
           END-IF
           .

       DataSet1-tpromo-START-NOTGREATER.
           IF DataSet1-tpromo-KEY-Asc
              START tpromo KEY <= tpr-chiave OF tpromo
           ELSE
              START tpromo KEY >= tpr-chiave OF tpromo
           END-IF
           .

       DataSet1-tpromo-START-GREATER.
           IF DataSet1-tpromo-KEY-Asc
              START tpromo KEY > tpr-chiave OF tpromo
           ELSE
              START tpromo KEY < tpr-chiave OF tpromo
           END-IF
           .

       DataSet1-tpromo-START-LESS.
           IF DataSet1-tpromo-KEY-Asc
              START tpromo KEY < tpr-chiave OF tpromo
           ELSE
              START tpromo KEY > tpr-chiave OF tpromo
           END-IF
           .

       DataSet1-tpromo-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tpromo-LOCK
              READ tpromo WITH LOCK 
              KEY tpr-chiave OF tpromo
           ELSE
              READ tpromo WITH NO LOCK 
              KEY tpr-chiave OF tpromo
           END-IF
           PERFORM tpromo-tpr-chiave-ricerca-MERGE-SPLITBUF
           PERFORM tpromo-tpr-chiave-gdo-fine-MERGE-SPLITBUF
           PERFORM tpromo-tpr-chiave-fine-MERGE-SPLITBUF
           PERFORM tpromo-tpr-chiave-ini-MERGE-SPLITBUF
           PERFORM tpromo-tpr-chiave-volantino-MERGE-SPLITBUF
           PERFORM tpromo-tpr-k-fine-vol-MERGE-SPLITBUF
           PERFORM tpromo-tpr-k-data-ins-MERGE-SPLITBUF
           MOVE STATUS-tpromo TO TOTEM-ERR-STAT 
           MOVE "tpromo" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tpromo-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tpromo-KEY-Asc
              IF DataSet1-tpromo-LOCK
                 READ tpromo NEXT WITH LOCK
              ELSE
                 READ tpromo NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tpromo-LOCK
                 READ tpromo PREVIOUS WITH LOCK
              ELSE
                 READ tpromo PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tpromo-tpr-chiave-ricerca-MERGE-SPLITBUF
           PERFORM tpromo-tpr-chiave-gdo-fine-MERGE-SPLITBUF
           PERFORM tpromo-tpr-chiave-fine-MERGE-SPLITBUF
           PERFORM tpromo-tpr-chiave-ini-MERGE-SPLITBUF
           PERFORM tpromo-tpr-chiave-volantino-MERGE-SPLITBUF
           PERFORM tpromo-tpr-k-fine-vol-MERGE-SPLITBUF
           PERFORM tpromo-tpr-k-data-ins-MERGE-SPLITBUF
           MOVE STATUS-tpromo TO TOTEM-ERR-STAT
           MOVE "tpromo" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tpromo-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tpromo-KEY-Asc
              IF DataSet1-tpromo-LOCK
                 READ tpromo PREVIOUS WITH LOCK
              ELSE
                 READ tpromo PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tpromo-LOCK
                 READ tpromo NEXT WITH LOCK
              ELSE
                 READ tpromo NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tpromo-tpr-chiave-ricerca-MERGE-SPLITBUF
           PERFORM tpromo-tpr-chiave-gdo-fine-MERGE-SPLITBUF
           PERFORM tpromo-tpr-chiave-fine-MERGE-SPLITBUF
           PERFORM tpromo-tpr-chiave-ini-MERGE-SPLITBUF
           PERFORM tpromo-tpr-chiave-volantino-MERGE-SPLITBUF
           PERFORM tpromo-tpr-k-fine-vol-MERGE-SPLITBUF
           PERFORM tpromo-tpr-k-data-ins-MERGE-SPLITBUF
           MOVE STATUS-tpromo TO TOTEM-ERR-STAT
           MOVE "tpromo" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tpromo-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tpromo TO TOTEM-ERR-STAT
           MOVE "tpromo" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tpromo-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tpromo TO TOTEM-ERR-STAT
           MOVE "tpromo" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tpromo-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tpromo TO TOTEM-ERR-STAT
           MOVE "tpromo" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, AfterDelete>
      * <TOTEM:END>
           .

       tmp-sol1-k-dt-testa-MERGE-SPLITBUF.
           INITIALIZE tmp-sol1-k-dt-testa-SPLITBUF
           MOVE sol-tipo OF tmp-sol(1:1) TO 
           tmp-sol1-k-dt-testa-SPLITBUF(1:1)
           MOVE sol-data-ordine OF tmp-sol(1:8) TO 
           tmp-sol1-k-dt-testa-SPLITBUF(2:8)
           MOVE sol-ordine OF tmp-sol(1:12) TO 
           tmp-sol1-k-dt-testa-SPLITBUF(10:12)
           .

       tmp-sol1-k-art-MERGE-SPLITBUF.
           INITIALIZE tmp-sol1-k-art-SPLITBUF
           MOVE sol-tipo OF tmp-sol(1:1) TO tmp-sol1-k-art-SPLITBUF(1:1)
           MOVE sol-ordine OF tmp-sol(1:12) TO 
           tmp-sol1-k-art-SPLITBUF(2:12)
           .

       tmp-sol1-k-eva-MERGE-SPLITBUF.
           INITIALIZE tmp-sol1-k-eva-SPLITBUF
           MOVE sol-tipo OF tmp-sol(1:1) TO tmp-sol1-k-eva-SPLITBUF(1:1)
           MOVE sol-ordine OF tmp-sol(1:12) TO 
           tmp-sol1-k-eva-SPLITBUF(2:12)
           MOVE sol-prog-art OF tmp-sol(1:8) TO 
           tmp-sol1-k-eva-SPLITBUF(14:8)
           MOVE sol-prog-eva OF tmp-sol(1:8) TO 
           tmp-sol1-k-eva-SPLITBUF(22:8)
           .

       DataSet1-tmp-sol1-INITSTART.
           IF DataSet1-tmp-sol1-KEY-Asc
              MOVE Low-Value TO sol-chiave OF tmp-sol1
           ELSE
              MOVE High-Value TO sol-chiave OF tmp-sol1
           END-IF
           .

       DataSet1-tmp-sol1-INITEND.
           IF DataSet1-tmp-sol1-KEY-Asc
              MOVE High-Value TO sol-chiave OF tmp-sol1
           ELSE
              MOVE Low-Value TO sol-chiave OF tmp-sol1
           END-IF
           .

      * tmp-sol1
       DataSet1-tmp-sol1-START.
           IF DataSet1-tmp-sol1-KEY-Asc
              START tmp-sol1 KEY >= sol-chiave OF tmp-sol1
           ELSE
              START tmp-sol1 KEY <= sol-chiave OF tmp-sol1
           END-IF
           .

       DataSet1-tmp-sol1-START-NOTGREATER.
           IF DataSet1-tmp-sol1-KEY-Asc
              START tmp-sol1 KEY <= sol-chiave OF tmp-sol1
           ELSE
              START tmp-sol1 KEY >= sol-chiave OF tmp-sol1
           END-IF
           .

       DataSet1-tmp-sol1-START-GREATER.
           IF DataSet1-tmp-sol1-KEY-Asc
              START tmp-sol1 KEY > sol-chiave OF tmp-sol1
           ELSE
              START tmp-sol1 KEY < sol-chiave OF tmp-sol1
           END-IF
           .

       DataSet1-tmp-sol1-START-LESS.
           IF DataSet1-tmp-sol1-KEY-Asc
              START tmp-sol1 KEY < sol-chiave OF tmp-sol1
           ELSE
              START tmp-sol1 KEY > sol-chiave OF tmp-sol1
           END-IF
           .

       DataSet1-tmp-sol1-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol1, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol1, BeforeReadRecord>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol1, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol1, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tmp-sol1-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol1, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol1, BeforeReadNext>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol1, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol1, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tmp-sol1-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol1, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol1, BeforeReadPrev>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol1, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol1, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tmp-sol1-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol1, BeforeWrite>
      * <TOTEM:END>
           WRITE sol-rec OF tmp-sol1.
           MOVE status-tmp-sol1leciti-m TO TOTEM-ERR-STAT
           MOVE "tmp-sol1" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol1, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tmp-sol1-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol1, BeforeRewrite>
      * <TOTEM:END>
           MOVE status-tmp-sol1leciti-m TO TOTEM-ERR-STAT
           MOVE "tmp-sol1" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol1, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tmp-sol1-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol1, BeforeDelete>
      * <TOTEM:END>
           MOVE status-tmp-sol1leciti-m TO TOTEM-ERR-STAT
           MOVE "tmp-sol1" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol1, AfterDelete>
      * <TOTEM:END>
           .

       tmp-sol-k-dt-testa-MERGE-SPLITBUF.
           INITIALIZE tmp-sol-k-dt-testa-SPLITBUF
           MOVE sol-tipo OF tmp-sol(1:1) TO 
           tmp-sol-k-dt-testa-SPLITBUF(1:1)
           MOVE sol-data-ordine OF tmp-sol(1:8) TO 
           tmp-sol-k-dt-testa-SPLITBUF(2:8)
           MOVE sol-ordine OF tmp-sol(1:12) TO 
           tmp-sol-k-dt-testa-SPLITBUF(10:12)
           .

       tmp-sol-k-art-MERGE-SPLITBUF.
           INITIALIZE tmp-sol-k-art-SPLITBUF
           MOVE sol-tipo OF tmp-sol(1:1) TO tmp-sol-k-art-SPLITBUF(1:1)
           MOVE sol-ordine OF tmp-sol(1:12) TO 
           tmp-sol-k-art-SPLITBUF(2:12)
           .

       tmp-sol-k-eva-MERGE-SPLITBUF.
           INITIALIZE tmp-sol-k-eva-SPLITBUF
           MOVE sol-tipo OF tmp-sol(1:1) TO tmp-sol-k-eva-SPLITBUF(1:1)
           MOVE sol-ordine OF tmp-sol(1:12) TO 
           tmp-sol-k-eva-SPLITBUF(2:12)
           MOVE sol-prog-art OF tmp-sol(1:8) TO 
           tmp-sol-k-eva-SPLITBUF(14:8)
           MOVE sol-prog-eva OF tmp-sol(1:8) TO 
           tmp-sol-k-eva-SPLITBUF(22:8)
           .

       DataSet1-tmp-sol-INITSTART.
           IF DataSet1-tmp-sol-KEY-Asc
              MOVE Low-Value TO sol-chiave OF tmp-sol
           ELSE
              MOVE High-Value TO sol-chiave OF tmp-sol
           END-IF
           .

       DataSet1-tmp-sol-INITEND.
           IF DataSet1-tmp-sol-KEY-Asc
              MOVE High-Value TO sol-chiave OF tmp-sol
           ELSE
              MOVE Low-Value TO sol-chiave OF tmp-sol
           END-IF
           .

      * tmp-sol
       DataSet1-tmp-sol-START.
           IF DataSet1-tmp-sol-KEY-Asc
              START tmp-sol KEY >= sol-chiave OF tmp-sol
           ELSE
              START tmp-sol KEY <= sol-chiave OF tmp-sol
           END-IF
           .

       DataSet1-tmp-sol-START-NOTGREATER.
           IF DataSet1-tmp-sol-KEY-Asc
              START tmp-sol KEY <= sol-chiave OF tmp-sol
           ELSE
              START tmp-sol KEY >= sol-chiave OF tmp-sol
           END-IF
           .

       DataSet1-tmp-sol-START-GREATER.
           IF DataSet1-tmp-sol-KEY-Asc
              START tmp-sol KEY > sol-chiave OF tmp-sol
           ELSE
              START tmp-sol KEY < sol-chiave OF tmp-sol
           END-IF
           .

       DataSet1-tmp-sol-START-LESS.
           IF DataSet1-tmp-sol-KEY-Asc
              START tmp-sol KEY < sol-chiave OF tmp-sol
           ELSE
              START tmp-sol KEY > sol-chiave OF tmp-sol
           END-IF
           .

       DataSet1-tmp-sol-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol, BeforeReadRecord>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tmp-sol-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol, BeforeReadNext>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tmp-sol-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol, BeforeReadPrev>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tmp-sol-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol, BeforeWrite>
      * <TOTEM:END>
           WRITE sol-rec OF tmp-sol.
           MOVE status-tmp-solleciti-m TO TOTEM-ERR-STAT
           MOVE "tmp-sol" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tmp-sol-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol, BeforeRewrite>
      * <TOTEM:END>
           MOVE status-tmp-solleciti-m TO TOTEM-ERR-STAT
           MOVE "tmp-sol" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tmp-sol-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol, BeforeDelete>
      * <TOTEM:END>
           MOVE status-tmp-solleciti-m TO TOTEM-ERR-STAT
           MOVE "tmp-sol" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol, AfterDelete>
      * <TOTEM:END>
           .

       tmp-sol2-k-dt-testa-MERGE-SPLITBUF.
           INITIALIZE tmp-sol2-k-dt-testa-SPLITBUF
           MOVE sol-tipo OF tmp-sol(1:1) TO 
           tmp-sol2-k-dt-testa-SPLITBUF(1:1)
           MOVE sol-data-ordine OF tmp-sol(1:8) TO 
           tmp-sol2-k-dt-testa-SPLITBUF(2:8)
           MOVE sol-ordine OF tmp-sol(1:12) TO 
           tmp-sol2-k-dt-testa-SPLITBUF(10:12)
           .

       tmp-sol2-k-art-MERGE-SPLITBUF.
           INITIALIZE tmp-sol2-k-art-SPLITBUF
           MOVE sol-tipo OF tmp-sol(1:1) TO tmp-sol2-k-art-SPLITBUF(1:1)
           MOVE sol-ordine OF tmp-sol(1:12) TO 
           tmp-sol2-k-art-SPLITBUF(2:12)
           .

       tmp-sol2-k-eva-MERGE-SPLITBUF.
           INITIALIZE tmp-sol2-k-eva-SPLITBUF
           MOVE sol-tipo OF tmp-sol(1:1) TO tmp-sol2-k-eva-SPLITBUF(1:1)
           MOVE sol-ordine OF tmp-sol(1:12) TO 
           tmp-sol2-k-eva-SPLITBUF(2:12)
           MOVE sol-prog-art OF tmp-sol(1:8) TO 
           tmp-sol2-k-eva-SPLITBUF(14:8)
           MOVE sol-prog-eva OF tmp-sol(1:8) TO 
           tmp-sol2-k-eva-SPLITBUF(22:8)
           .

       DataSet1-tmp-sol2-INITSTART.
           IF DataSet1-tmp-sol2-KEY-Asc
              MOVE Low-Value TO sol-chiave OF tmp-sol2
           ELSE
              MOVE High-Value TO sol-chiave OF tmp-sol2
           END-IF
           .

       DataSet1-tmp-sol2-INITEND.
           IF DataSet1-tmp-sol2-KEY-Asc
              MOVE High-Value TO sol-chiave OF tmp-sol2
           ELSE
              MOVE Low-Value TO sol-chiave OF tmp-sol2
           END-IF
           .

      * tmp-sol2
       DataSet1-tmp-sol2-START.
           IF DataSet1-tmp-sol2-KEY-Asc
              START tmp-sol2 KEY >= sol-chiave OF tmp-sol2
           ELSE
              START tmp-sol2 KEY <= sol-chiave OF tmp-sol2
           END-IF
           .

       DataSet1-tmp-sol2-START-NOTGREATER.
           IF DataSet1-tmp-sol2-KEY-Asc
              START tmp-sol2 KEY <= sol-chiave OF tmp-sol2
           ELSE
              START tmp-sol2 KEY >= sol-chiave OF tmp-sol2
           END-IF
           .

       DataSet1-tmp-sol2-START-GREATER.
           IF DataSet1-tmp-sol2-KEY-Asc
              START tmp-sol2 KEY > sol-chiave OF tmp-sol2
           ELSE
              START tmp-sol2 KEY < sol-chiave OF tmp-sol2
           END-IF
           .

       DataSet1-tmp-sol2-START-LESS.
           IF DataSet1-tmp-sol2-KEY-Asc
              START tmp-sol2 KEY < sol-chiave OF tmp-sol2
           ELSE
              START tmp-sol2 KEY > sol-chiave OF tmp-sol2
           END-IF
           .

       DataSet1-tmp-sol2-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol2, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol2, BeforeReadRecord>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol2, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol2, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tmp-sol2-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol2, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol2, BeforeReadNext>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol2, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol2, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tmp-sol2-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol2, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol2, BeforeReadPrev>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol2, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol2, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tmp-sol2-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol2, BeforeWrite>
      * <TOTEM:END>
           WRITE sol-rec OF tmp-sol2.
           MOVE status-tmp-sol2leciti-m TO TOTEM-ERR-STAT
           MOVE "tmp-sol2" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol2, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tmp-sol2-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol2, BeforeRewrite>
      * <TOTEM:END>
           MOVE status-tmp-sol2leciti-m TO TOTEM-ERR-STAT
           MOVE "tmp-sol2" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol2, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tmp-sol2-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol2, BeforeDelete>
      * <TOTEM:END>
           MOVE status-tmp-sol2leciti-m TO TOTEM-ERR-STAT
           MOVE "tmp-sol2" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-sol2, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tmp-ordf-art-INITSTART.
           IF DataSet1-tmp-ordf-art-KEY-Asc
              MOVE Low-Value TO toa-chiave
           ELSE
              MOVE High-Value TO toa-chiave
           END-IF
           .

       DataSet1-tmp-ordf-art-INITEND.
           IF DataSet1-tmp-ordf-art-KEY-Asc
              MOVE High-Value TO toa-chiave
           ELSE
              MOVE Low-Value TO toa-chiave
           END-IF
           .

      * tmp-ordf-art
       DataSet1-tmp-ordf-art-START.
           IF DataSet1-tmp-ordf-art-KEY-Asc
              START tmp-ordf-art KEY >= toa-chiave
           ELSE
              START tmp-ordf-art KEY <= toa-chiave
           END-IF
           .

       DataSet1-tmp-ordf-art-START-NOTGREATER.
           IF DataSet1-tmp-ordf-art-KEY-Asc
              START tmp-ordf-art KEY <= toa-chiave
           ELSE
              START tmp-ordf-art KEY >= toa-chiave
           END-IF
           .

       DataSet1-tmp-ordf-art-START-GREATER.
           IF DataSet1-tmp-ordf-art-KEY-Asc
              START tmp-ordf-art KEY > toa-chiave
           ELSE
              START tmp-ordf-art KEY < toa-chiave
           END-IF
           .

       DataSet1-tmp-ordf-art-START-LESS.
           IF DataSet1-tmp-ordf-art-KEY-Asc
              START tmp-ordf-art KEY < toa-chiave
           ELSE
              START tmp-ordf-art KEY > toa-chiave
           END-IF
           .

       DataSet1-tmp-ordf-art-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-ordf-art, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-ordf-art, BeforeReadRecord>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-ordf-art, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-ordf-art, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tmp-ordf-art-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-ordf-art, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-ordf-art, BeforeReadNext>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-ordf-art, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-ordf-art, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tmp-ordf-art-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-ordf-art, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-ordf-art, BeforeReadPrev>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-ordf-art, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-ordf-art, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tmp-ordf-art-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-ordf-art, BeforeWrite>
      * <TOTEM:END>
           WRITE toa-rec OF tmp-ordf-art.
           MOVE STATUS-tmp-ordf-art TO TOTEM-ERR-STAT
           MOVE "tmp-ordf-art" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-ordf-art, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tmp-ordf-art-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-ordf-art, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tmp-ordf-art TO TOTEM-ERR-STAT
           MOVE "tmp-ordf-art" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-ordf-art, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tmp-ordf-art-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-ordf-art, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tmp-ordf-art TO TOTEM-ERR-STAT
           MOVE "tmp-ordf-art" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-ordf-art, AfterDelete>
      * <TOTEM:END>
           .

       tordforn-tof-k-causale-MERGE-SPLITBUF.
           INITIALIZE tordforn-tof-k-causale-SPLITBUF
           MOVE tof-causale(1:4) TO tordforn-tof-k-causale-SPLITBUF(1:4)
           MOVE tof-chiave(1:12) TO 
           tordforn-tof-k-causale-SPLITBUF(5:12)
           .

       tordforn-tof-k-stato-MERGE-SPLITBUF.
           INITIALIZE tordforn-tof-k-stato-SPLITBUF
           MOVE tof-stato(1:1) TO tordforn-tof-k-stato-SPLITBUF(1:1)
           MOVE tof-chiave(1:12) TO tordforn-tof-k-stato-SPLITBUF(2:12)
           .

       tordforn-k-fornitore-MERGE-SPLITBUF.
           INITIALIZE tordforn-k-fornitore-SPLITBUF
           MOVE tof-cod-forn(1:5) TO tordforn-k-fornitore-SPLITBUF(1:5)
           MOVE tof-destino(1:5) TO tordforn-k-fornitore-SPLITBUF(6:5)
           MOVE tof-stato(1:1) TO tordforn-k-fornitore-SPLITBUF(11:1)
           MOVE tof-chiave(1:12) TO tordforn-k-fornitore-SPLITBUF(12:12)
           .

       tordforn-tof-k-data-MERGE-SPLITBUF.
           INITIALIZE tordforn-tof-k-data-SPLITBUF
           MOVE tof-data-ordine OF tordforn(1:8) TO 
           tordforn-tof-k-data-SPLITBUF(1:8)
           MOVE tof-chiave OF tordforn(1:12) TO 
           tordforn-tof-k-data-SPLITBUF(9:12)
           .

       tordforn-tof-k-consegna-MERGE-SPLITBUF.
           INITIALIZE tordforn-tof-k-consegna-SPLITBUF
           MOVE tof-data-consegna OF tordforn(1:8) TO 
           tordforn-tof-k-consegna-SPLITBUF(1:8)
           MOVE tof-chiave OF tordforn(1:12) TO 
           tordforn-tof-k-consegna-SPLITBUF(9:12)
           .

       DataSet1-tordforn-INITSTART.
           IF DataSet1-tordforn-KEY-Asc
              MOVE Low-Value TO tof-chiave
           ELSE
              MOVE High-Value TO tof-chiave
           END-IF
           .

       DataSet1-tordforn-INITEND.
           IF DataSet1-tordforn-KEY-Asc
              MOVE High-Value TO tof-chiave
           ELSE
              MOVE Low-Value TO tof-chiave
           END-IF
           .

      * tordforn
       DataSet1-tordforn-START.
           IF DataSet1-tordforn-KEY-Asc
              START tordforn KEY >= tof-chiave
           ELSE
              START tordforn KEY <= tof-chiave
           END-IF
           .

       DataSet1-tordforn-START-NOTGREATER.
           IF DataSet1-tordforn-KEY-Asc
              START tordforn KEY <= tof-chiave
           ELSE
              START tordforn KEY >= tof-chiave
           END-IF
           .

       DataSet1-tordforn-START-GREATER.
           IF DataSet1-tordforn-KEY-Asc
              START tordforn KEY > tof-chiave
           ELSE
              START tordforn KEY < tof-chiave
           END-IF
           .

       DataSet1-tordforn-START-LESS.
           IF DataSet1-tordforn-KEY-Asc
              START tordforn KEY < tof-chiave
           ELSE
              START tordforn KEY > tof-chiave
           END-IF
           .

       DataSet1-tordforn-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tordforn-LOCK
              READ tordforn WITH LOCK 
              KEY tof-chiave
           ELSE
              READ tordforn WITH NO LOCK 
              KEY tof-chiave
           END-IF
           PERFORM tordforn-tof-k-causale-MERGE-SPLITBUF
           PERFORM tordforn-tof-k-stato-MERGE-SPLITBUF
           PERFORM tordforn-k-fornitore-MERGE-SPLITBUF
           PERFORM tordforn-tof-k-data-MERGE-SPLITBUF
           PERFORM tordforn-tof-k-consegna-MERGE-SPLITBUF
           MOVE STATUS-tordforn TO TOTEM-ERR-STAT 
           MOVE "tordforn" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tordforn-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tordforn-KEY-Asc
              IF DataSet1-tordforn-LOCK
                 READ tordforn NEXT WITH LOCK
              ELSE
                 READ tordforn NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tordforn-LOCK
                 READ tordforn PREVIOUS WITH LOCK
              ELSE
                 READ tordforn PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tordforn-tof-k-causale-MERGE-SPLITBUF
           PERFORM tordforn-tof-k-stato-MERGE-SPLITBUF
           PERFORM tordforn-k-fornitore-MERGE-SPLITBUF
           PERFORM tordforn-tof-k-data-MERGE-SPLITBUF
           PERFORM tordforn-tof-k-consegna-MERGE-SPLITBUF
           MOVE STATUS-tordforn TO TOTEM-ERR-STAT
           MOVE "tordforn" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tordforn-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tordforn-KEY-Asc
              IF DataSet1-tordforn-LOCK
                 READ tordforn PREVIOUS WITH LOCK
              ELSE
                 READ tordforn PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tordforn-LOCK
                 READ tordforn NEXT WITH LOCK
              ELSE
                 READ tordforn NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tordforn-tof-k-causale-MERGE-SPLITBUF
           PERFORM tordforn-tof-k-stato-MERGE-SPLITBUF
           PERFORM tordforn-k-fornitore-MERGE-SPLITBUF
           PERFORM tordforn-tof-k-data-MERGE-SPLITBUF
           PERFORM tordforn-tof-k-consegna-MERGE-SPLITBUF
           MOVE STATUS-tordforn TO TOTEM-ERR-STAT
           MOVE "tordforn" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tordforn-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tordforn TO TOTEM-ERR-STAT
           MOVE "tordforn" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tordforn-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tordforn TO TOTEM-ERR-STAT
           MOVE "tordforn" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tordforn-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tordforn TO TOTEM-ERR-STAT
           MOVE "tordforn" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, AfterDelete>
      * <TOTEM:END>
           .

       rordforn-rof-k-articolo-MERGE-SPLITBUF.
           INITIALIZE rordforn-rof-k-articolo-SPLITBUF
           MOVE rof-cod-articolo OF rordforn(1:6) TO 
           rordforn-rof-k-articolo-SPLITBUF(1:6)
           MOVE rof-chiave OF rordforn(1:17) TO 
           rordforn-rof-k-articolo-SPLITBUF(7:17)
           .

       rordforn-rof-k-art-mag-MERGE-SPLITBUF.
           INITIALIZE rordforn-rof-k-art-mag-SPLITBUF
           MOVE rof-cod-articolo OF rordforn(1:6) TO 
           rordforn-rof-k-art-mag-SPLITBUF(1:6)
           MOVE rof-cod-magazzino OF rordforn(1:3) TO 
           rordforn-rof-k-art-mag-SPLITBUF(7:3)
           MOVE rof-chiave OF rordforn(1:17) TO 
           rordforn-rof-k-art-mag-SPLITBUF(10:17)
           .

       DataSet1-rordforn-INITSTART.
           IF DataSet1-rordforn-KEY-Asc
              MOVE Low-Value TO rof-chiave OF rordforn
           ELSE
              MOVE High-Value TO rof-chiave OF rordforn
           END-IF
           .

       DataSet1-rordforn-INITEND.
           IF DataSet1-rordforn-KEY-Asc
              MOVE High-Value TO rof-chiave OF rordforn
           ELSE
              MOVE Low-Value TO rof-chiave OF rordforn
           END-IF
           .

      * rordforn
       DataSet1-rordforn-START.
           IF DataSet1-rordforn-KEY-Asc
              START rordforn KEY >= rof-chiave OF rordforn
           ELSE
              START rordforn KEY <= rof-chiave OF rordforn
           END-IF
           .

       DataSet1-rordforn-START-NOTGREATER.
           IF DataSet1-rordforn-KEY-Asc
              START rordforn KEY <= rof-chiave OF rordforn
           ELSE
              START rordforn KEY >= rof-chiave OF rordforn
           END-IF
           .

       DataSet1-rordforn-START-GREATER.
           IF DataSet1-rordforn-KEY-Asc
              START rordforn KEY > rof-chiave OF rordforn
           ELSE
              START rordforn KEY < rof-chiave OF rordforn
           END-IF
           .

       DataSet1-rordforn-START-LESS.
           IF DataSet1-rordforn-KEY-Asc
              START rordforn KEY < rof-chiave OF rordforn
           ELSE
              START rordforn KEY > rof-chiave OF rordforn
           END-IF
           .

       DataSet1-rordforn-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-rordforn-LOCK
              READ rordforn WITH LOCK 
              KEY rof-chiave OF rordforn
           ELSE
              READ rordforn WITH NO LOCK 
              KEY rof-chiave OF rordforn
           END-IF
           PERFORM rordforn-rof-k-articolo-MERGE-SPLITBUF
           PERFORM rordforn-rof-k-art-mag-MERGE-SPLITBUF
           MOVE STATUS-rordforn TO TOTEM-ERR-STAT 
           MOVE "rordforn" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-rordforn-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-rordforn-KEY-Asc
              IF DataSet1-rordforn-LOCK
                 READ rordforn NEXT WITH LOCK
              ELSE
                 READ rordforn NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-rordforn-LOCK
                 READ rordforn PREVIOUS WITH LOCK
              ELSE
                 READ rordforn PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM rordforn-rof-k-articolo-MERGE-SPLITBUF
           PERFORM rordforn-rof-k-art-mag-MERGE-SPLITBUF
           MOVE STATUS-rordforn TO TOTEM-ERR-STAT
           MOVE "rordforn" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-rordforn-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-rordforn-KEY-Asc
              IF DataSet1-rordforn-LOCK
                 READ rordforn PREVIOUS WITH LOCK
              ELSE
                 READ rordforn PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-rordforn-LOCK
                 READ rordforn NEXT WITH LOCK
              ELSE
                 READ rordforn NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM rordforn-rof-k-articolo-MERGE-SPLITBUF
           PERFORM rordforn-rof-k-art-mag-MERGE-SPLITBUF
           MOVE STATUS-rordforn TO TOTEM-ERR-STAT
           MOVE "rordforn" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-rordforn-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-rordforn TO TOTEM-ERR-STAT
           MOVE "rordforn" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-rordforn-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-rordforn TO TOTEM-ERR-STAT
           MOVE "rordforn" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-rordforn-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-rordforn TO TOTEM-ERR-STAT
           MOVE "rordforn" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, AfterDelete>
      * <TOTEM:END>
           .

       tgrupgdo-gdo-k-g2-MERGE-SPLITBUF.
           INITIALIZE tgrupgdo-gdo-k-g2-SPLITBUF
           MOVE gdo-codice-G2 OF tgrupgdo(1:3) TO 
           tgrupgdo-gdo-k-g2-SPLITBUF(1:3)
           MOVE gdo-chiave OF tgrupgdo(1:5) TO 
           tgrupgdo-gdo-k-g2-SPLITBUF(4:5)
           .

       DataSet1-tgrupgdo-INITSTART.
           IF DataSet1-tgrupgdo-KEY-Asc
              MOVE Low-Value TO gdo-chiave OF tgrupgdo
           ELSE
              MOVE High-Value TO gdo-chiave OF tgrupgdo
           END-IF
           .

       DataSet1-tgrupgdo-INITEND.
           IF DataSet1-tgrupgdo-KEY-Asc
              MOVE High-Value TO gdo-chiave OF tgrupgdo
           ELSE
              MOVE Low-Value TO gdo-chiave OF tgrupgdo
           END-IF
           .

      * tgrupgdo
       DataSet1-tgrupgdo-START.
           IF DataSet1-tgrupgdo-KEY-Asc
              START tgrupgdo KEY >= gdo-chiave OF tgrupgdo
           ELSE
              START tgrupgdo KEY <= gdo-chiave OF tgrupgdo
           END-IF
           .

       DataSet1-tgrupgdo-START-NOTGREATER.
           IF DataSet1-tgrupgdo-KEY-Asc
              START tgrupgdo KEY <= gdo-chiave OF tgrupgdo
           ELSE
              START tgrupgdo KEY >= gdo-chiave OF tgrupgdo
           END-IF
           .

       DataSet1-tgrupgdo-START-GREATER.
           IF DataSet1-tgrupgdo-KEY-Asc
              START tgrupgdo KEY > gdo-chiave OF tgrupgdo
           ELSE
              START tgrupgdo KEY < gdo-chiave OF tgrupgdo
           END-IF
           .

       DataSet1-tgrupgdo-START-LESS.
           IF DataSet1-tgrupgdo-KEY-Asc
              START tgrupgdo KEY < gdo-chiave OF tgrupgdo
           ELSE
              START tgrupgdo KEY > gdo-chiave OF tgrupgdo
           END-IF
           .

       DataSet1-tgrupgdo-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tgrupgdo-LOCK
              READ tgrupgdo WITH LOCK 
              KEY gdo-chiave OF tgrupgdo
           ELSE
              READ tgrupgdo WITH NO LOCK 
              KEY gdo-chiave OF tgrupgdo
           END-IF
           PERFORM tgrupgdo-gdo-k-g2-MERGE-SPLITBUF
           MOVE STATUS-tgrupgdo TO TOTEM-ERR-STAT 
           MOVE "tgrupgdo" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tgrupgdo-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tgrupgdo-KEY-Asc
              IF DataSet1-tgrupgdo-LOCK
                 READ tgrupgdo NEXT WITH LOCK
              ELSE
                 READ tgrupgdo NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tgrupgdo-LOCK
                 READ tgrupgdo PREVIOUS WITH LOCK
              ELSE
                 READ tgrupgdo PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tgrupgdo-gdo-k-g2-MERGE-SPLITBUF
           MOVE STATUS-tgrupgdo TO TOTEM-ERR-STAT
           MOVE "tgrupgdo" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tgrupgdo-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tgrupgdo-KEY-Asc
              IF DataSet1-tgrupgdo-LOCK
                 READ tgrupgdo PREVIOUS WITH LOCK
              ELSE
                 READ tgrupgdo PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tgrupgdo-LOCK
                 READ tgrupgdo NEXT WITH LOCK
              ELSE
                 READ tgrupgdo NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tgrupgdo-gdo-k-g2-MERGE-SPLITBUF
           MOVE STATUS-tgrupgdo TO TOTEM-ERR-STAT
           MOVE "tgrupgdo" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tgrupgdo-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tgrupgdo TO TOTEM-ERR-STAT
           MOVE "tgrupgdo" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tgrupgdo-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tgrupgdo TO TOTEM-ERR-STAT
           MOVE "tgrupgdo" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tgrupgdo-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tgrupgdo TO TOTEM-ERR-STAT
           MOVE "tgrupgdo" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-sordforn-INITSTART.
           IF DataSet1-sordforn-KEY-Asc
              MOVE Low-Value TO sof-chiave OF sordforn
           ELSE
              MOVE High-Value TO sof-chiave OF sordforn
           END-IF
           .

       DataSet1-sordforn-INITEND.
           IF DataSet1-sordforn-KEY-Asc
              MOVE High-Value TO sof-chiave OF sordforn
           ELSE
              MOVE Low-Value TO sof-chiave OF sordforn
           END-IF
           .

      * sordforn
       DataSet1-sordforn-START.
           IF DataSet1-sordforn-KEY-Asc
              START sordforn KEY >= sof-chiave OF sordforn
           ELSE
              START sordforn KEY <= sof-chiave OF sordforn
           END-IF
           .

       DataSet1-sordforn-START-NOTGREATER.
           IF DataSet1-sordforn-KEY-Asc
              START sordforn KEY <= sof-chiave OF sordforn
           ELSE
              START sordforn KEY >= sof-chiave OF sordforn
           END-IF
           .

       DataSet1-sordforn-START-GREATER.
           IF DataSet1-sordforn-KEY-Asc
              START sordforn KEY > sof-chiave OF sordforn
           ELSE
              START sordforn KEY < sof-chiave OF sordforn
           END-IF
           .

       DataSet1-sordforn-START-LESS.
           IF DataSet1-sordforn-KEY-Asc
              START sordforn KEY < sof-chiave OF sordforn
           ELSE
              START sordforn KEY > sof-chiave OF sordforn
           END-IF
           .

       DataSet1-sordforn-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:sordforn, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:sordforn, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-sordforn-LOCK
              READ sordforn WITH LOCK 
              KEY sof-chiave OF sordforn
           ELSE
              READ sordforn WITH NO LOCK 
              KEY sof-chiave OF sordforn
           END-IF
           MOVE STATUS-sordforn TO TOTEM-ERR-STAT 
           MOVE "sordforn" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:sordforn, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:sordforn, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-sordforn-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:sordforn, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:sordforn, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-sordforn-KEY-Asc
              IF DataSet1-sordforn-LOCK
                 READ sordforn NEXT WITH LOCK
              ELSE
                 READ sordforn NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-sordforn-LOCK
                 READ sordforn PREVIOUS WITH LOCK
              ELSE
                 READ sordforn PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-sordforn TO TOTEM-ERR-STAT
           MOVE "sordforn" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:sordforn, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:sordforn, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-sordforn-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:sordforn, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:sordforn, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-sordforn-KEY-Asc
              IF DataSet1-sordforn-LOCK
                 READ sordforn PREVIOUS WITH LOCK
              ELSE
                 READ sordforn PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-sordforn-LOCK
                 READ sordforn NEXT WITH LOCK
              ELSE
                 READ sordforn NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-sordforn TO TOTEM-ERR-STAT
           MOVE "sordforn" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:sordforn, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:sordforn, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-sordforn-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:sordforn, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-sordforn TO TOTEM-ERR-STAT
           MOVE "sordforn" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:sordforn, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-sordforn-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:sordforn, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-sordforn TO TOTEM-ERR-STAT
           MOVE "sordforn" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:sordforn, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-sordforn-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:sordforn, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-sordforn TO TOTEM-ERR-STAT
           MOVE "sordforn" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:sordforn, AfterDelete>
      * <TOTEM:END>
           .

       tcaumag-k-mag-MERGE-SPLITBUF.
           INITIALIZE tcaumag-k-mag-SPLITBUF
           MOVE tca-cod-magaz(1:3) TO tcaumag-k-mag-SPLITBUF(1:3)
           MOVE tca-ord-forn(1:1) TO tcaumag-k-mag-SPLITBUF(4:1)
           .

       DataSet1-tcaumag-INITSTART.
           IF DataSet1-tcaumag-KEY-Asc
              MOVE Low-Value TO tca-chiave
           ELSE
              MOVE High-Value TO tca-chiave
           END-IF
           .

       DataSet1-tcaumag-INITEND.
           IF DataSet1-tcaumag-KEY-Asc
              MOVE High-Value TO tca-chiave
           ELSE
              MOVE Low-Value TO tca-chiave
           END-IF
           .

      * tcaumag
       DataSet1-tcaumag-START.
           IF DataSet1-tcaumag-KEY-Asc
              START tcaumag KEY >= tca-chiave
           ELSE
              START tcaumag KEY <= tca-chiave
           END-IF
           .

       DataSet1-tcaumag-START-NOTGREATER.
           IF DataSet1-tcaumag-KEY-Asc
              START tcaumag KEY <= tca-chiave
           ELSE
              START tcaumag KEY >= tca-chiave
           END-IF
           .

       DataSet1-tcaumag-START-GREATER.
           IF DataSet1-tcaumag-KEY-Asc
              START tcaumag KEY > tca-chiave
           ELSE
              START tcaumag KEY < tca-chiave
           END-IF
           .

       DataSet1-tcaumag-START-LESS.
           IF DataSet1-tcaumag-KEY-Asc
              START tcaumag KEY < tca-chiave
           ELSE
              START tcaumag KEY > tca-chiave
           END-IF
           .

       DataSet1-tcaumag-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tcaumag-LOCK
              READ tcaumag WITH LOCK 
              KEY tca-chiave
           ELSE
              READ tcaumag WITH NO LOCK 
              KEY tca-chiave
           END-IF
           PERFORM tcaumag-k-mag-MERGE-SPLITBUF
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT 
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tcaumag-KEY-Asc
              IF DataSet1-tcaumag-LOCK
                 READ tcaumag NEXT WITH LOCK
              ELSE
                 READ tcaumag NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tcaumag-LOCK
                 READ tcaumag PREVIOUS WITH LOCK
              ELSE
                 READ tcaumag PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tcaumag-k-mag-MERGE-SPLITBUF
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tcaumag-KEY-Asc
              IF DataSet1-tcaumag-LOCK
                 READ tcaumag PREVIOUS WITH LOCK
              ELSE
                 READ tcaumag PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tcaumag-LOCK
                 READ tcaumag NEXT WITH LOCK
              ELSE
                 READ tcaumag NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tcaumag-k-mag-MERGE-SPLITBUF
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-ttipocli-INITSTART.
           IF DataSet1-ttipocli-KEY-Asc
              MOVE Low-Value TO tcl-chiave
           ELSE
              MOVE High-Value TO tcl-chiave
           END-IF
           .

       DataSet1-ttipocli-INITEND.
           IF DataSet1-ttipocli-KEY-Asc
              MOVE High-Value TO tcl-chiave
           ELSE
              MOVE Low-Value TO tcl-chiave
           END-IF
           .

      * ttipocli
       DataSet1-ttipocli-START.
           IF DataSet1-ttipocli-KEY-Asc
              START ttipocli KEY >= tcl-chiave
           ELSE
              START ttipocli KEY <= tcl-chiave
           END-IF
           .

       DataSet1-ttipocli-START-NOTGREATER.
           IF DataSet1-ttipocli-KEY-Asc
              START ttipocli KEY <= tcl-chiave
           ELSE
              START ttipocli KEY >= tcl-chiave
           END-IF
           .

       DataSet1-ttipocli-START-GREATER.
           IF DataSet1-ttipocli-KEY-Asc
              START ttipocli KEY > tcl-chiave
           ELSE
              START ttipocli KEY < tcl-chiave
           END-IF
           .

       DataSet1-ttipocli-START-LESS.
           IF DataSet1-ttipocli-KEY-Asc
              START ttipocli KEY < tcl-chiave
           ELSE
              START ttipocli KEY > tcl-chiave
           END-IF
           .

       DataSet1-ttipocli-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-ttipocli-LOCK
              READ ttipocli WITH LOCK 
              KEY tcl-chiave
           ELSE
              READ ttipocli WITH NO LOCK 
              KEY tcl-chiave
           END-IF
           MOVE STATUS-ttipocli TO TOTEM-ERR-STAT 
           MOVE "ttipocli" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-ttipocli-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-ttipocli-KEY-Asc
              IF DataSet1-ttipocli-LOCK
                 READ ttipocli NEXT WITH LOCK
              ELSE
                 READ ttipocli NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-ttipocli-LOCK
                 READ ttipocli PREVIOUS WITH LOCK
              ELSE
                 READ ttipocli PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-ttipocli TO TOTEM-ERR-STAT
           MOVE "ttipocli" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-ttipocli-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-ttipocli-KEY-Asc
              IF DataSet1-ttipocli-LOCK
                 READ ttipocli PREVIOUS WITH LOCK
              ELSE
                 READ ttipocli PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-ttipocli-LOCK
                 READ ttipocli NEXT WITH LOCK
              ELSE
                 READ ttipocli NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-ttipocli TO TOTEM-ERR-STAT
           MOVE "ttipocli" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-ttipocli-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-ttipocli TO TOTEM-ERR-STAT
           MOVE "ttipocli" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-ttipocli-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-ttipocli TO TOTEM-ERR-STAT
           MOVE "ttipocli" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-ttipocli-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-ttipocli TO TOTEM-ERR-STAT
           MOVE "ttipocli" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-INIT-RECORD.
           INITIALIZE age-rec OF agenti
           INITIALIZE tor-rec OF tordini
           INITIALIZE mto-rec OF mtordini
           INITIALIZE mro-rec OF mrordini
           INITIALIZE art-rec OF articoli
           INITIALIZE des-rec OF destini
           INITIALIZE tec-rec OF tescons
           INITIALIZE cli-rec OF clienti
           INITIALIZE vet-rec OF tvettori
           INITIALIZE ror-rec OF rordini
           INITIALIZE tpr-rec OF tpromo
           INITIALIZE sol-rec OF tmp-sol1
           INITIALIZE sol-rec OF tmp-sol
           INITIALIZE sol-rec OF tmp-sol2
           INITIALIZE toa-rec OF tmp-ordf-art
           INITIALIZE tof-rec OF tordforn
           INITIALIZE rof-rec OF rordforn
           INITIALIZE gdo-rec OF tgrupgdo
           INITIALIZE sof-rec OF sordforn
           INITIALIZE tca-rec OF tcaumag
           INITIALIZE tcl-rec OF ttipocli
           .


      * COMBO-BOX
       cbo-promoa-Content.
           .

      * GRID
       gd-art2-Content.
      * CELLS' SETTING
              MODIFY gd-art2, X = 1, Y = 1,
                CELL-DATA = "Articolo",
      * CELLS' SETTING
              MODIFY gd-art2, X = 2, Y = 1,
                CELL-DATA = "Descrizione",
           .

      * COMBO-BOX
       cbo-promo-Content.
           .

      * GRID
       gd-Content.
      * CELLS' SETTING
              MODIFY gd, X = 2, Y = 1,
                CELL-DATA = "99999",
      * CELLS' SETTING
              MODIFY gd, X = 3, Y = 1,
                CELL-DATA = "XXXXXXXXXWXXXXXXXXXWXXXXXXXXXWXXXXXXXXXW",
      * CELLS' SETTING
              MODIFY gd, X = 4, Y = 1,
                CELL-DATA = "XXXXXXXXXWXXXXXXXXXWXXXXXXXXXWXXXXXXXXXW",
      * CELLS' SETTING
              MODIFY gd, X = 5, Y = 1,
                CELL-DATA = "XXXXXXXXXXWW",
      * CELLS' SETTING
              MODIFY gd, X = 6, Y = 1,
                CELL-DATA = "99/99/99",
      * CELLS' SETTING
              MODIFY gd, X = 7, Y = 1,
                CELL-DATA = "IN LAV",
      * CELLS' SETTING
              MODIFY gd, X = 8, Y = 1,
                CELL-DATA = "99999",
      * CELLS' SETTING
              MODIFY gd, X = 9, Y = 1,
                CELL-DATA = "99/99/99",
      * CELLS' SETTING
              MODIFY gd, X = 10, Y = 1,
                CELL-DATA = "99999",
      * CELLS' SETTING
              MODIFY gd, X = 11, Y = 1,
                CELL-DATA = "99/99/99",
      * CELLS' SETTING
              MODIFY gd, X = 12, Y = 1,
                CELL-DATA = "99999",
      * CELLS' SETTING
              MODIFY gd, X = 13, Y = 1,
                CELL-DATA = "99/99/99",
      * CELLS' SETTING
              MODIFY gd, X = 14, Y = 1,
                CELL-DATA = "P.O.D.",
      * CELLS' SETTING
              MODIFY gd, X = 15, Y = 1,
                CELL-DATA = "MTN - MERCE CONSEGNATA",
      * CELLS' SETTING
              MODIFY gd, X = 16, Y = 1,
                CELL-DATA = "INVIO",
           .

      * COMBO-BOX
       cbo-num-Content.
           .

      * COMBO-BOX
       cbo-clides-Content.
           .

      * COMBO-BOX
       cbo-loca-Content.
           .

      * COMBO-BOX
       cbo-numord-Content.
           .

      * COMBO-BOX
       cbo-data-Content.
           .

      * COMBO-BOX
       cbo-stato-Content.
           .

      * COMBO-BOX
       cbo-num-e-Content.
           .

      * COMBO-BOX
       cbo-data-e-Content.
           .

      * COMBO-BOX
       cbo-num-b-Content.
           .

      * COMBO-BOX
       cbo-data-b-Content.
           .

      * COMBO-BOX
       cbo-num-f-Content.
           .

      * COMBO-BOX
       cbo-data-f-Content.
           .

      * FD's Initialize Paragraph
       DataSet1-agenti-INITREC.
           INITIALIZE age-rec OF agenti
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tordini-INITREC.
           INITIALIZE tor-rec OF tordini
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-mtordini-INITREC.
           INITIALIZE mto-rec OF mtordini
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-mrordini-INITREC.
           INITIALIZE mro-rec OF mrordini
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-articoli-INITREC.
           INITIALIZE art-rec OF articoli
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-destini-INITREC.
           INITIALIZE des-rec OF destini
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tescons-INITREC.
           INITIALIZE tec-rec OF tescons
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-clienti-INITREC.
           INITIALIZE cli-rec OF clienti
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tvettori-INITREC.
           INITIALIZE vet-rec OF tvettori
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-rordini-INITREC.
           INITIALIZE ror-rec OF rordini
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tpromo-INITREC.
           INITIALIZE tpr-rec OF tpromo
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tmp-sol1-INITREC.
           INITIALIZE sol-rec OF tmp-sol1
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tmp-sol-INITREC.
           INITIALIZE sol-rec OF tmp-sol
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tmp-sol2-INITREC.
           INITIALIZE sol-rec OF tmp-sol2
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tmp-ordf-art-INITREC.
           INITIALIZE toa-rec OF tmp-ordf-art
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tordforn-INITREC.
           INITIALIZE tof-rec OF tordforn
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-rordforn-INITREC.
           INITIALIZE rof-rec OF rordforn
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tgrupgdo-INITREC.
           INITIALIZE gdo-rec OF tgrupgdo
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-sordforn-INITREC.
           INITIALIZE sof-rec OF sordforn
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tcaumag-INITREC.
           INITIALIZE tca-rec OF tcaumag
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-ttipocli-INITREC.
           INITIALIZE tcl-rec OF ttipocli
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      *
       DataSet1-DISPATCH-BUFTOFLD.
           EVALUATE TOTEM-Form-Index ALSO TOTEM-Frame-Index
              WHEN 3 ALSO 0
                  PERFORM scr-ordini-Buf-To-Fld
           END-EVALUATE
           .

       Form1-Open-Routine.
           PERFORM Form1-Scrn
           PERFORM Form1-Proc
           .

       Form1-Scrn.
           PERFORM Form1-Create-Win
           PERFORM Form1-Init-Value
           PERFORM Form1-Init-Data
      * Tab keystrok settings
           SET ENVIRONMENT "KEYSTROKE" TO "EXCEPTION=32001 KT".
           SET ENVIRONMENT "KEYSTROKE" TO "EXCEPTION=32002 KB".
      * Tool Bar
           DISPLAY Form1-Tb-1a
           PERFORM Form1-DISPLAY
           .

       Form1-Create-Win.
           Display Independent GRAPHICAL WINDOW
              LINES 32,88,
              SIZE 98,00,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 65793,
              CONTROL FONT Verdana10-Occidentale,
              LINK TO THREAD,
              MODELESS,
              NO SCROLL,
              TITLE-BAR,
              TITLE TITOLO,
              WITH SYSTEM MENU,
              USER-GRAY,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE Screen1-Event-Proc,
              HANDLE IS Form1-Handle,
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
           DISPLAY TOOL-BAR 
              LINES 2,69,   
              HANDLE IN Form1-Tb-1-Handlea
           DISPLAY Form1-Tb-1a UPON Form1-Tb-1-Handlea

      * Status-bar
           DISPLAY Form1 UPON Form1-Handle
      * DISPLAY-COLUMNS settings
           .

       Form1-PROC.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeAccept>
           move 78-ID-ef-data-from to control-id.
           move 4                  to accept-control.

           accept como-data from century-date,

           compute data-num = function INTEGER-OF-DATE(como-data).
           subtract 30 from data-num.

           perform DATE-TO-SCREEN.
           move como-data to ef-data-to-buf.

           compute como-data = function DATE-OF-INTEGER(data-num).

           perform DATE-TO-SCREEN.
           move como-data to ef-data-from-buf.
                                 
           move 1 to chk-reg-buf.
           move 1 to chk-il-buf.
           move 1 to chk-sp-buf.
           move 1 to chk-st-buf.
           move 1 to chk-chiuso-buf.

           display form1.

           move 1 to num-screen.
           move 2 to riga.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT Form1
                 ON EXCEPTION
                    PERFORM Form1-Evaluate-Func
                 MOVE 1 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY Form1-Handle
           INITIALIZE Key-Status
           .

       Form1-Evaluate-Func.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterAccept>
      * <TOTEM:END>
           IF Key-Status = KEY-KT-VALUE
               INQUIRE Screen1-Ta-1, VALUE IN Screen1-Ta-1-TAB-VALUE
               IF Screen1-Ta-1-TAB-VALUE NOT = 1 | First Page
                 SUBTRACT 1 FROM Screen1-Ta-1-TAB-VALUE
                 MODIFY Screen1-Ta-1, VALUE IS Screen1-Ta-1-TAB-VALUE
                 PERFORM Screen1-Ta-1-TABCHANGE
               END-IF
            END-IF
           IF Key-Status =KEY-KB-VALUE
               INQUIRE Screen1-Ta-1, VALUE IN Screen1-Ta-1-TAB-VALUE
               IF Screen1-Ta-1-TAB-VALUE NOT = 1 | LAST Page
                 ADD 1 TO Screen1-Ta-1-TAB-VALUE
                 MODIFY Screen1-Ta-1, VALUE IS Screen1-Ta-1-TAB-VALUE
                 PERFORM Screen1-Ta-1-TABCHANGE
               END-IF
           END-IF
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM Form1-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM Form1-Exit
                 END-IF
                 IF Event-Type = Cmd-Tabchanged AND 
                                 Event-Control-Id = 65
                    MOVE EVENT-DATA-1 TO Screen1-Ta-1-TAB-VALUE
                    PERFORM Screen1-Ta-1-TABCHANGE
                 END-IF

              WHEN Key-Status = 1000
                 PERFORM PB-ESEGUI-LinkTo
              WHEN Key-Status = 8
                 PERFORM TOOL-CERCA-LinkTo
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       Form1-CLEAR.
           PERFORM Form1-INIT-VALUE
           PERFORM Form1-DISPLAY
           .

       Form1-DISPLAY.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY Form1-Tb-1a
           DISPLAY Form1 UPON Form1-Handle
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterDisplay>

           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       Form1-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeExit>
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       Form1-Init-Data.
           MOVE 1 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
      * TAB
              MODIFY Screen1-Ta-1, RESET-TABS = 1
              MODIFY Screen1-Ta-1, 
           TAB-TO-ADD = (
                 "Ordini Master",
                        )
           MOVE 0 TO 
                   Screen1-Pg-2-Visible,
           MOVE 1 TO Screen1-Pg-2-Visible
           PERFORM Screen1-Ta-1-TABCHANGE
      * COMBO-BOX
           PERFORM cbo-promoa-Content
           .

       Form1-Init-Value.
           MOVE TITOLO TO TOTEM-MSG-TITLE
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, SetDefault>
      * <TOTEM:END>
           PERFORM Form1-FLD-TO-BUF
           .


       Form1-ALLGRID-RESET.
           .

      * for Form's Validation
       Form1-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       Form1-Buf-To-Fld.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterBufToFld>
      * <TOTEM:END>
           .

       Form1-Fld-To-Buf.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeFldToBuf>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterFldToBuf>
      * <TOTEM:END>
           .

       Form1-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform Form1-BUF-TO-FLD.
           move 0 to scelta.
           .
       Form1-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM Form1-SHOW-MSG-ROUTINE
           .

       Form1-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM Form1-DISPLAY-MESSAGE
           .

       Form1-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       Form1-Save-Status.
           .             

       Form1-Restore-Status.
           .


      * Paragrafo per la struttura del codice in AFTER sulla screen Form1
      ***---
       Form1-AFTER-SCREEN.

      * Generazione risettaggio keyboard "." ---> "."

      * Generazione stringa perform CONTROLLO
           evaluate control-id
           |78-ID-EF-data-FROM è l'ID del campo EF-data-FROM
           when 78-ID-EF-data-FROM
                perform CONTROLLO
           |78-ID-EF-DATA-TO è l'ID del campo EF-DATA-TO
           when 78-ID-EF-DATA-TO
                perform CONTROLLO
           |78-ID-ef-cli è l'ID del campo ef-cli
           when 78-ID-ef-cli
                perform CONTROLLO
           |78-ID-ef-dest è l'ID del campo ef-dest
           when 78-ID-ef-dest
                perform CONTROLLO
           |78-ID-ef-age è l'ID del campo ef-age
           when 78-ID-ef-age
                perform CONTROLLO
           |78-ID-ef-gdo è l'ID del campo ef-gdo
           when 78-ID-ef-gdo
                perform CONTROLLO
           |78-ID-ef-tipo è l'ID del campo ef-tipo
           when 78-ID-ef-tipo
                perform CONTROLLO
           |78-ID-ef-art è l'ID del campo ef-art
           when 78-ID-ef-art
                perform CONTROLLO
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER CONTROLLO della screen
           when 99999 continue
           when other continue
           end-evaluate.

       scr-elab-Open-Routine.
           PERFORM scr-elab-Scrn
           PERFORM scr-elab-Proc
           .

       scr-elab-Scrn.
           PERFORM scr-elab-Create-Win
           PERFORM scr-elab-Init-Value
           PERFORM scr-elab-Init-Data
      * Tab keystrok settings
      * Tool Bar
           PERFORM scr-elab-DISPLAY
           .

       scr-elab-Create-Win.
           Display Independent GRAPHICAL WINDOW
              LINES 2,39,
              SIZE 30,00,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 65793,
              CONTROL FONT Verdana12BI-Occidentale,
              LINK TO THREAD,
              NO SCROLL,
              USER-GRAY,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE Screen1-Event-Proc,
              HANDLE IS scr-elab-Handle,
      * <TOTEM:EPT. FORM:scr-elab, FORM:scr-elab, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
      * Status-bar
           DISPLAY scr-elab UPON scr-elab-Handle
      * DISPLAY-COLUMNS settings
           .

       scr-elab-PROC.
      * <TOTEM:EPT. FORM:scr-elab, FORM:scr-elab, BeforeAccept>
           call "w$mouse" using set-mouse-shape, wait-pointer
           perform CARICA-ORDINI.

           call "w$mouse" using set-mouse-shape, arrow-pointer.

           perform SCR-ELAB-EXIT.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT OMITTED LINE 1 COL 1
                 ON EXCEPTION
                    PERFORM scr-elab-Evaluate-Func
                 MOVE 2 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:scr-elab, FORM:scr-elab, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:scr-elab, FORM:scr-elab, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY scr-elab-Handle
           INITIALIZE Key-Status
           .

       scr-elab-Evaluate-Func.
      * <TOTEM:EPT. FORM:scr-elab, FORM:scr-elab, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM scr-elab-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM scr-elab-Exit
                 END-IF
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       scr-elab-CLEAR.
           PERFORM scr-elab-INIT-VALUE
           PERFORM scr-elab-DISPLAY
           .

       scr-elab-DISPLAY.
      * <TOTEM:EPT. FORM:scr-elab, FORM:scr-elab, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY scr-elab UPON scr-elab-Handle
      * <TOTEM:EPT. FORM:scr-elab, FORM:scr-elab, AfterDisplay>
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       scr-elab-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:scr-elab, FORM:scr-elab, BeforeExit>
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       scr-elab-Init-Data.
           MOVE 2 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
           .

       scr-elab-Init-Value.
      * <TOTEM:EPT. FORM:scr-elab, FORM:scr-elab, SetDefault>
      * <TOTEM:END>
           PERFORM scr-elab-FLD-TO-BUF
           .


       scr-elab-ALLGRID-RESET.
           .

      * for Form's Validation
       scr-elab-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       scr-elab-Buf-To-Fld.
      * <TOTEM:EPT. FORM:scr-elab, FORM:scr-elab, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:scr-elab, FORM:scr-elab, AfterBufToFld>
      * <TOTEM:END>
           .

       scr-elab-Fld-To-Buf.
      * <TOTEM:EPT. FORM:scr-elab, FORM:scr-elab, BeforeFldToBuf>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:scr-elab, FORM:scr-elab, AfterFldToBuf>
      * <TOTEM:END>
           .

       scr-elab-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform scr-elab-BUF-TO-FLD.
           move 0 to scelta.
           .
       scr-elab-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM scr-elab-SHOW-MSG-ROUTINE
           .

       scr-elab-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM scr-elab-DISPLAY-MESSAGE
           .

       scr-elab-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       scr-elab-Save-Status.
           .             

       scr-elab-Restore-Status.
           .


      * Paragrafo per la struttura del codice in AFTER sulla screen scr-elab
      ***---
       scr-elab-AFTER-SCREEN.

      * Generazione risettaggio keyboard "." ---> "."

      * Generazione stringa perform CONTROLLO
           evaluate control-id
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER CONTROLLO della screen
           when 99999 continue
           when other continue
           end-evaluate.

       scr-ordini-Open-Routine.
           PERFORM scr-ordini-Scrn
           PERFORM scr-ordini-Proc
           .

       scr-ordini-Scrn.
           PERFORM scr-ordini-Create-Win
           PERFORM scr-ordini-Init-Value
           PERFORM scr-ordini-Init-Data
      * Tab keystrok settings
      * Tool Bar
           DISPLAY Form1-Tb-1aa
           PERFORM scr-ordini-DISPLAY
           .

       scr-ordini-Create-Win.
           Display Independent GRAPHICAL WINDOW
              LINES 52,21,
              SIZE 224,33,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 65793,
              CONTROL FONT Arial8-Occidentale,
              LABEL-OFFSET 23,
              LINK TO THREAD,
              MODELESS,
              NO SCROLL,
              TITLE-BAR,
              TITLE titolo,
              AUTO-MINIMIZE,
              WITH SYSTEM MENU,
              USER-GRAY,
           VISIBLE 0,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE Screen1-Event-Proc,
              HANDLE IS scr-ordini-Handle,
      * <TOTEM:EPT. FORM:scr-ordini, FORM:scr-ordini, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
           DISPLAY TOOL-BAR 
              LINES 3,29,   
              HANDLE IN Form1-Tb-1-Handleaa
           DISPLAY Form1-Tb-1aa UPON Form1-Tb-1-Handleaa

      * Status-bar
           DISPLAY scr-ordini UPON scr-ordini-Handle
      * DISPLAY-COLUMNS settings
              MODIFY gd-art2, DISPLAY-COLUMNS (1, 10)
              MODIFY gd, DISPLAY-COLUMNS (1, 4, 11, 60, 109, 126, 134, 
           142, 149, 157, 164, 172, 179, 187, 193, 216)
           .

       scr-ordini-PROC.
      * <TOTEM:EPT. FORM:scr-ordini, FORM:scr-ordini, BeforeAccept>
           set ActionGrid to false.
           move 2 to num-screen.
           move 2 to riga.
           modify gd-art2, reset-grid = 1.
           perform GD-ART2-CONTENT.
           move ef-art-buf to art-codice.
           if art-codice not = 0
              read articoli no lock
              modify gd-art2(2, 1), cell-data art-codice
              modify gd-art2(2, 2), cell-data art-descrizione
           end-if.

           perform INTESTAZIONE.
           perform INITIALIZE-FILTRI.      

           display chk-sp chk-il chk-reg chk-st chk-chiuso

           if ef-gdo-buf not = spaces
              move spaces to old-gdo-buf
              move cbo-promo-buf     to old-cbo-promo-buf
              perform RIEMPI-LISTINI
              move old-cbo-promo-buf to cbo-promo-buf
              modify cbo-promo, value cbo-promo-buf
           else
              move 78-tutti-vol to cbo-promo-buf
              modify cbo-promo, item-to-add cbo-promo-buf
              modify cbo-promo, value 78-tutti-vol
           end-if.            

           move low-value to sol-rec of tmp-sol.
           set sol-testa  of tmp-sol to true.
           start tmp-sol key >= k-dt-testa invalid continue end-start.

           move 2 to riga.
           move 0 to idx-presenti.
           perform until 1 = 2
              
              read tmp-sol next no lock at end exit perform end-read
              if sol-testa of tmp-sol
                 add 1                      to idx-presenti
                 move sol-ordine of tmp-sol to el-chiave(idx-presenti)

                 move sol-numero         of tmp-sol  to col-num
                 move sol-clides         of tmp-sol  to col-clides
                 move sol-localita       of tmp-sol  to col-localita
                 move sol-numord-cli     of tmp-sol  to col-ord-cli
                 move sol-data-video     of tmp-sol  to col-data-ord
                 move sol-data-creazione of tmp-sol  to col-data-e
                 move sol-data-cons      of tmp-sol  to col-data-b
                 move sol-stato          of tmp-sol  to col-stato
                 move sol-esito          of tmp-sol  to col-esito

                 modify gd(store-riga, 1),
                        bitmap        = invio-sol-bmp,
                        bitmap-number = 1,
                        bitmap-width  = 16

                 perform METTI-IN-GRID-TESTA
                          
                 move sol-numero     of tmp-sol to cbo-num-buf
                 move sol-clides     of tmp-sol to cbo-clides-buf
                 move sol-localita   of tmp-sol to cbo-loca-buf
                 move sol-numord-cli of tmp-sol to cbo-numord-buf
                 move sol-data-video of tmp-sol to cbo-data-buf
                 move sol-stato      of tmp-sol to cbo-stato-buf
                 
                 perform RIEMPI-COMBO-TESTA 
                 
                 add 1 to riga
              else
                          
      *****           move sol-esito of tmp-sol to cbo-esito-buf 
      *****           move sol-vett  of tmp-sol to cbo-vett-buf  

                 if sol-data-f of tmp-sol not = 0
                    string sol-data-f of tmp-sol(7:2) delimited size
                           "/"                        delimited size
                           sol-data-f of tmp-sol(5:2) delimited size
                           "/"                        delimited size
                           sol-data-f of tmp-sol(3:2) delimited size
                           into cbo-data-f-buf
                    end-string  
                 end-if
                 move sol-num-f of tmp-sol to cbo-num-f-buf 

                 if sol-data-b of tmp-sol not = 0
                    string sol-data-b of tmp-sol(7:2) delimited size
                           "/"                        delimited size
                           sol-data-b of tmp-sol(5:2) delimited size
                           "/"                        delimited size
                           sol-data-b of tmp-sol(3:2) delimited size
                           into cbo-data-b-buf
                    end-string  
                 end-if
                 move sol-num-b of tmp-sol to cbo-num-b-buf 

                 if sol-data-e of tmp-sol not = 0
                    string sol-data-e of tmp-sol(7:2) delimited size
                           "/"                        delimited size
                           sol-data-e of tmp-sol(5:2) delimited size
                           "/"                        delimited size
                           sol-data-e of tmp-sol(3:2) delimited size
                           into cbo-data-e-buf
                    end-string  
                 end-if
                 move sol-num-e of tmp-sol to cbo-num-e-buf 

                 perform RIEMPI-COMBO-RIGHE

              end-if
           end-perform.

           modify cbo-promo, value cbo-promo-buf.
           if cbo-promo-buf   not = 78-tutti-vol or
              not tutti-stati
              perform FILTRA-RECORD
           end-if.

           modify scr-ordini-handle, visible true.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT scr-ordini
                 ON EXCEPTION
                    PERFORM scr-ordini-Evaluate-Func
                 MOVE 3 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:scr-ordini, FORM:scr-ordini, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:scr-ordini, FORM:scr-ordini, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY scr-ordini-Handle
           INITIALIZE Key-Status
           .

       scr-ordini-Evaluate-Func.
      * <TOTEM:EPT. FORM:scr-ordini, FORM:scr-ordini, AfterAccept>
           if ActionGrid
              if ApriRighe
                 perform APRI-RIGHE
              else
                 perform CHIUDI-RIGHE
              end-if
           end-if.

           set ActionGrid to false.

           if key-status = 8
              if control-id = 78-ID-gd-art2
                 inquire gd-art2(riga, 1), cell-data in art-codice
                 move "articoli"     to como-file
                 call   "zoom-gt"  using como-file, art-rec
                                  giving stato-zoom
                 cancel "zoom-gt"
                 if stato-zoom = 0
                    modify gd-art2(riga, 1), cell-data art-codice
                    modify gd-art2(riga, 2), cell-data art-descrizione
                    perform GD-ART2-EV-MSG-FINISH-ENTRY
                 end-if
              end-if
           end-if.

           if InvioSol
              inquire gd(riga, 2), hidden-data in hid-documenti
               
              move hid-eva   to isol-chiave
              set isol-invio to true
              move user-codi  to isol-user
              call   "invio-sol" using isol-linkage
              cancel "invio-sol"
              if isol-status = 0
                 perform AGGIORNA-STATI-INVIO
              end-if
              set InvioSol to false
           end-if

           if StampaEvasione
              inquire gd(riga, 2), hidden-data in hid-documenti
               
              move hid-eva to tor-chiave
              read tordini no lock 
                   invalid continue
               not invalid 
                   move hid-anno-e  to stordc-da-anno stordc-a-anno
                   move hid-num-e   to stordc-da-num  stordc-a-num
                   move tor-data-creazione to stordc-da-data 
           stordc-a-data
                   set stordc-tutti to true
                   call   "stordcp" using stordcp-limiti
                   cancel "stordcp"
              end-read
              set StampaEvasione to false
           end-if

           if StampaBolla
              inquire gd(riga, 2), hidden-data in hid-documenti
               
              move hid-eva to tor-chiave
              read tordini no lock key tor-chiave
                   invalid continue
               not invalid
                   move tor-causale to tca-codice
                   read tcaumag no lock
                   if tca-si-stampa                     
                      if tor-anno-bolla not = 0         
                         set stbolle-Ristampa to true
                         move tor-anno-bolla  to stbolle-anno
                         move tor-num-bolla   to stb-numero-da 
           stb-numero-a
                         set stbolle-k-bolla  to true
                         call   "stbolle-p" using stbolle-linkage
                         cancel "stbolle-p"

                         initialize file-info
                         call "C$FILEINFO" using stbolle-path, file-info

                         if file-size not = 0
                            set  splcrt2graf-stampa      to true
                            set  splcrt2graf-windows     to true
                            move stbolle-path            to 
           splcrt2graf-percorso-stampa
                            set  splcrt2graf-orizzontale to true
                            set  splcrt2graf-forza-crt   to true
                            set  splcrt2graf-10pt        to true
                            call   "splcrt2graf" using splcrt2graf-link 
                            cancel "splcrt2graf"
                         end-if

                         call "C$DELETE" using stbolle-path
                      end-if
                   end-if
              end-read
              set StampaBolla to false
           end-if

           if StampaFattura
              inquire gd(riga, 2), hidden-data in hid-documenti
               
              move hid-anno-f to tor-anno-fattura
              move hid-num-f  to tor-num-fattura
              read tordini no lock key k-fattura
                   invalid continue
               not invalid 
                   if tor-anno-fattura not = 0
                      move tor-anno-fattura to LinkAnno
                      move 1                to LinkElab
                      move tor-num-fattura  to num-da num-a
                      move "C"              to Link-tipo-stampa
                      set tutte             to true
                      move 1                to num-copie
                      set Fatture           to true
                      call   "stfatt-p" using stfatt-linkage
                      cancel "stfatt-p"
                   end-if
              end-read
              set StampaFattura to false
           end-if

           if RiepilogoOrdini
              accept como-data from century-date
              accept como-ora  from time
              initialize path-tmp-ordf-art
              accept  path-tmp-ordf-art from environment "PATH_ST"
              inspect path-tmp-ordf-art replacing trailing spaces by 
           low-value
              string  path-tmp-ordf-art delimited low-value
                      "TMP_ORDF_ART_"   delimited size
                      como-data         delimited size
                      "_"               delimited size
                      como-ora          delimited size
                      into path-tmp-ordf-art
              end-string
              move spaces to ext-file
              open output tmp-ordf-art
              move low-value    to rof-rec
              move hid-articolo to rof-cod-articolo
              start rordforn key >= rof-k-articolo
                    invalid continue
                not invalid
                    perform until 1 = 2
                       read rordforn next at end exit perform end-read
                       if rof-cod-articolo not = hid-articolo
                          exit perform
                       end-if
                       move rof-chiave to tof-chiave
                       read tordforn no lock
                            invalid exit perform cycle
                       end-read
                       if tof-chiuso
                          continue
                       else
                          move path-tmp-ordf-art to ext-file
                          set cli-tipo-F to true
                          move tof-cod-forn to cli-codice
                          read clienti no lock
                          move rof-chiave         to toa-chiave     
                          move tof-data-ordine    to toa-data-ordine
                          move cli-ragsoc-1       to toa-forn
                          move cli-tel-1          to toa-tel
                          move rof-qta-ord        to toa-ord
                          move rof-qta-evasa      to toa-eva
                                                                       
                          move 0 to toa-data-arrivo sof-data-arr

                          move rof-chiave to sof-chiave
                          read sordforn no lock 
                               invalid 
                               move 0 to toa-qta-soll
                               move 0 to sof-prog
                               read sordforn
                                    invalid 
      *****                              move 0      to toa-data-arrivo
                                    move space  to toa-dati-salvati
                                not invalid 
                                    move sof-data-arr     to 
           toa-data-arrivo
                                    move sof-dati-salvati to 
           toa-dati-salvati
                               end-read
                           not invalid 
                               move sof-data-arr     to toa-data-arrivo
                               move sof-qta          to toa-qta-soll    
            
                               move sof-dati-salvati to toa-dati-salvati
                          end-read                                  
                          if toa-data-arrivo = 0
                             move tof-data-consegna to toa-data-arrivo
                          end-if
                          if toa-data-arrivo not = sof-data-arr
                             move 0 to toa-data-ordine 
                          end-if

                          write toa-rec
                       end-if
                    end-perform
              end-start
              close       tmp-ordf-art
              if ext-file not = spaces
                 move "tmp-ordf-art" to como-file
                 call   "zoom-gt" using como-file, toa-rec
                                 giving stato-zoom
                 cancel "zoom-gt"
              end-if
              delete file tmp-ordf-art
              set RiepilogoOrdini to false
           end-if.

           |06/06/2012
           if StampaPOD
              call "C$SYSTEM" using FilePod, 193
              set StampaPOD to false
           end-if.
           |06/06/2012

           .
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM scr-ordini-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM scr-ordini-Exit
                 END-IF
              WHEN Key-Status = 1000
                 PERFORM chk-reg-LinkTo
              WHEN Key-Status = 1001
                 PERFORM chk-il-LinkTo
              WHEN Key-Status = 1002
                 PERFORM chk-sp-LinkTo
              WHEN Key-Status = 1003
                 PERFORM chk-st-LinkTo
              WHEN Key-Status = 1006
                 PERFORM chk-chiuso-LinkTo
              WHEN Key-Status = 27
                 PERFORM TOOL-CERCA-LinkTo
              WHEN Key-Status = 7
                 PERFORM TOOL-STAMPA-LinkTo
              WHEN Key-Status = 88
                 PERFORM pb-excel-LinkTo
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       scr-ordini-CLEAR.
           PERFORM scr-ordini-INIT-VALUE
           PERFORM scr-ordini-DISPLAY
           .

       scr-ordini-DISPLAY.
      * <TOTEM:EPT. FORM:scr-ordini, FORM:scr-ordini, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY Form1-Tb-1aa
           DISPLAY scr-ordini UPON scr-ordini-Handle
      * <TOTEM:EPT. FORM:scr-ordini, FORM:scr-ordini, AfterDisplay>
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       scr-ordini-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:scr-ordini, FORM:scr-ordini, BeforeExit>
           move 1 to num-screen.
           
           if path-tmp-solleciti-m not = spaces
              close       tmp-sol
              close       tmp-sol1
              close       tmp-sol2
              delete file tmp-sol
              move spaces to path-tmp-solleciti-m
           end-if.

           .
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       scr-ordini-Init-Data.
           MOVE 3 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
      * GRID
           PERFORM gd-art2-Content
      * COMBO-BOX
           PERFORM cbo-promo-Content
      * GRID
           PERFORM gd-Content
      * COMBO-BOX
           PERFORM cbo-num-Content
      * COMBO-BOX
           PERFORM cbo-clides-Content
      * COMBO-BOX
           PERFORM cbo-loca-Content
      * COMBO-BOX
           PERFORM cbo-numord-Content
      * COMBO-BOX
           PERFORM cbo-data-Content
      * COMBO-BOX
           PERFORM cbo-stato-Content
      * COMBO-BOX
           PERFORM cbo-num-e-Content
      * COMBO-BOX
           PERFORM cbo-data-e-Content
      * COMBO-BOX
           PERFORM cbo-num-b-Content
      * COMBO-BOX
           PERFORM cbo-data-b-Content
      * COMBO-BOX
           PERFORM cbo-num-f-Content
      * COMBO-BOX
           PERFORM cbo-data-f-Content
           .

       scr-ordini-DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           PERFORM scr-ordini-DataSet1-Update-Key
           .

       scr-ordini-DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-mtordini-KEY1-ORDER
           END-EVALUATE
           PERFORM scr-ordini-DataSet1-Update-Key
           .

       scr-ordini-DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-mtordini-KEY1-ORDER
           END-EVALUATE
           PERFORM scr-ordini-DataSet1-Update-Key
           .

       scr-ordini-DataSet1-Update-Key.
           MOVE mto-rec OF mtordini TO
                     scr-ordini-MULKEY-TMPBUF
           PERFORM scr-ordini-CLEAR
           PERFORM scr-ordini-INIT-DATA
           MOVE scr-ordini-MULKEY-TMPBUF TO
                     mto-rec OF mtordini
           PERFORM DataSet1-mtordini-Read
           PERFORM scr-ordini-DUPLICATE-MOVEKEY
           PERFORM scr-ordini-DUMMY-CURR
           PERFORM scr-ordini-IUD-Display
           .

       scr-ordini-DUPLICATE-MOVEKEY.
           .

       scr-ordini-First.
           PERFORM scr-ordini-DUMMY-FIRST
           PERFORM DataSet1-mtordini-INITSTART
           PERFORM DataSet1-mtordini-START
           IF NOT Valid-STATUS-mtordini
              PERFORM scr-ordini-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:scr-ordini, FORM:scr-ordini, BeforeFirst>
      * <TOTEM:END>
           PERFORM DataSet1-mtordini-Read-Next
           IF NOT Valid-STATUS-mtordini
              PERFORM scr-ordini-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:scr-ordini, FORM:scr-ordini, AfterFirst>
      * <TOTEM:END>
           PERFORM scr-ordini-DUPLICATE-MOVEKEY.
           PERFORM scr-ordini-IUD-Display
           .

       scr-ordini-Previous.
              PERFORM scr-ordini-Buf-To-Fld
              PERFORM DataSet1-mtordini-START-LESS
           IF NOT Valid-STATUS-mtordini
              PERFORM scr-ordini-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:scr-ordini, FORM:scr-ordini, BeforePrevious>
      * <TOTEM:END>
           PERFORM DataSet1-mtordini-Read-Prev
           IF NOT Valid-STATUS-mtordini
              PERFORM scr-ordini-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:scr-ordini, FORM:scr-ordini, AfterPrevious>
      * <TOTEM:END>
           PERFORM scr-ordini-DUPLICATE-MOVEKEY
           PERFORM scr-ordini-DUMMY-PREVIOUS
           PERFORM scr-ordini-IUD-Display
           .

       scr-ordini-Next.
              PERFORM scr-ordini-Buf-To-Fld
              PERFORM DataSet1-mtordini-START-GREATER
           IF NOT Valid-STATUS-mtordini
              PERFORM scr-ordini-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:scr-ordini, FORM:scr-ordini, BeforeNext>
      * <TOTEM:END>
           PERFORM DataSet1-mtordini-Read-Next
           IF NOT Valid-STATUS-mtordini
              PERFORM scr-ordini-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:scr-ordini, FORM:scr-ordini, AfterNext>
      * <TOTEM:END>
           PERFORM scr-ordini-DUPLICATE-MOVEKEY
           PERFORM scr-ordini-DUMMY-NEXT
           PERFORM scr-ordini-IUD-Display
           .
      
       scr-ordini-Last.
           PERFORM scr-ordini-DUMMY-LAST
           PERFORM DataSet1-mtordini-INITEND
           PERFORM DataSet1-mtordini-START-NOTGREATER
           IF NOT Valid-STATUS-mtordini
              PERFORM scr-ordini-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:scr-ordini, FORM:scr-ordini, BeforeLast>
      * <TOTEM:END>
           PERFORM DataSet1-mtordini-Read-Prev
           IF NOT Valid-STATUS-mtordini
              PERFORM scr-ordini-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:scr-ordini, FORM:scr-ordini, AfterLast>
      * <TOTEM:END>
           PERFORM scr-ordini-DUPLICATE-MOVEKEY.
           PERFORM scr-ordini-IUD-Display
           .

       scr-ordini-Curr.
      * <TOTEM:EPT. FORM:scr-ordini, FORM:scr-ordini, BeforeCurrent>
      * <TOTEM:END>
           PERFORM scr-ordini-Buf-To-Fld
           PERFORM DataSet1-mtordini-Read
           PERFORM scr-ordini-DUPLICATE-MOVEKEY
           PERFORM scr-ordini-DUMMY-CURR
           PERFORM scr-ordini-IUD-Display
      * <TOTEM:EPT. FORM:scr-ordini, FORM:scr-ordini, AfterCurrent>
      * <TOTEM:END>
           .

       scr-ordini-IUD-Display.
           IF Valid-STATUS-mtordini
              PERFORM scr-ordini-ALLGRID-RESET
              PERFORM scr-ordini-Fld-To-Buf
              PERFORM scr-ordini-NAVI-FOR-MASTERGRID
              PERFORM scr-ordini-DISPLAY
           ELSE
              IF scr-ordini-FLAG-REFRESH
                 CONTINUE
              ELSE
                 PERFORM scr-ordini-Extended-File-Status
              END-IF
           END-IF
           .

       scr-ordini-Add.
           PERFORM scr-ordini-Buf-To-Fld
           PERFORM scr-ordini-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM scr-ordini-DUMMY-ADD
           PERFORM DataSet1-mtordini-INITREC
           PERFORM scr-ordini-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:scr-ordini, FORM:scr-ordini, BeforeAdd>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-mtordini-Rec-Write
           IF Valid-STATUS-mtordini
              PERFORM scr-ordini-RESUMMARY-INS
              PERFORM scr-ordini-DUMMY-UPDATE-INIT
              MOVE "301" TO TOTEM-MSG-ID
              PERFORM scr-ordini-IUD-Display
           END-IF
           PERFORM scr-ordini-ERR-CHECKING
      * <TOTEM:EPT. FORM:scr-ordini, FORM:scr-ordini, AfterAdd>
      * <TOTEM:END>
           .
     
       scr-ordini-Update.
           PERFORM scr-ordini-Buf-To-Fld
           PERFORM DataSet1-mtordini-START              
           IF NOT Valid-STATUS-mtordini
              PERFORM scr-ordini-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
           PERFORM DataSet1-mtordini-Read
           PERFORM scr-ordini-Buf-To-Fld
           PERFORM scr-ordini-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM scr-ordini-DUMMY-UPDATE
           PERFORM scr-ordini-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:scr-ordini, FORM:scr-ordini, BeforeUpdate>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-mtordini-Rec-Rewrite
           IF Valid-STATUS-mtordini
              PERFORM scr-ordini-RESUMMARY-DEL
              PERFORM scr-ordini-DUMMY-UPDATE-INIT
              MOVE "302" TO TOTEM-MSG-ID
              PERFORM scr-ordini-IUD-Display
           END-IF
           PERFORM scr-ordini-ERR-CHECKING
      * <TOTEM:EPT. FORM:scr-ordini, FORM:scr-ordini, AfterUpdate>
      * <TOTEM:END>
           .

       scr-ordini-Delete.
           MOVE "203" TO TOTEM-MSG-ID
           PERFORM MESSAGE-BOX-DISPLAY
           IF TOTEM-MSG-RETURN-VALUE NOT = 1
              INITIALIZE TOTEM-MSG-TEXT
              EXIT PARAGRAPH 
           END-IF
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:scr-ordini, FORM:scr-ordini, BeforeDelete>
      * <TOTEM:END>
           PERFORM scr-ordini-DUMMY-DELETE
      * delete
           PERFORM scr-ordini-Buf-To-Fld
           PERFORM DataSet1-mtordini-Rec-Delete
           IF Valid-STATUS-mtordini
              PERFORM scr-ordini-CLEAR
              PERFORM scr-ordini-DUMMY-DELETE-INIT
              MOVE "303" TO TOTEM-MSG-ID
              MOVE "00" to STATUS-mtordini
           END-IF
      * <TOTEM:EPT. FORM:scr-ordini, FORM:scr-ordini, AfterDelete>
      * <TOTEM:END>
           PERFORM scr-ordini-ERR-CHECKING
           .

       scr-ordini-NAVI-FOR-MASTERGRID.
           .

       scr-ordini-ERR-CHECKING.
           IF Valid-STATUS-mtordini
              PERFORM scr-ordini-SHOW-MSG-ROUTINE
           ELSE
              PERFORM scr-ordini-Extended-File-Status
           END-IF
           .

       scr-ordini-RESUMMARY-INS.
           .

       scr-ordini-RESUMMARY-DEL.
           .


       scr-ordini-DUMMY-FIRST.
           .

       scr-ordini-DUMMY-PREVIOUS.
           .

       scr-ordini-DUMMY-NEXT.
           .

       scr-ordini-DUMMY-LAST.
           .

       scr-ordini-DUMMY-CURR.
           .

       scr-ordini-DUMMY-ADD.
           .

       scr-ordini-DUMMY-UPDATE.
           .

       scr-ordini-DUMMY-UPDATE-INIT.
           .

       scr-ordini-DUMMY-DELETE.
           .

       scr-ordini-DUMMY-DELETE-INIT.
           .

       scr-ordini-Init-Value.
      * FORM : scr-ordini
           PERFORM DataSet1-INIT-RECORD
      * <TOTEM:EPT. FORM:scr-ordini, FORM:scr-ordini, SetDefault>
      * <TOTEM:END>
           PERFORM scr-ordini-FLD-TO-BUF
           .


       scr-ordini-ALLGRID-RESET.
           .

      * for Form's Validation
       scr-ordini-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       scr-ordini-Buf-To-Fld.
      * <TOTEM:EPT. FORM:scr-ordini, FORM:scr-ordini, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:scr-ordini, FORM:scr-ordini, AfterBufToFld>
      * <TOTEM:END>
           .

       scr-ordini-Fld-To-Buf.
      * <TOTEM:EPT. FORM:scr-ordini, FORM:scr-ordini, BeforeFldToBuf>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:scr-ordini, FORM:scr-ordini, AfterFldToBuf>
      * <TOTEM:END>
           .

       scr-ordini-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform scr-ordini-BUF-TO-FLD.
           move 0 to scelta.
           .
       scr-ordini-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM scr-ordini-SHOW-MSG-ROUTINE
           .

       scr-ordini-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM scr-ordini-DISPLAY-MESSAGE
           .

       scr-ordini-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       scr-ordini-Save-Status.
           MOVE DataSet1-mtordini-KEY1-ORDER TO 
           TMP-scr-ordini-KEY1-ORDER
           MOVE DataSet1-KEYIS TO TMP-scr-ordini-KEYIS
           MOVE mto-rec OF mtordini TO 
              TMP-scr-ordini-mtordini-RESTOREBUF
           .             

       scr-ordini-Restore-Status.
           MOVE TMP-scr-ordini-KEY1-ORDER TO 
           DataSet1-mtordini-KEY1-ORDER
           MOVE TMP-scr-ordini-KEYIS TO DataSet1-KEYIS
           MOVE TMP-scr-ordini-mtordini-RESTOREBUF TO
              mto-rec OF mtordini
           PERFORM DataSet1-mtordini-START
           IF Valid-STATUS-mtordini
              PERFORM DataSet1-mtordini-Read-Next
           ELSE
              PERFORM DataSet1-mtordini-INITREC
           END-IF
           PERFORM UNTIL NOT Valid-STATUS-mtordini OR
              (Valid-STATUS-mtordini AND
                 mto-rec OF mtordini = 
                   TMP-scr-ordini-mtordini-RESTOREBUF)
              PERFORM DataSet1-mtordini-Read-Next
           END-PERFORM
           .


      * Paragrafo per la struttura del codice in AFTER sulla screen scr-ordini
      ***---
       scr-ordini-AFTER-SCREEN.

      * Generazione risettaggio keyboard "." ---> "."

      * Generazione stringa perform CONTROLLO
           evaluate control-id
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER CONTROLLO della screen
           when 99999 continue
           when other continue
           end-evaluate.

       scr-excel-Open-Routine.
           PERFORM scr-excel-Scrn
           PERFORM scr-excel-Proc
           .

       scr-excel-Scrn.
           PERFORM scr-excel-Create-Win
           PERFORM scr-excel-Init-Value
           PERFORM scr-excel-Init-Data
      * Tab keystrok settings
      * Tool Bar
           PERFORM scr-excel-DISPLAY
           .

       scr-excel-Create-Win.
           Display Independent GRAPHICAL WINDOW
              LINES 4,80,
              SIZE 35,90,
              CELL HEIGHT 10,
              CELL WIDTH 10,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 65793,
              ERASE,
              LABEL-OFFSET 0,
              LINK TO THREAD,
              RESIZABLE,
              NO SCROLL,
              USER-GRAY,
              USER-WHITE,
              No WRAP,
              HANDLE IS scr-elab-HANDLE,
      * <TOTEM:EPT. FORM:scr-excel, FORM:scr-excel, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
      * Status-bar
           DISPLAY scr-excel UPON scr-elab-HANDLE
      * DISPLAY-COLUMNS settings
           .

       scr-excel-PROC.
      * <TOTEM:EPT. FORM:scr-excel, FORM:scr-excel, BeforeAccept>
           call "w$mouse" using set-mouse-shape, wait-pointer   

           if stsolleciti-excel = 1                          
              move "Estrazione excel in corso..." to tit-elab
           else
              move "Stampa in corso..." to tit-elab
           end-if.
           display scr-excel.
           perform STAMPA.

           call "w$mouse" using set-mouse-shape, arrow-pointer.

           perform SCR-EXCEL-EXIT.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT OMITTED LINE 1 COL 1
                 ON EXCEPTION
                    PERFORM scr-excel-Evaluate-Func
                 MOVE 4 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:scr-excel, FORM:scr-excel, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:scr-excel, FORM:scr-excel, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY scr-elab-HANDLE
           INITIALIZE Key-Status
           .

       scr-excel-Evaluate-Func.
      * <TOTEM:EPT. FORM:scr-excel, FORM:scr-excel, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM scr-excel-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM scr-excel-Exit
                 END-IF
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       scr-excel-CLEAR.
           PERFORM scr-excel-INIT-VALUE
           PERFORM scr-excel-DISPLAY
           .

       scr-excel-DISPLAY.
      * <TOTEM:EPT. FORM:scr-excel, FORM:scr-excel, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY scr-excel UPON scr-elab-HANDLE
      * <TOTEM:EPT. FORM:scr-excel, FORM:scr-excel, AfterDisplay>
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       scr-excel-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:scr-excel, FORM:scr-excel, BeforeExit>
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       scr-excel-Init-Data.
           MOVE 4 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
           .

       scr-excel-Init-Value.
      * <TOTEM:EPT. FORM:scr-excel, FORM:scr-excel, SetDefault>
      * <TOTEM:END>
           PERFORM scr-excel-FLD-TO-BUF
           .


       scr-excel-ALLGRID-RESET.
           .

      * for Form's Validation
       scr-excel-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       scr-excel-Buf-To-Fld.
      * <TOTEM:EPT. FORM:scr-excel, FORM:scr-excel, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:scr-excel, FORM:scr-excel, AfterBufToFld>
      * <TOTEM:END>
           .

       scr-excel-Fld-To-Buf.
      * <TOTEM:EPT. FORM:scr-excel, FORM:scr-excel, BeforeFldToBuf>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:scr-excel, FORM:scr-excel, AfterFldToBuf>
      * <TOTEM:END>
           .

       scr-excel-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform scr-excel-BUF-TO-FLD.
           move 0 to scelta.
           .
       scr-excel-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM scr-excel-SHOW-MSG-ROUTINE
           .

       scr-excel-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM scr-excel-DISPLAY-MESSAGE
           .

       scr-excel-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       scr-excel-Save-Status.
           .             

       scr-excel-Restore-Status.
           .


      * Paragrafo per la struttura del codice in AFTER sulla screen scr-excel
      ***---
       scr-excel-AFTER-SCREEN.

      * Generazione risettaggio keyboard "." ---> "."

      * Generazione stringa perform CONTROLLO
           evaluate control-id
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER CONTROLLO della screen
           when 99999 continue
           when other continue
           end-evaluate.



       Screen1-Ta-1-TABCHANGE.
           MOVE 0 TO 
                   Screen1-Pg-2-Visible,
           EVALUATE Screen1-Ta-1-TAB-VALUE
           WHEN 1
                  MOVE 1 TO Screen1-Pg-2-Visible
                  MODIFY Screen1-Ta-1, VALUE = 1
           END-EVALUATE
           MOVE 65 TO CONTROL-ID
           DISPLAY Form1
           .

       Form1-BeforeProcedure.
           EVALUATE Control-Id
           WHEN 5001 MOVE "." to TOTEM-HINT-TEXT
           WHEN 5002 MOVE "." to TOTEM-HINT-TEXT
           WHEN 5003 MOVE "." to TOTEM-HINT-TEXT
           WHEN 5004 MOVE "." to TOTEM-HINT-TEXT
           WHEN 5005 MOVE "." to TOTEM-HINT-TEXT
           WHEN 5006 MOVE "." to TOTEM-HINT-TEXT
           WHEN 5007 MOVE "." to TOTEM-HINT-TEXT
           WHEN 5008 MOVE "." to TOTEM-HINT-TEXT
           WHEN OTHER MOVE SPACES TO TOTEM-HINT-TEXT
           END-EVALUATE
           EVALUATE Control-Id
           When 5001 PERFORM EF-data-FROM-BeforeProcedure
           When 5002 PERFORM EF-DATA-TO-BeforeProcedure
           When 5003 PERFORM ef-cli-BeforeProcedure
           When 5004 PERFORM ef-dest-BeforeProcedure
           When 5005 PERFORM ef-cli-BeforeProcedure
           When 5006 PERFORM ef-cli-BeforeProcedure
           When 5007 PERFORM ef-cli-BeforeProcedure
           When 5008 PERFORM ef-cli-BeforeProcedure
           END-EVALUATE
           .

       Screen1-Event-Proc.
           .

       gd-art2-Event-Proc.
           EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
           WHEN Msg-Begin-Drag ALSO 5001 ALSO
                    scr-ordini-Handle 
              PERFORM gd-art2-Ev-Msg-Begin-Drag
           WHEN Msg-Begin-Entry ALSO 5001 ALSO
                    scr-ordini-Handle 
              PERFORM gd-art2-Ev-Msg-Begin-Entry
           WHEN Msg-End-Drag ALSO 5001 ALSO
                    scr-ordini-Handle 
              PERFORM gd-art2-Ev-Msg-End-Drag
           WHEN Msg-Finish-Entry ALSO 5001 ALSO
                    scr-ordini-Handle 
              PERFORM gd-art2-Ev-Msg-Finish-Entry
           WHEN Msg-Goto-Cell ALSO 5001 ALSO
                    scr-ordini-Handle 
              PERFORM gd-art2-Ev-Msg-Goto-Cell
           WHEN Msg-Goto-Cell-Drag ALSO 5001 ALSO
                    scr-ordini-Handle 
              PERFORM gd-art2-Ev-Msg-Goto-Cell-Drag
           WHEN Msg-Goto-Cell-Mouse ALSO 5001 ALSO
                    scr-ordini-Handle 
              PERFORM gd-art2-Ev-Msg-Goto-Cell-Mouse
           END-EVALUATE
           .

       cbo-promo-Exception-Proc.
           IF Event-Occurred
              EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
              WHEN Ntf-Selchange ALSO 11 ALSO
                    scr-ordini-Handle
                 PERFORM cbo-promo-Ex-Ntf-Selchange
              END-EVALUATE
           END-IF
           .

       gd-Event-Proc.
           EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
           WHEN Msg-Begin-Entry ALSO 6 ALSO
                    scr-ordini-Handle 
              PERFORM gd-Ev-Msg-Begin-Entry
           END-EVALUATE
           .

       cbo-num-Event-Proc.
           .

       cbo-num-Exception-Proc.
           IF Event-Occurred
              EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
              WHEN Ntf-Selchange ALSO 14 ALSO
                    scr-ordini-Handle
                 PERFORM cbo-num-Ex-Ntf-Selchange
              END-EVALUATE
           END-IF
           .

       cbo-clides-Event-Proc.
           .

       cbo-clides-Exception-Proc.
           IF Event-Occurred
              EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
              WHEN Ntf-Selchange ALSO 15 ALSO
                    scr-ordini-Handle
                 PERFORM cbo-clides-Ex-Ntf-Selchange
              END-EVALUATE
           END-IF
           .

       cbo-loca-Event-Proc.
           .

       cbo-loca-Exception-Proc.
           IF Event-Occurred
              EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
              WHEN Ntf-Selchange ALSO 16 ALSO
                    scr-ordini-Handle
                 PERFORM cbo-loca-Ex-Ntf-Selchange
              END-EVALUATE
           END-IF
           .

       cbo-numord-Event-Proc.
           .

       cbo-numord-Exception-Proc.
           IF Event-Occurred
              EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
              WHEN Ntf-Selchange ALSO 17 ALSO
                    scr-ordini-Handle
                 PERFORM cbo-numord-Ex-Ntf-Selchange
              END-EVALUATE
           END-IF
           .

       cbo-data-Event-Proc.
           .

       cbo-data-Exception-Proc.
           IF Event-Occurred
              EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
              WHEN Ntf-Selchange ALSO 18 ALSO
                    scr-ordini-Handle
                 PERFORM cbo-data-Ex-Ntf-Selchange
              END-EVALUATE
           END-IF
           .

       cbo-stato-Event-Proc.
           .

       cbo-stato-Exception-Proc.
           IF Event-Occurred
              EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
              WHEN Ntf-Selchange ALSO 19 ALSO
                    scr-ordini-Handle
                 PERFORM cbo-stato-Ex-Ntf-Selchange
              END-EVALUATE
           END-IF
           .

       cbo-num-e-Event-Proc.
           .

       cbo-num-e-Exception-Proc.
           IF Event-Occurred
              EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
              WHEN Ntf-Selchange ALSO 20 ALSO
                    scr-ordini-Handle
                 PERFORM cbo-num-e-Ex-Ntf-Selchange
              END-EVALUATE
           END-IF
           .

       cbo-data-e-Event-Proc.
           .

       cbo-data-e-Exception-Proc.
           IF Event-Occurred
              EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
              WHEN Ntf-Selchange ALSO 21 ALSO
                    scr-ordini-Handle
                 PERFORM cbo-data-e-Ex-Ntf-Selchange
              END-EVALUATE
           END-IF
           .

       cbo-num-b-Event-Proc.
           .

       cbo-num-b-Exception-Proc.
           IF Event-Occurred
              EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
              WHEN Ntf-Selchange ALSO 22 ALSO
                    scr-ordini-Handle
                 PERFORM cbo-num-b-Ex-Ntf-Selchange
              END-EVALUATE
           END-IF
           .

       cbo-data-b-Event-Proc.
           .

       cbo-data-b-Exception-Proc.
           IF Event-Occurred
              EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
              WHEN Ntf-Selchange ALSO 23 ALSO
                    scr-ordini-Handle
                 PERFORM cbo-data-b-Ex-Ntf-Selchange
              END-EVALUATE
           END-IF
           .

       cbo-num-f-Event-Proc.
           .

       cbo-num-f-Exception-Proc.
           IF Event-Occurred
              EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
              WHEN Ntf-Selchange ALSO 29 ALSO
                    scr-ordini-Handle
                 PERFORM cbo-num-f-Ex-Ntf-Selchange
              END-EVALUATE
           END-IF
           .

       cbo-data-f-Event-Proc.
           .

       cbo-data-f-Exception-Proc.
           IF Event-Occurred
              EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
              WHEN Ntf-Selchange ALSO 38 ALSO
                    scr-ordini-Handle
                 PERFORM cbo-data-f-Ex-Ntf-Selchange
              END-EVALUATE
           END-IF
           .

      * USER DEFINE PARAGRAPH
       AGGIORNA-STATI-INVIO.
      * <TOTEM:PARA. AGGIORNA-STATI-INVIO>
           modify gd, mass-update = 1.
           perform CHIUDI-RIGHE.      
           move riga-padre to riga.                        
           inquire gd(riga-padre, 1), hidden-data in gd-hidden.
           set hid-open to true.                           
           modify gd(riga-padre, 1),
                  bitmap        = multi-s-bmp,
                  bitmap-number = 2,
                  bitmap-width  = 16.
           modify gd(riga-padre, 1), hidden-data gd-hidden.
           inquire gd(riga, 1), hidden-data in gd-hidden.
           perform APRI-RIGHE         
           move riga-padre to riga.
           modify gd, cursor-y = riga-figlio, cursor-x = 16.
           modify gd, mass-update = 0 
           .
      * <TOTEM:END>

       APRI-RIGHE.
      * <TOTEM:PARA. APRI-RIGHE>
           move riga to store-riga.
           add 1 to store-riga.
           modify gd, insertion-index store-riga, insert-rows = 1.
           set hid-figlio to true.
           set hid-open   to true.
           modify gd(store-riga, 1), hidden-data gd-hidden. 
           modify gd(store-riga,  3), cell-data "ARTICOLO".
           modify gd(store-riga,  4), cell-data "PROMO".
           modify gd(store-riga,  5), cell-data "ORD".
           modify gd(store-riga,  6), cell-data "EVA".
           modify gd(store-riga,  7), cell-data "Stato".
           modify gd(store-riga,  8), cell-data "Nr. E".
           modify gd(store-riga,  9), cell-data "Data E".
           modify gd(store-riga, 10), cell-data "Bolla".
           modify gd(store-riga, 11), cell-data "Data B".
           modify gd(store-riga, 12), cell-data "Fatt.".
           modify gd(store-riga, 13), cell-data "Data F".
           modify gd(store-riga, 14), cell-data "POD".
           modify gd(store-riga, 15), cell-data "Stato Consegna".
           modify gd(store-riga, 16), cell-data "INVIO".

           modify gd(store-riga,  3), cell-color 78-colore-testata.
           modify gd(store-riga,  4), cell-color 78-colore-testata.
           modify gd(store-riga,  5), cell-color 78-colore-testata.
           modify gd(store-riga,  6), cell-color 78-colore-testata.
           modify gd(store-riga,  7), cell-color 78-colore-testata.
           modify gd(store-riga,  8), cell-color 78-colore-testata.
           modify gd(store-riga,  9), cell-color 78-colore-testata.
           modify gd(store-riga, 10), cell-color 78-colore-testata.
           modify gd(store-riga, 11), cell-color 78-colore-testata.
           modify gd(store-riga, 12), cell-color 78-colore-testata.
           modify gd(store-riga, 13), cell-color 78-colore-testata.
           modify gd(store-riga, 14), cell-color 78-colore-testata.
           modify gd(store-riga, 15), cell-color 78-colore-testata 
           modify gd(store-riga, 16), cell-color 78-colore-testata .

           modify gd (store-riga, 1),
                  bitmap        = multi-s-bmp,
                  bitmap-number = 4,
                  bitmap-width  = 16.

           set hid-open   to true.
           set hid-figlio to true.
           modify gd(store-riga, 1), hidden-data gd-hidden.
           
           modify gd(store-riga), row-font Arial8B-Occidentale.
           
           move hid-chiave      to sol-ordine      of tmp-sol.
           move hid-data-ordine to sol-data-ordine of tmp-sol.
           move 0               to sol-prog-art    of tmp-sol.
           move 0               to sol-prog-eva    of tmp-sol.
           set  sol-testa    of tmp-sol to true.
           read tmp-sol no lock.
           move sol-stato   of tmp-sol to save-stato.
           move sol-blocco  of tmp-sol to save-blocco.

           move low-value       to sol-rec      of tmp-sol.
           set  sostituito      to false.
           move hid-chiave      to sol-ordine   of tmp-sol.
           move hid-data-ordine to sol-data-ordine of tmp-sol.
           move 1               to sol-prog-art of tmp-sol.
           move 0               to sol-prog-eva of tmp-sol.
           start tmp-sol key >= sol-chiave  of tmp-sol
                 invalid continue
           end-start.
           perform until 1 = 2
              read tmp-sol next no lock at end exit perform end-read
              if sol-ordine      of tmp-sol not = hid-chiave   or
                 sol-data-ordine of tmp-sol not = hid-data-ordine
                 exit perform 
              end-if
              if sol-sost-si of tmp-sol
                 set sostituito to true
              else
                 set sostituito to false
              end-if

              if sol-qta-o of tmp-sol <= sol-tot-evasa of tmp-sol
                 set evasa-tutto to true
              else
                 set evasa-tutto to false
              end-if

      *****        if sol-valido-si of tmp-sol 
      *****           if sol-evasioni of tmp-sol = 0 and filtra-evasioni
      *****              set sol-valido-no of tmp-sol to true
      *****              rewrite sol-rec of tmp-sol
      *****           end-if
      *****        else
      *****           if sol-evasioni of tmp-sol = 0 and not filtra-evasioni
      *****              set sol-valido-si of tmp-sol to true
      *****              rewrite sol-rec of tmp-sol
      *****           end-if
      *****        end-if

              if sol-valido-si of tmp-sol
                 move sol-tot-evasa of tmp-sol to tot-evasa

                 move sol-desart    of tmp-sol to col-clides
                 move sol-promo     of tmp-sol to col-localita
                 move sol-qta-o     of tmp-sol to col-ord-cli como-evasa
                 inspect col-ord-cli replacing leading x"30" by x"20"
                 call "C$JUSTIFY" using col-ord-cli, "R"
              
                 move 0 to num-evasioni

                 if sol-stato of tmp-sol = "07"
                    set riga-chiusa to true
                 else
                    set riga-chiusa to false
                 end-if
                                    
                 perform sol-evasioni of tmp-sol times
                    read tmp-sol next no lock at end exit perform 
           end-read
                          
                    if sol-valido-si of tmp-sol
                       add 1         to store-riga
                       add 1         to num-evasioni
                       modify gd, insertion-index store-riga, 
           insert-rows 1
                       set hid-figlio to true
                       set hid-open   to true
                       modify gd(store-riga, 1), hidden-data gd-hidden
                    
                       if sol-data-b of tmp-sol = 0 and 
                          sol-data-f of tmp-sol = 0
                          move "LAV." to col-stato
                       else
                          if sol-data-f  of tmp-sol not = 0
                             move "FATT" to col-stato
                          else
                             if sol-data-b  of tmp-sol not = 0
                                move "BOLL" to col-stato
                             end-if
                          end-if
                       end-if
                    
                       move sol-qta-e of tmp-sol to col-data-ord
                    
                       inspect col-data-ord replacing leading x"30" by 
           x"20"
                       call "C$JUSTIFY" using col-data-ord, "R"
                    
                       move sol-num-e of tmp-sol to col-nr-e
                       if sol-data-e  of tmp-sol = 0
                          move spaces to col-data-e
                       else
                          string sol-data-e of tmp-sol(7:2) delimited 
           size
                                 "/"                        delimited 
           size
                                 sol-data-e of tmp-sol(5:2) delimited 
           size
                                 "/"                        delimited 
           size
                                 sol-data-e of tmp-sol(3:2) delimited 
           size
                                 into col-data-e
                          end-string
                       end-if
                       
                       move sol-num-b of tmp-sol to col-nr-b
                       if sol-data-b  of tmp-sol = 0
                          move spaces to col-data-b
                       else
                          string sol-data-b of tmp-sol(7:2) delimited 
           size
                                 "/"                        delimited 
           size
                                 sol-data-b of tmp-sol(5:2) delimited 
           size
                                 "/"                        delimited 
           size
                                 sol-data-b of tmp-sol(3:2) delimited 
           size
                                 into col-data-b
                          end-string
                       end-if
                    
                       move sol-num-f of tmp-sol to col-nr-f   
                       if sol-data-f  of tmp-sol = 0
                          move spaces to col-data-f
                       else
                          string sol-data-f of tmp-sol(7:2) delimited 
           size
                                 "/"                        delimited 
           size
                                 sol-data-f of tmp-sol(5:2) delimited 
           size
                                 "/"                        delimited 
           size
                                 sol-data-f of tmp-sol(3:2) delimited 
           size
                                 into col-data-f
                          end-string
                       end-if
                    
                       initialize col-esito
                       string sol-vett  of tmp-sol delimited size
                              " - "                delimited size
                              sol-esito of tmp-sol delimited size
                              into col-esito  
                       end-string

                       modify gd (store-riga, 1),
                              bitmap        = multi-s-bmp,
                              bitmap-number = 4,
                              bitmap-width  = 16
                    
                       if num-evasioni not = 1
                          move spaces  to col-clides
                          move spaces  to col-localita
                          move spaces  to col-ord-cli
                       end-if

                       |06/06/2012
                       perform CERCA-POD
                                        
                       if trovato
                          move "P.O.D." to col-pod
                          modify gd (store-riga, 10), hidden-data 
           FilePod
                       else
                          move spaces to col-pod
                          modify gd (store-riga, 10), hidden-data spaces
                       end-if
                       |06/06/2012

                       perform CERCA-STATO-INVIO

                       modify gd (store-riga,  3), cell-data col-clides
                       modify gd (store-riga,  4), cell-data 
           col-localita
                       modify gd (store-riga,  5), cell-data col-ord-cli
                       modify gd (store-riga,  6), cell-data 
           col-data-ord
                       modify gd (store-riga,  7), cell-data col-stato
                       modify gd (store-riga,  8), cell-data col-nr-e
                       modify gd (store-riga,  9), cell-data col-data-e
                       modify gd (store-riga, 10), cell-data col-nr-b
                       modify gd (store-riga, 11), cell-data col-data-b
                       modify gd (store-riga, 12), cell-data col-nr-f
                       modify gd (store-riga, 13), cell-data col-data-f
                       modify gd (store-riga, 14), cell-data col-pod  
                       modify gd (store-riga, 15), cell-data col-esito
                       modify gd (store-riga, 16), hidden-data col-invio
                                                  
                       evaluate col-invio
                       when -1 move 1 to num
                       when  0 move 2 to num
                       when  1 move 3 to num
                       end-evaluate
                       modify gd (store-riga, 16),
                              bitmap        = invio-sol-bmp,
                              bitmap-number = num,
                              bitmap-width  = 16

                       move sol-anno-e of tmp-sol to hid-anno-e
                       move sol-num-e  of tmp-sol to hid-num-e
                       move sol-anno-b of tmp-sol to hid-anno-b
                       move sol-num-b  of tmp-sol to hid-num-b
                       move sol-anno-f of tmp-sol to hid-anno-f
                       move sol-num-f  of tmp-sol to hid-num-f

                       modify gd (store-riga,  8), cell-color 514,
                                                   cell-font  
           Arial8BU-Occidentale
                       modify gd (store-riga,  9), cell-color 514
                                                   cell-font  
           Arial8BU-Occidentale
                       modify gd (store-riga, 10), cell-color 514
                                                   cell-font  
           Arial8BU-Occidentale
                       modify gd (store-riga, 11), cell-color 514
                                                   cell-font  
           Arial8BU-Occidentale
                       modify gd (store-riga, 12), cell-color 514
                                                   cell-font  
           Arial8BU-Occidentale
                       modify gd (store-riga, 13), cell-color 514
                                                   cell-font  
           Arial8BU-Occidentale
                       modify gd (store-riga, 14), cell-color 514
                                                   cell-font  
           Arial8BU-Occidentale

                       modify gd (store-riga, 2), hidden-data 
           hid-documenti

                       if num-evasioni = 1
                          modify gd (store-riga,  3), cell-color 
           78-colore-articolo
                          modify gd (store-riga,  4), cell-color 
           78-colore-articolo
                          if evasa-tutto
                             modify gd (store-riga,  5), cell-color 
           78-colore-evasa-tutto
                          else
                             modify gd (store-riga,  5), cell-color 
           78-colore-articolo
                          end-if
                       end-if
                    end-if
                 end-perform

                 evaluate num-evasioni
                 when 0
                      perform INQUIRE-FILTRI
                      if not filtra-evasioni
                         add 1 to store-riga
                         modify gd, insertion-index store-riga, 
           insert-rows 1
                         set hid-figlio to true
                         set hid-open   to true
                         modify gd(store-riga, 1), hidden-data gd-hidden
                         modify gd(store-riga, 1),
                                bitmap        = multi-s-bmp,
                                bitmap-number = 4,
                                bitmap-width  = 16
                         modify gd (store-riga, 3), cell-data col-clides
                         modify gd (store-riga, 4), cell-data 
           col-localita
                         modify gd (store-riga, 5), cell-data 
           col-ord-cli

                         move sol-ordine       of tmp-sol to mto-chiave
                         read mtordini no lock 
                              invalid display message "Contattare assist
      -    "enza con codice K1"
                         end-read
                         move sol-ordine       of tmp-sol to 
           mro-chiave-testa
                         move sol-progr-master of tmp-sol to mro-progr
                         read mrordini key mro-k-progr
                              invalid  display message "Contattare assis
      -    "tenza con codice K2"
                         end-read
                         if mto-chiuso or riga-chiusa
                            move "CHIUSO" to col-stato
                         else
                            if sostituito
                               move "SOST" to col-stato
                            else
                               move "REG"  to col-stato
                            end-if
                            perform IMPOSTA-CLIENTE-BLOCCATO
                         end-if
                         accept como-data from century-date
                         if mro-evadi-dal > como-data
                            initialize col-esito
                            string "Posticipata al "  delimited size
                                   mro-evadi-dal(7:2) delimited size
                                   "/"                delimited size
                                   mro-evadi-dal(5:2) delimited size
                                   "/"                delimited size
                                   mro-evadi-dal(1:4) delimited size
                                   into col-esito
                            end-string
                            modify gd (store-riga, 15), cell-color 161
                         else
                            move como-esito to col-esito
                            modify gd (store-riga, 15), cell-color 5
                         end-if
                         modify gd (store-riga, 15), cell-data  
           col-esito
                         
                         modify gd (store-riga, 7), cell-data col-stato
         
                         modify gd(store-riga,  3), cell-color 
           78-colore-articolo
                         if evasa-tutto
                            modify gd(store-riga,  5), cell-color 
           78-colore-evasa-tutto
                         end-if
                         modify gd(store-riga,  4), cell-color 
           78-colore-articolo
                         move sol-art    of tmp-sol to hid-articolo
                         modify gd (store-riga, 3), hidden-data 
           hid-articolo
                      end-if
         
                 when 1 
                      if not evasa-tutto
                         perform RIGA-SALDO
                      end-if
                 when other
                      if not evasa-tutto
                         perform RIGA-SALDO
                      end-if

                 end-evaluate
                 set sostituito to false
              end-if
           end-perform 
           .
      * <TOTEM:END>

       CARICA-ORDINI.
      * <TOTEM:PARA. CARICA-ORDINI>
           perform OPEN-OUTPUT-TMP-SOL.

           if ef-age-buf not = 0
              set k-agente to true
           end-if.
           if ef-cli-buf not = 0
              set k-clides to true
           end-if.
           if ef-gdo-buf not = spaces
              set k-gdo to true
           end-if.
           if ef-tipo-buf not = spaces
              set k-tipo to true
           end-if.

           set tutto-ok to true.
           set trovato  to false.
           move low-value to mto-rec.
           evaluate true
           when k-clides
                move ef-cli-buf  to mto-cod-cli
                move ef-dest-buf to mto-prg-destino
                move como-data-1 to mto-data-ordine
                start mtordini key >= mto-k-clides
                      invalid set errori to true
                end-start
           when k-agente
                move ef-age-buf  to mto-cod-agente
                move como-data-1 to mto-data-ordine
                start mtordini key >= mto-k-age
                      invalid set errori to true
                end-start
           when k-gdo
                move ef-gdo-buf  to mto-gdo
                move como-data-1 to mto-data-ordine
                start mtordini key >= mto-k-gdo
                      invalid set errori to true
                end-start
           when k-tipo
                move como-data-1 to mto-data-ordine
                start mtordini key >= mto-k-data
                      invalid set errori to true
                end-start
           end-evaluate.
      
           if tutto-ok
              perform until 1 = 2
                 read mtordini next no lock 
                      at end exit perform
                 end-read                               
                 set record-ok to true
                 evaluate true
                 when k-clides
                      if mto-cod-cli not = ef-cli-buf  
                         exit perform 
                      end-if
                      if ef-dest-buf not = 0
                         if mto-prg-destino not = ef-dest-buf
                            exit perform
                         end-if
                      end-if
                 when k-agente
                      if mto-cod-agente not = ef-age-buf
                         exit perform
                      end-if
                 when k-gdo
                      if mto-gdo not = ef-gdo-buf
                         exit perform
                      end-if
                 when k-tipo
                      move mto-cod-cli to cli-codice
                      set cli-tipo-C to true
                      read clienti no lock
                           invalid set record-ok to false
                       not invalid
                           if cli-tipo not = ef-tipo-buf
                              set record-ok to false
                           end-if
                      end-read
                 end-evaluate

                 if record-ok
                    if mto-data-ordine >= como-data-1 and
                       mto-data-ordine <= como-data-2
                    
                       initialize sol-rec of tmp-sol
                       move 0 to riga
                       set sol-testa        of tmp-sol    to true
                       move mto-chiave      to sol-ordine      of 
           tmp-sol
                       move mto-data-ordine to sol-data-ordine of 
           tmp-sol
                       if k-gdo
                          set  cli-tipo-C  to true
                          move mto-cod-cli to cli-codice
                          read clienti no lock invalid continue end-read
                          initialize sol-clides of tmp-sol
                          move cli-localita to sol-localita of tmp-sol
                          if mto-prg-destino not = 0
                             move mto-cod-cli     to des-codice
                             move mto-prg-destino to des-prog
                             read destini no lock invalid continue 
           end-read
                             inspect des-ragsoc-1 replacing trailing 
           spaces by low-value
                             string  des-ragsoc-1 delimited low-value
                                     " - "        delimited size
                                     des-localita delimited size
                                     into sol-clides of tmp-sol
                             end-string
                          else
                             inspect cli-ragsoc-1 replacing trailing 
           spaces by low-value
                             string  cli-ragsoc-1 delimited low-value
                                     " - "        delimited size
                                     cli-localita delimited size
                                     into sol-clides of tmp-sol
                             end-string
                          end-if
                          move cli-ragsoc-1 to sol-localita of tmp-sol
                       else
                          if k-agente or mto-prg-destino = 0
                             set  cli-tipo-C  to true
                             move mto-cod-cli to cli-codice
                             read clienti no lock invalid continue 
           end-read
                             move cli-ragsoc-1 to sol-clides   of 
           tmp-sol
                             move cli-localita to sol-localita of 
           tmp-sol
                          else
                             move mto-cod-cli     to des-codice
                             move mto-prg-destino to des-prog
                             read destini no lock invalid continue 
           end-read
                             move des-ragsoc-1 to sol-clides   of 
           tmp-sol
                             move des-localita to sol-localita of 
           tmp-sol
                          end-if
                       end-if
                       move mto-num-ord-cli to sol-numord-cli of tmp-sol
                       string mto-data-ordine(7:2) delimited size
                              "/"                  delimited size
                              mto-data-ordine(5:2) delimited size
                              "/"                  delimited size
                              mto-data-ordine(3:2) delimited size
                              into sol-data-video of tmp-sol
                       end-string
                       string mto-data-creazione(7:2) delimited size
                              "/"                     delimited size
                              mto-data-creazione(5:2) delimited size
                              "/"                     delimited size
                              mto-data-creazione(3:2) delimited size
                              into sol-data-creazione of tmp-sol
                       end-string
                       string mto-data-note1(7:2) delimited size
                              "/"                  delimited size
                              mto-data-note1(5:2) delimited size
                              "/"                  delimited size
                              mto-data-note1(3:2) delimited size
                              into sol-data-cons of tmp-sol
                       end-string
                    
      *****                 perform IMPOSTA-CLIENTE-BLOCCATO
      *****                 move col-esito to sol-esito of tmp-sol
                    
                       evaluate mto-stato-ordine
                       when 1 move "REG"    to sol-stato of tmp-sol
                       when 2 move "LAV"    to sol-stato of tmp-sol
                       when 3 move "SP"     to sol-stato of tmp-sol
                       when 4 move "ST"     to sol-stato of tmp-sol
                       when 5 move "FP"     to sol-stato of tmp-sol
                       when 6 move "FT"     to sol-stato of tmp-sol
                       when 7 move "CHIUSO" to sol-stato of tmp-sol
                       end-evaluate
                       
                       move mto-stato-ordine to sol-stato-ordine of 
           tmp-sol
                       if mto-bloccato 
                          set sol-blocco-si       of tmp-sol to true
                          move mto-causale-blocco 
                            to sol-causale-blocco of tmp-sol
                       else            
                          set sol-blocco-no   of tmp-sol to true
                       end-if
                       set sol-valido-si of tmp-sol to true
                       write sol-rec of tmp-sol
                       perform LOOP-RIGHE
                       if not trovata-riga
                          delete tmp-sol record
                       end-if
                    
                    end-if
                 end-if
              end-perform
           end-if.

      ***---
       LOOP-RIGHE.
           set trovata-riga to false.
           move low-value  to mro-rec.
           move mto-chiave to mro-chiave-testa.
           start mrordini key >= mro-chiave
                 invalid continue 
             not invalid
                 perform until 1 = 2
                    read mrordini next at end exit perform end-read
                    if mro-chiave-testa not = mto-chiave
                       exit perform
                    end-if
                    set record-ok to false
                    if tot-idx-art = 0
                       set record-ok to true
                    else
                       set idx-art to 1 
                       search el-art 
                       when el-art(idx-art) = mro-cod-articolo
                            set record-ok to true
                       end-search
                    end-if
                    if record-ok
                       set trovata-riga  to true 
                       set trovato       to true

                       initialize sol-rec of tmp-sol
                       add 1 to riga
                       set sol-articolo      of tmp-sol to true
                       move mro-chiave-testa to sol-ordine      of 
           tmp-sol
                       move mto-data-ordine  to sol-data-ordine of 
           tmp-sol
                       move riga             to sol-prog-art    of 
           tmp-sol
                       move mro-cod-articolo to art-codice 
                       move mro-cod-articolo to sol-art         of 
           tmp-sol
                       read articoli no lock
                       move art-codice to codice-x
                       inspect codice-x replacing leading x"30" by x"20"
                       call "C$JUSTIFY" using codice-x, "L"
                       inspect codice-x replacing trailing spaces by 
           low-value

                       inspect art-descrizione replacing trailing 
           spaces by low-value
                       initialize sol-desart of tmp-sol
                       if mro-si-blister
                          move "BLI" to mro-prg-tipo-imballo
                       end-if
                       string  codice-x             delimited low-value
                               " - "                delimited size
                               art-descrizione      delimited low-value
      *****                         " - "                delimited size
      *****                         mro-prg-tipo-imballo delimited size
                               into sol-desart of tmp-sol
                       end-string
                       if art-collegato not = 0
                          set sol-sost-si of tmp-sol to true
                       else
                          set sol-sost-no of tmp-sol to true
                       end-if
                       move mro-promo to tpr-codice
                       read tpromo no lock
                            invalid 
                            if mro-promo not = 0
                               move "NON TROVATO" to sol-promo of 
           tmp-sol
                            else
                               move spaces        to sol-promo of 
           tmp-sol
                            end-if
                        not invalid
                            if tpr-descrizione not = spaces
                               initialize sol-promo of tmp-sol
                               move tpr-ini-dpo to como-data
                               perform DATE-TO-SCREEN
                               move como-data to ini-vol
                               move tpr-fine-dpo to como-data
                               perform DATE-TO-SCREEN
                               move como-data to fine-vol
                               inspect tpr-descrizione replacing
                                       trailing spaces by low-value

                               move tpr-codice to tpr-codice-x
                               string tpr-descrizione delimited 
           low-value
                                      " DAL "         delimited size
                                      ini-vol         delimited size
                                      " AL "          delimited size
                                      fine-vol        delimited size
                                      into sol-promo  of tmp-sol
                               end-string
                            else
                               initialize sol-promo of tmp-sol
                               move tpr-ini-dpo to como-data
                               perform DATE-TO-SCREEN
                               move como-data to ini-vol
                               move tpr-fine-dpo to como-data
                               perform DATE-TO-SCREEN
                               move como-data to fine-vol
                       
                               move tpr-codice to tpr-codice-x
                               inspect tpr-codice-x replacing 
                               leading x"30" by x"20"
                               call "C$JUSTIFY" using tpr-codice-x, "L"
                               inspect tpr-codice-x replacing trailing 
           spaces by low-value
                               string "ID "      delimited size
                                      tpr-codice-x   delimited low-value
                                      " DAL "    delimited size
                                      ini-vol    delimited size
                                      " AL "     delimited size
                                      fine-vol   delimited size
                                      into sol-promo of tmp-sol
                               end-string
                            end-if
                       end-read
                       move mro-qta      to sol-qta-o of tmp-sol
                       set sol-valido-si of tmp-sol to true
                       write sol-rec     of tmp-sol invalid continue 
           end-write
                       move sol-chiave   of tmp-sol to save-chiave
                       perform LOOP-EVASIONI
                       move save-chiave  to sol-chiave of tmp-sol
                       read tmp-sol no lock
                       move num-evasioni to sol-evasioni     of tmp-sol
                       move tot-evasa    to sol-tot-evasa    of tmp-sol
                       move mro-progr    to sol-progr-master of tmp-sol
                       move mro-stato    to sol-stato        of tmp-sol
                       rewrite sol-rec of tmp-sol
                    end-if
                 end-perform
           end-start.

      ***---
       LOOP-EVASIONI.
           move 0 to num-evasioni tot-evasa.
           move low-value        to ror-rec.
           move mro-chiave-testa to ror-chiave-ordine-testa.
           move mro-progr        to ror-progr-master.
           start rordini key >= ror-k-master
                 invalid continue
             not invalid
                 perform until 1 = 2
                    read rordini next at end exit perform end-read
                    if ror-chiave-ordine-testa not = mro-chiave-testa or
                       ror-progr-master        not = mro-progr
                       exit perform
                    end-if
                    add 1       to num-evasioni

                    initialize sol-rec    of tmp-sol
                    set  sol-evas         of tmp-sol to true
                    move ror-cod-articolo to sol-art         of tmp-sol
                    move mto-chiave       to sol-ordine      of tmp-sol
                    move mto-data-ordine  to sol-data-ordine of tmp-sol
                    move riga             to sol-prog-art    of tmp-sol
                    move num-evasioni     to sol-prog-eva    of tmp-sol

                    move ror-qta          to sol-qta-e    of tmp-sol 
                    move ror-qta          to sol-qta-o    of tmp-sol
                    add  ror-qta          to tot-evasa
                    move ror-anno         to tor-anno
                    move ror-num-ordine   to tor-numero
                    read tordini no lock
                    move tor-anno           to sol-anno-e of tmp-sol
                    move tor-numero         to sol-num-e  of tmp-sol
                    move tor-data-creazione to sol-data-e of tmp-sol
                    move tor-anno-bolla     to sol-anno-b of tmp-sol
                    move tor-num-bolla      to sol-num-b  of tmp-sol
                    move tor-data-bolla     to sol-data-b of tmp-sol
                    move tor-num-fattura    to sol-num-f  of tmp-sol
                    move tor-data-fattura   to sol-data-f of tmp-sol
                    move tor-anno-fattura   to sol-anno-f of tmp-sol

                    move tor-vettore        to vet-codice
                    read tvettori no lock
                         invalid 
                         move spaces    to sol-vett of tmp-sol
                         if vet-codice = 0
                            move "DIR" to sol-vett of tmp-sol
                         end-if
                         move spaces    to sol-vet-sigla-pod of tmp-sol
                     not invalid 
                         move vet-sigla to sol-vett of tmp-sol
                         move vet-sigla-pod to sol-vet-sigla-pod of 
           tmp-sol
                    end-read

                    if tor-esito-consegna not = space
                       move tor-esito-consegna to tec-codice
                       read tescons 
                            invalid 
                            move "ESITO INESITENTE" to sol-esito of 
           tmp-sol
                        not invalid 
                            move tec-descrizione    to sol-esito of 
           tmp-sol
                       end-read
                    end-if
                    set sol-valido-si of tmp-sol to true
                    write sol-rec of tmp-sol
                 end-perform
           end-start 
           .
      * <TOTEM:END>

       CAMBIA-FONT-RIGA-M.
      * <TOTEM:PARA. CAMBIA-FONT-RIGA-M>
      *****     modify gd-ord(riga), row-font = small-font.
      *****
      *****     modify gd-ord(riga, 1),
      *****            bitmap        = elemento-bmp,
      *****            bitmap-number = 1,
      *****            bitmap-width  = 16.
      *****
      *****
      *****     move event-data-2 to riga.
      *****     modify gd-ord(riga), row-font = font-evidenzia-griglia.
      *****
      *****     modify gd-ord, (riga, 1),
      *****            bitmap        = elemento-bmp,
      *****            bitmap-number = 2,
      *****            bitmap-width  = 16.
      *****
      *****
      *****     display scr-ordini 
           .
      * <TOTEM:END>

       CERCA.
      * <TOTEM:PARA. CERCA>
           evaluate control-id
           when 78-ID-ef-cli
                inquire ef-cli, value in cli-codice
                set cli-tipo-c to true
                move   "clienti-all"  to como-file
                call   "zoom-gt"   using como-file, cli-rec
                                  giving stato-zoom
                cancel "zoom-gt"
      
                if stato-zoom = 0
                   move cli-codice   to ef-cli-buf
                   move cli-ragsoc-1 to lab-cli-buf
                   display ef-cli lab-cli
                end-if

           when 78-ID-ef-dest
                inquire ef-cli,  value in des-codice
                inquire ef-dest, value in des-prog
                move "clienti-des"   to como-file
                call   "zoom-gt"  using como-file, des-rec
                                 giving stato-zoom
                cancel "zoom-gt"
                if stato-zoom = 0
                   move des-prog     to ef-dest-buf
                   move des-ragsoc-1 to lab-dest-buf
                   display ef-dest lab-dest
                   move 4 to accept-control
                end-if 

           when 78-ID-ef-age
                inquire ef-age,  value in age-codice
                move "agenti"        to como-file
                call   "zoom-gt"  using como-file, age-rec
                                 giving stato-zoom
                cancel "zoom-gt"
                if stato-zoom = 0
                   move age-codice   to ef-age-buf
                   move age-ragsoc-1 to lab-age-buf
                   display ef-age lab-age
                   move 4 to accept-control
                end-if 

           when 78-ID-ef-gdo
                inquire ef-gdo,   value gdo-codice
                move "tgrupgdo"      to como-file
                call   "zoom-gt"  using como-file, gdo-rec
                                 giving stato-zoom
                cancel "zoom-gt"
                if stato-zoom = 0
                   move gdo-codice       to ef-gdo-buf
                   move gdo-intestazione to lab-gdo-buf
                   display ef-gdo lab-gdo
                   move 4 to accept-control
                end-if  

           when 78-ID-ef-tipo
                inquire ef-tipo,  value tcl-codice
                move "ttipocli"      to como-file
                call   "zoom-gt"  using como-file, tcl-rec
                                 giving stato-zoom
                cancel "zoom-gt"
                if stato-zoom = 0
                   move tcl-codice      to ef-tipo-buf
                   move tcl-descrizione to lab-tipo-buf
                   display ef-tipo lab-tipo
                   move 4 to accept-control
                end-if 

           when 78-ID-ef-art
                inquire ef-art,   value art-codice
                move "articoli"      to como-file
                call   "zoom-gt"  using como-file, art-rec
                                 giving stato-zoom
                cancel "zoom-gt"
                if stato-zoom = 0
                   move art-codice      to ef-art-buf
                   move art-descrizione to lab-aRt-buf
                   display ef-art lab-art
                   move 4 to accept-control
                end-if
           end-evaluate 
           .
      * <TOTEM:END>

       CERCA-POD.
      * <TOTEM:PARA. CERCA-POD>
           set trovato to false.

           move sol-data-b of tmp-sol(5:2) to mese.
           evaluate mese
           when 01  move "GENNAIO"   to mese-esteso
           when 02  move "FEBBRAIO"  to mese-esteso
           when 03  move "MARZO"     to mese-esteso
           when 04  move "APRILE"    to mese-esteso
           when 05  move "MAGGIO"    to mese-esteso
           when 06  move "GIUGNO"    to mese-esteso
           when 07  move "LUGLIO"    to mese-esteso
           when 08  move "AGOSTO"    to mese-esteso
           when 09  move "SETTEMBRE" to mese-esteso
           when 10  move "OTTOBRE"   to mese-esteso
           when 11  move "NOVEMBRE"  to mese-esteso
           when 12  move "DICEMBRE"  to mese-esteso
           end-evaluate.

           accept  PathPod from environment "PATH_POD".
           inspect PathPod replacing trailing spaces by low-value.
           move sol-num-b of tmp-sol to NomeFile.
           call "C$JUSTIFY" using NomeFile, "L".
           inspect NomeFile replacing leading x"30" by x"20".
           call "C$JUSTIFY" using NomeFile, "L".
           inspect NomeFile    replacing trailing spaces by low-value.
           inspect sol-vet-sigla-pod of tmp-sol  
                               replacing trailing spaces by low-value.
           inspect mese-esteso replacing trailing spaces by low-value.

           initialize FilePod.
           string PathPod     delimited low-value
                  sol-anno-b  of tmp-sol
                              delimited size
                  "\"         delimited size
                  mese-esteso delimited low-value
                  "\"         delimited size
                  sol-vet-sigla-pod    of tmp-sol
                              delimited low-value
                  "\"         delimited size
                  NomeFile    delimited low-value
                  ".pdf"      delimited size
                  into FilePod
           end-string.
           
           initialize file-info.
           CALL "C$FILEINFO" using FilePod, FILE-INFO
                            giving status-code.

           if status-code = 0
              set trovato to true
              move FilePod to FilePod(2:)
              move x"22"   to FilePod(1:1)
              inspect FilePod replacing trailing spaces by low-value
              string  FilePod delimited low-value
                      x"22"   delimited size
                      into FilePod
              end-string
              inspect FilePod replacing trailing low-value by spaces
           end-if
           .
      * <TOTEM:END>

       CERCA-STATO-INVIO.
      * <TOTEM:PARA. CERCA-STATO-INVIO>
           move -1 to col-invio.
           if sol-anno-e of tmp-sol not = 0
              if sol-anno-b of tmp-sol not = 0  
                 move sol-anno-e  of tmp-sol to tor-anno
                 move sol-num-e   of tmp-sol to tor-numero
                 set isol-stato to true
                 move sol-anno-e  of tmp-sol to isol-anno
                 move sol-num-e   of tmp-sol to isol-numero
                 call   "invio-sol" using isol-linkage
                 cancel "invio-sol"
                 move isol-status to col-invio
              end-if
           end-if 
           .
      * <TOTEM:END>

       CHIUDI-RIGHE.
      * <TOTEM:PARA. CHIUDI-RIGHE>
           move riga to store-riga riga-figlio.
           if hid-figlio
              perform until 1 = 2
                 subtract 1 from store-riga
                 inquire gd(store-riga, 1), hidden-data gd-hidden
                 if hid-padre
                    exit perform
                 end-if
              end-perform
           end-if.
           set hid-close to true.
           modify gd(store-riga, 1), hidden-data = gd-hidden.

           modify gd(store-riga, 1),
                  bitmap        = multi-s-bmp,
                  bitmap-number = 3,
                  bitmap-width  = 16.

           modify gd(store-riga, 16),
                  bitmap        = invio-sol-bmp,
                  bitmap-number = 1,
                  bitmap-width  = 16.
                              
           move store-riga to riga-padre.
           add 1 to store-riga.
           perform until 1 = 2
              inquire gd(store-riga, 1), hidden-data gd-hidden,
                                         last-row in tot-righe
              if hid-padre or store-riga > tot-righe
                 exit perform 
              end-if
              modify gd, record-to-delete = store-riga
           end-perform 
           .
      * <TOTEM:END>

       CONTROLLO.
      * <TOTEM:PARA. CONTROLLO>
           set tutto-ok to true.

           evaluate control-id
           when 78-ID-ef-data-from
                inquire ef-data-from, value in como-data
                if como-data not = 0
                   perform DATE-FORMAT
                   move como-data to ef-data-from-buf
                   display ef-data-from
                end-if

           when 78-ID-ef-data-to
                inquire ef-data-to, value in como-data
                evaluate como-data
                when 0
                     accept como-data from century-date
                     perform DATE-TO-SCREEN
                     move como-data to ef-data-to-buf
                     display ef-data-to
                when 99999999 continue
                when other
                     perform DATE-FORMAT
                     move como-data to ef-data-to-buf
                     display ef-data-to
                end-evaluate
                inquire ef-data-from, value in como-data
                perform DATE-TO-FILE
                move como-data to como-data-1
            
                inquire ef-data-to, value in como-data
                perform DATE-TO-FILE
                move como-data to como-data-2
    
                if como-data-1 > como-data-2
                   set errori to true
                   display message "Range date errato"
                             title tit-err
                              icon 2
                   move 78-ID-ef-data-from to control-id
                end-if 

           when 78-ID-ef-cli
                inquire ef-cli value in ef-cli-buf
                move ef-cli-buf to cli-codice
                if cli-codice = 0
                   move spaces to cli-ragsoc-1
                   move 0      to ef-dest-buf
                   move spaces to lab-dest-buf
                   display ef-dest lab-dest
                else
                   move spaces to old-gdo-buf
                   set  cli-tipo-C to true
                   read clienti no lock
                        invalid
                        set errori to true
                        display message "Cliente non valido"
                                  title tit-err
                                   icon 2
                        move spaces to cli-ragsoc-1
                   end-read
                end-if
                move cli-ragsoc-1 to lab-cli-buf
                display lab-cli

           when 78-ID-ef-dest
                inquire ef-dest value in ef-dest-buf
                inquire ef-cli, value in des-codice
                move ef-dest-buf to des-prog
                if des-prog = 0
                   if des-codice = 0
                      move spaces            to des-ragsoc-1
                   else
                      move "TUTTI I DESTINI" to des-ragsoc-1
                   end-if
                else
                   read destini no lock
                        invalid
                        set errori to true
                        display message "Destino non valido"
                                  title tit-err
                                   icon 2
                        move spaces to des-ragsoc-1
                   end-read
                end-if
                move des-ragsoc-1 to lab-dest-buf
                display lab-dest

           when 78-ID-ef-age
                inquire ef-age value in age-codice
                if age-codice = 0
                   move spaces to age-ragsoc-1
                else
                   read agenti no lock
                        invalid
                        set errori to true
                        display message "Agente non valido"
                                  title tit-err
                                   icon 2
                        move spaces to age-ragsoc-1
                   end-read
                end-if
                move age-ragsoc-1 to lab-age-buf
                display lab-age

           when 78-ID-ef-gdo
                inquire ef-gdo value in gdo-codice
                if gdo-codice = spaces
                   move spaces to gdo-intestazione
                   modify cbo-promoa, reset-list = 1
                   modify cbo-promo,  reset-list = 1
                else
                   read tgrupgdo no lock
                        invalid
                        set errori to true
                        display message "Gruppo non valido"
                                  title tit-err
                                   icon 2
                        move spaces to gdo-intestazione
                        modify cbo-promoa, reset-list = 1
                        modify cbo-promo,  reset-list = 1
                        move spaces to old-gdo-buf
                    not invalid
                        perform RIEMPI-LISTINI
                   end-read
                end-if
                move gdo-intestazione to lab-gdo-buf
                display lab-gdo

           when 78-ID-ef-tipo
                inquire ef-tipo value in tcl-codice
                if tcl-codice = spaces
                   move spaces to tcl-descrizione
                else
                   read ttipocli no lock
                        invalid
                        set errori to true
                        display message "Tipologia Cliente non valida"
                                  title tit-err
                                   icon 2
                        move spaces to tcl-descrizione
                        move spaces to old-gdo-buf
                   end-read
                end-if
                move tcl-descrizione to lab-tipo-buf
                display lab-tipo

                inquire ef-cli  value in cli-codice 
                inquire ef-age  value in age-codice 
                inquire ef-tipo value in tcl-codice
                if cli-codice = 0      and 
                   age-codice = 0      and
                   gdo-codice = spaces and
                   tcl-codice = spaces
                   display message "Valorizzare Cliente o Agente o Grupp
      -    "o o Tiplogia"
                             title tit-err
                              icon 2
                   set errori to true
                   move 78-ID-ef-cli to control-id
                   move spaces to old-gdo-buf
                end-if 

                if cli-codice not = 0      and 
                   age-codice not = 0      and
                   gdo-codice not = spaces and 
                   tcl-codice not = spaces and tutto-ok
                   display message "Valorizzare Cliente o Agente o Grupp
      -    "o o Tipologia"
                             title tit-err
                              icon 2
                   set errori to true
                   move 78-ID-ef-cli to control-id
                   move spaces to old-gdo-buf
                end-if 

                if cli-codice not = 0      and 
                   age-codice not = 0      and tutto-ok
                   display message "Valorizzare Cliente o Agente"
                             title tit-err
                              icon 2
                   set errori to true
                   move 78-ID-ef-cli to control-id
                   move spaces to old-gdo-buf
                end-if 

                if cli-codice not = 0      and 
                   gdo-codice not = spaces and tutto-ok
                   display message "Valorizzare Cliente o Gruppo"
                             title tit-err
                              icon 2
                   set errori to true
                   move 78-ID-ef-cli to control-id
                   move spaces to old-gdo-buf
                end-if  

                if age-codice not = 0      and 
                   gdo-codice not = spaces and tutto-ok
                   display message "Valorizzare Agente o Gruppo"
                             title tit-err
                              icon 2
                   set errori to true
                   move 78-ID-ef-cli to control-id
                   move spaces to old-gdo-buf
                end-if 

                if age-codice not = 0      and 
                   tcl-codice not = spaces and tutto-ok
                   display message "Valorizzare Agente o Tipologia"
                             title tit-err
                              icon 2
                   set errori to true
                   move 78-ID-ef-cli to control-id
                   move spaces to old-gdo-buf
                end-if 

                if cli-codice not = 0      and 
                   tcl-codice not = spaces and tutto-ok
                   display message "Valorizzare Cliente o Tipologia"
                             title tit-err
                              icon 2
                   set errori to true
                   move 78-ID-ef-cli to control-id
                   move spaces to old-gdo-buf
                end-if 

                if cli-codice not = 0      and 
                   gdo-codice not = spaces and
                   tcl-codice not = spaces and tutto-ok
                   display message "Valorizzare Cliente o Gruppo o Tipol
      -    "ogia"
                             title tit-err
                              icon 2
                   set errori to true
                   move 78-ID-ef-cli to control-id
                   move spaces to old-gdo-buf
                end-if 

                if gdo-codice not = spaces and
                   tcl-codice not = spaces and tutto-ok
                   display message "Valorizzare Gruppo o Tipologia"
                             title tit-err
                              icon 2
                   set errori to true
                   move 78-ID-ef-cli to control-id
                   move spaces to old-gdo-buf
                end-if 

           when 78-ID-ef-art
                inquire ef-art value in art-codice
                if art-codice = 0
                   move spaces to art-descrizione
                else
                   read articoli no lock
                        invalid
                        set errori to true
                        display message "Articolo non valido"
                                  title tit-err
                                   icon 2
                        move spaces to art-descrizione
                   end-read
                end-if
                move art-descrizione to lab-art-buf
                display lab-art
                      

           end-evaluate.

           if errori
              perform CANCELLA-COLORE
              move control-id to store-id
              move 4          to accept-control
           end-if 
           .
      * <TOTEM:END>

       FILTRA-RECORD.
      * <TOTEM:PARA. FILTRA-RECORD>
           perform INQUIRE-FILTRI.
           if SiSalvato
              exit paragraph
           end-if.

           perform DISABILITA-FILTRI.
           modify gd, mass-update = 1.
           move low-value to sol-rec of tmp-sol.
           set sol-testa of tmp-sol to true.
           start tmp-sol key >= k-dt-testa
                 invalid continue
           end-start.
           move 2 to riga.
           perform until 1 = 2
              read tmp-sol next no lock at end exit perform end-read
              if sol-evas     of tmp-sol or 
                 sol-articolo of tmp-sol
                 exit perform 
              end-if
              set idx-presenti to 1
              search el-chiave
              at end
                 move sol-numero         of tmp-sol  to col-num
                 move sol-clides         of tmp-sol  to col-clides
                 move sol-localita       of tmp-sol  to col-localita
                 move sol-numord-cli     of tmp-sol  to col-ord-cli
                 move sol-data-video     of tmp-sol  to col-data-ord
                 move sol-data-creazione of tmp-sol  to col-data-e
                 move sol-data-cons      of tmp-sol  to col-data-b
                 move sol-stato          of tmp-sol  to col-stato
                 move sol-esito          of tmp-sol  to col-esito
                 perform CERCA-STATO-INVIO
                 set FromFile to true
                 perform VALUTA-PADRE
                 if record-ok
                    inquire gd, last-row in tot-righe
                    if riga <= tot-righe
                       modify gd, insertion-index riga, insert-rows 1
                    end-if
                    perform varying idx-presenti from 1 by 1 
                              until idx-presenti > 10000
                       if el-anno(idx-presenti) = 0
                          move sol-ordine of tmp-sol to 
           el-chiave(idx-presenti)
                          exit perform
                       end-if
                    end-perform
                    perform METTI-IN-GRID-TESTA
                    add 1 to riga
                 end-if

              when el-chiave(idx-presenti) = sol-ordine of tmp-sol
                   set FromGrid to true
                   perform VALORE-RIGA
                   if hid-padre
                      perform VALUTA-PADRE
                   end-if
              end-search
           end-perform.               
           modify gd, mass-update = 0.  
           perform ABILITA-FILTRI.

      ***---
       VALUTA-PADRE.
           set record-ok to false.
           if lab-num-buf not = spaces and
              lab-num-buf not = col-num
              perform ELIMINA-PADRE
              exit paragraph
           end-if.
           if lab-clides-buf not = spaces and
              lab-clides-buf not = col-clides
              perform ELIMINA-PADRE
              exit paragraph
           end-if.
           if lab-numord-buf not = spaces and
              lab-numord-buf not = col-ord-cli
              perform ELIMINA-PADRE
              exit paragraph
           end-if.
           if lab-loca-buf not = spaces and
              lab-loca-buf not = col-localita
              perform ELIMINA-PADRE
              exit paragraph
           end-if.
           if lab-data-buf not = spaces and
              lab-data-buf not = col-data-ord
              perform ELIMINA-PADRE
              exit paragraph
           end-if.
           if lab-stato-buf not = spaces and
              lab-stato-buf not = col-stato
              perform ELIMINA-PADRE
              exit paragraph
           end-if.

           evaluate sol-stato-ordine of tmp-sol
           when 1
                if chk-reg-buf = 0
                   perform ELIMINA-PADRE
                   exit paragraph
                end-if
           when 2
                if chk-il-buf = 0
                   perform ELIMINA-PADRE
                   exit paragraph
                end-if
           when 3
                if chk-sp-buf = 0
                   perform ELIMINA-PADRE
                   exit paragraph
                end-if
           when 4
                if chk-st-buf = 0
                   perform ELIMINA-PADRE
                   exit paragraph
                end-if
      *****     when 5
      *****          if chk-fp-buf = 0
      *****             perform ELIMINA-PADRE
      *****             exit paragraph
      *****          end-if
      *****     when 6
      *****          if chk-ft-buf = 0
      *****             perform ELIMINA-PADRE
      *****             exit paragraph
      *****          end-if
           when 7
                if chk-chiuso-buf = 0
                   perform ELIMINA-PADRE
                   exit paragraph
                end-if
           end-evaluate.

           move sol-chiave  of tmp-sol to save-chiave.
           move low-value   to sol-rec of tmp-sol2
           move sol-ordine  of tmp-sol to
                sol-ordine  of tmp-sol2.
           move sol-data-ordine of tmp-sol to
                sol-data-ordine of tmp-sol2.
           set sol-articolo of tmp-sol2 to true.
           move 0 to evasioni-valide articoli-validi.
           start tmp-sol2 key >= k-dt-testa
                 invalid continue
             not invalid
                 perform until 1 = 2
                    read tmp-sol2 next at end exit perform end-read
                    if sol-ordine  of tmp-sol2 not =
                       sol-ordine  of tmp-sol
                       exit perform
                    end-if
                    if sol-evas  of tmp-sol2 or
                       sol-testa of tmp-sol2
                       exit perform
                    end-if

                    if sol-valido-si   of tmp-sol2 
                       if sol-evasioni of tmp-sol2 = 0 and 
           filtra-evasioni
                          set sol-valido-no of tmp-sol2 to true
                          rewrite sol-rec   of tmp-sol2
                       end-if
                    else
                       if sol-evasioni      of tmp-sol2 = 0 and not 
                          filtra-evasioni
                          set sol-valido-si of tmp-sol2 to true
                          rewrite sol-rec   of tmp-sol2
                       end-if
                       if sol-evasioni      of tmp-sol2 not = 0
                          set sol-valido-si of tmp-sol2 to true
                          rewrite sol-rec   of tmp-sol2
                       end-if
                    end-if
                    if sol-valido-si of tmp-sol2
                       if cbo-promo-buf not = 78-tutti-vol
                          if sol-promo of tmp-sol2 not = cbo-promo-buf
                             set sol-valido-no of tmp-sol2 to true
                             rewrite sol-rec   of tmp-sol2
                          end-if
                       end-if
                    end-if

                    if sol-valido-si of tmp-sol2 and tot-idx-art not = 0
                       set idx-art to 1
                       search el-art
                       at end
                          set sol-valido-no of tmp-sol2 to true
                          rewrite sol-rec   of tmp-sol2
                       when el-art(idx-art) = sol-art of tmp-sol2
                            continue
                       end-search
                    end-if

                    if sol-valido-si of tmp-sol2
                       if sol-evasioni of tmp-sol2 not = 0
                          set valuta to true
                          perform VALUTA-ANNULLA-EVASIONI
                       else
                          move 1 to evasioni-valide
                          set sol-valido-si of tmp-sol2 to true
                          rewrite sol-rec   of tmp-sol2
                       end-if
                       add evasioni-valide to articoli-validi
                       if evasioni-valide = 0
                          set sol-valido-no of tmp-sol2 to true
                          rewrite sol-rec of tmp-sol2
                       end-if
                    else
                       set annulla to true
                       perform VALUTA-ANNULLA-EVASIONI
                    end-if
                 end-perform
           end-start.

           if articoli-validi = 0
              if FromGrid
                 perform ELIMINA-PADRE
              end-if
           else
              if FromFile
                 set record-ok to true
              else
                 if hid-open
                    perform CHIUDI-RIGHE
                    move save-ordine to hid-chiave
                    move save-data   to hid-data-ordine

                    inquire gd(riga, 1), hidden-data gd-hidden
                    set hid-open to true
                    modify  gd(riga, 1), hidden-data gd-hidden

                    modify  gd(riga, 1),
                            bitmap        = multi-s-bmp,
                            bitmap-number = 2,
                            bitmap-width  = 16

                    perform APRI-RIGHE
                    inquire gd, last-row in tot-righe
                    perform until 1 = 2
                       add 1 to riga
                       inquire gd(riga, 1), hidden-data gd-hidden
                       if hid-padre or riga > tot-righe
                          exit perform
                       end-if
                    end-perform
                    move save-chiave to sol-chiave of tmp-sol
                    start tmp-sol key > k-dt-testa
                          invalid continue
                    end-start
                 else
                    add 1 to riga
                 end-if
              end-if
           end-if.

      ***---
       VALUTA-ANNULLA-EVASIONI.
           move low-value  to sol-rec of tmp-sol1
           move sol-ordine of tmp-sol2 to
                sol-ordine of tmp-sol1
           set sol-evas of tmp-sol1 to true.
           move sol-prog-art of tmp-sol2 to sol-prog-art of tmp-sol1.
           move 0 to evasioni-valide.
           start tmp-sol1 key >= k-eva
                 invalid continue
             not invalid
                 perform until 1 = 2
                    read tmp-sol1 next no lock at end exit perform 
           end-read
                    if sol-ordine of tmp-sol1 not =
                       sol-ordine of tmp-sol2
                       exit perform
                    end-if
                    if sol-testa     of tmp-sol1 or
                       sol-articolo  of tmp-sol1
                       exit perform
                    end-if
                    if sol-prog-art of tmp-sol1 not =
                       sol-prog-art of tmp-sol2
                       exit perform
                    end-if
                    if valuta
                       perform VALUTA-EVASIONE
                    else
                       set sol-valido-no of tmp-sol1 to true
                       rewrite sol-rec   of tmp-sol1
                    end-if
                end-perform
                
           end-start.

      ***---
       ELIMINA-PADRE.
           if FromGrid
              if hid-open
                 move riga to store-riga
                 add 1 to store-riga
                 perform until 1 = 2
                    inquire gd, last-row in tot-righe
                    if store-riga > tot-righe
                       exit perform
                    end-if
                    inquire gd(store-riga, 1), hidden-data gd-hidden
                    if hid-padre exit perform end-if
                    modify gd, record-to-delete store-riga
                 end-perform
              end-if
              inquire gd(riga, 1), hidden-data gd-hidden
              modify gd(riga), record-to-delete riga
              set idx-presenti to 1
              search el-chiave
              when el-chiave(idx-presenti) = hid-chiave
                   move 0 to el-anno(idx-presenti)
                   move 0 to el-numero(idx-presenti)
              end-search
           end-if.               

      ***---
       VALUTA-EVASIONE.
           if lab-esito-buf  not = spaces and
              lab-esito-buf  not = sol-esito of tmp-sol1 
              set sol-valido-no of tmp-sol1 to true
              rewrite sol-rec   of tmp-sol1
              exit paragraph
           end-if.

           if lab-vett-buf   not = spaces and
              lab-vett-buf   not = sol-vett of tmp-sol1
              set sol-valido-no of tmp-sol1 to true
              rewrite sol-rec   of tmp-sol1
              exit paragraph
           end-if.

           string sol-data-f of tmp-sol1(7:2) delimited size
                  "/"                         delimited size
                  sol-data-f of tmp-sol1(5:2) delimited size
                  "/"                         delimited size
                  sol-data-f of tmp-sol1(3:2) delimited size
                  into como-data-x8
           end-string.
           if lab-data-f-buf not = spaces and
              lab-data-f-buf not = como-data-x8
              set sol-valido-no of tmp-sol1 to true
              rewrite sol-rec   of tmp-sol1
              exit paragraph
           end-if.
           
           move lab-num-f-buf to como-numero.
           if como-numero  not = 0 and
              como-numero  not = sol-num-f of tmp-sol1
              set sol-valido-no of tmp-sol1 to true
              rewrite sol-rec   of tmp-sol1
              exit paragraph
           end-if. 
                   
           string sol-data-b of tmp-sol1(7:2) delimited size
                  "/"                         delimited size
                  sol-data-b of tmp-sol1(5:2) delimited size
                  "/"                         delimited size
                  sol-data-b of tmp-sol1(3:2) delimited size
                  into como-data-x8
           end-string.
           if lab-data-b-buf not = spaces and
              lab-data-b-buf not = como-data-x8
              set sol-valido-no of tmp-sol1 to true
              rewrite sol-rec   of tmp-sol1
              exit paragraph
           end-if.

           move lab-num-b-buf to como-numero.
           if como-numero  not = 0 and
              como-numero  not = sol-num-b  of tmp-sol1
              set sol-valido-no of tmp-sol1 to true
              rewrite sol-rec   of tmp-sol1
              exit paragraph
           end-if.

           string sol-data-e of tmp-sol1(7:2) delimited size
                  "/"                         delimited size
                  sol-data-e of tmp-sol1(5:2) delimited size
                  "/"                         delimited size
                  sol-data-e of tmp-sol1(3:2) delimited size
                  into como-data-x8
           end-string.
           if lab-data-e-buf not = spaces and
              lab-data-e-buf not = como-data-x8
              set sol-valido-no of tmp-sol1 to true
              rewrite sol-rec   of tmp-sol1
              exit paragraph
           end-if.

           move lab-num-e-buf to como-numero.
           if como-numero  not = 0 and
              como-numero  not = sol-num-e  of tmp-sol1
              set sol-valido-no of tmp-sol1 to true
              rewrite sol-rec   of tmp-sol1
              exit paragraph
           end-if.
                  
           set sol-valido-si of tmp-sol1 to true.
           rewrite sol-rec   of tmp-sol1.
           add 1 to evasioni-valide.       

      ***---
       ABILITA-FILTRI.
           modify gd,         enabled true.     
           modify chk-reg,    enabled true.
           modify chk-il,     enabled true.
           modify chk-st,     enabled true.
           modify chk-sp,     enabled true.
           modify chk-chiuso, enabled true.
           modify cbo-promo,  enabled true.
           modify gd-art2,    enabled true.
           modify cbo-num,    enabled true.
           modify cbo-clides, enabled true.
           modify cbo-numord, enabled true.
           modify cbo-loca,   enabled true.
           modify cbo-data,   enabled true.
           modify cbo-numord, enabled true.
           modify cbo-stato,  enabled true.
           modify cbo-num-e,  enabled true.
           modify cbo-data-e, enabled true.
           modify cbo-num-b,  enabled true.
           modify cbo-data-b, enabled true.
           modify cbo-num-f,  enabled true.
           modify cbo-data-f, enabled true.

      ***---
       DISABILITA-FILTRI.
           modify gd,         enabled false.     
           modify chk-reg,    enabled false.
           modify chk-il,     enabled false.
           modify chk-st,     enabled false.
           modify chk-sp,     enabled false.
           modify chk-chiuso, enabled false.
           modify cbo-promo,  enabled false.
           modify gd-art2,    enabled false.
           modify cbo-num,    enabled false.
           modify cbo-clides, enabled false.
           modify cbo-numord, enabled false.
           modify cbo-loca,   enabled false.
           modify cbo-data,   enabled false.
           modify cbo-numord, enabled false.
           modify cbo-stato,  enabled false.
           modify cbo-num-e,  enabled false.
           modify cbo-data-e, enabled false.
           modify cbo-num-b,  enabled false.
           modify cbo-data-b, enabled false.
           modify cbo-num-f,  enabled false.
           modify cbo-data-f, enabled false 
           .
      * <TOTEM:END>

       IMPOSTA-CLIENTE-BLOCCATO.
      * <TOTEM:PARA. IMPOSTA-CLIENTE-BLOCCATO>
           move spaces to como-esito.
           set cli-tipo-C   to true
           move mto-cod-cli to cli-codice
           read clienti no lock invalid continue end-read
           if cli-attivo
              if mto-prg-destino not = 0
                 move mto-cod-cli     to des-codice
                 move mto-prg-destino to des-prog
                 read destini no lock invalid continue end-read
                 move des-stato to cli-stato
              end-if
           end-if.
           if cli-bloccato or cli-disattivo
              set mto-bloccato to true
              if cli-fuori-fido
                 continue
              else
                 move "BLOC" to col-stato
                 modify gd (store-riga, 8),
                        bitmap        = bloccato-REG-bmp,
                        bitmap-number = 1,
                        bitmap-width  = 41
              end-if
              if cli-disattivo
                 if des-disattivo
                    move "DESTINO DISATTIVO"   to como-esito
                 else
                    move "CLIENTE DISATTIVO"   to como-esito
                 end-if
              else
                 evaluate true
                 when cli-no-angraf
                      move "ANAGRAFICA ERRATA"   to como-esito
                 when cli-prob-pag
                      move "PROBLEMi PAGAMENTO"  to como-esito
                 when cli-nuovo-ragsoc
                      move "NUOVA RAG. SOCIALE"  to como-esito
                 when cli-fuori-fido
                      move spaces                to como-esito
      *****                move "FUORI FIDO"          to como-esito
                 when other
                      move "DESTINO BLOCCATO"    to como-esito
                 end-evaluate
              end-if
           end-if 
           .
      * <TOTEM:END>

       INITIALIZE-FILTRI.
      * <TOTEM:PARA. INITIALIZE-FILTRI>
      *****     modify cbo-esito,  reset-list = 1. 
      *****     modify cbo-vett,   reset-list = 1. 
           modify cbo-data-f, reset-list = 1. 
           modify cbo-num-f,  reset-list = 1. 
           modify cbo-data-b, reset-list = 1. 
           modify cbo-num-b,  reset-list = 1.
           modify cbo-data-e, reset-list = 1.
           modify cbo-num-e,  reset-list = 1.
           modify cbo-data,   reset-list = 1.
           modify cbo-stato,  reset-list = 1.
           modify cbo-numord, reset-list = 1.
           modify cbo-loca,   reset-list = 1.
           modify cbo-clides, reset-list = 1.
           modify cbo-num,    reset-list = 1.

           move spaces to lab-esito-buf   old-lab-esito-buf .
           move spaces to lab-vett-buf    old-lab-vett-buf  .
           move spaces to lab-data-f-buf  old-lab-data-f-buf.
           move spaces to lab-num-f-buf   old-lab-num-f-buf .
           move spaces to lab-data-b-buf  old-lab-data-b-buf.
           move spaces to lab-num-b-buf   old-lab-num-b-buf .
           move spaces to lab-data-e-buf  old-lab-data-e-buf.
           move spaces to lab-num-e-buf   old-lab-num-e-buf .
           move spaces to lab-stato-buf   old-lab-stato-buf .
           move spaces to lab-data-buf    old-lab-data-buf  .
           move spaces to lab-numord-buf  old-lab-numord-buf.
           move spaces to lab-loca-buf    old-lab-loca-buf  .
           move spaces to lab-clides-buf  old-lab-clides-buf.
           move spaces to lab-num-buf     old-lab-num-buf   .
           move cbo-promo-buf to OLD-cbo-promo-buf.

           display lab-esito.
           display lab-vett.
           display lab-data-f.
           display lab-num-f.
           display lab-data-b.
           display lab-num-b.
           display lab-data-e.
           display lab-num-e.
           display lab-stato.
           display lab-data.
           display lab-numord.
           display lab-loca.
           display lab-clides.
           display lab-num.

      *****     modify cbo-esito,  insertion-index = 1, item-to-add = 78-tutti.
      *****     modify cbo-vett,   insertion-index = 1, item-to-add = 78-tutti.
           modify cbo-data-f, insertion-index = 1, item-to-add = 
           78-tutti.
           modify cbo-num-f,  insertion-index = 1, item-to-add = 
           78-tutti.
           modify cbo-data-b, insertion-index = 1, item-to-add = 
           78-tutti.
           modify cbo-num-b,  insertion-index = 1, item-to-add = 
           78-tutti.
           modify cbo-data-e, insertion-index = 1, item-to-add = 
           78-tutti.
           modify cbo-num-e,  insertion-index = 1, item-to-add = 
           78-tutti.
           modify cbo-data,   insertion-index = 1, item-to-add = 
           78-tutti.
           modify cbo-stato,  insertion-index = 1, item-to-add = 
           78-tutti.
           modify cbo-numord, insertion-index = 1, item-to-add = 
           78-tutti.
           modify cbo-loca,   insertion-index = 1, item-to-add = 
           78-tutti.
           modify cbo-clides, insertion-index = 1, item-to-add = 
           78-tutti.
           modify cbo-num,    insertion-index = 1, item-to-add = 
           78-tutti.
           
           move 0 to tot-idx-num.
           move 0 to tot-idx-num-b.
           move 0 to tot-idx-num-f.
           move 0 to tot-idx-num-e.
           move 0 to tot-idx-data.
           move 0 to tot-idx-data-e.
           move 0 to tot-idx-data-b.
           move 0 to tot-idx-data-f.
           move 0 to tot-idx-clides.
           move 0 to tot-idx-loca.
           move 0 to tot-idx-esito.
           move 0 to tot-idx-stato.
           move 0 to tot-idx-vett.
           move 0 to tot-idx-numord.
           move 0 to tot-idx-promo.

           initialize tab1 tab2 tab3  tab4  tab5  tab6  tab7 
                      tab8 tab9 tab10 tab11 tab12 tab13 tab14 tab15   
           .
      * <TOTEM:END>

       INQUIRE-FILTRI.
      * <TOTEM:PARA. INQUIRE-FILTRI>
           set filtra-evasioni to false.
           set SiSalvato       to true.
           inquire lab-esito, value in lab-esito-buf.
           inquire lab-vett   value in lab-vett-buf.
           inquire lab-data-f value in lab-data-f-buf.
           inquire lab-num-f  value in lab-num-f-buf.
           inquire lab-data-b value in lab-data-b-buf.
           inquire lab-num-b  value in lab-num-b-buf.
           inquire lab-data-e value in lab-data-e-buf.
           inquire lab-num-e  value in lab-num-e-buf.

           inquire lab-stato  value in lab-stato-buf.
           inquire lab-data   value in lab-data-buf.
           inquire lab-numord value in lab-numord-buf.
           inquire lab-loca   value in lab-loca-buf.
           inquire lab-clides value in lab-clides-buf.
           inquire lab-num    value in lab-num-buf.

           if lab-esito-buf   not = spaces or
              lab-vett-buf    not = spaces or
              lab-data-f-buf  not = spaces or
              lab-num-f-buf   not = spaces or
              lab-data-b-buf  not = spaces or
              lab-num-b-buf   not = spaces or
              lab-data-e-buf  not = spaces or
              lab-num-e-buf   not = spaces
              set filtra-evasioni to true
           end-if.

           if lab-esito-buf   not = old-lab-esito-buf  or
              lab-vett-buf    not = old-lab-vett-buf   or
              lab-data-f-buf  not = old-lab-data-f-buf or
              lab-num-f-buf   not = old-lab-num-f-buf  or
              lab-data-b-buf  not = old-lab-data-b-buf or
              lab-num-b-buf   not = old-lab-num-b-buf  or
              lab-data-e-buf  not = old-lab-data-e-buf or
              lab-num-e-buf   not = old-lab-num-e-buf  or
              lab-stato-buf   not = old-lab-stato-buf  or
              lab-data-buf    not = old-lab-data-buf   or
              lab-numord-buf  not = old-lab-numord-buf or
              lab-loca-buf    not = old-lab-loca-buf   or
              lab-clides-buf  not = old-lab-clides-buf or
              lab-num-buf     not = old-lab-num-buf    or
              cbo-promo-buf   not = old-cbo-promo-buf  or
              tab-articoli    not = old-tab-articoli   or
              CheckPressed
              set NoSalvato to true
           end-if.

           move lab-esito-buf   to old-lab-esito-buf.
           move lab-vett-buf    to old-lab-vett-buf.
           move lab-data-f-buf  to old-lab-data-f-buf.
           move lab-num-f-buf   to old-lab-num-f-buf.
           move lab-data-b-buf  to old-lab-data-b-buf.
           move lab-num-b-buf   to old-lab-num-b-buf.
           move lab-data-e-buf  to old-lab-data-e-buf.
           move lab-num-e-buf   to old-lab-num-e-buf.
           move lab-stato-buf   to old-lab-stato-buf.
           move lab-data-buf    to old-lab-data-buf.
           move lab-numord-buf  to old-lab-numord-buf.
           move lab-loca-buf    to old-lab-loca-buf.
           move lab-clides-buf  to old-lab-clides-buf.
           move lab-num-buf     to old-lab-num-buf.
           move cbo-promo-buf   to old-cbo-promo-buf.
           move tab-articoli    to old-tab-articoli.

           set CheckPressed to true 
           .
      * <TOTEM:END>

       INTESTAZIONE.
      * <TOTEM:PARA. INTESTAZIONE>
           modify gd, reset-grid = 1.
                                           
           modify gd(1, 2), cell-data = "Master".
           if k-agente or k-tipo
              modify gd(1, 3), cell-data = "Cliente"
           else
              modify gd(1, 3), cell-data = "Destino"
           end-if.
           if k-gdo
              modify gd(1,  4), cell-data = "Cliente"
           else
              modify gd(1,  4), cell-data = "Località"
           end-if.
           modify gd(1,  5), cell-data = "Nr. Ord.".
           modify gd(1,  6), cell-data = "Data O".
           modify gd(1,  7), cell-data = "Stato".
           modify gd(1,  8), cell-data = "Bloc".
           modify gd(1,  9), cell-data = "Creato".
           modify gd(1, 11), cell-data = "Cons.".

           modify gd(1,  2), cell-color = 78-colore-testata.
           modify gd(1,  3), cell-color = 78-colore-testata.
           modify gd(1,  4), cell-color = 78-colore-testata.
           modify gd(1,  5), cell-color = 78-colore-testata.
           modify gd(1,  6), cell-color = 78-colore-testata.
           modify gd(1,  7), cell-color = 78-colore-testata.
           modify gd(1,  8), cell-color = 78-colore-testata.
           modify gd(1,  9), cell-color = 78-colore-testata.
           modify gd(1, 10), cell-color = 78-colore-testata.
           modify gd(1, 11), cell-color = 78-colore-testata.
           modify gd(1), row-font = Arial8B-Occidentale 
           .
      * <TOTEM:END>

       METTI-IN-GRID-TESTA.
      * <TOTEM:PARA. METTI-IN-GRID-TESTA>
           modify gd(riga ,  2), cell-data col-num.
           modify gd(riga ,  3), cell-data col-clides.
           modify gd(riga ,  4), cell-data col-localita.
           modify gd(riga ,  5), cell-data col-ord-cli.
           modify gd(riga ,  6), cell-data col-data-ord.
           modify gd(riga ,  7), cell-data col-stato.
           modify gd(riga ,  9), cell-data col-data-e.
           modify gd(riga , 11), cell-data col-data-b.
           modify gd(riga , 15), cell-data col-esito. 
           
           set hid-close   to true.
           set hid-padre   to true.
           move sol-ordine      of tmp-sol to hid-chiave.
           move sol-data-ordine of tmp-sol to hid-data-ordine.
           modify gd(riga, 1), hidden-data = gd-hidden.
           
           modify gd(riga, 1),
                  bitmap        = multi-s-bmp,
                  bitmap-number = 3,
                  bitmap-width  = 16.
           
           evaluate sol-stato of tmp-sol
           when "REG"    move 78-colore-registrato     to colore
                         move bloccato-REG-bmp         to bloccato-bmp
           when "LAV"    move 78-colore-in-lavorazione to colore
                         move bloccato-LAV-bmp         to bloccato-bmp
           when "SP"     move 78-colore-sped-parz      to colore
                         move bloccato-SP-bmp          to bloccato-bmp
           when "ST"     move 78-colore-sped-tot       to colore
                         move bloccato-ST-bmp          to bloccato-bmp
           when "FP"     move 78-colore-fatt-parz      to colore
                         move bloccato-FP-bmp          to bloccato-bmp
           when "FT"     move 78-colore-fatt-tot       to colore
                         move bloccato-FT-bmp          to bloccato-bmp
           when "CHIUSO" move 78-colore-chiuso         to colore
                         move bloccato-CHIUSO-bmp      to bloccato-bmp
                         set mto-bloccato to true
           end-evaluate.
                 
           modify gd(riga ,  2), cell-color colore.
           modify gd(riga ,  3), cell-color colore.
           modify gd(riga ,  4), cell-color colore.
           modify gd(riga ,  5), cell-color colore.
           modify gd(riga ,  6), cell-color colore.
           modify gd(riga ,  7), cell-color colore.
           modify gd(riga ,  9), cell-color colore.
           modify gd(riga , 10), cell-color colore.
           modify gd(riga , 11), cell-color colore.

           if sol-blocco-si of tmp-sol
              if sol-causale-blocco-fido    of tmp-sol or
                 sol-causale-blocco-manuale of tmp-sol
                  modify gd (riga, 8),
                     bitmap        = bloccato-bmp,
                     bitmap-number = 1,
                     bitmap-width  = 41
              else
                 modify gd(riga ,  8), cell-color colore
              end-if
           else
              modify gd(riga ,  8), cell-color colore
           end-if.
           
           modify gd(riga), row-font = Arial8-Occidentale 
           .
      * <TOTEM:END>

       OPEN-OUTPUT-TMP-SOL.
      * <TOTEM:PARA. OPEN-OUTPUT-TMP-SOL>
           accept como-data from century-date.
           accept como-ora  from time.
           initialize path-tmp-solleciti-m.
           accept  path-tmp-solleciti-m from environment "PATH_ST".
           inspect path-tmp-solleciti-m replacing trailing 
                                        spaces by low-value.
           string  path-tmp-solleciti-m delimited low-value
                   "tmp_solleciti-m"    delimited size
                   "_"                  delimited size
                   como-data            delimited size
                   "_"                  delimited size
                   como-ora             delimited size
                   ".tmp"               delimited size
                   into path-tmp-solleciti-m
           end-string.
           open output tmp-sol.
           close       tmp-sol.
           open i-o    tmp-sol.

           open i-o    tmp-sol1.
           open i-o    tmp-sol2 
           .
      * <TOTEM:END>

       PARAGRAFO-COPY.
      * <TOTEM:PARA. PARAGRAFO-COPY>
           copy "color-custom.cpy".
           copy "utydata.cpy".
           copy "calcola-colore-trasparente.cpy" 
           .
      * <TOTEM:END>

       RIEMPI-COMBO-RIGHE.
      * <TOTEM:PARA. RIEMPI-COMBO-RIGHE>
           if cbo-data-f-buf not = spaces
              set idx-data-f to 1
              search cbo-data-f-val
              at end
                 add 1 to tot-idx-data-f
                 move cbo-data-f-buf to cbo-data-f-val(tot-idx-data-f)
                 modify cbo-data-f  item-to-add cbo-data-f-buf
              when cbo-data-f-val(idx-data-f) = cbo-data-f-buf
                   continue
              end-search
           end-if.

           if cbo-data-b-buf not = spaces
              set idx-data-b to 1
              search cbo-data-b-val
              at end
                 add 1 to tot-idx-data-b
                 move cbo-data-b-buf to cbo-data-b-val(tot-idx-data-b)
                 modify cbo-data-b  item-to-add cbo-data-b-buf
              when cbo-data-b-val(idx-data-b) = cbo-data-b-buf
                   continue
              end-search
           end-if.

           if cbo-data-e-buf not = spaces
              set idx-data-e to 1
              search cbo-data-e-val
              at end
                 add 1 to tot-idx-data-e
                 move cbo-data-e-buf to cbo-data-e-val(tot-idx-data-e)
                 modify cbo-data-e item-to-add cbo-data-e-buf
              when cbo-data-e-val(idx-data-e) = cbo-data-e-buf
                   continue
              end-search
           end-if.

      *****     if cbo-esito-buf not = spaces
      *****        set idx-esito to 1
      *****        search cbo-esito-val
      *****        at end
      *****           add 1 to tot-idx-esito
      *****           move cbo-esito-buf to cbo-esito-val(tot-idx-esito)
      *****           modify cbo-esito item-to-add cbo-esito-buf
      *****        when cbo-esito-val(idx-esito) = cbo-esito-buf
      *****             continue
      *****        end-search
      *****     end-if.
      *****
      *****     if cbo-vett-buf not = spaces
      *****        set idx-vett to 1
      *****        search cbo-vett-val
      *****        at end
      *****           add 1 to tot-idx-vett
      *****           move cbo-vett-buf to cbo-vett-val(tot-idx-vett)
      *****           modify cbo-vett item-to-add cbo-vett-buf
      *****        when cbo-vett-val(idx-vett) =  cbo-vett-buf
      *****             continue
      *****        end-search
      *****     end-if.

           if cbo-num-e-buf not = spaces
              set idx-num-e to 1
              search cbo-num-e-val
              at end
                 add 1 to tot-idx-num-e
                 move cbo-num-e-buf to cbo-num-e-val(tot-idx-num-e)
                 modify cbo-num-e item-to-add cbo-num-e-buf
              when cbo-num-e-val(idx-num-e) = cbo-num-e-buf
                   continue
              end-search
           end-if.

           if cbo-num-b-buf not = spaces
              set idx-num-b to 1
              search cbo-num-b-val
              at end
                 add 1 to tot-idx-num-b
                 move cbo-num-b-buf to cbo-num-b-val(tot-idx-num-b)
                 modify cbo-num-b item-to-add cbo-num-b-buf
              when cbo-num-b-val(idx-num-b) = cbo-num-b-buf
                   continue
              end-search
           end-if.

           if cbo-num-f-buf not = spaces
              set idx-num-f to 1
              search cbo-num-f-val
              at end
                 add 1 to tot-idx-num-f
                 move cbo-num-f-buf to cbo-num-f-val(tot-idx-num-f)
                 modify cbo-num-f item-to-add cbo-num-f-buf
              when cbo-num-f-val(idx-num-f) = cbo-num-f-buf
                   continue
              end-search
           end-if.

           if sol-promo of tmp-sol not = spaces
              set idx-promo to 1
              search cbo-promo-val
              at end
                 add 1 to tot-idx-promo
                 move sol-promo of tmp-sol to 
           cbo-promo-val(tot-idx-promo)
                 modify cbo-promo item-to-add sol-promo of tmp-sol
              when cbo-promo-val(idx-promo) = sol-promo of tmp-sol
                   continue
              end-search
           end-if.

           if not scelta-articoli
              set idx-art to 1
              search el-art
              at end
                   add 1 to tot-idx-art
                   move sol-art of tmp-sol to el-art(tot-idx-art)
              when el-art(idx-art) = sol-art of tmp-sol
              end-search
           end-if 
           .
      * <TOTEM:END>

       RIEMPI-COMBO-TESTA.
      * <TOTEM:PARA. RIEMPI-COMBO-TESTA>
           if cbo-num-buf not = spaces
              set idx-num to 1
              search cbo-num-val
              at end
                 add 1 to tot-idx-num
                 move cbo-num-buf to cbo-num-val(tot-idx-num)
                 modify cbo-num item-to-add cbo-num-buf
              when cbo-num-val(idx-num) = cbo-num-buf
                   continue
              end-search
           end-if.
           
           if cbo-clides-buf not = spaces
              set idx-clides to 1
              search cbo-clides-val
              at end
                 add 1 to tot-idx-clides
                 move cbo-clides-buf to cbo-clides-val(tot-idx-clides)
                 modify cbo-clides item-to-add cbo-clides-buf
              when cbo-clides-val(idx-clides) = cbo-clides-buf
                   continue
              end-search
           end-if.
           
           if cbo-loca-buf not = spaces
              set idx-loca to 1
              search cbo-loca-val
              at end
                 add 1 to tot-idx-loca
                 move cbo-loca-buf to cbo-loca-val(tot-idx-loca)
                 modify cbo-loca item-to-add cbo-loca-buf
              when cbo-loca-val(idx-loca) = cbo-loca-buf
                   continue
              end-search
           end-if.

           if cbo-numord-buf not = spaces
              set idx-numord to 1
              search cbo-numord-val
              at end
                 add 1 to tot-idx-numord
                 move cbo-numord-buf to cbo-numord-val(tot-idx-numord)
                 modify cbo-numord item-to-add  cbo-numord-buf
              when cbo-numord-val(idx-numord) = cbo-numord-buf
                   continue
              end-search
           end-if.

           if cbo-data-buf not = spaces
              set idx-data to 1
              search cbo-data-val
              at end
                 add 1 to tot-idx-data
                 move cbo-data-buf to cbo-data-val(tot-idx-data)
                 modify cbo-data item-to-add cbo-data-buf
              when cbo-data-val(idx-data) = cbo-data-buf
                   continue
              end-search
           end-if.

           if cbo-stato-buf not = spaces
              set idx-stato to 1
              search cbo-stato-val
              at end
                 add 1 to tot-idx-stato
                 move cbo-stato-buf to cbo-stato-val(tot-idx-stato)
                 modify cbo-stato item-to-add cbo-stato-buf
              when cbo-stato-val(idx-stato) = cbo-stato-buf
                   continue
              end-search
           end-if 
           .
      * <TOTEM:END>

       RIEMPI-LISTINI.
      * <TOTEM:PARA. RIEMPI-LISTINI>
           if ef-gdo-buf = old-gdo-buf exit paragraph end-if.
           move 0 to idx.
           modify cbo-promoa, reset-list = 1.
           modify cbo-promo,  reset-list = 1.
           move low-value  to tpr-rec.
           move ef-gdo-buf to tpr-gdo.
           start tpromo key >= tpr-chiave-ricerca
                 invalid continue
             not invalid
                 perform until 1 = 2
                    read tpromo next at end exit perform end-read
                    if tpr-gdo not = ef-gdo-buf
                       exit perform
                    end-if
                    if idx = 0
                       move 1 to idx
                       modify cbo-promoa, item-to-add 78-tutti-vol
                       modify cbo-promo,  item-to-add 78-tutti-vol
                    end-if
                    if tpr-descrizione not = spaces
                       add 1 to idx
                       initialize cbo-promo-buf
                       inspect tpr-descrizione replacing trailing 
           spaces by low-value
                       move tpr-ini-dpo to como-data
                       perform DATE-TO-SCREEN
                       move como-data to ini-vol
                       move tpr-fine-dpo to como-data
                       perform DATE-TO-SCREEN
                       move como-data to fine-vol

                       string tpr-descrizione  delimited low-value
                              " DAL "          delimited size
                              ini-vol          delimited size
                              " AL "           delimited size
                              fine-vol         delimited size
                              into cbo-promo-buf
                       end-string
                    else
                       initialize cbo-promo-buf
                       move tpr-ini-dpo to como-data
                       perform DATE-TO-SCREEN
                       move como-data to ini-vol
                       move tpr-fine-dpo to como-data
                       perform DATE-TO-SCREEN
                       move como-data to fine-vol
                    
                       move tpr-codice to tpr-codice-x
                       inspect tpr-codice-x replacing 
                       leading x"30" by x"20"
                       call "C$JUSTIFY" using tpr-codice-x, "L"
                       inspect tpr-codice-x replacing trailing spaces 
           by low-value
                       string "ID "      delimited size
                              tpr-codice-x   delimited low-value
                              " DAL "    delimited size
                              ini-vol    delimited size
                              " AL "     delimited size
                              fine-vol   delimited size
                              into cbo-promo-buf
                       end-string
                    end-if
                    modify cbo-promoa, item-to-add cbo-promo-buf
                    modify cbo-promo,  item-to-add cbo-promo-buf
                    move cbo-promo-buf to cbo-promo-val(idx)
                 end-perform
           end-start.

           modify cbo-promoa, value 78-tutti-vol.
           move ef-gdo-buf to old-gdo-buf 
           .
      * <TOTEM:END>

       RIGA-SALDO.
      * <TOTEM:PARA. RIGA-SALDO>
           add 1 to store-riga.
           modify gd, insertion-index store-riga, insert-rows 1.
           set hid-figlio to true.
           set hid-open   to true.
           move sol-art of tmp-sol to hid-articolo.
           modify gd(store-riga, 3), hidden-data hid-articolo.
           modify gd(store-riga, 1), hidden-data gd-hidden.
           move hid-anno   to mto-anno.
           move hid-numero to mto-numero.
           read mtordini no lock.
           modify gd(store-riga, 1),
                  bitmap        = multi-s-bmp,
                  bitmap-number = 4,
                  bitmap-width  = 16.
           compute como-evasa = como-evasa - tot-evasa.
           move como-evasa to col-data-ord.
           inspect col-data-ord replacing leading x"30" by x"20".
           call "C$JUSTIFY" using col-data-ord, "R".
           modify gd (store-riga, 6), cell-data col-data-ord
                                      cell-color 5,
                                      cell-font Arial8B-Occidentale.
           if save-blocco-si
              modify gd (store-riga, 7),
                  bitmap        = bloccato-bmp,
                  bitmap-number = 1,
                  bitmap-width  = 32
           else
              if mto-chiuso or riga-chiusa
                 move "CHIUSO" to col-stato
              else
                 if sostituito
                    move "SOST" to col-stato
                 else
                    move "REG"  to col-stato
                 end-if
              end-if
              move sol-ordine of tmp-sol to mto-chiave
              read mtordini no lock invalid continue end-read
              perform IMPOSTA-CLIENTE-BLOCCATO
              move mto-chiave   to mro-chiave-testa
              move sol-prog-art of tmp-sol to mro-progr
              read mrordini no lock key mro-k-progr
                   invalid move 0 to mro-evadi-dal
              end-read
              
              accept como-data from century-date
              if mro-evadi-dal > como-data
                 initialize como-esito
                 string "Posticipata al "  delimited size
                        mro-evadi-dal(7:2) delimited size
                        "/"                delimited size
                        mro-evadi-dal(5:2) delimited size
                        "/"                delimited size
                        mro-evadi-dal(1:4) delimited size
                        into como-esito
                 end-string
              end-if

              modify  gd(store-riga,  7), cell-data  col-stato
              modify  gd(store-riga, 15), cell-data  como-esito
              modify  gd(store-riga, 15), cell-color 5
           end-if 
           .
      * <TOTEM:END>

       SPOSTAMENTO-ART.
      * <TOTEM:PARA. SPOSTAMENTO-ART>
           inquire gd-art2, last-row in tot-righe
           if event-data-2 > tot-righe
              add 1 to tot-righe giving riga
           else
              move event-data-2 to riga
           end-if.

           modify gd-art2, cursor-y riga, cursor-x 1.
           modify gd-art2, start-x = 1, x = 2,
                           start-y = riga, y = riga,
                           region-color = 144.
           set event-action to event-action-fail 
           .
      * <TOTEM:END>

       SPOSTAMENTO-M.
      * <TOTEM:PARA. SPOSTAMENTO-M>
      *****     inquire gd-ord, last-row in tot-righe.
      *****     if event-data-2 < 2 move 2 to event-data-2 end-if.
      *****     if event-data-2 > tot-righe move tot-righe to event-data-2 end-if.
      *****     if riga not = event-data-2 
      *****        perform CAMBIA-FONT-RIGA-M
      *****     end-if 
           .
      * <TOTEM:END>

       VALORE-RIGA.
      * <TOTEM:PARA. VALORE-RIGA>
           inquire gd(riga, 1),  hidden-data in gd-hidden.
           inquire gd(riga, 2),  cell-data in col-num.
           inquire gd(riga, 3),  cell-data in col-clides.
           inquire gd(riga, 4),  cell-data in col-localita.
           inquire gd(riga, 5),  cell-data in col-ord-cli.
           inquire gd(riga, 6),  cell-data in col-data-ord.
           inquire gd(riga, 7),  cell-data in col-stato.
           inquire gd(riga, 8),  cell-data in col-nr-e.
           inquire gd(riga, 9),  cell-data in col-data-e.
           inquire gd(riga, 10), cell-data in col-nr-b.
           inquire gd(riga, 11), cell-data in col-data-b.
           inquire gd(riga, 12), cell-data in col-nr-f.
           inquire gd(riga, 13), cell-data in col-data-f.
           inquire gd(riga, 14), cell-data in col-pod. 
           inquire gd(riga, 15), cell-data in col-esito.
           inquire gd(riga, 16), hidden-data in col-invio 
           .
      * <TOTEM:END>

       STAMPA.
      * <TOTEM:PARA. STAMPA>
           move path-tmp-solleciti-m  to stsolleciti-path-tmp
           move tab-articoli          to stsolleciti-articoli

      *     inquire ef-data,   VALUE stsolleciti-data
           move ef-data-from-buf   to stsolleciti-dt-da
           move ef-data-to-buf     to stsolleciti-dt-a
           inquire ef-cli,         VALUE stsolleciti-cli
           inquire ef-dest,        VALUE stsolleciti-dest
           inquire ef-age,         value stsolleciti-age
           inquire ef-gdo,         VALUE stsolleciti-gdo
           inquire cbo-promo,      VALUE stsolleciti-promo
           inquire ef-art,         value stsolleciti-art

           inquire cbo-num         value stsolleciti-num
           inquire cbo-clides      value stsolleciti-clides
           inquire cbo-loca        value stsolleciti-loca
           inquire cbo-numord      value stsolleciti-numord      
           inquire cbo-data        value stsolleciti-data
           inquire cbo-stato       value stsolleciti-stato
           inquire cbo-num-e       value stsolleciti-num-e
           inquire cbo-data-e      value stsolleciti-data-e
           inquire cbo-num-b       value stsolleciti-num-b
           inquire cbo-data-b      value stsolleciti-data-b
           inquire cbo-num-f       value stsolleciti-num-b
           inquire cbo-data-f      value stsolleciti-data-f
      *****     inquire cbo-vett        value stsolleciti-vet.
      *****     inquire cbo-esito       value stsolleciti-esito.

           inquire chk-reg         value stsolleciti-reg
           inquire chk-il          value stsolleciti-il
           inquire chk-sp          value stsolleciti-sp
           inquire chk-st          value stsolleciti-st
           inquire chk-chiuso      value stsolleciti-chiuso
           move user-codi to stsolleciti-user.

           inquire gd-art2, LAST-ROW tot-righe
           if tot-righe > 1
              set stsolleciti-si-f-art   to true
           else
              set stsolleciti-si-f-art   to false
           end-if.

           unlock tmp-sol all record
           unlock tmp-sol1 all record
           unlock tmp-sol2 all record


           call   "stsolleciti" using stsolleciti-linkage.
           cancel "stsolleciti" 



           .
      * <TOTEM:END>

      * EVENT PARAGRAPH
       bprepb-Ev-Before-Program.
      * <TOTEM:PARA. bprepb-Ev-Before-Program>
           perform CALCOLA-COLORE-TRASPARENTE.
           copy resource "multi-s.bmp".
           call "W$BITMAP" using wbitmap-load, "multi-s.bmp"
                          giving multi-s-bmp.

           copy resource "bloccato-REG.bmp".
           call "W$BITMAP" using wbitmap-load, "bloccato-REG.bmp"
                          giving bloccato-REG-bmp.

           copy resource "bloccato-LAV.bmp".
           call "W$BITMAP" using wbitmap-load, "bloccato-LAV.bmp"
                          giving bloccato-LAV-bmp.

           copy resource "bloccato-SP.bmp".
           call "W$BITMAP" using wbitmap-load, "bloccato-SP.bmp"
                          giving bloccato-SP-bmp.

           copy resource "bloccato-ST.bmp".
           call "W$BITMAP" using wbitmap-load, "bloccato-ST.bmp"
                          giving bloccato-ST-bmp.

           copy resource "bloccato-FP.bmp".
           call "W$BITMAP" using wbitmap-load, "bloccato-FP.bmp"
                          giving bloccato-FP-bmp.

           copy resource "bloccato-FT.bmp".
           call "W$BITMAP" using wbitmap-load, "bloccato-FT.bmp"
                          giving bloccato-FT-bmp.

           copy resource "bloccato-CHIUSO.bmp".
           call "W$BITMAP" using wbitmap-load, "bloccato-CHIUSO.bmp"
                          giving bloccato-CHIUSO-bmp.

           copy resource "invio-sol.bmp".
           call "W$BITMAP" using wbitmap-load, "invio-sol.bmp"
                          giving invio-sol-bmp.

           move LK-BL-PROG-ID    TO COMO-PROG-ID 
           .
      * <TOTEM:END>
       TOOL-CERCA-LinkTo.
      * <TOTEM:PARA. TOOL-CERCA-LinkTo>
           inquire tool-cerca, enabled in e-cerca.
           if e-cerca = 1 perform CERCA end-if 
           .
      * <TOTEM:END>
       stdoc-Ev-After-Program.
      * <TOTEM:PARA. stdoc-Ev-After-Program>
           if path-tmp-solleciti-m not = spaces
              close       tmp-sol
              close       tmp-sol1
              close       tmp-sol2
              delete file tmp-sol
           end-if.
           call "W$BITMAP" using wbitmap-destroy, multi-s-bmp.
           call "W$BITMAP" using wbitmap-destroy, bloccato-REG-bmp.
           call "W$BITMAP" using wbitmap-destroy, bloccato-LAV-bmp.
           call "W$BITMAP" using wbitmap-destroy, bloccato-SP-bmp.
           call "W$BITMAP" using wbitmap-destroy, bloccato-ST-bmp.
           call "W$BITMAP" using wbitmap-destroy, bloccato-FP-bmp.
           call "W$BITMAP" using wbitmap-destroy, bloccato-FT-bmp.      
           call "W$BITMAP" using wbitmap-destroy, bloccato-CHIUSO-bmp.
           call "W$BITMAP" using wbitmap-destroy, invio-sol-bmp.
           SET LK-BL-CANCELLAZIONE TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM 
           .
      * <TOTEM:END>
       ef-cli-BeforeProcedure.
      * <TOTEM:PARA. ef-cli-BeforeProcedure>
           move 1 to e-cerca.
           modify tool-cerca, enabled e-cerca.
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-dest-BeforeProcedure.
      * <TOTEM:PARA. ef-dest-BeforeProcedure>
           inquire ef-cli, value in cli-codice.
           if cli-codice = 0
              modify ef-dest,     read-only
           else
              modify ef-dest, not read-only
           end-if.
           move 1 to e-cerca.
           modify tool-cerca, enabled e-cerca.
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       EF-data-FROM-BeforeProcedure.
      * <TOTEM:PARA. EF-data-FROM-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       EF-DATA-TO-BeforeProcedure.
      * <TOTEM:PARA. EF-DATA-TO-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-cli-AfterProcedure.
      * <TOTEM:PARA. ef-cli-AfterProcedure>
           move 0 to e-cerca.
           modify tool-cerca, enabled e-cerca.
           perform CONTROLLO.
           if cli-codice = 0
              move 0 to e-destini
           else
              move 1 to e-destini
           end-if.
           display ef-dest.
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
      *<<** Customized_Defaulta, SP-G, Screen2-Custom1-1 **>>
           .
      * <TOTEM:END>
       ef-dest-AfterProcedure.
      * <TOTEM:PARA. ef-dest-AfterProcedure>
           move 0 to e-cerca.
           modify tool-cerca, enabled e-cerca.
           perform CONTROLLO.
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       EF-data-FROM-AfterProcedure.
      * <TOTEM:PARA. EF-data-FROM-AfterProcedure>
           perform CONTROLLO.
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       PB-ESEGUI-LinkTo.
      * <TOTEM:PARA. PB-ESEGUI-LinkTo>
           set tutto-ok to true.
           perform varying control-id from 78-ID-ef-data-from by 1
                     until control-id > 78-ID-ef-art
              perform CONTROLLO
              if errori
                 exit perform
              end-if
           end-perform.

           if tutto-ok   
              if chk-reg-buf    = 0 and
                 chk-il-buf     = 0 and
                 chk-sp-buf     = 0 and
                 chk-st-buf     = 0 and
                 chk-chiuso-buf = 0
                 set errori to true
                 display message "Selezionare almeno uno stato"
                           title titolo
                            icon 2
              end-if
           end-if.

           if tutto-ok

              set tutti-stati to false
              if chk-reg-buf    = 1 and
                 chk-il-buf     = 1 and
                 chk-sp-buf     = 1 and
                 chk-st-buf     = 1 and
                 chk-chiuso-buf = 1
                 set tutti-stati to true
              end-if

              initialize tab-articoli old-tab-articoli
              move 0 to tot-idx-art idx-art
              if art-codice not = 0
                 move 1 to idx-art
                 move art-codice to el-art(1)
              end-if
              move idx-art to tot-idx-art
              if tot-idx-art = 0
                 set scelta-articoli to false
              else
                 set scelta-articoli to true
              end-if
                            
      *        inquire cbo-stato-f, value in cbo-stato-f-buf
              inquire cbo-promoa,  value in cbo-promo-buf
              modify form1-handle, visible false
              perform CANCELLA-COLORE
              perform SCR-ELAB-OPEN-ROUTINE
              if trovato
                 perform SCR-ORDINI-OPEN-ROUTINE
              else
                 display message "Nessun ordine trovato"
                           title titolo
                            icon 2
                 if path-tmp-solleciti-m not = spaces
                    close       tmp-sol
                    close       tmp-sol1
                    close       tmp-sol2
                    delete file tmp-sol
                    move spaces to path-tmp-solleciti-m
                 end-if
              end-if
              modify form1-handle, visible true
              modify pb-esegui, bitmap-number = 1
              move 78-ID-ef-cli  to control-id
              move 4             to accept-control
           end-if 
           .
      * <TOTEM:END>
       PB-ESEGUI-m-BeforeProcedure.
      * <TOTEM:PARA. PB-ESEGUI-m-BeforeProcedure>
           modify PB-ESEGUI, bitmap-number 2 
           .
      * <TOTEM:END>
       PB-ESEGUI-m-AfterProcedure.
      * <TOTEM:PARA. PB-ESEGUI-m-AfterProcedure>
           modify PB-ESEGUI, bitmap-number 1 
           .
      * <TOTEM:END>
       pb-cancel-BeforeProcedure.
      * <TOTEM:PARA. pb-cancel-BeforeProcedure>
           modify pb-cancel, bitmap-number 2 
           .
      * <TOTEM:END>
       pb-cancel-AfterProcedure.
      * <TOTEM:PARA. pb-cancel-AfterProcedure>
           modify pb-cancel, bitmap-number 1 
           .
      * <TOTEM:END>
       EF-DATA-TO-AfterProcedure.
      * <TOTEM:PARA. EF-DATA-TO-AfterProcedure>
           perform CONTROLLO.
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       chk-reg-BeforeProcedure.
      * <TOTEM:PARA. chk-reg-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       chk-il-BeforeProcedure.
      * <TOTEM:PARA. chk-il-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       chk-sp-BeforeProcedure.
      * <TOTEM:PARA. chk-sp-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       chk-st-BeforeProcedure.
      * <TOTEM:PARA. chk-st-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       chk-chiuso-BeforeProcedure.
      * <TOTEM:PARA. chk-chiuso-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       chk-reg-AfterProcedure.
      * <TOTEM:PARA. chk-reg-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       chk-il-AfterProcedure.
      * <TOTEM:PARA. chk-il-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       chk-sp-AfterProcedure.
      * <TOTEM:PARA. chk-sp-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       chk-st-AfterProcedure.
      * <TOTEM:PARA. chk-st-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       chk-chiuso-AfterProcedure.
      * <TOTEM:PARA. chk-chiuso-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       gd-Ev-Msg-Begin-Entry.
      * <TOTEM:PARA. gd-Ev-Msg-Begin-Entry>
           set  event-action to event-action-fail-terminate.
           move event-data-2 to riga.
           if riga > 1
              inquire gd, entry-reason in como-x
              evaluate como-x
              when X"00"|doppio click
              when X"0D"|invio
                   inquire gd(riga, 1), hidden-data in gd-hidden
                   inquire gd, CURSOR-Y = riga
                   if hid-close
                      set hid-open   to true
                      set ApriRighe  to true
                      modify gd(riga, 1),
                             bitmap        = multi-s-bmp,
                             bitmap-number = 2,
                             bitmap-width  = 16
                      modify gd(riga, 1), hidden-data gd-hidden
                      set ActionGrid to true
                   else
                      if hid-padre
                         set hid-close  to true
                         set ApriRighe  to false
                         modify gd(riga, 1), hidden-data gd-hidden
                         set ActionGrid to true
                      else
                         evaluate event-data-1
                         when  7
                              inquire gd(riga, 3), hidden-data in 
           hid-articolo
                              inquire gd(riga, 7), cell-data in 
           col-stato
                              if hid-articolo not = 0 
                                 |REG può diventare CHIUSO
                                 if col-stato = "REG" or = "CHIUSO"
                                    set RiepilogoOrdini to true
                                 end-if
                              end-if
                         when  8
                         when  9
                              set StampaEvasione to true
                         when 10
                         when 11
                              set StampaBolla to true
                         when 12
                         when 13
                              set StampaFattura to true  
                         when 14
                              inquire gd(riga, 10), hidden-data in 
           FilePod
                              if FilePod not = spaces
                                 set StampaPOD to true
                              else
                                 set hid-close  to true
                                 set ApriRighe  to false
                                 modify gd(riga, 1), hidden-data 
           gd-hidden
                                 set ActionGrid to true
                              end-if
                         when 16 
                              if col-invio >= 0
                                 set InvioSol to true
                              end-if
                         when other
                              set hid-close  to true
                              set ApriRighe  to false
                              modify gd(riga, 1), hidden-data gd-hidden
                              set ActionGrid to true
                         end-evaluate
                      end-if
                   end-if
               end-evaluate
           end-if 
           .
      * <TOTEM:END>
       gd-art2-Ev-Msg-Begin-Drag.
      * <TOTEM:PARA. gd-art2-Ev-Msg-Begin-Drag>
           perform SPOSTAMENTO-ART 
           .
      * <TOTEM:END>
       gd-art2-Ev-Msg-End-Drag.
      * <TOTEM:PARA. gd-art2-Ev-Msg-End-Drag>
           perform SPOSTAMENTO-ART 
           .
      * <TOTEM:END>
       gd-art2-Ev-Msg-Goto-Cell-Drag.
      * <TOTEM:PARA. gd-art2-Ev-Msg-Goto-Cell-Drag>
           perform SPOSTAMENTO-ART 
           .
      * <TOTEM:END>
       gd-art2-Ev-Msg-Goto-Cell.
      * <TOTEM:PARA. gd-art2-Ev-Msg-Goto-Cell>
           perform SPOSTAMENTO-ART 
           .
      * <TOTEM:END>
       gd-art2-Ev-Msg-Goto-Cell-Mouse.
      * <TOTEM:PARA. gd-art2-Ev-Msg-Goto-Cell-Mouse>
           perform SPOSTAMENTO-ART 
           .
      * <TOTEM:END>
       gd-art2-Ev-Msg-Finish-Entry.
      * <TOTEM:PARA. gd-art2-Ev-Msg-Finish-Entry>
           inquire gd-art2(event-data-2, 1), cell-data in art-codice.

           if art-codice = 0
              perform RIEMPI-TAB-ARTICOLI
              perform FILTRA-RECORD
              modify gd-art2, record-to-delete event-data-2
           else
              read articoli no lock 
                   invalid 
                   move spaces to art-descrizione
                   set event-action to event-action-fail
                   display message "Articolo non valido"
                             title tit-err
                              icon 2
               not invalid
                   perform RIEMPI-TAB-ARTICOLI
                   perform FILTRA-RECORD
              end-read
              move art-descrizione to des-art
              modify gd-art2(event-data-2, 2), cell-data des-art
           end-if.

      ***---
       RIEMPI-TAB-ARTICOLI.
           initialize tab-articoli.
           move 0 to tot-idx-art idx-art.
           inquire gd-art2, last-row in tot-righe.
           perform varying riga from 2 by 1 until riga > tot-righe
              inquire gd-art2(riga, 1), cell-data in art-codice
              if art-codice not = 0
                 add 1 to idx-art
                 move art-codice to el-art(idx-art)
              end-if
           end-perform.
           move idx-art to tot-idx-art 
           .
      * <TOTEM:END>
       Screen2-Cm-1-BeforeProcedure.
      * <TOTEM:PARA. Screen2-Cm-1-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       Screen2-Cm-1-AfterProcedure.
      * <TOTEM:PARA. Screen2-Cm-1-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       cbo-num-AfterProcedure.
      * <TOTEM:PARA. cbo-num-AfterProcedure>
      *<<** Customized_Defau lt, SP-G, Screen1-Custom1-1 **>> 
           inquire cbo-num, value in cbo-num-buf.
           move cbo-num-buf to lab-num-buf.
           display lab-num.
           perform FILTRA-RECORD.
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       cbo-clides-AfterProcedure.
      * <TOTEM:PARA. cbo-clides-AfterProcedure>
      *<<** Customized_Defau lt, SP-G, Screen1-Custom1-1 **>>           
           inquire cbo-clides, value in cbo-clides-buf.
           if cbo-clides-buf = 78-tutti
              move spaces         to lab-clides-buf
           else
              move cbo-clides-buf to lab-clides-buf
           end-if.
           display lab-clides.
           perform FILTRA-RECORD.
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       cbo-loca-AfterProcedure.
      * <TOTEM:PARA. cbo-loca-AfterProcedure>
           inquire cbo-loca, value in cbo-loca-buf.
           if cbo-loca-buf = 78-tutti
              move spaces       to lab-loca-buf
           else
              move cbo-loca-buf to lab-loca-buf
           end-if
           display lab-loca.
           perform FILTRA-RECORD.
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       cbo-numord-AfterProcedure.
      * <TOTEM:PARA. cbo-numord-AfterProcedure>
           inquire cbo-numord, value in cbo-numord-buf.
           if cbo-numord-buf = 78-tutti
              move spaces         to lab-numord-buf
           else
              move cbo-numord-buf to lab-numord-buf
           end-if.
           display lab-numord.
           perform FILTRA-RECORD.
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       cbo-data-AfterProcedure.
      * <TOTEM:PARA. cbo-data-AfterProcedure>
           inquire cbo-data, value in cbo-data-buf.
           if cbo-data-buf = 78-tutti
              move spaces       to lab-data-buf
           else
              move cbo-data-buf to lab-data-buf
           end-if.
           display lab-data.
           perform FILTRA-RECORD.
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       cbo-stato-AfterProcedure.
      * <TOTEM:PARA. cbo-stato-AfterProcedure>
           inquire cbo-stato, value in cbo-stato-buf.
           if cbo-stato-buf = 78-tutti
              move spaces        to lab-stato-buf
           else
              move cbo-stato-buf to lab-stato-buf
           end-if.
           display lab-stato.
           perform FILTRA-RECORD.
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       cbo-data-f-AfterProcedure.
      * <TOTEM:PARA. cbo-data-f-AfterProcedure>
           inquire cbo-data-f, value in cbo-data-f-buf.
           if cbo-data-f-buf = 78-tutti
              move spaces         to lab-data-f-buf
           else
              move cbo-data-f-buf to lab-data-f-buf
           end-if..
           display lab-data-f.
           perform FILTRA-RECORD.
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       cbo-num-f-AfterProcedure.
      * <TOTEM:PARA. cbo-num-f-AfterProcedure>
           inquire cbo-num-f, value in cbo-num-f-buf.
           move cbo-num-f-buf to lab-num-f-buf.
           display lab-num-f.
           perform FILTRA-RECORD.
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       cbo-data-b-AfterProcedure.
      * <TOTEM:PARA. cbo-data-b-AfterProcedure>
           inquire cbo-data-b, value in cbo-data-b-buf.
           if cbo-data-b-buf = 78-tutti
              move spaces         to lab-data-b-buf
           else
              move cbo-data-b-buf to lab-data-b-buf
           end-if.
           display lab-data-b.
           perform FILTRA-RECORD.
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       cbo-num-b-AfterProcedure.
      * <TOTEM:PARA. cbo-num-b-AfterProcedure>
           inquire cbo-num-b, value in cbo-num-b-buf.
           move cbo-num-b-buf to lab-num-b-buf.
           display lab-num-b.
           perform FILTRA-RECORD.
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       cbo-data-e-AfterProcedure.
      * <TOTEM:PARA. cbo-data-e-AfterProcedure>
           inquire cbo-data-e, value in cbo-data-e-buf.
           if cbo-data-e-buf = 78-tutti
              move spaces         to lab-data-e-buf
           else
              move cbo-data-e-buf to lab-data-e-buf
           end-if.
           display lab-data-e.
           perform FILTRA-RECORD.
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       cbo-num-e-AfterProcedure.
      * <TOTEM:PARA. cbo-num-e-AfterProcedure>
           inquire cbo-num-e, value in cbo-num-e-buf.
           move cbo-num-e-buf to lab-num-e-buf.
           display lab-num-e.
           perform FILTRA-RECORD.
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       cbo-stato-Ex-Ntf-Selchange.
      * <TOTEM:PARA. cbo-stato-Ex-Ntf-Selchange>
           inquire cbo-stato, value in cbo-stato-buf.
           if cbo-stato-buf = 78-tutti
              move spaces        to lab-stato-buf
           else
              move cbo-stato-buf to lab-stato-buf
           end-if.
           display lab-stato.
           perform FILTRA-RECORD 
           .
      * <TOTEM:END>
       cbo-loca-Ex-Ntf-Selchange.
      * <TOTEM:PARA. cbo-loca-Ex-Ntf-Selchange>
           inquire cbo-loca, value in cbo-loca-buf.
           if cbo-loca-buf = 78-tutti
              move spaces       to lab-loca-buf
           else
              move cbo-loca-buf to lab-loca-buf
           end-if.
           display lab-loca.
           perform FILTRA-RECORD 
           .
      * <TOTEM:END>
       cbo-clides-Ex-Ntf-Selchange.
      * <TOTEM:PARA. cbo-clides-Ex-Ntf-Selchange>
           inquire cbo-clides, value in cbo-clides-buf.
           if cbo-clides-buf = 78-tutti
              move spaces         to lab-clides-buf
           else
              move cbo-clides-buf to lab-clides-buf
           end-if.
           display lab-clides.
           perform FILTRA-RECORD 
           .
      * <TOTEM:END>
       cbo-num-Ex-Ntf-Selchange.
      * <TOTEM:PARA. cbo-num-Ex-Ntf-Selchange>
           inquire cbo-num, value in cbo-num-buf.
           move cbo-num-buf to lab-num-buf.
           display lab-num.
           perform FILTRA-RECORD 
           .
      * <TOTEM:END>
       cbo-numord-Ex-Ntf-Selchange.
      * <TOTEM:PARA. cbo-numord-Ex-Ntf-Selchange>
           inquire cbo-numord, value in cbo-numord-buf. 
           if cbo-numord-buf = 78-tutti
              move spaces         to lab-numord-buf
           else
              move cbo-numord-buf to lab-numord-buf
           end-if.
           display lab-numord.
           perform FILTRA-RECORD 
           .
      * <TOTEM:END>
       cbo-data-Ex-Ntf-Selchange.
      * <TOTEM:PARA. cbo-data-Ex-Ntf-Selchange>
           inquire cbo-data, value in cbo-data-buf.
           if cbo-data-buf = 78-tutti
              move spaces       to lab-data-buf
           else
              move cbo-data-buf to lab-data-buf
           end-if.
           display lab-data.
           perform FILTRA-RECORD 
           .
      * <TOTEM:END>
       cbo-num-e-Ex-Ntf-Selchange.
      * <TOTEM:PARA. cbo-num-e-Ex-Ntf-Selchange>
           inquire cbo-num-e, value in cbo-num-e-buf.
           move cbo-num-e-buf to lab-num-e-buf.
           display lab-num-e.
           perform FILTRA-RECORD 
           .
      * <TOTEM:END>
       cbo-data-e-Ex-Ntf-Selchange.
      * <TOTEM:PARA. cbo-data-e-Ex-Ntf-Selchange>
           inquire cbo-data-e, value in cbo-data-e-buf.
           if cbo-data-e-buf = 78-tutti
              move spaces         to lab-data-e-buf
           else
              move cbo-data-e-buf to lab-data-e-buf
           end-if.
           display lab-data-e.
           perform FILTRA-RECORD 
           .
      * <TOTEM:END>
       cbo-data-f-Ex-Ntf-Selchange.
      * <TOTEM:PARA. cbo-data-f-Ex-Ntf-Selchange>
           inquire cbo-data-f, value in cbo-data-f-buf.
           if cbo-data-f-buf = 78-tutti
              move spaces         to lab-data-f-buf
           else
              move cbo-data-f-buf to lab-data-f-buf
           end-if.
           display lab-data-f.
           perform FILTRA-RECORD 
           .
      * <TOTEM:END>
       cbo-num-f-Ex-Ntf-Selchange.
      * <TOTEM:PARA. cbo-num-f-Ex-Ntf-Selchange>
           inquire cbo-num-f, value in cbo-num-f-buf.
           move cbo-num-f-buf to lab-num-f-buf.
           display lab-num-f.
           perform FILTRA-RECORD 
           .
      * <TOTEM:END>
       cbo-data-b-Ex-Ntf-Selchange.
      * <TOTEM:PARA. cbo-data-b-Ex-Ntf-Selchange>
           inquire cbo-data-b, value in cbo-data-b-buf.
           if cbo-data-b-buf = 78-tutti
              move spaces         to lab-data-b-buf
           else
              move cbo-data-b-buf to lab-data-b-buf
           end-if.
           display lab-data-b.
           perform FILTRA-RECORD 
           .
      * <TOTEM:END>
       cbo-num-b-Ex-Ntf-Selchange.
      * <TOTEM:PARA. cbo-num-b-Ex-Ntf-Selchange>
           inquire cbo-num-b, value in cbo-num-b-buf.
           move cbo-num-b-buf to lab-num-b-buf.
           display lab-num-b.
           perform FILTRA-RECORD 
           .
      * <TOTEM:END>
       cbo-promo-Ex-Ntf-Selchange.
      * <TOTEM:PARA. cbo-promo-Ex-Ntf-Selchange>
           inquire cbo-promo, value in cbo-promo-buf.
           perform FILTRA-RECORD 
           
           .
      * <TOTEM:END>
       gd-art2-Ev-Msg-Begin-Entry.
      * <TOTEM:PARA. gd-art2-Ev-Msg-Begin-Entry>
           if scelta-articoli
              set event-action to event-action-fail
           end-if 
           .
      * <TOTEM:END>
       chk-reg-LinkTo.
      * <TOTEM:PARA. chk-reg-LinkTo>
           set CheckPressed to true.
           perform FILTRA-RECORD 
           .
      * <TOTEM:END>
       chk-il-LinkTo.
      * <TOTEM:PARA. chk-il-LinkTo>
           set CheckPressed to true.
           perform FILTRA-RECORD 
           .
      * <TOTEM:END>
       chk-sp-LinkTo.
      * <TOTEM:PARA. chk-sp-LinkTo>
           set CheckPressed to true.
           perform FILTRA-RECORD 
           .
      * <TOTEM:END>
       chk-st-LinkTo.
      * <TOTEM:PARA. chk-st-LinkTo>
           set CheckPressed to true.
           perform FILTRA-RECORD 
           .
      * <TOTEM:END>
       chk-chiuso-LinkTo.
      * <TOTEM:PARA. chk-chiuso-LinkTo>
           set CheckPressed to true.
           perform FILTRA-RECORD 
           .
      * <TOTEM:END>
       cbo-promoa-BeforeProcedure.
      * <TOTEM:PARA. cbo-promoa-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       cbo-promoa-AfterProcedure.
      * <TOTEM:PARA. cbo-promoa-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       TOOL-STAMPA-LinkTo.
      * <TOTEM:PARA. TOOL-STAMPA-LinkTo>
           move 0 to stsolleciti-excel.
           perform SCR-EXCEL-OPEN-ROUTINE   
           .
      * <TOTEM:END>
       chk-reg-ini-BeforeProcedure.
      * <TOTEM:PARA. chk-reg-ini-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       chk-il-ini-BeforeProcedure.
      * <TOTEM:PARA. chk-il-ini-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       chk-sp-ini-BeforeProcedure.
      * <TOTEM:PARA. chk-sp-ini-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       chk-st-ini-BeforeProcedure.
      * <TOTEM:PARA. chk-st-ini-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       chk-chiuso-ini-BeforeProcedure.
      * <TOTEM:PARA. chk-chiuso-ini-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       chk-reg-ini-AfterProcedure.
      * <TOTEM:PARA. chk-reg-ini-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       chk-il-ini-AfterProcedure.
      * <TOTEM:PARA. chk-il-ini-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       chk-sp-ini-AfterProcedure.
      * <TOTEM:PARA. chk-sp-ini-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       chk-st-ini-AfterProcedure.
      * <TOTEM:PARA. chk-st-ini-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       chk-chiuso-ini-AfterProcedure.
      * <TOTEM:PARA. chk-chiuso-ini-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       pb-excel-LinkTo.
      * <TOTEM:PARA. pb-excel-LinkTo>
           display message "Esportare in Excel?"
                     title titolo
                      icon 2
                      type mb-yes-no
                   default mb-no
                    giving scelta
           if scelta = mb-yes               
              move 1 to stsolleciti-excel
              perform SCR-EXCEL-OPEN-ROUTINE
           end-if 
           .
      * <TOTEM:END>

      *{TOTEM}END

      *{TOTEM}SHOW-MSG
       MESSAGE-FOR-FILEERROR.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
              MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           .

       SHOW-TRANSACTION-ROUTINE.
           IF TOTEM-TRANSACTION-FLAG = SPACES
              IF TRANSACTION-STATUS NOT = 0
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-1
              END-IF
           ELSE
              PERFORM SHOW-MSG-ROUTINE
              IF TRANSACTION-STATUS = 0
                 MOVE "Transazione terminata con Rollback." TO 
           TOTEM-MSG-3
              ELSE
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-3
              END-IF
           END-IF
           .

       SHOW-MSG-ROUTINE.
           MOVE SPACE TO TOTEM-MSG-1 TOTEM-MSG-2 TOTEM-MSG-3
           EVALUATE TOTEM-MSG-ID
               WHEN "10"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Nessun altro dato." TO TOTEM-MSG-2
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "22"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Chiave Duplicata." TO TOTEM-MSG-2
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "23"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Raggiunta fine file." TO TOTEM-MSG-2
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "101"
                    MOVE "Terminare l'applicazione?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "201"
                    MOVE "Aggiungere un nuovo record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "202"
                    MOVE "Aggiornare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "203"
                    MOVE "Cancellare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "204"
                    MOVE "Chiave duplicata." TO TOTEM-MSG-1
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "301"
                    MOVE "Inserimento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "302"
                    MOVE "Aggiornamento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "303"
                    MOVE "Cancellazione avvenuta con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "401"
                    MOVE "Shell non trovata." TO TOTEM-MSG-1
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN OTHER
                    MOVE TEXT-MESSAGE TO TOTEM-MSG-1
                    STRING "FILE:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-3
                    MOVE 0 TO TOTEM-IDX1
                    INSPECT TOTEM-MSG-3 TALLYING TOTEM-IDX1
                       FOR TRAILING SPACE
                    STRING TOTEM-MSG-3(1:TOTEM-MSG-LENGTH - 
           TOTEM-IDX1), 
                       ", FILE STATUS ", PRIMARY-ERROR "," 
                       SECONDARY-ERROR
                    DELIMITED BY SIZE INTO TOTEM-MSG-2
                    MOVE SPACES TO TOTEM-MSG-3
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
           END-EVALUATE
           PERFORM MESSAGE-BOX-ROUTINE
           .

       MESSAGE-BOX-ROUTINE.
           MOVE 1 TO TOTEM-MSG-TEXT-POINTER
           IF TOTEM-MSG-1 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-1 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              STRING TOTEM-MSG-1( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                 DELIMITED BY SIZE
                 INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-2 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-2 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-2( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-3 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-3 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-3( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-TEXT-POINTER = 1
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-TEXT TALLYING TOTEM-MSG-SIZE FOR 
           TRAILING SPACE
                  COMPUTE TOTEM-MSG-TEXT-POINTER = 
           TOTEM-MSG-FULL-LENGTH - TOTEM-MSG-SIZE + 1
           END-IF
           MOVE LOW-VALUES TO TOTEM-MSG-TEXT(TOTEM-MSG-TEXT-POINTER : 1 
           )
           .

       MESSAGE-BOX-DISPLAY.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

      *{TOTEM}END

