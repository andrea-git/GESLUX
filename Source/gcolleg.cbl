      *{TOTEM}PRG-COMMENT
      * gcolleg.Cbl
      * gcolleg.Cbl is generated by TOTEM
      * This is a generated file. DO NOT modify this file directly.
      *{TOTEM}END
       IDENTIFICATION       DIVISION.
      *{TOTEM}PRGID
       PROGRAM-ID.          gcolleg.
       AUTHOR.              ANDREA EVENTI.
       DATE-WRITTEN.        lunedì 2 dicembre 2013 18:07:41.
       REMARKS.
      *{TOTEM}END

       ENVIRONMENT          DIVISION.
       CONFIGURATION        SECTION.
       SPECIAL-NAMES.
      *{TOTEM}SPECIAL-NAME
      * <TOTEM:EPT. INIT:gcolleg, INIT:gcolleg, SpecialName>
      * <TOTEM:END>
      *{TOTEM}END
      *{TOTEM}ACTIVEX-DEF
      *{TOTEM}END
      *{TOTEM}DECIMAL-POINT
           DECIMAL-POINT IS COMMA.
      *{TOTEM}END

       INPUT-OUTPUT         SECTION.
       FILE-CONTROL.
      *{TOTEM}FILE-CONTROL
           COPY "contestazioni.sl".
           COPY "note-cont.sl".
           COPY "zoom-tordini.sl".
           COPY "tnotacr.sl".
           COPY "clienti.sl".
           COPY "destini.sl".
      *{TOTEM}END
       DATA                 DIVISION.
       FILE                 SECTION.
      *{TOTEM}FILE
           COPY "contestazioni.fd".
           COPY "note-cont.fd".
           COPY "zoom-tordini.fd".
           COPY "tnotacr.fd".
           COPY "clienti.fd".
           COPY "destini.fd".
      *{TOTEM}END

       WORKING-STORAGE      SECTION.
      *{TOTEM}ACU-DEF
               COPY "acugui.def".
               COPY "acucobol.def".
               COPY "fonts.def".
               COPY "crtvars.def".
               COPY "showmsg.def".
               COPY "totem.def".
               COPY "comune.def".
               COPY "utydata.def".
               COPY "custom.def".
      *{TOTEM}END

      *{TOTEM}COPY-WORKING
      * Key Status
       77 Key-Status IS SPECIAL-NAMES CRT STATUS PIC 9(5) VALUE 0.
          88 Enter-Pushed VALUE 13.
          88 Exit-Pushed VALUE 27.
          88 Message-Received VALUE 95.
          88 Event-Occurred VALUE 96.
          88 Screen-No-Input-Field VALUE 97.
      * Properties & User defined Working Stoarge
           COPY  "LINK-GESLOCK.DEF".
           COPY  "EXTERNALS.DEF".
      *
      *
       77 TIPO-DATA        PIC  9(8)
                  VALUE IS 0.
       01 FILLER           PIC  9.
           88 FromCerca VALUE IS 1    WHEN SET TO FALSE  0. 
       77 Form1-Handle
                  USAGE IS HANDLE OF WINDOW.
       78 78-TotIdx VALUE IS 5. 
       01 Hid-Da-aggiungere            PIC  9.
           88 Hid-aggiungi VALUE IS 1    WHEN SET TO FALSE  0. 
       77 Form1-Tb-1-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 posti-liberi     PIC  9.
       77 old-anno         PIC  9(4).
       77 old-numero       PIC  9(8).
       78 titolo VALUE IS "Geslux - Gestione collegamento contestazioni 
      -    "a nota credito". 
       77 E-ESCI           PIC  9
                  VALUE IS 1.
       77 E-NUOVO          PIC  9
                  VALUE IS 0.
       77 E-CANCELLA       PIC  9
                  VALUE IS 1.
       77 E-SALVA          PIC  9
                  VALUE IS 1.
       77 E-ANTEPRIMA      PIC  9
                  VALUE IS 0.
       77 E-MODIFICA       PIC  9
                  VALUE IS 0.
       77 E-STAMPA         PIC  9
                  VALUE IS 0.
       77 E-CERCA          PIC  9
                  VALUE IS 1.
       77 Small-Font
                  USAGE IS HANDLE OF FONT SMALL-FONT.
       77 toolbar-bmp      PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 livello-abil     PIC  9
                  USAGE IS COMP-4
                  VALUE IS 0.
       01 rec-grid.
           05 col-anno         PIC  z(4).
           05 col-numero       PIC  z(8).
           05 col-data         PIC  zz/zz/zzzz.
           05 col-cliente      PIC  x(40).
           05 col-localita     PIC  x(40).
           05 col-num-fatt     PIC  z(8).
           05 col-data-fatt    PIC  zz/zz/zzzz.
           05 col-num-nota     PIC  z(8).
           05 col-data-nota    PIC  zz/zz/zzzz.
           05 col-nota-1       PIC  x(15).
           05 col-nota-2       PIC  x(15).
           05 col-nota-3       PIC  x(15).
           05 col-nota-4       PIC  x(15).
           05 col-nota-5       PIC  x(15).
       77 Screen1-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 como-anno        PIC  9(4).
       77 como-numero      PIC  9(8).
       77 check-anno       PIC  9(4).
       77 check-numero     PIC  9(8).
       77 nota-x           PIC  x(8).
       77 esegui_73x21-bmp PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 Default-Font
                  USAGE IS HANDLE OF FONT DEFAULT-FONT.
       77 Verdana12B-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 STATUS-note-cont PIC  X(2).
           88 Valid-STATUS-note-cont VALUE IS "00" THRU "09". 
       77 STATUS-contestazioni         PIC  X(2).
           88 Valid-STATUS-contestazioni VALUE IS "00" THRU "09". 
       77 STATUS-clienti   PIC  X(2).
           88 Valid-STATUS-clienti VALUE IS "00" THRU "09". 
       77 STATUS-destini   PIC  X(2).
           88 Valid-STATUS-destini VALUE IS "00" THRU "09". 
       77 numero-edit      PIC  z(8).
       01 OLD-noco-rec.
           05 OLD-noco-chiave.
               10 OLD-noco-anno    PIC  9(4).
               10 OLD-noco-numero  PIC  9(8).
           05 OLD-noco-dati.
               10 OLD-noco-contestazioni.
                   15 OLD-noco-contestazioni-el
                              OCCURS 5 TIMES.
                       20 OLD-noco-anno-cont           PIC  9(4).
                       20 OLD-noco-numero-cont         PIC  9(8).
           05 OLD-noco-dati-comuni.
               15 OLD-noco-data-creazione      PIC  9(8).
               15 OLD-noco-ora-creazione       PIC  9(8).
               15 OLD-noco-utente-creazione    PIC  X(10).
               15 OLD-noco-data-modifica       PIC  9(8).
               15 OLD-noco-ora-modifica        PIC  9(8).
               15 OLD-noco-utente-modifica     PIC  X(10).
               10 OLD-noco-vuoti.
                   15 OLD-noco-num-vuoto-1         PIC  9(15).
                   15 OLD-noco-num-vuoto-2         PIC  9(15).
                   15 OLD-noco-num-vuoto-3         PIC  9(15).
                   15 OLD-noco-alfa-vuoto-1        PIC  X(20).
                   15 OLD-noco-alfa-vuoto-2        PIC  X(20).
                   15 OLD-noco-alfa-vuoto-3        PIC  X(20).
       77 STATUS-tnotacr   PIC  X(2).
           88 Valid-STATUS-tnotacr VALUE IS "00" THRU "09". 
       77 path-zoom-tordini            PIC  X(256).
       77 STATUS-zoom-tordini          PIC  X(2).
           88 Valid-STATUS-zoom-tordini VALUE IS "00" THRU "09". 

      ***********************************************************
      *   Code Gen's Buffer                                     *
      ***********************************************************
       77 STATUS-Form1-FLAG-REFRESH PIC  9.
          88 Form1-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 TMP-Form1-KEY1-ORDER  PIC X VALUE "A".
       77 TMP-Form1-note-cont-RESTOREBUF  PIC X(229).
       77 TMP-Form1-KEYIS  PIC 9(3) VALUE 1.
       77 Form1-MULKEY-TMPBUF   PIC X(229).
       77 TMP-DataSet1-contestazioni-BUF     PIC X(872).
       77 TMP-DataSet1-note-cont-BUF     PIC X(229).
       77 TMP-DataSet1-zoom-tordini-BUF     PIC X(141).
       77 TMP-DataSet1-tnotacr-BUF     PIC X(752).
       77 TMP-DataSet1-clienti-BUF     PIC X(1356).
       77 TMP-DataSet1-destini-BUF     PIC X(431).
      * VARIABLES FOR RECORD LENGTH.
       77  TotemFdSlRecordClearOffset   PIC 9(5) COMP-4.
       77  TotemFdSlRecordLength        PIC 9(5) COMP-4.
      * FILE'S LOCK MODE FLAG
       77 DataSet1-contestazioni-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-contestazioni-LOCK  VALUE "Y".
       77 DataSet1-contestazioni-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-contestazioni-KEY-Asc  VALUE "A".
          88 DataSet1-contestazioni-KEY-Desc VALUE "D".
       77 DataSet1-note-cont-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-note-cont-LOCK  VALUE "Y".
       77 DataSet1-KEYIS   PIC 9(3) VALUE 1.
       77 DataSet1-note-cont-KEY1-ORDER  PIC X VALUE "A".
          88 DataSet1-note-cont-KEY1-Asc  VALUE "A".
          88 DataSet1-note-cont-KEY1-Desc VALUE "D".
       77 DataSet1-zoom-tordini-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-zoom-tordini-LOCK  VALUE "Y".
       77 DataSet1-zoom-tordini-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-zoom-tordini-KEY-Asc  VALUE "A".
          88 DataSet1-zoom-tordini-KEY-Desc VALUE "D".
       77 DataSet1-tnotacr-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tnotacr-LOCK  VALUE "Y".
       77 DataSet1-tnotacr-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tnotacr-KEY-Asc  VALUE "A".
          88 DataSet1-tnotacr-KEY-Desc VALUE "D".
       77 DataSet1-clienti-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-clienti-LOCK  VALUE "Y".
       77 DataSet1-clienti-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-clienti-KEY-Asc  VALUE "A".
          88 DataSet1-clienti-KEY-Desc VALUE "D".
       77 DataSet1-destini-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-destini-LOCK  VALUE "Y".
       77 DataSet1-destini-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-destini-KEY-Asc  VALUE "A".
          88 DataSet1-destini-KEY-Desc VALUE "D".

       77 contestazioni-k1-SPLITBUF  PIC X(24).
       77 contestazioni-k-fattura-SPLITBUF  PIC X(13).
       77 contestazioni-k-nota-SPLITBUF  PIC X(13).
       77 zoom-tordini-zoom-tor-key01-SPLITBUF  PIC X(13).
       77 zoom-tordini-k-clidest-SPLITBUF  PIC X(11).
       77 tnotacr-k-causale-SPLITBUF  PIC X(17).
       77 tnotacr-k1-SPLITBUF  PIC X(23).
       77 tnotacr-k2-SPLITBUF  PIC X(21).
       77 tnotacr-k-fattura-SPLITBUF  PIC X(13).
       77 tnotacr-k4-SPLITBUF  PIC X(30).
       77 tnotacr-k-contab-SPLITBUF  PIC X(14).
       77 tnotacr-k-data-SPLITBUF  PIC X(17).
       77 tnotacr-k-agfatt-SPLITBUF  PIC X(42).
       77 tnotacr-k-andamento-data-SPLITBUF  PIC X(10).
       77 tnotacr-k-andamento-cliente-SPLITBUF  PIC X(15).
       77 tnotacr-k-andamento-clides-SPLITBUF  PIC X(20).
       77 clienti-cli-K1-SPLITBUF  PIC X(47).
       77 clienti-cli-K3-SPLITBUF  PIC X(12).
       77 clienti-cli-K4-SPLITBUF  PIC X(8).
       77 destini-K1-SPLITBUF  PIC X(51).
       77 destini-k-localita-SPLITBUF  PIC X(36).
      * FOR SPLIT KEY BUFFER
       77 DataSet1-zoom-tordini-SPLIT-BUF1   PIC X(13).


      *{TOTEM}END

      *{TOTEM}ID-LOGICI
      ***** Elenco ID Logici *****
      ***** Fine ID Logici *****
      *{TOTEM}END

       LINKAGE          SECTION.
      *{TOTEM}LINKAGE
           COPY  "LINK-GCOLLEG.DEF".

      *{TOTEM}END

       SCREEN           SECTION.
      *{TOTEM}COPY-SCREEN
      * FORM
       01 
           Form1, 
           .

      * GRID
       05
           form1-gd-1, 
           Grid, 
           COL 3,00, 
           LINE 5,62,
           LINES 10,69 ,
           SIZE 160,33 ,
           ADJUSTABLE-COLUMNS,
           BOXED,
           DATA-COLUMNS (1, 5, 13, 23, 63, 103, 111, 121, 129, 139, 
           154, 169, 184, 199),
           ALIGNMENT ("R", "R", "C", "U", "U", "U", "C", "U", "C", "C", 
           "C", "C", "C", "C"),
           SEPARATION (5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5),
           DATA-TYPES ("9(4)", "9(8)", "X", "X", "X", "X", "X", "X", "X"
           , "X", "X", "X", "X", "X"),
           NUM-COL-HEADINGS 1,
           COLUMN-HEADINGS,
           CURSOR-FRAME-WIDTH 2,
           DIVIDER-COLOR 1,
           HEADING-COLOR 257,
           HEADING-DIVIDER-COLOR 1,
           HSCROLL,
           ID IS 1,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           NUM-ROWS 6,
           RECORD-DATA rec-grid,
           TILED-HEADINGS,
           USE-TAB,
           VIRTUAL-WIDTH 208,
           VPADDING 50,
           EVENT PROCEDURE Form1-Gd-1-Event-Proc,
           .

      * BAR
       05
           Form1-Br-1, 
           Bar,
           COL 3,00, 
           LINE 4,31,
           SIZE 160,33 ,
           ID IS 3,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           COLORS (8, 8),
           SHADING (-1, 1),
           WIDTH 2,
           .

      * BAR
       05
           Form1-Br-1a, 
           Bar,
           COL 3,00, 
           LINE 4,85,
           SIZE 160,33 ,
           ID IS 4,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           COLORS (8, 8),
           SHADING (-1, 1),
           WIDTH 2,
           .

      * LABEL
       05
           Form1-La-1, 
           Label, 
           COL 3,00, 
           LINE 1,92,
           LINES 1,69 ,
           SIZE 8,00 ,
           COLOR IS 2,
           FONT IS Verdana12B-Occidentale,
           ID IS 5,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Anno",
           .

      * LABEL
       05
           Form1-La-1a, 
           Label, 
           COL 25,17, 
           LINE 1,92,
           LINES 1,69 ,
           SIZE 12,00 ,
           COLOR IS 2,
           FONT IS Verdana12B-Occidentale,
           ID IS 6,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Numero",
           .

      * LABEL
       05
           lab-anno, 
           Label, 
           COL 13,50, 
           LINE 1,92,
           LINES 1,69 ,
           SIZE 8,00 ,
           COLOR IS 2,
           FONT IS Verdana12B-Occidentale,
           ID IS 7,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           TRANSPARENT,
           TITLE LinkAnnoColleg,
           .

      * LABEL
       05
           lab-numero, 
           Label, 
           COL 38,50, 
           LINE 1,92,
           LINES 1,69 ,
           SIZE 12,00 ,
           COLOR IS 2,
           FONT IS Verdana12B-Occidentale,
           ID IS 8,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           TRANSPARENT,
           TITLE numero-edit,
           .

      * TOOLBAR
       01
           Form1-Tb-1,
           .    

      * PUSH BUTTON
       05
           TOOL-ESCI, 
           Push-Button, 
           COL 1,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           ENABLED E-ESCI,
           EXCEPTION-VALUE 27,
           FLAT,
           ID IS 2,
           SELF-ACT,
           ESCAPE-BUTTON,
           TITLE "&Esci",
           .

      * PUSH BUTTON
       05
           TOOL-NUOVO, 
           Push-Button, 
           COL 6,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 23,
           UNFRAMED,
           SQUARE,
           ENABLED 0,
           FLAT,
           ID IS 9,
           SELF-ACT,
           TITLE "Nuovo (F2)",
           .

      * PUSH BUTTON
       05
           TOOL-CANCELLA, 
           Push-Button, 
           COL 16,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           UNFRAMED,
           SQUARE,
           ENABLED E-CANCELLA,
           EXCEPTION-VALUE 4,
           FLAT,
           ID IS 10,
           SELF-ACT,
           TITLE "Cancella (F4)",
           BITMAP-NUMBER BitmapNumDelete
           .

      * PUSH BUTTON
       05
           TOOL-SALVA, 
           Push-Button, 
           COL 11,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           UNFRAMED,
           SQUARE,
           ENABLED E-SALVA,
           EXCEPTION-VALUE 3,
           FLAT,
           ID IS 11,
           SELF-ACT,
           TITLE "Salva (F3)",
           BITMAP-NUMBER BitmapNumSave
           .

      * PUSH BUTTON
       05
           TOOL-ANTEPRIMA, 
           Push-Button, 
           COL 26,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           UNFRAMED,
           SQUARE,
           ENABLED E-ANTEPRIMA,
           EXCEPTION-VALUE 6,
           FLAT,
           ID IS 12,
           SELF-ACT,
           TITLE "Anteprima (F6)",
           BITMAP-NUMBER BitmapNumPreview
           .

      * CHECK BOX
       05
           TOOL-MODIFICA, 
           Check-Box, 
           COL 21,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 22,
           UNFRAMED,
           SQUARE,
           ENABLED 0,
           FLAT,
           ID IS 13,
           SELF-ACT,
           TITLE "Modifica (F5)",
           VALUE MOD,
           AFTER PROCEDURE TOOL-MODIFICA-AfterProcedure,
           BEFORE PROCEDURE TOOL-MODIFICA-BeforeProcedure, 
           .
      * PUSH BUTTON
       05
           TOOL-STAMPA, 
           Push-Button, 
           COL 31,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           UNFRAMED,
           SQUARE,
           ENABLED E-STAMPA,
           EXCEPTION-VALUE 7,
           FLAT,
           ID IS 14,
           SELF-ACT,
           TITLE "Stampa (F7)",
           BITMAP-NUMBER BitmapNumPrint
           .

      * PUSH BUTTON
       05
           TOOL-CERCA, 
           Push-Button, 
           COL 36,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           UNFRAMED,
           SQUARE,
           ENABLED E-CERCA,
           EXCEPTION-VALUE 8,
           FLAT,
           ID IS 15,
           SELF-ACT,
           TITLE "Cerca (F8)",
           BITMAP-NUMBER BitmapNumZoom
           .

      *{TOTEM}END

      *{TOTEM}LINKPARA
       PROCEDURE  DIVISION USING gcolleg-linkage.
      *{TOTEM}END

      *{TOTEM}DECLARATIVE
       DECLARATIVES.
      * <TOTEM:EPT. INIT:gcolleg, INIT:gcolleg, BeforeDeclarative>
       NOTE-CONT-ERR SECTION.
           use after error procedure on note-cont.
           evaluate status-note-cont
           when "35"
                display message "File [NOTE-CONT] not found!"
                          title titolo
                           icon 3
                set errori to true
           when "39"
                display message "File [NOTE-CONT] Mismatch size!"
                          title titolo
                           icon 3
                set errori to true
           when "98"
                display message "[NOTE-CONT] Indexed file corrupt!"
                          title titolo
                           icon 3
                set errori to true
           when "93"
                move 0 to mod
                modify tool-modifica, value = mod  
                set StatusVisua to true
                open input note-cont
                display message MSG-Gia-in-uso-su-altro-terminale
                        x"0d0a" MSG-SOLA-VISUA
                          title tit-err
                           icon 2
           when "99"
                set RecLocked    to true

                move MSG-Record-gia-in-uso to geslock-messaggio
                move "NOTE-CONT" to geslock-nome-file
                move 1 to geslock-v-riprova
                move 0 to geslock-v-ignora
                move 1 to geslock-v-termina
           end-evaluate.

      ***---
       CONTESTAZIONI-ERR SECTION.
           use after error procedure on contestazioni.
           evaluate status-contestazioni
           when "35"
                display message "File [CONTESTAZIONI] not found!"
                          title titolo
                           icon 3
                set errori to true
           when "39"
                display message "File [CONTESTAZIONI] Mismatch size!"
                          title titolo
                           icon 3
                set errori to true
           when "98"
                display message "[CONTESTAZIONI] Indexed file corrupt!"
                          title titolo
                           icon 3
                set errori to true
           when "99"
                set RecLocked   to true
                move cnt-numero to numero-edit
                initialize geslock-messaggio
                string "Sbloccare la contestazione " delimited size
                       cnt-numero                    delimited size
                       "!!!"                         delimited size
                       into geslock-messaggio
                end-string
                move "CONTESTAZIONI" to geslock-nome-file
                move 1 to geslock-v-riprova
                move 1 to geslock-v-ignora
                move 0 to geslock-v-termina
           end-evaluate.

      * <TOTEM:END>
       INPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON INPUT.
       0100-DECL.
           EXIT.
       I-O-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON I-O.
       0200-DECL.
           EXIT.
       OUTPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON OUTPUT.
       0300-DECL.
           EXIT.
       TRANSACTION-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON TRANSACTION.
       0400-DECL.
           EXIT.
       END DECLARATIVES.
      *{TOTEM}END

       MAIN-LOGIC.
      *{TOTEM}ENTRY-BEFPRG
      *    Before-Program
      *    Before Program
      *{TOTEM}END
           PERFORM INITIALIZE-ROUTINE.
      * run main screen
      *{TOTEM}RUN-MAINSCR
           PERFORM Form1-OPEN-ROUTINE.
      *{TOTEM}END

      *{TOTEM}COPY-PROCEDURE
       EXIT-STOP-ROUTINE.
           PERFORM CLOSE-FILE-RTN
      * <TOTEM:EPT. INIT:gcolleg, INIT:gcolleg, BeforeDestroyResource>
      * <TOTEM:END>
           DESTROY Verdana12B-Occidentale
           CALL "w$bitmap" USING WBITMAP-DESTROY, toolbar-bmp
           CALL "w$bitmap" USING WBITMAP-DESTROY, TOOLBAR-BMP
      *    After-Program
           EXIT PROGRAM TOTEM-PgmStatus
           STOP RUN.

       INITIALIZE-ROUTINE.
      *    Before Init
      * initialize program status variable
           Initialize TOTEM-PgmStatus.
      * get system information
           ACCEPT SYSTEM-INFORMATION FROM SYSTEM-INFO.
      * get terminal information
           ACCEPT TERMINAL-ABILITIES FROM TERMINAL-INFO.
      * set font
           PERFORM INIT-FONT.
      * load bitmap
           PERFORM INIT-BMP.
      * load resource
           PERFORM INIT-RES.
      * create pop-up menu
           PERFORM INIT-POPUP.
      * open files
           PERFORM OPEN-FILE-RTN.
      *    After Init
           .
    
       INIT-FONT.
      * Verdana12B-Occidentale
           INITIALIZE WFONT-DATA Verdana12B-Occidentale
           MOVE 12 TO WFONT-SIZE
           MOVE "Verdana" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO TRUE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Verdana12B-Occidentale, WFONT-DATA
           .

       INIT-BMP.
      * TOOL-ESCI
           COPY RESOURCE "toolbar.bmp".
           CALL "w$bitmap" USING WBITMAP-LOAD "toolbar.bmp", 
                   GIVING toolbar-bmp.
      * TOOL-ANTEPRIMA
           COPY RESOURCE "TOOLBAR.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "TOOLBAR.BMP", 
                   GIVING TOOLBAR-BMP.
           .

       INIT-RES.
           .

       INIT-POPUP.
           .

       OPEN-FILE-RTN.
      *    Before Open
           PERFORM OPEN-contestazioni
           PERFORM OPEN-note-cont
      *    zoom-tordini OPEN MODE IS FALSE
      *    PERFORM OPEN-zoom-tordini
           PERFORM OPEN-tnotacr
           PERFORM OPEN-clienti
           PERFORM OPEN-destini
      *    After Open
           .

       OPEN-contestazioni.
      * <TOTEM:EPT. INIT:gcolleg, FD:contestazioni, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT contestazioni
           IF NOT Valid-STATUS-contestazioni
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gcolleg, FD:contestazioni, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-note-cont.
      * <TOTEM:EPT. INIT:gcolleg, FD:note-cont, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O note-cont
           IF STATUS-note-cont = "35"
              OPEN OUTPUT note-cont
                IF Valid-STATUS-note-cont
                   CLOSE note-cont
                   OPEN I-O note-cont
                END-IF
           END-IF
           IF NOT Valid-STATUS-note-cont
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gcolleg, FD:note-cont, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-zoom-tordini.
      * <TOTEM:EPT. INIT:gcolleg, FD:zoom-tordini, BeforeOpen>
      * <TOTEM:END>
           OPEN  OUTPUT zoom-tordini
           IF NOT Valid-STATUS-zoom-tordini
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gcolleg, FD:zoom-tordini, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tnotacr.
      * <TOTEM:EPT. INIT:gcolleg, FD:tnotacr, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tnotacr
           IF NOT Valid-STATUS-tnotacr
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gcolleg, FD:tnotacr, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-clienti.
      * <TOTEM:EPT. INIT:gcolleg, FD:clienti, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT clienti
           IF NOT Valid-STATUS-clienti
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gcolleg, FD:clienti, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-destini.
      * <TOTEM:EPT. INIT:gcolleg, FD:destini, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT destini
           IF NOT Valid-STATUS-destini
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gcolleg, FD:destini, AfterOpen>
      * <TOTEM:END>
           .

       CLOSE-FILE-RTN.
      *    Before Close
           PERFORM CLOSE-contestazioni
           PERFORM CLOSE-note-cont
      *    zoom-tordini CLOSE MODE IS FALSE
      *    PERFORM CLOSE-zoom-tordini
           PERFORM CLOSE-tnotacr
           PERFORM CLOSE-clienti
           PERFORM CLOSE-destini
      *    After Close
           .

       CLOSE-contestazioni.
      * <TOTEM:EPT. INIT:gcolleg, FD:contestazioni, BeforeClose>
      * <TOTEM:END>
           CLOSE contestazioni
           .

       CLOSE-note-cont.
      * <TOTEM:EPT. INIT:gcolleg, FD:note-cont, BeforeClose>
      * <TOTEM:END>
           CLOSE note-cont
           .

       CLOSE-zoom-tordini.
      * <TOTEM:EPT. INIT:gcolleg, FD:zoom-tordini, BeforeClose>
      * <TOTEM:END>
           .

       CLOSE-tnotacr.
      * <TOTEM:EPT. INIT:gcolleg, FD:tnotacr, BeforeClose>
      * <TOTEM:END>
           CLOSE tnotacr
           .

       CLOSE-clienti.
      * <TOTEM:EPT. INIT:gcolleg, FD:clienti, BeforeClose>
      * <TOTEM:END>
           CLOSE clienti
           .

       CLOSE-destini.
      * <TOTEM:EPT. INIT:gcolleg, FD:destini, BeforeClose>
      * <TOTEM:END>
           CLOSE destini
           .

       contestazioni-k1-MERGE-SPLITBUF.
           INITIALIZE contestazioni-k1-SPLITBUF
           MOVE cnt-cod-cli(1:5) TO contestazioni-k1-SPLITBUF(1:5)
           MOVE cnt-prg-destino(1:5) TO contestazioni-k1-SPLITBUF(6:5)
           MOVE cnt-tipo(1:1) TO contestazioni-k1-SPLITBUF(11:1)
           MOVE cnt-chiave(1:12) TO contestazioni-k1-SPLITBUF(12:12)
           .

       contestazioni-k-fattura-MERGE-SPLITBUF.
           INITIALIZE contestazioni-k-fattura-SPLITBUF
           MOVE cnt-fattura(1:12) TO 
           contestazioni-k-fattura-SPLITBUF(1:12)
           .

       contestazioni-k-nota-MERGE-SPLITBUF.
           INITIALIZE contestazioni-k-nota-SPLITBUF
           MOVE cnt-nota-cr(1:12) TO contestazioni-k-nota-SPLITBUF(1:12)
           .

       DataSet1-contestazioni-INITSTART.
           IF DataSet1-contestazioni-KEY-Asc
              MOVE Low-Value TO cnt-chiave
           ELSE
              MOVE High-Value TO cnt-chiave
           END-IF
           .

       DataSet1-contestazioni-INITEND.
           IF DataSet1-contestazioni-KEY-Asc
              MOVE High-Value TO cnt-chiave
           ELSE
              MOVE Low-Value TO cnt-chiave
           END-IF
           .

      * contestazioni
       DataSet1-contestazioni-START.
           IF DataSet1-contestazioni-KEY-Asc
              START contestazioni KEY >= cnt-chiave
           ELSE
              START contestazioni KEY <= cnt-chiave
           END-IF
           .

       DataSet1-contestazioni-START-NOTGREATER.
           IF DataSet1-contestazioni-KEY-Asc
              START contestazioni KEY <= cnt-chiave
           ELSE
              START contestazioni KEY >= cnt-chiave
           END-IF
           .

       DataSet1-contestazioni-START-GREATER.
           IF DataSet1-contestazioni-KEY-Asc
              START contestazioni KEY > cnt-chiave
           ELSE
              START contestazioni KEY < cnt-chiave
           END-IF
           .

       DataSet1-contestazioni-START-LESS.
           IF DataSet1-contestazioni-KEY-Asc
              START contestazioni KEY < cnt-chiave
           ELSE
              START contestazioni KEY > cnt-chiave
           END-IF
           .

       DataSet1-contestazioni-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:contestazioni, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:contestazioni, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-contestazioni-LOCK
              READ contestazioni WITH LOCK 
              KEY cnt-chiave
           ELSE
              READ contestazioni WITH NO LOCK 
              KEY cnt-chiave
           END-IF
           PERFORM contestazioni-k1-MERGE-SPLITBUF
           PERFORM contestazioni-k-fattura-MERGE-SPLITBUF
           PERFORM contestazioni-k-nota-MERGE-SPLITBUF
           MOVE STATUS-contestazioni TO TOTEM-ERR-STAT 
           MOVE "contestazioni" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:contestazioni, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:contestazioni, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-contestazioni-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:contestazioni, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:contestazioni, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-contestazioni-KEY-Asc
              IF DataSet1-contestazioni-LOCK
                 READ contestazioni NEXT WITH LOCK
              ELSE
                 READ contestazioni NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-contestazioni-LOCK
                 READ contestazioni PREVIOUS WITH LOCK
              ELSE
                 READ contestazioni PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM contestazioni-k1-MERGE-SPLITBUF
           PERFORM contestazioni-k-fattura-MERGE-SPLITBUF
           PERFORM contestazioni-k-nota-MERGE-SPLITBUF
           MOVE STATUS-contestazioni TO TOTEM-ERR-STAT
           MOVE "contestazioni" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:contestazioni, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:contestazioni, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-contestazioni-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:contestazioni, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:contestazioni, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-contestazioni-KEY-Asc
              IF DataSet1-contestazioni-LOCK
                 READ contestazioni PREVIOUS WITH LOCK
              ELSE
                 READ contestazioni PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-contestazioni-LOCK
                 READ contestazioni NEXT WITH LOCK
              ELSE
                 READ contestazioni NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM contestazioni-k1-MERGE-SPLITBUF
           PERFORM contestazioni-k-fattura-MERGE-SPLITBUF
           PERFORM contestazioni-k-nota-MERGE-SPLITBUF
           MOVE STATUS-contestazioni TO TOTEM-ERR-STAT
           MOVE "contestazioni" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:contestazioni, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:contestazioni, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-contestazioni-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:contestazioni, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-contestazioni TO TOTEM-ERR-STAT
           MOVE "contestazioni" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:contestazioni, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-contestazioni-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:contestazioni, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-contestazioni TO TOTEM-ERR-STAT
           MOVE "contestazioni" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:contestazioni, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-contestazioni-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:contestazioni, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-contestazioni TO TOTEM-ERR-STAT
           MOVE "contestazioni" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:contestazioni, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-note-cont-INITSTART.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-note-cont-KEY1-Asc
                 MOVE Low-Value TO noco-chiave
              ELSE
                 MOVE High-Value TO noco-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-note-cont-INITEND.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-note-cont-KEY1-Asc
                 MOVE High-Value TO noco-chiave
              ELSE
                 MOVE Low-Value TO noco-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           .   

       DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-note-cont-KEY1-ORDER
           END-EVALUATE
           .

       DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-note-cont-KEY1-ORDER
           END-EVALUATE
           .

      * note-cont
       DataSet1-note-cont-START.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-note-cont-KEY1-Asc
                 START note-cont KEY >= noco-chiave
              ELSE
                 START note-cont KEY <= noco-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-note-cont-START-NOTGREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-note-cont-KEY1-Asc
                 START note-cont KEY <= noco-chiave
              ELSE
                 START note-cont KEY >= noco-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-note-cont-START-GREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-note-cont-KEY1-Asc
                 START note-cont KEY > noco-chiave
              ELSE
                 START note-cont KEY < noco-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-note-cont-START-LESS.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-note-cont-KEY1-Asc
                 START note-cont KEY < noco-chiave
              ELSE
                 START note-cont KEY > noco-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-note-cont-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:note-cont, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:note-cont, BeforeReadRecord>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-note-cont-LOCK
                 READ note-cont WITH LOCK 
                 KEY noco-chiave
              ELSE
                 READ note-cont WITH NO LOCK 
                 KEY noco-chiave
              END-IF
           END-EVALUATE
           MOVE STATUS-note-cont TO TOTEM-ERR-STAT 
           MOVE "note-cont" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:note-cont, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:note-cont, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-note-cont-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:note-cont, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:note-cont, BeforeReadNext>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-note-cont-KEY1-Asc
                 IF DataSet1-note-cont-LOCK
                    READ note-cont NEXT WITH LOCK
                 ELSE
                    READ note-cont NEXT WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-note-cont-LOCK
                    READ note-cont PREVIOUS WITH LOCK
                 ELSE
                    READ note-cont PREVIOUS WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           MOVE STATUS-note-cont TO TOTEM-ERR-STAT
           MOVE "note-cont" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:note-cont, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:note-cont, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-note-cont-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:note-cont, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:note-cont, BeforeReadPrev>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-note-cont-KEY1-Asc
                 IF DataSet1-note-cont-LOCK
                    READ note-cont PREVIOUS WITH LOCK
                 ELSE
                    READ note-cont PREVIOUS WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-note-cont-LOCK
                    READ note-cont NEXT WITH LOCK
                 ELSE
                    READ note-cont NEXT WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           MOVE STATUS-note-cont TO TOTEM-ERR-STAT
           MOVE "note-cont" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:note-cont, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:note-cont, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-note-cont-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:note-cont, BeforeWrite>
      * <TOTEM:END>
           WRITE noco-rec OF note-cont.
           MOVE STATUS-note-cont TO TOTEM-ERR-STAT
           MOVE "note-cont" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:note-cont, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-note-cont-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:note-cont, BeforeRewrite>
      * <TOTEM:END>
           REWRITE noco-rec OF note-cont.
           MOVE STATUS-note-cont TO TOTEM-ERR-STAT
           MOVE "note-cont" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:note-cont, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-note-cont-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:note-cont, BeforeDelete>
      * <TOTEM:END>
           DELETE note-cont.
           MOVE STATUS-note-cont TO TOTEM-ERR-STAT
           MOVE "note-cont" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:note-cont, AfterDelete>
      * <TOTEM:END>
           .

       zoom-tordini-zoom-tor-key01-MERGE-SPLITBUF.
           INITIALIZE zoom-tordini-zoom-tor-key01-SPLITBUF
           MOVE zoom-tor-chiave(1:12) TO 
           zoom-tordini-zoom-tor-key01-SPLITBUF(1:12)
           .

       zoom-tordini-zoom-tor-key01-SPLITBUF-TOFLD.
           MOVE zoom-tordini-zoom-tor-key01-SPLITBUF(1:12) TO 
           zoom-tor-chiave(1:12)
           .

       zoom-tordini-k-clidest-MERGE-SPLITBUF.
           INITIALIZE zoom-tordini-k-clidest-SPLITBUF
           MOVE zoom-tor-cod-cli(1:5) TO 
           zoom-tordini-k-clidest-SPLITBUF(1:5)
           MOVE zoom-tor-prg-destino(1:5) TO 
           zoom-tordini-k-clidest-SPLITBUF(6:5)
           .

       DataSet1-zoom-tordini-INITSTART.
           IF DataSet1-zoom-tordini-KEY-Asc
              MOVE Low-Value TO zoom-tor-chiave
           ELSE
              MOVE High-Value TO zoom-tor-chiave
           END-IF
           .

       DataSet1-zoom-tordini-INITEND.
           IF DataSet1-zoom-tordini-KEY-Asc
              MOVE High-Value to zoom-tor-chiave
           ELSE
              MOVE Low-Value to zoom-tor-chiave
           END-IF
           .

       DataSet1-zoom-tordini-TMPBUF-TO-FLD.
           MOVE DataSet1-zoom-tordini-SPLIT-BUF1(1:12) TO
                zoom-tor-chiave(1:12)
           .

       DataSet1-zoom-tordini-FLD-TO-TMPBUF.
           MOVE zoom-tor-chiave(1:12) TO
                DataSet1-zoom-tordini-SPLIT-BUF1(1:12)
           .

      * zoom-tordini
       DataSet1-zoom-tordini-START.
           IF DataSet1-zoom-tordini-KEY-Asc
              START zoom-tordini KEY >= zoom-tor-key01
           ELSE
              START zoom-tordini KEY <= zoom-tor-key01
           END-IF
           .

       DataSet1-zoom-tordini-START-NOTGREATER.
           IF DataSet1-zoom-tordini-KEY-Asc
              START zoom-tordini KEY <= zoom-tor-key01
           ELSE
              START zoom-tordini KEY >= zoom-tor-key01
           END-IF
           .

       DataSet1-zoom-tordini-START-GREATER.
           IF DataSet1-zoom-tordini-KEY-Asc
              START zoom-tordini KEY > zoom-tor-key01
           ELSE
              START zoom-tordini KEY < zoom-tor-key01
           END-IF
           .

       DataSet1-zoom-tordini-START-LESS.
           IF DataSet1-zoom-tordini-KEY-Asc
              START zoom-tordini KEY < zoom-tor-key01
           ELSE
              START zoom-tordini KEY > zoom-tor-key01
           END-IF
           .

       DataSet1-zoom-tordini-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tordini, BeforeReadRecord>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tordini, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-zoom-tordini-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tordini, BeforeReadNext>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tordini, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-zoom-tordini-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tordini, BeforeReadPrev>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tordini, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-zoom-tordini-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tordini, BeforeWrite>
      * <TOTEM:END>
           WRITE zoom-tor-rec OF zoom-tordini.
           MOVE STATUS-zoom-tordini TO TOTEM-ERR-STAT
           MOVE "zoom-tordini" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tordini, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-zoom-tordini-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tordini, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-zoom-tordini TO TOTEM-ERR-STAT
           MOVE "zoom-tordini" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tordini, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-zoom-tordini-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tordini, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-zoom-tordini TO TOTEM-ERR-STAT
           MOVE "zoom-tordini" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tordini, AfterDelete>
      * <TOTEM:END>
           .

       tnotacr-k-causale-MERGE-SPLITBUF.
           INITIALIZE tnotacr-k-causale-SPLITBUF
           MOVE tno-causale(1:4) TO tnotacr-k-causale-SPLITBUF(1:4)
           MOVE tno-anno(1:4) TO tnotacr-k-causale-SPLITBUF(5:4)
           MOVE tno-numero(1:8) TO tnotacr-k-causale-SPLITBUF(9:8)
           .

       tnotacr-k1-MERGE-SPLITBUF.
           INITIALIZE tnotacr-k1-SPLITBUF
           MOVE tno-cod-cli(1:5) TO tnotacr-k1-SPLITBUF(1:5)
           MOVE tno-prg-destino(1:5) TO tnotacr-k1-SPLITBUF(6:5)
           MOVE tno-anno(1:4) TO tnotacr-k1-SPLITBUF(11:4)
           MOVE tno-numero(1:8) TO tnotacr-k1-SPLITBUF(15:8)
           .

       tnotacr-k2-MERGE-SPLITBUF.
           INITIALIZE tnotacr-k2-SPLITBUF
           MOVE tno-data-passaggio-ordine(1:8) TO 
           tnotacr-k2-SPLITBUF(1:8)
           MOVE tno-anno(1:4) TO tnotacr-k2-SPLITBUF(9:4)
           MOVE tno-numero(1:8) TO tnotacr-k2-SPLITBUF(13:8)
           .

       tnotacr-k-fattura-MERGE-SPLITBUF.
           INITIALIZE tnotacr-k-fattura-SPLITBUF
           MOVE tno-anno-fattura(1:4) TO tnotacr-k-fattura-SPLITBUF(1:4)
           MOVE tno-num-fattura(1:8) TO tnotacr-k-fattura-SPLITBUF(5:8)
           .

       tnotacr-k4-MERGE-SPLITBUF.
           INITIALIZE tnotacr-k4-SPLITBUF
           MOVE tno-anno-fattura(1:4) TO tnotacr-k4-SPLITBUF(1:4)
           MOVE tno-data-fattura(1:8) TO tnotacr-k4-SPLITBUF(5:8)
           MOVE tno-num-fattura(1:8) TO tnotacr-k4-SPLITBUF(13:8)
           MOVE tno-num-prenot(1:8) TO tnotacr-k4-SPLITBUF(21:8)
           MOVE tno-fatt-prenotata(1:1) TO tnotacr-k4-SPLITBUF(29:1)
           .

       tnotacr-k-contab-MERGE-SPLITBUF.
           INITIALIZE tnotacr-k-contab-SPLITBUF
           MOVE tno-agg-contab(1:1) TO tnotacr-k-contab-SPLITBUF(1:1)
           MOVE tno-anno-fattura(1:4) TO tnotacr-k-contab-SPLITBUF(2:4)
           MOVE tno-num-fattura(1:8) TO tnotacr-k-contab-SPLITBUF(6:8)
           .

       tnotacr-k-data-MERGE-SPLITBUF.
           INITIALIZE tnotacr-k-data-SPLITBUF
           MOVE tno-data(1:8) TO tnotacr-k-data-SPLITBUF(1:8)
           MOVE tno-numero(1:8) TO tnotacr-k-data-SPLITBUF(9:8)
           .

       tnotacr-k-agfatt-MERGE-SPLITBUF.
           INITIALIZE tnotacr-k-agfatt-SPLITBUF
           MOVE tno-anno-fattura(1:4) TO tnotacr-k-agfatt-SPLITBUF(1:4)
           MOVE tno-data-fattura(1:8) TO tnotacr-k-agfatt-SPLITBUF(5:8)
           MOVE tno-num-fattura(1:8) TO tnotacr-k-agfatt-SPLITBUF(13:8)
           MOVE tno-num-prenot(1:8) TO tnotacr-k-agfatt-SPLITBUF(21:8)
           MOVE tno-fatt-prenotata(1:1) TO 
           tnotacr-k-agfatt-SPLITBUF(29:1)
           MOVE tno-chiave(1:12) TO tnotacr-k-agfatt-SPLITBUF(30:12)
           .

       tnotacr-k-andamento-data-MERGE-SPLITBUF.
           INITIALIZE tnotacr-k-andamento-data-SPLITBUF
           MOVE tno-agg-contab(1:1) TO 
           tnotacr-k-andamento-data-SPLITBUF(1:1)
           MOVE tno-data-fattura(1:8) TO 
           tnotacr-k-andamento-data-SPLITBUF(2:8)
           .

       tnotacr-k-andamento-cliente-MERGE-SPLITBUF.
           INITIALIZE tnotacr-k-andamento-cliente-SPLITBUF
           MOVE tno-cod-cli(1:5) TO 
           tnotacr-k-andamento-cliente-SPLITBUF(1:5)
           MOVE tno-agg-contab(1:1) TO 
           tnotacr-k-andamento-cliente-SPLITBUF(6:1)
           MOVE tno-data-fattura(1:8) TO 
           tnotacr-k-andamento-cliente-SPLITBUF(7:8)
           .

       tnotacr-k-andamento-clides-MERGE-SPLITBUF.
           INITIALIZE tnotacr-k-andamento-clides-SPLITBUF
           MOVE tno-cod-cli(1:5) TO 
           tnotacr-k-andamento-clides-SPLITBUF(1:5)
           MOVE tno-prg-destino(1:5) TO 
           tnotacr-k-andamento-clides-SPLITBUF(6:5)
           MOVE tno-agg-contab(1:1) TO 
           tnotacr-k-andamento-clides-SPLITBUF(11:1)
           MOVE tno-data-fattura(1:8) TO 
           tnotacr-k-andamento-clides-SPLITBUF(12:8)
           .

       DataSet1-tnotacr-INITSTART.
           IF DataSet1-tnotacr-KEY-Asc
              MOVE Low-Value TO tno-chiave
           ELSE
              MOVE High-Value TO tno-chiave
           END-IF
           .

       DataSet1-tnotacr-INITEND.
           IF DataSet1-tnotacr-KEY-Asc
              MOVE High-Value TO tno-chiave
           ELSE
              MOVE Low-Value TO tno-chiave
           END-IF
           .

      * tnotacr
       DataSet1-tnotacr-START.
           IF DataSet1-tnotacr-KEY-Asc
              START tnotacr KEY >= tno-chiave
           ELSE
              START tnotacr KEY <= tno-chiave
           END-IF
           .

       DataSet1-tnotacr-START-NOTGREATER.
           IF DataSet1-tnotacr-KEY-Asc
              START tnotacr KEY <= tno-chiave
           ELSE
              START tnotacr KEY >= tno-chiave
           END-IF
           .

       DataSet1-tnotacr-START-GREATER.
           IF DataSet1-tnotacr-KEY-Asc
              START tnotacr KEY > tno-chiave
           ELSE
              START tnotacr KEY < tno-chiave
           END-IF
           .

       DataSet1-tnotacr-START-LESS.
           IF DataSet1-tnotacr-KEY-Asc
              START tnotacr KEY < tno-chiave
           ELSE
              START tnotacr KEY > tno-chiave
           END-IF
           .

       DataSet1-tnotacr-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tnotacr-LOCK
              READ tnotacr WITH LOCK 
              KEY tno-chiave
           ELSE
              READ tnotacr WITH NO LOCK 
              KEY tno-chiave
           END-IF
           PERFORM tnotacr-k-causale-MERGE-SPLITBUF
           PERFORM tnotacr-k1-MERGE-SPLITBUF
           PERFORM tnotacr-k2-MERGE-SPLITBUF
           PERFORM tnotacr-k-fattura-MERGE-SPLITBUF
           PERFORM tnotacr-k4-MERGE-SPLITBUF
           PERFORM tnotacr-k-contab-MERGE-SPLITBUF
           PERFORM tnotacr-k-data-MERGE-SPLITBUF
           PERFORM tnotacr-k-agfatt-MERGE-SPLITBUF
           PERFORM tnotacr-k-andamento-data-MERGE-SPLITBUF
           PERFORM tnotacr-k-andamento-cliente-MERGE-SPLITBUF
           PERFORM tnotacr-k-andamento-clides-MERGE-SPLITBUF
           MOVE STATUS-tnotacr TO TOTEM-ERR-STAT 
           MOVE "tnotacr" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tnotacr-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tnotacr-KEY-Asc
              IF DataSet1-tnotacr-LOCK
                 READ tnotacr NEXT WITH LOCK
              ELSE
                 READ tnotacr NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tnotacr-LOCK
                 READ tnotacr PREVIOUS WITH LOCK
              ELSE
                 READ tnotacr PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tnotacr-k-causale-MERGE-SPLITBUF
           PERFORM tnotacr-k1-MERGE-SPLITBUF
           PERFORM tnotacr-k2-MERGE-SPLITBUF
           PERFORM tnotacr-k-fattura-MERGE-SPLITBUF
           PERFORM tnotacr-k4-MERGE-SPLITBUF
           PERFORM tnotacr-k-contab-MERGE-SPLITBUF
           PERFORM tnotacr-k-data-MERGE-SPLITBUF
           PERFORM tnotacr-k-agfatt-MERGE-SPLITBUF
           PERFORM tnotacr-k-andamento-data-MERGE-SPLITBUF
           PERFORM tnotacr-k-andamento-cliente-MERGE-SPLITBUF
           PERFORM tnotacr-k-andamento-clides-MERGE-SPLITBUF
           MOVE STATUS-tnotacr TO TOTEM-ERR-STAT
           MOVE "tnotacr" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tnotacr-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tnotacr-KEY-Asc
              IF DataSet1-tnotacr-LOCK
                 READ tnotacr PREVIOUS WITH LOCK
              ELSE
                 READ tnotacr PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tnotacr-LOCK
                 READ tnotacr NEXT WITH LOCK
              ELSE
                 READ tnotacr NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tnotacr-k-causale-MERGE-SPLITBUF
           PERFORM tnotacr-k1-MERGE-SPLITBUF
           PERFORM tnotacr-k2-MERGE-SPLITBUF
           PERFORM tnotacr-k-fattura-MERGE-SPLITBUF
           PERFORM tnotacr-k4-MERGE-SPLITBUF
           PERFORM tnotacr-k-contab-MERGE-SPLITBUF
           PERFORM tnotacr-k-data-MERGE-SPLITBUF
           PERFORM tnotacr-k-agfatt-MERGE-SPLITBUF
           PERFORM tnotacr-k-andamento-data-MERGE-SPLITBUF
           PERFORM tnotacr-k-andamento-cliente-MERGE-SPLITBUF
           PERFORM tnotacr-k-andamento-clides-MERGE-SPLITBUF
           MOVE STATUS-tnotacr TO TOTEM-ERR-STAT
           MOVE "tnotacr" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tnotacr-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tnotacr TO TOTEM-ERR-STAT
           MOVE "tnotacr" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tnotacr-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tnotacr TO TOTEM-ERR-STAT
           MOVE "tnotacr" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tnotacr-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tnotacr TO TOTEM-ERR-STAT
           MOVE "tnotacr" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, AfterDelete>
      * <TOTEM:END>
           .

       clienti-cli-K1-MERGE-SPLITBUF.
           INITIALIZE clienti-cli-K1-SPLITBUF
           MOVE cli-tipo-CF OF clienti(1:1) TO 
           clienti-cli-K1-SPLITBUF(1:1)
           MOVE cli-ragsoc-1 OF clienti(1:40) TO 
           clienti-cli-K1-SPLITBUF(2:40)
           MOVE cli-codice OF clienti(1:5) TO 
           clienti-cli-K1-SPLITBUF(42:5)
           .

       clienti-cli-K3-MERGE-SPLITBUF.
           INITIALIZE clienti-cli-K3-SPLITBUF
           MOVE cli-gdo OF clienti(1:5) TO clienti-cli-K3-SPLITBUF(1:5)
           MOVE cli-chiave OF clienti(1:6) TO 
           clienti-cli-K3-SPLITBUF(6:6)
           .

       clienti-cli-K4-MERGE-SPLITBUF.
           INITIALIZE clienti-cli-K4-SPLITBUF
           MOVE cli-utf OF clienti(1:1) TO clienti-cli-K4-SPLITBUF(1:1)
           MOVE cli-chiave OF clienti(1:6) TO 
           clienti-cli-K4-SPLITBUF(2:6)
           .

       DataSet1-clienti-INITSTART.
           IF DataSet1-clienti-KEY-Asc
              MOVE Low-Value TO cli-chiave OF clienti
           ELSE
              MOVE High-Value TO cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-INITEND.
           IF DataSet1-clienti-KEY-Asc
              MOVE High-Value TO cli-chiave OF clienti
           ELSE
              MOVE Low-Value TO cli-chiave OF clienti
           END-IF
           .

      * clienti
       DataSet1-clienti-START.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY >= cli-chiave OF clienti
           ELSE
              START clienti KEY <= cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-START-NOTGREATER.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY <= cli-chiave OF clienti
           ELSE
              START clienti KEY >= cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-START-GREATER.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY > cli-chiave OF clienti
           ELSE
              START clienti KEY < cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-START-LESS.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY < cli-chiave OF clienti
           ELSE
              START clienti KEY > cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-clienti-LOCK
              READ clienti WITH LOCK 
              KEY cli-chiave OF clienti
           ELSE
              READ clienti WITH NO LOCK 
              KEY cli-chiave OF clienti
           END-IF
           PERFORM clienti-cli-K1-MERGE-SPLITBUF
           PERFORM clienti-cli-K3-MERGE-SPLITBUF
           PERFORM clienti-cli-K4-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT 
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-clienti-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-clienti-KEY-Asc
              IF DataSet1-clienti-LOCK
                 READ clienti NEXT WITH LOCK
              ELSE
                 READ clienti NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-clienti-LOCK
                 READ clienti PREVIOUS WITH LOCK
              ELSE
                 READ clienti PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM clienti-cli-K1-MERGE-SPLITBUF
           PERFORM clienti-cli-K3-MERGE-SPLITBUF
           PERFORM clienti-cli-K4-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-clienti-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-clienti-KEY-Asc
              IF DataSet1-clienti-LOCK
                 READ clienti PREVIOUS WITH LOCK
              ELSE
                 READ clienti PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-clienti-LOCK
                 READ clienti NEXT WITH LOCK
              ELSE
                 READ clienti NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM clienti-cli-K1-MERGE-SPLITBUF
           PERFORM clienti-cli-K3-MERGE-SPLITBUF
           PERFORM clienti-cli-K4-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterDelete>
      * <TOTEM:END>
           .

       destini-K1-MERGE-SPLITBUF.
           INITIALIZE destini-K1-SPLITBUF
           MOVE des-ragsoc-1(1:40) TO destini-K1-SPLITBUF(1:40)
           MOVE des-codice(1:5) TO destini-K1-SPLITBUF(41:5)
           MOVE des-prog(1:5) TO destini-K1-SPLITBUF(46:5)
           .

       destini-k-localita-MERGE-SPLITBUF.
           INITIALIZE destini-k-localita-SPLITBUF
           MOVE des-localita(1:35) TO destini-k-localita-SPLITBUF(1:35)
           .

       DataSet1-destini-INITSTART.
           IF DataSet1-destini-KEY-Asc
              MOVE Low-Value TO des-chiave
           ELSE
              MOVE High-Value TO des-chiave
           END-IF
           .

       DataSet1-destini-INITEND.
           IF DataSet1-destini-KEY-Asc
              MOVE High-Value TO des-chiave
           ELSE
              MOVE Low-Value TO des-chiave
           END-IF
           .

      * destini
       DataSet1-destini-START.
           IF DataSet1-destini-KEY-Asc
              START destini KEY >= des-chiave
           ELSE
              START destini KEY <= des-chiave
           END-IF
           .

       DataSet1-destini-START-NOTGREATER.
           IF DataSet1-destini-KEY-Asc
              START destini KEY <= des-chiave
           ELSE
              START destini KEY >= des-chiave
           END-IF
           .

       DataSet1-destini-START-GREATER.
           IF DataSet1-destini-KEY-Asc
              START destini KEY > des-chiave
           ELSE
              START destini KEY < des-chiave
           END-IF
           .

       DataSet1-destini-START-LESS.
           IF DataSet1-destini-KEY-Asc
              START destini KEY < des-chiave
           ELSE
              START destini KEY > des-chiave
           END-IF
           .

       DataSet1-destini-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-destini-LOCK
              READ destini WITH LOCK 
              KEY des-chiave
           ELSE
              READ destini WITH NO LOCK 
              KEY des-chiave
           END-IF
           PERFORM destini-K1-MERGE-SPLITBUF
           PERFORM destini-k-localita-MERGE-SPLITBUF
           MOVE STATUS-destini TO TOTEM-ERR-STAT 
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-destini-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-destini-KEY-Asc
              IF DataSet1-destini-LOCK
                 READ destini NEXT WITH LOCK
              ELSE
                 READ destini NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-destini-LOCK
                 READ destini PREVIOUS WITH LOCK
              ELSE
                 READ destini PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM destini-K1-MERGE-SPLITBUF
           PERFORM destini-k-localita-MERGE-SPLITBUF
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-destini-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-destini-KEY-Asc
              IF DataSet1-destini-LOCK
                 READ destini PREVIOUS WITH LOCK
              ELSE
                 READ destini PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-destini-LOCK
                 READ destini NEXT WITH LOCK
              ELSE
                 READ destini NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM destini-K1-MERGE-SPLITBUF
           PERFORM destini-k-localita-MERGE-SPLITBUF
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-destini-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-destini-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-destini-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-INIT-RECORD.
           INITIALIZE cnt-rec OF contestazioni
           INITIALIZE noco-rec OF note-cont
           INITIALIZE zoom-tor-rec OF zoom-tordini
           INITIALIZE tno-rec OF tnotacr
           INITIALIZE cli-rec OF clienti
           INITIALIZE des-rec OF destini
           .


      * GRID
       form1-gd-1-Content.
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 1, Y = 1,
                CELL-DATA = "Anno",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 2, Y = 1,
                CELL-DATA = "Numero",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 3, Y = 1,
                CELL-DATA = "Data",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 4, Y = 1,
                CELL-DATA = "Cliente",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 5, Y = 1,
                CELL-DATA = "Località",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 6, Y = 1,
                CELL-DATA = "N. Fatt",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 7, Y = 1,
                CELL-DATA = "Data Fatt",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 8, Y = 1,
                CELL-DATA = "N. Nota",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 9, Y = 1,
                CELL-DATA = "Data Nota cr",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 10, Y = 1,
                CELL-DATA = "Nota (Anno - Num)",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 11, Y = 1,
                CELL-DATA = "Nota (Anno - Num)",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 12, Y = 1,
                CELL-DATA = "Nota (Anno - Num)",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 13, Y = 1,
                CELL-DATA = "Nota (Anno - Num)",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 14, Y = 1,
                CELL-DATA = "Nota (Anno - Num)",
      * COLUMNS' SETTING
              MODIFY form1-gd-1, X = 1  
                COLUMN-FONT = Small-Font,
      * COLUMNS' SETTING
              MODIFY form1-gd-1, X = 2  
                COLUMN-FONT = Small-Font,
           .

      * FD's Initialize Paragraph
       DataSet1-contestazioni-INITREC.
           INITIALIZE cnt-rec OF contestazioni
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-note-cont-INITREC.
           INITIALIZE noco-rec OF note-cont
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-zoom-tordini-INITREC.
           INITIALIZE zoom-tor-rec OF zoom-tordini
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tnotacr-INITREC.
           INITIALIZE tno-rec OF tnotacr
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-clienti-INITREC.
           INITIALIZE cli-rec OF clienti
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-destini-INITREC.
           INITIALIZE des-rec OF destini
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      *
       DataSet1-DISPATCH-BUFTOFLD.
           EVALUATE TOTEM-Form-Index ALSO TOTEM-Frame-Index
              WHEN 1 ALSO 0
                  PERFORM Form1-Buf-To-Fld
           END-EVALUATE
           .

       Form1-Open-Routine.
           PERFORM Form1-Scrn
           PERFORM Form1-Proc
           .

       Form1-Scrn.
           PERFORM Form1-Create-Win
           PERFORM Form1-Init-Value
           PERFORM Form1-Init-Data
      * Tab keystrok settings
      * Tool Bar
           DISPLAY Form1-Tb-1
           PERFORM Form1-DISPLAY
           .

       Form1-Create-Win.
           Display Independent GRAPHICAL WINDOW
              LINES 16,46,
              SIZE 164,50,
              COLOR 65793,
              CONTROL FONT Small-Font,
              LINK TO THREAD,
              NO SCROLL,
              TITLE-BAR,
              TITLE titolo,
              AUTO-MINIMIZE,
              WITH SYSTEM MENU,
              USER-GRAY,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE Form1-Event-Proc,
              HANDLE IS Form1-Handle,
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
           DISPLAY TOOL-BAR 
              LINES 2,69,   
              HANDLE IN Form1-Tb-1-Handle
           DISPLAY Form1-Tb-1 UPON Form1-Tb-1-Handle

      * Status-bar
           DISPLAY Form1 UPON Form1-Handle
      * DISPLAY-COLUMNS settings
              MODIFY form1-gd-1, DISPLAY-COLUMNS (1, 7, 16, 28, 58, 88, 
           97, 109, 117, 129, 145, 161, 177, 193)
           .

       Form1-PROC.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeAccept>
           move Linklivello-abil to livello-abil.
                                        
           perform ABILITA-TOOLBAR.

           perform LOAD-RECORD.

           move 2  to event-data-2.
           perform SPOSTAMENTO.

           perform INIT.

           |specifico dei pgm. con grid-control
           perform ABILITAZIONI.                      
           
           move LinkNumeroColleg to numero-edit.
           display lab-numero.
           modify tool-nuovo,    enabled false, 
                                 bitmap-number BitmapNewDisabled.
           modify tool-modifica, enabled false, 
                                 bitmap-number BitmapEditDisabled.

           move 2 to event-data-2.
           perform COLORE-RIGA.
           perform GRID-HELP.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT Form1
                 ON EXCEPTION
                    PERFORM Form1-Evaluate-Func
                 MOVE 1 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY Form1-Handle
           INITIALIZE Key-Status
           .

       Form1-Evaluate-Func.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterAccept>
      *    per il bottone modifica
      *****     if key-status = 5
      *****        inquire tool-modifica, enabled in e-modifica
      *****        if e-modifica = 1
      *****           if mod = zero
      *****              move 1    to mod
      *****           else 
      *****              move zero to mod
      *****           end-if
      *****           modify tool-modifica, value = mod
      *****           perform MODIFICA
      *****        end-if
      *****     end-if.

           .
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM Form1-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM Form1-Exit
                 END-IF
              WHEN Key-Status = 4
                 PERFORM CANCELLA-LinkTo
              WHEN Key-Status = 3
                 PERFORM TOOL-SALVA-LinkTo
              WHEN Key-Status = 6
                 PERFORM ANTEPRIMA-LinkTo
              WHEN Key-Status = 7
                 PERFORM STAMPA-LinkTo
              WHEN Key-Status = 8
                 PERFORM TOOL-CERCA-LinkTo
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       Form1-CLEAR.
           PERFORM Form1-INIT-VALUE
           PERFORM Form1-DISPLAY
           .

       Form1-DISPLAY.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY Form1-Tb-1
           DISPLAY Form1 UPON Form1-Handle
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterDisplay>
      * <TOTEM:END>
           .

       Form1-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeExit>
           perform SALV-MOD.
           if errori
              move 28 to key-status
              exit paragraph
           end-if.

           .
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       Form1-Init-Data.
           MOVE 1 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
      * GRID
           PERFORM form1-gd-1-Content
           .

       Form1-DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-note-cont-KEY1-ORDER
           END-EVALUATE
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-note-cont-KEY1-ORDER
           END-EVALUATE
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Update-Key.
           MOVE noco-rec OF note-cont TO
                     Form1-MULKEY-TMPBUF
           PERFORM Form1-CLEAR
           PERFORM Form1-INIT-DATA
           MOVE Form1-MULKEY-TMPBUF TO
                     noco-rec OF note-cont
           PERFORM DataSet1-note-cont-Read
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-CURR
           PERFORM Form1-IUD-Display
           .

       Form1-DUPLICATE-MOVEKEY.
           .

       Form1-First.
           PERFORM Form1-DUMMY-FIRST
           PERFORM DataSet1-note-cont-INITSTART
           PERFORM DataSet1-note-cont-START
           IF NOT Valid-STATUS-note-cont
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeFirst>
      * <TOTEM:END>
           PERFORM DataSet1-note-cont-Read-Next
           IF NOT Valid-STATUS-note-cont
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterFirst>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY.
           PERFORM Form1-IUD-Display
           .

       Form1-Previous.
              PERFORM Form1-Buf-To-Fld
              PERFORM DataSet1-note-cont-START-LESS
           IF NOT Valid-STATUS-note-cont
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforePrevious>
      * <TOTEM:END>
           PERFORM DataSet1-note-cont-Read-Prev
           IF NOT Valid-STATUS-note-cont
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterPrevious>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-PREVIOUS
           PERFORM Form1-IUD-Display
           .

       Form1-Next.
              PERFORM Form1-Buf-To-Fld
              PERFORM DataSet1-note-cont-START-GREATER
           IF NOT Valid-STATUS-note-cont
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeNext>
      * <TOTEM:END>
           PERFORM DataSet1-note-cont-Read-Next
           IF NOT Valid-STATUS-note-cont
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterNext>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-NEXT
           PERFORM Form1-IUD-Display
           .
      
       Form1-Last.
           PERFORM Form1-DUMMY-LAST
           PERFORM DataSet1-note-cont-INITEND
           PERFORM DataSet1-note-cont-START-NOTGREATER
           IF NOT Valid-STATUS-note-cont
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeLast>
      * <TOTEM:END>
           PERFORM DataSet1-note-cont-Read-Prev
           IF NOT Valid-STATUS-note-cont
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterLast>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY.
           PERFORM Form1-IUD-Display
           .

       Form1-Curr.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeCurrent>
      * <TOTEM:END>
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-note-cont-Read
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-CURR
           PERFORM Form1-IUD-Display
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterCurrent>
      * <TOTEM:END>
           .

       Form1-IUD-Display.
           IF Valid-STATUS-note-cont
              PERFORM Form1-ALLGRID-RESET
              PERFORM Form1-Fld-To-Buf
              PERFORM Form1-NAVI-FOR-MASTERGRID
              PERFORM Form1-DISPLAY
           ELSE
              IF Form1-FLAG-REFRESH
                 CONTINUE
              ELSE
                 PERFORM Form1-Extended-File-Status
              END-IF
           END-IF
           .

       Form1-Add.
           PERFORM Form1-Buf-To-Fld
           PERFORM Form1-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM Form1-DUMMY-ADD
           PERFORM DataSet1-note-cont-INITREC
           PERFORM Form1-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeAdd>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-note-cont-Rec-Write
           IF Valid-STATUS-note-cont
              PERFORM Form1-RESUMMARY-INS
              PERFORM Form1-DUMMY-UPDATE-INIT
              MOVE "301" TO TOTEM-MSG-ID
              PERFORM Form1-IUD-Display
           END-IF
           PERFORM Form1-ERR-CHECKING
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterAdd>
      * <TOTEM:END>
           .
     
       Form1-Update.
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-note-cont-START              
           IF NOT Valid-STATUS-note-cont
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
           PERFORM DataSet1-note-cont-Read
           PERFORM Form1-Buf-To-Fld
           PERFORM Form1-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM Form1-DUMMY-UPDATE
           PERFORM Form1-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeUpdate>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-note-cont-Rec-Rewrite
           IF Valid-STATUS-note-cont
              PERFORM Form1-RESUMMARY-DEL
              PERFORM Form1-DUMMY-UPDATE-INIT
              MOVE "302" TO TOTEM-MSG-ID
              PERFORM Form1-IUD-Display
           END-IF
           PERFORM Form1-ERR-CHECKING
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterUpdate>
      * <TOTEM:END>
           .

       Form1-Delete.
           MOVE "203" TO TOTEM-MSG-ID
           PERFORM MESSAGE-BOX-DISPLAY
           IF TOTEM-MSG-RETURN-VALUE NOT = 1
              INITIALIZE TOTEM-MSG-TEXT
              EXIT PARAGRAPH 
           END-IF
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDelete>
      * <TOTEM:END>
           PERFORM Form1-DUMMY-DELETE
      * delete
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-note-cont-Rec-Delete
           IF Valid-STATUS-note-cont
              PERFORM Form1-CLEAR
              PERFORM Form1-DUMMY-DELETE-INIT
              MOVE "303" TO TOTEM-MSG-ID
              MOVE "00" to STATUS-note-cont
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterDelete>
      * <TOTEM:END>
           PERFORM Form1-ERR-CHECKING
           .

       Form1-NAVI-FOR-MASTERGRID.
           .

       Form1-ERR-CHECKING.
           IF Valid-STATUS-note-cont
              PERFORM Form1-SHOW-MSG-ROUTINE
           ELSE
              PERFORM Form1-Extended-File-Status
           END-IF
           .

       Form1-RESUMMARY-INS.
           .

       Form1-RESUMMARY-DEL.
           .


       Form1-DUMMY-FIRST.
           .

       Form1-DUMMY-PREVIOUS.
           .

       Form1-DUMMY-NEXT.
           .

       Form1-DUMMY-LAST.
           .

       Form1-DUMMY-CURR.
           .

       Form1-DUMMY-ADD.
           .

       Form1-DUMMY-UPDATE.
           .

       Form1-DUMMY-UPDATE-INIT.
           .

       Form1-DUMMY-DELETE.
           .

       Form1-DUMMY-DELETE-INIT.
           .

       Form1-Init-Value.
           MOVE titolo TO TOTEM-MSG-TITLE
      * FORM : Form1
           PERFORM DataSet1-INIT-RECORD
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, SetDefault>
      * <TOTEM:END>
           PERFORM Form1-FLD-TO-BUF
           .


       Form1-ALLGRID-RESET.
           .

      * for Form's Validation
       Form1-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       Form1-Buf-To-Fld.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterBufToFld>
      * <TOTEM:END>
           .

       Form1-Fld-To-Buf.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeFldToBuf>
           set SiSalvato to true.

           .
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterFldToBuf>
      * <TOTEM:END>
           .

       Form1-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform Form1-BUF-TO-FLD.
           move 0 to scelta.
           .
       Form1-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM Form1-SHOW-MSG-ROUTINE
           .

       Form1-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM Form1-DISPLAY-MESSAGE
           .

       Form1-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       Form1-Save-Status.
           MOVE DataSet1-note-cont-KEY1-ORDER TO TMP-Form1-KEY1-ORDER
           MOVE DataSet1-KEYIS TO TMP-Form1-KEYIS
           MOVE noco-rec OF note-cont TO 
              TMP-Form1-note-cont-RESTOREBUF
           .             

       Form1-Restore-Status.
           MOVE TMP-Form1-KEY1-ORDER TO DataSet1-note-cont-KEY1-ORDER
           MOVE TMP-Form1-KEYIS TO DataSet1-KEYIS
           MOVE TMP-Form1-note-cont-RESTOREBUF TO
              noco-rec OF note-cont
           PERFORM DataSet1-note-cont-START
           IF Valid-STATUS-note-cont
              PERFORM DataSet1-note-cont-Read-Next
           ELSE
              PERFORM DataSet1-note-cont-INITREC
           END-IF
           PERFORM UNTIL NOT Valid-STATUS-note-cont OR
              (Valid-STATUS-note-cont AND
                 noco-rec OF note-cont = 
                   TMP-Form1-note-cont-RESTOREBUF)
              PERFORM DataSet1-note-cont-Read-Next
           END-PERFORM
           .



       Form1-Event-Proc.
           .

       Form1-Gd-1-Event-Proc.
           EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
           WHEN Msg-Begin-Drag ALSO 1 ALSO
                    Form1-Handle 
              PERFORM form1-gd-1-Ev-Msg-Begin-Drag
           WHEN Msg-Begin-Entry ALSO 1 ALSO
                    Form1-Handle 
              PERFORM form1-gd-1-Ev-Msg-Begin-Entry
           WHEN Msg-End-Drag ALSO 1 ALSO
                    Form1-Handle 
              PERFORM form1-gd-1-Ev-Msg-End-Drag
           WHEN Msg-Finish-Entry ALSO 1 ALSO
                    Form1-Handle 
              PERFORM form1-gd-1-Ev-Msg-Finish-Entry
           WHEN Msg-Goto-Cell ALSO 1 ALSO
                    Form1-Handle 
              PERFORM form1-gd-1-Ev-Msg-Goto-Cell
           WHEN Msg-Goto-Cell-Drag ALSO 1 ALSO
                    Form1-Handle 
              PERFORM form1-gd-1-Ev-Msg-Goto-Cell-Drag
           WHEN Msg-Goto-Cell-Mouse ALSO 1 ALSO
                    Form1-Handle 
              PERFORM form1-gd-1-Ev-Msg-Goto-Cell-Mouse
           END-EVALUATE
           .

      * USER DEFINE PARAGRAPH
       ABILITAZIONI.
      * <TOTEM:PARA. ABILITAZIONI>
           if Linkmod = 1
              move BitmapDeleteEnabled to BitmapNumDelete
              move BitmapSaveEnabled   to BitmapNumSave
              move 1 to e-salva e-cancella
           else
              |SE SONO IN VISUA           
              move BitmapDeleteDisabled to BitmapNumDelete
              move BitmapSaveDisabled   to BitmapNumSave
              move ZERO to e-salva e-cancella
           end-if.

           if livello-abil = 2 
              move 0 to e-cancella
              move BitmapDeleteDisabled to BitmapNumDelete
           end-if.

           modify tool-cancella, enabled = e-cancella.
           modify tool-salva,    enabled = e-salva.
       
      * ISACCO (SERVE SEMPRE PER LA MODIFICA PRCEDENTE E PER RIPRISTINARE
      * LE BITMAP DISABILITATE. - 10/11/2003
      *     perform FORM1-DISPLAY.
           display tool-salva, tool-cancella, tool-modifica.
      * FINE.

           perform GRID-HELP.

           move LinkMod to mod.
           display tool-modifica 
           .
      * <TOTEM:END>

       AGGIORNA-NOTE-SU-CONTESTAZIONE.
      * <TOTEM:PARA. AGGIORNA-NOTE-SU-CONTESTAZIONE>
           close    contestazioni.
           open i-o contestazioni.
           move old-anno   to col-anno.
           move old-numero to col-numero.
           perform BLOCCA-CONTESTAZIONE.
           if tutto-ok
              if cnt-nota-anno-1 = LinkAnnoColleg and
                 cnt-nota-1      = LinkNumeroColleg
                 move 0 to cnt-nota-anno-1
                 move 0 to cnt-nota-1
              end-if
              if cnt-nota-anno-2 = LinkAnnoColleg and
                 cnt-nota-2      = LinkNumeroColleg
                 move 0 to cnt-nota-anno-2
                 move 0 to cnt-nota-2
              end-if
              if cnt-nota-anno-3 = LinkAnnoColleg and
                 cnt-nota-3      = LinkNumeroColleg
                 move 0 to cnt-nota-anno-3
                 move 0 to cnt-nota-3
              end-if
              if cnt-nota-anno-4 = LinkAnnoColleg and
                 cnt-nota-4      = LinkNumeroColleg
                 move 0 to cnt-nota-anno-4
                 move 0 to cnt-nota-4
              end-if
              if cnt-nota-anno-5 = LinkAnnoColleg and
                 cnt-nota-5      = LinkNumeroColleg
                 move 0 to cnt-nota-anno-5
                 move 0 to cnt-nota-5
              end-if
              rewrite cnt-rec invalid continue end-rewrite
           end-if.
           unlock     contestazioni all records.
           close      contestazioni.
           open input contestazioni 
           .
      * <TOTEM:END>

       ANTEPRIMA.
      * <TOTEM:PARA. ANTEPRIMA>
           set anteprima       to true.
      *     perform paragrafo-stampa 
           .
      * <TOTEM:END>

       BLOCCA-CONTESTAZIONE.
      * <TOTEM:PARA. BLOCCA-CONTESTAZIONE>
           move col-anno   to cnt-anno.
           move col-numero to cnt-numero.
           perform until 1 = 2
              set tutto-ok  to true
              set RecLocked to false
              read contestazioni lock invalid continue end-read
              if RecLocked
                 call   "geslock" using geslock-linkage
                 cancel "geslock"
                 evaluate true
                 when riprova continue
                 when ignora  exit perform
                 end-evaluate
              else
                 exit perform
              end-if
           end-perform 
           .
      * <TOTEM:END>

       CANCELLA.
      * <TOTEM:PARA. CANCELLA>
      *--->modifica (isacco)
           if mod = 0 exit paragraph end-if.
      *--->fine.                 

           display message box MSG-cancellare-il-record-corrente
                   title = titolo
                   type mb-yes-no
                   default mb-no
                   giving scelta.

           if scelta = mb-yes

              move LinkChiaveColleg to noco-chiave
              delete note-cont record invalid continue end-delete
              
              display message MSG-cancellazione-avvenuta-con-successo
                        title titolo

              move 27 to key-status
           end-if 

           .
      * <TOTEM:END>

       CERCA.
      * <TOTEM:PARA. CERCA>
           perform RIEMPI-TMP-NOTE.

           move LinkChiaveColleg to tno-chiave.
           read tnotacr no lock invalid continue end-read.
           move tno-cod-cli     to zoom-tor-cod-cli.
           move tno-prg-destino to zoom-tor-prg-destino.

           move "zoom-note-clidest"   to como-file.

           if trovato
              move path-zoom-tordini to ext-file
              call   "zoom-gt"   using como-file, zoom-tor-rec
                                giving stato-zoom

              cancel "zoom-gt"
           else
              move 1 to stato-zoom
           end-if.
           delete file zoom-tordini.

           if stato-zoom = 0
              set FromCerca to true
              move 2 to colonna
              move zoom-tor-anno   to col-anno    como-anno   cnt-anno
              move zoom-tor-numero to col-numero  como-numero cnt-numero
              perform CONTROLLO
              if tutto-ok
                 inquire form1-gd-1, cursor-y in riga
                 modify  form1-gd-1(riga, 1), cell-data col-anno
                 modify  form1-gd-1(riga, 2), cell-data col-numero
              end-if
              set FromCerca to false
           end-if.

      ***---
       RIEMPI-TMP-NOTE.
           call "W$MOUSE" using set-mouse-shape, wait-pointer.
           initialize path-zoom-tordini.
           accept  path-zoom-tordini      from environment "PATH_ST".
           accept  como-data              from century-date.
           accept  como-ora               from time.
           inspect path-zoom-tordini      replacing trailing
                                          spaces by low-value.
           string path-zoom-tordini       delimited by low-value
                  "zoom-tordini"          delimited by size
                  "_"                     delimited by size
                  como-data               delimited by size
                  "_"                     delimited by size
                  como-ora                delimited by size
                  into path-zoom-tordini
           end-string.

           set trovato to false.
           open output zoom-tordini.
           initialize cnt-rec.
           move LinkAnnoColleg to cnt-anno.

           start contestazioni key  is >= cnt-chiave
                 invalid continue 
             not invalid
                 perform until 1 = 2
                    read contestazioni next no lock 
                         at end exit perform 
                    end-read

                    if cnt-anno not = LinkAnnoColleg
                       exit perform
                    end-if

                    move cnt-anno        to zoom-tor-anno
                    move cnt-numero      to zoom-tor-numero
                    move cnt-data        to zoom-tor-data-ordine
                    evaluate true
                    when cnt-reso   move "RESO"   to zoom-tor-causale
                    when cnt-prezzo move "PREZZO" to zoom-tor-causale
                    when cnt-merce  move "MERCE"  to zoom-tor-causale
                    when cnt-altro  move "ALTRO"  to zoom-tor-causale
                    end-evaluate
                    move cnt-cod-cli        to zoom-tor-cod-cli
                                               cli-codice
                                               des-codice
                    set cli-tipo-C          to true
                    move cnt-prg-destino    to zoom-tor-prg-destino
                                               des-prog

                    read clienti no lock
                         invalid initialize cli-rec
                    end-read
                    move cli-ragsoc-1       to zoom-tor-cli-ragsoc-1

                    read destini no lock
                         invalid
                         initialize des-rec
                         move cli-localita to des-localita
                    end-read
                    move des-localita       to zoom-tor-des-localita

                    write zoom-tor-rec invalid continue end-write
                    set trovato to true

                 end-perform
           end-start.

           close zoom-tordini.

           call "W$MOUSE" using set-mouse-shape, arrow-pointer 
           .
      * <TOTEM:END>

       COLORE-RIGA.
      * <TOTEM:PARA. COLORE-RIGA>
           if riga < 2 
              move 2 to riga
           end-if.

           modify form1-gd-1, start-x = 1,    x = 14,
                              start-y = event-data-2, y = event-data-2,
                              region-color 257,
                              cursor-color 481 
           .
      * <TOTEM:END>

       CONTROLLA-SE-GIA-ASSOCIATA.
      * <TOTEM:PARA. CONTROLLA-SE-GIA-ASSOCIATA>
           set trovato to false.
           move 1 to idx.
           move 78-TotIdx to posti-liberi.
           perform 78-TotIdx times
              evaluate idx
              when 1 |Se ho già note associate...
                   if cnt-nota-anno-1 not = 0 and
                      cnt-nota-1      not = 0
                      set trovato to true
                      subtract 1 from posti-liberi
                      |...ma DIVERSE da quella in gestione
                      if cnt-nota-anno-1 = LinkAnnoColleg  and
                         cnt-nota-1      = LinkNumeroColleg
                         set trovato to false
                         exit perform
                      end-if
                   end-if 
              when 2 |Se ho già note associate...
                   if cnt-nota-anno-2 not = 0 and
                      cnt-nota-2      not = 0
                      set trovato to true
                      subtract 1 from posti-liberi
                      |...ma DIVERSE da quella in gestione
                      if cnt-nota-anno-2 = LinkAnnoColleg  and
                         cnt-nota-2      = LinkNumeroColleg
                         set trovato to false
                         exit perform
                      end-if
                   end-if
              when 3 |Se ho già note associate...
                   if cnt-nota-anno-3 not = 0 and
                      cnt-nota-3      not = 0
                      set trovato to true
                      subtract 1 from posti-liberi
                      |...ma DIVERSE da quella in gestione
                      if cnt-nota-anno-3 = LinkAnnoColleg  and
                         cnt-nota-3      = LinkNumeroColleg
                         set trovato to false
                         exit perform
                      end-if
                   end-if
              when 4 |Se ho già note associate...
                   if cnt-nota-anno-4 not = 0 and
                      cnt-nota-4      not = 0
                      set trovato to true
                      subtract 1 from posti-liberi
                      |...ma DIVERSE da quella in gestione
                      if cnt-nota-anno-4 = LinkAnnoColleg  and
                         cnt-nota-4      = LinkNumeroColleg
                         set trovato to false
                         exit perform
                      end-if
                   end-if
              when 5 |Se ho già note associate...
                   if cnt-nota-anno-5 not = 0 and
                      cnt-nota-5      not = 0
                      set trovato to true
                      subtract 1 from posti-liberi
                      |...ma DIVERSE da quella in gestione
                      if cnt-nota-anno-5 = LinkAnnoColleg  and
                         cnt-nota-5      = LinkNumeroColleg
                         set trovato to false
                         exit perform
                      end-if
                   end-if
              end-evaluate
              add 1 to idx
           end-perform.
              
           set hid-aggiungi to false.
           if trovato
              if posti-liberi = 0
                 display message "Raggiunto limite associazioni per ques
      -    "ta contestazione"
                           title tit-err
                            icon 2
                 set errori to true
              else     
                 set hid-aggiungi to true
                 display message"Contestazione già associata ad altre no
      -    "te"
                         x"0d0A""Confermi?"
                           title titolo
                            icon 2
                            type mb-yes-no
                         default mb-no
                          giving scelta
                 if scelta = mb-no
                    set errori to true
                 end-if
              end-if
           else
              if posti-liberi = 5
                 set hid-aggiungi to true
              end-if 
           end-if 
           .
      * <TOTEM:END>

       CONTROLLA-SE-GIA-PRESENTE.
      * <TOTEM:PARA. CONTROLLA-SE-GIA-PRESENTE>
           perform varying store-riga from 2 by 1
                     until store-riga > (78-TotIdx + 1)
              inquire form1-gd-1(store-riga, 1), cell-data in check-anno
              inquire form1-gd-1(store-riga, 2), cell-data in 
           check-numero
              if check-anno   = como-anno   and
                 check-numero = como-numero and
                 store-riga not = riga
                 set errori to true
                 display message "Contestazione già inserita"
                           title tit-err
                            icon 2
                 exit perform
              end-if
           end-perform 
           .
      * <TOTEM:END>

       CONTROLLO.
      * <TOTEM:PARA. CONTROLLO>
           set tutto-ok to true.

           |SE VENGO DALLO ZOOM LE COLONNE SONO GIA' VALORIZZATE
           |MA NON DEVONO ANCORA ESSERE MESSE IN GRIGLIA
           if not FromCerca
              inquire form1-gd-1, cursor-y in riga
              perform VALORE-RIGA
           end-if.
      
           evaluate colonna
           when 1
                if como-anno = 0
                   if como-numero not = 0
                      display message "Cancellare l'associazione corrent
      -    "e?"
                               title titolo
                                type mb-yes-no
                                icon 2
                             default mb-no
                              giving scelta
                      if scelta = mb-no
                         set errori to true
                      else

                         modify form1-gd-1, record-to-delete = riga
                         modify form1-gd-1, 
                                insertion-index = riga, 
                                insert-rows     = 1

                         perform AGGIORNA-NOTE-SU-CONTESTAZIONE
                         perform SALVA
                      end-if
                   end-if
                end-if
           when 2
                move como-anno   to cnt-anno
                move como-numero to cnt-numero
                read contestazioni no lock 
                     invalid
                     set errori to true
                     display message "Contestazione inesistente"
                               title tit-err
                              icon 2
                 not invalid
                     perform CONTROLLA-SE-GIA-PRESENTE
                     if tutto-ok
                        perform CONTROLLA-SE-GIA-ASSOCIATA
                     end-if
                     if tutto-ok
                        perform VALORIZZA-CELLE-CONTESTAZIONE
                        modify form1-gd-1(riga, 3),  cell-data = 
           col-data     
                        modify form1-gd-1(riga, 4),  cell-data = 
           col-cliente  
                        modify form1-gd-1(riga, 5),  cell-data = 
           col-localita 
                        modify form1-gd-1(riga, 6),  cell-data = 
           col-num-fatt 
                        modify form1-gd-1(riga, 7),  cell-data = 
           col-data-fatt
                        modify form1-gd-1(riga, 8),  cell-data = 
           col-num-nota 
                        modify form1-gd-1(riga, 9),  cell-data = 
           col-data-nota
                        modify form1-gd-1(riga, 10), cell-data = 
           col-nota-1   
                        modify form1-gd-1(riga, 11), cell-data = 
           col-nota-2   
                        modify form1-gd-1(riga, 12), cell-data = 
           col-nota-3   
                        modify form1-gd-1(riga, 13), cell-data = 
           col-nota-4   
                        modify form1-gd-1(riga, 14), cell-data = 
           col-nota-5   
                        modify form1-gd-1(riga, 14), hidden-data = 
           hid-da-aggiungere
                     end-if
                end-read
           end-evaluate.
      
           if errori
              modify form1-gd-1, cursor-y = riga, cursor-x = colonna
              move riga    to event-data-2
              move colonna to event-data-1
           end-if 
           .
      * <TOTEM:END>

       GRID-HELP.
      * <TOTEM:PARA. GRID-HELP>
      * NON CI SONO ZOOM SULLE COLONNE 
      * QUINDI NON SERVE L'EVALUATE DELLA COLONNA. MA IL BOTTONE CERCA
      * SARA' SEMPRE DISABILITATO
           move BitmapZoomDisabled to BitmapNumZoom.
           move 0 to e-cerca.

           if event-data-1 <= 2 and mod = 1
              move BitmapZoomEnabled to BitmapNumZoom
              move 1 to e-cerca
           end-if.

           modify tool-cerca, bitmap-number = BitmapNumZoom,
                              enabled       = e-cerca 
           .
      * <TOTEM:END>

       INIT.
      * <TOTEM:PARA. INIT>
           set vecchio  to true.
           set tutto-ok to true 
           .
      * <TOTEM:END>

       LOAD-RECORD.
      * <TOTEM:PARA. LOAD-RECORD>
           modify form1-gd-1, mass-update = 1.
           move LinkChiaveColleg to noco-chiave.
           if LinkMod = 1
              perform until 1 = 2
                 set tutto-ok  to true
                 set RecLocked to false
                 read note-cont    lock invalid continue end-read
                 if RecLocked
                    call   "geslock" using geslock-linkage
                    cancel "geslock"
                    evaluate true
                    when riprova continue
                    when termina set errori to true
                                 exit perform
                    end-evaluate
                 else
                    exit perform
                 end-if
              end-perform
           else
              read note-cont no lock invalid continue end-read
              set tutto-ok to true
           end-if.

           if tutto-ok
              perform RIEMPI-GRID
              move noco-rec to old-noco-rec
           else
              move 27 to key-status
           end-if.

            
      ***---
       RIEMPI-GRID.
           modify form1-gd-1, reset-grid = 1.
           perform FORM1-GD-1-CONTENT.
           perform varying idx from 1 by 1 
                     until idx > 78-TotIdx
              initialize rec-grid replacing numeric data by zeroes
                                       alphanumeric data by spaces
              move noco-anno-cont(idx)  to col-anno   cnt-anno 
              move noco-numero-cont(idx)to col-numero cnt-numero
              move spaces to col-data
              move spaces to col-data-fatt
              move spaces to col-data-nota
              read contestazioni no lock 
                   invalid continue 
               not invalid perform VALORIZZA-CELLE-CONTESTAZIONE
                           modify form1-gd-1, record-to-add = rec-grid
              end-read
           end-perform.
           modify form1-gd-1, mass-update = 0 
           .
      * <TOTEM:END>

       PARAGRAFO-COPY.
      * <TOTEM:PARA. PARAGRAFO-COPY>
           copy "abilita-toolbar.cpy".
           copy "color-custom.cpy".   
           copy "utydata.cpy" 
           .
      * <TOTEM:END>

       SALV-MOD.
      * <TOTEM:PARA. SALV-MOD>
           initialize noco-contestazioni
                      replacing numeric data by zeroes
                           alphanumeric data by spaces.
           perform varying idx from 1 by 1 
                     until idx > 78-TotIdx
              add 1 to idx giving riga
              perform VALORE-RIGA
              if como-anno   not = 0 and
                 como-numero not = 0
                 move como-anno   to noco-anno-cont(idx)
                 move como-numero to noco-numero-cont(idx)
              else
                 if como-anno   = 0 and
                    como-numero = 0
                    move como-anno   to noco-anno-cont(idx)
                    move como-numero to noco-numero-cont(idx)
                 else
                    move old-noco-anno-cont(idx)   to 
           noco-anno-cont(idx)
                    move old-noco-numero-cont(idx) to 
           noco-numero-cont(idx)
                 end-if
              end-if
           end-perform.

           if noco-rec not = old-noco-rec
              set NoSalvato to true
           else
              set SiSalvato to true
           end-if.
      
           set tutto-ok to true.
           if NoSalvato
              display message MSG-Salvare-le-modifiche 
                        title titolo
                         type mb-yes-no-cancel
                       giving scelta
      
              evaluate scelta
              when mb-yes    perform SALVA
              when mb-cancel set errori    to true
              when mb-no     set tutto-ok  to true
                             set SiSalvato to true
              end-evaluate
      
           end-if 
           .
      * <TOTEM:END>

       SALVA.
      * <TOTEM:PARA. SALVA>
           if mod = 0 exit paragraph end-if.

           move LinkChiaveColleg to noco-chiave.
           initialize noco-contestazioni
                      replacing numeric data by zeroes
                           alphanumeric data by spaces.
           move 0 to idx.
           perform varying riga from 2 by 1
                     until riga > ( 78-TotIdx + 1 )
              perform VALORE-RIGA
              if como-anno   not = 0 and
                 como-numero not = 0
                 add 1 to idx
                 move col-anno   to noco-anno-cont(idx)
                 move col-numero to noco-numero-cont(idx)
              end-if
           end-perform.
           if noco-data-creazione = 0
              accept noco-data-creazione from century-date
              accept noco-ora-creazione  from time
              move LinkUser to noco-utente-creazione
           else
              accept noco-data-modifica from century-date
              accept noco-ora-modifica  from time
              move LinkUser to noco-utente-modifica
           end-if.
           write noco-rec invalid rewrite noco-rec end-write.
           modify form1-gd-1, mass-update = 0.

           move noco-rec to old-noco-rec.

           close contestazioni.
           open i-o contestazioni.
           perform varying riga from 2 by 1
                     until riga > ( 78-TotIdx + 1 )
              perform VALORE-RIGA
              inquire form1-gd-1(riga, 14), hidden-data 
           hid-da-aggiungere
              if hid-aggiungi
                 if como-anno   not = 0 and
                    como-numero not = 0
                    perform BLOCCA-CONTESTAZIONE
                    if tutto-ok
                       move 1 to idx
                       perform 78-TotIdx times
                          evaluate idx
                          when 1
                               if cnt-nota-anno-1 = 0 and
                                  cnt-nota-1      = 0
                                  move LinkAnnoColleg   to 
           cnt-nota-anno-1
                                  move LinkNumeroColleg to cnt-nota-1
                                  exit perform
                               end-if
                          when 2
                               if cnt-nota-anno-2 = 0 and
                                  cnt-nota-2      = 0
                                  move LinkAnnoColleg   to 
           cnt-nota-anno-2
                                  move LinkNumeroColleg to cnt-nota-2
                                  exit perform
                               end-if
                          when 3
                               if cnt-nota-anno-3 = 0 and
                                  cnt-nota-3      = 0
                                  move LinkAnnoColleg   to 
           cnt-nota-anno-3
                                  move LinkNumeroColleg to cnt-nota-3
                                  exit perform
                               end-if
                          when 4
                               if cnt-nota-anno-4 = 0 and
                                  cnt-nota-4      = 0
                                  move LinkAnnoColleg   to 
           cnt-nota-anno-4
                                  move LinkNumeroColleg to cnt-nota-4
                                  exit perform
                               end-if
                          when 5
                               if cnt-nota-anno-5 = 0 and
                                  cnt-nota-5      = 0
                                  move LinkAnnoColleg   to 
           cnt-nota-anno-5
                                  move LinkNumeroColleg to cnt-nota-5
                                  exit perform
                               end-if
                          end-evaluate
                          add 1 to idx
                       end-perform
                       rewrite cnt-rec invalid continue end-rewrite
                    end-if
                 end-if
              end-if
           end-perform.
           close contestazioni.
           unlock contestazioni all records.
           open input contestazioni.
           perform RIEMPI-GRID.
           move 2 to event-data-2 riga.
           perform COLORE-RIGA 
           .
      * <TOTEM:END>

       SPOSTAMENTO.
      * <TOTEM:PARA. SPOSTAMENTO>
           set tutto-ok to true.
           inquire form1-gd-1, cursor-x = colonna, cursor-y = riga.

           if event-data-2 < 2 move 2 to event-data-2 end-if.
      
           if event-data-2 not = riga
              perform VALORE-RIGA
              if como-numero = 0 and como-anno not = 0
                 set errori to true
                 move 2 to colonna
              end-if
              if errori
                 move riga    to event-data-2
                 move colonna to event-data-1
                 set event-action to event-action-fail
                 modify form1-gd-1, cursor-x = colonna
              end-if
           end-if.

           if tutto-ok
              move event-data-2 to riga
              perform VALORE-RIGA
              move col-anno   to old-anno
              move col-numero to old-numero
              perform COLORE-RIGA
           end-if.

           perform GRID-HELP 
           .
      * <TOTEM:END>

       STAMPA.
      * <TOTEM:PARA. STAMPA>
           set stampa       to true.
      *     perform paragrafo-stampa 
           .
      * <TOTEM:END>

       VALORE-RIGA.
      * <TOTEM:PARA. VALORE-RIGA>
           inquire form1-gd-1(riga, 1), cell-data col-anno.
           inquire form1-gd-1(riga, 2), cell-data col-numero.

           move col-anno   to como-anno.
           move col-numero to como-numero 
           .
      * <TOTEM:END>

       VALORIZZA-CELLE-CONTESTAZIONE.
      * <TOTEM:PARA. VALORIZZA-CELLE-CONTESTAZIONE>
           move cnt-data to como-data.
           perform DATE-TO-SCREEN.
           move como-data   to col-data.
           set cli-tipo-C   to true.
           move cnt-cod-cli to cli-codice.
           read clienti no lock invalid continue end-read.
           move cli-ragsoc-1 to col-cliente.
           if cnt-prg-destino = 0
              move cli-localita to col-localita
           else
              move cnt-cod-cli to des-codice
              move cnt-prg-destino to des-prog
              read destini no lock invalid continue end-read
              move des-localita to col-localita
           end-if.
           move 0 to col-num-fatt col-data-fatt 
                     col-num-nota col-data-nota.
           if cnt-num-fatt not = 0
              move cnt-num-fatt to col-num-fatt
           end-if.
           if cnt-data-fatt not = 0
              move cnt-data-fatt to col-data-fatt
              perform DATE-TO-SCREEN
              move como-data to col-data-fatt
           end-if.
           if cnt-num-nota not = 0
              move cnt-num-nota to col-num-nota
           end-if.
           if cnt-data-nota not = 0
              move cnt-data-nota to como-data
              perform DATE-TO-SCREEN
              move como-data to col-data-nota
           end-if.
           if cnt-nota-anno-1 not = 0 or
              cnt-nota-1      not = 0
              move cnt-nota-1 to nota-x
              call "C$JUSTIFY" using nota-x ,"L"
              inspect nota-x replacing leading x"30" by x"20"
              call "C$JUSTIFY" using nota-x ,"L"
              string cnt-nota-anno-1 delimited size
                     " - "           delimited size
                     nota-x          delimited size
                     into col-nota-1
              end-string
           end-if.
           if cnt-nota-anno-2 not = 0 or
              cnt-nota-2      not = 0
              move cnt-nota-2 to nota-x
              call "C$JUSTIFY" using nota-x ,"L"
              inspect nota-x replacing leading x"30" by x"20"
              call "C$JUSTIFY" using nota-x ,"L"
              string cnt-nota-anno-2 delimited size
                     " - "           delimited size
                     nota-x          delimited size
                     into col-nota-2
              end-string
           end-if.
           if cnt-nota-anno-3 not = 0 or              
              cnt-nota-3      not = 0
              move cnt-nota-3 to nota-x
              call "C$JUSTIFY" using nota-x ,"L"
              inspect nota-x replacing leading x"30" by x"20"
              call "C$JUSTIFY" using nota-x ,"L"
              string cnt-nota-anno-3 delimited size
                     " - "           delimited size
                     nota-x          delimited size
                     into col-nota-3
              end-string
           end-if.
           if cnt-nota-anno-4 not = 0 or
              cnt-nota-4      not = 0
              move cnt-nota-4 to nota-x
              call "C$JUSTIFY" using nota-x ,"L"
              inspect nota-x replacing leading x"30" by x"20"
              call "C$JUSTIFY" using nota-x ,"L"
              string cnt-nota-anno-4 delimited size
                     " - "           delimited size
                     nota-x          delimited size
                     into col-nota-4
              end-string
           end-if.
           if cnt-nota-anno-5 not = 0 or
              cnt-nota-5      not = 0
              move cnt-nota-5 to nota-x
              call "C$JUSTIFY" using nota-x ,"L"
              inspect nota-x replacing leading x"30" by x"20"
              call "C$JUSTIFY" using nota-x ,"L"
              string cnt-nota-anno-5 delimited size
                     " - "           delimited size
                     nota-x          delimited size
                     into col-nota-5
              end-string
           end-if 
           .
      * <TOTEM:END>

      * EVENT PARAGRAPH
       CANCELLA-LinkTo.
      * <TOTEM:PARA. CANCELLA-LinkTo>
           inquire tool-cancella, enabled in e-cancella.
           if e-cancella = 1
              perform CANCELLA
           end-if 
           .
      * <TOTEM:END>
       TOOL-SALVA-LinkTo.
      * <TOTEM:PARA. TOOL-SALVA-LinkTo>
           inquire tool-salva, enabled in e-salva.
           if e-salva = 1
              perform salva
           end-if 
           .
      * <TOTEM:END>
       ANTEPRIMA-LinkTo.
      * <TOTEM:PARA. ANTEPRIMA-LinkTo>
           inquire tool-anteprima, enabled in e-anteprima.
           if e-anteprima = 1
              perform ANTEPRIMA
           end-if 
           .
      * <TOTEM:END>
       STAMPA-LinkTo.
      * <TOTEM:PARA. STAMPA-LinkTo>
           inquire tool-stampa, enabled in e-stampa
           if e-stampa = 1
              perform STAMPA
           end-if 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-Finish-Entry.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-Finish-Entry>
           inquire form1-gd-1, cursor-y in riga.
           perform VALORE-RIGA.

           perform  CONTROLLO.

           if errori 
              set event-action to event-action-fail 
           end-if 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-Begin-Entry.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-Begin-Entry>
           inquire form1-gd-1, cursor-x = colonna,
                               cursor-y in riga.
                         
           perform VALORE-RIGA.

           if mod = 0 or colonna > 2
              set event-action to event-action-fail
           else
              if colonna = 2
                 if como-anno = 0
                    set event-action to event-action-fail
                 end-if
              end-if
           end-if 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-End-Drag.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-End-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-Goto-Cell.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-Goto-Cell>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-Goto-Cell-Drag.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-Goto-Cell-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-Goto-Cell-Mouse.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-Goto-Cell-Mouse>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-Begin-Drag.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-Begin-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       TOOL-CERCA-LinkTo.
      * <TOTEM:PARA. TOOL-CERCA-LinkTo>
           inquire tool-cerca, enabled in e-cerca.
           if e-cerca = 1
              perform CERCA
           end-if 
           .
      * <TOTEM:END>
       TOOL-MODIFICA-BeforeProcedure.
      * <TOTEM:PARA. TOOL-MODIFICA-BeforeProcedure>
           .
      * <TOTEM:END>
       TOOL-MODIFICA-AfterProcedure.
      * <TOTEM:PARA. TOOL-MODIFICA-AfterProcedure>
           .
      * <TOTEM:END>

      *{TOTEM}END

      *{TOTEM}SHOW-MSG
       MESSAGE-FOR-FILEERROR.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
              MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           .

       SHOW-TRANSACTION-ROUTINE.
           IF TOTEM-TRANSACTION-FLAG = SPACES
              IF TRANSACTION-STATUS NOT = 0
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-1
              END-IF
           ELSE
              PERFORM SHOW-MSG-ROUTINE
              IF TRANSACTION-STATUS = 0
                 MOVE "Transazione terminata con Rollback." TO 
           TOTEM-MSG-3
              ELSE
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-3
              END-IF
           END-IF
           .

       SHOW-MSG-ROUTINE.
           MOVE SPACE TO TOTEM-MSG-1 TOTEM-MSG-2 TOTEM-MSG-3
           EVALUATE TOTEM-MSG-ID
               WHEN "10"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Nessun altro dato." TO TOTEM-MSG-2
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "22"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Chiave Duplicata." TO TOTEM-MSG-2
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "23"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Raggiunta fine file." TO TOTEM-MSG-2
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "101"
                    MOVE "Terminare l'applicazione?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "201"
                    MOVE "Aggiungere un nuovo record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "202"
                    MOVE "Aggiornare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "203"
                    MOVE "Cancellare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "204"
                    MOVE "Chiave duplicata." TO TOTEM-MSG-1
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "301"
                    MOVE "Inserimento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "302"
                    MOVE "Aggiornamento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "303"
                    MOVE "Cancellazione avvenuta con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "401"
                    MOVE "Shell non trovata." TO TOTEM-MSG-1
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN OTHER
                    MOVE TEXT-MESSAGE TO TOTEM-MSG-1
                    STRING "FILE:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-3
                    MOVE 0 TO TOTEM-IDX1
                    INSPECT TOTEM-MSG-3 TALLYING TOTEM-IDX1
                       FOR TRAILING SPACE
                    STRING TOTEM-MSG-3(1:TOTEM-MSG-LENGTH - 
           TOTEM-IDX1), 
                       ", FILE STATUS ", PRIMARY-ERROR "," 
                       SECONDARY-ERROR
                    DELIMITED BY SIZE INTO TOTEM-MSG-2
                    MOVE SPACES TO TOTEM-MSG-3
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
           END-EVALUATE
           PERFORM MESSAGE-BOX-ROUTINE
           .

       MESSAGE-BOX-ROUTINE.
           MOVE 1 TO TOTEM-MSG-TEXT-POINTER
           IF TOTEM-MSG-1 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-1 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              STRING TOTEM-MSG-1( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                 DELIMITED BY SIZE
                 INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-2 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-2 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-2( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-3 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-3 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-3( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-TEXT-POINTER = 1
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-TEXT TALLYING TOTEM-MSG-SIZE FOR 
           TRAILING SPACE
                  COMPUTE TOTEM-MSG-TEXT-POINTER = 
           TOTEM-MSG-FULL-LENGTH - TOTEM-MSG-SIZE + 1
           END-IF
           MOVE LOW-VALUES TO TOTEM-MSG-TEXT(TOTEM-MSG-TEXT-POINTER : 1 
           )
           .

       MESSAGE-BOX-DISPLAY.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

      *{TOTEM}END

