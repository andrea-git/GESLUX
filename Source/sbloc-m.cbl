      *{TOTEM}PRG-COMMENT
      * sbloc-m.Cbl
      * sbloc-m.Cbl is generated by TOTEM
      * This is a generated file. DO NOT modify this file directly.
      *{TOTEM}END
       IDENTIFICATION       DIVISION.
      *{TOTEM}PRGID
       PROGRAM-ID.          sbloc-m.
       AUTHOR.              ANDREA EVENTI.
       DATE-WRITTEN.        venerdì 12 dicembre 2014 09:58:32.
       REMARKS.
      *{TOTEM}END

       ENVIRONMENT          DIVISION.
       CONFIGURATION        SECTION.
       SPECIAL-NAMES.
      *{TOTEM}SPECIAL-NAME
      * <TOTEM:EPT. INIT:sbloc-m, INIT:sbloc-m, SpecialName>
      * <TOTEM:END>
      *{TOTEM}END
      *{TOTEM}ACTIVEX-DEF
      *{TOTEM}END
      *{TOTEM}DECIMAL-POINT
           DECIMAL-POINT IS COMMA.
      *{TOTEM}END

       INPUT-OUTPUT         SECTION.
       FILE-CONTROL.
      *{TOTEM}FILE-CONTROL
           COPY "clienti.sl".
           COPY "destini.sl".
           COPY "tcaumag.sl".
           COPY "articoli.sl".
           COPY "tmarche.sl".
           COPY "progmag.sl".
           COPY "ttipocli.sl".
           COPY "tpiombo.sl".
           COPY "mtordini.sl".
           COPY "mrordini.sl".
           COPY "tparamge.sl".
           COPY "rordini.sl".
           COPY "tordini.sl".
           COPY "param.sl".
      *{TOTEM}END
       DATA                 DIVISION.
       FILE                 SECTION.
      *{TOTEM}FILE
           COPY "clienti.fd".
           COPY "destini.fd".
           COPY "tcaumag.fd".
           COPY "articoli.fd".
           COPY "tmarche.fd".
           COPY "progmag.fd".
           COPY "ttipocli.fd".
           COPY "tpiombo.fd".
           COPY "mtordini.fd".
           COPY "mrordini.fd".
           COPY "tparamge.fd".
           COPY "rordini.fd".
           COPY "tordini.fd".
           COPY "param.fd".
      *{TOTEM}END

       WORKING-STORAGE      SECTION.
      *{TOTEM}ACU-DEF
               COPY "acugui.def".
               COPY "acucobol.def".
               COPY "fonts.def".
               COPY "crtvars.def".
               COPY "showmsg.def".
               COPY "totem.def".
               COPY "F:\lubex\geslux\Copylib\standard.def".
      *{TOTEM}END

      *{TOTEM}COPY-WORKING
      * Key Status
       77 Key-Status IS SPECIAL-NAMES CRT STATUS PIC 9(5) VALUE 0.
          88 Enter-Pushed VALUE 13.
          88 Exit-Pushed VALUE 27.
          88 Message-Received VALUE 95.
          88 Event-Occurred VALUE 96.
          88 Screen-No-Input-Field VALUE 97.
          88 Screen-Time-Out VALUE 99.
      * Properties & User defined Working Stoarge
       78 titolo VALUE IS "Geslux - Sbloccaggio Ordini". 
           COPY  "IMPOSTE.DEF".
           COPY  "LINK-GESLOCK.DEF".
           COPY  "TROVA-PARAMETRO.DEF".
       77 conferma-bmp
                  USAGE IS HANDLE OF BITMAP.
       77 STATUS-clienti   PIC  X(2).
           88 Valid-STATUS-clienti VALUE IS "00" THRU "09". 
       77 STATUS-destini   PIC  X(2).
           88 Valid-STATUS-destini VALUE IS "00" THRU "09". 
       77 STATUS-tordini   PIC  X(2).
           88 Valid-STATUS-tordini VALUE IS "00" THRU "09". 
       77 iva-omaggio      PIC  x(3).
       77 como-cons        PIC  9(6)v99.
       77 como-cou         PIC  9(6)v99.
       77 como-imp         PIC  9(6)v99.
       77 como-add         PIC  9(6)v99.
       01 hidden-dati.
           05 hid-peso-utf     PIC  9(4)v999.
           05 HiddenKey.
               10 hid-anno         PIC  9(4).
               10 hid-numero       PIC  9(8).
               10 hid-num-riga     PIC  9(5).
           05 hid-prezzo       PIC  9(6)v99.
           05 hid-bloccato     PIC  x.
               88 hid-si-bloccato VALUE IS "S". 
               88 hid-no-bloccato VALUE IS "N". 
       77 como-prezzo      PIC  9(6)v99.
       01 FILLER           PIC  9.
           88 sblocca-ordine VALUE IS 1    WHEN SET TO FALSE  0. 
       77 RigaCambiata     PIC  9(3).
       77 Form1-Tb-1-Handle
                  USAGE IS HANDLE OF WINDOW.
       01 LinkChiave.
           05 LinkAnno         PIC  9(4).
           05 linkNumero       PIC  9(8).
       01 LinkRicaricaGrid PIC  9.
           88 RicaricaGrid VALUE IS 1    WHEN SET TO FALSE  0. 
       77 toolbar-bmp      PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 imballi-ed       PIC  z(4).
       77 E-ESCI           PIC  9
                  VALUE IS 1.
       77 E-NUOVO          PIC  9
                  VALUE IS 1.
       77 save-riga        PIC  9(9).
       77 E-CANCELLA       PIC  9
                  VALUE IS 1.
       01 rec-grid.
           05 col-num          PIC  z(5).
           05 col-art          PIC  zzzzz9.
           05 col-des          PIC  x(50).
           05 col-qta          PIC  z(7)9.
           05 col-uni          PIC  zzz.zzz.zz9,99.
           05 col-sconto       PIC  z9,99.
           05 col-cons         PIC  z.zz9,99.
           05 col-cou          PIC  z.zz9,99.
           05 col-add          PIC  z.zz9,99.
           05 col-imp          PIC  zzz.zzz.zz9,99.
           05 col-iva          PIC  x(3).
           05 col-oma          PIC  x.
       77 FILLER           PIC  9.
           88 CallManutenzione VALUE IS 1    WHEN SET TO FALSE  0. 
       77 E-SALVA          PIC  9
                  VALUE IS 1.
       77 E-ANTEPRIMA      PIC  9
                  VALUE IS 0.
       77 E-MODIFICA       PIC  9
                  VALUE IS 1.
       77 E-STAMPA         PIC  9
                  VALUE IS 0.
       77 E-CERCA          PIC  9
                  VALUE IS 0.
       77 E-SELEZIONA      PIC  9
                  VALUE IS 1.
       77 Small-Font
                  USAGE IS HANDLE OF FONT SMALL-FONT.
       77 Default-Font
                  USAGE IS HANDLE OF FONT DEFAULT-FONT.
       77 Form1-St-1-Handle
                  USAGE IS HANDLE OF STATUS-BAR.
       77 form1-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 mod-fis          PIC  9
                  VALUE IS 1.
       77 AUTO-ID          PIC  9(6)
                  VALUE IS 0.
       77 TIPO-ELAB        PIC  9
                  VALUE IS 0.
       77 MOD-LIMITI       PIC  9
                  VALUE IS 1.
       77 ok_73x21-bmp     PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 cancel_73x21-bmp PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 BLUE-FINO-28X24-BMP          PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 BLUE-DA-28X24-BMP            PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 CBO-stato-ord-BUF            PIC  X(50).
       77 ANNO-TO          PIC  9(04).
       77 ordine-FROM      PIC  9(08).
       77 ordine-TO        PIC  9(08).
       77 data-FROM        PIC  9(08).
       77 CLIENTE-FROM     PIC  9(05).
       77 CLIENTE-TO       PIC  9(05).
       77 data-TO          PIC  9(08).
       77 data-to-AAAAMMGG PIC  9(8).
       77 data-from-AAAAMMGG           PIC  9(8).
       77 form2-Handle
                  USAGE IS HANDLE OF WINDOW.
       01 FILLER           PIC  x.
           88 controllo-finale VALUE IS "F"    WHEN SET TO FALSE  "N". 
       01 Gd-ordini-Record.
           05 col-nulla        PIC  X.
           05 Col-anno         PIC  9(4).
           05 Col-numero       PIC  z(7)9.
           05 Col-data         PIC  x(10).
           05 Col-cliente      PIC  z(4)9.
           05 Col-rag-soc-cli  PIC  X(40).
           05 Col-rag-soc-destini          PIC  X(40).
           05 Col-indirizzo    PIC  X(40).
           05 Col-localita     PIC  X(35).
       01 FILLER           PIC  x.
           88 record-ok VALUE IS "O"    WHEN SET TO FALSE  "k". 
       01 tipo-record      PIC  x.
           88 r-inevaso VALUE IS "I". 
           88 r-emessa-bolla VALUE IS "E". 
           88 r-fatturato VALUE IS "F". 
       78 78-colore-inevaso VALUE IS 513. 
       78 78-colore-emessa-bolla VALUE IS 464. 
       78 78-colore-fatturato VALUE IS 400. 
       77 como-colore      PIC  9(5).
       77 Verdana10B-Occidentale
                  USAGE IS HANDLE OF FONT DEFAULT-FONT.
       77 como-x           PIC  x.
       01 como-chiave-ordine.
           05 como-anno        PIC  9(4).
           05 como-numero-ordine           PIC  9(8).
       77 Form3-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 Verdana12BI-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 font-evidenzia-griglia
                  USAGE IS HANDLE OF FONT.
       77 Arial11B-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 Arial11BI-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 Screen1-St-1-Handle
                  USAGE IS HANDLE OF STATUS-BAR.
       77 tit-stato-ordine PIC  X(20).
       77 col-stato-ordine PIC  9(6)
                  VALUE IS 0.
       77 elemento-bmp     PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS ZERO.
       77 como-riga
                  USAGE IS UNSIGNED-INT.
       77 bottone-ok-bmp   PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 bottone-cancel-bmp           PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 Verdana12-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 STATUS-tparamge  PIC  X(2).
           88 Valid-STATUS-tparamge VALUE IS "00" THRU "09". 
       77 lab-cli-buf      PIC  X(50)
                  VALUE IS "<< HELP >> 0 = TUTTI I CLIENTI".
       77 Form1-Tb-1-Handlea
                  USAGE IS HANDLE OF WINDOW.
       77 Screen2-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 data-stampa      PIC  99/99/9999
                  VALUE IS "99/99/9999".
       77 ORA-STAMPA       PIC  X(5)
                  VALUE IS "99:99".
       77 vett-iniz        PIC  X(2)
                  VALUE IS "xx".
       77 tot-colli        PIC  9(10).
       77 tot-peso         PIC  9(9)v999.
       77 tot-non-utf      PIC  9(9)v999.
       77 tot-utf          PIC  9(9)v999.
       77 STATUS-tvettori  PIC  X(2).
           88 Valid-STATUS-tvettori VALUE IS "00" THRU "09". 
       77 STATUS-tcaumag   PIC  X(2).
           88 Valid-STATUS-tcaumag VALUE IS "00" THRU "09". 
       77 STATUS-rordini   PIC  X(2).
           88 Valid-STATUS-rordini VALUE IS "00" THRU "09". 
       77 STATUS-articoli  PIC  X(2).
           88 Valid-STATUS-articoli VALUE IS "00" THRU "09". 
       77 MS-Sans-Serif9B-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 Form1-Pg-1-Visible           PIC  9
                  VALUE IS 0.
       77 mod-campi        PIC  9
                  VALUE IS 1.
       77 cbo-stato-buf    PIC  X(10).
       77 e-man            PIC  9
                  VALUE IS 1.
       77 e-gui            PIC  9
                  VALUE IS 1.
       77 v-bolla          PIC  9
                  VALUE IS 1.
       77 age-ragsoc-1     PIC  X(40).
       77 lab-pag-buf      PIC  X(100).
       77 lab-iva-buf      PIC  x(100).
       77 Form1-Pg-2-Visible           PIC  9
                  VALUE IS 0.
       77 v-manuale        PIC  9
                  VALUE IS 1.
       77 STRIP_GRID_GCLIENTI-BMP      PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 v-guidata        PIC  9
                  VALUE IS 1.
       77 label-cou-cobat  PIC  x(25)
                  VALUE IS "C.O.U./COBAT".
       77 Colorgiacenza    PIC  9(6)
                  VALUE IS 0.
       77 ColorImpegnato   PIC  9(6)
                  VALUE IS 0.
       77 ColorOrdinato    PIC  9(6)
                  VALUE IS 0.
       77 giacenza-ed      PIC  ---.---.--9.
       77 impegnato-ed     PIC  ---.---.--9.
       77 ordinato-ed      PIC  ---.---.--9.
       77 lab-iva-2-buf    PIC  X(100).
       77 lab-tot-ivato-buf            PIC  z.zzz.zzz.zz9,99.
       77 v-dett           PIC  9
                  VALUE IS 1.
       77 lab-ivato-buf    PIC  z.zzz.zzz.zz9,99.
       77 MS-Sans-Serif10B-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 STATUS-timposte  PIC  X(2).
           88 Valid-STATUS-timposte VALUE IS "00" THRU "09". 
       77 STATUS-tmarche   PIC  X(2).
           88 Valid-STATUS-tmarche VALUE IS "00" THRU "09". 
       77 STATUS-progmag   PIC  X(2).
           88 Valid-STATUS-progmag VALUE IS "00" THRU "09". 
       77 STATUS-ttipocli  PIC  X(2).
           88 Valid-STATUS-ttipocli VALUE IS "00" THRU "09". 
       77 lab-data-buf     PIC  99/99/9999.
       77 STATUS-tpiombo   PIC  X(2).
           88 Valid-STATUS-tpiombo VALUE IS "00" THRU "09". 
       77 STATUS-mtordini  PIC  X(2).
           88 Valid-STATUS-mtordini VALUE IS "00" THRU "09". 
       77 STATUS-mrordini  PIC  X(2).
           88 Valid-STATUS-mrordini VALUE IS "00" THRU "09". 
       77 STATUS-param     PIC  X(2).
           88 Valid-STATUS-param VALUE IS "00" THRU "09". 

      ***********************************************************
      *   Code Gen's Buffer                                     *
      ***********************************************************
       77 STATUS-Form2-FLAG-REFRESH PIC  9.
          88 Form2-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 TMP-Form2-KEY1-ORDER  PIC X VALUE "A".
       77 TMP-Form2-mtordini-RESTOREBUF  PIC X(882).
       77 TMP-Form2-KEYIS  PIC 9(3) VALUE 1.
       77 Form2-MULKEY-TMPBUF   PIC X(882).
       77 STATUS-Form1-FLAG-REFRESH PIC  9.
          88 Form1-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 STATUS-form3-FLAG-REFRESH PIC  9.
          88 form3-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 STATUS-screen2-FLAG-REFRESH PIC  9.
          88 screen2-FLAG-REFRESH  VALUE 1 FALSE 0. 
      * DATA CONTROL BUFFER
       01 screen2-BUF.
      * Data.Label
              05 lab-clia-BUF PIC X(40).
      * Data.Label
              05 lab-ind-cli-BUF PIC X(40).
      * Data.Label
              05 lab-loc-cli-BUF PIC X(35).
      * Data.Label
              05 lab-des-BUF PIC X(40).
      * Data.Label
              05 lab-ind-des-BUF PIC X(40).
      * Data.Label
              05 lab-loc-des-BUF PIC X(35).
      * Data.Label
              05 lab-cau-BUF PIC X(40).
      * Data.Label
              05 lab-anno-BUF PIC 9(4).
      * Data.Label
              05 lab-cliente-BUF PIC z(5).
      * Data.Label
              05 lab-destino-BUF PIC z(5).
      * Data.Label
              05 lab-causale-BUF PIC X(4).
      * Data.Label
              05 lab-annoa-BUF PIC z(8).

       77 TMP-screen2-KEY1-ORDER  PIC X VALUE "A".
       77 TMP-screen2-mtordini-RESTOREBUF  PIC X(882).
       77 TMP-screen2-KEYIS  PIC 9(3) VALUE 1.
       77 screen2-MULKEY-TMPBUF   PIC X(882).
       77 TMP-DataSet1-clienti-BUF     PIC X(1910).
       77 TMP-DataSet1-destini-BUF     PIC X(445).
       77 TMP-DataSet1-tcaumag-BUF     PIC X(254).
       77 TMP-DataSet1-articoli-BUF     PIC X(3669).
       77 TMP-DataSet1-tmarche-BUF     PIC X(217).
       77 TMP-DataSet1-progmag-BUF     PIC X(1090).
       77 TMP-DataSet1-ttipocli-BUF     PIC X(193).
       77 TMP-DataSet1-tpiombo-BUF     PIC X(179).
       77 TMP-DataSet1-mtordini-BUF     PIC X(882).
       77 TMP-DataSet1-mrordini-BUF     PIC X(891).
       77 TMP-DataSet1-tparamge-BUF     PIC X(815).
       77 TMP-DataSet1-rordini-BUF     PIC X(667).
       77 TMP-DataSet1-tordini-BUF     PIC X(907).
       77 TMP-DataSet1-param-BUF     PIC X(980).
      * VARIABLES FOR RECORD LENGTH.
       77  TotemFdSlRecordClearOffset   PIC 9(5) COMP-4.
       77  TotemFdSlRecordLength        PIC 9(5) COMP-4.
      * FILE'S LOCK MODE FLAG
       77 DataSet1-clienti-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-clienti-LOCK  VALUE "Y".
       77 DataSet1-clienti-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-clienti-KEY-Asc  VALUE "A".
          88 DataSet1-clienti-KEY-Desc VALUE "D".
       77 DataSet1-destini-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-destini-LOCK  VALUE "Y".
       77 DataSet1-destini-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-destini-KEY-Asc  VALUE "A".
          88 DataSet1-destini-KEY-Desc VALUE "D".
       77 DataSet1-tcaumag-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tcaumag-LOCK  VALUE "Y".
       77 DataSet1-tcaumag-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tcaumag-KEY-Asc  VALUE "A".
          88 DataSet1-tcaumag-KEY-Desc VALUE "D".
       77 DataSet1-articoli-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-articoli-LOCK  VALUE "Y".
       77 DataSet1-articoli-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-articoli-KEY-Asc  VALUE "A".
          88 DataSet1-articoli-KEY-Desc VALUE "D".
       77 DataSet1-tmarche-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tmarche-LOCK  VALUE "Y".
       77 DataSet1-tmarche-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tmarche-KEY-Asc  VALUE "A".
          88 DataSet1-tmarche-KEY-Desc VALUE "D".
       77 DataSet1-progmag-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-progmag-LOCK  VALUE "Y".
       77 DataSet1-progmag-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-progmag-KEY-Asc  VALUE "A".
          88 DataSet1-progmag-KEY-Desc VALUE "D".
       77 DataSet1-ttipocli-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-ttipocli-LOCK  VALUE "Y".
       77 DataSet1-ttipocli-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-ttipocli-KEY-Asc  VALUE "A".
          88 DataSet1-ttipocli-KEY-Desc VALUE "D".
       77 DataSet1-tpiombo-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tpiombo-LOCK  VALUE "Y".
       77 DataSet1-tpiombo-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tpiombo-KEY-Asc  VALUE "A".
          88 DataSet1-tpiombo-KEY-Desc VALUE "D".
       77 DataSet1-mtordini-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-mtordini-LOCK  VALUE "Y".
       77 DataSet1-KEYIS   PIC 9(3) VALUE 1.
       77 DataSet1-mtordini-KEY1-ORDER  PIC X VALUE "A".
          88 DataSet1-mtordini-KEY1-Asc  VALUE "A".
          88 DataSet1-mtordini-KEY1-Desc VALUE "D".
       77 DataSet1-mrordini-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-mrordini-LOCK  VALUE "Y".
       77 DataSet1-mrordini-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-mrordini-KEY-Asc  VALUE "A".
          88 DataSet1-mrordini-KEY-Desc VALUE "D".
       77 DataSet1-tparamge-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tparamge-LOCK  VALUE "Y".
       77 DataSet1-tparamge-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tparamge-KEY-Asc  VALUE "A".
          88 DataSet1-tparamge-KEY-Desc VALUE "D".
       77 DataSet1-rordini-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-rordini-LOCK  VALUE "Y".
       77 DataSet1-rordini-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-rordini-KEY-Asc  VALUE "A".
          88 DataSet1-rordini-KEY-Desc VALUE "D".
       77 DataSet1-tordini-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tordini-LOCK  VALUE "Y".
       77 DataSet1-tordini-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tordini-KEY-Asc  VALUE "A".
          88 DataSet1-tordini-KEY-Desc VALUE "D".
       77 DataSet1-param-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-param-LOCK  VALUE "Y".
       77 DataSet1-param-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-param-KEY-Asc  VALUE "A".
          88 DataSet1-param-KEY-Desc VALUE "D".

       77 clienti-cli-K1-SPLITBUF  PIC X(47).
       77 clienti-cli-K3-SPLITBUF  PIC X(12).
       77 clienti-cli-K4-SPLITBUF  PIC X(8).
       77 destini-K1-SPLITBUF  PIC X(51).
       77 destini-k-localita-SPLITBUF  PIC X(36).
       77 tcaumag-k-mag-SPLITBUF  PIC X(5).
       77 articoli-art-k1-SPLITBUF  PIC X(51).
       77 progmag-key01-SPLITBUF  PIC X(21).
       77 mtordini-mto-k-ord-cli-SPLITBUF  PIC X(15).
       77 mtordini-mto-k-data-SPLITBUF  PIC X(21).
       77 mtordini-mto-k-clides-SPLITBUF  PIC X(19).
       77 mtordini-mto-k-age-SPLITBUF  PIC X(14).
       77 mtordini-k-mto-stato-sel-SPLITBUF  PIC X(15).
       77 mtordini-k-mto-stato-SPLITBUF  PIC X(14).
       77 mtordini-mto-k-gdo-SPLITBUF  PIC X(26).
       77 mtordini-mto-k-bloc-SPLITBUF  PIC X(20).
       77 mtordini-k-giang-SPLITBUF  PIC X(21).
       77 mrordini-mro-k-promo-SPLITBUF  PIC X(33).
       77 mrordini-mro-k-articolo-SPLITBUF  PIC X(24).
       77 mrordini-mro-k-progr-SPLITBUF  PIC X(18).
       77 mrordini-mro-k-tprev-SPLITBUF  PIC X(39).
       77 rordini-ror-k-promo-SPLITBUF  PIC X(16).
       77 rordini-ror-k-articolo-SPLITBUF  PIC X(24).
       77 rordini-ror-k-master-SPLITBUF  PIC X(35).
       77 rordini-ror-k-stbolle-SPLITBUF  PIC X(30).
       77 tordini-k-causale-SPLITBUF  PIC X(17).
       77 tordini-k1-SPLITBUF  PIC X(23).
       77 tordini-k2-SPLITBUF  PIC X(21).
       77 tordini-k-bolla-SPLITBUF  PIC X(13).
       77 tordini-k3-SPLITBUF  PIC X(22).
       77 tordini-k-fattura-SPLITBUF  PIC X(13).
       77 tordini-k4-SPLITBUF  PIC X(30).
       77 tordini-k-contab-SPLITBUF  PIC X(14).
       77 tordini-k-tipo-SPLITBUF  PIC X(14).
       77 tordini-k-data-SPLITBUF  PIC X(17).
       77 tordini-k-agfatt-SPLITBUF  PIC X(42).
       77 tordini-k-stbolle-SPLITBUF  PIC X(34).
       77 tordini-k-andamento-data-SPLITBUF  PIC X(10).
       77 tordini-k-andamento-cliente-SPLITBUF  PIC X(15).
       77 tordini-k-andamento-clides-SPLITBUF  PIC X(20).
       77 tordini-k-promo-SPLITBUF  PIC X(29).
       77 tordini-k-or-SPLITBUF  PIC X(21).
       77 tordini-k-tor-inviare-SPLITBUF  PIC X(14).

      *{TOTEM}END

      *{TOTEM}ID-LOGICI
      ***** Elenco ID Logici *****
       78  78-ID-EF-ANNO VALUE 5001.
       78  78-ID-EF-ordine-FROM VALUE 5002.
       78  78-ID-EF-ordine-TO VALUE 5003.
       78  78-ID-EF-data-FROM VALUE 5004.
       78  78-ID-EF-DATA-TO VALUE 5005.
       78  78-ID-EF-CLIENTE-FROM VALUE 5006.
      ***** Fine ID Logici *****
      *{TOTEM}END

       LINKAGE          SECTION.
      *{TOTEM}LINKAGE
           COPY  "COMMON-LINKAGE.DEF".

      *{TOTEM}END

       SCREEN           SECTION.
      *{TOTEM}COPY-SCREEN
      * FORM
       01 
           Form2, 
           .

      * FRAME
       05
           Screen1-Fr-1, 
           Frame, 
           COL 1,17, 
           LINE 46,54,
           LINES 3,00 ,
           SIZE 33,00 ,
           LOWERED,
           FULL-HEIGHT,
           ID IS 2,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           .

      * LABEL
       05
           Screen1-La-1aaa, 
           Label, 
           COL 1,71, 
           LINE 46,54,
           LINES 2,54 ,
           SIZE 32,30 ,
           COLOR IS col-stato-ordine,
           FONT IS font-evidenzia-griglia,
           ID IS 4,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           .

      * LABEL
       05
           Screen1-La-1aa, 
           Label, 
           COL 2,67, 
           LINE 47,23,
           LINES 1,54 ,
           SIZE 30,00 ,
           COLOR IS col-stato-ordine,
           FONT IS Verdana10B-Occidentale,
           ID IS 5,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TITLE tit-stato-ordine,
           .

      * GRID
       05
           gd-ordini, 
           Grid, 
           COL 2,67, 
           LINE 2,00,
           LINES 42,00 ,
           SIZE 161,67 ,
           BOXED,
           DATA-COLUMNS (1, 2, 6, 14, 24, 29, 69, 109, 149),
           ALIGNMENT ("C", "C", "R", "C", "R", "U", "U", "U", "U"),
           SEPARATION (5, 5, 5, 5, 5, 5, 5, 5, 5),
           DATA-TYPES ("X", "9(4)", "9(8)", "99/99/9999", "9(4)", "x(40)
      -    "", "x(40)", "x(40)", "x(35)"),
           NUM-COL-HEADINGS 1,
           COLUMN-HEADINGS,
           CURSOR-FRAME-WIDTH 0,
           DIVIDER-COLOR 1,
           HEADING-COLOR 257,
           HEADING-DIVIDER-COLOR 1,
           HEADING-FONT IS Verdana10B-Occidentale,
           ID IS 1,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           ROW-HEADINGS,
           TILED-HEADINGS,
           VPADDING 50,
           VSCROLL,
           EVENT PROCEDURE Screen1-Gd-1-Event-Proc,
           .

      * FRAME
       05
           Screen1-Fr-1a, 
           Frame, 
           COL 34,54, 
           LINE 46,54,
           LINES 3,00 ,
           SIZE 103,83 ,
           LOWERED,
           FULL-HEIGHT,
           ID IS 202,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           .

      * LABEL
       05
           Screen1-La-1, 
           Label, 
           COL 36,54, 
           LINE 47,16,
           LINES 1,54 ,
           SIZE 89,00 ,
           FONT IS Verdana12-Occidentale,
           ID IS 203,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Doppio Click o Invio per modificare l'ordine",
           .

      * FRAME
       05
           Screen1-Fr-1aa, 
           Frame, 
           COL 138,50, 
           LINE 46,54,
           LINES 3,00 ,
           SIZE 27,50 ,
           LOWERED,
           FULL-HEIGHT,
           ID IS 6,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           .

      * PUSH BUTTON
       05
           pb-annulla2, 
           Push-Button, 
           COL 152,33, 
           LINE 46,69,
           LINES 30,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE BOTTONE-CANCEL-BMP,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 27,
           FLAT,
           ID IS 201,
           SELF-ACT,
           ESCAPE-BUTTON,
           AFTER PROCEDURE pb-annulla2-AfterProcedure, 
           BEFORE PROCEDURE pb-annulla2-BeforeProcedure, 
           .

      * PUSH BUTTON
       05
           pb-ok2, 
           Push-Button, 
           COL 139,17, 
           LINE 46,69,
           LINES 30,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE BOTTONE-OK-BMP,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 1000,
           FLAT,
           ID IS 200,
           AFTER PROCEDURE pb-ok2-AfterProcedure, 
           BEFORE PROCEDURE pb-ok2-BeforeProcedure, 
           .

      * FORM
       01 
           Form1, 
           AFTER PROCEDURE  Form1-AFTER-SCREEN
           .

      * RADIO BUTTON
       05
           RB-SINGOLO, 
           Radio-Button, 
           COL 6,00, 
           LINE 3,50,
           LINES 1,31 ,
           SIZE 2,00 ,
           EXCEPTION-VALUE 1001
           FLAT,
           GROUP 1,
           GROUP-VALUE 1,
           ID IS 101,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           VALUE TIPO-ELAB,
           AFTER PROCEDURE Screen4-Rb-1-AfterProcedure, 
           BEFORE PROCEDURE Screen4-Rb-1-BeforeProcedure, 
           .
      * RADIO BUTTON
       05
           RB-ELENCO, 
           Radio-Button, 
           COL 26,00, 
           LINE 3,50,
           LINES 1,31 ,
           SIZE 2,00 ,
           EXCEPTION-VALUE 1002
           FLAT,
           GROUP 1,
           GROUP-VALUE 2,
           ID IS 102,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           VALUE TIPO-ELAB,
           AFTER PROCEDURE Screen4-Rb-1-AfterProcedure, 
           BEFORE PROCEDURE Screen4-Rb-1-BeforeProcedure, 
           .
      * ENTRY FIELD
       05
           EF-ANNO, 
           Entry-Field, 
           COL 9,00, 
           LINE 8,00,
           LINES 1,39 ,
           SIZE 5,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED 1,
           ID IS 78-ID-EF-ANNO,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 4,
           NUMERIC,
           VALUE ANNO-TO,
           AFTER PROCEDURE EF-ANNO-TO-AfterProcedure, 
           BEFORE PROCEDURE EF-ANNO-TO-BeforeProcedure, 
           .


      * ENTRY FIELD
       05
           EF-ordine-FROM, 
           Entry-Field, 
           COL 5,00, 
           LINE 10,00,
           LINES 1,39 ,
           SIZE 9,00 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-EF-ordine-FROM,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 8,
           NUMERIC,
           VALUE ordine-FROM,
           PIC Z(7)9
           AFTER PROCEDURE EF-ordine-FROM-AfterProcedure, 
           BEFORE PROCEDURE EF-ordine-FROM-BeforeProcedure, 
           .


      * ENTRY FIELD
       05
           EF-ordine-TO, 
           Entry-Field, 
           COL 30,50, 
           LINE 10,00,
           LINES 1,38 ,
           SIZE 9,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED MOD-LIMITI,
           ID IS 78-ID-EF-ordine-TO,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 8,
           NUMERIC,
           VALUE ordine-TO,
           PIC Z(7)9
           AFTER PROCEDURE EF-ordine-TO-AfterProcedure, 
           BEFORE PROCEDURE EF-ordine-TO-BeforeProcedure, 
           .


      * ENTRY FIELD
       05
           EF-data-FROM, 
           Entry-Field, 
           COL 3,00, 
           LINE 12,00,
           LINES 1,38 ,
           SIZE 11,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED MOD-LIMITI,
           ID IS 78-ID-EF-data-FROM,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           MAX-TEXT 10,
           NUMERIC,
           VALUE data-FROM,
           PIC 99/99/9999
           AFTER PROCEDURE EF-data-FROM-AfterProcedure, 
           BEFORE PROCEDURE EF-data-FROM-BeforeProcedure, 
           .


      * ENTRY FIELD
       05
           EF-DATA-TO, 
           Entry-Field, 
           COL 30,50, 
           LINE 12,00,
           LINES 1,38 ,
           SIZE 11,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED MOD-LIMITI,
           ID IS 78-ID-EF-DATA-TO,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           MAX-TEXT 10,
           NUMERIC,
           VALUE data-TO,
           PIC 99/99/9999
           AFTER PROCEDURE EF-DATA-TO-AfterProcedure, 
           BEFORE PROCEDURE EF-DATA-TO-BeforeProcedure, 
           .


      * ENTRY FIELD
       05
           EF-CLIENTE-FROM, 
           Entry-Field, 
           COL 8,00, 
           LINE 14,39,
           LINES 1,39 ,
           SIZE 6,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED MOD-LIMITI,
           ID IS 78-ID-EF-CLIENTE-FROM,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 5,
           NUMERIC,
           VALUE CLIENTE-FROM,
           PIC Z(4)9
           AFTER PROCEDURE EF-CLIENTE-FROM-AfterProcedure, 
           BEFORE PROCEDURE EF-CLIENTE-FROM-BeforeProcedure, 
           .


      * LABEL
       05
           Screen3-La-1a, 
           Label, 
           COL 18,50, 
           LINE 8,00,
           LINES 1,17 ,
           SIZE 7,00 ,
           ID IS 100,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Anno",
           .

      * LABEL
       05
           Screen3-La-1aa, 
           Label, 
           COL 2,00, 
           LINE 1,50,
           LINES 1,15 ,
           SIZE 17,00 ,
           COLOR IS 80,
           ID IS 12,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TITLE "Tipo ricerca",
           .

      * BAR
       05
           Screen1-Br-1a, 
           Bar,
           COL 19,00, 
           LINE 2,00,
           SIZE 24,00 ,
           ID IS 15,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           COLORS (8, 8),
           SHADING (-1, 1),
           WIDTH 2,
           .

      * LABEL
       05
           Screen3-La-1ab, 
           Label, 
           COL 9,00, 
           LINE 3,50,
           LINES 1,15 ,
           SIZE 12,00 ,
           ID IS 104,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           LEFT,
           TRANSPARENT,
           TITLE "Singolo ordine",
           .

      * LABEL
       05
           Screen3-La-1aba, 
           Label, 
           COL 29,00, 
           LINE 3,50,
           LINES 1,15 ,
           SIZE 9,00 ,
           ID IS 105,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           LEFT,
           TRANSPARENT,
           TITLE "Da elenco",
           .

      * LABEL
       05
           Screen3-La-1aaa, 
           Label, 
           COL 2,00, 
           LINE 6,00,
           LINES 1,15 ,
           SIZE 17,00 ,
           COLOR IS 80,
           ID IS 219,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TITLE "Limiti di Selezione",
           .

      * BAR
       05
           Screen1-Br-1aa, 
           Bar,
           COL 19,00, 
           LINE 6,60,
           SIZE 24,00 ,
           ID IS 220,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           COLORS (8, 8),
           SHADING (-1, 1),
           WIDTH 2,
           .

      * LABEL
       05
           Screen4-blockpgm-1, 
           Label, 
           COL 38,10, 
           LINE 5,33,
           LINES 0,61 ,
           SIZE 2,10 ,
           ID IS 1,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "BlockPgm",
           VISIBLE v-custom,
           .

      * BITMAP
       05
           Bitmap-freccia-daa, 
           Bitmap, 
           COL 15,00, 
           LINE 10,00,
           LINES 24,00 ,
           SIZE 28,00 ,
           TRANSPARENT-COLOR TR-COLOR,
           BITMAP-HANDLE BLUE-DA-28X24-BMP,
           BITMAP-NUMBER 1,
           ID IS 4,
           .

      * LABEL
       05
           Screen3-La-1ac, 
           Label, 
           COL 18,50, 
           LINE 10,00,
           LINES 1,17 ,
           SIZE 7,00 ,
           ID IS 5,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Numero",
           .

      * BITMAP
       05
           Bitmap-freccia-finoa, 
           Bitmap, 
           COL 26,50, 
           LINE 10,00,
           LINES 24,00 ,
           SIZE 28,00 ,
           TRANSPARENT-COLOR TR-COLOR,
           BITMAP-HANDLE BLUE-FINO-28X24-BMP,
           BITMAP-NUMBER 1,
           ID IS 6,
           .

      * BITMAP
       05
           Bitmap-freccia-daaa, 
           Bitmap, 
           COL 15,00, 
           LINE 12,00,
           LINES 24,00 ,
           SIZE 28,00 ,
           TRANSPARENT-COLOR TR-COLOR,
           BITMAP-HANDLE BLUE-DA-28X24-BMP,
           BITMAP-NUMBER 1,
           ID IS 9,
           .

      * LABEL
       05
           Screen3-La-1aca, 
           Label, 
           COL 18,50, 
           LINE 12,00,
           LINES 1,15 ,
           SIZE 7,00 ,
           ID IS 10,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Data",
           .

      * BITMAP
       05
           Bitmap-freccia-finoaa, 
           Bitmap, 
           COL 26,50, 
           LINE 12,00,
           LINES 24,00 ,
           SIZE 28,00 ,
           TRANSPARENT-COLOR TR-COLOR,
           BITMAP-HANDLE BLUE-FINO-28X24-BMP,
           BITMAP-NUMBER 1,
           ID IS 11,
           .

      * LABEL
       05
           Screen3-La-1acb, 
           Label, 
           COL 1,50, 
           LINE 14,39,
           LINES 1,38 ,
           SIZE 6,00 ,
           ID IS 19,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Cliente",
           .

      * LABEL
       05
           Screen4-Custom1-1, 
           Label, 
           COL 33,30, 
           LINE 5,28,
           LINES 0,61 ,
           SIZE 2,40 ,
           ID IS 2,
           TRANSPARENT,
           TITLE "CUSTOM CONTROL",
           VISIBLE v-custom,
           .

      * FRAME
       05
           Screen4-Fr-1, 
           Frame, 
           COL 1,00, 
           LINE 16,89,
           LINES 2,78 ,
           SIZE 42,00 ,
           LOWERED,
           ID IS 23,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           .

      * PUSH BUTTON
       05
           pb-ok, 
           Push-Button, 
           COL 26,90, 
           LINE 17,56,
           LINES 30,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE BOTTONE-OK-BMP,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 1000,
           FLAT,
           ID IS 200,
           AFTER PROCEDURE pb-ok-AfterProcedure, 
           BEFORE PROCEDURE pb-ok-BeforeProcedure, 
           .

      * PUSH BUTTON
       05
           pb-annulla, 
           Push-Button, 
           COL 34,80, 
           LINE 17,56,
           LINES 30,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE BOTTONE-CANCEL-BMP,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 27,
           FLAT,
           ID IS 201,
           SELF-ACT,
           ESCAPE-BUTTON,
           AFTER PROCEDURE pb-annulla-AfterProcedure, 
           BEFORE PROCEDURE pb-annulla-BeforeProcedure, 
           .

      * LABEL
       05
           lab-cli, 
           Label, 
           COL 15,00, 
           LINE 14,39,
           LINES 2,00 ,
           SIZE 27,00 ,
           COLOR IS 5,
           ID IS 13,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-cli-buf,
           .

      * TOOLBAR
       01
           Form1-Tb-1a,
           .    

      * PUSH BUTTON
       05
           TOOL-ESCI, 
           Push-Button, 
           COL 1,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           ENABLED E-ESCI,
           EXCEPTION-VALUE 27,
           FLAT,
           ID IS 14,
           SELF-ACT,
           ESCAPE-BUTTON,
           TITLE "&Esci",
           .

      * PUSH BUTTON
       05
           TOOL-CERCA, 
           Push-Button, 
           COL 6,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           BITMAP-NUMBER 8,
           UNFRAMED,
           SQUARE,
           ENABLED E-CERCA,
           EXCEPTION-VALUE 8,
           FLAT,
           ID IS 18,
           SELF-ACT,
           TITLE "Cerca (F8)",
           .

      * FORM
       01 
           form3, 
           AFTER PROCEDURE  form3-AFTER-SCREEN
           .

      * LABEL
       05
           form3-La-1, 
           Label, 
           COL 2,00, 
           LINE 2,00,
           LINES 2,00 ,
           SIZE 38,00 ,
           FONT IS Verdana12BI-Occidentale,
           ID IS 2,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Caricamento ordini in corso...",
           .

      * FORM
       01 
           screen2, 
           AFTER PROCEDURE  screen2-AFTER-SCREEN
           .

      * GRID
       05
           Form1-Gd-1, 
           Grid, 
           COL 2,83, 
           LINE 10,92,
           LINES 19,54 ,
           SIZE 154,17 ,
           ADJUSTABLE-COLUMNS,
           BOXED,
           CENTERED-HEADINGS,
           COLOR IS 516,
           DATA-COLUMNS (1, 6, 12, 62, 70, 84, 89, 97, 105, 113, 127, 
           130),
           ALIGNMENT ("R", "R", "U", "R", "R", "R", "R", "R", "R", "R", 
           "U", "C"),
           SEPARATION (5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5),
           DATA-TYPES ("9(5)", "9(6)", "X", "9(8)", "9(12)", "9(5)", "9(
      -    "7)", "9(7)", "X", "9(12)", "x(3)", "X"),
           NUM-COL-HEADINGS 1,
           COLUMN-HEADINGS,
           CURSOR-FRAME-WIDTH 0,
           DIVIDER-COLOR 1,
           HEADING-COLOR 257,
           HEADING-DIVIDER-COLOR 1,
           ID IS 2000,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           ROW-HEADINGS,
           TILED-HEADINGS,
           VPADDING 54,
           VSCROLL,
           EVENT PROCEDURE Form1-Gd-1-Event-Proc,
           .

      * FRAME
       05
           Screen4-Fr-1a, 
           Frame, 
           COL 1,00, 
           LINE 31,46,
           LINES 3,77 ,
           SIZE 158,00 ,
           LOWERED,
           ID IS 23,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           .

      * PUSH BUTTON
       05
           pb-oka, 
           Push-Button, 
           COL 132,33, 
           LINE 32,15,
           LINES 30,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE BOTTONE-OK-BMP,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 1000,
           FLAT,
           ID IS 200,
           AFTER PROCEDURE pb-oka-AfterProcedure, 
           BEFORE PROCEDURE pb-oka-BeforeProcedure, 
           .

      * PUSH BUTTON
       05
           pb-annullaa, 
           Push-Button, 
           COL 145,17, 
           LINE 32,15,
           LINES 30,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE BOTTONE-CANCEL-BMP,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 27,
           FLAT,
           ID IS 201,
           SELF-ACT,
           ESCAPE-BUTTON,
           AFTER PROCEDURE pb-annullaa-AfterProcedure, 
           BEFORE PROCEDURE pb-annullaa-BeforeProcedure, 
           .

      * BAR
       05
           Form1-Br-2, 
           Bar,
           COL 1,00, 
           LINE 9,50,
           SIZE 158,00 ,
           ID IS 100,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           COLORS (8, 8),
           SHADING (-1, 1),
           WIDTH 2,
           .

      * LABEL
       05
           Form1-La-1, 
           Label, 
           COL 3,00, 
           LINE 2,00,
           LINES 1,31 ,
           SIZE 7,00 ,
           FONT IS Small-Font,
           ID IS 1,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Anno",
           .

      * LABEL
       05
           Form1-La-2, 
           Label, 
           COL 3,00, 
           LINE 4,50,
           LINES 1,31 ,
           SIZE 7,00 ,
           FONT IS Small-Font,
           ID IS 3,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Cliente",
           .

      * LABEL
       05
           Form1-La-3, 
           Label, 
           COL 3,00, 
           LINE 7,00,
           LINES 1,31 ,
           SIZE 7,00 ,
           FONT IS Small-Font,
           ID IS 5,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Destino",
           .

      * DB_LABEL
       05
           lab-clia, 
           Label, 
           COL 20,00, 
           LINE 4,50,
           LINES 2,00 ,
           SIZE 45,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 7,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-clia-BUF,
           TRANSPARENT,
           .

      * DB_LABEL
       05
           lab-ind-cli, 
           Label, 
           COL 66,00, 
           LINE 4,50,
           LINES 2,00 ,
           SIZE 45,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 8,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-ind-cli-BUF,
           TRANSPARENT,
           .

      * DB_LABEL
       05
           lab-loc-cli, 
           Label, 
           COL 112,00, 
           LINE 4,50,
           LINES 2,00 ,
           SIZE 45,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 9,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-loc-cli-BUF,
           TRANSPARENT,
           .

      * DB_LABEL
       05
           lab-des, 
           Label, 
           COL 20,00, 
           LINE 7,00,
           LINES 2,00 ,
           SIZE 45,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 10,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-des-BUF,
           TRANSPARENT,
           .

      * DB_LABEL
       05
           lab-ind-des, 
           Label, 
           COL 66,00, 
           LINE 7,00,
           LINES 2,00 ,
           SIZE 45,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 11,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-ind-des-BUF,
           TRANSPARENT,
           .

      * DB_LABEL
       05
           lab-loc-des, 
           Label, 
           COL 112,00, 
           LINE 7,00,
           LINES 2,00 ,
           SIZE 45,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 12,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-loc-des-BUF,
           TRANSPARENT,
           .

      * LABEL
       05
           Form1-La-18, 
           Label, 
           COL 39,00, 
           LINE 2,00,
           LINES 1,31 ,
           SIZE 17,00 ,
           FONT IS Small-Font,
           ID IS 66,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Causale di magazzino",
           .

      * DB_LABEL
       05
           lab-cau, 
           Label, 
           COL 66,00, 
           LINE 2,00,
           LINES 1,31 ,
           SIZE 60,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 81,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-cau-BUF,
           TRANSPARENT,
           .

      * DB_LABEL
       05
           lab-anno, 
           Label, 
           COL 12,00, 
           LINE 2,00,
           LINES 1,31 ,
           SIZE 6,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 2,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-anno-BUF,
           TRANSPARENT,
           .

      * DB_LABEL
       05
           lab-cliente, 
           Label, 
           COL 12,00, 
           LINE 4,54,
           LINES 1,31 ,
           SIZE 6,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 4,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-cliente-BUF,
           TRANSPARENT,
           .

      * DB_LABEL
       05
           lab-destino, 
           Label, 
           COL 12,00, 
           LINE 7,00,
           LINES 1,31 ,
           SIZE 6,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 6,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-destino-BUF,
           TRANSPARENT,
           .

      * DB_LABEL
       05
           lab-causale, 
           Label, 
           COL 57,00, 
           LINE 2,00,
           LINES 1,31 ,
           SIZE 8,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 13,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-causale-BUF,
           TRANSPARENT,
           .

      * LABEL
       05
           Form1-La-4, 
           Label, 
           COL 134,00, 
           LINE 2,00,
           LINES 1,31 ,
           SIZE 10,00 ,
           FONT IS Small-Font,
           ID IS 14,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Data Ordine",
           .

      * LABEL
       05
           lab-data, 
           Label, 
           COL 146,00, 
           LINE 2,00,
           LINES 1,31 ,
           SIZE 11,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 15,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-data-buf,
           .

      * LABEL
       05
           Form1-La-1a, 
           Label, 
           COL 19,67, 
           LINE 2,00,
           LINES 1,31 ,
           SIZE 5,00 ,
           FONT IS Small-Font,
           ID IS 16,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Num.",
           .

      * DB_LABEL
       05
           lab-annoa, 
           Label, 
           COL 25,00, 
           LINE 2,00,
           LINES 1,31 ,
           SIZE 9,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 17,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-annoa-BUF,
           TRANSPARENT,
           .

      *{TOTEM}END

      *{TOTEM}LINKPARA
       PROCEDURE  DIVISION USING LK-BLOCKPGM, USER-CODI, LIVELLO-ABIL.
      *{TOTEM}END

      *{TOTEM}DECLARATIVE
       DECLARATIVES.
      * <TOTEM:EPT. INIT:sbloc-m, INIT:sbloc-m, BeforeDeclarative>
      ***---
       MTORDINI-ERR SECTION.
           use after error procedure on mtordini.
           set tutto-ok  to true.
           evaluate status-mtordini
           when "35"
                display message "File [MTORDINI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [MTORDINI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[MTORDINI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           when "93"
                initialize geslock-messaggio
                string   "File già in uso!"
                  x"0d0a""Impossibile procedere!" delimited size
                      into geslock-messaggio
                end-string
                move 1 to geslock-v-riprova
                move 0 to geslock-v-ignora
                move 1 to geslock-v-termina
                move   "mtordini"   to geslock-nome-file
                call   "geslock" using geslock-linkage
                cancel "geslock"
                evaluate true
                when riprova
                     set RecLocked to false
                     open i-o mtordini
                when termina
                     set errori to true
                     display message "Operazione interrotta!"
                               title titolo
                                icon 2
                end-evaluate
           when "99"
                initialize geslock-messaggio
                string   "Record già in uso!"
                  x"0d0a""Impossibile procedere!" delimited size
                      into geslock-messaggio
                end-string
                move 1 to geslock-v-riprova
                move 0 to geslock-v-ignora
                move 1 to geslock-v-termina
                move   "mtordini"   to geslock-nome-file
                call   "geslock" using geslock-linkage
                cancel "geslock"
                evaluate true
                when riprova
                     set RecLocked to false
                     read mtordini lock invalid continue end-read
                when termina
                     set errori to true
                     display message "Operazione interrotta!"
                               title titolo
                                icon 2
                end-evaluate
           end-evaluate.

      ***---
       RORDINI-ERR SECTION.
           use after error procedure on rordini.
           set tutto-ok  to true.
           evaluate status-rordini
           when "35"
                display message "File [RORDINI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [RORDINI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[RORDINI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           when "93"
           when "99"
                set RecLocked to true
                initialize geslock-messaggio
                string   "Record già in uso!"
                  x"0d0a""Impossibile procedere!" delimited size
                      into geslock-messaggio
                end-string
                move 1 to geslock-v-riprova
                move 1 to geslock-v-ignora
                move 0 to geslock-v-termina
                move   "rordini"    to geslock-nome-file
                call   "geslock" using geslock-linkage
                cancel "geslock"
                evaluate true
                when riprova
                     set RecLocked to false
                     read rordini lock invalid continue end-read
                when ignora
                     set errori to true
                end-evaluate
           end-evaluate.

      ***---
       TORDINI-ERR SECTION.
           use after error procedure on tordini.
           set tutto-ok  to true.
           evaluate status-tordini
           when "35"
                display message "File [TORDINI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TORDINI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TORDINI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           when "93"
           when "99"
                set RecLocked to true
                initialize geslock-messaggio
                string   "Record già in uso!"
                  x"0d0a""Impossibile procedere!" delimited size
                      into geslock-messaggio
                end-string
                move 1 to geslock-v-riprova
                move 0 to geslock-v-ignora
                move 0 to geslock-v-termina
                move   "tordini"    to geslock-nome-file
                call   "geslock" using geslock-linkage
                cancel "geslock"
                evaluate true
                when riprova
                     set RecLocked to false
                     read tordini lock invalid continue end-read
                when ignora
                     set errori to true
                end-evaluate
           end-evaluate.
 
      ***---
       CLIENTI-ERR SECTION.
           use after error procedure on clienti.
           set tutto-ok  to true.
           evaluate status-clienti
           when "35"
                display message "File [CLIENTI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [CLIENTI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[CLIENTI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       DESTINI-ERR SECTION.
           use after error procedure on destini.
           set tutto-ok  to true.
           evaluate status-destini
           when "35"
                display message "File [DESTINI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [DESTINI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[DESTINI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       TPARAMGE-ERR SECTION.
           use after error procedure on tparamge.
           set tutto-ok  to true.
           evaluate status-tparamge
           when "35"
                display message "File [TPARAMGE] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TPARAMGE] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TPARAMGE] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.

      * <TOTEM:END>
       INPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON INPUT.
       0100-DECL.
           EXIT.
       I-O-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON I-O.
       0200-DECL.
           EXIT.
       OUTPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON OUTPUT.
       0300-DECL.
           EXIT.
       TRANSACTION-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON TRANSACTION.
       0400-DECL.
           EXIT.
       END DECLARATIVES.
      *{TOTEM}END

       MAIN-LOGIC.
      *{TOTEM}ENTRY-BEFPRG
      *    Before-Program
           PERFORM ginqui-Ev-Before-Program
      *{TOTEM}END
           PERFORM INITIALIZE-ROUTINE.
      * run main screen
      *{TOTEM}RUN-MAINSCR
           PERFORM Form1-OPEN-ROUTINE.
      *{TOTEM}END

      *{TOTEM}COPY-PROCEDURE
       EXIT-STOP-ROUTINE.
           PERFORM CLOSE-FILE-RTN
      * <TOTEM:EPT. INIT:sbloc-m, INIT:sbloc-m, BeforeDestroyResource>
      * <TOTEM:END>
           DESTROY Verdana10B-Occidentale
           DESTROY Verdana12-Occidentale
           DESTROY Verdana12BI-Occidentale
           DESTROY MS-Sans-Serif10B-Occidentale
           CALL "w$bitmap" USING WBITMAP-DESTROY, BOTTONE-CANCEL-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, BOTTONE-OK-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, BLUE-DA-28X24-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, BLUE-FINO-28X24-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, toolbar-bmp
           CALL "w$bitmap" USING WBITMAP-DESTROY, TOOLBAR-BMP
      *    After-Program
           PERFORM ginqui-Ev-After-Program
           EXIT PROGRAM TOTEM-PgmStatus
           STOP RUN.

       INITIALIZE-ROUTINE.
      *    Before Init
      * initialize program status variable
           Initialize TOTEM-PgmStatus.
      * get system information
           ACCEPT SYSTEM-INFORMATION FROM SYSTEM-INFO.
      * get terminal information
           ACCEPT TERMINAL-ABILITIES FROM TERMINAL-INFO.
      * set font
           PERFORM INIT-FONT.
      * load bitmap
           PERFORM INIT-BMP.
      * load resource
           PERFORM INIT-RES.
      * create pop-up menu
           PERFORM INIT-POPUP.
      * open files
           PERFORM OPEN-FILE-RTN.
      *    After Init
           .
    
       INIT-FONT.
      * Verdana10B-Occidentale
           INITIALIZE WFONT-DATA Verdana10B-Occidentale
           MOVE 10 TO WFONT-SIZE
           MOVE "Verdana" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO TRUE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Verdana10B-Occidentale, WFONT-DATA
      * Verdana12-Occidentale
           INITIALIZE WFONT-DATA Verdana12-Occidentale
           MOVE 12 TO WFONT-SIZE
           MOVE "Verdana" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO FALSE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Verdana12-Occidentale, WFONT-DATA
      * Verdana12BI-Occidentale
           INITIALIZE WFONT-DATA Verdana12BI-Occidentale
           MOVE 12 TO WFONT-SIZE
           MOVE "Verdana" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO TRUE
           SET WFONT-ITALIC TO TRUE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Verdana12BI-Occidentale, WFONT-DATA

      * MS-Sans-Serif10B-Occidentale
           INITIALIZE WFONT-DATA MS-Sans-Serif10B-Occidentale
           MOVE 10 TO WFONT-SIZE
           MOVE "MS Sans Serif" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO TRUE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     MS-Sans-Serif10B-Occidentale, WFONT-DATA
           .

       INIT-BMP.
      * pb-annulla2
           COPY RESOURCE "BOTTONE-CANCEL.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "BOTTONE-CANCEL.BMP", 
                   GIVING BOTTONE-CANCEL-BMP.
      * pb-ok2
           COPY RESOURCE "BOTTONE-OK.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "BOTTONE-OK.BMP", 
                   GIVING BOTTONE-OK-BMP.
      * Bitmap-freccia-daa
           COPY RESOURCE "BLUE-DA-28X24.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "BLUE-DA-28X24.BMP", 
                   GIVING BLUE-DA-28X24-BMP.
      * Bitmap-freccia-finoa
           COPY RESOURCE "BLUE-FINO-28X24.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "BLUE-FINO-28X24.BMP", 
                   GIVING BLUE-FINO-28X24-BMP.
      * TOOL-ESCI
           COPY RESOURCE "toolbar.bmp".
           CALL "w$bitmap" USING WBITMAP-LOAD "toolbar.bmp", 
                   GIVING toolbar-bmp.
      * TOOL-CERCA
           COPY RESOURCE "TOOLBAR.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "TOOLBAR.BMP", 
                   GIVING TOOLBAR-BMP.
           .

       INIT-RES.
           .

       INIT-POPUP.
           .

       OPEN-FILE-RTN.
      *    Before Open
           PERFORM OPEN-clienti
           PERFORM OPEN-destini
           PERFORM OPEN-tcaumag
           PERFORM OPEN-articoli
           PERFORM OPEN-tmarche
           PERFORM OPEN-progmag
           PERFORM OPEN-ttipocli
           PERFORM OPEN-tpiombo
           PERFORM OPEN-mtordini
           PERFORM OPEN-mrordini
           PERFORM OPEN-tparamge
           PERFORM OPEN-rordini
           PERFORM OPEN-tordini
           PERFORM OPEN-param
      *    After Open
           .

       OPEN-clienti.
      * <TOTEM:EPT. INIT:sbloc-m, FD:clienti, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT clienti
           IF NOT Valid-STATUS-clienti
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:sbloc-m, FD:clienti, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-destini.
      * <TOTEM:EPT. INIT:sbloc-m, FD:destini, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT destini
           IF NOT Valid-STATUS-destini
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:sbloc-m, FD:destini, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tcaumag.
      * <TOTEM:EPT. INIT:sbloc-m, FD:tcaumag, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tcaumag
           IF NOT Valid-STATUS-tcaumag
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:sbloc-m, FD:tcaumag, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-articoli.
      * <TOTEM:EPT. INIT:sbloc-m, FD:articoli, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT articoli
           IF NOT Valid-STATUS-articoli
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:sbloc-m, FD:articoli, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tmarche.
      * <TOTEM:EPT. INIT:sbloc-m, FD:tmarche, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tmarche
           IF NOT Valid-STATUS-tmarche
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:sbloc-m, FD:tmarche, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-progmag.
      * <TOTEM:EPT. INIT:sbloc-m, FD:progmag, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT progmag
           IF NOT Valid-STATUS-progmag
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:sbloc-m, FD:progmag, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-ttipocli.
      * <TOTEM:EPT. INIT:sbloc-m, FD:ttipocli, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT ttipocli
           IF NOT Valid-STATUS-ttipocli
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:sbloc-m, FD:ttipocli, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tpiombo.
      * <TOTEM:EPT. INIT:sbloc-m, FD:tpiombo, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tpiombo
           IF NOT Valid-STATUS-tpiombo
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:sbloc-m, FD:tpiombo, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-mtordini.
      * <TOTEM:EPT. INIT:sbloc-m, FD:mtordini, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O mtordini
           IF STATUS-mtordini = "35"
              OPEN OUTPUT mtordini
                IF Valid-STATUS-mtordini
                   CLOSE mtordini
                   OPEN I-O mtordini
                END-IF
           END-IF
           IF NOT Valid-STATUS-mtordini
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:sbloc-m, FD:mtordini, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-mrordini.
      * <TOTEM:EPT. INIT:sbloc-m, FD:mrordini, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O mrordini
           IF STATUS-mrordini = "35"
              OPEN OUTPUT mrordini
                IF Valid-STATUS-mrordini
                   CLOSE mrordini
                   OPEN I-O mrordini
                END-IF
           END-IF
           IF NOT Valid-STATUS-mrordini
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:sbloc-m, FD:mrordini, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tparamge.
      * <TOTEM:EPT. INIT:sbloc-m, FD:tparamge, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tparamge
           IF NOT Valid-STATUS-tparamge
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:sbloc-m, FD:tparamge, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-rordini.
      * <TOTEM:EPT. INIT:sbloc-m, FD:rordini, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O rordini
           IF STATUS-rordini = "35"
              OPEN OUTPUT rordini
                IF Valid-STATUS-rordini
                   CLOSE rordini
                   OPEN I-O rordini
                END-IF
           END-IF
           IF NOT Valid-STATUS-rordini
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:sbloc-m, FD:rordini, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tordini.
      * <TOTEM:EPT. INIT:sbloc-m, FD:tordini, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O tordini
           IF STATUS-tordini = "35"
              OPEN OUTPUT tordini
                IF Valid-STATUS-tordini
                   CLOSE tordini
                   OPEN I-O tordini
                END-IF
           END-IF
           IF NOT Valid-STATUS-tordini
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:sbloc-m, FD:tordini, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-param.
      * <TOTEM:EPT. INIT:sbloc-m, FD:param, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT param
           IF NOT Valid-STATUS-param
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:sbloc-m, FD:param, AfterOpen>
      * <TOTEM:END>
           .

       CLOSE-FILE-RTN.
      *    Before Close
           PERFORM CLOSE-clienti
           PERFORM CLOSE-destini
           PERFORM CLOSE-tcaumag
           PERFORM CLOSE-articoli
           PERFORM CLOSE-tmarche
           PERFORM CLOSE-progmag
           PERFORM CLOSE-ttipocli
           PERFORM CLOSE-tpiombo
           PERFORM CLOSE-mtordini
           PERFORM CLOSE-mrordini
           PERFORM CLOSE-tparamge
           PERFORM CLOSE-rordini
           PERFORM CLOSE-tordini
           PERFORM CLOSE-param
      *    After Close
           .

       CLOSE-clienti.
      * <TOTEM:EPT. INIT:sbloc-m, FD:clienti, BeforeClose>
      * <TOTEM:END>
           CLOSE clienti
           .

       CLOSE-destini.
      * <TOTEM:EPT. INIT:sbloc-m, FD:destini, BeforeClose>
      * <TOTEM:END>
           CLOSE destini
           .

       CLOSE-tcaumag.
      * <TOTEM:EPT. INIT:sbloc-m, FD:tcaumag, BeforeClose>
      * <TOTEM:END>
           CLOSE tcaumag
           .

       CLOSE-articoli.
      * <TOTEM:EPT. INIT:sbloc-m, FD:articoli, BeforeClose>
      * <TOTEM:END>
           CLOSE articoli
           .

       CLOSE-tmarche.
      * <TOTEM:EPT. INIT:sbloc-m, FD:tmarche, BeforeClose>
      * <TOTEM:END>
           CLOSE tmarche
           .

       CLOSE-progmag.
      * <TOTEM:EPT. INIT:sbloc-m, FD:progmag, BeforeClose>
      * <TOTEM:END>
           CLOSE progmag
           .

       CLOSE-ttipocli.
      * <TOTEM:EPT. INIT:sbloc-m, FD:ttipocli, BeforeClose>
      * <TOTEM:END>
           CLOSE ttipocli
           .

       CLOSE-tpiombo.
      * <TOTEM:EPT. INIT:sbloc-m, FD:tpiombo, BeforeClose>
      * <TOTEM:END>
           CLOSE tpiombo
           .

       CLOSE-mtordini.
      * <TOTEM:EPT. INIT:sbloc-m, FD:mtordini, BeforeClose>
      * <TOTEM:END>
           CLOSE mtordini
           .

       CLOSE-mrordini.
      * <TOTEM:EPT. INIT:sbloc-m, FD:mrordini, BeforeClose>
      * <TOTEM:END>
           CLOSE mrordini
           .

       CLOSE-tparamge.
      * <TOTEM:EPT. INIT:sbloc-m, FD:tparamge, BeforeClose>
      * <TOTEM:END>
           CLOSE tparamge
           .

       CLOSE-rordini.
      * <TOTEM:EPT. INIT:sbloc-m, FD:rordini, BeforeClose>
      * <TOTEM:END>
           CLOSE rordini
           .

       CLOSE-tordini.
      * <TOTEM:EPT. INIT:sbloc-m, FD:tordini, BeforeClose>
      * <TOTEM:END>
           CLOSE tordini
           .

       CLOSE-param.
      * <TOTEM:EPT. INIT:sbloc-m, FD:param, BeforeClose>
      * <TOTEM:END>
           CLOSE param
           .

       clienti-cli-K1-MERGE-SPLITBUF.
           INITIALIZE clienti-cli-K1-SPLITBUF
           MOVE cli-tipo-CF OF clienti(1:1) TO 
           clienti-cli-K1-SPLITBUF(1:1)
           MOVE cli-ragsoc-1 OF clienti(1:40) TO 
           clienti-cli-K1-SPLITBUF(2:40)
           MOVE cli-codice OF clienti(1:5) TO 
           clienti-cli-K1-SPLITBUF(42:5)
           .

       clienti-cli-K3-MERGE-SPLITBUF.
           INITIALIZE clienti-cli-K3-SPLITBUF
           MOVE cli-gdo OF clienti(1:5) TO clienti-cli-K3-SPLITBUF(1:5)
           MOVE cli-chiave OF clienti(1:6) TO 
           clienti-cli-K3-SPLITBUF(6:6)
           .

       clienti-cli-K4-MERGE-SPLITBUF.
           INITIALIZE clienti-cli-K4-SPLITBUF
           MOVE cli-utf OF clienti(1:1) TO clienti-cli-K4-SPLITBUF(1:1)
           MOVE cli-chiave OF clienti(1:6) TO 
           clienti-cli-K4-SPLITBUF(2:6)
           .

       DataSet1-clienti-INITSTART.
           IF DataSet1-clienti-KEY-Asc
              MOVE Low-Value TO cli-chiave OF clienti
           ELSE
              MOVE High-Value TO cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-INITEND.
           IF DataSet1-clienti-KEY-Asc
              MOVE High-Value TO cli-chiave OF clienti
           ELSE
              MOVE Low-Value TO cli-chiave OF clienti
           END-IF
           .

      * clienti
       DataSet1-clienti-START.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY >= cli-chiave OF clienti
           ELSE
              START clienti KEY <= cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-START-NOTGREATER.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY <= cli-chiave OF clienti
           ELSE
              START clienti KEY >= cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-START-GREATER.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY > cli-chiave OF clienti
           ELSE
              START clienti KEY < cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-START-LESS.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY < cli-chiave OF clienti
           ELSE
              START clienti KEY > cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-clienti-LOCK
              READ clienti WITH LOCK 
              KEY cli-chiave OF clienti
           ELSE
              READ clienti WITH NO LOCK 
              KEY cli-chiave OF clienti
           END-IF
           PERFORM clienti-cli-K1-MERGE-SPLITBUF
           PERFORM clienti-cli-K3-MERGE-SPLITBUF
           PERFORM clienti-cli-K4-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT 
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-clienti-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-clienti-KEY-Asc
              IF DataSet1-clienti-LOCK
                 READ clienti NEXT WITH LOCK
              ELSE
                 READ clienti NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-clienti-LOCK
                 READ clienti PREVIOUS WITH LOCK
              ELSE
                 READ clienti PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM clienti-cli-K1-MERGE-SPLITBUF
           PERFORM clienti-cli-K3-MERGE-SPLITBUF
           PERFORM clienti-cli-K4-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-clienti-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-clienti-KEY-Asc
              IF DataSet1-clienti-LOCK
                 READ clienti PREVIOUS WITH LOCK
              ELSE
                 READ clienti PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-clienti-LOCK
                 READ clienti NEXT WITH LOCK
              ELSE
                 READ clienti NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM clienti-cli-K1-MERGE-SPLITBUF
           PERFORM clienti-cli-K3-MERGE-SPLITBUF
           PERFORM clienti-cli-K4-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterDelete>
      * <TOTEM:END>
           .

       destini-K1-MERGE-SPLITBUF.
           INITIALIZE destini-K1-SPLITBUF
           MOVE des-ragsoc-1(1:40) TO destini-K1-SPLITBUF(1:40)
           MOVE des-codice(1:5) TO destini-K1-SPLITBUF(41:5)
           MOVE des-prog(1:5) TO destini-K1-SPLITBUF(46:5)
           .

       destini-k-localita-MERGE-SPLITBUF.
           INITIALIZE destini-k-localita-SPLITBUF
           MOVE des-localita(1:35) TO destini-k-localita-SPLITBUF(1:35)
           .

       DataSet1-destini-INITSTART.
           IF DataSet1-destini-KEY-Asc
              MOVE Low-Value TO des-chiave
           ELSE
              MOVE High-Value TO des-chiave
           END-IF
           .

       DataSet1-destini-INITEND.
           IF DataSet1-destini-KEY-Asc
              MOVE High-Value TO des-chiave
           ELSE
              MOVE Low-Value TO des-chiave
           END-IF
           .

      * destini
       DataSet1-destini-START.
           IF DataSet1-destini-KEY-Asc
              START destini KEY >= des-chiave
           ELSE
              START destini KEY <= des-chiave
           END-IF
           .

       DataSet1-destini-START-NOTGREATER.
           IF DataSet1-destini-KEY-Asc
              START destini KEY <= des-chiave
           ELSE
              START destini KEY >= des-chiave
           END-IF
           .

       DataSet1-destini-START-GREATER.
           IF DataSet1-destini-KEY-Asc
              START destini KEY > des-chiave
           ELSE
              START destini KEY < des-chiave
           END-IF
           .

       DataSet1-destini-START-LESS.
           IF DataSet1-destini-KEY-Asc
              START destini KEY < des-chiave
           ELSE
              START destini KEY > des-chiave
           END-IF
           .

       DataSet1-destini-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-destini-LOCK
              READ destini WITH LOCK 
              KEY des-chiave
           ELSE
              READ destini WITH NO LOCK 
              KEY des-chiave
           END-IF
           PERFORM destini-K1-MERGE-SPLITBUF
           PERFORM destini-k-localita-MERGE-SPLITBUF
           MOVE STATUS-destini TO TOTEM-ERR-STAT 
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-destini-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-destini-KEY-Asc
              IF DataSet1-destini-LOCK
                 READ destini NEXT WITH LOCK
              ELSE
                 READ destini NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-destini-LOCK
                 READ destini PREVIOUS WITH LOCK
              ELSE
                 READ destini PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM destini-K1-MERGE-SPLITBUF
           PERFORM destini-k-localita-MERGE-SPLITBUF
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-destini-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-destini-KEY-Asc
              IF DataSet1-destini-LOCK
                 READ destini PREVIOUS WITH LOCK
              ELSE
                 READ destini PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-destini-LOCK
                 READ destini NEXT WITH LOCK
              ELSE
                 READ destini NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM destini-K1-MERGE-SPLITBUF
           PERFORM destini-k-localita-MERGE-SPLITBUF
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-destini-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-destini-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-destini-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterDelete>
      * <TOTEM:END>
           .

       tcaumag-k-mag-MERGE-SPLITBUF.
           INITIALIZE tcaumag-k-mag-SPLITBUF
           MOVE tca-cod-magaz(1:3) TO tcaumag-k-mag-SPLITBUF(1:3)
           MOVE tca-ord-forn(1:1) TO tcaumag-k-mag-SPLITBUF(4:1)
           .

       DataSet1-tcaumag-INITSTART.
           IF DataSet1-tcaumag-KEY-Asc
              MOVE Low-Value TO tca-chiave
           ELSE
              MOVE High-Value TO tca-chiave
           END-IF
           .

       DataSet1-tcaumag-INITEND.
           IF DataSet1-tcaumag-KEY-Asc
              MOVE High-Value TO tca-chiave
           ELSE
              MOVE Low-Value TO tca-chiave
           END-IF
           .

      * tcaumag
       DataSet1-tcaumag-START.
           IF DataSet1-tcaumag-KEY-Asc
              START tcaumag KEY >= tca-chiave
           ELSE
              START tcaumag KEY <= tca-chiave
           END-IF
           .

       DataSet1-tcaumag-START-NOTGREATER.
           IF DataSet1-tcaumag-KEY-Asc
              START tcaumag KEY <= tca-chiave
           ELSE
              START tcaumag KEY >= tca-chiave
           END-IF
           .

       DataSet1-tcaumag-START-GREATER.
           IF DataSet1-tcaumag-KEY-Asc
              START tcaumag KEY > tca-chiave
           ELSE
              START tcaumag KEY < tca-chiave
           END-IF
           .

       DataSet1-tcaumag-START-LESS.
           IF DataSet1-tcaumag-KEY-Asc
              START tcaumag KEY < tca-chiave
           ELSE
              START tcaumag KEY > tca-chiave
           END-IF
           .

       DataSet1-tcaumag-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tcaumag-LOCK
              READ tcaumag WITH LOCK 
              KEY tca-chiave
           ELSE
              READ tcaumag WITH NO LOCK 
              KEY tca-chiave
           END-IF
           PERFORM tcaumag-k-mag-MERGE-SPLITBUF
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT 
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tcaumag-KEY-Asc
              IF DataSet1-tcaumag-LOCK
                 READ tcaumag NEXT WITH LOCK
              ELSE
                 READ tcaumag NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tcaumag-LOCK
                 READ tcaumag PREVIOUS WITH LOCK
              ELSE
                 READ tcaumag PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tcaumag-k-mag-MERGE-SPLITBUF
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tcaumag-KEY-Asc
              IF DataSet1-tcaumag-LOCK
                 READ tcaumag PREVIOUS WITH LOCK
              ELSE
                 READ tcaumag PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tcaumag-LOCK
                 READ tcaumag NEXT WITH LOCK
              ELSE
                 READ tcaumag NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tcaumag-k-mag-MERGE-SPLITBUF
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterDelete>
      * <TOTEM:END>
           .

       articoli-art-k1-MERGE-SPLITBUF.
           INITIALIZE articoli-art-k1-SPLITBUF
           MOVE art-descrizione OF articoli(1:50) TO 
           articoli-art-k1-SPLITBUF(1:50)
           .

       DataSet1-articoli-INITSTART.
           IF DataSet1-articoli-KEY-Asc
              MOVE Low-Value TO art-chiave OF articoli
           ELSE
              MOVE High-Value TO art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-INITEND.
           IF DataSet1-articoli-KEY-Asc
              MOVE High-Value TO art-chiave OF articoli
           ELSE
              MOVE Low-Value TO art-chiave OF articoli
           END-IF
           .

      * articoli
       DataSet1-articoli-START.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY >= art-chiave OF articoli
           ELSE
              START articoli KEY <= art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-START-NOTGREATER.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY <= art-chiave OF articoli
           ELSE
              START articoli KEY >= art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-START-GREATER.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY > art-chiave OF articoli
           ELSE
              START articoli KEY < art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-START-LESS.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY < art-chiave OF articoli
           ELSE
              START articoli KEY > art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-articoli-LOCK
              READ articoli WITH LOCK 
              KEY art-chiave OF articoli
           ELSE
              READ articoli WITH NO LOCK 
              KEY art-chiave OF articoli
           END-IF
           PERFORM articoli-art-k1-MERGE-SPLITBUF
           MOVE STATUS-articoli TO TOTEM-ERR-STAT 
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-articoli-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-articoli-KEY-Asc
              IF DataSet1-articoli-LOCK
                 READ articoli NEXT WITH LOCK
              ELSE
                 READ articoli NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-articoli-LOCK
                 READ articoli PREVIOUS WITH LOCK
              ELSE
                 READ articoli PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM articoli-art-k1-MERGE-SPLITBUF
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-articoli-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-articoli-KEY-Asc
              IF DataSet1-articoli-LOCK
                 READ articoli PREVIOUS WITH LOCK
              ELSE
                 READ articoli PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-articoli-LOCK
                 READ articoli NEXT WITH LOCK
              ELSE
                 READ articoli NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM articoli-art-k1-MERGE-SPLITBUF
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-articoli-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-articoli-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-articoli-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tmarche-INITSTART.
           IF DataSet1-tmarche-KEY-Asc
              MOVE Low-Value TO mar-chiave
           ELSE
              MOVE High-Value TO mar-chiave
           END-IF
           .

       DataSet1-tmarche-INITEND.
           IF DataSet1-tmarche-KEY-Asc
              MOVE High-Value TO mar-chiave
           ELSE
              MOVE Low-Value TO mar-chiave
           END-IF
           .

      * tmarche
       DataSet1-tmarche-START.
           IF DataSet1-tmarche-KEY-Asc
              START tmarche KEY >= mar-chiave
           ELSE
              START tmarche KEY <= mar-chiave
           END-IF
           .

       DataSet1-tmarche-START-NOTGREATER.
           IF DataSet1-tmarche-KEY-Asc
              START tmarche KEY <= mar-chiave
           ELSE
              START tmarche KEY >= mar-chiave
           END-IF
           .

       DataSet1-tmarche-START-GREATER.
           IF DataSet1-tmarche-KEY-Asc
              START tmarche KEY > mar-chiave
           ELSE
              START tmarche KEY < mar-chiave
           END-IF
           .

       DataSet1-tmarche-START-LESS.
           IF DataSet1-tmarche-KEY-Asc
              START tmarche KEY < mar-chiave
           ELSE
              START tmarche KEY > mar-chiave
           END-IF
           .

       DataSet1-tmarche-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tmarche-LOCK
              READ tmarche WITH LOCK 
              KEY mar-chiave
           ELSE
              READ tmarche WITH NO LOCK 
              KEY mar-chiave
           END-IF
           MOVE STATUS-tmarche TO TOTEM-ERR-STAT 
           MOVE "tmarche" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tmarche-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tmarche-KEY-Asc
              IF DataSet1-tmarche-LOCK
                 READ tmarche NEXT WITH LOCK
              ELSE
                 READ tmarche NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tmarche-LOCK
                 READ tmarche PREVIOUS WITH LOCK
              ELSE
                 READ tmarche PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tmarche TO TOTEM-ERR-STAT
           MOVE "tmarche" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tmarche-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tmarche-KEY-Asc
              IF DataSet1-tmarche-LOCK
                 READ tmarche PREVIOUS WITH LOCK
              ELSE
                 READ tmarche PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tmarche-LOCK
                 READ tmarche NEXT WITH LOCK
              ELSE
                 READ tmarche NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tmarche TO TOTEM-ERR-STAT
           MOVE "tmarche" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tmarche-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tmarche TO TOTEM-ERR-STAT
           MOVE "tmarche" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tmarche-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tmarche TO TOTEM-ERR-STAT
           MOVE "tmarche" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tmarche-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tmarche TO TOTEM-ERR-STAT
           MOVE "tmarche" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterDelete>
      * <TOTEM:END>
           .

       progmag-key01-MERGE-SPLITBUF.
           INITIALIZE progmag-key01-SPLITBUF
           MOVE prg-cod-magazzino OF progmag(1:3) TO 
           progmag-key01-SPLITBUF(1:3)
           MOVE prg-cod-articolo OF progmag(1:6) TO 
           progmag-key01-SPLITBUF(4:6)
           MOVE prg-tipo-imballo OF progmag(1:3) TO 
           progmag-key01-SPLITBUF(10:3)
           MOVE prg-peso OF progmag(1:8) TO progmag-key01-SPLITBUF(13:8)
           .

       DataSet1-progmag-INITSTART.
           IF DataSet1-progmag-KEY-Asc
              MOVE Low-Value TO prg-chiave OF progmag
           ELSE
              MOVE High-Value TO prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-INITEND.
           IF DataSet1-progmag-KEY-Asc
              MOVE High-Value TO prg-chiave OF progmag
           ELSE
              MOVE Low-Value TO prg-chiave OF progmag
           END-IF
           .

      * progmag
       DataSet1-progmag-START.
           IF DataSet1-progmag-KEY-Asc
              START progmag KEY >= prg-chiave OF progmag
           ELSE
              START progmag KEY <= prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-START-NOTGREATER.
           IF DataSet1-progmag-KEY-Asc
              START progmag KEY <= prg-chiave OF progmag
           ELSE
              START progmag KEY >= prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-START-GREATER.
           IF DataSet1-progmag-KEY-Asc
              START progmag KEY > prg-chiave OF progmag
           ELSE
              START progmag KEY < prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-START-LESS.
           IF DataSet1-progmag-KEY-Asc
              START progmag KEY < prg-chiave OF progmag
           ELSE
              START progmag KEY > prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-progmag-LOCK
              READ progmag WITH LOCK 
              KEY prg-chiave OF progmag
           ELSE
              READ progmag WITH NO LOCK 
              KEY prg-chiave OF progmag
           END-IF
           PERFORM progmag-key01-MERGE-SPLITBUF
           MOVE STATUS-progmag TO TOTEM-ERR-STAT 
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-progmag-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-progmag-KEY-Asc
              IF DataSet1-progmag-LOCK
                 READ progmag NEXT WITH LOCK
              ELSE
                 READ progmag NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-progmag-LOCK
                 READ progmag PREVIOUS WITH LOCK
              ELSE
                 READ progmag PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM progmag-key01-MERGE-SPLITBUF
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-progmag-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-progmag-KEY-Asc
              IF DataSet1-progmag-LOCK
                 READ progmag PREVIOUS WITH LOCK
              ELSE
                 READ progmag PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-progmag-LOCK
                 READ progmag NEXT WITH LOCK
              ELSE
                 READ progmag NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM progmag-key01-MERGE-SPLITBUF
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-progmag-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-progmag-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-progmag-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-ttipocli-INITSTART.
           IF DataSet1-ttipocli-KEY-Asc
              MOVE Low-Value TO tcl-chiave
           ELSE
              MOVE High-Value TO tcl-chiave
           END-IF
           .

       DataSet1-ttipocli-INITEND.
           IF DataSet1-ttipocli-KEY-Asc
              MOVE High-Value TO tcl-chiave
           ELSE
              MOVE Low-Value TO tcl-chiave
           END-IF
           .

      * ttipocli
       DataSet1-ttipocli-START.
           IF DataSet1-ttipocli-KEY-Asc
              START ttipocli KEY >= tcl-chiave
           ELSE
              START ttipocli KEY <= tcl-chiave
           END-IF
           .

       DataSet1-ttipocli-START-NOTGREATER.
           IF DataSet1-ttipocli-KEY-Asc
              START ttipocli KEY <= tcl-chiave
           ELSE
              START ttipocli KEY >= tcl-chiave
           END-IF
           .

       DataSet1-ttipocli-START-GREATER.
           IF DataSet1-ttipocli-KEY-Asc
              START ttipocli KEY > tcl-chiave
           ELSE
              START ttipocli KEY < tcl-chiave
           END-IF
           .

       DataSet1-ttipocli-START-LESS.
           IF DataSet1-ttipocli-KEY-Asc
              START ttipocli KEY < tcl-chiave
           ELSE
              START ttipocli KEY > tcl-chiave
           END-IF
           .

       DataSet1-ttipocli-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-ttipocli-LOCK
              READ ttipocli WITH LOCK 
              KEY tcl-chiave
           ELSE
              READ ttipocli WITH NO LOCK 
              KEY tcl-chiave
           END-IF
           MOVE STATUS-ttipocli TO TOTEM-ERR-STAT 
           MOVE "ttipocli" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-ttipocli-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-ttipocli-KEY-Asc
              IF DataSet1-ttipocli-LOCK
                 READ ttipocli NEXT WITH LOCK
              ELSE
                 READ ttipocli NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-ttipocli-LOCK
                 READ ttipocli PREVIOUS WITH LOCK
              ELSE
                 READ ttipocli PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-ttipocli TO TOTEM-ERR-STAT
           MOVE "ttipocli" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-ttipocli-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-ttipocli-KEY-Asc
              IF DataSet1-ttipocli-LOCK
                 READ ttipocli PREVIOUS WITH LOCK
              ELSE
                 READ ttipocli PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-ttipocli-LOCK
                 READ ttipocli NEXT WITH LOCK
              ELSE
                 READ ttipocli NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-ttipocli TO TOTEM-ERR-STAT
           MOVE "ttipocli" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-ttipocli-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-ttipocli TO TOTEM-ERR-STAT
           MOVE "ttipocli" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-ttipocli-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-ttipocli TO TOTEM-ERR-STAT
           MOVE "ttipocli" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-ttipocli-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-ttipocli TO TOTEM-ERR-STAT
           MOVE "ttipocli" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tpiombo-INITSTART.
           IF DataSet1-tpiombo-KEY-Asc
              MOVE Low-Value TO tpb-chiave
           ELSE
              MOVE High-Value TO tpb-chiave
           END-IF
           .

       DataSet1-tpiombo-INITEND.
           IF DataSet1-tpiombo-KEY-Asc
              MOVE High-Value TO tpb-chiave
           ELSE
              MOVE Low-Value TO tpb-chiave
           END-IF
           .

      * tpiombo
       DataSet1-tpiombo-START.
           IF DataSet1-tpiombo-KEY-Asc
              START tpiombo KEY >= tpb-chiave
           ELSE
              START tpiombo KEY <= tpb-chiave
           END-IF
           .

       DataSet1-tpiombo-START-NOTGREATER.
           IF DataSet1-tpiombo-KEY-Asc
              START tpiombo KEY <= tpb-chiave
           ELSE
              START tpiombo KEY >= tpb-chiave
           END-IF
           .

       DataSet1-tpiombo-START-GREATER.
           IF DataSet1-tpiombo-KEY-Asc
              START tpiombo KEY > tpb-chiave
           ELSE
              START tpiombo KEY < tpb-chiave
           END-IF
           .

       DataSet1-tpiombo-START-LESS.
           IF DataSet1-tpiombo-KEY-Asc
              START tpiombo KEY < tpb-chiave
           ELSE
              START tpiombo KEY > tpb-chiave
           END-IF
           .

       DataSet1-tpiombo-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tpiombo-LOCK
              READ tpiombo WITH LOCK 
              KEY tpb-chiave
           ELSE
              READ tpiombo WITH NO LOCK 
              KEY tpb-chiave
           END-IF
           MOVE STATUS-tpiombo TO TOTEM-ERR-STAT 
           MOVE "tpiombo" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tpiombo-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tpiombo-KEY-Asc
              IF DataSet1-tpiombo-LOCK
                 READ tpiombo NEXT WITH LOCK
              ELSE
                 READ tpiombo NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tpiombo-LOCK
                 READ tpiombo PREVIOUS WITH LOCK
              ELSE
                 READ tpiombo PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tpiombo TO TOTEM-ERR-STAT
           MOVE "tpiombo" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tpiombo-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tpiombo-KEY-Asc
              IF DataSet1-tpiombo-LOCK
                 READ tpiombo PREVIOUS WITH LOCK
              ELSE
                 READ tpiombo PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tpiombo-LOCK
                 READ tpiombo NEXT WITH LOCK
              ELSE
                 READ tpiombo NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tpiombo TO TOTEM-ERR-STAT
           MOVE "tpiombo" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tpiombo-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tpiombo TO TOTEM-ERR-STAT
           MOVE "tpiombo" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tpiombo-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tpiombo TO TOTEM-ERR-STAT
           MOVE "tpiombo" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tpiombo-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tpiombo TO TOTEM-ERR-STAT
           MOVE "tpiombo" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, AfterDelete>
      * <TOTEM:END>
           .

       mtordini-mto-k-ord-cli-MERGE-SPLITBUF.
           INITIALIZE mtordini-mto-k-ord-cli-SPLITBUF
           MOVE mto-anno(1:4) TO mtordini-mto-k-ord-cli-SPLITBUF(1:4)
           MOVE mto-num-ord-cli(1:10) TO 
           mtordini-mto-k-ord-cli-SPLITBUF(5:10)
           .

       mtordini-mto-k-data-MERGE-SPLITBUF.
           INITIALIZE mtordini-mto-k-data-SPLITBUF
           MOVE mto-data-ordine(1:8) TO 
           mtordini-mto-k-data-SPLITBUF(1:8)
           MOVE mto-chiave(1:12) TO mtordini-mto-k-data-SPLITBUF(9:12)
           .

       mtordini-mto-k-clides-MERGE-SPLITBUF.
           INITIALIZE mtordini-mto-k-clides-SPLITBUF
           MOVE mto-cod-cli(1:5) TO mtordini-mto-k-clides-SPLITBUF(1:5)
           MOVE mto-prg-destino(1:5) TO 
           mtordini-mto-k-clides-SPLITBUF(6:5)
           MOVE mto-data-ordine(1:8) TO 
           mtordini-mto-k-clides-SPLITBUF(11:8)
           .

       mtordini-mto-k-age-MERGE-SPLITBUF.
           INITIALIZE mtordini-mto-k-age-SPLITBUF
           MOVE mto-cod-agente(1:5) TO mtordini-mto-k-age-SPLITBUF(1:5)
           MOVE mto-data-ordine(1:8) TO mtordini-mto-k-age-SPLITBUF(6:8)
           .

       mtordini-k-mto-stato-sel-MERGE-SPLITBUF.
           INITIALIZE mtordini-k-mto-stato-sel-SPLITBUF
           MOVE mto-stato-ordine(1:1) TO 
           mtordini-k-mto-stato-sel-SPLITBUF(1:1)
           MOVE mto-cod-cli(1:5) TO 
           mtordini-k-mto-stato-sel-SPLITBUF(2:5)
           MOVE mto-data-ordine(1:8) TO 
           mtordini-k-mto-stato-sel-SPLITBUF(7:8)
           .

       mtordini-k-mto-stato-MERGE-SPLITBUF.
           INITIALIZE mtordini-k-mto-stato-SPLITBUF
           MOVE mto-stato-ordine(1:1) TO 
           mtordini-k-mto-stato-SPLITBUF(1:1)
           MOVE mto-chiave(1:12) TO mtordini-k-mto-stato-SPLITBUF(2:12)
           .

       mtordini-mto-k-gdo-MERGE-SPLITBUF.
           INITIALIZE mtordini-mto-k-gdo-SPLITBUF
           MOVE mto-gdo(1:5) TO mtordini-mto-k-gdo-SPLITBUF(1:5)
           MOVE mto-data-ordine(1:8) TO mtordini-mto-k-gdo-SPLITBUF(6:8)
           MOVE mto-chiave(1:12) TO mtordini-mto-k-gdo-SPLITBUF(14:12)
           .

       mtordini-mto-k-bloc-MERGE-SPLITBUF.
           INITIALIZE mtordini-mto-k-bloc-SPLITBUF
           MOVE mto-stato-attivazione(1:1) TO 
           mtordini-mto-k-bloc-SPLITBUF(1:1)
           MOVE mto-data-ordine(1:8) TO 
           mtordini-mto-k-bloc-SPLITBUF(2:8)
           MOVE mto-cod-cli(1:5) TO mtordini-mto-k-bloc-SPLITBUF(10:5)
           MOVE mto-prg-destino(1:5) TO 
           mtordini-mto-k-bloc-SPLITBUF(15:5)
           .

       mtordini-k-giang-MERGE-SPLITBUF.
           INITIALIZE mtordini-k-giang-SPLITBUF
           MOVE mto-data-note1(1:8) TO mtordini-k-giang-SPLITBUF(1:8)
           MOVE mto-chiave(1:12) TO mtordini-k-giang-SPLITBUF(9:12)
           .

       DataSet1-mtordini-INITSTART.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-mtordini-KEY1-Asc
                 MOVE Low-Value TO mto-chiave
              ELSE
                 MOVE High-Value TO mto-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-mtordini-INITEND.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-mtordini-KEY1-Asc
                 MOVE High-Value TO mto-chiave
              ELSE
                 MOVE Low-Value TO mto-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           .   

       DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-mtordini-KEY1-ORDER
           END-EVALUATE
           .

       DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-mtordini-KEY1-ORDER
           END-EVALUATE
           .

      * mtordini
       DataSet1-mtordini-START.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-mtordini-KEY1-Asc
                 START mtordini KEY >= mto-chiave
              ELSE
                 START mtordini KEY <= mto-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-mtordini-START-NOTGREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-mtordini-KEY1-Asc
                 START mtordini KEY <= mto-chiave
              ELSE
                 START mtordini KEY >= mto-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-mtordini-START-GREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-mtordini-KEY1-Asc
                 START mtordini KEY > mto-chiave
              ELSE
                 START mtordini KEY < mto-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-mtordini-START-LESS.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-mtordini-KEY1-Asc
                 START mtordini KEY < mto-chiave
              ELSE
                 START mtordini KEY > mto-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-mtordini-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, BeforeReadRecord>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-mtordini-LOCK
                 READ mtordini WITH LOCK 
                 KEY mto-chiave
              ELSE
                 READ mtordini WITH NO LOCK 
                 KEY mto-chiave
              END-IF
           END-EVALUATE
           PERFORM mtordini-mto-k-ord-cli-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-data-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-clides-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-age-MERGE-SPLITBUF
           PERFORM mtordini-k-mto-stato-sel-MERGE-SPLITBUF
           PERFORM mtordini-k-mto-stato-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-gdo-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-bloc-MERGE-SPLITBUF
           PERFORM mtordini-k-giang-MERGE-SPLITBUF
           MOVE STATUS-mtordini TO TOTEM-ERR-STAT 
           MOVE "mtordini" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-mtordini-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, BeforeReadNext>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-mtordini-KEY1-Asc
                 IF DataSet1-mtordini-LOCK
                    READ mtordini NEXT WITH LOCK
                 ELSE
                    READ mtordini NEXT WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-mtordini-LOCK
                    READ mtordini PREVIOUS WITH LOCK
                 ELSE
                    READ mtordini PREVIOUS WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           PERFORM mtordini-mto-k-ord-cli-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-data-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-clides-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-age-MERGE-SPLITBUF
           PERFORM mtordini-k-mto-stato-sel-MERGE-SPLITBUF
           PERFORM mtordini-k-mto-stato-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-gdo-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-bloc-MERGE-SPLITBUF
           PERFORM mtordini-k-giang-MERGE-SPLITBUF
           MOVE STATUS-mtordini TO TOTEM-ERR-STAT
           MOVE "mtordini" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-mtordini-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, BeforeReadPrev>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-mtordini-KEY1-Asc
                 IF DataSet1-mtordini-LOCK
                    READ mtordini PREVIOUS WITH LOCK
                 ELSE
                    READ mtordini PREVIOUS WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-mtordini-LOCK
                    READ mtordini NEXT WITH LOCK
                 ELSE
                    READ mtordini NEXT WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           PERFORM mtordini-mto-k-ord-cli-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-data-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-clides-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-age-MERGE-SPLITBUF
           PERFORM mtordini-k-mto-stato-sel-MERGE-SPLITBUF
           PERFORM mtordini-k-mto-stato-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-gdo-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-bloc-MERGE-SPLITBUF
           PERFORM mtordini-k-giang-MERGE-SPLITBUF
           MOVE STATUS-mtordini TO TOTEM-ERR-STAT
           MOVE "mtordini" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-mtordini-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, BeforeWrite>
      * <TOTEM:END>
           WRITE mto-rec OF mtordini.
           MOVE STATUS-mtordini TO TOTEM-ERR-STAT
           MOVE "mtordini" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-mtordini-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, BeforeRewrite>
      * <TOTEM:END>
           REWRITE mto-rec OF mtordini.
           MOVE STATUS-mtordini TO TOTEM-ERR-STAT
           MOVE "mtordini" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-mtordini-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, BeforeDelete>
      * <TOTEM:END>
           DELETE mtordini.
           MOVE STATUS-mtordini TO TOTEM-ERR-STAT
           MOVE "mtordini" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, AfterDelete>
      * <TOTEM:END>
           .

       mrordini-mro-k-promo-MERGE-SPLITBUF.
           INITIALIZE mrordini-mro-k-promo-SPLITBUF
           MOVE mro-promo(1:15) TO mrordini-mro-k-promo-SPLITBUF(1:15)
           MOVE mro-chiave(1:17) TO mrordini-mro-k-promo-SPLITBUF(16:17)
           .

       mrordini-mro-k-articolo-MERGE-SPLITBUF.
           INITIALIZE mrordini-mro-k-articolo-SPLITBUF
           MOVE mro-cod-articolo(1:6) TO 
           mrordini-mro-k-articolo-SPLITBUF(1:6)
           MOVE mro-chiave(1:17) TO 
           mrordini-mro-k-articolo-SPLITBUF(7:17)
           .

       mrordini-mro-k-progr-MERGE-SPLITBUF.
           INITIALIZE mrordini-mro-k-progr-SPLITBUF
           MOVE mro-chiave-testa(1:12) TO 
           mrordini-mro-k-progr-SPLITBUF(1:12)
           MOVE mro-progr(1:5) TO mrordini-mro-k-progr-SPLITBUF(13:5)
           .

       mrordini-mro-k-tprev-MERGE-SPLITBUF.
           INITIALIZE mrordini-mro-k-tprev-SPLITBUF
           MOVE mro-promo(1:15) TO mrordini-mro-k-tprev-SPLITBUF(1:15)
           MOVE mro-prg-cod-articolo(1:6) TO 
           mrordini-mro-k-tprev-SPLITBUF(16:6)
           MOVE mro-chiave(1:17) TO mrordini-mro-k-tprev-SPLITBUF(22:17)
           .

       DataSet1-mrordini-INITSTART.
           IF DataSet1-mrordini-KEY-Asc
              MOVE Low-Value TO mro-chiave
           ELSE
              MOVE High-Value TO mro-chiave
           END-IF
           .

       DataSet1-mrordini-INITEND.
           IF DataSet1-mrordini-KEY-Asc
              MOVE High-Value TO mro-chiave
           ELSE
              MOVE Low-Value TO mro-chiave
           END-IF
           .

      * mrordini
       DataSet1-mrordini-START.
           IF DataSet1-mrordini-KEY-Asc
              START mrordini KEY >= mro-chiave
           ELSE
              START mrordini KEY <= mro-chiave
           END-IF
           .

       DataSet1-mrordini-START-NOTGREATER.
           IF DataSet1-mrordini-KEY-Asc
              START mrordini KEY <= mro-chiave
           ELSE
              START mrordini KEY >= mro-chiave
           END-IF
           .

       DataSet1-mrordini-START-GREATER.
           IF DataSet1-mrordini-KEY-Asc
              START mrordini KEY > mro-chiave
           ELSE
              START mrordini KEY < mro-chiave
           END-IF
           .

       DataSet1-mrordini-START-LESS.
           IF DataSet1-mrordini-KEY-Asc
              START mrordini KEY < mro-chiave
           ELSE
              START mrordini KEY > mro-chiave
           END-IF
           .

       DataSet1-mrordini-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-mrordini-LOCK
              READ mrordini WITH LOCK 
              KEY mro-chiave
           ELSE
              READ mrordini WITH NO LOCK 
              KEY mro-chiave
           END-IF
           PERFORM mrordini-mro-k-promo-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-articolo-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-progr-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-tprev-MERGE-SPLITBUF
           MOVE STATUS-mrordini TO TOTEM-ERR-STAT 
           MOVE "mrordini" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-mrordini-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-mrordini-KEY-Asc
              IF DataSet1-mrordini-LOCK
                 READ mrordini NEXT WITH LOCK
              ELSE
                 READ mrordini NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-mrordini-LOCK
                 READ mrordini PREVIOUS WITH LOCK
              ELSE
                 READ mrordini PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM mrordini-mro-k-promo-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-articolo-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-progr-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-tprev-MERGE-SPLITBUF
           MOVE STATUS-mrordini TO TOTEM-ERR-STAT
           MOVE "mrordini" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-mrordini-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-mrordini-KEY-Asc
              IF DataSet1-mrordini-LOCK
                 READ mrordini PREVIOUS WITH LOCK
              ELSE
                 READ mrordini PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-mrordini-LOCK
                 READ mrordini NEXT WITH LOCK
              ELSE
                 READ mrordini NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM mrordini-mro-k-promo-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-articolo-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-progr-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-tprev-MERGE-SPLITBUF
           MOVE STATUS-mrordini TO TOTEM-ERR-STAT
           MOVE "mrordini" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-mrordini-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, BeforeWrite>
      * <TOTEM:END>
           WRITE mro-rec OF mrordini.
           MOVE STATUS-mrordini TO TOTEM-ERR-STAT
           MOVE "mrordini" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-mrordini-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, BeforeRewrite>
      * <TOTEM:END>
           REWRITE mro-rec OF mrordini.
           MOVE STATUS-mrordini TO TOTEM-ERR-STAT
           MOVE "mrordini" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-mrordini-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, BeforeDelete>
      * <TOTEM:END>
           DELETE mrordini.
           MOVE STATUS-mrordini TO TOTEM-ERR-STAT
           MOVE "mrordini" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tparamge-INITSTART.
           IF DataSet1-tparamge-KEY-Asc
              MOVE Low-Value TO tge-chiave
           ELSE
              MOVE High-Value TO tge-chiave
           END-IF
           .

       DataSet1-tparamge-INITEND.
           IF DataSet1-tparamge-KEY-Asc
              MOVE High-Value TO tge-chiave
           ELSE
              MOVE Low-Value TO tge-chiave
           END-IF
           .

      * tparamge
       DataSet1-tparamge-START.
           IF DataSet1-tparamge-KEY-Asc
              START tparamge KEY >= tge-chiave
           ELSE
              START tparamge KEY <= tge-chiave
           END-IF
           .

       DataSet1-tparamge-START-NOTGREATER.
           IF DataSet1-tparamge-KEY-Asc
              START tparamge KEY <= tge-chiave
           ELSE
              START tparamge KEY >= tge-chiave
           END-IF
           .

       DataSet1-tparamge-START-GREATER.
           IF DataSet1-tparamge-KEY-Asc
              START tparamge KEY > tge-chiave
           ELSE
              START tparamge KEY < tge-chiave
           END-IF
           .

       DataSet1-tparamge-START-LESS.
           IF DataSet1-tparamge-KEY-Asc
              START tparamge KEY < tge-chiave
           ELSE
              START tparamge KEY > tge-chiave
           END-IF
           .

       DataSet1-tparamge-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tparamge-LOCK
              READ tparamge WITH LOCK 
              KEY tge-chiave
           ELSE
              READ tparamge WITH NO LOCK 
              KEY tge-chiave
           END-IF
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT 
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tparamge-KEY-Asc
              IF DataSet1-tparamge-LOCK
                 READ tparamge NEXT WITH LOCK
              ELSE
                 READ tparamge NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tparamge-LOCK
                 READ tparamge PREVIOUS WITH LOCK
              ELSE
                 READ tparamge PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tparamge-KEY-Asc
              IF DataSet1-tparamge-LOCK
                 READ tparamge PREVIOUS WITH LOCK
              ELSE
                 READ tparamge PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tparamge-LOCK
                 READ tparamge NEXT WITH LOCK
              ELSE
                 READ tparamge NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterDelete>
      * <TOTEM:END>
           .

       rordini-ror-k-promo-MERGE-SPLITBUF.
           INITIALIZE rordini-ror-k-promo-SPLITBUF
           MOVE ror-promo OF rordini(1:15) TO 
           rordini-ror-k-promo-SPLITBUF(1:15)
           .

       rordini-ror-k-articolo-MERGE-SPLITBUF.
           INITIALIZE rordini-ror-k-articolo-SPLITBUF
           MOVE ror-cod-articolo OF rordini(1:6) TO 
           rordini-ror-k-articolo-SPLITBUF(1:6)
           MOVE ror-chiave OF rordini(1:17) TO 
           rordini-ror-k-articolo-SPLITBUF(7:17)
           .

       rordini-ror-k-master-MERGE-SPLITBUF.
           INITIALIZE rordini-ror-k-master-SPLITBUF
           MOVE ror-chiave-ordine OF rordini(1:17) TO 
           rordini-ror-k-master-SPLITBUF(1:17)
           MOVE ror-chiave OF rordini(1:17) TO 
           rordini-ror-k-master-SPLITBUF(18:17)
           .

       rordini-ror-k-stbolle-MERGE-SPLITBUF.
           INITIALIZE rordini-ror-k-stbolle-SPLITBUF
           MOVE ror-anno OF rordini(1:4) TO 
           rordini-ror-k-stbolle-SPLITBUF(1:4)
           MOVE ror-num-ordine OF rordini(1:8) TO 
           rordini-ror-k-stbolle-SPLITBUF(5:8)
           MOVE ror-chiave-ordine OF rordini(1:17) TO 
           rordini-ror-k-stbolle-SPLITBUF(13:17)
           .

       DataSet1-rordini-INITSTART.
           IF DataSet1-rordini-KEY-Asc
              MOVE Low-Value TO ror-chiave OF rordini
           ELSE
              MOVE High-Value TO ror-chiave OF rordini
           END-IF
           .

       DataSet1-rordini-INITEND.
           IF DataSet1-rordini-KEY-Asc
              MOVE High-Value TO ror-chiave OF rordini
           ELSE
              MOVE Low-Value TO ror-chiave OF rordini
           END-IF
           .

      * rordini
       DataSet1-rordini-START.
           IF DataSet1-rordini-KEY-Asc
              START rordini KEY >= ror-chiave OF rordini
           ELSE
              START rordini KEY <= ror-chiave OF rordini
           END-IF
           .

       DataSet1-rordini-START-NOTGREATER.
           IF DataSet1-rordini-KEY-Asc
              START rordini KEY <= ror-chiave OF rordini
           ELSE
              START rordini KEY >= ror-chiave OF rordini
           END-IF
           .

       DataSet1-rordini-START-GREATER.
           IF DataSet1-rordini-KEY-Asc
              START rordini KEY > ror-chiave OF rordini
           ELSE
              START rordini KEY < ror-chiave OF rordini
           END-IF
           .

       DataSet1-rordini-START-LESS.
           IF DataSet1-rordini-KEY-Asc
              START rordini KEY < ror-chiave OF rordini
           ELSE
              START rordini KEY > ror-chiave OF rordini
           END-IF
           .

       DataSet1-rordini-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-rordini-LOCK
              READ rordini WITH LOCK 
              KEY ror-chiave OF rordini
           ELSE
              READ rordini WITH NO LOCK 
              KEY ror-chiave OF rordini
           END-IF
           PERFORM rordini-ror-k-promo-MERGE-SPLITBUF
           PERFORM rordini-ror-k-articolo-MERGE-SPLITBUF
           PERFORM rordini-ror-k-master-MERGE-SPLITBUF
           PERFORM rordini-ror-k-stbolle-MERGE-SPLITBUF
           MOVE STATUS-rordini TO TOTEM-ERR-STAT 
           MOVE "rordini" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-rordini-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-rordini-KEY-Asc
              IF DataSet1-rordini-LOCK
                 READ rordini NEXT WITH LOCK
              ELSE
                 READ rordini NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-rordini-LOCK
                 READ rordini PREVIOUS WITH LOCK
              ELSE
                 READ rordini PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM rordini-ror-k-promo-MERGE-SPLITBUF
           PERFORM rordini-ror-k-articolo-MERGE-SPLITBUF
           PERFORM rordini-ror-k-master-MERGE-SPLITBUF
           PERFORM rordini-ror-k-stbolle-MERGE-SPLITBUF
           MOVE STATUS-rordini TO TOTEM-ERR-STAT
           MOVE "rordini" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-rordini-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-rordini-KEY-Asc
              IF DataSet1-rordini-LOCK
                 READ rordini PREVIOUS WITH LOCK
              ELSE
                 READ rordini PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-rordini-LOCK
                 READ rordini NEXT WITH LOCK
              ELSE
                 READ rordini NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM rordini-ror-k-promo-MERGE-SPLITBUF
           PERFORM rordini-ror-k-articolo-MERGE-SPLITBUF
           PERFORM rordini-ror-k-master-MERGE-SPLITBUF
           PERFORM rordini-ror-k-stbolle-MERGE-SPLITBUF
           MOVE STATUS-rordini TO TOTEM-ERR-STAT
           MOVE "rordini" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-rordini-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, BeforeWrite>
      * <TOTEM:END>
           WRITE ror-rec OF rordini.
           MOVE STATUS-rordini TO TOTEM-ERR-STAT
           MOVE "rordini" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-rordini-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, BeforeRewrite>
      * <TOTEM:END>
           REWRITE ror-rec OF rordini.
           MOVE STATUS-rordini TO TOTEM-ERR-STAT
           MOVE "rordini" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-rordini-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, BeforeDelete>
      * <TOTEM:END>
           DELETE rordini.
           MOVE STATUS-rordini TO TOTEM-ERR-STAT
           MOVE "rordini" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, AfterDelete>
      * <TOTEM:END>
           .

       tordini-k-causale-MERGE-SPLITBUF.
           INITIALIZE tordini-k-causale-SPLITBUF
           MOVE tor-causale(1:4) TO tordini-k-causale-SPLITBUF(1:4)
           MOVE tor-anno(1:4) TO tordini-k-causale-SPLITBUF(5:4)
           MOVE tor-numero(1:8) TO tordini-k-causale-SPLITBUF(9:8)
           .

       tordini-k1-MERGE-SPLITBUF.
           INITIALIZE tordini-k1-SPLITBUF
           MOVE tor-cod-cli(1:5) TO tordini-k1-SPLITBUF(1:5)
           MOVE tor-prg-destino(1:5) TO tordini-k1-SPLITBUF(6:5)
           MOVE tor-anno(1:4) TO tordini-k1-SPLITBUF(11:4)
           MOVE tor-numero(1:8) TO tordini-k1-SPLITBUF(15:8)
           .

       tordini-k2-MERGE-SPLITBUF.
           INITIALIZE tordini-k2-SPLITBUF
           MOVE tor-data-passaggio-ordine(1:8) TO 
           tordini-k2-SPLITBUF(1:8)
           MOVE tor-anno(1:4) TO tordini-k2-SPLITBUF(9:4)
           MOVE tor-numero(1:8) TO tordini-k2-SPLITBUF(13:8)
           .

       tordini-k-bolla-MERGE-SPLITBUF.
           INITIALIZE tordini-k-bolla-SPLITBUF
           MOVE tor-anno-bolla(1:4) TO tordini-k-bolla-SPLITBUF(1:4)
           MOVE tor-num-bolla(1:8) TO tordini-k-bolla-SPLITBUF(5:8)
           .

       tordini-k3-MERGE-SPLITBUF.
           INITIALIZE tordini-k3-SPLITBUF
           MOVE tor-anno-bolla(1:4) TO tordini-k3-SPLITBUF(1:4)
           MOVE tor-data-bolla(1:8) TO tordini-k3-SPLITBUF(5:8)
           MOVE tor-num-bolla(1:8) TO tordini-k3-SPLITBUF(13:8)
           MOVE tor-bolla-prenotata(1:1) TO tordini-k3-SPLITBUF(21:1)
           .

       tordini-k-fattura-MERGE-SPLITBUF.
           INITIALIZE tordini-k-fattura-SPLITBUF
           MOVE tor-anno-fattura(1:4) TO tordini-k-fattura-SPLITBUF(1:4)
           MOVE tor-num-fattura(1:8) TO tordini-k-fattura-SPLITBUF(5:8)
           .

       tordini-k4-MERGE-SPLITBUF.
           INITIALIZE tordini-k4-SPLITBUF
           MOVE tor-anno-fattura(1:4) TO tordini-k4-SPLITBUF(1:4)
           MOVE tor-data-fattura(1:8) TO tordini-k4-SPLITBUF(5:8)
           MOVE tor-num-fattura(1:8) TO tordini-k4-SPLITBUF(13:8)
           MOVE tor-num-prenot(1:8) TO tordini-k4-SPLITBUF(21:8)
           MOVE tor-fatt-prenotata(1:1) TO tordini-k4-SPLITBUF(29:1)
           .

       tordini-k-contab-MERGE-SPLITBUF.
           INITIALIZE tordini-k-contab-SPLITBUF
           MOVE tor-agg-contab(1:1) TO tordini-k-contab-SPLITBUF(1:1)
           MOVE tor-anno-fattura(1:4) TO tordini-k-contab-SPLITBUF(2:4)
           MOVE tor-num-fattura(1:8) TO tordini-k-contab-SPLITBUF(6:8)
           .

       tordini-k-tipo-MERGE-SPLITBUF.
           INITIALIZE tordini-k-tipo-SPLITBUF
           MOVE tor-tipo(1:1) TO tordini-k-tipo-SPLITBUF(1:1)
           MOVE tor-chiave(1:12) TO tordini-k-tipo-SPLITBUF(2:12)
           .

       tordini-k-data-MERGE-SPLITBUF.
           INITIALIZE tordini-k-data-SPLITBUF
           MOVE tor-data-creazione(1:8) TO tordini-k-data-SPLITBUF(1:8)
           MOVE tor-numero(1:8) TO tordini-k-data-SPLITBUF(9:8)
           .

       tordini-k-agfatt-MERGE-SPLITBUF.
           INITIALIZE tordini-k-agfatt-SPLITBUF
           MOVE tor-anno-fattura(1:4) TO tordini-k-agfatt-SPLITBUF(1:4)
           MOVE tor-data-fattura(1:8) TO tordini-k-agfatt-SPLITBUF(5:8)
           MOVE tor-num-fattura(1:8) TO tordini-k-agfatt-SPLITBUF(13:8)
           MOVE tor-num-prenot(1:8) TO tordini-k-agfatt-SPLITBUF(21:8)
           MOVE tor-fatt-prenotata(1:1) TO 
           tordini-k-agfatt-SPLITBUF(29:1)
           MOVE tor-chiave(1:12) TO tordini-k-agfatt-SPLITBUF(30:12)
           .

       tordini-k-stbolle-MERGE-SPLITBUF.
           INITIALIZE tordini-k-stbolle-SPLITBUF
           MOVE tor-anno-bolla(1:4) TO tordini-k-stbolle-SPLITBUF(1:4)
           MOVE tor-data-bolla(1:8) TO tordini-k-stbolle-SPLITBUF(5:8)
           MOVE tor-num-bolla(1:8) TO tordini-k-stbolle-SPLITBUF(13:8)
           MOVE tor-bolla-prenotata(1:1) TO 
           tordini-k-stbolle-SPLITBUF(21:1)
           MOVE tor-chiave(1:12) TO tordini-k-stbolle-SPLITBUF(22:12)
           .

       tordini-k-andamento-data-MERGE-SPLITBUF.
           INITIALIZE tordini-k-andamento-data-SPLITBUF
           MOVE tor-agg-contab(1:1) TO 
           tordini-k-andamento-data-SPLITBUF(1:1)
           MOVE tor-data-fattura(1:8) TO 
           tordini-k-andamento-data-SPLITBUF(2:8)
           .

       tordini-k-andamento-cliente-MERGE-SPLITBUF.
           INITIALIZE tordini-k-andamento-cliente-SPLITBUF
           MOVE tor-cod-cli(1:5) TO 
           tordini-k-andamento-cliente-SPLITBUF(1:5)
           MOVE tor-agg-contab(1:1) TO 
           tordini-k-andamento-cliente-SPLITBUF(6:1)
           MOVE tor-data-fattura(1:8) TO 
           tordini-k-andamento-cliente-SPLITBUF(7:8)
           .

       tordini-k-andamento-clides-MERGE-SPLITBUF.
           INITIALIZE tordini-k-andamento-clides-SPLITBUF
           MOVE tor-cod-cli(1:5) TO 
           tordini-k-andamento-clides-SPLITBUF(1:5)
           MOVE tor-prg-destino(1:5) TO 
           tordini-k-andamento-clides-SPLITBUF(6:5)
           MOVE tor-agg-contab(1:1) TO 
           tordini-k-andamento-clides-SPLITBUF(11:1)
           MOVE tor-data-fattura(1:8) TO 
           tordini-k-andamento-clides-SPLITBUF(12:8)
           .

       tordini-k-promo-MERGE-SPLITBUF.
           INITIALIZE tordini-k-promo-SPLITBUF
           MOVE tor-stato(1:1) TO tordini-k-promo-SPLITBUF(1:1)
           MOVE tor-promo(1:1) TO tordini-k-promo-SPLITBUF(2:1)
           MOVE tor-data-ordine(1:8) TO tordini-k-promo-SPLITBUF(3:8)
           MOVE tor-numero(1:8) TO tordini-k-promo-SPLITBUF(11:8)
           MOVE tor-cod-cli(1:5) TO tordini-k-promo-SPLITBUF(19:5)
           MOVE tor-prg-destino(1:5) TO tordini-k-promo-SPLITBUF(24:5)
           .

       tordini-k-or-MERGE-SPLITBUF.
           INITIALIZE tordini-k-or-SPLITBUF
           MOVE tor-cod-cli(1:5) TO tordini-k-or-SPLITBUF(1:5)
           MOVE tor-prg-destino(1:5) TO tordini-k-or-SPLITBUF(6:5)
           MOVE tor-num-ord-cli(1:10) TO tordini-k-or-SPLITBUF(11:10)
           .

       tordini-k-tor-inviare-MERGE-SPLITBUF.
           INITIALIZE tordini-k-tor-inviare-SPLITBUF
           MOVE tor-da-inviare OF tordini(1:1) TO 
           tordini-k-tor-inviare-SPLITBUF(1:1)
           MOVE tor-chiave OF tordini(1:12) TO 
           tordini-k-tor-inviare-SPLITBUF(2:12)
           .

       DataSet1-tordini-INITSTART.
           IF DataSet1-tordini-KEY-Asc
              MOVE Low-Value TO tor-chiave
           ELSE
              MOVE High-Value TO tor-chiave
           END-IF
           .

       DataSet1-tordini-INITEND.
           IF DataSet1-tordini-KEY-Asc
              MOVE High-Value TO tor-chiave
           ELSE
              MOVE Low-Value TO tor-chiave
           END-IF
           .

      * tordini
       DataSet1-tordini-START.
           IF DataSet1-tordini-KEY-Asc
              START tordini KEY >= tor-chiave
           ELSE
              START tordini KEY <= tor-chiave
           END-IF
           .

       DataSet1-tordini-START-NOTGREATER.
           IF DataSet1-tordini-KEY-Asc
              START tordini KEY <= tor-chiave
           ELSE
              START tordini KEY >= tor-chiave
           END-IF
           .

       DataSet1-tordini-START-GREATER.
           IF DataSet1-tordini-KEY-Asc
              START tordini KEY > tor-chiave
           ELSE
              START tordini KEY < tor-chiave
           END-IF
           .

       DataSet1-tordini-START-LESS.
           IF DataSet1-tordini-KEY-Asc
              START tordini KEY < tor-chiave
           ELSE
              START tordini KEY > tor-chiave
           END-IF
           .

       DataSet1-tordini-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tordini-LOCK
              READ tordini WITH LOCK 
              KEY tor-chiave
           ELSE
              READ tordini WITH NO LOCK 
              KEY tor-chiave
           END-IF
           PERFORM tordini-k-causale-MERGE-SPLITBUF
           PERFORM tordini-k1-MERGE-SPLITBUF
           PERFORM tordini-k2-MERGE-SPLITBUF
           PERFORM tordini-k-bolla-MERGE-SPLITBUF
           PERFORM tordini-k3-MERGE-SPLITBUF
           PERFORM tordini-k-fattura-MERGE-SPLITBUF
           PERFORM tordini-k4-MERGE-SPLITBUF
           PERFORM tordini-k-contab-MERGE-SPLITBUF
           PERFORM tordini-k-tipo-MERGE-SPLITBUF
           PERFORM tordini-k-data-MERGE-SPLITBUF
           PERFORM tordini-k-agfatt-MERGE-SPLITBUF
           PERFORM tordini-k-stbolle-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-data-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-cliente-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-clides-MERGE-SPLITBUF
           PERFORM tordini-k-promo-MERGE-SPLITBUF
           PERFORM tordini-k-or-MERGE-SPLITBUF
           PERFORM tordini-k-tor-inviare-MERGE-SPLITBUF
           MOVE STATUS-tordini TO TOTEM-ERR-STAT 
           MOVE "tordini" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tordini-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tordini-KEY-Asc
              IF DataSet1-tordini-LOCK
                 READ tordini NEXT WITH LOCK
              ELSE
                 READ tordini NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tordini-LOCK
                 READ tordini PREVIOUS WITH LOCK
              ELSE
                 READ tordini PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tordini-k-causale-MERGE-SPLITBUF
           PERFORM tordini-k1-MERGE-SPLITBUF
           PERFORM tordini-k2-MERGE-SPLITBUF
           PERFORM tordini-k-bolla-MERGE-SPLITBUF
           PERFORM tordini-k3-MERGE-SPLITBUF
           PERFORM tordini-k-fattura-MERGE-SPLITBUF
           PERFORM tordini-k4-MERGE-SPLITBUF
           PERFORM tordini-k-contab-MERGE-SPLITBUF
           PERFORM tordini-k-tipo-MERGE-SPLITBUF
           PERFORM tordini-k-data-MERGE-SPLITBUF
           PERFORM tordini-k-agfatt-MERGE-SPLITBUF
           PERFORM tordini-k-stbolle-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-data-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-cliente-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-clides-MERGE-SPLITBUF
           PERFORM tordini-k-promo-MERGE-SPLITBUF
           PERFORM tordini-k-or-MERGE-SPLITBUF
           PERFORM tordini-k-tor-inviare-MERGE-SPLITBUF
           MOVE STATUS-tordini TO TOTEM-ERR-STAT
           MOVE "tordini" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tordini-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tordini-KEY-Asc
              IF DataSet1-tordini-LOCK
                 READ tordini PREVIOUS WITH LOCK
              ELSE
                 READ tordini PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tordini-LOCK
                 READ tordini NEXT WITH LOCK
              ELSE
                 READ tordini NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tordini-k-causale-MERGE-SPLITBUF
           PERFORM tordini-k1-MERGE-SPLITBUF
           PERFORM tordini-k2-MERGE-SPLITBUF
           PERFORM tordini-k-bolla-MERGE-SPLITBUF
           PERFORM tordini-k3-MERGE-SPLITBUF
           PERFORM tordini-k-fattura-MERGE-SPLITBUF
           PERFORM tordini-k4-MERGE-SPLITBUF
           PERFORM tordini-k-contab-MERGE-SPLITBUF
           PERFORM tordini-k-tipo-MERGE-SPLITBUF
           PERFORM tordini-k-data-MERGE-SPLITBUF
           PERFORM tordini-k-agfatt-MERGE-SPLITBUF
           PERFORM tordini-k-stbolle-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-data-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-cliente-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-clides-MERGE-SPLITBUF
           PERFORM tordini-k-promo-MERGE-SPLITBUF
           PERFORM tordini-k-or-MERGE-SPLITBUF
           PERFORM tordini-k-tor-inviare-MERGE-SPLITBUF
           MOVE STATUS-tordini TO TOTEM-ERR-STAT
           MOVE "tordini" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tordini-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeWrite>
      * <TOTEM:END>
           WRITE tor-rec OF tordini.
           MOVE STATUS-tordini TO TOTEM-ERR-STAT
           MOVE "tordini" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tordini-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeRewrite>
      * <TOTEM:END>
           REWRITE tor-rec OF tordini.
           MOVE STATUS-tordini TO TOTEM-ERR-STAT
           MOVE "tordini" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tordini-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeDelete>
      * <TOTEM:END>
           DELETE tordini.
           MOVE STATUS-tordini TO TOTEM-ERR-STAT
           MOVE "tordini" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-param-INITSTART.
           IF DataSet1-param-KEY-Asc
              MOVE Low-Value TO prm-chiave OF param
           ELSE
              MOVE High-Value TO prm-chiave OF param
           END-IF
           .

       DataSet1-param-INITEND.
           IF DataSet1-param-KEY-Asc
              MOVE High-Value TO prm-chiave OF param
           ELSE
              MOVE Low-Value TO prm-chiave OF param
           END-IF
           .

      * param
       DataSet1-param-START.
           IF DataSet1-param-KEY-Asc
              START param KEY >= prm-chiave OF param
           ELSE
              START param KEY <= prm-chiave OF param
           END-IF
           .

       DataSet1-param-START-NOTGREATER.
           IF DataSet1-param-KEY-Asc
              START param KEY <= prm-chiave OF param
           ELSE
              START param KEY >= prm-chiave OF param
           END-IF
           .

       DataSet1-param-START-GREATER.
           IF DataSet1-param-KEY-Asc
              START param KEY > prm-chiave OF param
           ELSE
              START param KEY < prm-chiave OF param
           END-IF
           .

       DataSet1-param-START-LESS.
           IF DataSet1-param-KEY-Asc
              START param KEY < prm-chiave OF param
           ELSE
              START param KEY > prm-chiave OF param
           END-IF
           .

       DataSet1-param-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:param, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:param, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-param-LOCK
              READ param WITH LOCK 
              KEY prm-chiave OF param
           ELSE
              READ param WITH NO LOCK 
              KEY prm-chiave OF param
           END-IF
           MOVE STATUS-param TO TOTEM-ERR-STAT 
           MOVE "param" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:param, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:param, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-param-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:param, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:param, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-param-KEY-Asc
              IF DataSet1-param-LOCK
                 READ param NEXT WITH LOCK
              ELSE
                 READ param NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-param-LOCK
                 READ param PREVIOUS WITH LOCK
              ELSE
                 READ param PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-param TO TOTEM-ERR-STAT
           MOVE "param" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:param, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:param, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-param-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:param, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:param, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-param-KEY-Asc
              IF DataSet1-param-LOCK
                 READ param PREVIOUS WITH LOCK
              ELSE
                 READ param PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-param-LOCK
                 READ param NEXT WITH LOCK
              ELSE
                 READ param NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-param TO TOTEM-ERR-STAT
           MOVE "param" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:param, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:param, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-param-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:param, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-param TO TOTEM-ERR-STAT
           MOVE "param" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:param, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-param-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:param, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-param TO TOTEM-ERR-STAT
           MOVE "param" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:param, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-param-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:param, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-param TO TOTEM-ERR-STAT
           MOVE "param" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:param, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-INIT-RECORD.
           INITIALIZE cli-rec OF clienti
           INITIALIZE des-rec OF destini
           INITIALIZE tca-rec OF tcaumag
           INITIALIZE art-rec OF articoli
           INITIALIZE mar-rec OF tmarche
           INITIALIZE prg-rec OF progmag
           INITIALIZE tcl-rec OF ttipocli
           INITIALIZE tpb-rec OF tpiombo
           INITIALIZE mto-rec OF mtordini
           INITIALIZE mro-rec OF mrordini
           INITIALIZE tge-rec OF tparamge
           INITIALIZE ror-rec OF rordini
           INITIALIZE tor-rec OF tordini
           INITIALIZE prm-rec OF param
           .


      * GRID
       gd-ordini-Content.
      * CELLS' SETTING
              MODIFY gd-ordini, X = 2, Y = 1,
                CELL-DATA = "Anno",
      * CELLS' SETTING
              MODIFY gd-ordini, X = 3, Y = 1,
                CELL-DATA = "Ordine",
      * CELLS' SETTING
              MODIFY gd-ordini, X = 4, Y = 1,
                CELL-DATA = "Data",
      * CELLS' SETTING
              MODIFY gd-ordini, X = 5, Y = 1,
                CELL-DATA = "Cliente",
      * CELLS' SETTING
              MODIFY gd-ordini, X = 6, Y = 1,
                CELL-DATA = "Ragione Sociale",
      * CELLS' SETTING
              MODIFY gd-ordini, X = 7, Y = 1,
                CELL-DATA = "Destino",
      * CELLS' SETTING
              MODIFY gd-ordini, X = 8, Y = 1,
                CELL-DATA = "Indirizzo",
      * CELLS' SETTING
              MODIFY gd-ordini, X = 9, Y = 1,
                CELL-DATA = "Località",
           .

      * GRID
       Form1-Gd-1-Content.
      * CELLS' SETTING
              MODIFY Form1-Gd-1, X = 2, Y = 1,
                CELL-DATA = "Articolo",
      * CELLS' SETTING
              MODIFY Form1-Gd-1, X = 3, Y = 1,
                CELL-DATA = "Descrizione",
      * CELLS' SETTING
              MODIFY Form1-Gd-1, X = 4, Y = 1,
                CELL-DATA = "Q.tà",
      * CELLS' SETTING
              MODIFY Form1-Gd-1, X = 5, Y = 1,
                CELL-DATA = "Prz. unitario",
      * CELLS' SETTING
              MODIFY Form1-Gd-1, X = 6, Y = 1,
                CELL-DATA = "% Sc.",
      * CELLS' SETTING
              MODIFY Form1-Gd-1, X = 7, Y = 1,
                CELL-DATA = "Consumo",
      * CELLS' SETTING
              MODIFY Form1-Gd-1, X = 8, Y = 1,
                CELL-DATA = "Cou/Cobat",
      * CELLS' SETTING
              MODIFY Form1-Gd-1, X = 9, Y = 1,
                CELL-DATA = "Add. Piombo",
      * CELLS' SETTING
              MODIFY Form1-Gd-1, X = 10, Y = 1,
                CELL-DATA = "Imp. merce",
      * CELLS' SETTING
              MODIFY Form1-Gd-1, X = 11, Y = 1,
                CELL-DATA = "Cod. IVA",
      * CELLS' SETTING
              MODIFY Form1-Gd-1, X = 12, Y = 1,
                CELL-DATA = "Omaggio",
      * COLUMNS' SETTING
              MODIFY Form1-Gd-1, X = 5  
                COLUMN-COLOR = 5,
                COLUMN-FONT = MS-Sans-Serif10B-Occidentale,
           .

      * FD's Initialize Paragraph
       DataSet1-clienti-INITREC.
           INITIALIZE cli-rec OF clienti
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-destini-INITREC.
           INITIALIZE des-rec OF destini
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tcaumag-INITREC.
           INITIALIZE tca-rec OF tcaumag
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-articoli-INITREC.
           INITIALIZE art-rec OF articoli
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tmarche-INITREC.
           INITIALIZE mar-rec OF tmarche
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-progmag-INITREC.
           INITIALIZE prg-rec OF progmag
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-ttipocli-INITREC.
           INITIALIZE tcl-rec OF ttipocli
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tpiombo-INITREC.
           INITIALIZE tpb-rec OF tpiombo
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-mtordini-INITREC.
           INITIALIZE mto-rec OF mtordini
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-mrordini-INITREC.
           INITIALIZE mro-rec OF mrordini
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tparamge-INITREC.
           INITIALIZE tge-rec OF tparamge
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-rordini-INITREC.
           INITIALIZE ror-rec OF rordini
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tordini-INITREC.
           INITIALIZE tor-rec OF tordini
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-param-INITREC.
           INITIALIZE prm-rec OF param
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      *
       DataSet1-DISPATCH-BUFTOFLD.
           EVALUATE TOTEM-Form-Index ALSO TOTEM-Frame-Index
              WHEN 1 ALSO 0
                  PERFORM Form2-Buf-To-Fld
              WHEN 4 ALSO 0
                  PERFORM screen2-Buf-To-Fld
           END-EVALUATE
           .

       Form2-Open-Routine.
           PERFORM Form2-Scrn
           PERFORM Form2-Proc
           .

       Form2-Scrn.
           PERFORM Form2-Create-Win
           PERFORM Form2-Init-Value
           PERFORM Form2-Init-Data
      * Tab keystrok settings
      * Tool Bar
           PERFORM Form2-DISPLAY
           .

       Form2-Create-Win.
           Display Floating GRAPHICAL WINDOW
              LINES 48,54,
              SIZE 165,00,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 65793,
              CONTROL FONT Small-Font,
              LABEL-OFFSET 23,
              LINK TO THREAD,
              MODELESS,
              NO SCROLL,
              TITLE-BAR,
              TITLE titolo,
              WITH SYSTEM MENU,
              USER-GRAY,
           VISIBLE 0,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE Screen1-Event-Proc,
              HANDLE IS form2-Handle,
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
      * Status-bar
           DISPLAY Form2 UPON form2-Handle
      * DISPLAY-COLUMNS settings
              MODIFY gd-ordini, DISPLAY-COLUMNS (1, 4, 12, 25, 38, 48, 
           78, 108, 138)
           .

       Form2-PROC.
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeAccept>
           set CallManutenzione to false.
           perform FORM3-OPEN-ROUTINE.

           if not trovato
              display message box "Nessun ordine presente per i limiti r
      -    "ichiesti"
                      title = tit-err
                      icon mb-error-icon
              perform FORM2-EXIT
           else             
              modify form2-Handle, visible = 1 
              move 2 to riga, EVENT-DATA-2
              modify gd-ordini, CURSOR-Y = 2
              perform CAMBIA-FONT-RIGA
           end-if.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT Form2
                 ON EXCEPTION
                    PERFORM Form2-Evaluate-Func
                 MOVE 1 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterEndAccept>
           if CallManutenzione
              perform ORDINE-DA-GRIGLIA
              set CallManutenzione to false
           end-if

      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY form2-Handle
           INITIALIZE Key-Status
           .

       Form2-Evaluate-Func.
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM Form2-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM Form2-Exit
                 END-IF
              WHEN Key-Status = 1000
                 PERFORM pb-ok2-LinkTo
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       Form2-CLEAR.
           PERFORM Form2-INIT-VALUE
           PERFORM Form2-DISPLAY
           .

       Form2-DISPLAY.
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY Form2 UPON form2-Handle
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterDisplay>
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       Form2-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeExit>
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       Form2-Init-Data.
           MOVE 1 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
      * GRID
           PERFORM gd-ordini-Content
           .

       Form2-DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           PERFORM Form2-DataSet1-Update-Key
           .

       Form2-DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-mtordini-KEY1-ORDER
           END-EVALUATE
           PERFORM Form2-DataSet1-Update-Key
           .

       Form2-DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-mtordini-KEY1-ORDER
           END-EVALUATE
           PERFORM Form2-DataSet1-Update-Key
           .

       Form2-DataSet1-Update-Key.
           MOVE mto-rec OF mtordini TO
                     Form2-MULKEY-TMPBUF
           PERFORM Form2-CLEAR
           PERFORM Form2-INIT-DATA
           MOVE Form2-MULKEY-TMPBUF TO
                     mto-rec OF mtordini
           PERFORM DataSet1-mtordini-Read
           PERFORM Form2-DUPLICATE-MOVEKEY
           PERFORM Form2-DUMMY-CURR
           PERFORM Form2-IUD-Display
           .

       Form2-DUPLICATE-MOVEKEY.
           .

       Form2-First.
           PERFORM Form2-DUMMY-FIRST
           PERFORM DataSet1-mtordini-INITSTART
           PERFORM DataSet1-mtordini-START
           IF NOT Valid-STATUS-mtordini
              PERFORM Form2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeFirst>
      * <TOTEM:END>
           PERFORM DataSet1-mtordini-Read-Next
           IF NOT Valid-STATUS-mtordini
              PERFORM Form2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterFirst>
      * <TOTEM:END>
           PERFORM Form2-DUPLICATE-MOVEKEY.
           PERFORM Form2-IUD-Display
           .

       Form2-Previous.
              PERFORM Form2-Buf-To-Fld
              PERFORM DataSet1-mtordini-START-LESS
           IF NOT Valid-STATUS-mtordini
              PERFORM Form2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforePrevious>
      * <TOTEM:END>
           PERFORM DataSet1-mtordini-Read-Prev
           IF NOT Valid-STATUS-mtordini
              PERFORM Form2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterPrevious>
      * <TOTEM:END>
           PERFORM Form2-DUPLICATE-MOVEKEY
           PERFORM Form2-DUMMY-PREVIOUS
           PERFORM Form2-IUD-Display
           .

       Form2-Next.
              PERFORM Form2-Buf-To-Fld
              PERFORM DataSet1-mtordini-START-GREATER
           IF NOT Valid-STATUS-mtordini
              PERFORM Form2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeNext>
      * <TOTEM:END>
           PERFORM DataSet1-mtordini-Read-Next
           IF NOT Valid-STATUS-mtordini
              PERFORM Form2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterNext>
      * <TOTEM:END>
           PERFORM Form2-DUPLICATE-MOVEKEY
           PERFORM Form2-DUMMY-NEXT
           PERFORM Form2-IUD-Display
           .
      
       Form2-Last.
           PERFORM Form2-DUMMY-LAST
           PERFORM DataSet1-mtordini-INITEND
           PERFORM DataSet1-mtordini-START-NOTGREATER
           IF NOT Valid-STATUS-mtordini
              PERFORM Form2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeLast>
      * <TOTEM:END>
           PERFORM DataSet1-mtordini-Read-Prev
           IF NOT Valid-STATUS-mtordini
              PERFORM Form2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterLast>
      * <TOTEM:END>
           PERFORM Form2-DUPLICATE-MOVEKEY.
           PERFORM Form2-IUD-Display
           .

       Form2-Curr.
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeCurrent>
      * <TOTEM:END>
           PERFORM Form2-Buf-To-Fld
           PERFORM DataSet1-mtordini-Read
           PERFORM Form2-DUPLICATE-MOVEKEY
           PERFORM Form2-DUMMY-CURR
           PERFORM Form2-IUD-Display
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterCurrent>
      * <TOTEM:END>
           .

       Form2-IUD-Display.
           IF Valid-STATUS-mtordini
              PERFORM Form2-ALLGRID-RESET
              PERFORM Form2-Fld-To-Buf
              PERFORM Form2-NAVI-FOR-MASTERGRID
              PERFORM Form2-DISPLAY
           ELSE
              IF Form2-FLAG-REFRESH
                 CONTINUE
              ELSE
                 PERFORM Form2-Extended-File-Status
              END-IF
           END-IF
           .

       Form2-Add.
           PERFORM Form2-Buf-To-Fld
           PERFORM Form2-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM Form2-DUMMY-ADD
           PERFORM DataSet1-mtordini-INITREC
           PERFORM Form2-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeAdd>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-mtordini-Rec-Write
           IF Valid-STATUS-mtordini
              PERFORM Form2-RESUMMARY-INS
              PERFORM Form2-DUMMY-UPDATE-INIT
              MOVE "301" TO TOTEM-MSG-ID
              PERFORM Form2-IUD-Display
           END-IF
           PERFORM Form2-ERR-CHECKING
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterAdd>
      * <TOTEM:END>
           .
     
       Form2-Update.
           PERFORM Form2-Buf-To-Fld
           PERFORM DataSet1-mtordini-START              
           IF NOT Valid-STATUS-mtordini
              PERFORM Form2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
           PERFORM DataSet1-mtordini-Read
           PERFORM Form2-Buf-To-Fld
           PERFORM Form2-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM Form2-DUMMY-UPDATE
           PERFORM Form2-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeUpdate>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-mtordini-Rec-Rewrite
           IF Valid-STATUS-mtordini
              PERFORM Form2-RESUMMARY-DEL
              PERFORM Form2-DUMMY-UPDATE-INIT
              MOVE "302" TO TOTEM-MSG-ID
              PERFORM Form2-IUD-Display
           END-IF
           PERFORM Form2-ERR-CHECKING
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterUpdate>
      * <TOTEM:END>
           .

       Form2-Delete.
           MOVE "203" TO TOTEM-MSG-ID
           PERFORM MESSAGE-BOX-DISPLAY
           IF TOTEM-MSG-RETURN-VALUE NOT = 1
              INITIALIZE TOTEM-MSG-TEXT
              EXIT PARAGRAPH 
           END-IF
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeDelete>
      * <TOTEM:END>
           PERFORM Form2-DUMMY-DELETE
      * delete
           PERFORM Form2-Buf-To-Fld
           PERFORM DataSet1-mtordini-Rec-Delete
           IF Valid-STATUS-mtordini
              PERFORM Form2-CLEAR
              PERFORM Form2-DUMMY-DELETE-INIT
              MOVE "303" TO TOTEM-MSG-ID
              MOVE "00" to STATUS-mtordini
           END-IF
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterDelete>
      * <TOTEM:END>
           PERFORM Form2-ERR-CHECKING
           .

       Form2-NAVI-FOR-MASTERGRID.
           .

       Form2-ERR-CHECKING.
           IF Valid-STATUS-mtordini
              PERFORM Form2-SHOW-MSG-ROUTINE
           ELSE
              PERFORM Form2-Extended-File-Status
           END-IF
           .

       Form2-RESUMMARY-INS.
           .

       Form2-RESUMMARY-DEL.
           .


       Form2-DUMMY-FIRST.
           .

       Form2-DUMMY-PREVIOUS.
           .

       Form2-DUMMY-NEXT.
           .

       Form2-DUMMY-LAST.
           .

       Form2-DUMMY-CURR.
           .

       Form2-DUMMY-ADD.
           .

       Form2-DUMMY-UPDATE.
           .

       Form2-DUMMY-UPDATE-INIT.
           .

       Form2-DUMMY-DELETE.
           .

       Form2-DUMMY-DELETE-INIT.
           .

       Form2-Init-Value.
      * FORM : Form2
           PERFORM DataSet1-INIT-RECORD
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, SetDefault>
      * <TOTEM:END>
           PERFORM Form2-FLD-TO-BUF
           .


       Form2-ALLGRID-RESET.
           .

      * for Form's Validation
       Form2-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       Form2-Buf-To-Fld.
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterBufToFld>
      * <TOTEM:END>
           .

       Form2-Fld-To-Buf.
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeFldToBuf>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterFldToBuf>
      * <TOTEM:END>
           .

       Form2-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform Form2-BUF-TO-FLD.
           move 0 to scelta.
           .
       Form2-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM Form2-SHOW-MSG-ROUTINE
           .

       Form2-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM Form2-DISPLAY-MESSAGE
           .

       Form2-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       Form2-Save-Status.
           MOVE DataSet1-mtordini-KEY1-ORDER TO TMP-Form2-KEY1-ORDER
           MOVE DataSet1-KEYIS TO TMP-Form2-KEYIS
           MOVE mto-rec OF mtordini TO 
              TMP-Form2-mtordini-RESTOREBUF
           .             

       Form2-Restore-Status.
           MOVE TMP-Form2-KEY1-ORDER TO DataSet1-mtordini-KEY1-ORDER
           MOVE TMP-Form2-KEYIS TO DataSet1-KEYIS
           MOVE TMP-Form2-mtordini-RESTOREBUF TO
              mto-rec OF mtordini
           PERFORM DataSet1-mtordini-START
           IF Valid-STATUS-mtordini
              PERFORM DataSet1-mtordini-Read-Next
           ELSE
              PERFORM DataSet1-mtordini-INITREC
           END-IF
           PERFORM UNTIL NOT Valid-STATUS-mtordini OR
              (Valid-STATUS-mtordini AND
                 mto-rec OF mtordini = 
                   TMP-Form2-mtordini-RESTOREBUF)
              PERFORM DataSet1-mtordini-Read-Next
           END-PERFORM
           .

       Form1-Open-Routine.
           PERFORM Form1-Scrn
           PERFORM Form1-Proc
           .

       Form1-Scrn.
           PERFORM Form1-Create-Win
           PERFORM Form1-Init-Value
           PERFORM Form1-Init-Data
      * Tab keystrok settings
      * Tool Bar
           DISPLAY Form1-Tb-1a
           PERFORM Form1-DISPLAY
           .

       Form1-Create-Win.
           Display Independent GRAPHICAL WINDOW
              LINES 18,67,
              SIZE 42,00,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 65793,
              CONTROL FONT Verdana12-Occidentale,
              LABEL-OFFSET 23,
              LINK TO THREAD,
              NO SCROLL,
              TITLE-BAR,
              TITLE TITOLO,
              WITH SYSTEM MENU,
              USER-GRAY,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE Screen4-Event-Proc,
              HANDLE IS form1-Handle,
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
           DISPLAY TOOL-BAR 
              LINES 2,67,   
              HANDLE IN Form1-Tb-1-Handlea
           DISPLAY Form1-Tb-1a UPON Form1-Tb-1-Handlea

      * Status-bar
           DISPLAY Form1 UPON form1-Handle
      * DISPLAY-COLUMNS settings
           .

       Form1-PROC.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeAccept>
      * SPECIFICO PER PROGRAMMI CON SCREEN DI ACCETTAZIONE LIMITI
           move spaces to tge-anno.
           move spaces to tge-codice.
           read tparamge no lock invalid continue end-read.

           move tge-anno to anno-to.

           move 1        to tipo-elab.
           Move all "9"  to ordine-to,
                            data-to,
                            cliente-to.

           Move zero     to ordine-from,
                            data-from,
                            cliente-from.

          
           move 0 to mod-limiti.

           move tge-cod-iva-omag to iva-omaggio.

           display Form1.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT Form1
                 ON EXCEPTION
                    PERFORM Form1-Evaluate-Func
                 MOVE 2 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY form1-Handle
           INITIALIZE Key-Status
           .

       Form1-Evaluate-Func.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM Form1-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM Form1-Exit
                 END-IF
              WHEN Key-Status = 1001
                 PERFORM RB-SINGOLA-LinkTo
              WHEN Key-Status = 1002
                 PERFORM RB-ELENCO-LinkTo
              WHEN Key-Status = 1000
                 PERFORM pb-ok-LinkTo
              WHEN Key-Status = 27
                 PERFORM pb-annulla-LinkTo
              WHEN Key-Status = 8
                 PERFORM TOOL-CERCA-LinkTo
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       Form1-CLEAR.
           PERFORM Form1-INIT-VALUE
           PERFORM Form1-DISPLAY
           .

       Form1-DISPLAY.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY Form1-Tb-1a
           DISPLAY Form1 UPON form1-Handle
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterDisplay>
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       Form1-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeExit>
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       Form1-Init-Data.
           MOVE 2 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
           .

       Form1-Init-Value.
           MOVE TITOLO TO TOTEM-MSG-TITLE
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, SetDefault>
      * <TOTEM:END>
           PERFORM Form1-FLD-TO-BUF
           .


       Form1-ALLGRID-RESET.
           .

      * for Form's Validation
       Form1-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       Form1-Buf-To-Fld.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterBufToFld>
      * <TOTEM:END>
           .

       Form1-Fld-To-Buf.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeFldToBuf>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterFldToBuf>
      * <TOTEM:END>
           .

       Form1-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform Form1-BUF-TO-FLD.
           move 0 to scelta.
           .
       Form1-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM Form1-SHOW-MSG-ROUTINE
           .

       Form1-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM Form1-DISPLAY-MESSAGE
           .

       Form1-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       Form1-Save-Status.
           .             

       Form1-Restore-Status.
           .


      * Paragrafo per la struttura del codice in AFTER sulla screen Form1
      ***---
       Form1-AFTER-SCREEN.

      * Generazione risettaggio keyboard "." ---> "."

      * Generazione stringa perform CONTROLLO
           evaluate control-id
           |78-ID-EF-ANNO è l'ID del campo EF-ANNO
           when 78-ID-EF-ANNO
                perform CONTROLLO
           |78-ID-EF-ordine-FROM è l'ID del campo EF-ordine-FROM
           when 78-ID-EF-ordine-FROM
                perform CONTROLLO
           |78-ID-EF-ordine-TO è l'ID del campo EF-ordine-TO
           when 78-ID-EF-ordine-TO
                perform CONTROLLO
           |78-ID-EF-data-FROM è l'ID del campo EF-data-FROM
           when 78-ID-EF-data-FROM
                perform CONTROLLO
           |78-ID-EF-DATA-TO è l'ID del campo EF-DATA-TO
           when 78-ID-EF-DATA-TO
                perform CONTROLLO
           |78-ID-EF-CLIENTE-FROM è l'ID del campo EF-CLIENTE-FROM
           when 78-ID-EF-CLIENTE-FROM
                perform CONTROLLO
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER CONTROLLO della screen
           when 99999 continue
           when other continue
           end-evaluate.

       form3-Open-Routine.
           PERFORM form3-Scrn
           PERFORM form3-Proc
           .

       form3-Scrn.
           PERFORM form3-Create-Win
           PERFORM form3-Init-Value
           PERFORM form3-Init-Data
      * Tab keystrok settings
      * Tool Bar
           PERFORM form3-DISPLAY
           .

       form3-Create-Win.
           Display Floating GRAPHICAL WINDOW
              LINES 3,00,
              SIZE 40,00,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 65793,
              LINK TO THREAD,
              MODELESS,
              NO SCROLL,
              USER-GRAY,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE form3-Event-Proc,
              HANDLE IS form3-Handle,
      * <TOTEM:EPT. FORM:form3, FORM:form3, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
      * Status-bar
           DISPLAY form3 UPON form3-Handle
      * DISPLAY-COLUMNS settings
           .

       form3-PROC.
      * <TOTEM:EPT. FORM:form3, FORM:form3, BeforeAccept>
           call "w$mouse" using set-mouse-shape, wait-pointer
           perform RIEMPI-GRID.

           call "w$mouse" using set-mouse-shape, arrow-pointer.

           perform FORM3-EXIT.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT OMITTED LINE 1 COL 1
                 ON EXCEPTION
                    PERFORM form3-Evaluate-Func
                 MOVE 3 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:form3, FORM:form3, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:form3, FORM:form3, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY form3-Handle
           INITIALIZE Key-Status
           .

       form3-Evaluate-Func.
      * <TOTEM:EPT. FORM:form3, FORM:form3, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM form3-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM form3-Exit
                 END-IF
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       form3-CLEAR.
           PERFORM form3-INIT-VALUE
           PERFORM form3-DISPLAY
           .

       form3-DISPLAY.
      * <TOTEM:EPT. FORM:form3, FORM:form3, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY form3 UPON form3-Handle
      * <TOTEM:EPT. FORM:form3, FORM:form3, AfterDisplay>
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       form3-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:form3, FORM:form3, BeforeExit>
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       form3-Init-Data.
           MOVE 3 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
           .

       form3-Init-Value.
      * <TOTEM:EPT. FORM:form3, FORM:form3, SetDefault>
      * <TOTEM:END>
           PERFORM form3-FLD-TO-BUF
           .


       form3-ALLGRID-RESET.
           .

      * for Form's Validation
       form3-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       form3-Buf-To-Fld.
      * <TOTEM:EPT. FORM:form3, FORM:form3, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:form3, FORM:form3, AfterBufToFld>
      * <TOTEM:END>
           .

       form3-Fld-To-Buf.
      * <TOTEM:EPT. FORM:form3, FORM:form3, BeforeFldToBuf>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:form3, FORM:form3, AfterFldToBuf>
      * <TOTEM:END>
           .

       form3-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform form3-BUF-TO-FLD.
           move 0 to scelta.
           .
       form3-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM form3-SHOW-MSG-ROUTINE
           .

       form3-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM form3-DISPLAY-MESSAGE
           .

       form3-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       form3-Save-Status.
           .             

       form3-Restore-Status.
           .


      * Paragrafo per la struttura del codice in AFTER sulla screen form3
      ***---
       form3-AFTER-SCREEN.

      * Generazione risettaggio keyboard "." ---> "."

      * Generazione stringa perform CONTROLLO
           evaluate control-id
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER CONTROLLO della screen
           when 99999 continue
           when other continue
           end-evaluate.

       screen2-Open-Routine.
           PERFORM screen2-Scrn
           PERFORM screen2-Proc
           .

       screen2-Scrn.
           PERFORM screen2-Create-Win
           PERFORM screen2-Init-Value
           PERFORM screen2-Init-Data
      * Tab keystrok settings
      * Tool Bar
           PERFORM screen2-DISPLAY
           .

       screen2-Create-Win.
           Display Independent GRAPHICAL WINDOW
              SCREEN LINE 1,
              SCREEN COLUMN 0,
              LINES 34,23,
              SIZE 158,00,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 65793,
              CONTROL FONT Small-Font,
              LABEL-OFFSET 23,
              LINK TO THREAD,
              MODELESS,
              NO SCROLL,
              TITLE-BAR,
              TITLE TITOLO,
              AUTO-MINIMIZE,
              WITH SYSTEM MENU,
              USER-GRAY,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE Form1-Event-Proc,
              HANDLE IS screen2-Handle,
      * <TOTEM:EPT. FORM:screen2, FORM:screen2, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
      * Status-bar
           DISPLAY screen2 UPON screen2-Handle
      * DISPLAY-COLUMNS settings
              MODIFY Form1-Gd-1, DISPLAY-COLUMNS (1, 8, 16, 56, 65, 80, 
           86, 98, 110, 122, 134, 143)
           .

       screen2-PROC.
      * <TOTEM:EPT. FORM:screen2, FORM:screen2, BeforeAccept>
           set tutto-ok to true.
           initialize mto-rec
                      cli-rec
                      des-rec

           move Linkanno   to mto-anno.
           move LinkNumero to mto-numero.
           read mtordini lock invalid continue end-read.

           if RecLocked
              set errori to true
           end-if.

           if tutto-ok
                                         
              move mto-cod-cli to cli-codice
              set  cli-tipo-c to true
              read clienti invalid continue end-read

              set TrattamentoGDO to false
              move cli-tipo to tcl-codice
              read ttipocli no lock invalid continue end-read
              if ttipocli-gdo set TrattamentoGDO to true end-if

              move cli-codice      to des-codice
              move mto-prg-destino to des-prog
              read destini invalid continue end-read

              accept como-data from century-date
              perform DATE-TO-SCREEN
              move como-data to data-stampa
              
              accept como-ora from time
              string como-ora(1:2) delimited by size
                     ":"           delimited by size
                     como-ora(3:2) delimited by size
                     into ora-stampa
              end-string
              
              initialize tca-rec
              move mto-causale to tca-codice
              read tcaumag no lock invalid continue end-read
              perform SCREEN2-IUD-DISPLAY

              perform CARICA-GRID

              move 2 to riga event-data-2
              perform SPOSTAMENTO-2
              
              set SiSalvato    to true
              set RicaricaGrid to false
           else
              move 27 to key-status
           end-if.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT screen2
                 ON EXCEPTION
                    PERFORM screen2-Evaluate-Func
                 MOVE 4 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:screen2, FORM:screen2, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:screen2, FORM:screen2, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY screen2-Handle
           INITIALIZE Key-Status
           .

       screen2-Evaluate-Func.
      * <TOTEM:EPT. FORM:screen2, FORM:screen2, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM screen2-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM screen2-Exit
                 END-IF
              WHEN Key-Status = 1000
                 PERFORM pb-oka-LinkTo
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       screen2-CLEAR.
           PERFORM screen2-INIT-VALUE
           PERFORM screen2-DISPLAY
           .

       screen2-DISPLAY.
      * <TOTEM:EPT. FORM:screen2, FORM:screen2, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY screen2 UPON screen2-Handle
      * <TOTEM:EPT. FORM:screen2, FORM:screen2, AfterDisplay>
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       screen2-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:screen2, FORM:screen2, BeforeExit>
           if NoSalvato
              display message "Salvare le modifiche e sbloccare l'ordine
      -    "?"
                        title titolo
                         type mb-yes-no-cancel
                       giving scelta
              evaluate scelta
              when mb-yes
                   perform SALVATAGGIO
                   if errori
                      move RigaCambiata to riga event-data-2
                      perform SPOSTAMENTO
                      modify pb-oka,      bitmap-number = 1
                      modify pb-annullaa, bitmap-number = 1
                      move 2000 to control-id
                      move 4    to accept-control
                      move 26   to key-status
                      exit paragraph
                   end-if
              when mb-no 
                   continue
              when mb-cancel
                   move RigaCambiata to riga event-data-2
                   perform SPOSTAMENTO
                   modify pb-oka,      bitmap-number = 1
                   modify pb-annullaa, bitmap-number = 1
                   move 2000 to control-id
                   move 4    to accept-control
                   move 26   to key-status
                   exit paragraph
              end-evaluate
           end-if.

           unlock mtordini all record.

           .
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       screen2-Init-Data.
           MOVE 4 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
      * GRID
           PERFORM Form1-Gd-1-Content
           .

       screen2-DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           PERFORM screen2-DataSet1-Update-Key
           .

       screen2-DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-mtordini-KEY1-ORDER
           END-EVALUATE
           PERFORM screen2-DataSet1-Update-Key
           .

       screen2-DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-mtordini-KEY1-ORDER
           END-EVALUATE
           PERFORM screen2-DataSet1-Update-Key
           .

       screen2-DataSet1-Update-Key.
           MOVE mto-rec OF mtordini TO
                     screen2-MULKEY-TMPBUF
           PERFORM screen2-CLEAR
           PERFORM screen2-INIT-DATA
           MOVE screen2-MULKEY-TMPBUF TO
                     mto-rec OF mtordini
           PERFORM DataSet1-mtordini-Read
           PERFORM screen2-DUPLICATE-MOVEKEY
           PERFORM screen2-DUMMY-CURR
           PERFORM screen2-IUD-Display
           .

       screen2-DUPLICATE-MOVEKEY.
           .

       screen2-First.
           PERFORM screen2-DUMMY-FIRST
           PERFORM DataSet1-mtordini-INITSTART
           PERFORM DataSet1-mtordini-START
           IF NOT Valid-STATUS-mtordini
              PERFORM screen2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:screen2, FORM:screen2, BeforeFirst>
      * <TOTEM:END>
           PERFORM DataSet1-mtordini-Read-Next
           IF NOT Valid-STATUS-mtordini
              PERFORM screen2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:screen2, FORM:screen2, AfterFirst>
      * <TOTEM:END>
           PERFORM screen2-DUPLICATE-MOVEKEY.
           PERFORM screen2-IUD-Display
           .

       screen2-Previous.
              PERFORM screen2-Buf-To-Fld
              PERFORM DataSet1-mtordini-START-LESS
           IF NOT Valid-STATUS-mtordini
              PERFORM screen2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:screen2, FORM:screen2, BeforePrevious>
      * <TOTEM:END>
           PERFORM DataSet1-mtordini-Read-Prev
           IF NOT Valid-STATUS-mtordini
              PERFORM screen2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:screen2, FORM:screen2, AfterPrevious>
      * <TOTEM:END>
           PERFORM screen2-DUPLICATE-MOVEKEY
           PERFORM screen2-DUMMY-PREVIOUS
           PERFORM screen2-IUD-Display
           .

       screen2-Next.
              PERFORM screen2-Buf-To-Fld
              PERFORM DataSet1-mtordini-START-GREATER
           IF NOT Valid-STATUS-mtordini
              PERFORM screen2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:screen2, FORM:screen2, BeforeNext>
      * <TOTEM:END>
           PERFORM DataSet1-mtordini-Read-Next
           IF NOT Valid-STATUS-mtordini
              PERFORM screen2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:screen2, FORM:screen2, AfterNext>
      * <TOTEM:END>
           PERFORM screen2-DUPLICATE-MOVEKEY
           PERFORM screen2-DUMMY-NEXT
           PERFORM screen2-IUD-Display
           .
      
       screen2-Last.
           PERFORM screen2-DUMMY-LAST
           PERFORM DataSet1-mtordini-INITEND
           PERFORM DataSet1-mtordini-START-NOTGREATER
           IF NOT Valid-STATUS-mtordini
              PERFORM screen2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:screen2, FORM:screen2, BeforeLast>
      * <TOTEM:END>
           PERFORM DataSet1-mtordini-Read-Prev
           IF NOT Valid-STATUS-mtordini
              PERFORM screen2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:screen2, FORM:screen2, AfterLast>
      * <TOTEM:END>
           PERFORM screen2-DUPLICATE-MOVEKEY.
           PERFORM screen2-IUD-Display
           .

       screen2-Curr.
      * <TOTEM:EPT. FORM:screen2, FORM:screen2, BeforeCurrent>
      * <TOTEM:END>
           PERFORM screen2-Buf-To-Fld
           PERFORM DataSet1-mtordini-Read
           PERFORM screen2-DUPLICATE-MOVEKEY
           PERFORM screen2-DUMMY-CURR
           PERFORM screen2-IUD-Display
      * <TOTEM:EPT. FORM:screen2, FORM:screen2, AfterCurrent>
      * <TOTEM:END>
           .

       screen2-IUD-Display.
           IF Valid-STATUS-mtordini
              PERFORM screen2-ALLGRID-RESET
              PERFORM screen2-Fld-To-Buf
              PERFORM screen2-NAVI-FOR-MASTERGRID
              PERFORM screen2-DISPLAY
           ELSE
              IF screen2-FLAG-REFRESH
                 CONTINUE
              ELSE
                 PERFORM screen2-Extended-File-Status
              END-IF
           END-IF
           .

       screen2-Add.
           PERFORM screen2-Buf-To-Fld
           PERFORM screen2-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM screen2-DUMMY-ADD
           PERFORM DataSet1-mtordini-INITREC
           PERFORM screen2-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:screen2, FORM:screen2, BeforeAdd>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-mtordini-Rec-Write
           IF Valid-STATUS-mtordini
              PERFORM screen2-RESUMMARY-INS
              PERFORM screen2-DUMMY-UPDATE-INIT
              MOVE "301" TO TOTEM-MSG-ID
              PERFORM screen2-IUD-Display
           END-IF
           PERFORM screen2-ERR-CHECKING
      * <TOTEM:EPT. FORM:screen2, FORM:screen2, AfterAdd>
      * <TOTEM:END>
           .
     
       screen2-Update.
           PERFORM screen2-Buf-To-Fld
           PERFORM DataSet1-mtordini-START              
           IF NOT Valid-STATUS-mtordini
              PERFORM screen2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
           PERFORM DataSet1-mtordini-Read
           PERFORM screen2-Buf-To-Fld
           PERFORM screen2-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM screen2-DUMMY-UPDATE
           PERFORM screen2-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:screen2, FORM:screen2, BeforeUpdate>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-mtordini-Rec-Rewrite
           IF Valid-STATUS-mtordini
              PERFORM screen2-RESUMMARY-DEL
              PERFORM screen2-DUMMY-UPDATE-INIT
              MOVE "302" TO TOTEM-MSG-ID
              PERFORM screen2-IUD-Display
           END-IF
           PERFORM screen2-ERR-CHECKING
      * <TOTEM:EPT. FORM:screen2, FORM:screen2, AfterUpdate>
      * <TOTEM:END>
           .

       screen2-Delete.
           MOVE "203" TO TOTEM-MSG-ID
           PERFORM MESSAGE-BOX-DISPLAY
           IF TOTEM-MSG-RETURN-VALUE NOT = 1
              INITIALIZE TOTEM-MSG-TEXT
              EXIT PARAGRAPH 
           END-IF
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:screen2, FORM:screen2, BeforeDelete>
      * <TOTEM:END>
           PERFORM screen2-DUMMY-DELETE
      * delete
           PERFORM screen2-Buf-To-Fld
           PERFORM DataSet1-mtordini-Rec-Delete
           IF Valid-STATUS-mtordini
              PERFORM screen2-CLEAR
              PERFORM screen2-DUMMY-DELETE-INIT
              MOVE "303" TO TOTEM-MSG-ID
              MOVE "00" to STATUS-mtordini
           END-IF
      * <TOTEM:EPT. FORM:screen2, FORM:screen2, AfterDelete>
      * <TOTEM:END>
           PERFORM screen2-ERR-CHECKING
           .

       screen2-NAVI-FOR-MASTERGRID.
           .

       screen2-ERR-CHECKING.
           IF Valid-STATUS-mtordini
              PERFORM screen2-SHOW-MSG-ROUTINE
           ELSE
              PERFORM screen2-Extended-File-Status
           END-IF
           .

       screen2-RESUMMARY-INS.
           .

       screen2-RESUMMARY-DEL.
           .


       screen2-DUMMY-FIRST.
           .

       screen2-DUMMY-PREVIOUS.
           .

       screen2-DUMMY-NEXT.
           .

       screen2-DUMMY-LAST.
           .

       screen2-DUMMY-CURR.
           .

       screen2-DUMMY-ADD.
           .

       screen2-DUMMY-UPDATE.
           .

       screen2-DUMMY-UPDATE-INIT.
           .

       screen2-DUMMY-DELETE.
           .

       screen2-DUMMY-DELETE-INIT.
           .

       screen2-Init-Value.
           INITIALIZE screen2-BUF
      * FORM : screen2
           PERFORM DataSet1-INIT-RECORD
      * <TOTEM:EPT. FORM:screen2, FORM:screen2, SetDefault>
      * <TOTEM:END>
           PERFORM screen2-FLD-TO-BUF
           .


       screen2-ALLGRID-RESET.
           .

      * for Form's Validation
       screen2-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       screen2-Buf-To-Fld.
      * <TOTEM:EPT. FORM:screen2, FORM:screen2, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:screen2, FORM:screen2, AfterBufToFld>
      * <TOTEM:END>
           .

       screen2-Fld-To-Buf.
      * <TOTEM:EPT. FORM:screen2, FORM:screen2, BeforeFldToBuf>
      * <TOTEM:END>
      * DB_LABEL : lab-clia
              MOVE cli-ragsoc-1  TO lab-clia-BUF
      * DB_LABEL : lab-ind-cli
              MOVE cli-indirizzo  TO lab-ind-cli-BUF
      * DB_LABEL : lab-loc-cli
              MOVE cli-localita  TO lab-loc-cli-BUF
      * DB_LABEL : lab-des
              MOVE des-ragsoc-1  TO lab-des-BUF
      * DB_LABEL : lab-ind-des
              MOVE des-indirizzo  TO lab-ind-des-BUF
      * DB_LABEL : lab-loc-des
              MOVE des-localita  TO lab-loc-des-BUF
      * DB_LABEL : lab-cau
              MOVE tca-descrizione  TO lab-cau-BUF
      * DB_LABEL : lab-anno
              MOVE mto-anno  TO lab-anno-BUF
      * DB_LABEL : lab-cliente
              MOVE mto-cod-cli  TO lab-cliente-BUF
      * DB_LABEL : lab-destino
              MOVE mto-prg-destino  TO lab-destino-BUF
      * DB_LABEL : lab-causale
              MOVE mto-causale  TO lab-causale-BUF
      * DB_LABEL : lab-annoa
              MOVE mto-numero  TO lab-annoa-BUF
      * <TOTEM:EPT. FORM:screen2, FORM:screen2, AfterFldToBuf>
           move mto-data-ordine to como-data.
           perform DATE-TO-SCREEN
           move como-data to lab-data-buf.

           .
      * <TOTEM:END>
           .

       screen2-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform screen2-BUF-TO-FLD.
           move 0 to scelta.
           .
       screen2-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM screen2-SHOW-MSG-ROUTINE
           .

       screen2-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM screen2-DISPLAY-MESSAGE
           .

       screen2-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       screen2-Save-Status.
           MOVE DataSet1-mtordini-KEY1-ORDER TO TMP-screen2-KEY1-ORDER
           MOVE DataSet1-KEYIS TO TMP-screen2-KEYIS
           MOVE mto-rec OF mtordini TO 
              TMP-screen2-mtordini-RESTOREBUF
           .             

       screen2-Restore-Status.
           MOVE TMP-screen2-KEY1-ORDER TO DataSet1-mtordini-KEY1-ORDER
           MOVE TMP-screen2-KEYIS TO DataSet1-KEYIS
           MOVE TMP-screen2-mtordini-RESTOREBUF TO
              mto-rec OF mtordini
           PERFORM DataSet1-mtordini-START
           IF Valid-STATUS-mtordini
              PERFORM DataSet1-mtordini-Read-Next
           ELSE
              PERFORM DataSet1-mtordini-INITREC
           END-IF
           PERFORM UNTIL NOT Valid-STATUS-mtordini OR
              (Valid-STATUS-mtordini AND
                 mto-rec OF mtordini = 
                   TMP-screen2-mtordini-RESTOREBUF)
              PERFORM DataSet1-mtordini-Read-Next
           END-PERFORM
           .


      * Paragrafo per la struttura del codice in AFTER sulla screen screen2
      ***---
       screen2-AFTER-SCREEN.

      * Generazione risettaggio keyboard "." ---> "."

      * Generazione stringa perform CONTROLLO
           evaluate control-id
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER CONTROLLO della screen
           when 99999 continue
           when other continue
           end-evaluate.



       Screen1-Event-Proc.
           .

       Screen1-Gd-1-Event-Proc.
           EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
           WHEN Msg-Begin-Drag ALSO 1 ALSO
                    form2-Handle 
              PERFORM gd-ordini-Ev-Msg-Begin-Drag
           WHEN Msg-Begin-Entry ALSO 1 ALSO
                    form2-Handle 
              PERFORM gd-ordini-Ev-Msg-Begin-Entry
           WHEN Msg-End-Drag ALSO 1 ALSO
                    form2-Handle 
              PERFORM gd-ordini-Ev-Msg-End-Drag
           WHEN Msg-Goto-Cell ALSO 1 ALSO
                    form2-Handle 
              PERFORM gd-ordini-Ev-Msg-Goto-Cell
           WHEN Msg-Goto-Cell-Drag ALSO 1 ALSO
                    form2-Handle 
              PERFORM gd-ordini-Ev-Msg-Goto-Cell-Drag
           WHEN Msg-Goto-Cell-Mouse ALSO 1 ALSO
                    form2-Handle 
              PERFORM gd-ordini-Ev-Msg-Goto-Cell-Mouse
           END-EVALUATE
           .

       Screen4-Event-Proc.
           .

       form3-Event-Proc.
           .

       Form1-Event-Proc.
           .

       Form1-Gd-1-Event-Proc.
           EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
           WHEN Msg-Begin-Drag ALSO 2000 ALSO
                    screen2-Handle 
              PERFORM Form1-Gd-1-Ev-Msg-Begin-Drag
           WHEN Msg-Begin-Entry ALSO 2000 ALSO
                    screen2-Handle 
              PERFORM Form1-Gd-1-Ev-Msg-Begin-Entry
           WHEN Msg-End-Drag ALSO 2000 ALSO
                    screen2-Handle 
              PERFORM Form1-Gd-1-Ev-Msg-End-Drag
           WHEN Msg-Finish-Entry ALSO 2000 ALSO
                    screen2-Handle 
              PERFORM Form1-Gd-1-Ev-Msg-Finish-Entry
           WHEN Msg-Goto-Cell ALSO 2000 ALSO
                    screen2-Handle 
              PERFORM Form1-Gd-1-Ev-Msg-Goto-Cell
           WHEN Msg-Goto-Cell-Drag ALSO 2000 ALSO
                    screen2-Handle 
              PERFORM Form1-Gd-1-Ev-Msg-Goto-Cell-Drag
           WHEN Msg-Goto-Cell-Mouse ALSO 2000 ALSO
                    screen2-Handle 
              PERFORM Form1-Gd-1-Ev-Msg-Goto-Cell-Mouse
           END-EVALUATE
           .

      * USER DEFINE PARAGRAPH
       CALCOLA-ADD-PIOMBO.
      * <TOTEM:PARA. CALCOLA-ADD-PIOMBO>
           move art-marca-prodotto to tpb-marca.
           move mto-data-ordine    to como-data-ordine tpb-data.
           move 0 to como-prm-cliente como-prm-destino.
           perform ADDIZIONALE-PIOMBO.
           move add-piombo to col-add como-add 
           .
      * <TOTEM:END>

       CAMBIA-FONT-RIGA.
      * <TOTEM:PARA. CAMBIA-FONT-RIGA>
           modify gd-ordini(riga), ROW-FONT = small-font.

           modify gd-ordini(riga, 1),
                  bitmap        = elemento-bmp,
                  bitmap-number = 1,
                  bitmap-width  = 16.


           move event-data-2 to riga.
           modify gd-ordini(riga), ROW-FONT = font-evidenzia-griglia..

      *    cambio la label legenda

           inquire gd-ordini(riga, 1), hidden-data = tipo-record
           evaluate true
           when r-inevaso
                move 78-colore-inevaso to col-stato-ordine
                move "Inevaso"     to tit-stato-ordine
           when r-emessa-bolla
                move 78-colore-emessa-bolla to col-stato-ordine
                move "Bollettato"  to tit-stato-ordine
           when r-fatturato
                move 78-colore-fatturato to col-stato-ordine
                move "Fatturato"   to tit-stato-ordine
           end-evaluate


           modify gd-ordini, (riga, 1),
                  bitmap        = elemento-bmp,
                  bitmap-number = 2,
                  bitmap-width  = 16.


           display form2 
           .
      * <TOTEM:END>

       CARICA-GRID.
      * <TOTEM:PARA. CARICA-GRID>
           modify form1-gd-1, mass-update = 1.
           modify form1-gd-1, reset-grid  = 1.
           perform FORM1-GD-1-CONTENT.

           move 1 to store-riga.
           set tutto-ok    to true.
           move mto-chiave to mro-chiave.
           move low-value  to mro-riga.
           start mrordini key is >= mro-chiave invalid continue 
           end-start
           perform until 1 = 2
              read mrordini next no lock at end exit perform end-read
              if mro-anno   not = mto-anno or
                 mro-numero not = mto-numero
                 exit perform
              end-if
              add 1 to store-riga

              move mro-riga         to col-num
              move mro-cod-articolo to col-art art-codice
              read articoli no lock invalid continue end-read

              initialize col-des
              inspect art-descrizione replacing trailing spaces 
                                      by low-value
              inspect mro-des-imballo replacing trailing spaces 
                                      by low-value
              move  mro-qta-imballi to imballi-ed
              call "C$JUSTIFY" using imballi-ed, "L"
BLISTR        if mro-si-blister
BLISTR           string  art-descrizione delimited by low-value
BLISTR                   " - "           delimited by size
BLISTR                   mro-des-imballo delimited by low-value
BLISTR                   " ("            delimited size
BLISTR                   imballi-ed      delimited spaces
BLISTR                   ")"             delimited size
BLISTR                   into col-des
BLISTR           end-string
              else
                 string  art-descrizione delimited by low-value
                         " - "           delimited by size
                         mro-des-imballo delimited by low-value
                         " da "          delimited by size
                         imballi-ed      delimited by spaces
                         " x "           delimited by size
                         art-udm-imballo delimited by size
                         into col-des
                 end-string                          
              end-if
              inspect mro-des-imballo replacing trailing low-value
                                      by spaces                
              inspect art-descrizione replacing trailing low-value
                                      by spaces

              move mro-qta           to col-qta
              move mro-prz-unitario  to col-uni

              move mro-perce-sconto  to col-sconto
              move mro-imp-consumo   to col-cons
              move mro-imp-cou-cobat to col-cou
              move mro-add-piombo    to col-add
              move mro-imponib-merce to col-imp
              move mro-cod-iva       to col-iva

              modify form1-gd-1(store-riga, 1),  cell-data = col-num
              modify form1-gd-1(store-riga, 2),  cell-data = col-art
              modify form1-gd-1(store-riga, 3),  cell-data = col-des
              modify form1-gd-1(store-riga, 4),  cell-data = col-qta
              modify form1-gd-1(store-riga, 5),  cell-data = col-uni
              modify form1-gd-1(store-riga, 6),  cell-data = col-sconto
              modify form1-gd-1(store-riga, 7),  cell-data = col-cons
              modify form1-gd-1(store-riga, 8),  cell-data = col-cou
              modify form1-gd-1(store-riga, 9),  cell-data = col-add
              modify form1-gd-1(store-riga, 10), cell-data = col-imp
              modify form1-gd-1(store-riga, 11), cell-data = col-iva

              if mro-si-omaggio
                 modify form1-gd-1(store-riga, 12),
                        bitmap = conferma-bmp
                        bitmap-number = 1
                        bitmap-width  = 19
              else
                 modify form1-gd-1(store-riga, 12),
                        bitmap = conferma-bmp
                        bitmap-number = 2
                        bitmap-width  = 19
              end-if

              if mro-bloccato-prezzo-si
      *****        if mro-prz-unitario > 99999
                 modify form1-gd-1(store-riga, 1), cell-color 176
                 set hid-si-bloccato to true
              else
                 set hid-no-bloccato to true
              end-if

              move mro-prz-unitario to hid-prezzo

              move mro-chiave to HiddenKey

              move mro-prg-chiave to prg-chiave
              read progmag no lock invalid continue end-read
              move prg-peso-utf to hid-peso-utf

              modify form1-gd-1(store-riga, 1),  
                     hidden-data = hidden-dati

      *****        move "IV"        to tbliv-codice1
      *****        move ror-cod-iva to tbliv-codice2
      *****        read tivaese invalid continue end-read
      *****        move tbliv-percentuale to hid-perce-iva

      *****        modify form1-gd-1(store-riga, 78-NumColMan + 19),
      *****               hidden-data = hid-perce-iva

      *****        compute SavePrezzo = ror-imponib-merce +
      *****                             ror-imp-cou-cobat +
      *****                             ror-imp-consumo
OMAGGI*****        compute SavePrezzo = 
OMAGGI*****                SavePrezzo * ( ror-qta - ror-qta-omaggi )
      *****        compute como-iva = 
      *****              ( SavePrezzo * hid-perce-iva ) / 100
      *****        add 0,005     to como-iva
      *****        move como-iva to como-iva-2dec
      *****        compute como-tot-ivato = 
      *****                como-tot-ivato + 
      *****                SavePrezzo + 
      *****                como-iva-2dec
              
           end-perform.

      *****     move como-tot-ivato to lab-tot-ivato-buf.
      *****     display lab-tot-ivato.
           modify form1-gd-1, mass-update = 0.

           set SiSalvato to true 
           .
      * <TOTEM:END>

       CARICA-ORDINI.
      * <TOTEM:PARA. CARICA-ORDINI>
           set mto-bloccato        to true.
           set mto-si-promo        to true.
           move data-from-AAAAMMGG to mto-data-ordine.
           move ordine-from        to mto-numero.
           move cliente-from       to mto-cod-cli.
           move low-value          to mto-prg-destino.

           start mtordini key is >= mto-k-bloc
                 invalid continue
             not invalid 
                 set trovato to false
                 modify gd-ordini, mass-update 1

                 perform until 1 = 2
                    read mtordini next at end exit perform end-read
                 
                    if mto-chiuso-man or mto-attivo
                       exit perform
                    end-if

                    if mto-data-ordine > data-to-AAAAMMGG
                       exit perform
                    end-if

                    set record-ok to true

                    if mto-numero < ordine-from or 
                       mto-numero > ordine-to
                       set record-ok to false
                    end-if

                    if mto-cod-cli not = cliente-from and 
                       cliente-from not = 0
                       set record-ok to false
                    end-if
              
                    if record-ok 
                       perform METTI-IN-GRIGLIA 
                    end-if

                 end-perform

                 modify gd-ordini, mass-update 0
           end-start 
           .
      * <TOTEM:END>

       CERCA.
      * <TOTEM:PARA. CERCA>
           evaluate control-id
           when 78-ID-ef-cliente-from
                inquire ef-cliente-from, value in cli-codice
                set cli-tipo-C to true
                move spaces to cli-ragsoc-1
                move "clienti-alfa-all" to como-file
                call "zoom-gt"  using  como-file, cli-rec
                               giving  stato-zoom
                cancel "zoom-gt"
                if stato-zoom = 0
                   move cli-codice to cliente-from
                   display ef-cliente-from
                   move cli-ragsoc-1 to lab-cli-buf
                   display lab-cli
                end-if
           end-evaluate 
           .
      * <TOTEM:END>

       CHIAMA-MANUTENZIONE.
      * <TOTEM:PARA. CHIAMA-MANUTENZIONE>
           set  RicaricaGrid       to false.
           move como-anno          to mto-anno.
           move como-numero-ordine to mto-numero.
           move mto-chiave         to LinkChiave.
      
           modify form2-Handle, visible = 0.
           perform SCREEN2-OPEN-ROUTINE.
           modify form2-Handle, visible = 1 
           .
      * <TOTEM:END>

       CONTROLLO.
      * <TOTEM:PARA. CONTROLLO>
           set tutto-ok to true.

           evaluate CONTROL-ID

           when 78-ID-ef-anno
                 inquire ef-anno, value in anno-to
                 if anno-to = ZERO
                    set errori  to true
                    display message "Inserimento anno mancante"
                            title tit-err
                            icon  mb-warning-icon
                    move 78-ID-ef-anno   to store-id
                 end-if

           when 78-ID-ef-ordine-from
                if tipo-elab = 1
                   if ordine-from = zero
                      if controllo-finale
                         set errori to true                             
                              

                         move 78-ID-ef-ordine-from to CONTROL-ID
                         display message "Il numero d'ordine è obbligato
      -    "rio!"
                                 title tit-err
                                 icon  MB-WARNING-ICON
                      end-if
                   else
                      move anno-to       to mto-anno
                      move ordine-from   to mto-numero
                      read mtordini
                           invalid 
                           set errori to true
                           move 78-ID-ef-ordine-from to CONTROL-ID
                           display message "Ordine inesistente!"
                                   title tit-err
                                   icon  MB-WARNING-ICON
                       not invalid
                           if mto-attivo or mto-chiuso-man
                              set errori to true
                              move 78-ID-ef-ordine-from to CONTROL-ID
                              display message "Ordine sbloccato!"
                                        title tit-err
                                         icon 2
                           end-if 
                      end-read
                   end-if
                end-if
           when 78-ID-ef-ordine-to
                if ordine-to = ZERO
                   move all "9" to ordine-to
                   modify EF-ORDINE-TO, VALUE ordine-to
                end-if
                if ordine-to < ordine-from
                   set errori to true
                   move 78-ID-ef-ordine-to to CONTROL-ID
                   display message MSG-intervallo-num-ord-err
                      title tit-err
                      icon  MB-WARNING-ICON
                end-if
           when 78-ID-ef-data-from
                if data-from not = zero
                   move data-from to como-data
                   perform DATE-FORMAT
                   move como-data to data-from
                end-if
           when 78-ID-ef-data-to
                if data-to = zero
                   move 99999999 to data-to
                end-if
                if data-to not = 99999999
                   move data-to to como-data
                   perform DATE-FORMAT
                   move como-data to data-to
                end-if

                move data-from(1:2)   to data-from-AAAAMMGG(7:2)
                move data-from(3:2)   to data-from-AAAAMMGG(5:2)
                move data-from(5:4)   to data-from-AAAAMMGG(1:4)
                move data-to(1:2)   to data-to-AAAAMMGG(7:2)
                move data-to(3:2)   to data-to-AAAAMMGG(5:2)
                move data-to(5:4)   to data-to-AAAAMMGG(1:4)

                if data-to-AAAAMMGG < data-from-AAAAMMGG
                   set errori to true
                   move 78-ID-ef-data-to to CONTROL-ID
                   display message MSG-intervallo-date-err
                      title tit-err
                      icon  MB-WARNING-ICON
                end-if

           when 78-ID-ef-cliente-from
                if cliente-from = 0
                   move "TUTTI I CLIENTI" to cli-ragsoc-1
                   move all "9" to cliente-to
                else
                   move cliente-from to cli-codice
                   set cli-tipo-C to true
                   read clienti no lock
                        invalid
                        set errori to true
                        display message "Cliente NON valido"
                                  title tit-err
                                   icon 2
                        move spaces to cli-ragsoc-1
                   end-read
                   move cliente-from to cliente-to
                end-if
                move cli-ragsoc-1 to lab-cli-buf
                display lab-cli
           end-evaluate.

           if errori
              perform CANCELLA-COLORE
              move CONTROL-ID to store-id
              move 4          to ACCEPT-CONTROL
           end-if.

           display form1 
           .
      * <TOTEM:END>

       METTI-IN-GRIGLIA.
      * <TOTEM:PARA. METTI-IN-GRIGLIA>
           move mto-anno     to col-anno.
           move mto-numero   to col-numero.

           move mto-data-creazione(1:4)  to col-data(7:4)
           move mto-data-creazione(5:2)  to col-data(4:2)
           move mto-data-creazione(7:2)  to col-data(1:2)

           move "/"                   to col-data(3:1)
                                         col-data(6:1).

           move mto-cod-cli           to Col-cliente
                                         cli-codice.

           set cli-tipo-C to true.
           read clienti   key cli-chiave.
           
           move cli-ragsoc-1          to  Col-rag-soc-cli.
           
           
           if mto-prg-destino = zero
              move space              to Col-rag-soc-destini
              move cli-indirizzo      to Col-indirizzo
              move cli-localita       to Col-localita              
           else
              move mto-cod-cli        to des-codice
              move mto-prg-destino    to des-prog
              read destini

              move des-ragsoc-1       to Col-rag-soc-destini
              move des-indirizzo      to Col-indirizzo
              move des-localita       to Col-localita              
           end-if.

           evaluate true
           when r-inevaso
                move 78-colore-inevaso      to como-colore
           when r-emessa-bolla
                move 78-colore-emessa-bolla to como-colore
           when r-fatturato
                move 78-colore-fatturato    to como-colore
           end-evaluate.

           modify gd-ordini, RECORD-TO-ADD Gd-ordini-Record.

           inquire gd-ordini, LAST-ROW = riga.

           modify gd-ordini(riga), row-color = como-colore.

           modify gd-ordini(riga, 1) hidden-data = tipo-record.
           set trovato to true 
           .
      * <TOTEM:END>

       ORDINE-DA-GRIGLIA.
      * <TOTEM:PARA. ORDINE-DA-GRIGLIA>
           inquire gd-ordini(riga), RECORD-DATA = Gd-ordini-Record.

           move col-anno            to como-anno.
           move Col-numero          to como-numero-ordine.
           move riga                to como-riga.

           perform CHIAMA-MANUTENZIONE.

           if RicaricaGrid
              move riga to save-riga
              perform RIEMPI-GRID
              move save-riga to riga

              inquire gd-ordini, last-row in tot-righe
              if tot-righe = 1
                 move 27 to key-status
              end-if

           end-if.

           modify gd-ordini, cursor-y = riga.
           perform CAMBIA-FONT-RIGA.

           move como-riga to riga, EVENT-DATA-2.
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>

       PARAGRAFO-COPY.
      * <TOTEM:PARA. PARAGRAFO-COPY>
           copy "utydata.cpy".
           copy "color-custom.cpy".
           copy "calcola-colore-trasparente.cpy".
           copy "addizionale-piombo.cpy".
           copy "trova-parametro.cpy" 
           .
      * <TOTEM:END>

       READ-RORDINI-LOCK.
      * <TOTEM:PARA. READ-RORDINI-LOCK>
           set RecLocked to false.
           perform until 1 = 2
              read rordini lock invalid continue end-read
              if errori or not RecLocked
                 exit perform
              end-if
           end-perform 
           .
      * <TOTEM:END>

       READ-TORDINI-LOCK.
      * <TOTEM:PARA. READ-TORDINI-LOCK>
           set RecLocked to false.
           perform until 1 = 2
              read tordini lock invalid continue end-read
              if errori or not RecLocked
                 exit perform
              end-if
           end-perform 
           .
      * <TOTEM:END>

       RIEMPI-GRID.
      * <TOTEM:PARA. RIEMPI-GRID>
           modify gd-ordini, mass-update = 1.
           modify gd-ordini, reset-grid = 1.
           perform GD-ORDINI-CONTENT.
           modify gd-ordini(1, 4), cell-data "Creazione".
           perform CARICA-ORDINI.
           modify gd-ordini, mass-update = 0 
           .
      * <TOTEM:END>

       SALVATAGGIO.
      * <TOTEM:PARA. SALVATAGGIO>
           set tutto-ok to true.

           unlock mtordini all record.
           inquire form1-gd-1, last-row in tot-righe.
           perform varying riga from 2 by 1 
                     until riga > tot-righe
              inquire form1-gd-1(riga, 1), hidden-data in hidden-dati
              move HiddenKey to mro-chiave
              read mrordini no lock invalid continue end-read
              inquire form1-gd-1(riga, 5), cell-data in col-uni
              move col-uni to mro-prz-unitario mro-prz-commle 
              inquire form1-gd-1(riga, 9), cell-data in col-add
              move col-add to mro-add-piombo
              inquire form1-gd-1(riga, 10), cell-data in col-imp
              move col-imp to mro-imponib-merce
              if mro-prz-unitario = 0
                 set mro-si-omaggio to true
                 move iva-omaggio   to mro-cod-iva 
                 move 0 to mro-imp-consumo   mro-imp-cou-cobat 
                           mro-imponib-merce mro-add-piombo
              else
                 set mro-no-omaggio to true
              end-if
              if mro-prz-unitario < 99999
                 perform AGGIORNA-PREZZI
                 set mro-bloccato-prezzo-no to true
              else
                 set errori to true
              end-if
              rewrite mro-rec invalid continue end-rewrite
           end-perform.
           set RicaricaGrid to true.

           if errori
              display message "Evasione non sbloccata!"
                       x"0d0a""Controllare i prezzi"
                        title tit-err
                         icon 2
           else
              initialize mto-causale-blocco
              set mto-attivo to true
              rewrite mto-rec invalid continue end-rewrite
              perform SBLOCCA-EVASIONI
              move 27 to key-status
           end-if.

      ***---
       AGGIORNA-PREZZI.
           move low-value        to ror-rec.
           move mro-chiave-testa to ror-chiave-ordine-testa.
           move mro-progr        to ror-progr-master.
           start rordini key >= ror-k-master
                 invalid continue
             not invalid
                 perform until 1 = 2
                    read rordini next no lock at end exit perform 
           end-read
                    if ror-chiave-ordine-testa not = mro-chiave-testa or
                       ror-progr-master        not = mro-progr
                       exit perform
                    end-if
                    move ror-anno       to tor-anno
                    move ror-num-ordine to tor-numero
                    perform READ-TORDINI-LOCK
                    if not RecLocked
                       if tor-anno-fattura = 0
                          perform READ-RORDINI-LOCK
                          if not RecLocked
                             move mro-prz-unitario  to ror-prz-unitario 
                             move mro-imp-consumo   to ror-imp-consumo  
                             move mro-imp-cou-cobat to ror-imp-cou-cobat
                             move mro-add-piombo    to ror-add-piombo   
                             move mro-imponib-merce to ror-imponib-merce
                             set  ror-attivo        to true
                             rewrite ror-rec
                             unlock rordini all record
                          end-if
                          start rordini key > ror-k-master
                                invalid exit perform
                          end-start
                       end-if
                    end-if
                 end-perform
           end-start.

      ***---
       SBLOCCA-EVASIONI.
           inquire form1-gd-1, last-row in tot-righe.
           perform varying riga from 2 by 1 
                     until riga > tot-righe
              inquire form1-gd-1(riga, 1), hidden-data in hidden-dati
              move HiddenKey to mro-chiave
              read mrordini no lock invalid continue end-read
              move low-value        to ror-rec
              move mro-chiave-testa to ror-chiave-ordine-testa
              move mro-progr        to ror-progr-master
              start rordini key >= ror-k-master
                    invalid continue
                not invalid
                    perform until 1 = 2
                       read rordini next no lock at end exit perform 
           end-read
                       if ror-chiave-ordine-testa not = 
           mro-chiave-testa or
                          ror-progr-master        not = mro-progr
                          exit perform
                       end-if
                       move ror-anno       to tor-anno
                       move ror-num-ordine to tor-numero
                       perform READ-TORDINI-LOCK
                       if not RecLocked
                          call   "trova-stato" using tor-chiave, 
           tor-stato
                          cancel "trova-stato"
                          rewrite tor-rec
                          if tor-data-bolla = 0
                             set tor-attivo to true
                             rewrite tor-rec
                          end-if
                       end-if
                       unlock tordini all records
                    end-perform
              end-start
           end-perform 
           .
      * <TOTEM:END>

       SPOSTAMENTO.
      * <TOTEM:PARA. SPOSTAMENTO>
           inquire gd-ordini, last-row in tot-righe.
           if event-data-2 < 2 move 2 to event-data-2 end-if.
           if event-data-2 > tot-righe move tot-righe to event-data-2 
           end-if.
           if riga not = event-data-2 
              perform CAMBIA-FONT-RIGA
           end-if 
           .
      * <TOTEM:END>

       SPOSTAMENTO-2.
      * <TOTEM:PARA. SPOSTAMENTO-2>
           inquire form1-gd-1, last-row in tot-righe.
           move event-data-2 to riga.
           if riga < 2 move 2 to riga end-if.
           if riga > tot-righe move tot-righe to riga end-if.

           inquire form1-gd-1(event-data-2, 1), 
                   hidden-data in hidden-dati.
           if hid-si-bloccato
              modify form1-gd-1, start-x = 2,    x = 12,
                                 start-y = riga, y = riga,
                                 region-color = 144,
                                 cursor-color = 485
           else
              modify form1-gd-1, start-x = 2,    x = 12,
                                 start-y = riga, y = riga,
                                 region-color = 144,
                                 cursor-color = 144
           end-if.
                                
           modify form1-gd-1, cursor-x = 5, cursor-y = riga.
           set event-action to event-action-fail 
           .
      * <TOTEM:END>

      * EVENT PARAGRAPH
       ginqui-Ev-Before-Program.
      * <TOTEM:PARA. ginqui-Ev-Before-Program>
           move LK-BL-PROG-ID    TO COMO-PROG-ID.
           perform CALCOLA-COLORE-TRASPARENTE.

      * Verdana10B-Occidentale
           INITIALIZE WFONT-DATA, font-evidenzia-griglia
           MOVE 10                TO WFONT-SIZE
           MOVE "Arial"           TO WFONT-NAME
           SET WFONT-BOLD         TO true
           SET WFONT-ITALIC       TO true
           SET WFONT-UNDERLINE    TO FALSE
           SET WFONT-STRIKEOUT    TO FALSE
           SET WFONT-FIXED-PITCH  TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     font-evidenzia-griglia, WFONT-DATA

           copy resource "elemento.bmp".
           call "W$BITMAP" using wbitmap-load, "elemento.bmp"
                          giving elemento-bmp.

           copy resource "conferma.bmp".
           call "W$BITMAP" using wbitmap-load "conferma.bmp"
                          giving conferma-bmp 
           .
      * <TOTEM:END>
       ginqui-Ev-After-Program.
      * <TOTEM:PARA. ginqui-Ev-After-Program>
           SET LK-BL-CANCELLAZIONE TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           DESTROY font-evidenzia-griglia.

           call "W$BITMAP" using wbitmap-destroy, elemento-bmp.
           call "W$BITMAP" using wbitmap-destroy, conferma-bmp 
           .
      * <TOTEM:END>
       Screen4-Rb-1-BeforeProcedure.
      * <TOTEM:PARA. Screen4-Rb-1-BeforeProcedure>
           modify control-handle, color = colore-nu
           .
      * <TOTEM:END>
       Screen4-Rb-1-AfterProcedure.
      * <TOTEM:PARA. Screen4-Rb-1-AfterProcedure>
           modify control-handle, color = colore-or
           .
      * <TOTEM:END>
       RB-SINGOLA-LinkTo.
      * <TOTEM:PARA. RB-SINGOLA-LinkTo>
           move 0 to mod-limiti.
           move 0 to cliente-from.
           move "<< HELP >> 0 = TUTTI I CLIENTI" to lab-cli-buf.
           display Form1 
           .
      * <TOTEM:END>
       RB-ELENCO-LinkTo.
      * <TOTEM:PARA. RB-ELENCO-LinkTo>
           move 1 to mod-limiti.
           display Form1 
           .
      * <TOTEM:END>
       EF-ANNO-TO-BeforeProcedure.
      * <TOTEM:PARA. EF-ANNO-TO-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       EF-ordine-FROM-BeforeProcedure.
      * <TOTEM:PARA. EF-ordine-FROM-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       EF-ordine-TO-BeforeProcedure.
      * <TOTEM:PARA. EF-ordine-TO-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       EF-data-FROM-BeforeProcedure.
      * <TOTEM:PARA. EF-data-FROM-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       EF-DATA-TO-BeforeProcedure.
      * <TOTEM:PARA. EF-DATA-TO-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       EF-CLIENTE-FROM-BeforeProcedure.
      * <TOTEM:PARA. EF-CLIENTE-FROM-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           move 1 to e-cerca.
           modify tool-cerca, enabled = e-cerca 
           .
      * <TOTEM:END>
       EF-ANNO-TO-AfterProcedure.
      * <TOTEM:PARA. EF-ANNO-TO-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO 
           .
      * <TOTEM:END>
       EF-ordine-FROM-AfterProcedure.
      * <TOTEM:PARA. EF-ordine-FROM-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO 
           .
      * <TOTEM:END>
       EF-ordine-TO-AfterProcedure.
      * <TOTEM:PARA. EF-ordine-TO-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO 
           .
      * <TOTEM:END>
       EF-data-FROM-AfterProcedure.
      * <TOTEM:PARA. EF-data-FROM-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO 
           .
      * <TOTEM:END>
       EF-DATA-TO-AfterProcedure.
      * <TOTEM:PARA. EF-DATA-TO-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO 
           .
      * <TOTEM:END>
       EF-CLIENTE-FROM-AfterProcedure.
      * <TOTEM:PARA. EF-CLIENTE-FROM-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO.
           move 0 to e-cerca.
           modify tool-cerca, enabled = e-cerca 
           .
      * <TOTEM:END>
       gd-ordini-Ev-Msg-Begin-Entry.
      * <TOTEM:PARA. gd-ordini-Ev-Msg-Begin-Entry>
           inquire gd-ordini, entry-reason in como-x.

           set EVENT-ACTION to EVENT-ACTION-FAIL-TERMINATE.
           evaluate como-x
           when X"00"|doppio click
           when X"0D"|invio
                inquire gd-ordini, CURSOR-Y = riga
                set CallManutenzione to true
           end-evaluate 
           .
      * <TOTEM:END>
       gd-ordini-Ev-Msg-Goto-Cell.
      * <TOTEM:PARA. gd-ordini-Ev-Msg-Goto-Cell>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd-ordini-Ev-Msg-Goto-Cell-Mouse.
      * <TOTEM:PARA. gd-ordini-Ev-Msg-Goto-Cell-Mouse>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd-ordini-Ev-Msg-End-Drag.
      * <TOTEM:PARA. gd-ordini-Ev-Msg-End-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd-ordini-Ev-Msg-Begin-Drag.
      * <TOTEM:PARA. gd-ordini-Ev-Msg-Begin-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd-ordini-Ev-Msg-Goto-Cell-Drag.
      * <TOTEM:PARA. gd-ordini-Ev-Msg-Goto-Cell-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       pb-ok-BeforeProcedure.
      * <TOTEM:PARA. pb-ok-BeforeProcedure>
           modify pb-ok, bitmap-number 2
           .
      * <TOTEM:END>
       pb-ok-AfterProcedure.
      * <TOTEM:PARA. pb-ok-AfterProcedure>
           modify pb-ok, bitmap-number 1
           .
      * <TOTEM:END>
       pb-annulla-BeforeProcedure.
      * <TOTEM:PARA. pb-annulla-BeforeProcedure>
           modify pb-annulla, bitmap-number 2
           .
      * <TOTEM:END>
       pb-annulla-AfterProcedure.
      * <TOTEM:PARA. pb-annulla-AfterProcedure>
           modify pb-annulla, bitmap-number 1
           .
      * <TOTEM:END>
       pb-annulla-LinkTo.
      * <TOTEM:PARA. pb-annulla-LinkTo>
           .
      * <TOTEM:END>
       pb-ok-LinkTo.
      * <TOTEM:PARA. pb-ok-LinkTo>
           set controllo-finale to true.

           move control-id to mem-id.
           perform  varying CONTROL-ID from 78-id-ef-anno by 1
                      until CONTROL-ID > 78-id-ef-cliente-from
              perform CONTROLLO
              if errori 
                 exit perform 
              end-if
           end-perform.

           set controllo-finale to false.

           if tutto-ok                        
              modify form1-Handle, visible 0
              if tipo-elab = 1
                 move anno-to      to como-anno
                 move ordine-from  to como-numero-ordine
                 perform CHIAMA-MANUTENZIONE
              else
                 perform FORM2-OPEN-ROUTINE 
              end-if                                          
              modify form1-Handle, visible 1
           end-if 
           .
      * <TOTEM:END>
       TOOL-CERCA-LinkTo.
      * <TOTEM:PARA. TOOL-CERCA-LinkTo>
           inquire tool-cerca, enabled in e-cerca.
           if e-cerca = 1
              perform CERCA
           end-if 
           .
      * <TOTEM:END>
       pb-annulla2-BeforeProcedure.
      * <TOTEM:PARA. pb-annulla2-BeforeProcedure>
           modify pb-annulla2, bitmap-number 2
           .
      * <TOTEM:END>
       pb-annulla2-AfterProcedure.
      * <TOTEM:PARA. pb-annulla2-AfterProcedure>
           modify pb-annulla2, bitmap-number 1
           .
      * <TOTEM:END>
       pb-ok2-BeforeProcedure.
      * <TOTEM:PARA. pb-ok2-BeforeProcedure>
           modify pb-ok2, bitmap-number 2
           .
      * <TOTEM:END>
       pb-ok2-AfterProcedure.
      * <TOTEM:PARA. pb-ok2-AfterProcedure>
           modify pb-ok2, bitmap-number 1
           .
      * <TOTEM:END>
       pb-ok2-LinkTo.
      * <TOTEM:PARA. pb-ok2-LinkTo>
           inquire gd-ordini, CURSOR-Y = riga.

           perform ORDINE-DA-GRIGLIA 
           .
      * <TOTEM:END>
       Form1-Gd-1-Ev-Msg-Begin-Drag.
      * <TOTEM:PARA. Form1-Gd-1-Ev-Msg-Begin-Drag>
           perform SPOSTAMENTO-2 
           .
      * <TOTEM:END>
       Form1-Gd-1-Ev-Msg-Begin-Entry.
      * <TOTEM:PARA. Form1-Gd-1-Ev-Msg-Begin-Entry>
           inquire form1-gd-1, cursor-y in riga.
           inquire form1-gd-1(riga, 1), hidden-data in hidden-dati.
      *****     if hid-no-bloccato
      *****        set event-action to event-action-fail
      *****     else
              evaluate event-data-1
              when 5     set environment "KEYSTROKE" to "DATA=44   46"
              when other set event-action to event-action-fail
              end-evaluate
      *****     end-if 
           .
      * <TOTEM:END>
       Form1-Gd-1-Ev-Msg-End-Drag.
      * <TOTEM:PARA. Form1-Gd-1-Ev-Msg-End-Drag>
           perform SPOSTAMENTO-2 
           .
      * <TOTEM:END>
       Form1-Gd-1-Ev-Msg-Goto-Cell.
      * <TOTEM:PARA. Form1-Gd-1-Ev-Msg-Goto-Cell>
           perform SPOSTAMENTO-2 
           .
      * <TOTEM:END>
       Form1-Gd-1-Ev-Msg-Goto-Cell-Drag.
      * <TOTEM:PARA. Form1-Gd-1-Ev-Msg-Goto-Cell-Drag>
           perform SPOSTAMENTO-2 
           .
      * <TOTEM:END>
       Form1-Gd-1-Ev-Msg-Goto-Cell-Mouse.
      * <TOTEM:PARA. Form1-Gd-1-Ev-Msg-Goto-Cell-Mouse>
           perform SPOSTAMENTO-2 
           .
      * <TOTEM:END>
       Form1-Gd-1-Ev-Msg-Finish-Entry.
      * <TOTEM:PARA. Form1-Gd-1-Ev-Msg-Finish-Entry>
           inquire form1-gd-1(event-data-2, 5), cell-data in col-uni.
           modify  form1-gd-1(event-data-2, 5), cell-data =  col-uni.
           move col-uni to como-prezzo.

           if SiSalvato
              inquire form1-gd-1(event-data-2, 1), 
                      hidden-data in hidden-dati
              if como-prezzo not = hid-prezzo
                 set NoSalvato to true
                 move event-data-2 to RigaCambiata
              end-if
           end-if.

           if como-prezzo not = 0
           
              inquire form1-gd-1(event-data-2, 2), cell-data in 
           art-codice
              read articoli no lock invalid continue end-read

              inquire form1-gd-1(event-data-2, 7), cell-data in 
           como-cons
              inquire form1-gd-1(event-data-2, 8), cell-data in como-cou
 
              if tcl-si-piombo and art-si-cobat
                 move como-cou    to como-imp-cou-cobat
                 move como-prezzo to como-prz-unitario
                 perform CALCOLA-ADD-PIOMBO
              else
                 move 0 to col-add como-add
              end-if

              if TrattamentoGDO
                 compute como-imp = 
                         como-prezzo - 
                         como-cons   - 
                         como-cou    -
                         como-add
                 move como-imp to col-imp
              else
                 move como-prezzo to col-imp
              end-if

              modify form1-gd-1(event-data-2, 10), cell-data col-imp
              modify form1-gd-1(event-data-2, 12),  
                     bitmap = conferma-bmp
                     bitmap-number = 2
                     bitmap-width  = 19
           else
              modify form1-gd-1(event-data-2, 12),  
                     bitmap = conferma-bmp
                     bitmap-number = 1
                     bitmap-width  = 19
              move 0 to col-cons col-cou col-imp col-add
           end-if.
                  
           modify form1-gd-1(event-data-2, 9), cell-data col-add
           modify form1-gd-1(event-data-2, 10), cell-data col-imp 
           .
      * <TOTEM:END>
       pb-oka-BeforeProcedure.
      * <TOTEM:PARA. pb-oka-BeforeProcedure>
           modify pb-oka, bitmap-number = 2 
           .
      * <TOTEM:END>
       pb-oka-LinkTo.
      * <TOTEM:PARA. pb-oka-LinkTo>
           display message "Sbloccare l'ordine confermando i prezzi?"
                     title titolo
                      type mb-yes-no
                    giving scelta
                   default mb-no.
           if scelta = mb-yes
              perform SALVATAGGIO
           end-if 
           .
      * <TOTEM:END>
       pb-annullaa-BeforeProcedure.
      * <TOTEM:PARA. pb-annullaa-BeforeProcedure>
           modify pb-annullaa, bitmap-number = 2 
           .
      * <TOTEM:END>
       pb-annullaa-AfterProcedure.
      * <TOTEM:PARA. pb-annullaa-AfterProcedure>
           modify pb-annullaa, bitmap-number = 1 
           .
      * <TOTEM:END>
       pb-oka-AfterProcedure.
      * <TOTEM:PARA. pb-oka-AfterProcedure>
           modify pb-oka, bitmap-number = 1 
           .
      * <TOTEM:END>

      *{TOTEM}END

      *{TOTEM}SHOW-MSG
       MESSAGE-FOR-FILEERROR.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
              MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           .

       SHOW-TRANSACTION-ROUTINE.
           IF TOTEM-TRANSACTION-FLAG = SPACES
              IF TRANSACTION-STATUS NOT = 0
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-1
              END-IF
           ELSE
              PERFORM SHOW-MSG-ROUTINE
              IF TRANSACTION-STATUS = 0
                 MOVE "Transazione terminata con Rollback." TO 
           TOTEM-MSG-3
              ELSE
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-3
              END-IF
           END-IF
           .

       SHOW-MSG-ROUTINE.
           MOVE SPACE TO TOTEM-MSG-1 TOTEM-MSG-2 TOTEM-MSG-3
           EVALUATE TOTEM-MSG-ID
               WHEN "10"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Nessun altro dato." TO TOTEM-MSG-2
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "22"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Chiave Duplicata." TO TOTEM-MSG-2
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "23"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Raggiunta fine file." TO TOTEM-MSG-2
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "101"
                    MOVE "Terminare l'applicazione?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "201"
                    MOVE "Aggiungere un nuovo record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "202"
                    MOVE "Aggiornare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "203"
                    MOVE "Cancellare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "204"
                    MOVE "Chiave duplicata." TO TOTEM-MSG-1
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "301"
                    MOVE "Inserimento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "302"
                    MOVE "Aggiornamento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "303"
                    MOVE "Cancellazione avvenuta con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "401"
                    MOVE "Shell non trovata." TO TOTEM-MSG-1
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN OTHER
                    MOVE TEXT-MESSAGE TO TOTEM-MSG-1
                    STRING "FILE:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-3
                    MOVE 0 TO TOTEM-IDX1
                    INSPECT TOTEM-MSG-3 TALLYING TOTEM-IDX1
                       FOR TRAILING SPACE
                    STRING TOTEM-MSG-3(1:TOTEM-MSG-LENGTH - 
           TOTEM-IDX1), 
                       ", FILE STATUS ", PRIMARY-ERROR "," 
                       SECONDARY-ERROR
                    DELIMITED BY SIZE INTO TOTEM-MSG-2
                    MOVE SPACES TO TOTEM-MSG-3
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
           END-EVALUATE
           PERFORM MESSAGE-BOX-ROUTINE
           .

       MESSAGE-BOX-ROUTINE.
           MOVE 1 TO TOTEM-MSG-TEXT-POINTER
           IF TOTEM-MSG-1 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-1 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              STRING TOTEM-MSG-1( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                 DELIMITED BY SIZE
                 INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-2 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-2 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-2( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-3 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-3 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-3( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-TEXT-POINTER = 1
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-TEXT TALLYING TOTEM-MSG-SIZE FOR 
           TRAILING SPACE
                  COMPUTE TOTEM-MSG-TEXT-POINTER = 
           TOTEM-MSG-FULL-LENGTH - TOTEM-MSG-SIZE + 1
           END-IF
           MOVE LOW-VALUES TO TOTEM-MSG-TEXT(TOTEM-MSG-TEXT-POINTER : 1 
           )
           .

       MESSAGE-BOX-DISPLAY.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

      *{TOTEM}END

