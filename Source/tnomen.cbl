      *{TOTEM}PRG-COMMENT
      * tnomen.Cbl
      * tnomen.Cbl is generated by TOTEM
      * This is a generated file. DO NOT modify this file directly.
      *{TOTEM}END
       IDENTIFICATION       DIVISION.
      *{TOTEM}PRGID
       PROGRAM-ID.          tnomen.
       AUTHOR.              ANDREA EVENTI.
       DATE-WRITTEN.        martedì 1 aprile 2014 19:20:10.
       REMARKS.
      *{TOTEM}END

       ENVIRONMENT          DIVISION.
       CONFIGURATION        SECTION.
       SPECIAL-NAMES.
      *{TOTEM}SPECIAL-NAME
      * <TOTEM:EPT. INIT:tnomen, INIT:tnomen, SpecialName>
      * <TOTEM:END>
      *{TOTEM}END
      *{TOTEM}ACTIVEX-DEF
      *{TOTEM}END
      *{TOTEM}DECIMAL-POINT
           DECIMAL-POINT IS COMMA.
      *{TOTEM}END

       INPUT-OUTPUT         SECTION.
       FILE-CONTROL.
      *{TOTEM}FILE-CONTROL
           COPY "tnomen.sl".
           COPY "anautf.sl".
           COPY "tparamge.sl".
      *{TOTEM}END
       DATA                 DIVISION.
       FILE                 SECTION.
      *{TOTEM}FILE
           COPY "tnomen.fd".
           COPY "anautf.fd".
           COPY "tparamge.fd".
      *{TOTEM}END

       WORKING-STORAGE      SECTION.
      *{TOTEM}ACU-DEF
               COPY "acugui.def".
               COPY "acucobol.def".
               COPY "crtvars.def".
               COPY "showmsg.def".
               COPY "totem.def".
               COPY "F:\Lubex\GESLUX\Copylib\UTYDATA.DEF".
               COPY "F:\Lubex\GESLUX\Copylib\comune.def".
               COPY "F:\Lubex\GESLUX\Copylib\custom.def".
      *{TOTEM}END

      *{TOTEM}COPY-WORKING
      * Key Status
       77 Key-Status IS SPECIAL-NAMES CRT STATUS PIC 9(5) VALUE 0.
          88 Enter-Pushed VALUE 13.
          88 Exit-Pushed VALUE 27.
          88 Message-Received VALUE 95.
          88 Event-Occurred VALUE 96.
          88 Screen-No-Input-Field VALUE 97.
      * Properties & User defined Working Stoarge
       77 Form1-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 TIPO-DATA        PIC  9(8)
                  VALUE IS 0.
       77 Form1-Tb-1-Handle
                  USAGE IS HANDLE OF WINDOW.
       78 titolo VALUE IS "Geslux - Tabella Codici Doganali". 
       77 E-ESCI           PIC  9
                  VALUE IS 1.
       77 E-NUOVO          PIC  9
                  VALUE IS 1.
       77 E-CANCELLA       PIC  9
                  VALUE IS 1.
       77 E-SALVA          PIC  9
                  VALUE IS 1.
       77 E-ANTEPRIMA      PIC  9
                  VALUE IS 0.
       77 E-MODIFICA       PIC  9
                  VALUE IS 1.
       77 E-STAMPA         PIC  9
                  VALUE IS 0.
       77 E-CERCA          PIC  9
                  VALUE IS 1.
       77 MESSAGGIO        PIC  X(300)
                  VALUE IS SPACE.
       77 SAV-LIVELLO-ABIL PIC  9(2).
       77 STATUS-USER      PIC  X(2).
           88 Valid-STATUS-USER VALUE IS "00" THRU "09". 
       77 Small-Font
                  USAGE IS HANDLE OF FONT SMALL-FONT.
       77 STATUS-EUVOXAFF  PIC  X(2).
           88 Valid-STATUS-EUVOXAFF VALUE IS "00" THRU "09". 
       77 toolbar-bmp      PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 col-x            PIC  x.
       77 col-id-x         PIC  x(8).
       77 CountChar        PIC  99.
       01 rec-grid.
           05 col-id           PIC  z(8).
           05 col-des          PIC  X(50).
           05 col-olio         PIC  X.
           05 col-utf          PIC  X.
           05 col-ic-cou       PIC  X.
           05 col-cobat        PIC  X.
           05 col-colonna      PIC  X.
           05 col-num-reg-c    PIC  z(8).
           05 col-num-reg-s1   PIC  z(8).
           05 col-num-reg-s2   PIC  z(8).
           05 col-num-reg-s3   PIC  z(8).
           05 col-oper         PIC  x(2).
           05 col-perce        PIC  zz9,99.
       77 Screen1-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 esegui_73x21-bmp PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 cod  PIC  z(8).
       77 des  PIC  x(50).
       77 e-cod            PIC  9
                  VALUE IS 1.
       77 e-des            PIC  9
                  VALUE IS 0.
       77 Default-Font
                  USAGE IS HANDLE OF FONT DEFAULT-FONT.
       77 lab-des2         PIC  x(50).
       01 OLD-nom-rec.
           05 OLD-nom-chiave.
               10 OLD-nom-codice   PIC  9(8).
           05 OLD-nom-dati.
               10 OLD-nom-descrizione          PIC  X(50).
               10 OLD-nom-olio     PIC  x.
                   88 OLD-nom-si-olio VALUE IS "S". 
                   88 OLD-nom-no-olio VALUE IS "N". 
               10 OLD-nom-utf      PIC  x.
                   88 OLD-nom-si-utf VALUE IS "S". 
                   88 OLD-nom-no-utf VALUE IS "N". 
               10 OLD-nom-ic-cou   PIC  x.
                   88 OLD-nom-si-ic-cou VALUE IS "S". 
                   88 OLD-nom-no-ic-cou VALUE IS "N". 
               10 OLD-nom-cobat    PIC  x.
                   88 OLD-nom-si-cobat VALUE IS "S". 
                   88 OLD-nom-no-cobat VALUE IS "N". 
               10 OLD-nom-colonna  PIC  x.
                   88 OLD-nom-col-A VALUE IS "A". 
                   88 OLD-nom-col-B VALUE IS "B". 
                   88 OLD-nom-col-C VALUE IS "C". 
                   88 OLD-nom-col-D VALUE IS "D". 
               10 OLD-nom-num-reg-c            PIC  9(8).
               10 OLD-nom-dati-comuni.
                   15 OLD-nom-data-creazione       PIC  9(8).
                   15 OLD-nom-ora-creazione        PIC  9(8).
                   15 OLD-nom-utente-creazione     PIC  X(10).
                   15 OLD-nom-data-ultima-modifica PIC  9(8).
                   15 OLD-nom-ora-ultima-modifica  PIC  9(8).
                   15 OLD-nom-utente-ultima-modifica           PIC  
           X(10).
               10 OLD-nom-vuoti.
                   15 OLD-nom-operatore            PIC  9.
                       88 OLD-nom-maggiore VALUE IS 1. 
                       88 OLD-nom-minore VALUE IS 2. 
                       88 OLD-nom-uguale VALUE IS 3. 
                       88 OLD-nom-min-u VALUE IS 4. 
                       88 OLD-nom-mag-u VALUE IS 5. 
                   15 OLD-nom-perce    PIC  9(3)v99.
                   15 OLD-nom-num-reg-s1           PIC  9(8).
                   15 OLD-nom-num-reg-s2           PIC  9(8).
                   15 OLD-nom-num-reg-s3           PIC  9(8).
                   15 OLD-nom-num-vuoto-3          PIC  9(15).
                   15 OLD-nom-alfa-vuoto-1         PIC  X(20).
                   15 OLD-nom-alfa-vuoto-2         PIC  X(20).
                   15 OLD-nom-alfa-vuoto-3         PIC  X(20).
       01 FILLER           PIC  XX.
           88 ricarica VALUE IS "SI"    WHEN SET TO FALSE  "NO". 
       77 STATUS-tnomen    PIC  X(2).
           88 Valid-STATUS-tnomen VALUE IS "00" THRU "09". 
       77 STATUS-anautf    PIC  X(2).
           88 Valid-STATUS-anautf VALUE IS "00" THRU "09". 
       77 STATUS-tparamge  PIC  X(2).
           88 Valid-STATUS-tparamge VALUE IS "00" THRU "09". 

      ***********************************************************
      *   Code Gen's Buffer                                     *
      ***********************************************************
       77 STATUS-Form1-FLAG-REFRESH PIC  9.
          88 Form1-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 TMP-Form1-KEY1-ORDER  PIC X VALUE "A".
       77 TMP-Form1-tnomen-RESTOREBUF  PIC X(228).
       77 TMP-Form1-KEYIS  PIC 9(3) VALUE 1.
       77 Form1-MULKEY-TMPBUF   PIC X(228).
       77 STATUS-SCREEN-SEARCH-FLAG-REFRESH PIC  9.
          88 SCREEN-SEARCH-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 TMP-DataSet1-tnomen-BUF     PIC X(228).
       77 TMP-DataSet1-anautf-BUF     PIC X(638).
       77 TMP-DataSet1-tparamge-BUF     PIC X(815).
      * VARIABLES FOR RECORD LENGTH.
       77  TotemFdSlRecordClearOffset   PIC 9(5) COMP-4.
       77  TotemFdSlRecordLength        PIC 9(5) COMP-4.
      * FILE'S LOCK MODE FLAG
       77 DataSet1-tnomen-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tnomen-LOCK  VALUE "Y".
       77 DataSet1-KEYIS   PIC 9(3) VALUE 1.
       77 DataSet1-tnomen-KEY1-ORDER  PIC X VALUE "A".
          88 DataSet1-tnomen-KEY1-Asc  VALUE "A".
          88 DataSet1-tnomen-KEY1-Desc VALUE "D".
       77 DataSet1-anautf-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-anautf-LOCK  VALUE "Y".
       77 DataSet1-anautf-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-anautf-KEY-Asc  VALUE "A".
          88 DataSet1-anautf-KEY-Desc VALUE "D".
       77 DataSet1-tparamge-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tparamge-LOCK  VALUE "Y".
       77 DataSet1-tparamge-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tparamge-KEY-Asc  VALUE "A".
          88 DataSet1-tparamge-KEY-Desc VALUE "D".


      *{TOTEM}END

      *{TOTEM}ID-LOGICI
      ***** Elenco ID Logici *****
      ***** Fine ID Logici *****
      *{TOTEM}END

       LINKAGE          SECTION.
      *{TOTEM}LINKAGE
           COPY  "COMMON-LINKAGE.DEF".

      *{TOTEM}END

       SCREEN           SECTION.
      *{TOTEM}COPY-SCREEN
      * FORM
       01 
           Form1, 
           .

      * LABEL
       05
           CST-BLOCKPGM, 
           Label, 
           COL 49,57, 
           LINE 1,00,
           LINES 0,46 ,
           SIZE 14,43 ,
           ID IS 12,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "BlockPgm",
           VISIBLE v-custom,
           .

      * GRID
       05
           form1-gd-1, 
           Grid, 
           COL 2,17, 
           LINE 1,85,
           LINES 37,00 ,
           SIZE 155,17 ,
           ADJUSTABLE-COLUMNS,
           BOXED,
           CENTERED-HEADINGS,
           DATA-COLUMNS (1, 9, 59, 60, 61, 62, 63, 64, 72, 80, 88, 96, 
           98),
           ALIGNMENT ("R", "L", "C", "C", "C", "C", "C", "R", "R", "R", 
           "R", "C", "R"),
           SEPARATION (5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5),
           DATA-TYPES ("9(8)", "X(50)", "X", "X", "X", "X", "U(1)", "9(8
      -    ")", "9(8)", "9(8)", "9(8)", "X(2)", "9(6)"),
           NUM-COL-HEADINGS 2,
           COLUMN-HEADINGS,
           CURSOR-FRAME-WIDTH 2,
           DIVIDER-COLOR 1,
           HEADING-COLOR 257,
           HEADING-DIVIDER-COLOR 1,
           HSCROLL,
           ID IS 1,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RECORD-DATA rec-grid,
           TILED-HEADINGS,
           USE-TAB,
           VIRTUAL-WIDTH 152,
           VPADDING 50,
           VSCROLL,
           EVENT PROCEDURE Form1-Gd-1-Event-Proc,
           .

      * TOOLBAR
       01
           Form1-Tb-1,
           .    

      * PUSH BUTTON
       05
           TOOL-ESCI, 
           Push-Button, 
           COL 1,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           ENABLED E-ESCI,
           EXCEPTION-VALUE 27,
           FLAT,
           ID IS 2,
           SELF-ACT,
           ESCAPE-BUTTON,
           TITLE "&Esci",
           .

      * PUSH BUTTON
       05
           TOOL-NUOVO, 
           Push-Button, 
           COL 6,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 2,
           UNFRAMED,
           SQUARE,
           ENABLED E-NUOVO,
           EXCEPTION-VALUE 2,
           FLAT,
           ID IS 6,
           SELF-ACT,
           TITLE "Nuovo (F2)",
           .

      * PUSH BUTTON
       05
           TOOL-CANCELLA, 
           Push-Button, 
           COL 16,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           UNFRAMED,
           SQUARE,
           ENABLED E-CANCELLA,
           EXCEPTION-VALUE 4,
           FLAT,
           ID IS 5,
           SELF-ACT,
           TITLE "Cancella (F4)",
           BITMAP-NUMBER BitmapNumDelete
           .

      * PUSH BUTTON
       05
           TOOL-SALVA, 
           Push-Button, 
           COL 11,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           UNFRAMED,
           SQUARE,
           ENABLED E-SALVA,
           EXCEPTION-VALUE 3,
           FLAT,
           ID IS 8,
           SELF-ACT,
           TITLE "Salva (F3)",
           BITMAP-NUMBER BitmapNumSave
           .

      * PUSH BUTTON
       05
           TOOL-ANTEPRIMA, 
           Push-Button, 
           COL 26,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           UNFRAMED,
           SQUARE,
           ENABLED E-ANTEPRIMA,
           EXCEPTION-VALUE 6,
           FLAT,
           ID IS 9,
           SELF-ACT,
           TITLE "Anteprima (F6)",
           BITMAP-NUMBER BitmapNumPreview
           .

      * CHECK BOX
       05
           TOOL-MODIFICA, 
           Check-Box, 
           COL 21,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 5,
           UNFRAMED,
           SQUARE,
           ENABLED E-MODIFICA,
           EXCEPTION-VALUE 1005
           FLAT,
           ID IS 7,
           SELF-ACT,
           TITLE "Modifica (F5)",
           VALUE MOD,
           AFTER PROCEDURE TOOL-MODIFICA-AfterProcedure,
           BEFORE PROCEDURE TOOL-MODIFICA-BeforeProcedure, 
           .
      * PUSH BUTTON
       05
           TOOL-STAMPA, 
           Push-Button, 
           COL 31,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           UNFRAMED,
           SQUARE,
           ENABLED E-STAMPA,
           EXCEPTION-VALUE 7,
           FLAT,
           ID IS 10,
           SELF-ACT,
           TITLE "Stampa (F7)",
           BITMAP-NUMBER BitmapNumPrint
           .

      * PUSH BUTTON
       05
           TOOL-CERCA, 
           Push-Button, 
           COL 36,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           UNFRAMED,
           SQUARE,
           ENABLED E-CERCA,
           EXCEPTION-VALUE 8,
           FLAT,
           ID IS 11,
           SELF-ACT,
           TITLE "Cerca (F8)",
           BITMAP-NUMBER BitmapNumZoom
           .

      * PUSH BUTTON
       05
           tool-CercaTesto, 
           Push-Button, 
           COL 41,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           BITMAP-NUMBER 20,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 1234,
           FLAT,
           FONT IS Small-Font,
           ID IS 3,
           SELF-ACT,
           TITLE "&Ricerca testo (Ctrl + F)",
           .

      * FORM
       01 
           SCREEN-SEARCH, 
           .

      * ENTRY FIELD
       05
           ef-cod, 
           Entry-Field, 
           COL 12,00, 
           LINE 2,00,
           LINES 1,31 ,
           SIZE 10,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED e-cod,
           FONT IS Small-Font,
           ID IS 1,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 8,
           NUMERIC,
           VALUE cod,
           AFTER PROCEDURE ef-cod-AfterProcedure, 
           BEFORE PROCEDURE ef-cod-BeforeProcedure, 
           .

      * RADIO BUTTON
       05
           rb-cod, 
           Radio-Button, 
           COL 47,00, 
           LINE 2,00,
           LINES 1,31 ,
           SIZE 2,14 ,
           EXCEPTION-VALUE 1000
           FLAT,
           FONT IS Small-Font,
           GROUP 1,
           GROUP-VALUE 1,
           ID IS 5,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Radio Button",
           VALUE tipo-ricerca,
           AFTER PROCEDURE rb-cod-AfterProcedure, 
           BEFORE PROCEDURE rb-cod-BeforeProcedure, 
           .
      * RADIO BUTTON
       05
           rb-des, 
           Radio-Button, 
           COL 47,00, 
           LINE 4,00,
           LINES 1,31 ,
           SIZE 2,14 ,
           EXCEPTION-VALUE 1001
           FLAT,
           FONT IS Small-Font,
           GROUP 1,
           GROUP-VALUE 2,
           ID IS 6,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Radio Button",
           VALUE tipo-ricerca,
           AFTER PROCEDURE rb-des-AfterProcedure, 
           BEFORE PROCEDURE rb-des-BeforeProcedure, 
           .
      * ENTRY FIELD
       05
           ef-des, 
           Entry-Field, 
           COL 12,00, 
           LINE 4,00,
           LINES 1,31 ,
           SIZE 34,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED e-des,
           FONT IS Small-Font,
           ID IS 2,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 50,
           VALUE des,
           AFTER PROCEDURE ef-des-AfterProcedure, 
           BEFORE PROCEDURE ef-des-BeforeProcedure, 
           .

      * PUSH BUTTON
       05
           pb-esegui, 
           Push-Button, 
           COL 34,43, 
           LINE 5,92,
           LINES 21,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE ESEGUI_73X21-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 13,
           FLAT,
           FONT IS Small-Font,
           ID IS 8,
           OK-BUTTON,
           TITLE "E&segue la ricerca del testo imputato",
           .

      * LABEL
       05
           Form2-La-1, 
           Label, 
           COL 1,86, 
           LINE 2,00,
           LINES 1,31 ,
           SIZE 6,14 ,
           FONT IS Small-Font,
           ID IS 3,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Codice",
           .

      * LABEL
       05
           Form2-La-2, 
           Label, 
           COL 1,86, 
           LINE 4,00,
           LINES 1,31 ,
           SIZE 8,43 ,
           FONT IS Small-Font,
           ID IS 4,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Descrizione",
           .

      * LABEL
       05
           Form2-Custom1-1, 
           Label, 
           COL 44,00, 
           LINE 1,15,
           LINES 0,69 ,
           SIZE 5,57 ,
           FONT IS Default-Font,
           ID IS 101,
           TRANSPARENT,
           TITLE "CUSTOM CONTROL",
           VISIBLE v-custom,
           .

      * CHECK BOX
       05
           cb-match, 
           Check-Box, 
           COL 11,71, 
           LINE 5,85,
           LINES 1,31 ,
           SIZE 2,14 ,
           FLAT,
           FONT IS Small-Font,
           ID IS 7,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           LEFT-TEXT,
           TITLE "   &M   ",
           VALUE MatchCase,
           AFTER PROCEDURE cb-match-AfterProcedure,
           BEFORE PROCEDURE cb-match-BeforeProcedure, 
           .
      * LABEL
       05
           Form2-La-3, 
           Label, 
           COL 1,86, 
           LINE 5,92,
           LINES 1,08 ,
           SIZE 9,00 ,
           FONT IS Small-Font,
           ID IS 78,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "&Match case",
           .

      *{TOTEM}END

      *{TOTEM}LINKPARA
       PROCEDURE  DIVISION USING LK-BLOCKPGM, USER-CODI, LIVELLO-ABIL.
      *{TOTEM}END

      *{TOTEM}DECLARATIVE
       DECLARATIVES.
      * <TOTEM:EPT. INIT:tnomen, INIT:tnomen, BeforeDeclarative>
       TNOMEN-ERR SECTION.
           use after error procedure on tnomen.
           evaluate status-tnomen
           when "35"
                display message "File [TNOMEN] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TNOMEN] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TNOMEN] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true 
           when "93"             
                move 0 to mod
                modify tool-modifica, value = mod  
                set StatusVisua to true
                open input tnomen
                display message box  MSG-Gia-in-uso-su-altro-terminale
                            x"0d0a", MSG-SOLA-VISUA
                        title = tit-err
                        icon is mb-error-icon      
           end-evaluate.
 
      ***---
       ANAUTF-ERR SECTION.
           use after error procedure on anautf.
           set tutto-ok  to true.
           evaluate status-anautf
           when "35"
                display message "File [ANAUTF] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [ANAUTF] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[ANAUTF] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       TPARAMGE-ERR SECTION.
           use after error procedure on tparamge.
           set tutto-ok  to true.
           evaluate status-tparamge
           when "35"
                display message "File [TPARAMGE] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TPARAMGE] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TPARAMGE] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.

      * <TOTEM:END>
       INPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON INPUT.
       0100-DECL.
           EXIT.
       I-O-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON I-O.
       0200-DECL.
           EXIT.
       OUTPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON OUTPUT.
       0300-DECL.
           EXIT.
       TRANSACTION-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON TRANSACTION.
       0400-DECL.
           EXIT.
       END DECLARATIVES.
      *{TOTEM}END

       MAIN-LOGIC.
      *{TOTEM}ENTRY-BEFPRG
      *    Before-Program
           PERFORM PAS004P-Ev-Before-Program
      *{TOTEM}END
           PERFORM INITIALIZE-ROUTINE.
      * run main screen
      *{TOTEM}RUN-MAINSCR
           PERFORM Form1-OPEN-ROUTINE.
      *{TOTEM}END

      *{TOTEM}COPY-PROCEDURE
       EXIT-STOP-ROUTINE.
           PERFORM CLOSE-FILE-RTN
      * <TOTEM:EPT. INIT:tnomen, INIT:tnomen, BeforeDestroyResource>
      * <TOTEM:END>
           CALL "w$bitmap" USING WBITMAP-DESTROY, toolbar-bmp
           CALL "w$bitmap" USING WBITMAP-DESTROY, TOOLBAR-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, ESEGUI_73X21-BMP
      *    After-Program
           PERFORM I-O-BLOCCO
           EXIT PROGRAM TOTEM-PgmStatus
           STOP RUN.

       INITIALIZE-ROUTINE.
      *    Before Init
      * initialize program status variable
           Initialize TOTEM-PgmStatus.
      * get system information
           ACCEPT SYSTEM-INFORMATION FROM SYSTEM-INFO.
      * get terminal information
           ACCEPT TERMINAL-ABILITIES FROM TERMINAL-INFO.
      * set font
           PERFORM INIT-FONT.
      * load bitmap
           PERFORM INIT-BMP.
      * load resource
           PERFORM INIT-RES.
      * create pop-up menu
           PERFORM INIT-POPUP.
      * open files
           PERFORM OPEN-FILE-RTN.
      *    After Init
           .
    
       INIT-FONT.
           .

       INIT-BMP.
      * TOOL-ESCI
           COPY RESOURCE "toolbar.bmp".
           CALL "w$bitmap" USING WBITMAP-LOAD "toolbar.bmp", 
                   GIVING toolbar-bmp.
      * TOOL-ANTEPRIMA
           COPY RESOURCE "TOOLBAR.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "TOOLBAR.BMP", 
                   GIVING TOOLBAR-BMP.
      * pb-esegui
           COPY RESOURCE "ESEGUI_73X21.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "ESEGUI_73X21.BMP", 
                   GIVING ESEGUI_73X21-BMP.
           .

       INIT-RES.
           .

       INIT-POPUP.
           .

       OPEN-FILE-RTN.
      *    Before Open
           PERFORM OPEN-tnomen
           PERFORM OPEN-anautf
           PERFORM OPEN-tparamge
      *    After Open
           .

       OPEN-tnomen.
      * <TOTEM:EPT. INIT:tnomen, FD:tnomen, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O tnomen
           IF STATUS-tnomen = "35"
              OPEN OUTPUT tnomen
                IF Valid-STATUS-tnomen
                   CLOSE tnomen
                   OPEN I-O tnomen
                END-IF
           END-IF
           IF NOT Valid-STATUS-tnomen
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:tnomen, FD:tnomen, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-anautf.
      * <TOTEM:EPT. INIT:tnomen, FD:anautf, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT anautf
           IF NOT Valid-STATUS-anautf
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:tnomen, FD:anautf, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tparamge.
      * <TOTEM:EPT. INIT:tnomen, FD:tparamge, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tparamge
           IF NOT Valid-STATUS-tparamge
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:tnomen, FD:tparamge, AfterOpen>
      * <TOTEM:END>
           .

       CLOSE-FILE-RTN.
      *    Before Close
           PERFORM CLOSE-tnomen
           PERFORM CLOSE-anautf
           PERFORM CLOSE-tparamge
      *    After Close
           .

       CLOSE-tnomen.
      * <TOTEM:EPT. INIT:tnomen, FD:tnomen, BeforeClose>
      * <TOTEM:END>
           CLOSE tnomen
           .

       CLOSE-anautf.
      * <TOTEM:EPT. INIT:tnomen, FD:anautf, BeforeClose>
      * <TOTEM:END>
           CLOSE anautf
           .

       CLOSE-tparamge.
      * <TOTEM:EPT. INIT:tnomen, FD:tparamge, BeforeClose>
      * <TOTEM:END>
           CLOSE tparamge
           .

       DataSet1-tnomen-INITSTART.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tnomen-KEY1-Asc
                 MOVE Low-Value TO nom-chiave
              ELSE
                 MOVE High-Value TO nom-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tnomen-INITEND.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tnomen-KEY1-Asc
                 MOVE High-Value TO nom-chiave
              ELSE
                 MOVE Low-Value TO nom-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           .   

       DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-tnomen-KEY1-ORDER
           END-EVALUATE
           .

       DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-tnomen-KEY1-ORDER
           END-EVALUATE
           .

      * tnomen
       DataSet1-tnomen-START.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tnomen-KEY1-Asc
                 START tnomen KEY >= nom-chiave
              ELSE
                 START tnomen KEY <= nom-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tnomen-START-NOTGREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tnomen-KEY1-Asc
                 START tnomen KEY <= nom-chiave
              ELSE
                 START tnomen KEY >= nom-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tnomen-START-GREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tnomen-KEY1-Asc
                 START tnomen KEY > nom-chiave
              ELSE
                 START tnomen KEY < nom-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tnomen-START-LESS.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tnomen-KEY1-Asc
                 START tnomen KEY < nom-chiave
              ELSE
                 START tnomen KEY > nom-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tnomen-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tnomen, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tnomen, BeforeReadRecord>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tnomen-LOCK
                 READ tnomen WITH LOCK 
                 KEY nom-chiave
              ELSE
                 READ tnomen WITH NO LOCK 
                 KEY nom-chiave
              END-IF
           END-EVALUATE
           MOVE STATUS-tnomen TO TOTEM-ERR-STAT 
           MOVE "tnomen" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tnomen, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tnomen, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tnomen-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tnomen, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tnomen, BeforeReadNext>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tnomen-KEY1-Asc
                 IF DataSet1-tnomen-LOCK
                    READ tnomen NEXT WITH LOCK
                 ELSE
                    READ tnomen NEXT WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-tnomen-LOCK
                    READ tnomen PREVIOUS WITH LOCK
                 ELSE
                    READ tnomen PREVIOUS WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           MOVE STATUS-tnomen TO TOTEM-ERR-STAT
           MOVE "tnomen" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tnomen, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tnomen, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tnomen-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tnomen, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tnomen, BeforeReadPrev>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tnomen-KEY1-Asc
                 IF DataSet1-tnomen-LOCK
                    READ tnomen PREVIOUS WITH LOCK
                 ELSE
                    READ tnomen PREVIOUS WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-tnomen-LOCK
                    READ tnomen NEXT WITH LOCK
                 ELSE
                    READ tnomen NEXT WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           MOVE STATUS-tnomen TO TOTEM-ERR-STAT
           MOVE "tnomen" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tnomen, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tnomen, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tnomen-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tnomen, BeforeWrite>
      * <TOTEM:END>
           WRITE nom-rec OF tnomen.
           MOVE STATUS-tnomen TO TOTEM-ERR-STAT
           MOVE "tnomen" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tnomen, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tnomen-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tnomen, BeforeRewrite>
      * <TOTEM:END>
           REWRITE nom-rec OF tnomen.
           MOVE STATUS-tnomen TO TOTEM-ERR-STAT
           MOVE "tnomen" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tnomen, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tnomen-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tnomen, BeforeDelete>
      * <TOTEM:END>
           DELETE tnomen.
           MOVE STATUS-tnomen TO TOTEM-ERR-STAT
           MOVE "tnomen" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tnomen, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-anautf-INITSTART.
           IF DataSet1-anautf-KEY-Asc
              MOVE Low-Value TO utf-chiave
           ELSE
              MOVE High-Value TO utf-chiave
           END-IF
           .

       DataSet1-anautf-INITEND.
           IF DataSet1-anautf-KEY-Asc
              MOVE High-Value TO utf-chiave
           ELSE
              MOVE Low-Value TO utf-chiave
           END-IF
           .

      * anautf
       DataSet1-anautf-START.
           IF DataSet1-anautf-KEY-Asc
              START anautf KEY >= utf-chiave
           ELSE
              START anautf KEY <= utf-chiave
           END-IF
           .

       DataSet1-anautf-START-NOTGREATER.
           IF DataSet1-anautf-KEY-Asc
              START anautf KEY <= utf-chiave
           ELSE
              START anautf KEY >= utf-chiave
           END-IF
           .

       DataSet1-anautf-START-GREATER.
           IF DataSet1-anautf-KEY-Asc
              START anautf KEY > utf-chiave
           ELSE
              START anautf KEY < utf-chiave
           END-IF
           .

       DataSet1-anautf-START-LESS.
           IF DataSet1-anautf-KEY-Asc
              START anautf KEY < utf-chiave
           ELSE
              START anautf KEY > utf-chiave
           END-IF
           .

       DataSet1-anautf-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:anautf, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:anautf, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-anautf-LOCK
              READ anautf WITH LOCK 
              KEY utf-chiave
           ELSE
              READ anautf WITH NO LOCK 
              KEY utf-chiave
           END-IF
           MOVE STATUS-anautf TO TOTEM-ERR-STAT 
           MOVE "anautf" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:anautf, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:anautf, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-anautf-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:anautf, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:anautf, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-anautf-KEY-Asc
              IF DataSet1-anautf-LOCK
                 READ anautf NEXT WITH LOCK
              ELSE
                 READ anautf NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-anautf-LOCK
                 READ anautf PREVIOUS WITH LOCK
              ELSE
                 READ anautf PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-anautf TO TOTEM-ERR-STAT
           MOVE "anautf" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:anautf, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:anautf, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-anautf-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:anautf, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:anautf, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-anautf-KEY-Asc
              IF DataSet1-anautf-LOCK
                 READ anautf PREVIOUS WITH LOCK
              ELSE
                 READ anautf PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-anautf-LOCK
                 READ anautf NEXT WITH LOCK
              ELSE
                 READ anautf NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-anautf TO TOTEM-ERR-STAT
           MOVE "anautf" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:anautf, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:anautf, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-anautf-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:anautf, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-anautf TO TOTEM-ERR-STAT
           MOVE "anautf" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:anautf, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-anautf-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:anautf, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-anautf TO TOTEM-ERR-STAT
           MOVE "anautf" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:anautf, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-anautf-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:anautf, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-anautf TO TOTEM-ERR-STAT
           MOVE "anautf" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:anautf, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tparamge-INITSTART.
           IF DataSet1-tparamge-KEY-Asc
              MOVE Low-Value TO tge-chiave
           ELSE
              MOVE High-Value TO tge-chiave
           END-IF
           .

       DataSet1-tparamge-INITEND.
           IF DataSet1-tparamge-KEY-Asc
              MOVE High-Value TO tge-chiave
           ELSE
              MOVE Low-Value TO tge-chiave
           END-IF
           .

      * tparamge
       DataSet1-tparamge-START.
           IF DataSet1-tparamge-KEY-Asc
              START tparamge KEY >= tge-chiave
           ELSE
              START tparamge KEY <= tge-chiave
           END-IF
           .

       DataSet1-tparamge-START-NOTGREATER.
           IF DataSet1-tparamge-KEY-Asc
              START tparamge KEY <= tge-chiave
           ELSE
              START tparamge KEY >= tge-chiave
           END-IF
           .

       DataSet1-tparamge-START-GREATER.
           IF DataSet1-tparamge-KEY-Asc
              START tparamge KEY > tge-chiave
           ELSE
              START tparamge KEY < tge-chiave
           END-IF
           .

       DataSet1-tparamge-START-LESS.
           IF DataSet1-tparamge-KEY-Asc
              START tparamge KEY < tge-chiave
           ELSE
              START tparamge KEY > tge-chiave
           END-IF
           .

       DataSet1-tparamge-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tparamge-LOCK
              READ tparamge WITH LOCK 
              KEY tge-chiave
           ELSE
              READ tparamge WITH NO LOCK 
              KEY tge-chiave
           END-IF
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT 
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tparamge-KEY-Asc
              IF DataSet1-tparamge-LOCK
                 READ tparamge NEXT WITH LOCK
              ELSE
                 READ tparamge NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tparamge-LOCK
                 READ tparamge PREVIOUS WITH LOCK
              ELSE
                 READ tparamge PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tparamge-KEY-Asc
              IF DataSet1-tparamge-LOCK
                 READ tparamge PREVIOUS WITH LOCK
              ELSE
                 READ tparamge PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tparamge-LOCK
                 READ tparamge NEXT WITH LOCK
              ELSE
                 READ tparamge NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-INIT-RECORD.
           INITIALIZE nom-rec OF tnomen
           INITIALIZE utf-rec OF anautf
           INITIALIZE tge-rec OF tparamge
           .


      * GRID
       form1-gd-1-Content.
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 1, Y = 1,
                CELL-DATA = "Codice",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 2, Y = 1,
                CELL-DATA = "Descrizione",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 3, Y = 1,
                CELL-DATA = "Olio",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 4, Y = 1,
                CELL-DATA = "UTF",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 5, Y = 1,
                CELL-DATA = "I. Consumo",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 6, Y = 1,
                CELL-DATA = "COBAT",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 7, Y = 1,
                CELL-DATA = "Colonna",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 8, Y = 1,
                CELL-DATA = "N. Registro",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 9, Y = 1,
                CELL-DATA = "N. Registro",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 10, Y = 1,
                CELL-DATA = "N. Registro",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 11, Y = 1,
                CELL-DATA = "N. Registro",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 13, Y = 1,
                CELL-DATA = "Assoggett.",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 5, Y = 2,
                CELL-DATA = "COU",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 7, Y = 2,
                CELL-DATA = "Solo A e D",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 8, Y = 2,
                CELL-DATA = "Carico",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 9, Y = 2,
                CELL-DATA = "Scarico 1",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 10, Y = 2,
                CELL-DATA = "Scarico 2",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 11, Y = 2,
                CELL-DATA = "Scarico 3",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 13, Y = 2,
                CELL-DATA = "Imposte",
      * COLUMNS' SETTING
              MODIFY form1-gd-1, X = 1  
                COLUMN-FONT = Small-Font,
      * COLUMNS' SETTING
              MODIFY form1-gd-1, X = 2  
                COLUMN-FONT = Small-Font,
           .

      * FD's Initialize Paragraph
       DataSet1-tnomen-INITREC.
           INITIALIZE nom-rec OF tnomen
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-anautf-INITREC.
           INITIALIZE utf-rec OF anautf
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tparamge-INITREC.
           INITIALIZE tge-rec OF tparamge
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      *
       DataSet1-DISPATCH-BUFTOFLD.
           EVALUATE TOTEM-Form-Index ALSO TOTEM-Frame-Index
              WHEN 1 ALSO 0
                  PERFORM Form1-Buf-To-Fld
           END-EVALUATE
           .

       Form1-Open-Routine.
           PERFORM Form1-Scrn
           PERFORM Form1-Proc
           .

       Form1-Scrn.
           PERFORM Form1-Create-Win
           PERFORM Form1-Init-Value
           PERFORM Form1-Init-Data
      * Tab keystrok settings
      * Tool Bar
           DISPLAY Form1-Tb-1
           PERFORM Form1-DISPLAY
           .

       Form1-Create-Win.
           Display Independent GRAPHICAL WINDOW
              LINES 40,46,
              SIZE 157,50,
              COLOR 65793,
              CONTROL FONT Small-Font,
              LINK TO THREAD,
              NO SCROLL,
              TITLE-BAR,
              TITLE titolo,
              AUTO-MINIMIZE,
              WITH SYSTEM MENU,
              USER-GRAY,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE Form1-Event-Proc,
              HANDLE IS Form1-Handle,
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
           DISPLAY TOOL-BAR 
              LINES 2,69,   
              HANDLE IN Form1-Tb-1-Handle
           DISPLAY Form1-Tb-1 UPON Form1-Tb-1-Handle

      * Status-bar
           DISPLAY Form1 UPON Form1-Handle
      * DISPLAY-COLUMNS settings
              MODIFY form1-gd-1, DISPLAY-COLUMNS (1, 11, 51, 58, 65, 
           75, 83, 93, 104, 115, 126, 137, 142)
           .

       Form1-PROC.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeAccept>
           |lettura file tparamge x anno esercizio
           move spaces to tge-codice.
           read tparamge no lock invalid continue end-read.

           perform ABILITA-TOOLBAR.

           perform FORM1-GD-1-CONTENT.
           perform LOAD-RECORD.

           move 2  to event-data-2.
           perform SPOSTAMENTO.

           perform INIT.

      * SPECIFICO DEI PGM. CON GRID-CONTROL
           perform ABILITAZIONI.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT Form1
                 ON EXCEPTION
                    PERFORM Form1-Evaluate-Func
                 MOVE 1 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY Form1-Handle
           INITIALIZE Key-Status
           .

       Form1-Evaluate-Func.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterAccept>
      *    PER IL BOTTONE MODIFICA
           if key-status = 5
              inquire tool-modifica, enabled in e-modifica
              if e-modifica = 1
                 if mod = zero
                    move 1    to mod
                 else 
                    move zero to mod
                 end-if
                 modify tool-modifica, value = mod
                 perform MODIFICA
              end-if
           end-if.

           .
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM Form1-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM Form1-Exit
                 END-IF
              WHEN Key-Status = 2
                 PERFORM NUOVO-LinkTo
              WHEN Key-Status = 4
                 PERFORM CANCELLA-LinkTo
              WHEN Key-Status = 3
                 PERFORM TOOL-SALVA-LinkTo
              WHEN Key-Status = 6
                 PERFORM ANTEPRIMA-LinkTo
              WHEN Key-Status = 1005
                 PERFORM TOOL-MODIFICA-LinkTo
              WHEN Key-Status = 7
                 PERFORM STAMPA-LinkTo
              WHEN Key-Status = 8
                 PERFORM TOOL-CERCA-LinkTo
              WHEN Key-Status = 1234
                 PERFORM tool-CercaTesto-LinkTo
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       Form1-CLEAR.
           PERFORM Form1-INIT-VALUE
           PERFORM Form1-DISPLAY
           .

       Form1-DISPLAY.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY Form1-Tb-1
           DISPLAY Form1 UPON Form1-Handle
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterDisplay>
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       Form1-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeExit>
           perform SALV-MOD.
           if errori
              move 28 to key-status
              exit paragraph
           end-if.

           .
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       Form1-Init-Data.
           MOVE 1 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
      * GRID
           PERFORM form1-gd-1-Content
           .

       Form1-DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-tnomen-KEY1-ORDER
           END-EVALUATE
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-tnomen-KEY1-ORDER
           END-EVALUATE
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Update-Key.
           MOVE nom-rec OF tnomen TO
                     Form1-MULKEY-TMPBUF
           PERFORM Form1-CLEAR
           PERFORM Form1-INIT-DATA
           MOVE Form1-MULKEY-TMPBUF TO
                     nom-rec OF tnomen
           PERFORM DataSet1-tnomen-Read
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-CURR
           PERFORM Form1-IUD-Display
           .

       Form1-DUPLICATE-MOVEKEY.
           .

       Form1-First.
           PERFORM Form1-DUMMY-FIRST
           PERFORM DataSet1-tnomen-INITSTART
           PERFORM DataSet1-tnomen-START
           IF NOT Valid-STATUS-tnomen
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeFirst>
      * <TOTEM:END>
           PERFORM DataSet1-tnomen-Read-Next
           IF NOT Valid-STATUS-tnomen
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterFirst>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY.
           PERFORM Form1-IUD-Display
           .

       Form1-Previous.
              PERFORM Form1-Buf-To-Fld
              PERFORM DataSet1-tnomen-START-LESS
           IF NOT Valid-STATUS-tnomen
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforePrevious>
      * <TOTEM:END>
           PERFORM DataSet1-tnomen-Read-Prev
           IF NOT Valid-STATUS-tnomen
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterPrevious>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-PREVIOUS
           PERFORM Form1-IUD-Display
           .

       Form1-Next.
              PERFORM Form1-Buf-To-Fld
              PERFORM DataSet1-tnomen-START-GREATER
           IF NOT Valid-STATUS-tnomen
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeNext>
      * <TOTEM:END>
           PERFORM DataSet1-tnomen-Read-Next
           IF NOT Valid-STATUS-tnomen
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterNext>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-NEXT
           PERFORM Form1-IUD-Display
           .
      
       Form1-Last.
           PERFORM Form1-DUMMY-LAST
           PERFORM DataSet1-tnomen-INITEND
           PERFORM DataSet1-tnomen-START-NOTGREATER
           IF NOT Valid-STATUS-tnomen
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeLast>
      * <TOTEM:END>
           PERFORM DataSet1-tnomen-Read-Prev
           IF NOT Valid-STATUS-tnomen
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterLast>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY.
           PERFORM Form1-IUD-Display
           .

       Form1-Curr.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeCurrent>
      * <TOTEM:END>
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-tnomen-Read
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-CURR
           PERFORM Form1-IUD-Display
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterCurrent>
      * <TOTEM:END>
           .

       Form1-IUD-Display.
           IF Valid-STATUS-tnomen
              PERFORM Form1-ALLGRID-RESET
              PERFORM Form1-Fld-To-Buf
              PERFORM Form1-NAVI-FOR-MASTERGRID
              PERFORM Form1-DISPLAY
           ELSE
              IF Form1-FLAG-REFRESH
                 CONTINUE
              ELSE
                 PERFORM Form1-Extended-File-Status
              END-IF
           END-IF
           .

       Form1-Add.
           PERFORM Form1-Buf-To-Fld
           PERFORM Form1-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM Form1-DUMMY-ADD
           PERFORM DataSet1-tnomen-INITREC
           PERFORM Form1-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeAdd>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-tnomen-Rec-Write
           IF Valid-STATUS-tnomen
              PERFORM Form1-RESUMMARY-INS
              PERFORM Form1-DUMMY-UPDATE-INIT
              MOVE "301" TO TOTEM-MSG-ID
              PERFORM Form1-IUD-Display
           END-IF
           PERFORM Form1-ERR-CHECKING
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterAdd>
      * <TOTEM:END>
           .
     
       Form1-Update.
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-tnomen-START              
           IF NOT Valid-STATUS-tnomen
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
           PERFORM DataSet1-tnomen-Read
           PERFORM Form1-Buf-To-Fld
           PERFORM Form1-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM Form1-DUMMY-UPDATE
           PERFORM Form1-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeUpdate>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-tnomen-Rec-Rewrite
           IF Valid-STATUS-tnomen
              PERFORM Form1-RESUMMARY-DEL
              PERFORM Form1-DUMMY-UPDATE-INIT
              MOVE "302" TO TOTEM-MSG-ID
              PERFORM Form1-IUD-Display
           END-IF
           PERFORM Form1-ERR-CHECKING
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterUpdate>
      * <TOTEM:END>
           .

       Form1-Delete.
           MOVE "203" TO TOTEM-MSG-ID
           PERFORM MESSAGE-BOX-DISPLAY
           IF TOTEM-MSG-RETURN-VALUE NOT = 1
              INITIALIZE TOTEM-MSG-TEXT
              EXIT PARAGRAPH 
           END-IF
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDelete>
      * <TOTEM:END>
           PERFORM Form1-DUMMY-DELETE
      * delete
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-tnomen-Rec-Delete
           IF Valid-STATUS-tnomen
              PERFORM Form1-CLEAR
              PERFORM Form1-DUMMY-DELETE-INIT
              MOVE "303" TO TOTEM-MSG-ID
              MOVE "00" to STATUS-tnomen
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterDelete>
      * <TOTEM:END>
           PERFORM Form1-ERR-CHECKING
           .

       Form1-NAVI-FOR-MASTERGRID.
           .

       Form1-ERR-CHECKING.
           IF Valid-STATUS-tnomen
              PERFORM Form1-SHOW-MSG-ROUTINE
           ELSE
              PERFORM Form1-Extended-File-Status
           END-IF
           .

       Form1-RESUMMARY-INS.
           .

       Form1-RESUMMARY-DEL.
           .


       Form1-DUMMY-FIRST.
           .

       Form1-DUMMY-PREVIOUS.
           .

       Form1-DUMMY-NEXT.
           .

       Form1-DUMMY-LAST.
           .

       Form1-DUMMY-CURR.
           .

       Form1-DUMMY-ADD.
           .

       Form1-DUMMY-UPDATE.
           .

       Form1-DUMMY-UPDATE-INIT.
           .

       Form1-DUMMY-DELETE.
           .

       Form1-DUMMY-DELETE-INIT.
           .

       Form1-Init-Value.
           MOVE titolo TO TOTEM-MSG-TITLE
      * FORM : Form1
           PERFORM DataSet1-INIT-RECORD
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, SetDefault>
      * <TOTEM:END>
           PERFORM Form1-FLD-TO-BUF
           .


       Form1-ALLGRID-RESET.
           .

      * for Form's Validation
       Form1-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       Form1-Buf-To-Fld.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterBufToFld>
      * <TOTEM:END>
           .

       Form1-Fld-To-Buf.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeFldToBuf>
           set SiSalvato to true.

           .
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterFldToBuf>
      * <TOTEM:END>
           .

       Form1-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform Form1-BUF-TO-FLD.
           move 0 to scelta.
           .
       Form1-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM Form1-SHOW-MSG-ROUTINE
           .

       Form1-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM Form1-DISPLAY-MESSAGE
           .

       Form1-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       Form1-Save-Status.
           MOVE DataSet1-tnomen-KEY1-ORDER TO TMP-Form1-KEY1-ORDER
           MOVE DataSet1-KEYIS TO TMP-Form1-KEYIS
           MOVE nom-rec OF tnomen TO 
              TMP-Form1-tnomen-RESTOREBUF
           .             

       Form1-Restore-Status.
           MOVE TMP-Form1-KEY1-ORDER TO DataSet1-tnomen-KEY1-ORDER
           MOVE TMP-Form1-KEYIS TO DataSet1-KEYIS
           MOVE TMP-Form1-tnomen-RESTOREBUF TO
              nom-rec OF tnomen
           PERFORM DataSet1-tnomen-START
           IF Valid-STATUS-tnomen
              PERFORM DataSet1-tnomen-Read-Next
           ELSE
              PERFORM DataSet1-tnomen-INITREC
           END-IF
           PERFORM UNTIL NOT Valid-STATUS-tnomen OR
              (Valid-STATUS-tnomen AND
                 nom-rec OF tnomen = 
                   TMP-Form1-tnomen-RESTOREBUF)
              PERFORM DataSet1-tnomen-Read-Next
           END-PERFORM
           .

       SCREEN-SEARCH-Open-Routine.
           PERFORM SCREEN-SEARCH-Scrn
           PERFORM SCREEN-SEARCH-Proc
           .

       SCREEN-SEARCH-Scrn.
           PERFORM SCREEN-SEARCH-Create-Win
           PERFORM SCREEN-SEARCH-Init-Value
           PERFORM SCREEN-SEARCH-Init-Data
      * Tab keystrok settings
      * Tool Bar
           PERFORM SCREEN-SEARCH-DISPLAY
           .

       SCREEN-SEARCH-Create-Win.
           Display Floating GRAPHICAL WINDOW
              LINES 7,31,
              SIZE 50,00,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 65793,
              LINK TO THREAD,
              NO SCROLL,
              TITLE-BAR,
              TITLE "Ricerca del testo selezionato",
              WITH SYSTEM MENU,
              USER-GRAY,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE Screen1-Event-Proc,
              HANDLE IS Screen1-Handle,
      * <TOTEM:EPT. FORM:SCREEN-SEARCH, FORM:SCREEN-SEARCH, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
      * Status-bar
           DISPLAY SCREEN-SEARCH UPON Screen1-Handle
      * DISPLAY-COLUMNS settings
           .

       SCREEN-SEARCH-PROC.
      * <TOTEM:EPT. FORM:SCREEN-SEARCH, FORM:SCREEN-SEARCH, BeforeAccept>
           set Ricerca to false. 
           move 1 to control-id.
           move 4 to accept-control.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT SCREEN-SEARCH
                 ON EXCEPTION
                    PERFORM SCREEN-SEARCH-Evaluate-Func
                 MOVE 2 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:SCREEN-SEARCH, FORM:SCREEN-SEARCH, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:SCREEN-SEARCH, FORM:SCREEN-SEARCH, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY Screen1-Handle
           INITIALIZE Key-Status
           .

       SCREEN-SEARCH-Evaluate-Func.
      * <TOTEM:EPT. FORM:SCREEN-SEARCH, FORM:SCREEN-SEARCH, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM SCREEN-SEARCH-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM SCREEN-SEARCH-Exit
                 END-IF
              WHEN Key-Status = 1000
                 PERFORM rb-cod-LinkTo
              WHEN Key-Status = 1001
                 PERFORM rb-des-LinkTo
              WHEN Key-Status = 13
                 PERFORM pb-esegui-LinkTo
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       SCREEN-SEARCH-CLEAR.
           PERFORM SCREEN-SEARCH-INIT-VALUE
           PERFORM SCREEN-SEARCH-DISPLAY
           .

       SCREEN-SEARCH-DISPLAY.
      * <TOTEM:EPT. FORM:SCREEN-SEARCH, FORM:SCREEN-SEARCH, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY SCREEN-SEARCH UPON Screen1-Handle
      * <TOTEM:EPT. FORM:SCREEN-SEARCH, FORM:SCREEN-SEARCH, AfterDisplay>
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       SCREEN-SEARCH-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:SCREEN-SEARCH, FORM:SCREEN-SEARCH, BeforeExit>
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       SCREEN-SEARCH-Init-Data.
           MOVE 2 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
           .

       SCREEN-SEARCH-Init-Value.
      * <TOTEM:EPT. FORM:SCREEN-SEARCH, FORM:SCREEN-SEARCH, SetDefault>
      * <TOTEM:END>
           PERFORM SCREEN-SEARCH-FLD-TO-BUF
           .


       SCREEN-SEARCH-ALLGRID-RESET.
           .

      * for Form's Validation
       SCREEN-SEARCH-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       SCREEN-SEARCH-Buf-To-Fld.
      * <TOTEM:EPT. FORM:SCREEN-SEARCH, FORM:SCREEN-SEARCH, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:SCREEN-SEARCH, FORM:SCREEN-SEARCH, AfterBufToFld>
      * <TOTEM:END>
           .

       SCREEN-SEARCH-Fld-To-Buf.
      * <TOTEM:EPT. FORM:SCREEN-SEARCH, FORM:SCREEN-SEARCH, BeforeFldToBuf>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:SCREEN-SEARCH, FORM:SCREEN-SEARCH, AfterFldToBuf>
      * <TOTEM:END>
           .

       SCREEN-SEARCH-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform SCREEN-SEARCH-BUF-TO-FLD.
           move 0 to scelta.
           .
       SCREEN-SEARCH-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM SCREEN-SEARCH-SHOW-MSG-ROUTINE
           .

       SCREEN-SEARCH-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM SCREEN-SEARCH-DISPLAY-MESSAGE
           .

       SCREEN-SEARCH-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       SCREEN-SEARCH-Save-Status.
           .             

       SCREEN-SEARCH-Restore-Status.
           .



       Form1-Event-Proc.
           .

       Form1-Gd-1-Event-Proc.
           EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
           WHEN Msg-Begin-Drag ALSO 1 ALSO
                    Form1-Handle 
              PERFORM form1-gd-1-Ev-Msg-Begin-Drag
           WHEN Msg-Begin-Entry ALSO 1 ALSO
                    Form1-Handle 
              PERFORM form1-gd-1-Ev-Msg-Begin-Entry
           WHEN Msg-End-Drag ALSO 1 ALSO
                    Form1-Handle 
              PERFORM form1-gd-1-Ev-Msg-End-Drag
           WHEN Msg-Finish-Entry ALSO 1 ALSO
                    Form1-Handle 
              PERFORM form1-gd-1-Ev-Msg-Finish-Entry
           WHEN Msg-Goto-Cell ALSO 1 ALSO
                    Form1-Handle 
              PERFORM form1-gd-1-Ev-Msg-Goto-Cell
           WHEN Msg-Goto-Cell-Drag ALSO 1 ALSO
                    Form1-Handle 
              PERFORM form1-gd-1-Ev-Msg-Goto-Cell-Drag
           WHEN Msg-Goto-Cell-Mouse ALSO 1 ALSO
                    Form1-Handle 
              PERFORM form1-gd-1-Ev-Msg-Goto-Cell-Mouse
           WHEN Msg-Grid-Rbutton-Up ALSO 1 ALSO
                    Form1-Handle 
              PERFORM form1-gd-1-Ev-Msg-Grid-Rbutton-Up
           END-EVALUATE
           .

       Screen1-Event-Proc.
           .

      * USER DEFINE PARAGRAPH
       ABILITAZIONI.
      * <TOTEM:PARA. ABILITAZIONI>
           if mod = 1
              move BitmapDeleteEnabled to BitmapNumDelete
              move BitmapSaveEnabled   to BitmapNumSave
              move 1 to e-salva e-cancella
           else
              |SE SONO IN VISUA           
              move BitmapDeleteDisabled to BitmapNumDelete
              move BitmapSaveDisabled   to BitmapNumSave
              move 0 to e-salva e-cancella
           end-if.     

      * ISACCO (CORREZIONE SU LIVELLO ABILITAZIONE 2) - 10/11/2003
      * (CANCELLAZIONE NON PERMESSA)
           if livello-abil = 2 
              move ZERO to e-cancella
              move BitmapDeleteDisabled to BitmapNumDelete
           end-if.
      * FINE

           modify tool-cancella, enabled = e-cancella.
           modify tool-salva,    enabled = e-salva.
       
      * ISACCO (SERVE SEMPRE PER LA MODIFICA PRCEDENTE E PER RIPRISTINARE
      * LE BITMAP DISABILITATE. - 10/11/2003
      *     perform FORM1-DISPLAY.
           display tool-nuovo, tool-salva, tool-cancella, tool-modifica.
      * FINE.

           perform GRID-HELP 
           .
      * <TOTEM:END>

       ANTEPRIMA.
      * <TOTEM:PARA. ANTEPRIMA>
           set anteprima       to true.
      *     perform paragrafo-stampa 
           .
      * <TOTEM:END>

       CANCELLA.
      * <TOTEM:PARA. CANCELLA>
           if mod = 0 exit paragraph end-if.

           display message box MSG-cancellare-il-record-corrente
                   title = titolo
                   type mb-yes-no
                   default mb-no
                   giving scelta.

           if scelta = mb-yes

              inquire form1-gd-1, cursor-y  in riga
              perform valore-riga

              delete tnomen record 
                 invalid continue 
              end-delete

              modify  form1-gd-1, record-to-delete = riga 
              inquire form1-gd-1, last-row        in tot-righe
              
              if riga > tot-righe 
                 move tot-righe to riga 
              end-if
              
              modify form1-gd-1, cursor-y = riga, cursor-x = 1
              move riga to event-data-2
              perform COLORE-RIGA
              display message MSG-cancellazione-avvenuta-con-successo
                      title = titolo
              set vecchio to true
           end-if 

           .
      * <TOTEM:END>

       CERCA.
      * <TOTEM:PARA. CERCA>
           evaluate colonna
           when 8   |n. registro
           when 9   |n. registro
           when 10  |n. registro
           when 11  |n. registro
                inquire form1-gd-1, cursor-y in riga, 
                                    cursor-x in colonna
                inquire form1-gd-1(riga, colonna), 
                        cell-data in utf-num-reg
                move tge-anno     to utf-anno

                move "anautf-anno"  to como-file
                call "zoom-gt"   using como-file, utf-rec
                                giving stato-zoom
                cancel "zoom-gt"
      
                if stato-zoom = 0
                   evaluate colonna
                   when  8 
                        move utf-num-reg to col-num-reg-c
                        modify form1-gd-1(riga, colonna), 
                               cell-data col-num-reg-c
                   when  9
                        move utf-num-reg to col-num-reg-s1
                        modify form1-gd-1(riga, colonna), 
                               cell-data col-num-reg-s1
                   when 10
                        move utf-num-reg to col-num-reg-s2
                        modify form1-gd-1(riga, colonna), 
                               cell-data col-num-reg-s2
                   when 11
                        move utf-num-reg to col-num-reg-s3
                        modify form1-gd-1(riga, colonna), 
                               cell-data col-num-reg-s3
                   end-evaluate
                   perform VALORE-RIGA
                end-if
           end-evaluate
           .
      * <TOTEM:END>

       COLORE-RIGA.
      * <TOTEM:PARA. COLORE-RIGA>
           if riga < 2 
              move 2 to riga 
           end-if.

           modify form1-gd-1, start-x = 1, x     = 13,
                                  start-y = riga,
                                        y = riga,
                                  region-color 257,
                                  cursor-color 481 
           .
      * <TOTEM:END>

       CONTROLLO.
      * <TOTEM:PARA. CONTROLLO>
           set tutto-ok to true.

           inquire form1-gd-1, cursor-y in riga.

           perform VALORE-RIGA.

           evaluate colonna
           when 1
                if nuovo
                   evaluate true
                   when nom-codice = 0
                        set errori  to true
                        move 1      to colonna
                        display message box MSG-Codice-obbligatorio
                                title = tit-err
                                icon mb-warning-icon
                   when CountChar not = 4 and CountChar not = 8
                        set errori  to true
                        move 1      to colonna
                        display message box "Il codice dev'essere di 4 "
                                            "oppure di 8 caratteri"
                                title = tit-err
                                icon mb-warning-icon
                   when other
                        inspect col-id-x replacing 
                                          trailing low-values by x"30"
                        modify form1-gd-1(riga, 1), cell-data = col-id-x
                        move col-id-x to nom-codice  
                        read tnomen
                             not invalid
                                 set errori to true
                                 display message MGS-codice-gia-inserito
                                         title = tit-err
                                         icon mb-warning-icon
                        end-read
                   end-evaluate
                end-if
           when 2
                if nom-descrizione = SPACES
                   set errori to true
                   move 2 to colonna
                   display message msg-descrizione-mancante
                           title = tit-err
                           icon mb-warning-icon
                end-if
           when 7   |colonna A,B,C,D
              if nom-utf = "S"
                if nom-colonna = "A" or "B" or "C" or "D"
                   continue
                else
                   perform MSG-COLONNA
                end-if
              else
                if nom-colonna = space or "A" or "B" or "C" or "D"
                   continue
                else
                   perform MSG-COLONNA
                end-if
              end-if

           when 8  |Numero registro
                if nom-num-reg-c not = 0
                   move tge-anno      to utf-anno
                   move nom-num-reg-c to utf-num-reg
                   read anautf no lock
                        invalid
                        set errori  to true
                        display message "Numero registro inesistente"
                                  title tit-err
                                   icon 2
                    not invalid
                        if utf-dettaglio
                           set errori  to true
                           display message "Registro non valido"
                                       x"0d0a""Occore uno cumulativo"
                                     title tit-err
                                      icon 2
                        end-if
                   end-read
                else
                   if nom-utf = "S"
                      set errori  to true
                      display message "Inserimento numero registro manca
      -    "nte"
                                title tit-err
                                 icon 2
                   end-if   
                end-if
           when 9  |Numero registro
                if nom-num-reg-s1 not = 0
                   move tge-anno       to utf-anno
                   move nom-num-reg-s1 to utf-num-reg
                   read anautf no lock
                        invalid
                        set errori  to true
                        display message "Numero registro inesistente"
                                  title tit-err
                                   icon 2
      *****              not invalid
      *****                  if utf-cumulativo
      *****                     set errori  to true
      *****                     display message "Registro non valido"
      *****                                 x"0d0a""Occore uno di dettaglio"
      *****                               title tit-err
      *****                                icon 2
      *****                  end-if
                   end-read
                else
                   if nom-utf = "S"
                      set errori  to true
                      display message "Inserimento numero registro manca
      -    "nte"
                                title tit-err
                                 icon 2
                   end-if   
                end-if
           when 10 |Numero registro
                if nom-num-reg-s2 not = 0
                   move tge-anno       to utf-anno
                   move nom-num-reg-s2 to utf-num-reg
                   read anautf no lock
                        invalid
                        set errori  to true
                        display message "Numero registro inesistente"
                                  title tit-err
                                   icon 2
      *****              not invalid
      *****                  if utf-cumulativo
      *****                     set errori  to true
      *****                     display message "Registro non valido"
      *****                                 x"0d0a""Occore uno di dettaglio"
      *****                               title tit-err
      *****                                icon 2
      *****                  end-if
                   end-read
                else
                   if nom-utf = "S"
                      set errori  to true
                      display message "Inserimento numero registro manca
      -    "nte"
                                title tit-err
                                 icon 2
                   end-if   
                end-if
           when 11 |Numero registro
                if nom-num-reg-s3 not = 0
                   move tge-anno       to utf-anno
                   move nom-num-reg-s3 to utf-num-reg
                   read anautf no lock
                        invalid
                        set errori  to true
                        display message "Numero registro inesistente"
                                  title tit-err
                                   icon 2
      *****              not invalid
      *****                  if utf-cumulativo
      *****                     set errori  to true
      *****                     display message "Registro non valido"
      *****                                 x"0d0a""Occore uno di dettaglio"
      *****                               title tit-err
      *****                                icon 2
      *****                  end-if
                   end-read
                else
                   if nom-utf = "S"
                      set errori  to true
                      display message "Inserimento numero registro manca
      -    "nte"
                                title tit-err
                                 icon 2
                   end-if   
                end-if

           when 13
                move nom-perce to col-perce
                modify form1-gd-1(riga, colonna), cell-data col-perce
           end-evaluate.

           if errori
              modify form1-gd-1, cursor-y = riga, cursor-x = colonna
              move riga    to event-data-2
              move colonna to event-data-1
           end-if 
           .
      * <TOTEM:END>

       GRID-HELP.
      * <TOTEM:PARA. GRID-HELP>
      * NON CI SONO ZOOM SULLE COLONNE 
      * QUINDI NON SERVE L'EVALUATE DELLA COLONNA. MA IL BOTTONE CERCA
      * SARA' SEMPRE DISABILITATO
           move BitmapZoomDisabled to BitmapNumZoom
           move ZERO to e-cerca

           evaluate colonna
           when 8   |numero registro 
           when 9
           when 10
           when 11
              move BitmapZoomEnabled to BitmapNumZoom
              move 1 to e-cerca
           end-evaluate
           modify tool-cerca, bitmap-number = BitmapNumZoom,
                              enabled       = e-cerca 
            
           .
      * <TOTEM:END>

       INIT.
      * <TOTEM:PARA. INIT>
           set vecchio  to true.
           set tutto-ok to true 
           .
      * <TOTEM:END>

       LOAD-RECORD.
      * <TOTEM:PARA. LOAD-RECORD>
           modify form1-gd-1, mass-update = 1.

           move low-value to nom-codice.
           start tnomen key is >= nom-chiave
                  invalid continue
              not invalid
                  perform varying riga from 2 by 1
                          until 1 = 2
                     read tnomen next
                          at end exit perform
                      not at end
                          move nom-codice           to col-id
                          move nom-descrizione      to col-des
                          move nom-olio             to col-olio
                          move nom-utf              to col-utf
                          move nom-ic-cou           to col-ic-cou
                          move nom-cobat            to col-cobat 
                          move nom-colonna          to col-colonna
                          move nom-num-reg-c        to col-num-reg-c
                          move nom-num-reg-s1       to col-num-reg-s1
                          move nom-num-reg-s2       to col-num-reg-s2
                          move nom-num-reg-s3       to col-num-reg-s3
                          evaluate true
                          when nom-maggiore move ">"  to col-oper
                          when nom-minore   move "<"  to col-oper
                          when nom-uguale   move "="  to col-oper
                          when nom-min-u    move "<=" to col-oper
                          when nom-mag-u    move ">=" to col-oper
                          end-evaluate
                          move nom-perce            to col-perce
                          modify form1-gd-1, record-to-add = rec-grid
                     end-read                                           
                  end-perform
           end-start.

           modify form1-gd-1, mass-update = 0 
           .
      * <TOTEM:END>

       MODIFICA.
      * <TOTEM:PARA. MODIFICA>
           inquire tool-modifica, value in mod.

      *--->MODIFICA (ISACCO)
           if nuovo 
              move 1 to mod 
           else
              |SPECIFICO PER I PGM. CON GRID-CONTROL
              if mod = 1
                 close    tnomen
                 open i-o tnomen allowing readers
              else
                 set tutto-ok to true
                 if NoSalvato
                    move 1 to mod
                    perform SALV-MOD
                 end-if   
                 if tutto-ok
                    move ZERO  to mod
                    close      tnomen
                    open input tnomen

      *             | SPECIFICO X LE TABELLE.
                    | FA IN MODO CHE RESTO SULLA CELLA IN CUI ERO
                    if ricarica
                       set ricarica to false
                       modify form1-gd-1, reset-grid = 1
                       perform FORM1-GD-1-CONTENT
                       perform LOAD-RECORD
                    end-if

                 else
                    move 1 to mod
                 end-if
              end-if
           end-if.

           perform ABILITAZIONI.

           modify tool-modifica, value mod 
           .
      * <TOTEM:END>

       MSG-COLONNA.
      * <TOTEM:PARA. MSG-COLONNA>
           set errori  to true
           move 7      to colonna
           display message box "Valori possibili: A, B, C, D,"
                   title = tit-err
                   icon mb-warning-icon
           .
      * <TOTEM:END>

       NUOVO.
      * <TOTEM:PARA. NUOVO>
           set tutto-ok to true.

           if nuovo
              perform VALORE-RIGA
              if nom-codice not = ZERO
                 perform SALVA
              else
                 set errori to true
              end-if
           end-if.

           if tutto-ok
              set nuovo to true
              inquire form1-gd-1,  last-row   in tot-righe
              modify  form1-gd-1,  insert-rows = 1
              modify  form1-gd-1,  cursor-x    = 1 
                                   cursor-y    = tot-righe + 1

              move 1 to mod
              modify  tool-modifica,   value = mod

              add 1 to tot-righe giving riga

              move "N" to col-olio col-utf col-ic-cou col-cobat
              modify form1-gd-1(riga, 3), cell-data = col-olio
              modify form1-gd-1(riga, 4), cell-data = col-utf
              modify form1-gd-1(riga, 5), cell-data = col-ic-cou
              modify form1-gd-1(riga, 6), cell-data = col-cobat

              move "=" to col-oper
              modify form1-gd-1(riga, 12), cell-data = col-oper

              perform ABILITAZIONI

              initialize old-nom-rec replacing numeric data by zeroes
                                          alphanumeric data by spaces
              set old-nom-no-olio   to true
              set old-nom-no-utf    to true
              set old-nom-no-ic-cou to true
              set old-nom-no-cobat  to true 
              set old-nom-uguale    to true

              add 1 to tot-righe giving event-data-2
              perform COLORE-RIGA
           end-if 
           .
      * <TOTEM:END>

       PARAGRAFO-COPY.
      * <TOTEM:PARA. PARAGRAFO-COPY>
           copy "abilita-toolbar.cpy".
           copy "color-custom.cpy".   
           copy "cerca-testo.cpy" 
           .
      * <TOTEM:END>

       SALV-MOD.
      * <TOTEM:PARA. SALV-MOD>
           if nuovo
              perform VALORE-RIGA
              if nom-rec not = old-nom-rec
                 set NoSalvato to true
              else
                 set SiSalvato to true
              end-if
           end-if.

           set tutto-ok to true.
           if NoSalvato
              display message box MSG-Salvare-le-modifiche, 
                             title = titolo
                             type = mb-yes-no-cancel
                             giving scelta

              evaluate scelta
              when mb-yes    perform SALVA
              when mb-cancel set errori    to true
              when mb-no     set tutto-ok  to true
                             set SiSalvato to true
                             set ricarica  to true
              end-evaluate
           end-if 
           .
      * <TOTEM:END>

       SALVA.
      * <TOTEM:PARA. SALVA>
           if SiSalvato or mod = ZERO 
              exit paragraph 
           end-if.

           inquire form1-gd-1, cursor-x in colonna, 
                               cursor-y in riga.


           perform varying colonna from 1 by 1 
                     until colonna > 8
              perform CONTROLLO
              
              if errori 
                 exit perform 
              end-if
           end-perform.

           if tutto-ok
              perform VALORIZZA-DATI-COMUNI
              write nom-rec invalid rewrite nom-rec end-write
              set sisalvato to true
              set vecchio   to true
           else                   
              perform ABILITAZIONI
           end-if                  
           .
      * <TOTEM:END>

       SPOSTAMENTO.
      * <TOTEM:PARA. SPOSTAMENTO>
           inquire form1-gd-1, cursor-x = colonna, cursor-y = riga.

           if event-data-2 not = riga
              perform VALORE-RIGA
              if nom-codice = ZERO
                 modify form1-gd-1, record-to-delete riga
                 set vecchio to true
              else  
                 perform SALVA
                 if errori
                    move riga    to event-data-2
                    move colonna to event-data-1 | (ISACCO)
                    set event-action to event-action-fail
                 end-if
              end-if
           else
              if colonna not = event-data-1
                 perform CONTROLLO
                 if errori
                    set event-action to event-action-fail
                 end-if
              end-if
           end-if.

      * VALORIZZO L'OLD DELLA RIGA SU CUI SONO ANDATO
           move event-data-2 to riga.
           move event-data-1 to colonna.
           perform VALORE-OLD-RIGA.

      * COLORAZIONE RIGA IN GRID
           perform COLORE-RIGA.

           perform GRID-HELP 
           .
      * <TOTEM:END>

       STAMPA.
      * <TOTEM:PARA. STAMPA>
           set stampa       to true.
      *     perform paragrafo-stampa 
           .
      * <TOTEM:END>

       VALORE-RIGA.
      * <TOTEM:PARA. VALORE-RIGA>
           inquire form1-gd-1(riga, 1), cell-data nom-codice.
           inquire form1-gd-1(riga, 2), cell-data nom-descrizione.
           inquire form1-gd-1(riga, 3), cell-data nom-olio.
           inquire form1-gd-1(riga, 4), cell-data nom-utf.
           inquire form1-gd-1(riga, 5), cell-data nom-ic-cou.
           inquire form1-gd-1(riga, 6), cell-data nom-cobat.
           inquire form1-gd-1(riga, 7), cell-data nom-colonna.
           inquire form1-gd-1(riga, 8), cell-data nom-num-reg-c.
           inquire form1-gd-1(riga, 9), cell-data nom-num-reg-s1.
           inquire form1-gd-1(riga, 10), cell-data nom-num-reg-s2.
           inquire form1-gd-1(riga, 11), cell-data nom-num-reg-s3.
           inquire form1-gd-1(riga, 12), cell-data col-oper.
           evaluate true
           when col-oper = ">"  set nom-maggiore to true
           when col-oper = "<"  set nom-minore   to true
           when col-oper = "="  set nom-uguale   to true
           when col-oper = ">=" set nom-mag-u    to true
           when col-oper = "<=" set nom-min-u    to true
           end-evaluate.
           inquire form1-gd-1(riga, 13),cell-data nom-perce.
           move nom-codice to col-id-x.                             
           inspect col-id-x replacing leading x"30" by x"20".
           call "C$JUSTIFY" using col-id-x, "L".
           if col-id-x(5:4) = "0000"
              move 4 to CountChar
           else
              inspect col-id-x replacing trailing spaces by low-values
              move 0 to CountChar
              inspect col-id-x tallying CountChar for characters 
                               before low-values
           end-if 
           .
      * <TOTEM:END>

       VALORE-OLD-RIGA.
      * <TOTEM:PARA. VALORE-OLD-RIGA>
           if vecchio
              inquire form1-gd-1(riga, 1) cell-data old-nom-codice
              move old-nom-codice         to nom-codice
              read tnomen                 no lock
              move nom-rec                to old-nom-rec
           else
              initialize old-nom-rec replacing numeric data by zeroes
                                          alphanumeric data by spaces
              set old-nom-no-olio   to true
              set old-nom-no-utf    to true
              set old-nom-no-ic-cou to true
              set old-nom-no-cobat  to true
              set old-nom-col-a     to true
              set old-nom-uguale     to true
           end-if 
           .
      * <TOTEM:END>

       VALORIZZA-DATI-COMUNI.
      * <TOTEM:PARA. VALORIZZA-DATI-COMUNI>
      *    se non ho valorizzato i campi di creazione li valorizzo
           if nom-data-creazione   = zero
              accept nom-data-creazione from century-date
           end-if.
           if nom-ora-creazione    = zero
              accept nom-ora-creazione  from time
           end-if.
           if nom-utente-creazione = space
              move user-codi to nom-utente-creazione
           end-if.

           accept nom-data-ultima-modifica from century-date.
           accept nom-ora-ultima-modifica  from time.
           move user-codi    to nom-utente-ultima-modifica 
           .
      * <TOTEM:END>

      * EVENT PARAGRAPH
       NUOVO-LinkTo.
      * <TOTEM:PARA. NUOVO-LinkTo>
           inquire tool-nuovo, enabled in e-nuovo.
           if e-nuovo = 1
              perform NUOVO
           end-if 

           .
      * <TOTEM:END>
       CANCELLA-LinkTo.
      * <TOTEM:PARA. CANCELLA-LinkTo>
           inquire tool-cancella, enabled in e-cancella.
           if e-cancella = 1
              perform CANCELLA
           end-if 
           .
      * <TOTEM:END>
       TOOL-SALVA-LinkTo.
      * <TOTEM:PARA. TOOL-SALVA-LinkTo>
           inquire tool-salva, enabled in e-salva.
           if e-salva = 1
              perform salva
           end-if 
           .
      * <TOTEM:END>
       ANTEPRIMA-LinkTo.
      * <TOTEM:PARA. ANTEPRIMA-LinkTo>
           inquire tool-anteprima, enabled in e-anteprima.
           if e-anteprima = 1
              perform ANTEPRIMA
           end-if 
           .
      * <TOTEM:END>
       TOOL-MODIFICA-LinkTo.
      * <TOTEM:PARA. TOOL-MODIFICA-LinkTo>
           inquire tool-modifica, enabled in e-modifica
           if e-modifica = 1
              perform MODIFICA
           end-if 
           .
      * <TOTEM:END>
       STAMPA-LinkTo.
      * <TOTEM:PARA. STAMPA-LinkTo>
           inquire tool-stampa, enabled in e-stampa
           if e-stampa = 1
              perform STAMPA
           end-if 
           .
      * <TOTEM:END>
       I-O-BLOCCO.
      * <TOTEM:PARA. I-O-BLOCCO>
           SET LK-BL-CANCELLAZIONE TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM 
           .
      * <TOTEM:END>
       PAS004P-Ev-Before-Program.
      * <TOTEM:PARA. PAS004P-Ev-Before-Program>
           move LK-BL-PROG-ID    TO COMO-PROG-ID 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-Finish-Entry.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-Finish-Entry>
           inquire form1-gd-1, cursor-y in riga.
           perform VALORE-RIGA.

           perform  CONTROLLO.

           if errori 
              set event-action to event-action-fail 
              perform VALORE-RIGA
           end-if.

           if nom-rec not = old-nom-rec
              set NoSalvato to true                            
           else 
              set SiSalvato to true
           end-if 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-Begin-Entry.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-Begin-Entry>
           inquire form1-gd-1,     cursor-x = colonna,
                                   cursor-y = riga.
                         
           perform VALORE-RIGA.

           evaluate colonna
           when 1
                if nom-codice not = ZERO
                   set event-action to event-action-fail
                end-if
           when 2
           when 7
           when 8
           when 9
           when 10
           when 11
           when 13
                if mod = 0
                   set event-action to event-action-fail
                else
                   if nom-codice = 0
                      set event-action to event-action-fail
                      modify form1-gd-1, cursor-y = riga, cursor-x = 1
                   end-if   
                end-if
           when other
                set event-action to event-action-fail
           end-evaluate 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-End-Drag.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-End-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-Goto-Cell.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-Goto-Cell>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-Goto-Cell-Drag.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-Goto-Cell-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-Goto-Cell-Mouse.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-Goto-Cell-Mouse>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-Begin-Drag.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-Begin-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       TOOL-CERCA-LinkTo.
      * <TOTEM:PARA. TOOL-CERCA-LinkTo>
           inquire tool-cerca, enabled in e-cerca.
           if e-cerca = 1
              perform CERCA
           end-if 
           .
      * <TOTEM:END>
       ef-cod-BeforeProcedure.
      * <TOTEM:PARA. ef-cod-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-des-BeforeProcedure.
      * <TOTEM:PARA. ef-des-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-cod-AfterProcedure.
      * <TOTEM:PARA. ef-cod-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       ef-des-AfterProcedure.
      * <TOTEM:PARA. ef-des-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       rb-cod-BeforeProcedure.
      * <TOTEM:PARA. rb-cod-BeforeProcedure>
           modify control-handle, color = colore-nu
           .
      * <TOTEM:END>
       rb-des-BeforeProcedure.
      * <TOTEM:PARA. rb-des-BeforeProcedure>
           modify control-handle, color = colore-nu
           .
      * <TOTEM:END>
       rb-cod-AfterProcedure.
      * <TOTEM:PARA. rb-cod-AfterProcedure>
           modify control-handle, color = colore-or
           .
      * <TOTEM:END>
       rb-des-AfterProcedure.
      * <TOTEM:PARA. rb-des-AfterProcedure>
           modify control-handle, color = colore-or
           .
      * <TOTEM:END>
       pb-esegui-LinkTo.
      * <TOTEM:PARA. pb-esegui-LinkTo>
           set tutto-ok to true.

           if tipo-ricerca = 1
              inquire ef-cod, value in cod
              if cod not > spaces 
                 set errori  to true 
              else
                 move cod    to TextToSearch
                 move spaces to des
                 display ef-des
              end-if 
           else                           
              inquire ef-des, value in des
              if des = spaces 
                 set errori to true 
              else
                 move des to TextToSearch   
                 move ZERO to cod
                 display ef-cod
              end-if
           end-if.

           if tutto-ok 
              move 27 to key-status 
              set Ricerca to true
           end-if.

      * ISACCO - FISSATO BUG SE NON DIGITO NULLA IN SCREEN RICERCA
      * 10/11/20003
           Set tutto-ok to true.
      * FINE
           .
      * <TOTEM:END>
       tool-CercaTesto-LinkTo.
      * <TOTEM:PARA. tool-CercaTesto-LinkTo>
           perform CERCA-TESTO 
           .
      * <TOTEM:END>
       rb-cod-LinkTo.
      * <TOTEM:PARA. rb-cod-LinkTo>
           move 1 to tipo-ricerca.
           move 1 to e-cod.
           move 0 to e-des.
           display SCREEN-SEARCH.

           perform CANCELLA-COLORE.
           move 1 to control-id.
           move 4 to accept-control 
           .
      * <TOTEM:END>
       rb-des-LinkTo.
      * <TOTEM:PARA. rb-des-LinkTo>
           move 2 to tipo-ricerca.
           move 1 to e-des.
           move 0 to e-cod.
           display SCREEN-SEARCH.  

           perform CANCELLA-COLORE.
           move 2 to control-id.
           move 4 to accept-control 
           .
      * <TOTEM:END>
       TOOL-MODIFICA-BeforeProcedure.
      * <TOTEM:PARA. TOOL-MODIFICA-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       cb-match-BeforeProcedure.
      * <TOTEM:PARA. cb-match-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       TOOL-MODIFICA-AfterProcedure.
      * <TOTEM:PARA. TOOL-MODIFICA-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       cb-match-AfterProcedure.
      * <TOTEM:PARA. cb-match-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-Grid-Rbutton-Up.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-Grid-Rbutton-Up>
           if mod = 1
              inquire form1-gd-1, cursor-y in riga, cursor-x in colonna
              evaluate colonna
              when 3   
              when 4
              when 5
              when 6 inquire form1-gd-1(riga,colonna), cell-data col-x
                     if col-x = "N" move "S" to col-x
                     else           move "N" to col-x
                     end-if
                     modify form1-gd-1(riga, colonna), cell-data col-x
                     perform VALORE-RIGA
                     if nom-rec not = old-nom-rec
                        set NoSalvato to true                           
            
                     else 
                        set SiSalvato to true
                     end-if
              when 12 inquire form1-gd-1(riga,colonna), cell-data 
           col-oper
                     evaluate col-oper
                     when ">"   move "<"  to col-oper
                     when "<"   move "="  to col-oper
                     when "="   move "<=" to col-oper
                     when "<="  move ">=" to col-oper
                     when other move ">"  to col-oper
                     end-evaluate
                     modify form1-gd-1(riga, colonna), cell-data 
           col-oper
                     perform VALORE-RIGA
                     if nom-rec not = old-nom-rec
                        set NoSalvato to true                           
            
                     else 
                        set SiSalvato to true
                     end-if
              end-evaluate
           end-if 
           .
      * <TOTEM:END>

      *{TOTEM}END

      *{TOTEM}SHOW-MSG
       MESSAGE-FOR-FILEERROR.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
              MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           .

       SHOW-TRANSACTION-ROUTINE.
           IF TOTEM-TRANSACTION-FLAG = SPACES
              IF TRANSACTION-STATUS NOT = 0
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-1
              END-IF
           ELSE
              PERFORM SHOW-MSG-ROUTINE
              IF TRANSACTION-STATUS = 0
                 MOVE "Transazione terminata con Rollback." TO 
           TOTEM-MSG-3
              ELSE
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-3
              END-IF
           END-IF
           .

       SHOW-MSG-ROUTINE.
           MOVE SPACE TO TOTEM-MSG-1 TOTEM-MSG-2 TOTEM-MSG-3
           EVALUATE TOTEM-MSG-ID
               WHEN "10"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Nessun altro dato." TO TOTEM-MSG-2
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "22"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Chiave Duplicata." TO TOTEM-MSG-2
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "23"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Raggiunta fine file." TO TOTEM-MSG-2
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "101"
                    MOVE "Terminare l'applicazione?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "201"
                    MOVE "Aggiungere un nuovo record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "202"
                    MOVE "Aggiornare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "203"
                    MOVE "Cancellare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "204"
                    MOVE "Chiave duplicata." TO TOTEM-MSG-1
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "301"
                    MOVE "Inserimento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "302"
                    MOVE "Aggiornamento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "303"
                    MOVE "Cancellazione avvenuta con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "401"
                    MOVE "Shell non trovata." TO TOTEM-MSG-1
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN OTHER
                    MOVE TEXT-MESSAGE TO TOTEM-MSG-1
                    STRING "FILE:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-3
                    MOVE 0 TO TOTEM-IDX1
                    INSPECT TOTEM-MSG-3 TALLYING TOTEM-IDX1
                       FOR TRAILING SPACE
                    STRING TOTEM-MSG-3(1:TOTEM-MSG-LENGTH - 
           TOTEM-IDX1), 
                       ", FILE STATUS ", PRIMARY-ERROR "," 
                       SECONDARY-ERROR
                    DELIMITED BY SIZE INTO TOTEM-MSG-2
                    MOVE SPACES TO TOTEM-MSG-3
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
           END-EVALUATE
           PERFORM MESSAGE-BOX-ROUTINE
           .

       MESSAGE-BOX-ROUTINE.
           MOVE 1 TO TOTEM-MSG-TEXT-POINTER
           IF TOTEM-MSG-1 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-1 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              STRING TOTEM-MSG-1( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                 DELIMITED BY SIZE
                 INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-2 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-2 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-2( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-3 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-3 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-3( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-TEXT-POINTER = 1
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-TEXT TALLYING TOTEM-MSG-SIZE FOR 
           TRAILING SPACE
                  COMPUTE TOTEM-MSG-TEXT-POINTER = 
           TOTEM-MSG-FULL-LENGTH - TOTEM-MSG-SIZE + 1
           END-IF
           MOVE LOW-VALUES TO TOTEM-MSG-TEXT(TOTEM-MSG-TEXT-POINTER : 1 
           )
           .

       MESSAGE-BOX-DISPLAY.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

      *{TOTEM}END

