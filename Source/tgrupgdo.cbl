      *{TOTEM}PRG-COMMENT
      * tgrupgdo.Cbl
      * tgrupgdo.Cbl is generated by TOTEM
      * This is a generated file. DO NOT modify this file directly.
      *{TOTEM}END
       IDENTIFICATION       DIVISION.
      *{TOTEM}PRGID
       PROGRAM-ID.          tgrupgdo.
       AUTHOR.              ANDREA EVENTI.
       DATE-WRITTEN.        lunedì 12 marzo 2018 17:07:24.
       REMARKS.
      *{TOTEM}END

       ENVIRONMENT          DIVISION.
       CONFIGURATION        SECTION.
       SPECIAL-NAMES.
      *{TOTEM}SPECIAL-NAME
      * <TOTEM:EPT. INIT:tgrupgdo, INIT:tgrupgdo, SpecialName>
      * <TOTEM:END>
      *{TOTEM}END
      *{TOTEM}ACTIVEX-DEF
      *{TOTEM}END
      *{TOTEM}DECIMAL-POINT
           DECIMAL-POINT IS COMMA.
      *{TOTEM}END

       INPUT-OUTPUT         SECTION.
       FILE-CONTROL.
      *{TOTEM}FILE-CONTROL
           COPY "tgrupgdo.sl".
           COPY "tgrupgdo.sl"
                REPLACING ==tgrupgdo== BY ==tgrupgdo1==,
                          ==STATUS-tgrupgdo== BY ==STATUS-tgrupgdo1==
                .
           COPY "ttipocli.sl".
           COPY "tgruppi.sl".
           COPY "clienti.sl".
      *{TOTEM}END
       DATA                 DIVISION.
       FILE                 SECTION.
      *{TOTEM}FILE
           COPY "tgrupgdo.fd".
           COPY "tgrupgdo.fd"
                REPLACING ==tgrupgdo== BY ==tgrupgdo1==,
                          ==STATUS-tgrupgdo== BY ==STATUS-tgrupgdo1==
                .
           COPY "ttipocli.fd".
           COPY "tgruppi.fd".
           COPY "clienti.fd".
      *{TOTEM}END

       WORKING-STORAGE      SECTION.
      *{TOTEM}ACU-DEF
               COPY "acugui.def".
               COPY "acucobol.def".
               COPY "fonts.def".
               COPY "crtvars.def".
               COPY "showmsg.def".
               COPY "totem.def".
               COPY "F:\lubex\geslux\Copylib\standard.def".
      *{TOTEM}END

      *{TOTEM}COPY-WORKING
      * Key Status
       77 Key-Status IS SPECIAL-NAMES CRT STATUS PIC 9(5) VALUE 0.
          88 Enter-Pushed VALUE 13.
          88 Exit-Pushed VALUE 27.
          88 Message-Received VALUE 95.
          88 Event-Occurred VALUE 96.
          88 Screen-No-Input-Field VALUE 97.
      * Properties & User defined Working Stoarge
       77 Form1-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 Form1-Tb-1-Handle
                  USAGE IS HANDLE OF WINDOW.
           COPY  "LINK-G2AGG.DEF".
           COPY  "LINK-SITFIN.DEF".
           COPY  "LINK-BROWSER.DEF".
       77 lettera          PIC  x.
       77 num  PIC  9(3).
       77 COMO-RECORD      PIC  X(32000).
       77 E-ESCI           PIC  9
                  VALUE IS 1.
       77 E-NUOVO          PIC  9
                  VALUE IS 1.
       77 E-CANCELLA       PIC  9
                  VALUE IS 1.
       77 E-SALVA          PIC  9
                  VALUE IS 1.
       77 E-ANTEPRIMA      PIC  9
                  VALUE IS 0.
       77 E-MODIFICA       PIC  9
                  VALUE IS 1.
       77 E-STAMPA         PIC  9
                  VALUE IS 0.
       77 E-CERCA          PIC  9
                  VALUE IS 0.
       77 Form1-St-1-Handle
                  USAGE IS HANDLE OF STATUS-BAR.
       77 E-SELEZIONA      PIC  9
                  VALUE IS 1.
       77 toolbar-bmp
                  USAGE IS HANDLE OF BITMAP
                  VALUE IS 0.
       77 Screen1-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 Default-Font
                  USAGE IS HANDLE OF FONT DEFAULT-FONT.
       77 Small-Font
                  USAGE IS HANDLE OF FONT SMALL-FONT.
       78 TITOLO VALUE IS "Geslux - Gestione gruppi GDO". 
       77 AUTO-ID          PIC  9(6)
                  VALUE IS 0.
       01 save-key.
           10 save-codice      PIC  x(5).
       77 STATUS-tgrupgdo  PIC  X(2).
           88 Valid-STATUS-tgrupgdo VALUE IS "00" THRU "09". 
       01 OLD-gdo-rec.
           05 OLD-gdo-chiave.
               10 OLD-gdo-codice   PIC  x(5).
           05 OLD-gdo-dati.
               10 OLD-gdo-intestazione         PIC  x(30).
               10 OLD-gdo-data-vigore          PIC  9(8).
               10 OLD-gdo-attenzione           PIC  x(150).
               10 OLD-gdo-listino-bosch        PIC  x(150).
               10 OLD-gdo-listino-ma-fra       PIC  x(150).
               10 OLD-gdo-linea-ursus          PIC  x(150).
               10 OLD-gdo-altro    PIC  x(150).
               10 OLD-gdo-logo     PIC  x(256).
               10 OLD-gdo-comuni.
                   15 OLD-gdo-data-creazione       PIC  9(8).
                   15 OLD-gdo-ora-creazione        PIC  9(8).
                   15 OLD-gdo-utente-creazione     PIC  x(10).
                   15 OLD-gdo-data-ultima-modifica PIC  9(8).
                   15 OLD-gdo-ora-ultima-modifica  PIC  9(8).
                   15 OLD-gdo-utente-ultima-modifica           PIC  
           x(10).
               10 OLD-gdo-vuoti.
                   15 OLD-gdo-gruppo-invio         PIC  9(5).
                   15 OLD-gdo-cli-rifer            PIC  9(5).
                   15 OLD-gdo-num-vuoto-1          PIC  9(5).
                   15 OLD-gdo-num-vuoto-2          PIC  9(15).
                   15 OLD-gdo-num-vuoto-3          PIC  9(15).
                   15 OLD-gdo-alfa-vuoto-1         PIC  x(13).
                   15 OLD-gdo-tipocli  PIC  x(2).
                   15 OLD-gdo-capogruppo           PIC  x(5).
                   15 OLD-gdo-codice-G2            PIC  x(3).
                   15 OLD-gdo-alfa-vuoto-2         PIC  x(17).
                   15 OLD-gdo-alfa-vuoto-3         PIC  x(20).
       77 lab-capo-buf     PIC  X(50).
       77 STATUS-tgrupgdo1 PIC  X(2).
           88 VALID-STATUS-tgrupgdo1 VALUE IS "00" THRU "09". 
       77 SITFIN_91X21-BMP PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 STATUS-ttipocli  PIC  X(2).
           88 Valid-STATUS-ttipocli VALUE IS "00" THRU "09". 
       77 lab-tipocli-buf  PIC  X(50).
       77 Verdana10-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 lab-gruppo-buf   PIC  X(50).
       77 STATUS-tgruppi   PIC  X(2).
           88 Valid-STATUS-tgruppi VALUE IS "00" THRU "09". 
       77 lab-cli-rifer-buf            PIC  X(50).
       77 STATUS-clienti   PIC  X(2).
           88 Valid-STATUS-clienti VALUE IS "00" THRU "09". 

      ***********************************************************
      *   Code Gen's Buffer                                     *
      ***********************************************************
       77 STATUS-Form1-FLAG-REFRESH PIC  9.
          88 Form1-FLAG-REFRESH  VALUE 1 FALSE 0. 
      * DATA CONTROL BUFFER
       01 Form1-BUF.
      * Data.Entry-Field
              05 ef-codice-BUF PIC X(5).
      * Data.Entry-Field
              05 ef-capo-BUF PIC x(5).
      * Data.Entry-Field
              05 ef-des-BUF PIC X(30).
      * Data.Entry-Field
              05 ef-data-BUF PIC 99/99/9999.
      * Data.Entry-Field
              05 ef-tipocli-BUF PIC x(2).
      * Data.Entry-Field
              05 ef-att-BUF PIC X(150).
      * Data.Entry-Field
              05 ef-bosch-BUF PIC X(150).
      * Data.Entry-Field
              05 ef-mafra-BUF PIC X(150).
      * Data.Entry-Field
              05 ef-linea-BUF PIC X(150).
      * Data.Entry-Field
              05 ef-altro-BUF PIC X(150).
      * Data.Entry-Field
              05 ef-logo-BUF PIC X(256).
      * Data.Entry-Field
              05 ef-gruppo-BUF PIC z(5).
      * Data.Entry-Field
              05 ef-cli-rifer-BUF PIC z(5).
      * Data.Entry-Field
              05 ef-codice-G2-BUF PIC x(3).
              05 ef-codice-G2-VALUEBUF PIC x(3).

       77 TMP-Form1-KEY1-ORDER  PIC X VALUE "A".
       77 TMP-Form1-tgrupgdo-RESTOREBUF  PIC X(1206).
       77 TMP-Form1-KEYIS  PIC 9(3) VALUE 1.
       77 Form1-MULKEY-TMPBUF   PIC X(1206).
       77 TMP-DataSet1-tgrupgdo-BUF     PIC X(1206).
       77 TMP-DataSet1-tgrupgdo1-BUF     PIC X(1206).
       77 TMP-DataSet1-ttipocli-BUF     PIC X(889).
       77 TMP-DataSet1-tgruppi-BUF     PIC X(3202).
       77 TMP-DataSet1-clienti-BUF     PIC X(1910).
      * VARIABLES FOR RECORD LENGTH.
       77  TotemFdSlRecordClearOffset   PIC 9(5) COMP-4.
       77  TotemFdSlRecordLength        PIC 9(5) COMP-4.
      * FILE'S LOCK MODE FLAG
       77 DataSet1-tgrupgdo-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tgrupgdo-LOCK  VALUE "Y".
       77 DataSet1-KEYIS   PIC 9(3) VALUE 1.
       77 DataSet1-tgrupgdo-KEY1-ORDER  PIC X VALUE "A".
          88 DataSet1-tgrupgdo-KEY1-Asc  VALUE "A".
          88 DataSet1-tgrupgdo-KEY1-Desc VALUE "D".
       77 DataSet1-tgrupgdo1-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tgrupgdo1-LOCK  VALUE "Y".
       77 DataSet1-tgrupgdo1-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tgrupgdo1-KEY-Asc  VALUE "A".
          88 DataSet1-tgrupgdo1-KEY-Desc VALUE "D".
       77 DataSet1-ttipocli-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-ttipocli-LOCK  VALUE "Y".
       77 DataSet1-ttipocli-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-ttipocli-KEY-Asc  VALUE "A".
          88 DataSet1-ttipocli-KEY-Desc VALUE "D".
       77 DataSet1-tgruppi-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tgruppi-LOCK  VALUE "Y".
       77 DataSet1-tgruppi-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tgruppi-KEY-Asc  VALUE "A".
          88 DataSet1-tgruppi-KEY-Desc VALUE "D".
       77 DataSet1-clienti-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-clienti-LOCK  VALUE "Y".
       77 DataSet1-clienti-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-clienti-KEY-Asc  VALUE "A".
          88 DataSet1-clienti-KEY-Desc VALUE "D".

       77 tgrupgdo-gdo-k-g2-SPLITBUF  PIC X(9).
       77 tgrupgdo1-gdo-k-g2-SPLITBUF  PIC X(9).
       77 clienti-cli-K1-SPLITBUF  PIC X(47).
       77 clienti-cli-K3-SPLITBUF  PIC X(12).
       77 clienti-cli-K4-SPLITBUF  PIC X(8).

      *{TOTEM}END

      *{TOTEM}ID-LOGICI
      ***** Elenco ID Logici *****
       78  78-ID-ef-codice VALUE 5001.
       78  78-ID-ef-capo VALUE 5002.
       78  78-ID-ef-des VALUE 5003.
       78  78-ID-ef-data VALUE 5004.
       78  78-ID-ef-tipocli VALUE 5005.
       78  78-ID-ef-att VALUE 5006.
       78  78-ID-ef-bosch VALUE 5007.
       78  78-ID-ef-mafra VALUE 5008.
       78  78-ID-ef-linea VALUE 5009.
       78  78-ID-ef-altro VALUE 5010.
       78  78-ID-ef-logo VALUE 5011.
       78  78-ID-ef-gruppo VALUE 5012.
       78  78-ID-ef-cli-rifer VALUE 5013.
       78  78-ID-ef-codice-G2 VALUE 5014.
      ***** Fine ID Logici *****
      *{TOTEM}END

       LINKAGE          SECTION.
      *{TOTEM}LINKAGE
           COPY  "COMMON-LINKAGE.DEF".

      *{TOTEM}END

       SCREEN           SECTION.
      *{TOTEM}COPY-SCREEN
      * FORM
       01 
           Form1, 
           AFTER PROCEDURE Form1-AfterProcedure,
           BEFORE PROCEDURE Form1-BeforeProcedure,
           .

      * ENTRY FIELD
       05
           ef-codice, 
           Entry-Field, 
           COL 22,00, 
           LINE 2,00,
           LINES 1,31 ,
           SIZE 9,00 ,
           BOXED,
           UPPER,
           COLOR IS 513,
           ENABLED mod-k,
           HELP-ID AUTO-ID,
           ID IS 78-ID-ef-codice,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 5,
           VALUE ef-codice-BUF,
           .

      * ENTRY FIELD
       05
           ef-capo, 
           Entry-Field, 
           COL 22,00, 
           LINE 5,00,
           LINES 1,31 ,
           SIZE 9,00 ,
           BOXED,
           UPPER,
           COLOR IS 513,
           ENABLED mod,
           HELP-ID AUTO-ID,
           ID IS 78-ID-ef-capo,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 5,
           VALUE ef-capo-BUF,
           .

      * ENTRY FIELD
       05
           ef-des, 
           Entry-Field, 
           COL 22,00, 
           LINE 7,00,
           LINES 1,31 ,
           SIZE 60,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod,
           ID IS 78-ID-ef-des,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 30,
           VALUE ef-des-BUF,
           .

      * ENTRY FIELD
       05
           ef-data, 
           Entry-Field, 
           COL 22,00, 
           LINE 9,00,
           LINES 1,31 ,
           SIZE 11,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod,
           ID IS 78-ID-ef-data,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 8,
           VALUE ef-data-BUF,
           .

      * ENTRY FIELD
       05
           ef-tipocli, 
           Entry-Field, 
           COL 52,00, 
           LINE 9,00,
           LINES 1,31 ,
           SIZE 5,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod,
           ID IS 78-ID-ef-tipocli,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 2,
           VALUE ef-tipocli-BUF,
           .

      * ENTRY FIELD
       05
           ef-att, 
           Entry-Field, 
           COL 22,00, 
           LINE 11,00,
           LINES 1,31 ,
           SIZE 110,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod,
           ID IS 78-ID-ef-att,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 150,
           VALUE ef-att-BUF,
           .

      * ENTRY FIELD
       05
           ef-bosch, 
           Entry-Field, 
           COL 22,00, 
           LINE 13,00,
           LINES 1,31 ,
           SIZE 110,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod,
           ID IS 78-ID-ef-bosch,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 150,
           VALUE ef-bosch-BUF,
           .

      * ENTRY FIELD
       05
           ef-mafra, 
           Entry-Field, 
           COL 22,00, 
           LINE 15,00,
           LINES 1,31 ,
           SIZE 110,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod,
           ID IS 78-ID-ef-mafra,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 150,
           VALUE ef-mafra-BUF,
           .

      * ENTRY FIELD
       05
           ef-linea, 
           Entry-Field, 
           COL 22,00, 
           LINE 17,00,
           LINES 1,31 ,
           SIZE 110,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod,
           ID IS 78-ID-ef-linea,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 150,
           VALUE ef-linea-BUF,
           .

      * ENTRY FIELD
       05
           ef-altro, 
           Entry-Field, 
           COL 22,00, 
           LINE 19,00,
           LINES 1,31 ,
           SIZE 110,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod,
           ID IS 78-ID-ef-altro,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 150,
           VALUE ef-altro-BUF,
           .

      * ENTRY FIELD
       05
           ef-logo, 
           Entry-Field, 
           COL 22,00, 
           LINE 21,00,
           LINES 1,31 ,
           SIZE 110,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod,
           ID IS 78-ID-ef-logo,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 256,
           VALUE ef-logo-BUF,
           .

      * ENTRY FIELD
       05
           ef-gruppo, 
           Entry-Field, 
           COL 22,00, 
           LINE 23,00,
           LINES 1,31 ,
           SIZE 9,00 ,
           BOXED,
           UPPER,
           COLOR IS 513,
           ENABLED mod,
           HELP-ID AUTO-ID,
           ID IS 78-ID-ef-gruppo,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 5,
           VALUE ef-gruppo-BUF,
           .

      * ENTRY FIELD
       05
           ef-cli-rifer, 
           Entry-Field, 
           COL 22,00, 
           LINE 25,00,
           LINES 1,31 ,
           SIZE 9,00 ,
           BOXED,
           UPPER,
           COLOR IS 513,
           ENABLED mod,
           HELP-ID AUTO-ID,
           ID IS 78-ID-ef-cli-rifer,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 5,
           VALUE ef-cli-rifer-BUF,
           .

      * ENTRY FIELD
       05
           ef-codice-G2, 
           Entry-Field, 
           COL 22,00, 
           LINE 27,00,
           LINES 1,31 ,
           SIZE 9,00 ,
           BOXED,
           UPPER,
           COLOR IS 513,
           ENABLED mod,
           HELP-ID AUTO-ID,
           ID IS 78-ID-ef-codice-G2,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           LEFT,
           MAX-TEXT 3,
           READ-ONLY,
           VALUE ef-codice-G2-BUF,
           .

      * PUSH BUTTON
       05
           pb-logo, 
           Push-Button, 
           COL 132,38, 
           LINE 19,00,
           LINES 1,31 ,
           SIZE 3,00 ,
           EXCEPTION-VALUE 1003,
           ID IS AUTO-ID,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "...",
           .

      * LABEL
       05
           Form1-La-5aa, 
           Label, 
           COL 3,00, 
           LINE 2,00,
           LINES 1,31 ,
           SIZE 13,00 ,
           ID IS 102,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Codice",
           .

      * LABEL
       05
           Form1-blockpgm-1, 
           Label, 
           COL 47,13, 
           LINE 2,31,
           LINES 0,62 ,
           SIZE 2,00 ,
           ID IS 103,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "BlockPgm",
           VISIBLE v-custom,
           .

      * LABEL
       05
           Form1-Custom1-1, 
           Label, 
           COL 39,88, 
           LINE 2,23,
           LINES 1,15 ,
           SIZE 2,00 ,
           ID IS 3,
           TRANSPARENT,
           TITLE "CUSTOM CONTROL",
           VISIBLE v-custom,
           .

      * BAR
       05
           Form1-Br-1, 
           Bar,
           COL 1,00, 
           LINE 3,92,
           SIZE 136,13 ,
           ID IS 4,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           COLORS (8, 8),
           SHADING (-1, 1),
           WIDTH 2,
           .

      * LABEL
       05
           Form1-La-1, 
           Label, 
           COL 3,00, 
           LINE 7,00,
           LINES 1,31 ,
           SIZE 13,00 ,
           ID IS 1,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Descrizione",
           .

      * LABEL
       05
           Form1-La-2, 
           Label, 
           COL 3,00, 
           LINE 11,00,
           LINES 1,31 ,
           SIZE 13,00 ,
           ID IS 6,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "All'attenzione di",
           .

      * LABEL
       05
           Form1-La-3, 
           Label, 
           COL 3,00, 
           LINE 13,00,
           LINES 1,31 ,
           SIZE 13,00 ,
           ID IS 8,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Listino Bosch",
           .

      * LABEL
       05
           Form1-La-4, 
           Label, 
           COL 3,00, 
           LINE 15,00,
           LINES 1,31 ,
           SIZE 13,00 ,
           ID IS 10,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Listino MA-FRA",
           .

      * LABEL
       05
           Form1-La-5, 
           Label, 
           COL 3,00, 
           LINE 17,00,
           LINES 1,31 ,
           SIZE 13,00 ,
           ID IS 12,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Linea Ursus",
           .

      * LABEL
       05
           Form1-La-6, 
           Label, 
           COL 3,00, 
           LINE 19,00,
           LINES 1,31 ,
           SIZE 13,00 ,
           ID IS 14,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Altro",
           .

      * LABEL
       05
           Form1-La-7, 
           Label, 
           COL 3,00, 
           LINE 21,00,
           LINES 1,31 ,
           SIZE 13,00 ,
           ID IS 16,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Logo",
           .

      * LABEL
       05
           Form1-La-1a, 
           Label, 
           COL 3,00, 
           LINE 8,92,
           LINES 1,31 ,
           SIZE 16,00 ,
           ID IS 18,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Listino in vigore dal",
           .

      * LABEL
       05
           Form1-La-5aaa, 
           Label, 
           COL 3,00, 
           LINE 5,00,
           LINES 1,31 ,
           SIZE 17,00 ,
           ID IS 20,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Codice capogruppo",
           .

      * LABEL
       05
           lab-capo, 
           Label, 
           COL 32,00, 
           LINE 5,00,
           LINES 1,31 ,
           SIZE 70,00 ,
           COLOR IS 5,
           ID IS 21,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-capo-buf,
           .

      * PUSH BUTTON
       05
           pb-finanz, 
           Push-Button, 
           COL 117,38, 
           LINE 7,69,
           LINES 23,00 ,
           SIZE 91,00 ,
           BITMAP-HANDLE SITFIN_91X21-BMP,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 1007,
           FLAT,
           ID IS 189,
           TITLE "Visualizza la situazione finanziaria del Cliente verif
      -    "icando situazione attuale fido concesso e scaduto",
           VISIBLE 0,
           AFTER PROCEDURE pb-finanz-AfterProcedure, 
           BEFORE PROCEDURE pb-finanz-BeforeProcedure, 
           .

      * LABEL
       05
           Form1-La-1aa, 
           Label, 
           COL 37,00, 
           LINE 8,92,
           LINES 1,31 ,
           SIZE 14,00 ,
           ID IS 190,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Tipologia Cliente",
           .

      * LABEL
       05
           lab-tipocli, 
           Label, 
           COL 59,88, 
           LINE 9,00,
           LINES 1,31 ,
           SIZE 55,00 ,
           COLOR IS 5,
           ID IS 22,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-tipocli-buf,
           .

      * LABEL
       05
           lab-gruppo, 
           Label, 
           COL 32,00, 
           LINE 23,00,
           LINES 1,31 ,
           SIZE 70,00 ,
           COLOR IS 5,
           ID IS 23,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-gruppo-buf,
           .

      * LABEL
       05
           Form1-La-5aaaa, 
           Label, 
           COL 3,00, 
           LINE 23,00,
           LINES 1,31 ,
           SIZE 17,00 ,
           ID IS 24,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Gruppo d'invio",
           .

      * LABEL
       05
           lab-cli-rifer, 
           Label, 
           COL 32,00, 
           LINE 25,00,
           LINES 1,31 ,
           SIZE 70,00 ,
           COLOR IS 5,
           ID IS 25,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-cli-rifer-buf,
           .

      * LABEL
       05
           Form1-La-5aaaaa, 
           Label, 
           COL 3,00, 
           LINE 25,00,
           LINES 1,31 ,
           SIZE 18,00 ,
           ID IS 26,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Cliente di riferimento",
           .

      * LABEL
       05
           Form1-La-5aaaab, 
           Label, 
           COL 3,00, 
           LINE 27,00,
           LINES 1,31 ,
           SIZE 17,00 ,
           ID IS 27,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Codice G2",
           .

      * TOOLBAR
       01
           Form1-Tb-1,
           .    

      * PUSH BUTTON
       05
           TOOL-ESCI, 
           Push-Button, 
           COL 1,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           ENABLED E-ESCI,
           EXCEPTION-VALUE 27,
           FLAT,
           ID IS 2223,
           SELF-ACT,
           ESCAPE-BUTTON,
           TITLE "Esci (Esc)",
           .

      * PUSH BUTTON
       05
           TOOL-NUOVO, 
           Push-Button, 
           COL 6,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 2,
           FRAMED,
           SQUARE,
           ENABLED E-NUOVO,
           EXCEPTION-VALUE 2,
           FLAT,
           ID IS 208,
           SELF-ACT,
           TITLE "Nuovo (F2)",
           bitmap-number BitmapNumNew
           .

      * PUSH BUTTON
       05
           TOOL-CANCELLA, 
           Push-Button, 
           COL 16,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           FRAMED,
           SQUARE,
           ENABLED E-CANCELLA,
           EXCEPTION-VALUE 4,
           FLAT,
           ID IS 106,
           SELF-ACT,
           TITLE "Cancella (F4)",
           BITMAP-NUMBER BitmapNumDelete
           .

      * PUSH BUTTON
       05
           TOOL-SALVA, 
           Push-Button, 
           COL 11,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           FRAMED,
           SQUARE,
           ENABLED E-SALVA,
           EXCEPTION-VALUE 3,
           FLAT,
           ID IS 75,
           SELF-ACT,
           TITLE "Salva (F3)",
           BITMAP-NUMBER BitmapNumSave
           .

      * PUSH BUTTON
       05
           TOOL-ANTEPRIMA, 
           Push-Button, 
           COL 26,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           FRAMED,
           SQUARE,
           ENABLED E-ANTEPRIMA,
           EXCEPTION-VALUE 6,
           FLAT,
           ID IS 76,
           SELF-ACT,
           TITLE "Anteprima (F6)",
           BITMAP-NUMBER BitmapNumPreview
           .

      * CHECK BOX
       05
           TOOL-MODIFICA, 
           Check-Box, 
           COL 21,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 5,
           FRAMED,
           SQUARE,
           ENABLED E-MODIFICA,
           EXCEPTION-VALUE 150
           FLAT,
           ID IS 77,
           SELF-ACT,
           TITLE "Modifica (F5)",
           VALUE MOD,
           AFTER PROCEDURE TOOL-MODIFICA-AfterProcedure,
           BEFORE PROCEDURE TOOL-MODIFICA-BeforeProcedure, 
           .
      * PUSH BUTTON
       05
           TOOL-STAMPA, 
           Push-Button, 
           COL 31,00, 
           LINE 1,15,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           FRAMED,
           SQUARE,
           ENABLED E-STAMPA,
           EXCEPTION-VALUE 7,
           FLAT,
           ID IS 110,
           SELF-ACT,
           TITLE "Stampa (F7)",
           BITMAP-NUMBER BitmapNumPrint
           .

      * PUSH BUTTON
       05
           TOOL-CERCA, 
           Push-Button, 
           COL 36,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           FRAMED,
           SQUARE,
           ENABLED E-CERCA,
           EXCEPTION-VALUE 8,
           FLAT,
           ID IS 111,
           SELF-ACT,
           TITLE "Cerca (F8)",
           BITMAP-NUMBER BitmapNumZoom
           .

      * PUSH BUTTON
       05
           TOOL-SELEZIONA, 
           Push-Button, 
           COL 41,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 9,
           FRAMED,
           SQUARE,
           ENABLED E-SELEZIONA,
           EXCEPTION-VALUE 9,
           FLAT,
           ID IS 112,
           SELF-ACT,
           TITLE "Seleziona (F9)",
           .

      * PUSH BUTTON
       05
           Form1-Pb-1a, 
           Push-Button, 
           COL 46,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 10,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 1002,
           FLAT,
           ID IS 113,
           SELF-ACT,
           TITLE "&Primo",
           .

      * PUSH BUTTON
       05
           Form1-Pb-1b, 
           Push-Button, 
           COL 51,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 11,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 67,
           FLAT,
           ID IS 114,
           SELF-ACT,
           TITLE "Precedente (PgDn)",
           .

      * PUSH BUTTON
       05
           Form1-Pb-1c, 
           Push-Button, 
           COL 56,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 12,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 68,
           FLAT,
           ID IS 115,
           SELF-ACT,
           TITLE "Successivo (PgUp)",
           .

      * PUSH BUTTON
       05
           Form1-Pb-1d, 
           Push-Button, 
           COL 61,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 13,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 1006,
           FLAT,
           ID IS 116,
           SELF-ACT,
           TITLE "&Ultimo",
           .

      *{TOTEM}END

      *{TOTEM}LINKPARA
       PROCEDURE  DIVISION USING LK-BLOCKPGM, USER-CODI, LIVELLO-ABIL.
      *{TOTEM}END

      *{TOTEM}DECLARATIVE
       DECLARATIVES.
      * <TOTEM:EPT. INIT:tgrupgdo, INIT:tgrupgdo, BeforeDeclarative>
       TGRUPGDO-ERR SECTION.
           use after error procedure on tgrupgdo.
           set RecLocked to false.
           evaluate status-tgrupgdo
           when "35"
                display message "File [TGRUPGDO] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TGRUPGDO] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TGRUPGDO] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           when "93" 
                display message box "File già in uso"
                          title tit-err
                           icon 3
                perform ANAGR01-EV-AFTER-PROGRAM
                goback
           when "99" 
                set RecLocked to true
                set errori    to true
                move 1 to mod-k
                move 0 to mod
                modify tool-modifica, value  mod
                display form1
                set StatusVisua to true
                perform STATUS-BAR-MSG
                move "00" to status-tgrupgdo
                if ReadSecca
                   read  tgrupgdo no lock 
                         invalid  continue
                     not invalid  perform FORM1-IUD-DISPLAY
                   end-read
                end-if
                display message MSG-Record-gia-in-uso
                        title = tit-err
                        icon is mb-error-icon
           when "23"            
                move 1 to mod-k
                move 0 to mod
                modify tool-modifica, value = mod
                set StatusVisua to true
                perform STATUS-BAR-MSG 
                if nuovo              
                   initialize gdo-rec of tgrupgdo 
                              replacing numeric data by zeroes
                                   alphanumeric data by spaces
                   perform FORM1-FLD-TO-BUF
                   display form1-tb-1
                   set vecchio to true
                end-if       
                perform ABILITAZIONI
                display form1
                |RISETTO IL VALORE A "23" PERCHE DENTRO AL PAR. CLEAR-SCREEN
                |CON L'OPERAZIONE UNLOCK VIENE RISETTATO A ZERO COSICCHÈ 
                |QUANDO TORNA DENTRO AI PAR. DI SCORRIMENTO DI TOTEM SI 
                |TROVA IN UNA SITUAZIONE CORRETTA E PROSEGUE CON LA READ
                |USCENDO CON UN MESSAGGIO DI ERRORE DI TIPO "46"
                move "23" to status-tgrupgdo
           end-evaluate.

      * <TOTEM:END>
       INPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON INPUT.
       0100-DECL.
           EXIT.
       I-O-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON I-O.
       0200-DECL.
           EXIT.
       OUTPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON OUTPUT.
       0300-DECL.
           EXIT.
       TRANSACTION-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON TRANSACTION.
       0400-DECL.
           EXIT.
       END DECLARATIVES.
      *{TOTEM}END

       MAIN-LOGIC.
      *{TOTEM}ENTRY-BEFPRG
      *    Before-Program
           PERFORM anagr01-Ev-Before-Program
      *{TOTEM}END
           PERFORM INITIALIZE-ROUTINE.
      * run main screen
      *{TOTEM}RUN-MAINSCR
           PERFORM Form1-OPEN-ROUTINE.
      *{TOTEM}END

      *{TOTEM}COPY-PROCEDURE
       EXIT-STOP-ROUTINE.
           PERFORM CLOSE-FILE-RTN
      * <TOTEM:EPT. INIT:tgrupgdo, INIT:tgrupgdo, BeforeDestroyResource>
      * <TOTEM:END>
           DESTROY Verdana10-Occidentale
           CALL "w$bitmap" USING WBITMAP-DESTROY, SITFIN_91X21-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, toolbar-bmp
      *    After-Program
           PERFORM anagr01-Ev-After-Program
           EXIT PROGRAM TOTEM-PgmStatus
           STOP RUN.

       INITIALIZE-ROUTINE.
      *    Before Init
      * initialize program status variable
           Initialize TOTEM-PgmStatus.
      * get system information
           ACCEPT SYSTEM-INFORMATION FROM SYSTEM-INFO.
      * get terminal information
           ACCEPT TERMINAL-ABILITIES FROM TERMINAL-INFO.
      * set font
           PERFORM INIT-FONT.
      * load bitmap
           PERFORM INIT-BMP.
      * load resource
           PERFORM INIT-RES.
      * create pop-up menu
           PERFORM INIT-POPUP.
      * open files
           PERFORM OPEN-FILE-RTN.
      *    After Init
           .
    
       INIT-FONT.
      * Verdana10-Occidentale
           INITIALIZE WFONT-DATA Verdana10-Occidentale
           MOVE 10 TO WFONT-SIZE
           MOVE "Verdana" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO FALSE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Verdana10-Occidentale, WFONT-DATA
           .

       INIT-BMP.
      * pb-finanz
           COPY RESOURCE "SITFIN_91X21.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "SITFIN_91X21.BMP", 
                   GIVING SITFIN_91X21-BMP.
      * TOOL-ESCI
           COPY RESOURCE "toolbar.bmp".
           CALL "w$bitmap" USING WBITMAP-LOAD "toolbar.bmp", 
                   GIVING toolbar-bmp.
           .

       INIT-RES.
           .

       INIT-POPUP.
           .

       OPEN-FILE-RTN.
      *    Before Open
           PERFORM OPEN-tgrupgdo
           PERFORM OPEN-tgrupgdo1
           PERFORM OPEN-ttipocli
           PERFORM OPEN-tgruppi
           PERFORM OPEN-clienti
      *    After Open
           .

       OPEN-tgrupgdo.
      * <TOTEM:EPT. INIT:tgrupgdo, FD:tgrupgdo, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O tgrupgdo
           IF STATUS-tgrupgdo = "35"
              OPEN OUTPUT tgrupgdo
                IF Valid-STATUS-tgrupgdo
                   CLOSE tgrupgdo
                   OPEN I-O tgrupgdo
                END-IF
           END-IF
           IF NOT Valid-STATUS-tgrupgdo
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:tgrupgdo, FD:tgrupgdo, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tgrupgdo1.
      * <TOTEM:EPT. INIT:tgrupgdo, FD:tgrupgdo1, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O tgrupgdo1
           IF STATUS-tgrupgdo1 = "35"
              OPEN OUTPUT tgrupgdo1
                IF VALID-STATUS-tgrupgdo1
                   CLOSE tgrupgdo1
                   OPEN I-O tgrupgdo1
                END-IF
           END-IF
           IF NOT VALID-STATUS-tgrupgdo1
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:tgrupgdo, FD:tgrupgdo1, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-ttipocli.
      * <TOTEM:EPT. INIT:tgrupgdo, FD:ttipocli, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT ttipocli
           IF NOT Valid-STATUS-ttipocli
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:tgrupgdo, FD:ttipocli, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tgruppi.
      * <TOTEM:EPT. INIT:tgrupgdo, FD:tgruppi, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tgruppi
           IF NOT Valid-STATUS-tgruppi
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:tgrupgdo, FD:tgruppi, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-clienti.
      * <TOTEM:EPT. INIT:tgrupgdo, FD:clienti, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT clienti
           IF NOT Valid-STATUS-clienti
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:tgrupgdo, FD:clienti, AfterOpen>
      * <TOTEM:END>
           .

       CLOSE-FILE-RTN.
      *    Before Close
           PERFORM CLOSE-tgrupgdo
           PERFORM CLOSE-tgrupgdo1
           PERFORM CLOSE-ttipocli
           PERFORM CLOSE-tgruppi
           PERFORM CLOSE-clienti
      *    After Close
           .

       CLOSE-tgrupgdo.
      * <TOTEM:EPT. INIT:tgrupgdo, FD:tgrupgdo, BeforeClose>
      * <TOTEM:END>
           CLOSE tgrupgdo
           .

       CLOSE-tgrupgdo1.
      * <TOTEM:EPT. INIT:tgrupgdo, FD:tgrupgdo1, BeforeClose>
      * <TOTEM:END>
           CLOSE tgrupgdo1
           .

       CLOSE-ttipocli.
      * <TOTEM:EPT. INIT:tgrupgdo, FD:ttipocli, BeforeClose>
      * <TOTEM:END>
           CLOSE ttipocli
           .

       CLOSE-tgruppi.
      * <TOTEM:EPT. INIT:tgrupgdo, FD:tgruppi, BeforeClose>
      * <TOTEM:END>
           CLOSE tgruppi
           .

       CLOSE-clienti.
      * <TOTEM:EPT. INIT:tgrupgdo, FD:clienti, BeforeClose>
      * <TOTEM:END>
           CLOSE clienti
           .

       tgrupgdo-gdo-k-g2-MERGE-SPLITBUF.
           INITIALIZE tgrupgdo-gdo-k-g2-SPLITBUF
           MOVE gdo-codice-G2 OF tgrupgdo(1:3) TO 
           tgrupgdo-gdo-k-g2-SPLITBUF(1:3)
           MOVE gdo-chiave OF tgrupgdo(1:5) TO 
           tgrupgdo-gdo-k-g2-SPLITBUF(4:5)
           .

       DataSet1-tgrupgdo-INITSTART.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tgrupgdo-KEY1-Asc
                 MOVE Low-Value TO gdo-chiave OF tgrupgdo
              ELSE
                 MOVE High-Value TO gdo-chiave OF tgrupgdo
              END-IF
           END-EVALUATE
           .

       DataSet1-tgrupgdo-INITEND.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tgrupgdo-KEY1-Asc
                 MOVE High-Value TO gdo-chiave OF tgrupgdo
              ELSE
                 MOVE Low-Value TO gdo-chiave OF tgrupgdo
              END-IF
           END-EVALUATE
           .

       DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           .   

       DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-tgrupgdo-KEY1-ORDER
           END-EVALUATE
           .

       DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-tgrupgdo-KEY1-ORDER
           END-EVALUATE
           .

      * tgrupgdo
       DataSet1-tgrupgdo-START.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tgrupgdo-KEY1-Asc
                 START tgrupgdo KEY >= gdo-chiave OF tgrupgdo
              ELSE
                 START tgrupgdo KEY <= gdo-chiave OF tgrupgdo
              END-IF
           END-EVALUATE
           .

       DataSet1-tgrupgdo-START-NOTGREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tgrupgdo-KEY1-Asc
                 START tgrupgdo KEY <= gdo-chiave OF tgrupgdo
              ELSE
                 START tgrupgdo KEY >= gdo-chiave OF tgrupgdo
              END-IF
           END-EVALUATE
           .

       DataSet1-tgrupgdo-START-GREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tgrupgdo-KEY1-Asc
                 START tgrupgdo KEY > gdo-chiave OF tgrupgdo
              ELSE
                 START tgrupgdo KEY < gdo-chiave OF tgrupgdo
              END-IF
           END-EVALUATE
           .

       DataSet1-tgrupgdo-START-LESS.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tgrupgdo-KEY1-Asc
                 START tgrupgdo KEY < gdo-chiave OF tgrupgdo
              ELSE
                 START tgrupgdo KEY > gdo-chiave OF tgrupgdo
              END-IF
           END-EVALUATE
           .

       DataSet1-tgrupgdo-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, BeforeReadRecord>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tgrupgdo-LOCK
                 READ tgrupgdo WITH LOCK 
                 KEY gdo-chiave OF tgrupgdo
              ELSE
                 READ tgrupgdo WITH NO LOCK 
                 KEY gdo-chiave OF tgrupgdo
              END-IF
           END-EVALUATE
           PERFORM tgrupgdo-gdo-k-g2-MERGE-SPLITBUF
           MOVE STATUS-tgrupgdo TO TOTEM-ERR-STAT 
           MOVE "tgrupgdo" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tgrupgdo-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, BeforeReadNext>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tgrupgdo-KEY1-Asc
                 IF DataSet1-tgrupgdo-LOCK
                    READ tgrupgdo NEXT WITH LOCK
                 ELSE
                    READ tgrupgdo NEXT WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-tgrupgdo-LOCK
                    READ tgrupgdo PREVIOUS WITH LOCK
                 ELSE
                    READ tgrupgdo PREVIOUS WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           PERFORM tgrupgdo-gdo-k-g2-MERGE-SPLITBUF
           MOVE STATUS-tgrupgdo TO TOTEM-ERR-STAT
           MOVE "tgrupgdo" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tgrupgdo-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, BeforeReadPrev>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tgrupgdo-KEY1-Asc
                 IF DataSet1-tgrupgdo-LOCK
                    READ tgrupgdo PREVIOUS WITH LOCK
                 ELSE
                    READ tgrupgdo PREVIOUS WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-tgrupgdo-LOCK
                    READ tgrupgdo NEXT WITH LOCK
                 ELSE
                    READ tgrupgdo NEXT WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           PERFORM tgrupgdo-gdo-k-g2-MERGE-SPLITBUF
           MOVE STATUS-tgrupgdo TO TOTEM-ERR-STAT
           MOVE "tgrupgdo" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tgrupgdo-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, BeforeWrite>
      * <TOTEM:END>
           WRITE gdo-rec OF tgrupgdo.
           MOVE STATUS-tgrupgdo TO TOTEM-ERR-STAT
           MOVE "tgrupgdo" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tgrupgdo-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, BeforeRewrite>
      * <TOTEM:END>
           REWRITE gdo-rec OF tgrupgdo.
           MOVE STATUS-tgrupgdo TO TOTEM-ERR-STAT
           MOVE "tgrupgdo" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tgrupgdo-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, BeforeDelete>
      * <TOTEM:END>
           DELETE tgrupgdo.
           MOVE STATUS-tgrupgdo TO TOTEM-ERR-STAT
           MOVE "tgrupgdo" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, AfterDelete>
      * <TOTEM:END>
           .

       tgrupgdo1-gdo-k-g2-MERGE-SPLITBUF.
           INITIALIZE tgrupgdo1-gdo-k-g2-SPLITBUF
           MOVE gdo-codice-G2 OF tgrupgdo(1:3) TO 
           tgrupgdo1-gdo-k-g2-SPLITBUF(1:3)
           MOVE gdo-chiave OF tgrupgdo(1:5) TO 
           tgrupgdo1-gdo-k-g2-SPLITBUF(4:5)
           .

       DataSet1-tgrupgdo1-INITSTART.
           IF DataSet1-tgrupgdo1-KEY-Asc
              MOVE Low-Value TO gdo-chiave OF tgrupgdo1
           ELSE
              MOVE High-Value TO gdo-chiave OF tgrupgdo1
           END-IF
           .

       DataSet1-tgrupgdo1-INITEND.
           IF DataSet1-tgrupgdo1-KEY-Asc
              MOVE High-Value TO gdo-chiave OF tgrupgdo1
           ELSE
              MOVE Low-Value TO gdo-chiave OF tgrupgdo1
           END-IF
           .

      * tgrupgdo1
       DataSet1-tgrupgdo1-START.
           IF DataSet1-tgrupgdo1-KEY-Asc
              START tgrupgdo1 KEY >= gdo-chiave OF tgrupgdo1
           ELSE
              START tgrupgdo1 KEY <= gdo-chiave OF tgrupgdo1
           END-IF
           .

       DataSet1-tgrupgdo1-START-NOTGREATER.
           IF DataSet1-tgrupgdo1-KEY-Asc
              START tgrupgdo1 KEY <= gdo-chiave OF tgrupgdo1
           ELSE
              START tgrupgdo1 KEY >= gdo-chiave OF tgrupgdo1
           END-IF
           .

       DataSet1-tgrupgdo1-START-GREATER.
           IF DataSet1-tgrupgdo1-KEY-Asc
              START tgrupgdo1 KEY > gdo-chiave OF tgrupgdo1
           ELSE
              START tgrupgdo1 KEY < gdo-chiave OF tgrupgdo1
           END-IF
           .

       DataSet1-tgrupgdo1-START-LESS.
           IF DataSet1-tgrupgdo1-KEY-Asc
              START tgrupgdo1 KEY < gdo-chiave OF tgrupgdo1
           ELSE
              START tgrupgdo1 KEY > gdo-chiave OF tgrupgdo1
           END-IF
           .

       DataSet1-tgrupgdo1-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo1, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo1, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tgrupgdo1-LOCK
              READ tgrupgdo1 WITH LOCK 
              KEY gdo-chiave OF tgrupgdo1
           ELSE
              READ tgrupgdo1 WITH NO LOCK 
              KEY gdo-chiave OF tgrupgdo1
           END-IF
           PERFORM tgrupgdo1-gdo-k-g2-MERGE-SPLITBUF
           MOVE STATUS-tgrupgdo1 TO TOTEM-ERR-STAT 
           MOVE "tgrupgdo1" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo1, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo1, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tgrupgdo1-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo1, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo1, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tgrupgdo1-KEY-Asc
              IF DataSet1-tgrupgdo1-LOCK
                 READ tgrupgdo1 NEXT WITH LOCK
              ELSE
                 READ tgrupgdo1 NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tgrupgdo1-LOCK
                 READ tgrupgdo1 PREVIOUS WITH LOCK
              ELSE
                 READ tgrupgdo1 PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tgrupgdo1-gdo-k-g2-MERGE-SPLITBUF
           MOVE STATUS-tgrupgdo1 TO TOTEM-ERR-STAT
           MOVE "tgrupgdo1" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo1, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo1, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tgrupgdo1-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo1, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo1, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tgrupgdo1-KEY-Asc
              IF DataSet1-tgrupgdo1-LOCK
                 READ tgrupgdo1 PREVIOUS WITH LOCK
              ELSE
                 READ tgrupgdo1 PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tgrupgdo1-LOCK
                 READ tgrupgdo1 NEXT WITH LOCK
              ELSE
                 READ tgrupgdo1 NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tgrupgdo1-gdo-k-g2-MERGE-SPLITBUF
           MOVE STATUS-tgrupgdo1 TO TOTEM-ERR-STAT
           MOVE "tgrupgdo1" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo1, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo1, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tgrupgdo1-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo1, BeforeWrite>
      * <TOTEM:END>
           WRITE gdo-rec OF tgrupgdo1.
           MOVE STATUS-tgrupgdo1 TO TOTEM-ERR-STAT
           MOVE "tgrupgdo1" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo1, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tgrupgdo1-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo1, BeforeRewrite>
      * <TOTEM:END>
           REWRITE gdo-rec OF tgrupgdo1.
           MOVE STATUS-tgrupgdo1 TO TOTEM-ERR-STAT
           MOVE "tgrupgdo1" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo1, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tgrupgdo1-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo1, BeforeDelete>
      * <TOTEM:END>
           DELETE tgrupgdo1.
           MOVE STATUS-tgrupgdo1 TO TOTEM-ERR-STAT
           MOVE "tgrupgdo1" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo1, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-ttipocli-INITSTART.
           IF DataSet1-ttipocli-KEY-Asc
              MOVE Low-Value TO tcl-chiave
           ELSE
              MOVE High-Value TO tcl-chiave
           END-IF
           .

       DataSet1-ttipocli-INITEND.
           IF DataSet1-ttipocli-KEY-Asc
              MOVE High-Value TO tcl-chiave
           ELSE
              MOVE Low-Value TO tcl-chiave
           END-IF
           .

      * ttipocli
       DataSet1-ttipocli-START.
           IF DataSet1-ttipocli-KEY-Asc
              START ttipocli KEY >= tcl-chiave
           ELSE
              START ttipocli KEY <= tcl-chiave
           END-IF
           .

       DataSet1-ttipocli-START-NOTGREATER.
           IF DataSet1-ttipocli-KEY-Asc
              START ttipocli KEY <= tcl-chiave
           ELSE
              START ttipocli KEY >= tcl-chiave
           END-IF
           .

       DataSet1-ttipocli-START-GREATER.
           IF DataSet1-ttipocli-KEY-Asc
              START ttipocli KEY > tcl-chiave
           ELSE
              START ttipocli KEY < tcl-chiave
           END-IF
           .

       DataSet1-ttipocli-START-LESS.
           IF DataSet1-ttipocli-KEY-Asc
              START ttipocli KEY < tcl-chiave
           ELSE
              START ttipocli KEY > tcl-chiave
           END-IF
           .

       DataSet1-ttipocli-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-ttipocli-LOCK
              READ ttipocli WITH LOCK 
              KEY tcl-chiave
           ELSE
              READ ttipocli WITH NO LOCK 
              KEY tcl-chiave
           END-IF
           MOVE STATUS-ttipocli TO TOTEM-ERR-STAT 
           MOVE "ttipocli" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-ttipocli-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-ttipocli-KEY-Asc
              IF DataSet1-ttipocli-LOCK
                 READ ttipocli NEXT WITH LOCK
              ELSE
                 READ ttipocli NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-ttipocli-LOCK
                 READ ttipocli PREVIOUS WITH LOCK
              ELSE
                 READ ttipocli PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-ttipocli TO TOTEM-ERR-STAT
           MOVE "ttipocli" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-ttipocli-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-ttipocli-KEY-Asc
              IF DataSet1-ttipocli-LOCK
                 READ ttipocli PREVIOUS WITH LOCK
              ELSE
                 READ ttipocli PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-ttipocli-LOCK
                 READ ttipocli NEXT WITH LOCK
              ELSE
                 READ ttipocli NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-ttipocli TO TOTEM-ERR-STAT
           MOVE "ttipocli" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-ttipocli-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-ttipocli TO TOTEM-ERR-STAT
           MOVE "ttipocli" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-ttipocli-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-ttipocli TO TOTEM-ERR-STAT
           MOVE "ttipocli" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-ttipocli-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-ttipocli TO TOTEM-ERR-STAT
           MOVE "ttipocli" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tgruppi-INITSTART.
           IF DataSet1-tgruppi-KEY-Asc
              MOVE Low-Value TO tgr-chiave
           ELSE
              MOVE High-Value TO tgr-chiave
           END-IF
           .

       DataSet1-tgruppi-INITEND.
           IF DataSet1-tgruppi-KEY-Asc
              MOVE High-Value TO tgr-chiave
           ELSE
              MOVE Low-Value TO tgr-chiave
           END-IF
           .

      * tgruppi
       DataSet1-tgruppi-START.
           IF DataSet1-tgruppi-KEY-Asc
              START tgruppi KEY >= tgr-chiave
           ELSE
              START tgruppi KEY <= tgr-chiave
           END-IF
           .

       DataSet1-tgruppi-START-NOTGREATER.
           IF DataSet1-tgruppi-KEY-Asc
              START tgruppi KEY <= tgr-chiave
           ELSE
              START tgruppi KEY >= tgr-chiave
           END-IF
           .

       DataSet1-tgruppi-START-GREATER.
           IF DataSet1-tgruppi-KEY-Asc
              START tgruppi KEY > tgr-chiave
           ELSE
              START tgruppi KEY < tgr-chiave
           END-IF
           .

       DataSet1-tgruppi-START-LESS.
           IF DataSet1-tgruppi-KEY-Asc
              START tgruppi KEY < tgr-chiave
           ELSE
              START tgruppi KEY > tgr-chiave
           END-IF
           .

       DataSet1-tgruppi-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tgruppi, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tgruppi, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tgruppi-LOCK
              READ tgruppi WITH LOCK 
              KEY tgr-chiave
           ELSE
              READ tgruppi WITH NO LOCK 
              KEY tgr-chiave
           END-IF
           MOVE STATUS-tgruppi TO TOTEM-ERR-STAT 
           MOVE "tgruppi" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tgruppi, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tgruppi, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tgruppi-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tgruppi, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tgruppi, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tgruppi-KEY-Asc
              IF DataSet1-tgruppi-LOCK
                 READ tgruppi NEXT WITH LOCK
              ELSE
                 READ tgruppi NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tgruppi-LOCK
                 READ tgruppi PREVIOUS WITH LOCK
              ELSE
                 READ tgruppi PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tgruppi TO TOTEM-ERR-STAT
           MOVE "tgruppi" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tgruppi, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tgruppi, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tgruppi-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tgruppi, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tgruppi, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tgruppi-KEY-Asc
              IF DataSet1-tgruppi-LOCK
                 READ tgruppi PREVIOUS WITH LOCK
              ELSE
                 READ tgruppi PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tgruppi-LOCK
                 READ tgruppi NEXT WITH LOCK
              ELSE
                 READ tgruppi NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tgruppi TO TOTEM-ERR-STAT
           MOVE "tgruppi" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tgruppi, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tgruppi, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tgruppi-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tgruppi, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tgruppi TO TOTEM-ERR-STAT
           MOVE "tgruppi" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tgruppi, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tgruppi-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tgruppi, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tgruppi TO TOTEM-ERR-STAT
           MOVE "tgruppi" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tgruppi, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tgruppi-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tgruppi, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tgruppi TO TOTEM-ERR-STAT
           MOVE "tgruppi" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tgruppi, AfterDelete>
      * <TOTEM:END>
           .

       clienti-cli-K1-MERGE-SPLITBUF.
           INITIALIZE clienti-cli-K1-SPLITBUF
           MOVE cli-tipo-CF OF clienti(1:1) TO 
           clienti-cli-K1-SPLITBUF(1:1)
           MOVE cli-ragsoc-1 OF clienti(1:40) TO 
           clienti-cli-K1-SPLITBUF(2:40)
           MOVE cli-codice OF clienti(1:5) TO 
           clienti-cli-K1-SPLITBUF(42:5)
           .

       clienti-cli-K3-MERGE-SPLITBUF.
           INITIALIZE clienti-cli-K3-SPLITBUF
           MOVE cli-gdo OF clienti(1:5) TO clienti-cli-K3-SPLITBUF(1:5)
           MOVE cli-chiave OF clienti(1:6) TO 
           clienti-cli-K3-SPLITBUF(6:6)
           .

       clienti-cli-K4-MERGE-SPLITBUF.
           INITIALIZE clienti-cli-K4-SPLITBUF
           MOVE cli-utf OF clienti(1:1) TO clienti-cli-K4-SPLITBUF(1:1)
           MOVE cli-chiave OF clienti(1:6) TO 
           clienti-cli-K4-SPLITBUF(2:6)
           .

       DataSet1-clienti-INITSTART.
           IF DataSet1-clienti-KEY-Asc
              MOVE Low-Value TO cli-chiave OF clienti
           ELSE
              MOVE High-Value TO cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-INITEND.
           IF DataSet1-clienti-KEY-Asc
              MOVE High-Value TO cli-chiave OF clienti
           ELSE
              MOVE Low-Value TO cli-chiave OF clienti
           END-IF
           .

      * clienti
       DataSet1-clienti-START.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY >= cli-chiave OF clienti
           ELSE
              START clienti KEY <= cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-START-NOTGREATER.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY <= cli-chiave OF clienti
           ELSE
              START clienti KEY >= cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-START-GREATER.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY > cli-chiave OF clienti
           ELSE
              START clienti KEY < cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-START-LESS.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY < cli-chiave OF clienti
           ELSE
              START clienti KEY > cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-clienti-LOCK
              READ clienti WITH LOCK 
              KEY cli-chiave OF clienti
           ELSE
              READ clienti WITH NO LOCK 
              KEY cli-chiave OF clienti
           END-IF
           PERFORM clienti-cli-K1-MERGE-SPLITBUF
           PERFORM clienti-cli-K3-MERGE-SPLITBUF
           PERFORM clienti-cli-K4-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT 
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-clienti-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-clienti-KEY-Asc
              IF DataSet1-clienti-LOCK
                 READ clienti NEXT WITH LOCK
              ELSE
                 READ clienti NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-clienti-LOCK
                 READ clienti PREVIOUS WITH LOCK
              ELSE
                 READ clienti PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM clienti-cli-K1-MERGE-SPLITBUF
           PERFORM clienti-cli-K3-MERGE-SPLITBUF
           PERFORM clienti-cli-K4-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-clienti-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-clienti-KEY-Asc
              IF DataSet1-clienti-LOCK
                 READ clienti PREVIOUS WITH LOCK
              ELSE
                 READ clienti PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-clienti-LOCK
                 READ clienti NEXT WITH LOCK
              ELSE
                 READ clienti NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM clienti-cli-K1-MERGE-SPLITBUF
           PERFORM clienti-cli-K3-MERGE-SPLITBUF
           PERFORM clienti-cli-K4-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-INIT-RECORD.
           INITIALIZE gdo-rec OF tgrupgdo
           INITIALIZE gdo-rec OF tgrupgdo1
           INITIALIZE tcl-rec OF ttipocli
           INITIALIZE tgr-rec OF tgruppi
           INITIALIZE cli-rec OF clienti
           .


      * FD's Initialize Paragraph
       DataSet1-tgrupgdo-INITREC.
           INITIALIZE gdo-rec OF tgrupgdo
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tgrupgdo1-INITREC.
           INITIALIZE gdo-rec OF tgrupgdo1
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-ttipocli-INITREC.
           INITIALIZE tcl-rec OF ttipocli
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tgruppi-INITREC.
           INITIALIZE tgr-rec OF tgruppi
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-clienti-INITREC.
           INITIALIZE cli-rec OF clienti
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      *
       DataSet1-DISPATCH-BUFTOFLD.
           EVALUATE TOTEM-Form-Index ALSO TOTEM-Frame-Index
              WHEN 1 ALSO 0
                  PERFORM Form1-Buf-To-Fld
           END-EVALUATE
           .

       Form1-DISPLAY-STATUS-MSG.
            MODIFY Form1-St-1-Handle PANEL-INDEX = 1
                PANEL-TEXT = TOTEM-HINT-TEXT
           .

       Form1-CLEAR-STATUS-MSG.
           MOVE SPACES TO TOTEM-MSG-1, TOTEM-MSG-2, TOTEM-MSG-3, 
           TOTEM-MSG-TEXT
           PERFORM Form1-DISPLAY-STATUS-MSG
           .

       Form1-Open-Routine.
           PERFORM Form1-Scrn
           PERFORM Form1-Proc
           .

       Form1-Scrn.
           PERFORM Form1-Create-Win
           PERFORM Form1-Init-Value
           PERFORM Form1-Init-Data
      * Tab keystrok settings
      * Tool Bar
           DISPLAY Form1-Tb-1
           PERFORM Form1-DISPLAY
           .

       Form1-Create-Win.
           Display Independent GRAPHICAL WINDOW
              LINES 29,94,
              SIZE 136,13,
              COLOR 65793,
              CONTROL FONT Verdana10-Occidentale,
              CONTROLS-UNCROPPED,
              LABEL-OFFSET 23,
              LINK TO THREAD,
              MODELESS,
              NO SCROLL,
              TITLE-BAR,
              TITLE TITOLO,
              AUTO-MINIMIZE,
              WITH SYSTEM MENU,
              USER-GRAY,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE Form1-Event-Proc,
              HANDLE IS Form1-Handle,
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
           DISPLAY TOOL-BAR 
              LINES 2,69,   
              HANDLE IN Form1-Tb-1-Handle
           DISPLAY Form1-Tb-1 UPON Form1-Tb-1-Handle

      * Status-bar
           DISPLAY STATUS-BAR
              GRIP,
              PANEL-WIDTHS (75, 23, 999),
              PANEL-STYLE  (1, 1, 1),
              PANEL-TEXT   (SPACE, SPACE, SPACE),
              HANDLE IS Form1-St-1-Handle
           DISPLAY Form1 UPON Form1-Handle
      * DISPLAY-COLUMNS settings
           .

       Form1-PROC.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeAccept>
      *<<** customized_default, sp-g, form1-custom1-2 **>>           
           perform ABILITA-TOOLBAR.
           perform ABILITAZIONI.

           set StatusVisua to true.
           perform STATUS-BAR-MSG.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT Form1
                 ON EXCEPTION
                    PERFORM Form1-Evaluate-Func
                 MOVE 1 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY Form1-Handle
           INITIALIZE Key-Status
           .

       Form1-Evaluate-Func.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterAccept>
           evaluate key-status
           when 5 |MODIFICA
                inquire tool-modifica, enabled in e-modifica
                if e-modifica = 1
                   if mod = 0 move 1 to mod
                   else       move 0 to mod
                   end-if
                   modify tool-modifica, value = mod
                   perform MODIFICA
                end-if
           end-evaluate.

           .
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM Form1-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM Form1-Exit
                 END-IF
              WHEN Key-Status = 1003
                 PERFORM pb-foto-LinkTo
              WHEN Key-Status = 1007
                 PERFORM pb-finanz-LinkTo
              WHEN Key-Status = 2
                 PERFORM NUOVO-LinkTo
              WHEN Key-Status = 4
                 PERFORM CANCELLA-LinkTo
              WHEN Key-Status = 3
                 PERFORM TOOL-SALVA-LinkTo
              WHEN Key-Status = 6
                 PERFORM ANTEPRIMA-LinkTo
              WHEN Key-Status = 150
                 PERFORM TOOL-MODIFICA-LinkTo
              WHEN Key-Status = 7
                 PERFORM STAMPA-LinkTo
              WHEN Key-Status = 8
                 PERFORM TOOL-CERCA-LinkTo
              WHEN Key-Status = 9
                 PERFORM TOOL-SELEZIONA-LinkTo
              WHEN Key-Status = 1002
                 PERFORM TOOL-PRIMO
              WHEN Key-Status = 67
                 PERFORM TOOL-PRECEDENTE
              WHEN Key-Status = 68
                 PERFORM TOOL-SUCCESSIVO
              WHEN Key-Status = 1006
                 PERFORM TOOL-ULTIMO
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       Form1-CLEAR.
           PERFORM Form1-INIT-VALUE
           PERFORM Form1-DISPLAY
           .

       Form1-DISPLAY.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY Form1-Tb-1
           DISPLAY Form1 UPON Form1-Handle
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterDisplay>
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       Form1-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeExit>
           perform SALV-MOD.

           if errori
              move 26 to key-status
              exit paragraph
           end-if.

           .
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       Form1-Init-Data.
           MOVE 1 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
           .

       Form1-DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-tgrupgdo-KEY1-ORDER
           END-EVALUATE
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-tgrupgdo-KEY1-ORDER
           END-EVALUATE
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Update-Key.
           MOVE gdo-rec OF tgrupgdo TO
                     Form1-MULKEY-TMPBUF
           PERFORM Form1-CLEAR
           PERFORM Form1-INIT-DATA
           MOVE Form1-MULKEY-TMPBUF TO
                     gdo-rec OF tgrupgdo
           PERFORM DataSet1-tgrupgdo-Read
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-CURR
           PERFORM Form1-IUD-Display
           .

       Form1-DUPLICATE-MOVEKEY.
           .

       Form1-First.
           PERFORM Form1-DUMMY-FIRST
           PERFORM DataSet1-tgrupgdo-INITSTART
           PERFORM DataSet1-tgrupgdo-START
           IF NOT Valid-STATUS-tgrupgdo
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeFirst>
      * <TOTEM:END>
           PERFORM DataSet1-tgrupgdo-Read-Next
           IF NOT Valid-STATUS-tgrupgdo
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterFirst>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY.
           PERFORM Form1-IUD-Display
           .

       Form1-Previous.
              PERFORM Form1-Buf-To-Fld
              PERFORM DataSet1-tgrupgdo-START-LESS
           IF NOT Valid-STATUS-tgrupgdo
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforePrevious>
      * <TOTEM:END>
           PERFORM DataSet1-tgrupgdo-Read-Prev
           IF NOT Valid-STATUS-tgrupgdo
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterPrevious>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-PREVIOUS
           PERFORM Form1-IUD-Display
           .

       Form1-Next.
              PERFORM Form1-Buf-To-Fld
              PERFORM DataSet1-tgrupgdo-START-GREATER
           IF NOT Valid-STATUS-tgrupgdo
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeNext>
      * <TOTEM:END>
           PERFORM DataSet1-tgrupgdo-Read-Next
           IF NOT Valid-STATUS-tgrupgdo
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterNext>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-NEXT
           PERFORM Form1-IUD-Display
           .
      
       Form1-Last.
           PERFORM Form1-DUMMY-LAST
           PERFORM DataSet1-tgrupgdo-INITEND
           PERFORM DataSet1-tgrupgdo-START-NOTGREATER
           IF NOT Valid-STATUS-tgrupgdo
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeLast>
      * <TOTEM:END>
           PERFORM DataSet1-tgrupgdo-Read-Prev
           IF NOT Valid-STATUS-tgrupgdo
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterLast>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY.
           PERFORM Form1-IUD-Display
           .

       Form1-Curr.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeCurrent>
      * <TOTEM:END>
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-tgrupgdo-Read
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-CURR
           PERFORM Form1-IUD-Display
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterCurrent>
      * <TOTEM:END>
           .

       Form1-IUD-Display.
           IF Valid-STATUS-tgrupgdo
              PERFORM Form1-ALLGRID-RESET
              PERFORM Form1-Fld-To-Buf
              PERFORM Form1-NAVI-FOR-MASTERGRID
              PERFORM Form1-DISPLAY
           ELSE
              IF Form1-FLAG-REFRESH
                 CONTINUE
              ELSE
                 PERFORM Form1-Extended-File-Status
              END-IF
           END-IF
           .

       Form1-Add.
           PERFORM Form1-Buf-To-Fld
           PERFORM Form1-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM Form1-DUMMY-ADD
           PERFORM DataSet1-tgrupgdo-INITREC
           PERFORM Form1-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeAdd>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-tgrupgdo-Rec-Write
           IF Valid-STATUS-tgrupgdo
              PERFORM Form1-RESUMMARY-INS
              PERFORM Form1-DUMMY-UPDATE-INIT
              MOVE "301" TO TOTEM-MSG-ID
              PERFORM Form1-IUD-Display
           END-IF
           PERFORM Form1-ERR-CHECKING
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterAdd>
      * <TOTEM:END>
           .
     
       Form1-Update.
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-tgrupgdo-START              
           IF NOT Valid-STATUS-tgrupgdo
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
           PERFORM DataSet1-tgrupgdo-Read
           PERFORM Form1-Buf-To-Fld
           PERFORM Form1-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM Form1-DUMMY-UPDATE
           PERFORM Form1-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeUpdate>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-tgrupgdo-Rec-Rewrite
           IF Valid-STATUS-tgrupgdo
              PERFORM Form1-RESUMMARY-DEL
              PERFORM Form1-DUMMY-UPDATE-INIT
              MOVE "302" TO TOTEM-MSG-ID
              PERFORM Form1-IUD-Display
           END-IF
           PERFORM Form1-ERR-CHECKING
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterUpdate>
      * <TOTEM:END>
           .

       Form1-Delete.
           MOVE "203" TO TOTEM-MSG-ID
           PERFORM MESSAGE-BOX-DISPLAY
           IF TOTEM-MSG-RETURN-VALUE NOT = 1
              INITIALIZE TOTEM-MSG-TEXT
              EXIT PARAGRAPH 
           END-IF
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDelete>
      * <TOTEM:END>
           PERFORM Form1-DUMMY-DELETE
      * delete
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-tgrupgdo-Rec-Delete
           IF Valid-STATUS-tgrupgdo
              PERFORM Form1-CLEAR
              PERFORM Form1-DUMMY-DELETE-INIT
              MOVE "303" TO TOTEM-MSG-ID
              MOVE "00" to STATUS-tgrupgdo
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterDelete>
      * <TOTEM:END>
           PERFORM Form1-ERR-CHECKING
           .

       Form1-NAVI-FOR-MASTERGRID.
           .

       Form1-ERR-CHECKING.
           IF Valid-STATUS-tgrupgdo
              PERFORM Form1-SHOW-MSG-ROUTINE
           ELSE
              PERFORM Form1-Extended-File-Status
           END-IF
           .

       Form1-RESUMMARY-INS.
           .

       Form1-RESUMMARY-DEL.
           .


       Form1-DUMMY-FIRST.
           .

       Form1-DUMMY-PREVIOUS.
           .

       Form1-DUMMY-NEXT.
           .

       Form1-DUMMY-LAST.
           .

       Form1-DUMMY-CURR.
           .

       Form1-DUMMY-ADD.
           .

       Form1-DUMMY-UPDATE.
           .

       Form1-DUMMY-UPDATE-INIT.
           .

       Form1-DUMMY-DELETE.
           .

       Form1-DUMMY-DELETE-INIT.
           .

       Form1-Init-Value.
           MOVE TITOLO TO TOTEM-MSG-TITLE
           INITIALIZE Form1-BUF
      * FORM : Form1
           PERFORM DataSet1-INIT-RECORD
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, SetDefault>
      * <TOTEM:END>
           PERFORM Form1-FLD-TO-BUF
           .


       Form1-ALLGRID-RESET.
           .

      * for Form's Validation
       Form1-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
      * ef-codice's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-codice-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5001 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-capo's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-capo-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5002 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-des's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-des-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5003 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-data's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-data-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5004 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-tipocli's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-tipocli-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5005 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-att's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-att-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5006 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-bosch's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-bosch-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5007 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-mafra's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-mafra-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5008 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-linea's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-linea-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5009 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-altro's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-altro-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5010 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-logo's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-logo-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5011 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-gruppo's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-gruppo-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5012 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-cli-rifer's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-cli-rifer-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5013 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-codice-G2's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-codice-G2-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5014 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
           .

       ef-codice-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-codice, BeforeValidation>
      * <TOTEM:END>
           .

       ef-codice-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-codice, AfterValidation>
      * <TOTEM:END>
           .

      * ef-codice's Validation
       ef-codice-VALIDATION.
           PERFORM ef-codice-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-codice-AFTER-VALIDATION
           .

       ef-capo-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-capo, BeforeValidation>
      * <TOTEM:END>
           .

       ef-capo-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-capo, AfterValidation>
      * <TOTEM:END>
           .

      * ef-capo's Validation
       ef-capo-VALIDATION.
           PERFORM ef-capo-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-capo-AFTER-VALIDATION
           .

       ef-des-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-des, BeforeValidation>
      * <TOTEM:END>
           .

       ef-des-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-des, AfterValidation>
      * <TOTEM:END>
           .

      * ef-des's Validation
       ef-des-VALIDATION.
           PERFORM ef-des-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-des-AFTER-VALIDATION
           .

       ef-data-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-data, BeforeValidation>
      * <TOTEM:END>
           .

       ef-data-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-data, AfterValidation>
      * <TOTEM:END>
           .

      * ef-data's Validation
       ef-data-VALIDATION.
           PERFORM ef-data-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-data-AFTER-VALIDATION
           .

       ef-tipocli-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-tipocli, BeforeValidation>
      * <TOTEM:END>
           .

       ef-tipocli-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-tipocli, AfterValidation>
      * <TOTEM:END>
           .

      * ef-tipocli's Validation
       ef-tipocli-VALIDATION.
           PERFORM ef-tipocli-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-tipocli-AFTER-VALIDATION
           .

       ef-att-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-att, BeforeValidation>
      * <TOTEM:END>
           .

       ef-att-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-att, AfterValidation>
      * <TOTEM:END>
           .

      * ef-att's Validation
       ef-att-VALIDATION.
           PERFORM ef-att-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-att-AFTER-VALIDATION
           .

       ef-bosch-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-bosch, BeforeValidation>
      * <TOTEM:END>
           .

       ef-bosch-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-bosch, AfterValidation>
      * <TOTEM:END>
           .

      * ef-bosch's Validation
       ef-bosch-VALIDATION.
           PERFORM ef-bosch-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-bosch-AFTER-VALIDATION
           .

       ef-mafra-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-mafra, BeforeValidation>
      * <TOTEM:END>
           .

       ef-mafra-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-mafra, AfterValidation>
      * <TOTEM:END>
           .

      * ef-mafra's Validation
       ef-mafra-VALIDATION.
           PERFORM ef-mafra-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-mafra-AFTER-VALIDATION
           .

       ef-linea-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-linea, BeforeValidation>
      * <TOTEM:END>
           .

       ef-linea-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-linea, AfterValidation>
      * <TOTEM:END>
           .

      * ef-linea's Validation
       ef-linea-VALIDATION.
           PERFORM ef-linea-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-linea-AFTER-VALIDATION
           .

       ef-altro-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-altro, BeforeValidation>
      * <TOTEM:END>
           .

       ef-altro-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-altro, AfterValidation>
      * <TOTEM:END>
           .

      * ef-altro's Validation
       ef-altro-VALIDATION.
           PERFORM ef-altro-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-altro-AFTER-VALIDATION
           .

       ef-logo-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-logo, BeforeValidation>
      * <TOTEM:END>
           .

       ef-logo-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-logo, AfterValidation>
      * <TOTEM:END>
           .

      * ef-logo's Validation
       ef-logo-VALIDATION.
           PERFORM ef-logo-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-logo-AFTER-VALIDATION
           .

       ef-gruppo-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-gruppo, BeforeValidation>
      * <TOTEM:END>
           .

       ef-gruppo-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-gruppo, AfterValidation>
      * <TOTEM:END>
           .

      * ef-gruppo's Validation
       ef-gruppo-VALIDATION.
           PERFORM ef-gruppo-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-gruppo-AFTER-VALIDATION
           .

       ef-cli-rifer-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-cli-rifer, BeforeValidation>
      * <TOTEM:END>
           .

       ef-cli-rifer-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-cli-rifer, AfterValidation>
      * <TOTEM:END>
           .

      * ef-cli-rifer's Validation
       ef-cli-rifer-VALIDATION.
           PERFORM ef-cli-rifer-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-cli-rifer-AFTER-VALIDATION
           .

       ef-codice-G2-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-codice-G2, BeforeValidation>
      * <TOTEM:END>
           .

       ef-codice-G2-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-codice-G2, AfterValidation>
      * <TOTEM:END>
           .

      * ef-codice-G2's Validation
       ef-codice-G2-VALIDATION.
           PERFORM ef-codice-G2-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-codice-G2-AFTER-VALIDATION
           .


       Form1-Buf-To-Fld.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeBufToFld>
      * <TOTEM:END>
      * DB_Entry-Field : ef-codice
           MOVE ef-codice-BUF TO gdo-codice of tgrupgdo
      * DB_Entry-Field : ef-capo
           MOVE ef-capo-BUF TO gdo-capogruppo of tgrupgdo
      * DB_Entry-Field : ef-des
           MOVE ef-des-BUF TO gdo-intestazione of tgrupgdo
      * DB_Entry-Field : ef-data
           MOVE ef-data-BUF TO gdo-data-vigore of tgrupgdo
      * DB_Entry-Field : ef-tipocli
           MOVE ef-tipocli-BUF TO gdo-tipocli of tgrupgdo
      * DB_Entry-Field : ef-att
           MOVE ef-att-BUF TO gdo-attenzione of tgrupgdo
      * DB_Entry-Field : ef-bosch
           MOVE ef-bosch-BUF TO gdo-listino-bosch of tgrupgdo
      * DB_Entry-Field : ef-mafra
           MOVE ef-mafra-BUF TO gdo-listino-ma-fra of tgrupgdo
      * DB_Entry-Field : ef-linea
           MOVE ef-linea-BUF TO gdo-linea-ursus of tgrupgdo
      * DB_Entry-Field : ef-altro
           MOVE ef-altro-BUF TO gdo-altro of tgrupgdo
      * DB_Entry-Field : ef-logo
           MOVE ef-logo-BUF TO gdo-logo of tgrupgdo
      * DB_Entry-Field : ef-gruppo
           MOVE ef-gruppo-BUF TO gdo-gruppo-invio of tgrupgdo
      * DB_Entry-Field : ef-cli-rifer
           MOVE ef-cli-rifer-BUF TO gdo-cli-rifer of tgrupgdo
      * DB_Entry-Field : ef-codice-G2
           MOVE ef-codice-G2-BUF TO gdo-codice-G2 of tgrupgdo
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterBufToFld>
           move ef-data-buf to como-data.
           perform DATE-TO-FILE.
           move como-data to gdo-data-vigore of tgrupgdo .

           .
      * <TOTEM:END>
           .

       Form1-Fld-To-Buf.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeFldToBuf>
      * <TOTEM:END>
      * DB_Entry-Field : ef-codice
           MOVE gdo-codice of tgrupgdo TO ef-codice-BUF
      * DB_Entry-Field : ef-capo
           MOVE gdo-capogruppo of tgrupgdo TO ef-capo-BUF
      * DB_Entry-Field : ef-des
           MOVE gdo-intestazione of tgrupgdo TO ef-des-BUF
      * DB_Entry-Field : ef-data
           MOVE gdo-data-vigore of tgrupgdo TO ef-data-BUF
      * DB_Entry-Field : ef-tipocli
           MOVE gdo-tipocli of tgrupgdo TO ef-tipocli-BUF
      * DB_Entry-Field : ef-att
           MOVE gdo-attenzione of tgrupgdo TO ef-att-BUF
      * DB_Entry-Field : ef-bosch
           MOVE gdo-listino-bosch of tgrupgdo TO ef-bosch-BUF
      * DB_Entry-Field : ef-mafra
           MOVE gdo-listino-ma-fra of tgrupgdo TO ef-mafra-BUF
      * DB_Entry-Field : ef-linea
           MOVE gdo-linea-ursus of tgrupgdo TO ef-linea-BUF
      * DB_Entry-Field : ef-altro
           MOVE gdo-altro of tgrupgdo TO ef-altro-BUF
      * DB_Entry-Field : ef-logo
           MOVE gdo-logo of tgrupgdo TO ef-logo-BUF
      * DB_Entry-Field : ef-gruppo
           MOVE gdo-gruppo-invio of tgrupgdo TO ef-gruppo-BUF
      * DB_Entry-Field : ef-cli-rifer
           MOVE gdo-cli-rifer of tgrupgdo TO ef-cli-rifer-BUF
      * DB_Entry-Field : ef-codice-G2
           MOVE gdo-codice-G2 of tgrupgdo TO ef-codice-G2-BUF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterFldToBuf>
           perform VALORIZZA-OLD.
           perform ABILITAZIONI.
           move gdo-data-vigore of tgrupgdo to como-data.
           perform DATE-TO-SCREEN.
           move como-data to ef-data-buf.

           move gdo-capogruppo of tgrupgdo to gdo-codice of tgrupgdo1.
           read tgrupgdo1 no lock 
                invalid move spaces to gdo-intestazione of tgrupgdo1
           end-read.
           move gdo-intestazione of tgrupgdo1 to lab-capo-buf.

           move gdo-gruppo-invio of tgrupgdo to tgr-codice.
           read tgruppi no lock
                invalid move spaces to tgr-descrizione
           end-read.
           move tgr-descrizione to lab-gruppo-buf.  

           move gdo-tipocli of tgrupgdo to tcl-codice.
           read ttipocli no lock
                invalid move spaces to tcl-descrizione
           end-read.
           move tcl-descrizione to lab-tipocli-buf.

           set cli-tipo-C to true.
           move gdo-cli-rifer of tgrupgdo to cli-codice.
           read clienti no lock
                invalid move spaces to cli-ragsoc-1
           end-read.
           move cli-ragsoc-1 to lab-cli-rifer-buf.

           .
      * <TOTEM:END>
           .

       Form1-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform Form1-BUF-TO-FLD.
           move 0 to scelta.

           if gdo-capogruppo of tgrupgdo not = old-gdo-capogruppo
              and SiSalvato
              set NoSalvato to true
              |78-ID-ef-capo è l'ID del campo ef-capo
              move 78-ID-ef-capo to store-id 
           end-if


           if gdo-intestazione of tgrupgdo not = old-gdo-intestazione
              and SiSalvato
              set NoSalvato to true
              |78-ID-ef-des è l'ID del campo ef-des
              move 78-ID-ef-des to store-id 
           end-if


           if gdo-data-vigore of tgrupgdo not = old-gdo-data-vigore
              and SiSalvato
              set NoSalvato to true
              |78-ID-ef-data è l'ID del campo ef-data
              move 78-ID-ef-data to store-id 
           end-if


           if gdo-tipocli of tgrupgdo not = old-gdo-tipocli
              and SiSalvato
              set NoSalvato to true
              |78-ID-ef-tipocli è l'ID del campo ef-tipocli
              move 78-ID-ef-tipocli to store-id 
           end-if


           if gdo-attenzione of tgrupgdo not = old-gdo-attenzione
              and SiSalvato
              set NoSalvato to true
              |78-ID-ef-att è l'ID del campo ef-att
              move 78-ID-ef-att to store-id 
           end-if


           if gdo-listino-bosch of tgrupgdo not = old-gdo-listino-bosch
              and SiSalvato
              set NoSalvato to true
              |78-ID-ef-bosch è l'ID del campo ef-bosch
              move 78-ID-ef-bosch to store-id 
           end-if


           if gdo-listino-ma-fra of tgrupgdo not = 
           old-gdo-listino-ma-fra
              and SiSalvato
              set NoSalvato to true
              |78-ID-ef-mafra è l'ID del campo ef-mafra
              move 78-ID-ef-mafra to store-id 
           end-if


           if gdo-linea-ursus of tgrupgdo not = old-gdo-linea-ursus
              and SiSalvato
              set NoSalvato to true
              |78-ID-ef-linea è l'ID del campo ef-linea
              move 78-ID-ef-linea to store-id 
           end-if


           if gdo-altro of tgrupgdo not = old-gdo-altro
              and SiSalvato
              set NoSalvato to true
              |78-ID-ef-altro è l'ID del campo ef-altro
              move 78-ID-ef-altro to store-id 
           end-if


           if gdo-logo of tgrupgdo not = old-gdo-logo
              and SiSalvato
              set NoSalvato to true
              |78-ID-ef-logo è l'ID del campo ef-logo
              move 78-ID-ef-logo to store-id 
           end-if


           if gdo-gruppo-invio of tgrupgdo not = old-gdo-gruppo-invio
              and SiSalvato
              set NoSalvato to true
              |78-ID-ef-gruppo è l'ID del campo ef-gruppo
              move 78-ID-ef-gruppo to store-id 
           end-if


           if gdo-cli-rifer of tgrupgdo not = old-gdo-cli-rifer
              and SiSalvato
              set NoSalvato to true
              |78-ID-ef-cli-rifer è l'ID del campo ef-cli-rifer
              move 78-ID-ef-cli-rifer to store-id 
           end-if


           if gdo-codice-G2 of tgrupgdo not = old-gdo-codice-G2
              and SiSalvato
              set NoSalvato to true
              |78-ID-ef-codice-G2 è l'ID del campo ef-codice-G2
              move 78-ID-ef-codice-G2 to store-id 
           end-if

           .
       Form1-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM Form1-SHOW-MSG-ROUTINE
           .

       Form1-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM Form1-DISPLAY-MESSAGE
           .

       Form1-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       Form1-Save-Status.
           MOVE DataSet1-tgrupgdo-KEY1-ORDER TO TMP-Form1-KEY1-ORDER
           MOVE DataSet1-KEYIS TO TMP-Form1-KEYIS
           MOVE gdo-rec OF tgrupgdo TO 
              TMP-Form1-tgrupgdo-RESTOREBUF
           .             

       Form1-Restore-Status.
           MOVE TMP-Form1-KEY1-ORDER TO DataSet1-tgrupgdo-KEY1-ORDER
           MOVE TMP-Form1-KEYIS TO DataSet1-KEYIS
           MOVE TMP-Form1-tgrupgdo-RESTOREBUF TO
              gdo-rec OF tgrupgdo
           PERFORM DataSet1-tgrupgdo-START
           IF Valid-STATUS-tgrupgdo
              PERFORM DataSet1-tgrupgdo-Read-Next
           ELSE
              PERFORM DataSet1-tgrupgdo-INITREC
           END-IF
           PERFORM UNTIL NOT Valid-STATUS-tgrupgdo OR
              (Valid-STATUS-tgrupgdo AND
                 gdo-rec OF tgrupgdo = 
                   TMP-Form1-tgrupgdo-RESTOREBUF)
              PERFORM DataSet1-tgrupgdo-Read-Next
           END-PERFORM
           .


      * Paragrafo per la struttura del codice in BEFORE sulla screen Form1
      ***---
       Form1-BEFORE-SCREEN.
           evaluate control-id
           |78-ID-ef-capo è l'ID del campo ef-capo
           when 78-ID-ef-capo
                move 1 to StatusHelp
                perform STATUS-HELP
           |78-ID-ef-tipocli è l'ID del campo ef-tipocli
           when 78-ID-ef-tipocli
                move 1 to StatusHelp
                perform STATUS-HELP
           |78-ID-ef-gruppo è l'ID del campo ef-gruppo
           when 78-ID-ef-gruppo
                move 1 to StatusHelp
                perform STATUS-HELP
           |78-ID-ef-cli-rifer è l'ID del campo ef-cli-rifer
           when 78-ID-ef-cli-rifer
                move 1 to StatusHelp
                perform STATUS-HELP
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella BEFORE della screen
           when 99999 continue
           when other continue
           end-evaluate.

      * Generazione settaggio keyboard "." ---> ","

      * Paragrafo per la struttura del codice in AFTER sulla screen Form1
      ***---
       Form1-AFTER-SCREEN.
           evaluate control-id
           |78-ID-ef-capo è l'ID del campo ef-capo
           when 78-ID-ef-capo
                move 0 to StatusHelp
                perform STATUS-HELP

           |78-ID-ef-tipocli è l'ID del campo ef-tipocli
           when 78-ID-ef-tipocli
                move 0 to StatusHelp
                perform STATUS-HELP

           |78-ID-ef-gruppo è l'ID del campo ef-gruppo
           when 78-ID-ef-gruppo
                move 0 to StatusHelp
                perform STATUS-HELP

           |78-ID-ef-cli-rifer è l'ID del campo ef-cli-rifer
           when 78-ID-ef-cli-rifer
                move 0 to StatusHelp
                perform STATUS-HELP

           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER della screen
           when 99999 continue
           when other continue
           end-evaluate.

      * Generazione risettaggio keyboard "." ---> "."

      * Generazione stringa perform CONTROLLO
           evaluate control-id
           |78-ID-ef-codice è l'ID del campo ef-codice
           when 78-ID-ef-codice
                perform CONTROLLO
           |78-ID-ef-capo è l'ID del campo ef-capo
           when 78-ID-ef-capo
                perform CONTROLLO
           |78-ID-ef-data è l'ID del campo ef-data
           when 78-ID-ef-data
                perform CONTROLLO
           |78-ID-ef-tipocli è l'ID del campo ef-tipocli
           when 78-ID-ef-tipocli
                perform CONTROLLO
           |78-ID-ef-gruppo è l'ID del campo ef-gruppo
           when 78-ID-ef-gruppo
                perform CONTROLLO
           |78-ID-ef-cli-rifer è l'ID del campo ef-cli-rifer
           when 78-ID-ef-cli-rifer
                perform CONTROLLO
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER CONTROLLO della screen
           when 99999 continue
           when other continue
           end-evaluate.



       Form1-BeforeProcedure.
           EVALUATE Control-Id
           WHEN 5001 MOVE "Digitare il codice GDO" to TOTEM-HINT-TEXT
           WHEN 5002 MOVE "Digitare il codice GDO capogruppo (spaces = c
      -    "odice principale)" to TOTEM-HINT-TEXT
           WHEN 5003 MOVE "Digitare la descrizione" to TOTEM-HINT-TEXT
           WHEN 5004 MOVE "Digitare la data d'inizio vigore listino" to 
           TOTEM-HINT-TEXT
           WHEN 5005 MOVE "Digitare la data d'inizio vigore listino" to 
           TOTEM-HINT-TEXT
           WHEN 5006 MOVE "Digitare il riferimento a cui inviare" to 
           TOTEM-HINT-TEXT
           WHEN 5007 MOVE "Digitare la descrizione del listino Bosch col
      -    "legato" to TOTEM-HINT-TEXT
           WHEN 5008 MOVE "Digitare la descrizione del listino MA-FRA co
      -    "llegato" to TOTEM-HINT-TEXT
           WHEN 5009 MOVE "Digitare la descrizione della Linea Ursus col
      -    "legata" to TOTEM-HINT-TEXT
           WHEN 5010 MOVE "Digitare..." to TOTEM-HINT-TEXT
           WHEN 5011 MOVE "Digitare il precorso dell'immagine per il log
      -    "o" to TOTEM-HINT-TEXT
           WHEN 5012 MOVE "Digitare il gruppo d'invio" to 
           TOTEM-HINT-TEXT
           WHEN 5013 MOVE "Cliente di rferimento per stampa listini" to 
           TOTEM-HINT-TEXT
           WHEN 5014 MOVE "Digitare il gruppo d'invio" to 
           TOTEM-HINT-TEXT
           WHEN AUTO-ID MOVE "Selezione/visualizzazione immagine associa
      -    "ta" to TOTEM-HINT-TEXT
           WHEN OTHER MOVE SPACES TO TOTEM-HINT-TEXT
           END-EVALUATE
           EVALUATE Control-Id
           When 5001 PERFORM ef-codice-BeforeProcedure
           When 5002 PERFORM ef-capo-BeforeProcedure
           When 5003 PERFORM ef-des-BeforeProcedure
           When 5004 PERFORM ef-des-BeforeProcedure
           When 5005 PERFORM ef-des-BeforeProcedure
           When 5006 PERFORM ef-att-BeforeProcedure
           When 5007 PERFORM ef-bosch-BeforeProcedure
           When 5008 PERFORM ef-mafra-BeforeProcedure
           When 5009 PERFORM ef-linea-BeforeProcedure
           When 5010 PERFORM ef-altro-BeforeProcedure
           When 5011 PERFORM ef-logo-BeforeProcedure
           When 5012 PERFORM ef-gruppo-BeforeProcedure
           When 5013 PERFORM ef-cli-rifer-BeforeProcedure
           When 5014 PERFORM ef-gruppo-BeforeProcedure
           END-EVALUATE
           PERFORM Form1-DISPLAY-STATUS-MSG
           perform Form1-BEFORE-SCREEN
           .

       Form1-AfterProcedure.
           EVALUATE Control-Id
           When 5001 PERFORM ef-codice-AfterProcedure
           When 5002 PERFORM ef-capo-AfterProcedure
           When 5003 PERFORM ef-des-AfterProcedure
           When 5004 PERFORM ef-des-AfterProcedure
           When 5005 PERFORM ef-des-AfterProcedure
           When 5006 PERFORM ef-att-AfterProcedure
           When 5007 PERFORM ef-bosch-AfterProcedure
           When 5008 PERFORM ef-mafra-AfterProcedure
           When 5009 PERFORM ef-linea-AfterProcedure
           When 5010 PERFORM ef-altro-AfterProcedure
           When 5011 PERFORM ef-logo-AfterProcedure
           When 5012 PERFORM ef-gruppo-AfterProcedure
           When 5013 PERFORM ef-cli-rifer-AfterProcedure
           When 5014 PERFORM ef-gruppo-AfterProcedure
           END-EVALUATE
           perform Form1-AFTER-SCREEN
           .

       Form1-Event-Proc.
           .

      * USER DEFINE PARAGRAPH
       ABILITAZIONI.
      * <TOTEM:PARA. ABILITAZIONI>
           if mod = 1
              move BitmapDeleteEnabled to BitmapNumDelete
              move BitmapSaveEnabled   to BitmapNumSave
              move 1 to e-salva e-cancella           
           else
              move BitmapDeleteDisabled to BitmapNumDelete
              move BitmapSaveDisabled   to BitmapNumSave
              move ZERO to e-salva e-cancella
           end-if.            

      * ISACCO (CORREZIONE SU LIVELLO ABILITAZIONE 2) - 07/11/2003
      * (CANCELLAZIONE NON PERMESSA)
           if livello-abil = 2 
              move ZERO to e-cancella
              move BitmapDeleteDisabled to BitmapNumDelete
           end-if.
      * FINE

           modify tool-cancella, enabled = e-cancella.
           modify tool-salva,    enabled = e-salva.
       
      * ISACCO (SERVE SEMPRE PER LA MODIFICA PRCEDENTE E PER RIPRISTINARE
      * LE BITMAP DISABILITATE. - 10/11/2003
      *     perform FORM1-DISPLAY.
           display tool-nuovo, tool-salva, tool-cancella, tool-modifica.
      * FINE 
           .
      * <TOTEM:END>

       ANTEPRIMA.
      * <TOTEM:PARA. ANTEPRIMA>
           SET ANTEPRIMA     TO TRUE 
           .
      * <TOTEM:END>

       CANCELLA.
      * <TOTEM:PARA. CANCELLA>
           if mod = 0 exit paragraph  end-if.
      *    
           inquire ef-codice, value in gdo-codice of tgrupgdo .
           display message MSG-Cancellare-il-record-corrente
                     title titolo
                      type mb-yes-no 
                   default mb-no
                    giving scelta

           if scelta = mb-yes
              delete tgrupgdo record invalid continue end-delete
   
              move 0 to mod
              move 1 to mod-k
              perform FORM1-CLEAR

              set vecchio to true
              perform CANCELLA-COLORE
              perform INIT-OLD-REC
                            
              display message  MSG-Cancellazione-avvenuta-con-successo
                      title titolo                         

              unlock tgrupgdo all records     

              initialize G2Agg-linkage
              move gdo-codice of tgrupgdo to G2Agg-codice-gdo
              set  G2Agg-gdo    to true
              set  G2Agg-delete to true
              call   "G2Agg" using G2Agg-linkage
              cancel "G2Agg"

              perform PRIMO
              move 1 to CONTROL-ID     
              move 4 to ACCEPT-CONTROL 
              set Statusvisua to true
              perform STATUS-BAR-MSG
              modify TOOL-MODIFICA value = mod
           end-if 
           .
      * <TOTEM:END>

       CERCA.
      * <TOTEM:PARA. CERCA>
           evaluate control-id
           when 78-ID-ef-capo
                move "tgrupgdo"  to como-file         
                inquire ef-capo, value in gdo-codice of tgrupgdo1
                call "zoom-gt"  using como-file, gdo-rec of tgrupgdo1
                                giving stato-zoom
                end-call
                cancel "zoom-gt"
                if stato-zoom = 0
                   move gdo-codice       of tgrupgdo1 to ef-capo-buf
                   move gdo-intestazione of tgrupgdo1 to lab-capo-buf
                   display ef-capo lab-capo
                end-if

           when 78-ID-ef-tipocli
                move "ttipocli-GDO"  to como-file         
                inquire ef-tipocli, value in tcl-codice
                set tcl-gdo-si to true
                call "zoom-gt"  using como-file, tcl-rec
                                giving stato-zoom
                end-call
                cancel "zoom-gt"
                if stato-zoom = 0
                   move tcl-codice      to ef-tipocli-buf
                   move tcl-descrizione to lab-tipocli-buf
                   display ef-tipocli lab-tipocli
                end-if  
                
           when 78-ID-ef-gruppo     
                inquire ef-gruppo, value in tgr-codice

                move "tgruppi"       to como-file
                call   "zoom-gt"  using como-file, tgr-rec of tgruppi
                                 giving stato-zoom
                cancel "zoom-gt"

                if stato-zoom = 0
                   move tgr-codice      to ef-gruppo-buf
                   move tgr-descrizione to lab-gruppo-buf
                   display ef-gruppo lab-gruppo
                end-if
                
           when 78-ID-ef-cli-rifer     
                inquire ef-cli-rifer, value in cli-codice
                set cli-tipo-C to true

                move "clienti-alfa"  to como-file
                call   "zoom-gt"  using como-file, cli-rec
                                 giving stato-zoom
                cancel "zoom-gt"

                if stato-zoom = 0
                   move cli-codice   to ef-cli-rifer-buf
                   move cli-ragsoc-1 to lab-cli-rifer-buf
                   display ef-cli-rifer lab-cli-rifer
                end-if

           end-evaluate 
           .
      * <TOTEM:END>

       CLEAR-SCREEN.
      * <TOTEM:PARA. CLEAR-SCREEN>
           move gdo-chiave  of tgrupgdo to old-gdo-chiave.

           initialize gdo-dati  of tgrupgdo 
                      replacing numeric data by zeroes
                           alphanumeric data by spaces.

           perform FORM1-FLD-TO-BUF. 

           perform INIT-OLD-REC.

           display form1.     
  
           unlock tgrupgdo all records 
           .
      * <TOTEM:END>

       CHECK-INSERIMENTO.
      * <TOTEM:PARA. CHECK-INSERIMENTO>
      * MODIFICA LA STATUS-BAR
      * CONTROLLO SE DA INSERIMENTO SCORRO. ALLORA DEVO SEGNALARE CHE
      * SONO TORNATO IN MODIFICA.
           inquire tool-modifica, value in mod.

           evaluate mod
           when 1
                set StatusModifica to true
           when ZERO
                set StatusVisua to true   
           end-evaluate.
      
           perform STATUS-BAR-MSG 
           .
      * <TOTEM:END>

       CONTROLLO.
      * <TOTEM:PARA. CONTROLLO>
           set tutto-ok to true.

      * Paragrafo per la struttura dei controlli sulla screen Form1
           evaluate control-id
           |78-ID-ef-codice è l'ID del control ef-codice
           when 78-ID-ef-codice
                inquire ef-codice, value in gdo-codice of tgrupgdo
                if gdo-codice  of tgrupgdo = spaces
                   set errori to true
                   display message "Inserimento codice mancante"
                             title tit-err
                              icon 2
                else
                   read tgrupgdo no lock
                        invalid 
                        if vecchio
                           display message MSG-record-inesistente
                                     title tit-err
                                      icon 2
                           perform CLEAR-SCREEN
                           set errori to true
                           move 78-ID-ef-codice to control-id
                        end-if
                    not invalid
                        if old-gdo-chiave not = gdo-chiave of tgrupgdo
                           perform CURRENT-RECORD 
                           set errori to true  
                           move 78-ID-ef-codice to control-id
                        end-if
                   end-read
                end-if

           when 78-ID-ef-capo
                inquire ef-capo, value in gdo-codice of tgrupgdo1
                if gdo-codice of tgrupgdo1 = spaces
                   move ef-codice-buf to ef-capo-buf gdo-codice of 
           tgrupgdo1
                   display ef-capo
                   move spaces to lab-capo-buf
                end-if
                read tgrupgdo1 no lock
                     invalid
                     if vecchio    or
                        gdo-codice of tgrupgdo not =
                        gdo-codice of tgrupgdo1
                        set errori to true
                        display message "Codice Capofila errato"
                                  title tit-err
                                   icon 2
                        move spaces to lab-capo-buf
                     end-if
                 not invalid
                     move gdo-intestazione of tgrupgdo1 to lab-capo-buf
                end-read
                display lab-capo

           when 78-ID-ef-data
                inquire ef-data, value in ef-data-buf
                move ef-data-buf to como-data
                if como-data not = 0
                   perform DATE-FORMAT
                   move como-data to ef-data-buf
                   display ef-data
                end-if             

           when 78-ID-ef-tipocli
                inquire ef-tipocli, value in tcl-codice
                read ttipocli no lock
                     invalid 
                     set errori to true
                     display message "Tipologia Cliente errato"
                               title tit-err
                                icon 2
                     move spaces to lab-tipocli-buf
      *****           not invalid
      *****               if tcl-gdo-no
      *****                  set errori to true
      *****                  display message "Tipologia Cliente NON valido"
      *****                            title tit-err
      *****                             icon 2
      *****                  move spaces to lab-tipocli-buf
      *****               end-if
                end-read
                move tcl-descrizione to lab-tipocli-buf
                display lab-tipocli

           when 78-ID-ef-gruppo          
                move spaces to tgr-descrizione
                inquire ef-gruppo, value in ef-gruppo-buf
                move ef-gruppo-buf to tgr-codice
                if tgr-codice not = 0
                   read tgruppi no lock
                        invalid 
                        set errori to true
                        display message "Tipologia Cliente errato"
                                  title tit-err
                                   icon 2  
                   end-read
                end-if
                move tgr-descrizione to lab-gruppo-buf
                display lab-gruppo 

           when 78-ID-ef-cli-rifer
                move spaces to cli-ragsoc-1
                inquire ef-cli-rifer, value in ef-cli-rifer-buf
                set cli-tipo-C to true
                move ef-cli-rifer-buf to cli-codice
                read clienti no lock
                     invalid continue
      *****               set errori to true
      *****               display message "Cliente non valido"
      *****                         title tit-err
      *****                          icon 2
                 not invalid
                     if cli-gdo not = ef-codice-buf
                        set errori to true
                        display message "Gruppo GDO cliente " cli-gdo " 
      -    "non  valido"
                                  title tit-err
                                   icon 2
                     end-if
                end-read
                move cli-ragsoc-1 to lab-cli-rifer-buf
                display lab-cli-rifer

      *****     when 78-ID-ef-codice-G2
      *****          if ef-codice-G2-buf = spaces
      *****             display message "Codice G2 obbligatorio"
      *****                       title tit-err
      *****                        icon 2
      *****          end-if

           end-evaluate.

           if errori
              move control-id to store-id
              perform CANCELLA-COLORE
              move 4        to ACCEPT-CONTROL
           end-if 
           .
      * <TOTEM:END>

       CURRENT-RECORD.
      * <TOTEM:PARA. CURRENT-RECORD>
           inquire ef-codice, value in gdo-codice of tgrupgdo.
           set tutto-ok  to true.
           set ReadSecca to true.
           if nuovo move 0 to mod end-if.

           if mod = 1
              read tgrupgdo lock invalid 
                 set errori to true 
              end-read
           else
              read tgrupgdo no lock invalid 
                 set errori to true 
              end-read
           end-if.                    
           set ReadSecca to false.

           if RecLocked
              set RecLocked to false
           else
              if tutto-ok    
                 if nuovo
                    move 0 to mod
                    move 1 to mod-k
                    move 1 to CONTROL-ID
                    move 4 to ACCEPT-CONTROL
                 end-if   
                 perform FORM1-IUD-DISPLAY
                 set vecchio to true
                 if mod = 1
                    set StatusModifica to true
                 else                         
                    set StatusVisua    to true
                 end-if
                 perform STATUS-BAR-MSG
              else
                 move 0 to mod
                 move 1 to mod-k
                 if vecchio
                    perform CLEAR-SCREEN
                    if YesMessage
                       move 78-ID-ef-codice to CONTROL-ID
                       move 4               to ACCEPT-CONTROL
                       display message MSG-Record-inesistente
                                 title tit-err
                                  icon mb-warning-icon
                    end-if
                 end-if
              end-if
           end-if 
           .
      * <TOTEM:END>

       INIT-OLD-REC.
      * <TOTEM:PARA. INIT-OLD-REC>
           initialize old-gdo-rec  replacing numeric data by zeroes
                                        alphanumeric data by spaces 
           .
      * <TOTEM:END>

       MODIFICA.
      * <TOTEM:PARA. MODIFICA>
           move 5 to key-status.
           inquire tool-modifica, value in mod.
           set tutto-ok to true.

           if nuovo
              move 1 to mod                  
              modify tool-modifica, value mod
           else
      *  SE L'UTENTE E' ABILITATO PUO' MODIFICARE UN RECORD
              if mod = 1
                 set YesMessage to true
                 perform CURRENT-RECORD
                 if tutto-ok
                    move 0 to mod-k
                    move 1 to mod
                    set StatusModifica to true
                    perform STATUS-BAR-MSG
                 end-if
              else
                 move 1 to mod
                 perform SALV-MOD            
                 move 0 to mod
                 move 1 to mod-k
                 if errori
                    move 1 to mod
                    move 0 to mod-k
                 else
                    move 78-ID-ef-codice to CONTROL-ID
                    set  NoMessage       to true
                    perform CURRENT-RECORD
                    set StatusVisua to true
                    perform STATUS-BAR-MSG 
                    unlock tgrupgdo all records

                 end-if
              end-if
                               
              display form1
              modify tool-modifica,  value mod
              perform CANCELLA-COLORE
              move 4    to ACCEPT-CONTROL
              move ZERO to StatusHelp
              perform STATUS-HELP
           end-if 
           .
      * <TOTEM:END>

       NUOVO.
      * <TOTEM:PARA. NUOVO>
           perform SALV-MOD.

           if tutto-ok 
      *****        |SPECIFICO PER I PGM. AVENTI TAB-CONTROL
      *****        move 1 to Screen1-Ta-1-TAB-VALUE
      *****        perform SCREEN1-TA-1-TABCHANGE
              |******          
              move 78-ID-ef-codice to CONTROL-ID
              move 4               to ACCEPT-CONTROL 
              move 1 to mod mod-k
              modify tool-modifica,  value = mod
              perform CANCELLA-COLORE

              move 1 to mod, mod-k

              perform FORM1-CLEAR

              Perform VALORIZZA-NUOVO                                   
                                                
              perform INIT-OLD-REC

      *        perform DISPLAY-SCREEN
              display form1

      * IL FLAG SICCOME E' ANCORA SETTATO A VECCHIO DALLA PRECEDENTE
      * OPERAZIONE, VIENE RISETTATO A NUOVO
      * (STANDARD NORMALE)
              set nuovo to true
              set StatusIns to true
              perform STATUS-BAR-MSG  
              unlock tgrupgdo all records
           end-if 
           .
      * <TOTEM:END>

       PARAGRAFO-COPY.
      * <TOTEM:PARA. PARAGRAFO-COPY>
           copy "abilita-toolbar.cpy".
           copy "color-custom.cpy".
           copy "status.cpy".
           copy "utydata.cpy" 
           .
      * <TOTEM:END>

       PRECEDENTE.
      * <TOTEM:PARA. PRECEDENTE>
           perform SALV-MOD.           
           if tutto-ok
              perform CHECK-INSERIMENTO
              unlock tgrupgdo all records

              if mod = 1
                 move ZERO to mod-k
                 set dataset1-tgrupgdo-lock to true
              else              
                 move 1    to mod-k     
                 initialize dataset1-tgrupgdo-lock-flag
              end-if

              perform CANCELLA-COLORE
              perform FORM1-PREVIOUS

              if RecLocked
                 set RecLocked to false             
                 initialize dataset1-tgrupgdo-lock-flag
                 move 1 to mod-k
                 perform FORM1-PREVIOUS
              end-if
           end-if 
           .
      * <TOTEM:END>

       PRIMO.
      * <TOTEM:PARA. PRIMO>
           perform SALV-MOD.           
           if tutto-ok     
              perform CHECK-INSERIMENTO
              unlock tgrupgdo  all records

              if mod = 1
                 move ZERO to mod-k
                 set dataset1-tgrupgdo-lock to true
              else              
                 move 1 to mod-k     
                 initialize dataset1-tgrupgdo-lock-flag
              end-if

              perform CANCELLA-COLORE
              perform FORM1-FIRST

              if RecLocked
                 set RecLocked to false             
                 initialize dataset1-tgrupgdo-lock-flag
                 move 1 to mod-k
                 perform FORM1-FIRST
              end-if
           end-if 
           .
      * <TOTEM:END>

       SALVA.
      * <TOTEM:PARA. SALVA>
           if mod = 0 exit paragraph end-if.

           set tutto-ok to true.
                                 
           move control-id to mem-id.
           perform  varying CONTROL-ID from 78-ID-ef-codice by 1
                      until CONTROL-ID > 78-ID-ef-codice-G2
              perform CONTROLLO
              if errori exit perform end-if
           end-perform.

           if errori
              perform CANCELLA-COLORE
              perform ABILITAZIONI
              move store-id to control-id
              move 4 to ACCEPT-CONTROL
           else    
              perform FORM1-BUF-TO-FLD

              perform CANCELLA-COLORE
                                                   
              accept como-data from century-date
              accept como-ora  from time
              if nuovo
                 move como-data to gdo-data-creazione   of tgrupgdo 
                 move como-ora  to gdo-ora-creazione    of tgrupgdo 
                 move user-codi to gdo-utente-creazione of tgrupgdo 

                 move high-value to gdo-chiave    of tgrupgdo1
                 move high-value to gdo-codice-G2 of tgrupgdo1
                 start tgrupgdo1 key <= gdo-k-g2 of tgrupgdo1
                       invalid 
                       move "A00" to gdo-codice-G2 of tgrupgdo
                   not invalid
                       read tgrupgdo1 previous           
                       move gdo-codice-g2 of tgrupgdo1(1:1) to lettera
                       move gdo-codice-g2 of tgrupgdo1(2:2) to num
                       if num = 99
                          move 0 to num
                          perform VALORIZZA-LETTERA
                       else
                          add 1 to num
                       end-if
                       move lettera  to gdo-codice-g2 of tgrupgdo(1:1)
                       move num(2:2) to gdo-codice-g2 of tgrupgdo(2:2)
                 end-start
                 move gdo-codice-g2 of tgrupgdo to ef-codice-g2-buf
                 display ef-codice-g2         
              else
                 move como-data to gdo-data-modifica   of tgrupgdo 
                 move como-ora  to gdo-ora-modifica    of tgrupgdo 
                 move user-codi to gdo-utente-modifica of tgrupgdo 
              end-if

              write gdo-rec of tgrupgdo invalid 
                    rewrite gdo-rec of tgrupgdo 
              end-write
                                      
              initialize G2Agg-linkage
              set G2Agg-gdo   to true 
              move gdo-codice of tgrupgdo to G2Agg-codice-gdo
              if nuovo set G2Agg-insert to true
              else     set G2Agg-update to true
              end-if
              call   "G2Agg" using G2Agg-linkage
              cancel "G2Agg"                                   

              move low-value to cli-rec
              set cli-tipo-C to true
              move gdo-codice of tgrupgdo to cli-gdo
              start clienti key >= cli-k3
                    invalid continue
                not invalid
                    perform until 1 = 2
                       read clienti next at end exit perform end-read
                       if cli-tipo-F exit perform end-if
                       if cli-gdo = gdo-codice of tgrupgdo
                          initialize G2Agg-linkage
                          set G2Agg-cli   to true 
                          move cli-codice to G2Agg-codice
                          set G2Agg-update to true
                          call   "G2Agg" using G2Agg-linkage
                          cancel "G2Agg"
                       end-if                             
                    end-perform
              end-start 

              set vecchio to true       
              perform TORNA-IN-VISUA
           end-if.   
                 
           display form1.     

      ***---
       VALORIZZA-LETTERA.
           evaluate lettera            
           when "A" move "B" to lettera
           when "B" move "C" to lettera
           when "C" move "D" to lettera
           when "D" move "E" to lettera
           when "E" move "F" to lettera
           when "F" move "G" to lettera
           when "G" move "H" to lettera
           when "H" move "I" to lettera
           when "I" move "J" to lettera
           when "J" move "K" to lettera
           when "K" move "L" to lettera
           when "L" move "M" to lettera
           when "M" move "N" to lettera
           when "N" move "O" to lettera
           when "O" move "P" to lettera
           when "P" move "Q" to lettera
           when "Q" move "R" to lettera
           when "R" move "S" to lettera
           when "S" move "T" to lettera
           when "T" move "U" to lettera
           when "U" move "V" to lettera
           when "V" move "W" to lettera
           when "W" move "X" to lettera
           when "X" move "Y" to lettera
           when "Y" move "Z" to lettera
           when "Z" move "a" to lettera            
           when "a" move "B" to lettera
           when "b" move "c" to lettera
           when "C" move "d" to lettera
           when "d" move "e" to lettera
           when "e" move "f" to lettera
           when "f" move "g" to lettera
           when "g" move "h" to lettera
           when "H" move "i" to lettera
           when "i" move "j" to lettera
           when "j" move "k" to lettera
           when "k" move "l" to lettera
           when "l" move "m" to lettera
           when "m" move "n" to lettera
           when "n" move "o" to lettera
           when "o" move "p" to lettera
           when "p" move "q" to lettera
           when "q" move "r" to lettera
           when "r" move "s" to lettera
           when "s" move "t" to lettera
           when "t" move "u" to lettera
           when "u" move "v" to lettera
           when "v" move "w" to lettera
           when "w" move "x" to lettera
           when "x" move "y" to lettera
           when "y" move "z" to lettera
           when "z" move " " to lettera
           end-evaluate 
           .
      * <TOTEM:END>

       SALV-MOD.
      * <TOTEM:PARA. SALV-MOD>
           set tutto-ok to true.
           perform FORM1-CONTROLLO-OLD.

           if NoSalvato
              display message box MSG-Salvare-le-modifiche
                            title titolo
                            type mb-yes-no-cancel 
                            giving scelta       
       
              evaluate scelta
              when mb-yes 
                   perform SALVA
              when mb-no  
                   continue
              when other
                   modify control-handle, color = colore-or
                   set errori to true
                   move store-id   to CONTROL-ID    
                   move 4          to ACCEPT-CONTROL
              end-evaluate
           end-if 
           .
      * <TOTEM:END>

       SELEZIONA.
      * <TOTEM:PARA. SELEZIONA>
           inquire ef-codice, value in gdo-codice of tgrupgdo.

           move "tgrupgdo"      to como-file.
           call   "zoom-gt"  using como-file, gdo-rec of tgrupgdo
                            giving stato-zoom.
           cancel "zoom-gt".

           if stato-zoom = 0
              if old-gdo-chiave not = gdo-chiave of tgrupgdo
                 move gdo-chiave  of tgrupgdo to save-key
                 perform SALV-MOD
                 if tutto-ok
                    move save-key   to gdo-chiave of tgrupgdo
                    move gdo-codice of tgrupgdo   to ef-codice-buf
                    display ef-codice
                    set ReadSecca      to true
                    perform CURRENT-RECORD
                    perform CANCELLA-COLORE
                    move 78-ID-ef-codice to CONTROL-ID
                    move 4               to ACCEPT-CONTROL
                 end-if
              end-if
           end-if 
           .
      * <TOTEM:END>

       STAMPA.
      * <TOTEM:PARA. STAMPA>
           SET STAMPA     TO TRUE 
           .
      * <TOTEM:END>

       TORNA-IN-VISUA.
      * <TOTEM:PARA. TORNA-IN-VISUA>
           move 0 to mod.
           move 1 to mod-k.
           move 78-ID-ef-codice to CONTROL-ID.
           set NoMessage        to true.
           perform ABILITAZIONI.
           set StatusVisua to true.
           perform STATUS-BAR-MSG.
           unlock tgrupgdo all records.
                        
           modify tool-modifica,  value mod.
           perform CANCELLA-COLORE.
           move 4 to ACCEPT-CONTROL 
           .
      * <TOTEM:END>

       SUCCESSIVO.
      * <TOTEM:PARA. SUCCESSIVO>
           perform SALV-MOD.           
           if tutto-ok          
              perform CHECK-INSERIMENTO
              unlock tgrupgdo all records

              if mod = 1
                 move ZERO to mod-k
                 set dataset1-tgrupgdo-lock to true
              else              
                 move 1    to mod-k     
                 initialize dataset1-tgrupgdo-lock-flag
              end-if

              perform CANCELLA-COLORE
              perform FORM1-NEXT

              if RecLocked
                 set RecLocked to false             
                 initialize dataset1-tgrupgdo-lock-flag
                 move 1 to mod-k
                 perform FORM1-NEXT
              end-if
           end-if 
           .
      * <TOTEM:END>

       ULTIMO.
      * <TOTEM:PARA. ULTIMO>
           perform SALV-MOD.
           if tutto-ok
              perform CHECK-INSERIMENTO
              unlock tgrupgdo all records 

              if mod = 1
                 move ZERO to mod-k
                 set dataset1-tgrupgdo-lock to true
              else              
                 move 1    to mod-k     
                 initialize dataset1-tgrupgdo-lock-flag
              end-if

              perform CANCELLA-COLORE
              perform FORM1-LAST 

              if RecLocked
                 set RecLocked to false             
                 initialize dataset1-tgrupgdo-lock-flag
                 move 1 to mod-k
                 perform FORM1-LAST
              end-if
           end-if 
           .
      * <TOTEM:END>

       VALORIZZA-NUOVO.
      * <TOTEM:PARA. VALORIZZA-NUOVO>
           move "00" to status-tgrupgdo.
      
           initialize gdo-dati  of tgrupgdo 
                      replacing numeric data by zeroes
                           alphanumeric data by spaces 
           .
      * <TOTEM:END>

       VALORIZZA-OLD.
      * <TOTEM:PARA. VALORIZZA-OLD>
           move gdo-rec  of tgrupgdo to old-gdo-rec.

           set vecchio to true.

           move 0 to StatusHelp.

           perform STATUS-HELP 
           .
      * <TOTEM:END>

      * EVENT PARAGRAPH
       anagr01-Ev-After-Program.
      * <TOTEM:PARA. anagr01-Ev-After-Program>
           SET LK-BL-CANCELLAZIONE TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM 
           .
      * <TOTEM:END>
       anagr01-Ev-Before-Program.
      * <TOTEM:PARA. anagr01-Ev-Before-Program>
           move LK-BL-PROG-ID    TO COMO-PROG-ID 
           .
      * <TOTEM:END>
       NUOVO-LinkTo.
      * <TOTEM:PARA. NUOVO-LinkTo>
           INQUIRE TOOL-NUOVO, ENABLED IN E-NUOVO.

           IF E-NUOVO = 1
              PERFORM NUOVO
           END-IF                    
           .
      * <TOTEM:END>
       CANCELLA-LinkTo.
      * <TOTEM:PARA. CANCELLA-LinkTo>
           INQUIRE TOOL-MODIFICA, VALUE IN MOD.
                              
           INQUIRE TOOL-CANCELLA, ENABLED IN E-CANCELLA
           IF E-CANCELLA = 1
              PERFORM CANCELLA
           END-IF                                                
           .
      * <TOTEM:END>
       TOOL-SALVA-LinkTo.
      * <TOTEM:PARA. TOOL-SALVA-LinkTo>
           INQUIRE TOOL-MODIFICA, VALUE IN MOD           

           INQUIRE TOOL-SALVA, ENABLED IN E-SALVA
           IF E-SALVA = 1
              PERFORM SALVA
           END-IF           
           .
      * <TOTEM:END>
       ANTEPRIMA-LinkTo.
      * <TOTEM:PARA. ANTEPRIMA-LinkTo>
           INQUIRE TOOL-ANTEPRIMA, ENABLED IN E-ANTEPRIMA.
           IF E-ANTEPRIMA = 1
                PERFORM ANTEPRIMA
           END-IF 
           .
      * <TOTEM:END>
       TOOL-MODIFICA-LinkTo.
      * <TOTEM:PARA. TOOL-MODIFICA-LinkTo>
           INQUIRE TOOL-MODIFICA, ENABLED IN E-MODIFICA.

           IF E-MODIFICA = 1
              PERFORM MODIFICA
           END-IF 
           .
      * <TOTEM:END>
       STAMPA-LinkTo.
      * <TOTEM:PARA. STAMPA-LinkTo>
           INQUIRE TOOL-STAMPA, ENABLED IN E-STAMPA

           IF E-STAMPA = 1
                PERFORM STAMPA
           END-IF 
           .
      * <TOTEM:END>
       TOOL-PRIMO.
      * <TOTEM:PARA. TOOL-PRIMO>
           PERFORM PRIMO 
           .
      * <TOTEM:END>
       TOOL-PRECEDENTE.
      * <TOTEM:PARA. TOOL-PRECEDENTE>
           if nuovo             
              perform PRIMO
           else
              perform PRECEDENTE
           end-if 
           .
      * <TOTEM:END>
       TOOL-SUCCESSIVO.
      * <TOTEM:PARA. TOOL-SUCCESSIVO>
           if nuovo             
              perform ULTIMO
           else
              perform SUCCESSIVO
           end-if 
           .
      * <TOTEM:END>
       TOOL-ULTIMO.
      * <TOTEM:PARA. TOOL-ULTIMO>
           PERFORM ULTIMO 
           .
      * <TOTEM:END>
       TOOL-SELEZIONA-LinkTo.
      * <TOTEM:PARA. TOOL-SELEZIONA-LinkTo>
           inquire tool-seleziona, enabled in e-seleziona

           if e-seleziona = 1
              perform SELEZIONA
           end-if 
           .
      * <TOTEM:END>
       TOOL-MODIFICA-BeforeProcedure.
      * <TOTEM:PARA. TOOL-MODIFICA-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       TOOL-MODIFICA-AfterProcedure.
      * <TOTEM:PARA. TOOL-MODIFICA-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       pb-foto-LinkTo.
      * <TOTEM:PARA. pb-foto-LinkTo>
           inquire ef-logo, value in LinkImage.
           move mod to LinkAbil.
           call   "browser" using LinkBrowser.
           cancel "browser".
           move LinkImage to ef-logo-buf.
           display ef-logo 
           .
      * <TOTEM:END>
       ef-codice-BeforeProcedure.
      * <TOTEM:PARA. ef-codice-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-des-BeforeProcedure.
      * <TOTEM:PARA. ef-des-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-att-BeforeProcedure.
      * <TOTEM:PARA. ef-att-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-bosch-BeforeProcedure.
      * <TOTEM:PARA. ef-bosch-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-mafra-BeforeProcedure.
      * <TOTEM:PARA. ef-mafra-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-linea-BeforeProcedure.
      * <TOTEM:PARA. ef-linea-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-altro-BeforeProcedure.
      * <TOTEM:PARA. ef-altro-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-logo-BeforeProcedure.
      * <TOTEM:PARA. ef-logo-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-codice-AfterProcedure.
      * <TOTEM:PARA. ef-codice-AfterProcedure>
              INQUIRE ef-codice, VALUE IN gdo-codice of tgrupgdo
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-codice-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-des-AfterProcedure.
      * <TOTEM:PARA. ef-des-AfterProcedure>
              INQUIRE ef-des, VALUE IN gdo-intestazione of tgrupgdo
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-des-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
              INQUIRE ef-data, VALUE IN gdo-data-vigore of tgrupgdo
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-data-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
              INQUIRE ef-tipocli, VALUE IN gdo-tipocli of tgrupgdo
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-tipocli-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-att-AfterProcedure.
      * <TOTEM:PARA. ef-att-AfterProcedure>
              INQUIRE ef-att, VALUE IN gdo-attenzione of tgrupgdo
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-att-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-bosch-AfterProcedure.
      * <TOTEM:PARA. ef-bosch-AfterProcedure>
              INQUIRE ef-bosch, VALUE IN gdo-listino-bosch of tgrupgdo
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-bosch-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-mafra-AfterProcedure.
      * <TOTEM:PARA. ef-mafra-AfterProcedure>
              INQUIRE ef-mafra, VALUE IN gdo-listino-ma-fra of tgrupgdo
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-mafra-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-linea-AfterProcedure.
      * <TOTEM:PARA. ef-linea-AfterProcedure>
              INQUIRE ef-linea, VALUE IN gdo-linea-ursus of tgrupgdo
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-linea-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-altro-AfterProcedure.
      * <TOTEM:PARA. ef-altro-AfterProcedure>
              INQUIRE ef-altro, VALUE IN gdo-altro of tgrupgdo
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-altro-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-logo-AfterProcedure.
      * <TOTEM:PARA. ef-logo-AfterProcedure>
              INQUIRE ef-logo, VALUE IN gdo-logo of tgrupgdo
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-logo-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-capo-BeforeProcedure.
      * <TOTEM:PARA. ef-capo-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-capo-AfterProcedure.
      * <TOTEM:PARA. ef-capo-AfterProcedure>
              INQUIRE ef-capo, VALUE IN gdo-capogruppo of tgrupgdo
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-capo-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       TOOL-CERCA-LinkTo.
      * <TOTEM:PARA. TOOL-CERCA-LinkTo>
           inquire tool-cerca, enabled in e-cerca.
           if e-cerca = 1 perform CERCA end-if 
           .
      * <TOTEM:END>
       pb-finanz-BeforeProcedure.
      * <TOTEM:PARA. pb-finanz-BeforeProcedure>
           modify pb-finanz, bitmap-number = 2 
           .
      * <TOTEM:END>
       pb-finanz-AfterProcedure.
      * <TOTEM:PARA. pb-finanz-AfterProcedure>
           modify pb-finanz, bitmap-number = 1 
           .
      * <TOTEM:END>
       pb-finanz-LinkTo.
      * <TOTEM:PARA. pb-finanz-LinkTo>
           if vecchio
              initialize calfido-linkage 
                         sitfin-linkage replacing numeric data by zeroes
                                             alphanumeric data by spaces
              move ef-codice-buf   to link-cli-codice
              call   "sitfin"  using sitfin-linkage
                                    calfido-linkage
              cancel "sitfin"
           end-if 
           .
      * <TOTEM:END>
       ef-gruppo-BeforeProcedure.
      * <TOTEM:PARA. ef-gruppo-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-gruppo-AfterProcedure.
      * <TOTEM:PARA. ef-gruppo-AfterProcedure>
              INQUIRE ef-gruppo, VALUE IN gdo-gruppo-invio of tgrupgdo
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-gruppo-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
              INQUIRE ef-codice-G2, VALUE IN gdo-codice-G2 of tgrupgdo
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-codice-G2-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-cli-rifer-BeforeProcedure.
      * <TOTEM:PARA. ef-cli-rifer-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-cli-rifer-AfterProcedure.
      * <TOTEM:PARA. ef-cli-rifer-AfterProcedure>
              INQUIRE ef-cli-rifer, VALUE IN gdo-cli-rifer of tgrupgdo
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-cli-rifer-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>


      *{TOTEM}END

      *{TOTEM}SHOW-MSG
       MESSAGE-FOR-FILEERROR.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
              MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           .

       SHOW-TRANSACTION-ROUTINE.
           IF TOTEM-TRANSACTION-FLAG = SPACES
              IF TRANSACTION-STATUS NOT = 0
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-1
              END-IF
           ELSE
              PERFORM SHOW-MSG-ROUTINE
              IF TRANSACTION-STATUS = 0
                 MOVE "Transazione terminata con Rollback." TO 
           TOTEM-MSG-3
              ELSE
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-3
              END-IF
           END-IF
           .

       SHOW-MSG-ROUTINE.
           MOVE SPACE TO TOTEM-MSG-1 TOTEM-MSG-2 TOTEM-MSG-3
           EVALUATE TOTEM-MSG-ID
               WHEN "10"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Nessun altro dato." TO TOTEM-MSG-2
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "22"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Chiave Duplicata." TO TOTEM-MSG-2
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "23"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Raggiunta fine file." TO TOTEM-MSG-2
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "101"
                    MOVE "Terminare l'applicazione?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "201"
                    MOVE "Aggiungere un nuovo record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "202"
                    MOVE "Aggiornare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "203"
                    MOVE "Cancellare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "204"
                    MOVE "Chiave duplicata." TO TOTEM-MSG-1
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "301"
                    MOVE "Inserimento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "302"
                    MOVE "Aggiornamento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "303"
                    MOVE "Cancellazione avvenuta con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "401"
                    MOVE "Shell non trovata." TO TOTEM-MSG-1
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN OTHER
                    MOVE TEXT-MESSAGE TO TOTEM-MSG-1
                    STRING "FILE:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-3
                    MOVE 0 TO TOTEM-IDX1
                    INSPECT TOTEM-MSG-3 TALLYING TOTEM-IDX1
                       FOR TRAILING SPACE
                    STRING TOTEM-MSG-3(1:TOTEM-MSG-LENGTH - 
           TOTEM-IDX1), 
                       ", FILE STATUS ", PRIMARY-ERROR "," 
                       SECONDARY-ERROR
                    DELIMITED BY SIZE INTO TOTEM-MSG-2
                    MOVE SPACES TO TOTEM-MSG-3
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
           END-EVALUATE
           PERFORM MESSAGE-BOX-ROUTINE
           .

       MESSAGE-BOX-ROUTINE.
           MOVE 1 TO TOTEM-MSG-TEXT-POINTER
           IF TOTEM-MSG-1 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-1 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              STRING TOTEM-MSG-1( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                 DELIMITED BY SIZE
                 INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-2 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-2 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-2( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-3 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-3 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-3( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-TEXT-POINTER = 1
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-TEXT TALLYING TOTEM-MSG-SIZE FOR 
           TRAILING SPACE
                  COMPUTE TOTEM-MSG-TEXT-POINTER = 
           TOTEM-MSG-FULL-LENGTH - TOTEM-MSG-SIZE + 1
           END-IF
           MOVE LOW-VALUES TO TOTEM-MSG-TEXT(TOTEM-MSG-TEXT-POINTER : 1 
           )
           .

       MESSAGE-BOX-DISPLAY.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

      *{TOTEM}END

