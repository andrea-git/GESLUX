      *{TOTEM}PRG-COMMENT
      * ric-bozze.Cbl
      * ric-bozze.Cbl is generated by TOTEM
      * This is a generated file. DO NOT modify this file directly.
      *{TOTEM}END
       IDENTIFICATION       DIVISION.
      *{TOTEM}PRGID
       PROGRAM-ID.          ric-bozze.
       AUTHOR.              andre.
       DATE-WRITTEN.        martedì 7 settembre 2021 11:53:50.
       REMARKS.
      *{TOTEM}END

       ENVIRONMENT          DIVISION.
       CONFIGURATION        SECTION.
       SPECIAL-NAMES.
      *{TOTEM}SPECIAL-NAME
      * <TOTEM:EPT. INIT:ric-bozze, INIT:ric-bozze, SpecialName>
      * <TOTEM:END>
      *{TOTEM}END
      *{TOTEM}ACTIVEX-DEF
      *{TOTEM}END
      *{TOTEM}DECIMAL-POINT
           DECIMAL-POINT IS COMMA.
      *{TOTEM}END

       INPUT-OUTPUT         SECTION.
       FILE-CONTROL.
      *{TOTEM}FILE-CONTROL
           COPY "tordini.sl".
           COPY "tnotacr.sl".
           COPY "tparamge.sl".
           COPY "zoom-tno-fat.sl".
           COPY "zoom-tor-fat.sl".
           COPY "zoom-tor-bolle.sl".
           COPY "clienti.sl".
           COPY "destini.sl".
           COPY "tcaumag.sl".
           COPY "tvettori.sl".
           COPY "tmp-solleciti.sl".
      *{TOTEM}END
       DATA                 DIVISION.
       FILE                 SECTION.
      *{TOTEM}FILE
           COPY "tordini.fd".
           COPY "tnotacr.fd".
           COPY "tparamge.fd".
           COPY "zoom-tno-fat.fd".
           COPY "zoom-tor-fat.fd".
           COPY "zoom-tor-bolle.fd".
           COPY "clienti.fd".
           COPY "destini.fd".
           COPY "tcaumag.fd".
           COPY "tvettori.fd".
           COPY "tmp-solleciti.fd".
      *{TOTEM}END

       WORKING-STORAGE      SECTION.
      *{TOTEM}ACU-DEF
               COPY "acugui.def".
               COPY "acucobol.def".
               COPY "fonts.def".
               COPY "crtvars.def".
               COPY "showmsg.def".
               COPY "totem.def".
               COPY "standard.def".
      *{TOTEM}END

      *{TOTEM}COPY-WORKING
      * Key Status
       77 Key-Status IS SPECIAL-NAMES CRT STATUS PIC 9(5) VALUE 0.
          88 Enter-Pushed VALUE 13.
          88 Exit-Pushed VALUE 27.
          88 Message-Received VALUE 95.
          88 Event-Occurred VALUE 96.
          88 Screen-No-Input-Field VALUE 97.
          88 Screen-Time-Out VALUE 99.
      * Properties & User defined Working Stoarge
       77 Screen1-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 call-status
                  USAGE IS SIGNED-SHORT.
           COPY  "LINK-GORDCVAR.DEF".
           COPY  "LINK-FATMAN.DEF".
           COPY  "LINK-NOTACR.DEF".
       77 Small-Font
                  USAGE IS HANDLE OF FONT SMALL-FONT.
       77 STATUS-tordini   PIC  X(2).
           88 Valid-STATUS-tordini VALUE IS "00" THRU "09". 
       77 Screen2-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 Default-Font
                  USAGE IS HANDLE OF FONT DEFAULT-FONT.
       01 FILLER           PIC  9.
           88 controllo-finale VALUE IS 1    WHEN SET TO FALSE  0. 
       77 Form1-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 TITOLO           PIC  X(100)
                  VALUE IS "Ricerca Bozze".
       77 como-x           PIC  x.
       77 save-tipo-ricerca            PIC  x.
       77 como-data-1      PIC  9(8).
       77 como-data-2      PIC  9(8).
       77 como-riga
                  USAGE IS UNSIGNED-INT.
       01 como-chiave-ordine.
           05 como-anno        PIC  9(4).
           05 como-numero-ordine           PIC  9(8).
       01 tipo PIC  9.
           88 inevasi VALUE IS 1. 
           88 emessa-bolla VALUE IS 2. 
           88 fatturati VALUE IS 3. 
           88 note-credito VALUE IS 4. 
       77 FILLER           PIC  9.
           88 CallManutenzione VALUE IS 1    WHEN SET TO FALSE  0. 
       77 OK_73X21-BMP     PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 CANCEL_73X21-BMP PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 elemento-bmp     PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 Form1-Tb-1-Handlea
                  USAGE IS HANDLE OF WINDOW.
       77 toolbar-bmp      PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 E-ESCI           PIC  9
                  VALUE IS 1.
       77 E-CERCA          PIC  9
                  VALUE IS 0.
       77 Verdana12-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 ef-bolla-buf     PIC  9(8).
       77 AUTO-ID          PIC  9(6)
                  VALUE IS 1002.
       77 STATUS-tnotacr   PIC  X(2).
           88 Valid-STATUS-tnotacr VALUE IS "00" THRU "09". 
       77 STATUS-tparamge  PIC  X(2).
           88 Valid-STATUS-tparamge VALUE IS "00" THRU "09". 
       77 path-zoom-tno-fat            PIC  X(256).
       77 STATUS-zoom-tno-fat          PIC  X(2).
           88 Valid-STATUS-zoom-tno-fat VALUE IS "00" THRU "09". 
       77 path-zoom-tor-bolle          PIC  X(256).
       77 STATUS-zoom-tor-bolle        PIC  X(2).
           88 Valid-STATUS-zoom-tor-bolle VALUE IS "00" THRU "09". 
       77 path-zoom-tor-fat            PIC  X(256).
       77 STATUS-zoom-tor-fat          PIC  X(2).
           88 Valid-STATUS-zoom-tor-fat VALUE IS "00" THRU "09". 
       01 filler           PIC  9.
           88 record-ok VALUE IS 1,    WHEN SET TO FALSE  0. 
       77 ext-file EXTERNAL   PIC  x(256).
       77 STATUS-clienti   PIC  X(2).
           88 Valid-STATUS-clienti VALUE IS "00" THRU "09". 
       77 BLUE-DA-28X24-BMP            PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 BLUE-FINO-28X24-BMP          PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 ef-anno-buf      PIC  9(4).
       77 ef-cli-buf       PIC  9(5).
       77 ef-dest-buf      PIC  9(5).
       77 ef-data-from-buf PIC  99/99/9999.
       77 ef-data-to-buf   PIC  99/99/9999.
       77 ef-ordine-buf    PIC  9(8).
       77 ef-fattura-buf   PIC  9(8).
       77 ef-nc-buf        PIC  9(8).
       77 lab-dest-buf     PIC  x(50).
       77 lab-cli-buf      PIC  x(50).
       77 e-elenco         PIC  9
                  VALUE IS 1.
       77 e-ordine         PIC  9
                  VALUE IS 1.
       77 e-bolla          PIC  9(3).
       77 e-fattura        PIC  9
                  VALUE IS 1.
       77 e-nc PIC  9
                  VALUE IS 1.
       77 cbo-tipo-buf     PIC  X(50).
       77 STATUS-destini   PIC  X(2).
           88 Valid-STATUS-destini VALUE IS "00" THRU "09". 
       77 STATUS-tcaumag   PIC  X(2).
           88 Valid-STATUS-tcaumag VALUE IS "00" THRU "09". 
       77 form2-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 col-stato-ordine PIC  9(6)
                  VALUE IS 0.
       77 font-evidenzia-griglia
                  USAGE IS HANDLE OF FONT DEFAULT-FONT.
       77 Verdana10B-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 tit-stato-ordine PIC  X(20)
                  VALUE IS "Inevaso".
       77 BOTTONE-CANCEL-BMP           PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 BOTTONE-OK-BMP   PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 form3-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 Verdana12BI-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 ef-num-buf       PIC  x(50).
       77 cmd  PIC  x(200).
       01 FILLER           PIC  9.
           88 PrimaVolta VALUE IS 1    WHEN SET TO FALSE  0. 
       01 gd-ordini-record.
           05 col-nulla        PIC  X.
           05 Col-anno         PIC  9(4).
           05 col-numero       PIC  z(7)9.
           05 col-bolla        PIC  z(7)9
                      BLANK WHEN ZERO.
           05 Col-dt-bolla     PIC  zz/zz/zzzz
                      BLANK WHEN ZERO.
           05 col-fatt         PIC  z(7)9
                      BLANK WHEN ZERO.
           05 col-dt-fatt      PIC  zz/zz/zzzz
                      BLANK WHEN ZERO.
           05 col-num-ord      PIC  X(50).
           05 col-ragsoc       PIC  X(40).
           05 col-localita     PIC  X(35).
           05 col-sito         PIC  x(70).
       77 STATUS-tvettori  PIC  X(2).
           88 Valid-STATUS-tvettori VALUE IS "00" THRU "09". 
       77 path-tmp-solleciti           PIC  X(256).
       77 status-tmp-solleciti         PIC  X(2).
           88 Valid-status-tmp-solleciti VALUE IS "00" THRU "09". 

      ***********************************************************
      *   Code Gen's Buffer                                     *
      ***********************************************************
       77 STATUS-Form1-FLAG-REFRESH PIC  9.
          88 Form1-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 STATUS-Form2-FLAG-REFRESH PIC  9.
          88 Form2-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 TMP-Form2-KEY1-ORDER  PIC X VALUE "A".
       77 TMP-Form2-tordini-RESTOREBUF  PIC X(3938).
       77 TMP-Form2-KEYIS  PIC 9(3) VALUE 1.
       77 Form2-MULKEY-TMPBUF   PIC X(3938).
       77 STATUS-form3-FLAG-REFRESH PIC  9.
          88 form3-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 TMP-DataSet1-tordini-BUF     PIC X(3938).
       77 TMP-DataSet1-tnotacr-BUF     PIC X(752).
       77 TMP-DataSet1-tparamge-BUF     PIC X(815).
       77 TMP-DataSet1-zoom-tno-fat-BUF     PIC X(77).
       77 TMP-DataSet1-zoom-tor-fat-BUF     PIC X(77).
       77 TMP-DataSet1-zoom-tor-bolle-BUF     PIC X(77).
       77 TMP-DataSet1-clienti-BUF     PIC X(3610).
       77 TMP-DataSet1-destini-BUF     PIC X(3676).
       77 TMP-DataSet1-tcaumag-BUF     PIC X(254).
       77 TMP-DataSet1-tvettori-BUF     PIC X(1847).
       77 TMP-DataSet1-tmp-solleciti-BUF     PIC X(304).
      * VARIABLES FOR RECORD LENGTH.
       77  TotemFdSlRecordClearOffset   PIC 9(5) COMP-4.
       77  TotemFdSlRecordLength        PIC 9(5) COMP-4.
      * FILE'S LOCK MODE FLAG
       77 DataSet1-tordini-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tordini-LOCK  VALUE "Y".
       77 DataSet1-KEYIS   PIC 9(3) VALUE 1.
       77 DataSet1-tordini-KEY1-ORDER  PIC X VALUE "A".
          88 DataSet1-tordini-KEY1-Asc  VALUE "A".
          88 DataSet1-tordini-KEY1-Desc VALUE "D".
       77 DataSet1-tnotacr-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tnotacr-LOCK  VALUE "Y".
       77 DataSet1-tnotacr-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tnotacr-KEY-Asc  VALUE "A".
          88 DataSet1-tnotacr-KEY-Desc VALUE "D".
       77 DataSet1-tparamge-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tparamge-LOCK  VALUE "Y".
       77 DataSet1-tparamge-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tparamge-KEY-Asc  VALUE "A".
          88 DataSet1-tparamge-KEY-Desc VALUE "D".
       77 DataSet1-zoom-tno-fat-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-zoom-tno-fat-LOCK  VALUE "Y".
       77 DataSet1-zoom-tno-fat-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-zoom-tno-fat-KEY-Asc  VALUE "A".
          88 DataSet1-zoom-tno-fat-KEY-Desc VALUE "D".
       77 DataSet1-zoom-tor-fat-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-zoom-tor-fat-LOCK  VALUE "Y".
       77 DataSet1-zoom-tor-fat-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-zoom-tor-fat-KEY-Asc  VALUE "A".
          88 DataSet1-zoom-tor-fat-KEY-Desc VALUE "D".
       77 DataSet1-zoom-tor-bolle-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-zoom-tor-bolle-LOCK  VALUE "Y".
       77 DataSet1-zoom-tor-bolle-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-zoom-tor-bolle-KEY-Asc  VALUE "A".
          88 DataSet1-zoom-tor-bolle-KEY-Desc VALUE "D".
       77 DataSet1-clienti-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-clienti-LOCK  VALUE "Y".
       77 DataSet1-clienti-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-clienti-KEY-Asc  VALUE "A".
          88 DataSet1-clienti-KEY-Desc VALUE "D".
       77 DataSet1-destini-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-destini-LOCK  VALUE "Y".
       77 DataSet1-destini-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-destini-KEY-Asc  VALUE "A".
          88 DataSet1-destini-KEY-Desc VALUE "D".
       77 DataSet1-tcaumag-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tcaumag-LOCK  VALUE "Y".
       77 DataSet1-tcaumag-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tcaumag-KEY-Asc  VALUE "A".
          88 DataSet1-tcaumag-KEY-Desc VALUE "D".
       77 DataSet1-tvettori-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tvettori-LOCK  VALUE "Y".
       77 DataSet1-tvettori-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tvettori-KEY-Asc  VALUE "A".
          88 DataSet1-tvettori-KEY-Desc VALUE "D".
       77 DataSet1-tmp-solleciti-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tmp-solleciti-LOCK  VALUE "Y".
       77 DataSet1-tmp-solleciti-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tmp-solleciti-KEY-Asc  VALUE "A".
          88 DataSet1-tmp-solleciti-KEY-Desc VALUE "D".

       77 tordini-k-causale-SPLITBUF  PIC X(17).
       77 tordini-k1-SPLITBUF  PIC X(23).
       77 tordini-k2-SPLITBUF  PIC X(21).
       77 tordini-k-bolla-SPLITBUF  PIC X(13).
       77 tordini-k3-SPLITBUF  PIC X(22).
       77 tordini-k-fattura-SPLITBUF  PIC X(13).
       77 tordini-k4-SPLITBUF  PIC X(30).
       77 tordini-k-contab-SPLITBUF  PIC X(14).
       77 tordini-k-tipo-SPLITBUF  PIC X(14).
       77 tordini-k-data-SPLITBUF  PIC X(17).
       77 tordini-k-agfatt-SPLITBUF  PIC X(42).
       77 tordini-k-stbolle-SPLITBUF  PIC X(34).
       77 tordini-k-andamento-data-SPLITBUF  PIC X(10).
       77 tordini-k-andamento-cliente-SPLITBUF  PIC X(15).
       77 tordini-k-andamento-clides-SPLITBUF  PIC X(20).
       77 tordini-k-promo-SPLITBUF  PIC X(29).
       77 tordini-k-or-SPLITBUF  PIC X(61).
       77 tordini-k-tor-inviare-SPLITBUF  PIC X(14).
       77 tordini-k-tor-tipocli-SPLITBUF  PIC X(25).
       77 tordini-k-tor-gdo-SPLITBUF  PIC X(28).
       77 tnotacr-k-causale-SPLITBUF  PIC X(17).
       77 tnotacr-k1-SPLITBUF  PIC X(23).
       77 tnotacr-k2-SPLITBUF  PIC X(21).
       77 tnotacr-k-fattura-SPLITBUF  PIC X(13).
       77 tnotacr-k4-SPLITBUF  PIC X(30).
       77 tnotacr-k-contab-SPLITBUF  PIC X(14).
       77 tnotacr-k-data-SPLITBUF  PIC X(17).
       77 tnotacr-k-agfatt-SPLITBUF  PIC X(42).
       77 tnotacr-k-andamento-data-SPLITBUF  PIC X(10).
       77 tnotacr-k-andamento-cliente-SPLITBUF  PIC X(15).
       77 tnotacr-k-andamento-clides-SPLITBUF  PIC X(20).
       77 zoom-tno-fat-zoom-tno-fat-key01-SPLITBUF  PIC X(13).
       77 zoom-tor-fat-zoom-tor-fat-key01-SPLITBUF  PIC X(13).
       77 zoom-tor-bolle-zoom-tor-bol-key01-SPLITBUF  PIC X(13).
       77 clienti-cli-K1-SPLITBUF  PIC X(47).
       77 clienti-cli-K3-SPLITBUF  PIC X(12).
       77 clienti-cli-K4-SPLITBUF  PIC X(8).
       77 destini-K1-SPLITBUF  PIC X(111).
       77 destini-k-localita-SPLITBUF  PIC X(36).
       77 tcaumag-k-mag-SPLITBUF  PIC X(5).
       77 tvettori-k-des-SPLITBUF  PIC X(41).
       77 tmp-solleciti-k-evasione-SPLITBUF  PIC X(13).
       77 tmp-solleciti-k-bolla-SPLITBUF  PIC X(17).
       77 tmp-solleciti-k-fatt-SPLITBUF  PIC X(17).
      * FOR SPLIT KEY BUFFER
       77 DataSet1-zoom-tno-fat-SPLIT-BUF1   PIC X(13).

      * FOR SPLIT KEY BUFFER
       77 DataSet1-zoom-tor-fat-SPLIT-BUF1   PIC X(13).

      * FOR SPLIT KEY BUFFER
       77 DataSet1-zoom-tor-bolle-SPLIT-BUF1   PIC X(13).

      * FOR SPLIT KEY BUFFER
       77 DataSet1-tmp-solleciti-SPLIT-BUF1   PIC X(13).


      *{TOTEM}END

      *{TOTEM}ID-LOGICI
      ***** Elenco ID Logici *****
       78  78-ID-ef-anno VALUE 5001.
       78  78-ID-rb-elenco VALUE 5002.
       78  78-ID-ef-cli VALUE 5003.
       78  78-ID-ef-dest VALUE 5004.
       78  78-ID-ef-num VALUE 5005.
       78  78-ID-EF-data-FROM VALUE 5006.
       78  78-ID-EF-DATA-TO VALUE 5007.
       78  78-ID-cbo-tipo VALUE 5008.
       78  78-ID-rb-ordine VALUE 5009.
       78  78-ID-ef-ordine VALUE 5010.
       78  78-ID-rb-bolla VALUE 5011.
       78  78-ID-ef-bolla VALUE 5012.
       78  78-ID-rb-fattura VALUE 5013.
       78  78-ID-ef-fattura VALUE 5014.
       78  78-ID-rb-nc VALUE 5015.
       78  78-ID-ef-nc VALUE 5016.
      ***** Fine ID Logici *****
      *{TOTEM}END

       LINKAGE          SECTION.
      *{TOTEM}LINKAGE
           COPY  "COMMON-LINKAGE.DEF".
      *{TOTEM}END

       SCREEN           SECTION.
      *{TOTEM}COPY-SCREEN
      * FORM
       01 
           Form1, 
           BEFORE PROCEDURE Form1-BeforeProcedure,
           AFTER PROCEDURE  Form1-AFTER-SCREEN
           .

      * ENTRY FIELD
       05
           ef-anno, 
           Entry-Field, 
           COL 13,00, 
           LINE 1,50,
           LINES 1,33 ,
           SIZE 6,00 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-ef-anno,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           VALUE ef-anno-buf,
           AFTER PROCEDURE ef-anno-AfterProcedure, 
           .

      * RADIO BUTTON
       05
           rb-elenco, 
           Radio-Button, 
           COL 2,00, 
           LINE 3,67,
           LINES 1,33 ,
           SIZE 1,50 ,
           EXCEPTION-VALUE 1000
           FLAT,
           GROUP 1,
           GROUP-VALUE 1,
           ID IS 78-ID-rb-elenco,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           SELF-ACT,
           TITLE "&E",
           VALUE tipo-ricerca,
           AFTER PROCEDURE Screen1-Rb-1-AfterProcedure, 
           .
      * ENTRY FIELD
       05
           ef-cli, 
           Entry-Field, 
           COL 13,00, 
           LINE 5,50,
           LINES 1,33 ,
           SIZE 6,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED e-elenco,
           ID IS 78-ID-ef-cli,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           VALUE ef-cli-buf,
           AFTER PROCEDURE ef-cli-AfterProcedure, 
           .

      * ENTRY FIELD
       05
           ef-dest, 
           Entry-Field, 
           COL 13,00, 
           LINE 8,00,
           LINES 1,33 ,
           SIZE 6,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED e-elenco,
           ID IS 78-ID-ef-dest,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           VALUE ef-dest-buf,
           AFTER PROCEDURE ef-dest-AfterProcedure, 
           .

      * ENTRY FIELD
       05
           ef-num, 
           Entry-Field, 
           COL 13,00, 
           LINE 10,50,
           LINES 1,33 ,
           SIZE 25,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED e-elenco,
           ID IS 78-ID-ef-num,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           LEFT,
           MAX-TEXT 50,
           VALUE ef-num-buf,
           AFTER PROCEDURE ef-num-AfterProcedure, 
           .

      * ENTRY FIELD
       05
           EF-data-FROM, 
           Entry-Field, 
           COL 1,70, 
           LINE 13,00,
           LINES 1,39 ,
           SIZE 11,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED e-elenco,
           ID IS 78-ID-EF-data-FROM,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           MAX-TEXT 10,
           NUMERIC,
           VALUE ef-data-from-buf,
           PIC 99/99/9999
           AFTER PROCEDURE EF-data-FROM-AfterProcedure, 
           .


      * ENTRY FIELD
       05
           EF-DATA-TO, 
           Entry-Field, 
           COL 29,20, 
           LINE 13,00,
           LINES 1,39 ,
           SIZE 11,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED e-elenco,
           ID IS 78-ID-EF-DATA-TO,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           MAX-TEXT 10,
           NUMERIC,
           VALUE ef-data-to-buf,
           PIC 99/99/9999
           AFTER PROCEDURE EF-DATA-TO-AfterProcedure, 
           .


      * COMBO-BOX
       05
           cbo-tipo, 
           Combo-Box, 
           COL 13,00, 
           LINE 15,00,
           LINES 5,00 ,
           SIZE 16,00 ,
           3-D,
           COLOR IS 513,
           ENABLED e-elenco,
           ID IS 78-ID-cbo-tipo,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MASS-UPDATE 0,
           NOTIFY-SELCHANGE,
           DROP-LIST,
           UNSORTED,
           VALUE cbo-tipo-buf,
           AFTER PROCEDURE Form1-Cm-1-AfterProcedure, 
           EVENT PROCEDURE cbo-tipo-Event-Proc,
           .
      * RADIO BUTTON
       05
           rb-ordine, 
           Radio-Button, 
           COL 2,00, 
           LINE 18,00,
           LINES 1,33 ,
           SIZE 1,50 ,
           EXCEPTION-VALUE 1002
           FLAT,
           GROUP 1,
           GROUP-VALUE 2,
           ID IS 78-ID-rb-ordine,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           SELF-ACT,
           TITLE "&O",
           VALUE tipo-ricerca,
           AFTER PROCEDURE rb-ordine-AfterProcedure, 
           .
      * ENTRY FIELD
       05
           ef-ordine, 
           Entry-Field, 
           COL 13,00, 
           LINE 18,00,
           LINES 1,33 ,
           SIZE 9,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED e-ordine,
           ID IS 78-ID-ef-ordine,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           VALUE ef-ordine-buf,
           AFTER PROCEDURE ef-ordine-AfterProcedure, 
           .

      * RADIO BUTTON
       05
           rb-bolla, 
           Radio-Button, 
           COL 2,00, 
           LINE 20,00,
           LINES 1,33 ,
           SIZE 1,50 ,
           EXCEPTION-VALUE 1003
           FLAT,
           GROUP 1,
           GROUP-VALUE 3,
           ID IS 78-ID-rb-bolla,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           SELF-ACT,
           TITLE "&B",
           VALUE tipo-ricerca,
           AFTER PROCEDURE rb-bolla-AfterProcedure, 
           .
      * ENTRY FIELD
       05
           ef-bolla, 
           Entry-Field, 
           COL 13,00, 
           LINE 20,00,
           LINES 1,33 ,
           SIZE 9,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED e-bolla,
           ID IS 78-ID-ef-bolla,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           VALUE ef-bolla-buf,
           AFTER PROCEDURE ef-bolla-AfterProcedure, 
           .

      * RADIO BUTTON
       05
           rb-fattura, 
           Radio-Button, 
           COL 2,00, 
           LINE 22,00,
           LINES 1,06 ,
           SIZE 1,50 ,
           EXCEPTION-VALUE 1004
           FLAT,
           GROUP 1,
           GROUP-VALUE 4,
           ID IS 78-ID-rb-fattura,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           SELF-ACT,
           TITLE "&F",
           VALUE tipo-ricerca,
           AFTER PROCEDURE rb-fattura-AfterProcedure, 
           .
      * ENTRY FIELD
       05
           ef-fattura, 
           Entry-Field, 
           COL 13,00, 
           LINE 22,00,
           LINES 1,33 ,
           SIZE 9,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED e-fattura,
           ID IS 78-ID-ef-fattura,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           VALUE ef-fattura-buf,
           AFTER PROCEDURE ef-fattura-AfterProcedure, 
           .

      * RADIO BUTTON
       05
           rb-nc, 
           Radio-Button, 
           COL 2,00, 
           LINE 24,00,
           LINES 1,06 ,
           SIZE 1,50 ,
           EXCEPTION-VALUE 1005
           FLAT,
           GROUP 1,
           GROUP-VALUE 5,
           ID IS 78-ID-rb-nc,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           SELF-ACT,
           TITLE "&N",
           VALUE tipo-ricerca,
           AFTER PROCEDURE rb-nc-AfterProcedure, 
           .
      * ENTRY FIELD
       05
           ef-nc, 
           Entry-Field, 
           COL 13,00, 
           LINE 24,00,
           LINES 1,33 ,
           SIZE 9,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED e-nc,
           ID IS 78-ID-ef-nc,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           VALUE ef-nc-buf,
           AFTER PROCEDURE ef-nc-AfterProcedure, 
           .

      * FRAME
       05
           Screen1-Fr-1, 
           Frame, 
           COL 1,00, 
           LINE 25,67,
           LINES 2,78 ,
           SIZE 40,00 ,
           LOWERED,
           ID IS 1,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           .

      * PUSH BUTTON
       05
           PB-ESEGUI, 
           Push-Button, 
           COL 25,00, 
           LINE 26,34,
           LINES 30,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE OK_73X21-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           ENABLED 1,
           EXCEPTION-VALUE 1001,
           FLAT,
           ID IS 500,
           SELF-ACT,
           TERMINATION-VALUE 13,
           TITLE "E&segue il programma selezionato",
           AFTER PROCEDURE PB-ESEGUI-AfterProcedure, 
           BEFORE PROCEDURE PB-ESEGUI-BeforeProcedure, 
           .

      * PUSH BUTTON
       05
           pb-cancel, 
           Push-Button, 
           COL 32,80, 
           LINE 26,34,
           LINES 30,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE CANCEL_73X21-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           ENABLED 1,
           EXCEPTION-VALUE 27,
           FLAT,
           ID IS 501,
           SELF-ACT,
           ESCAPE-BUTTON,
           TITLE "&Esce dall'applicativo",
           AFTER PROCEDURE Form1-Pb-2-AfterProcedure, 
           BEFORE PROCEDURE Form1-Pb-2-BeforeProcedure, 
           .

      * LABEL
       05
           Screen1-Custom1-1, 
           Label, 
           COL 34,90, 
           LINE 1,00,
           LINES 1,39 ,
           SIZE 1,60 ,
           FONT IS Default-Font,
           ID IS 5,
           TRANSPARENT,
           TITLE "CUSTOM CONTROL",
           VISIBLE v-custom,
           .

      * LABEL
       05
           Screen1-La-1, 
           Label, 
           COL 5,00, 
           LINE 1,50,
           LINES 1,33 ,
           SIZE 7,00 ,
           ID IS 6,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Anno",
           .

      * BAR
       05
           Screen1-Br-1a, 
           Bar,
           COL 1,00, 
           LINE 3,06,
           SIZE 40,00 ,
           ID IS 7,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           COLORS (9, 8),
           SHADING (-1, 1),
           WIDTH 2,
           .

      * LABEL
       05
           Screen1-La-3, 
           Label, 
           COL 4,00, 
           LINE 18,00,
           LINES 1,33 ,
           SIZE 6,70 ,
           COLOR IS 80,
           ENABLED 1,
           ID IS 8,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           LEFT,
           TITLE "Numero",
           .

      * LABEL
       05
           Screen1-blockpgm-1, 
           Label, 
           COL 32,20, 
           LINE 1,00,
           LINES 1,17 ,
           SIZE 1,10 ,
           ID IS 9,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "BlockPgm",
           VISIBLE v-custom,
           .

      * BAR
       05
           Screen1-Br-1aa, 
           Bar,
           COL 1,00, 
           LINE 17,11,
           SIZE 40,00 ,
           ID IS 10,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           COLORS (9, 8),
           SHADING (-1, 1),
           WIDTH 2,
           .

      * LABEL
       05
           Screen1-La-2a, 
           Label, 
           COL 5,00, 
           LINE 5,50,
           LINES 1,33 ,
           SIZE 7,00 ,
           ID IS 13,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Cliente",
           .

      * LABEL
       05
           Screen1-La-3a, 
           Label, 
           COL 4,00, 
           LINE 3,67,
           LINES 1,33 ,
           SIZE 15,00 ,
           COLOR IS 80,
           ID IS 14,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           LEFT,
           TITLE "&Elenco Documenti",
           .

      * LABEL
       05
           Screen1-La-2aa, 
           Label, 
           COL 5,00, 
           LINE 8,00,
           LINES 1,33 ,
           SIZE 7,00 ,
           ID IS 15,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Destino",
           .

      * BITMAP
       05
           Bitmap-freccia-daaa, 
           Bitmap, 
           COL 13,70, 
           LINE 13,00,
           LINES 24,00 ,
           SIZE 28,00 ,
           TRANSPARENT-COLOR TR-COLOR,
           BITMAP-HANDLE BLUE-DA-28X24-BMP,
           BITMAP-NUMBER 1,
           ID IS 19,
           .

      * LABEL
       05
           Screen3-La-1aca, 
           Label, 
           COL 17,20, 
           LINE 13,00,
           LINES 1,17 ,
           SIZE 7,00 ,
           ID IS 20,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Data",
           .

      * BITMAP
       05
           Bitmap-freccia-finoaa, 
           Bitmap, 
           COL 25,20, 
           LINE 13,00,
           LINES 24,00 ,
           SIZE 28,00 ,
           TRANSPARENT-COLOR TR-COLOR,
           BITMAP-HANDLE BLUE-FINO-28X24-BMP,
           BITMAP-NUMBER 1,
           ID IS 21,
           .

      * LABEL
       05
           Form1-La-1abc, 
           Label, 
           COL 5,70, 
           LINE 15,00,
           LINES 1,33 ,
           SIZE 7,00 ,
           ID IS 218,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Tipo",
           .

      * LABEL
       05
           lab-cli, 
           Label, 
           COL 20,00, 
           LINE 5,50,
           LINES 2,00 ,
           SIZE 20,00 ,
           COLOR IS 5,
           ID IS 219,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           NO-KEY-LETTER,
           TRANSPARENT,
           TITLE lab-cli-buf,
           .

      * LABEL
       05
           lab-dest, 
           Label, 
           COL 20,00, 
           LINE 8,00,
           LINES 2,00 ,
           SIZE 20,00 ,
           COLOR IS 5,
           ID IS 220,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           NO-KEY-LETTER,
           TRANSPARENT,
           TITLE lab-dest-buf,
           .

      * LABEL
       05
           Screen1-La-3b, 
           Label, 
           COL 4,00, 
           LINE 20,00,
           LINES 1,33 ,
           SIZE 6,70 ,
           COLOR IS 80,
           ENABLED 1,
           ID IS 223,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           LEFT,
           TITLE "&Bolla",
           .

      * LABEL
       05
           Screen1-La-3c, 
           Label, 
           COL 4,00, 
           LINE 22,00,
           LINES 1,33 ,
           SIZE 6,70 ,
           COLOR IS 80,
           ENABLED 1,
           ID IS 226,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           LEFT,
           TITLE "&Fattura",
           .

      * LABEL
       05
           Screen1-La-3d, 
           Label, 
           COL 4,00, 
           LINE 24,00,
           LINES 1,33 ,
           SIZE 6,80 ,
           COLOR IS 80,
           ENABLED 1,
           ID IS 229,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           LEFT,
           TITLE "&Nota Cr.",
           .

      * LABEL
       05
           Screen1-La-2aaa, 
           Label, 
           COL 5,00, 
           LINE 10,50,
           LINES 2,00 ,
           SIZE 7,00 ,
           ID IS 230,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Numero Ord. Cli.",
           .

      * TOOLBAR
       01
           Form1-Tb-1a,
           .    

      * PUSH BUTTON
       05
           TOOL-ESCI, 
           Push-Button, 
           COL 1,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           ENABLED E-ESCI,
           EXCEPTION-VALUE 27,
           FLAT,
           ID IS 232,
           SELF-ACT,
           ESCAPE-BUTTON,
           TITLE "&Esci",
           .

      * PUSH BUTTON
       05
           TOOL-CERCA, 
           Push-Button, 
           COL 6,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           BITMAP-NUMBER 8,
           UNFRAMED,
           SQUARE,
           ENABLED E-CERCA,
           EXCEPTION-VALUE 8,
           FLAT,
           ID IS 233,
           SELF-ACT,
           TITLE "Cerca (F8)",
           .

      * FORM
       01 
           Form2, 
           AFTER PROCEDURE  Form2-AFTER-SCREEN
           .

      * GRID
       05
           gd-ordini, 
           Grid, 
           COL 2,67, 
           LINE 2,00,
           LINES 42,00 ,
           SIZE 218,33 ,
           ADJUSTABLE-COLUMNS,
           BOXED,
           CENTERED-HEADINGS,
           DATA-COLUMNS (1, 2, 6, 14, 22, 32, 40, 50, 100, 140, 175),
           ALIGNMENT ("C", "C", "R", "R", "C", "R", "C", "U", "U", "U", 
           "U"),
           SEPARATION (5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5),
           DATA-TYPES ("X", "X", "X", "X", "99/99/9999", "X", "99/99/999
      -    "9", "x(50)", "x(40)", "x(35)", "X"),
           NUM-COL-HEADINGS 1,
           COLUMN-HEADINGS,
           CURSOR-FRAME-WIDTH 0,
           DIVIDER-COLOR 1,
           HEADING-COLOR 257,
           HEADING-DIVIDER-COLOR 1,
           HEADING-FONT IS Verdana10B-Occidentale,
           HSCROLL,
           ID IS 1,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           ROW-HEADINGS,
           TILED-HEADINGS,
           VIRTUAL-WIDTH 205,
           VPADDING 50,
           VSCROLL,
           EVENT PROCEDURE Screen1-Gd-1-Event-Proc,
           .

      * FRAME
       05
           Screen1-Fr-1aa, 
           Frame, 
           COL 1,00, 
           LINE 46,54,
           LINES 3,00 ,
           SIZE 194,83 ,
           LOWERED,
           FULL-HEIGHT,
           ID IS 202,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           .

      * LABEL
       05
           Screen1-La-1a, 
           Label, 
           COL 29,67, 
           LINE 47,15,
           LINES 1,54 ,
           SIZE 135,50 ,
           FONT IS Verdana12-Occidentale,
           ID IS 203,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TITLE "Doppio Click o Invio per modificare l'ordine",
           .

      * FRAME
       05
           Screen1-Fr-1aaa, 
           Frame, 
           COL 196,00, 
           LINE 46,54,
           LINES 3,00 ,
           SIZE 27,50 ,
           LOWERED,
           FULL-HEIGHT,
           ID IS 6,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           .

      * PUSH BUTTON
       05
           pb-annulla2, 
           Push-Button, 
           COL 209,83, 
           LINE 46,69,
           LINES 30,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE BOTTONE-CANCEL-BMP,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 27,
           FLAT,
           ID IS 201,
           SELF-ACT,
           ESCAPE-BUTTON,
           AFTER PROCEDURE pb-annulla2-AfterProcedure, 
           BEFORE PROCEDURE pb-annulla2-BeforeProcedure, 
           .

      * PUSH BUTTON
       05
           pb-ok2, 
           Push-Button, 
           COL 196,67, 
           LINE 46,69,
           LINES 30,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE BOTTONE-OK-BMP,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 1000,
           FLAT,
           ID IS 200,
           AFTER PROCEDURE pb-ok2-AfterProcedure, 
           BEFORE PROCEDURE pb-ok2-BeforeProcedure, 
           .

      * FORM
       01 
           form3, 
           AFTER PROCEDURE  form3-AFTER-SCREEN
           .

      * LABEL
       05
           form3-La-1, 
           Label, 
           COL 2,00, 
           LINE 2,00,
           LINES 2,00 ,
           SIZE 38,00 ,
           FONT IS Verdana12BI-Occidentale,
           ID IS 2,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Caricamento in corso...",
           .

      *{TOTEM}END

      *{TOTEM}LINKPARA
       PROCEDURE  DIVISION USING LK-BLOCKPGM, USER-CODI, LIVELLO-ABIL.
      *{TOTEM}END

      *{TOTEM}DECLARATIVE
       DECLARATIVES.
      * <TOTEM:EPT. INIT:ric-bozze, INIT:ric-bozze, BeforeDeclarative>
       TORDINI-ERR SECTION.
           use after error procedure on tordini.
           evaluate status-tordini
           when "35"
                display message "File [TORDINI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TORDINI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TORDINI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           when "93"
           when "99"
                set RecLocked to true
           end-evaluate.
 
      ***---
       TNOTACR-ERR SECTION.
           use after error procedure on tnotacr.
           set tutto-ok  to true.
           evaluate status-tnotacr
           when "35"
                display message "File [TNOTACR] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TNOTACR] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TNOTACR] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       TPARAMGE-ERR SECTION.
           use after error procedure on tparamge.
           set tutto-ok  to true.
           evaluate status-tparamge
           when "35"
                display message "File [TPARAMGE] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TPARAMGE] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TPARAMGE] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       ZOOM-TNO-FAT-ERR SECTION.
           use after error procedure on zoom-tno-fat.
           set tutto-ok  to true.
           evaluate status-zoom-tno-fat
           when "35"
                display message "File [ZOOM-TNO-FAT] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [ZOOM-TNO-FAT] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[ZOOM-TNO-FAT] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       ZOOM-TOR-FAT-ERR SECTION.
           use after error procedure on zoom-tor-fat.
           set tutto-ok  to true.
           evaluate status-zoom-tor-fat
           when "35"
                display message "File [ZOOM-TOR-FAT] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [ZOOM-TOR-FAT] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[ZOOM-TOR-FAT] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       ZOOM-TOR-BOLLE-ERR SECTION.
           use after error procedure on zoom-tor-bolle.
           set tutto-ok  to true.
           evaluate status-zoom-tor-bolle
           when "35"
                display message "File [ZOOM-TOR-BOLLE] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [ZOOM-TOR-BOLLE] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[ZOOM-TOR-BOLLE] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       CLIENTI-ERR SECTION.
           use after error procedure on clienti.
           set tutto-ok  to true.
           evaluate status-clienti
           when "35"
                display message "File [CLIENTI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [CLIENTI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[CLIENTI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.

      * <TOTEM:END>
       INPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON INPUT.
       0100-DECL.
           EXIT.
       I-O-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON I-O.
       0200-DECL.
           EXIT.
       OUTPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON OUTPUT.
       0300-DECL.
           EXIT.
       TRANSACTION-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON TRANSACTION.
       0400-DECL.
           EXIT.
       END DECLARATIVES.
      *{TOTEM}END

       MAIN-LOGIC.
      *{TOTEM}ENTRY-BEFPRG
      *    Before-Program
           PERFORM bprepb-Ev-Before-Program
      *{TOTEM}END
           PERFORM INITIALIZE-ROUTINE.
      * run main screen
      *{TOTEM}RUN-MAINSCR
           PERFORM Form1-OPEN-ROUTINE.
      *{TOTEM}END

      *{TOTEM}COPY-PROCEDURE
       EXIT-STOP-ROUTINE.
           PERFORM CLOSE-FILE-RTN
      * <TOTEM:EPT. INIT:ric-bozze, INIT:ric-bozze, BeforeDestroyResource>
      * <TOTEM:END>
           DESTROY Verdana12-Occidentale
           DESTROY Verdana10B-Occidentale
           DESTROY Verdana12BI-Occidentale
           CALL "w$bitmap" USING WBITMAP-DESTROY, OK_73X21-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, CANCEL_73X21-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, BLUE-DA-28X24-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, BLUE-FINO-28X24-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, toolbar-bmp
           CALL "w$bitmap" USING WBITMAP-DESTROY, TOOLBAR-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, BOTTONE-CANCEL-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, BOTTONE-OK-BMP
      *    After-Program
           PERFORM stdoc-Ev-After-Program
           EXIT PROGRAM TOTEM-PgmStatus
           STOP RUN.

       INITIALIZE-ROUTINE.
      *    Before Init
      * initialize program status variable
           Initialize TOTEM-PgmStatus.
      * get system information
           ACCEPT SYSTEM-INFORMATION FROM SYSTEM-INFO.
      * get terminal information
           ACCEPT TERMINAL-ABILITIES FROM TERMINAL-INFO.
      * set font
           PERFORM INIT-FONT.
      * load bitmap
           PERFORM INIT-BMP.
      * load resource
           PERFORM INIT-RES.
      * create pop-up menu
           PERFORM INIT-POPUP.
      * open files
           PERFORM OPEN-FILE-RTN.
      *    After Init
           .
    
       INIT-FONT.
      * Verdana12-Occidentale
           INITIALIZE WFONT-DATA Verdana12-Occidentale
           MOVE 12 TO WFONT-SIZE
           MOVE "Verdana" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO FALSE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Verdana12-Occidentale, WFONT-DATA

      * Verdana10B-Occidentale
           INITIALIZE WFONT-DATA Verdana10B-Occidentale
           MOVE 10 TO WFONT-SIZE
           MOVE "Verdana" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO TRUE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Verdana10B-Occidentale, WFONT-DATA
      * Verdana12BI-Occidentale
           INITIALIZE WFONT-DATA Verdana12BI-Occidentale
           MOVE 12 TO WFONT-SIZE
           MOVE "Verdana" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO TRUE
           SET WFONT-ITALIC TO TRUE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Verdana12BI-Occidentale, WFONT-DATA
           .

       INIT-BMP.
      * PB-ESEGUI
           COPY RESOURCE "BOTTONE-OK.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "BOTTONE-OK.BMP", 
                   GIVING OK_73X21-BMP.
      * pb-cancel
           COPY RESOURCE "BOTTONE-CANCEL.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "BOTTONE-CANCEL.BMP", 
                   GIVING CANCEL_73X21-BMP.
      * Bitmap-freccia-daaa
           COPY RESOURCE "BLUE-DA-28X24.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "BLUE-DA-28X24.BMP", 
                   GIVING BLUE-DA-28X24-BMP.
      * Bitmap-freccia-finoaa
           COPY RESOURCE "BLUE-FINO-28X24.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "BLUE-FINO-28X24.BMP", 
                   GIVING BLUE-FINO-28X24-BMP.
      * TOOL-ESCI
           COPY RESOURCE "toolbar.bmp".
           CALL "w$bitmap" USING WBITMAP-LOAD "toolbar.bmp", 
                   GIVING toolbar-bmp.
      * TOOL-CERCA
           COPY RESOURCE "TOOLBAR.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "TOOLBAR.BMP", 
                   GIVING TOOLBAR-BMP.
      * pb-annulla2
           COPY RESOURCE "BOTTONE-CANCEL.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "BOTTONE-CANCEL.BMP", 
                   GIVING BOTTONE-CANCEL-BMP.
      * pb-ok2
           COPY RESOURCE "BOTTONE-OK.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "BOTTONE-OK.BMP", 
                   GIVING BOTTONE-OK-BMP.
           .

       INIT-RES.
           .

       INIT-POPUP.
           .

       OPEN-FILE-RTN.
      *    Before Open
           PERFORM OPEN-tordini
           PERFORM OPEN-tnotacr
           PERFORM OPEN-tparamge
      *    zoom-tno-fat OPEN MODE IS FALSE
      *    PERFORM OPEN-zoom-tno-fat
      *    zoom-tor-fat OPEN MODE IS FALSE
      *    PERFORM OPEN-zoom-tor-fat
      *    zoom-tor-bolle OPEN MODE IS FALSE
      *    PERFORM OPEN-zoom-tor-bolle
           PERFORM OPEN-clienti
           PERFORM OPEN-destini
           PERFORM OPEN-tcaumag
           PERFORM OPEN-tvettori
      *    tmp-solleciti OPEN MODE IS FALSE
      *    PERFORM OPEN-tmp-solleciti
      *    After Open
           .

       OPEN-tordini.
      * <TOTEM:EPT. INIT:ric-bozze, FD:tordini, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tordini
           IF NOT Valid-STATUS-tordini
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:ric-bozze, FD:tordini, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tnotacr.
      * <TOTEM:EPT. INIT:ric-bozze, FD:tnotacr, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tnotacr
           IF NOT Valid-STATUS-tnotacr
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:ric-bozze, FD:tnotacr, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tparamge.
      * <TOTEM:EPT. INIT:ric-bozze, FD:tparamge, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tparamge
           IF NOT Valid-STATUS-tparamge
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:ric-bozze, FD:tparamge, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-zoom-tno-fat.
      * <TOTEM:EPT. INIT:ric-bozze, FD:zoom-tno-fat, BeforeOpen>
      * <TOTEM:END>
           OPEN  OUTPUT zoom-tno-fat
           IF NOT Valid-STATUS-zoom-tno-fat
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:ric-bozze, FD:zoom-tno-fat, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-zoom-tor-fat.
      * <TOTEM:EPT. INIT:ric-bozze, FD:zoom-tor-fat, BeforeOpen>
      * <TOTEM:END>
           OPEN  OUTPUT zoom-tor-fat
           IF NOT Valid-STATUS-zoom-tor-fat
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:ric-bozze, FD:zoom-tor-fat, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-zoom-tor-bolle.
      * <TOTEM:EPT. INIT:ric-bozze, FD:zoom-tor-bolle, BeforeOpen>
      * <TOTEM:END>
           OPEN  OUTPUT zoom-tor-bolle
           IF NOT Valid-STATUS-zoom-tor-bolle
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:ric-bozze, FD:zoom-tor-bolle, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-clienti.
      * <TOTEM:EPT. INIT:ric-bozze, FD:clienti, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT clienti
           IF NOT Valid-STATUS-clienti
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:ric-bozze, FD:clienti, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-destini.
      * <TOTEM:EPT. INIT:ric-bozze, FD:destini, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT destini
           IF NOT Valid-STATUS-destini
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:ric-bozze, FD:destini, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tcaumag.
      * <TOTEM:EPT. INIT:ric-bozze, FD:tcaumag, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tcaumag
           IF NOT Valid-STATUS-tcaumag
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:ric-bozze, FD:tcaumag, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tvettori.
      * <TOTEM:EPT. INIT:ric-bozze, FD:tvettori, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tvettori
           IF NOT Valid-STATUS-tvettori
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:ric-bozze, FD:tvettori, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tmp-solleciti.
      * <TOTEM:EPT. INIT:ric-bozze, FD:tmp-solleciti, BeforeOpen>
      * <TOTEM:END>
           OPEN  OUTPUT tmp-solleciti
           IF NOT Valid-status-tmp-solleciti
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:ric-bozze, FD:tmp-solleciti, AfterOpen>
      * <TOTEM:END>
           .

       CLOSE-FILE-RTN.
      *    Before Close
           PERFORM CLOSE-tordini
           PERFORM CLOSE-tnotacr
           PERFORM CLOSE-tparamge
      *    zoom-tno-fat CLOSE MODE IS FALSE
      *    PERFORM CLOSE-zoom-tno-fat
      *    zoom-tor-fat CLOSE MODE IS FALSE
      *    PERFORM CLOSE-zoom-tor-fat
      *    zoom-tor-bolle CLOSE MODE IS FALSE
      *    PERFORM CLOSE-zoom-tor-bolle
           PERFORM CLOSE-clienti
           PERFORM CLOSE-destini
           PERFORM CLOSE-tcaumag
           PERFORM CLOSE-tvettori
      *    tmp-solleciti CLOSE MODE IS FALSE
      *    PERFORM CLOSE-tmp-solleciti
      *    After Close
           .

       CLOSE-tordini.
      * <TOTEM:EPT. INIT:ric-bozze, FD:tordini, BeforeClose>
      * <TOTEM:END>
           CLOSE tordini
           .

       CLOSE-tnotacr.
      * <TOTEM:EPT. INIT:ric-bozze, FD:tnotacr, BeforeClose>
      * <TOTEM:END>
           CLOSE tnotacr
           .

       CLOSE-tparamge.
      * <TOTEM:EPT. INIT:ric-bozze, FD:tparamge, BeforeClose>
      * <TOTEM:END>
           CLOSE tparamge
           .

       CLOSE-zoom-tno-fat.
      * <TOTEM:EPT. INIT:ric-bozze, FD:zoom-tno-fat, BeforeClose>
      * <TOTEM:END>
           .

       CLOSE-zoom-tor-fat.
      * <TOTEM:EPT. INIT:ric-bozze, FD:zoom-tor-fat, BeforeClose>
      * <TOTEM:END>
           .

       CLOSE-zoom-tor-bolle.
      * <TOTEM:EPT. INIT:ric-bozze, FD:zoom-tor-bolle, BeforeClose>
      * <TOTEM:END>
           .

       CLOSE-clienti.
      * <TOTEM:EPT. INIT:ric-bozze, FD:clienti, BeforeClose>
      * <TOTEM:END>
           CLOSE clienti
           .

       CLOSE-destini.
      * <TOTEM:EPT. INIT:ric-bozze, FD:destini, BeforeClose>
      * <TOTEM:END>
           CLOSE destini
           .

       CLOSE-tcaumag.
      * <TOTEM:EPT. INIT:ric-bozze, FD:tcaumag, BeforeClose>
      * <TOTEM:END>
           CLOSE tcaumag
           .

       CLOSE-tvettori.
      * <TOTEM:EPT. INIT:ric-bozze, FD:tvettori, BeforeClose>
      * <TOTEM:END>
           CLOSE tvettori
           .

       CLOSE-tmp-solleciti.
      * <TOTEM:EPT. INIT:ric-bozze, FD:tmp-solleciti, BeforeClose>
      * <TOTEM:END>
           .

       tordini-k-causale-MERGE-SPLITBUF.
           INITIALIZE tordini-k-causale-SPLITBUF
           MOVE tor-causale(1:4) TO tordini-k-causale-SPLITBUF(1:4)
           MOVE tor-anno(1:4) TO tordini-k-causale-SPLITBUF(5:4)
           MOVE tor-numero(1:8) TO tordini-k-causale-SPLITBUF(9:8)
           .

       tordini-k1-MERGE-SPLITBUF.
           INITIALIZE tordini-k1-SPLITBUF
           MOVE tor-cod-cli(1:5) TO tordini-k1-SPLITBUF(1:5)
           MOVE tor-prg-destino(1:5) TO tordini-k1-SPLITBUF(6:5)
           MOVE tor-anno(1:4) TO tordini-k1-SPLITBUF(11:4)
           MOVE tor-numero(1:8) TO tordini-k1-SPLITBUF(15:8)
           .

       tordini-k2-MERGE-SPLITBUF.
           INITIALIZE tordini-k2-SPLITBUF
           MOVE tor-data-passaggio-ordine(1:8) TO 
           tordini-k2-SPLITBUF(1:8)
           MOVE tor-anno(1:4) TO tordini-k2-SPLITBUF(9:4)
           MOVE tor-numero(1:8) TO tordini-k2-SPLITBUF(13:8)
           .

       tordini-k-bolla-MERGE-SPLITBUF.
           INITIALIZE tordini-k-bolla-SPLITBUF
           MOVE tor-anno-bolla(1:4) TO tordini-k-bolla-SPLITBUF(1:4)
           MOVE tor-num-bolla(1:8) TO tordini-k-bolla-SPLITBUF(5:8)
           .

       tordini-k3-MERGE-SPLITBUF.
           INITIALIZE tordini-k3-SPLITBUF
           MOVE tor-anno-bolla(1:4) TO tordini-k3-SPLITBUF(1:4)
           MOVE tor-data-bolla(1:8) TO tordini-k3-SPLITBUF(5:8)
           MOVE tor-num-bolla(1:8) TO tordini-k3-SPLITBUF(13:8)
           MOVE tor-bolla-prenotata(1:1) TO tordini-k3-SPLITBUF(21:1)
           .

       tordini-k-fattura-MERGE-SPLITBUF.
           INITIALIZE tordini-k-fattura-SPLITBUF
           MOVE tor-anno-fattura(1:4) TO tordini-k-fattura-SPLITBUF(1:4)
           MOVE tor-num-fattura(1:8) TO tordini-k-fattura-SPLITBUF(5:8)
           .

       tordini-k4-MERGE-SPLITBUF.
           INITIALIZE tordini-k4-SPLITBUF
           MOVE tor-anno-fattura(1:4) TO tordini-k4-SPLITBUF(1:4)
           MOVE tor-data-fattura(1:8) TO tordini-k4-SPLITBUF(5:8)
           MOVE tor-num-fattura(1:8) TO tordini-k4-SPLITBUF(13:8)
           MOVE tor-num-prenot(1:8) TO tordini-k4-SPLITBUF(21:8)
           MOVE tor-fatt-prenotata(1:1) TO tordini-k4-SPLITBUF(29:1)
           .

       tordini-k-contab-MERGE-SPLITBUF.
           INITIALIZE tordini-k-contab-SPLITBUF
           MOVE tor-agg-contab(1:1) TO tordini-k-contab-SPLITBUF(1:1)
           MOVE tor-anno-fattura(1:4) TO tordini-k-contab-SPLITBUF(2:4)
           MOVE tor-num-fattura(1:8) TO tordini-k-contab-SPLITBUF(6:8)
           .

       tordini-k-tipo-MERGE-SPLITBUF.
           INITIALIZE tordini-k-tipo-SPLITBUF
           MOVE tor-tipo(1:1) TO tordini-k-tipo-SPLITBUF(1:1)
           MOVE tor-chiave(1:12) TO tordini-k-tipo-SPLITBUF(2:12)
           .

       tordini-k-data-MERGE-SPLITBUF.
           INITIALIZE tordini-k-data-SPLITBUF
           MOVE tor-data-creazione(1:8) TO tordini-k-data-SPLITBUF(1:8)
           MOVE tor-numero(1:8) TO tordini-k-data-SPLITBUF(9:8)
           .

       tordini-k-agfatt-MERGE-SPLITBUF.
           INITIALIZE tordini-k-agfatt-SPLITBUF
           MOVE tor-anno-fattura(1:4) TO tordini-k-agfatt-SPLITBUF(1:4)
           MOVE tor-data-fattura(1:8) TO tordini-k-agfatt-SPLITBUF(5:8)
           MOVE tor-num-fattura(1:8) TO tordini-k-agfatt-SPLITBUF(13:8)
           MOVE tor-num-prenot(1:8) TO tordini-k-agfatt-SPLITBUF(21:8)
           MOVE tor-fatt-prenotata(1:1) TO 
           tordini-k-agfatt-SPLITBUF(29:1)
           MOVE tor-chiave(1:12) TO tordini-k-agfatt-SPLITBUF(30:12)
           .

       tordini-k-stbolle-MERGE-SPLITBUF.
           INITIALIZE tordini-k-stbolle-SPLITBUF
           MOVE tor-anno-bolla(1:4) TO tordini-k-stbolle-SPLITBUF(1:4)
           MOVE tor-data-bolla(1:8) TO tordini-k-stbolle-SPLITBUF(5:8)
           MOVE tor-num-bolla(1:8) TO tordini-k-stbolle-SPLITBUF(13:8)
           MOVE tor-bolla-prenotata(1:1) TO 
           tordini-k-stbolle-SPLITBUF(21:1)
           MOVE tor-chiave(1:12) TO tordini-k-stbolle-SPLITBUF(22:12)
           .

       tordini-k-andamento-data-MERGE-SPLITBUF.
           INITIALIZE tordini-k-andamento-data-SPLITBUF
           MOVE tor-agg-contab(1:1) TO 
           tordini-k-andamento-data-SPLITBUF(1:1)
           MOVE tor-data-fattura(1:8) TO 
           tordini-k-andamento-data-SPLITBUF(2:8)
           .

       tordini-k-andamento-cliente-MERGE-SPLITBUF.
           INITIALIZE tordini-k-andamento-cliente-SPLITBUF
           MOVE tor-cod-cli(1:5) TO 
           tordini-k-andamento-cliente-SPLITBUF(1:5)
           MOVE tor-agg-contab(1:1) TO 
           tordini-k-andamento-cliente-SPLITBUF(6:1)
           MOVE tor-data-fattura(1:8) TO 
           tordini-k-andamento-cliente-SPLITBUF(7:8)
           .

       tordini-k-andamento-clides-MERGE-SPLITBUF.
           INITIALIZE tordini-k-andamento-clides-SPLITBUF
           MOVE tor-cod-cli(1:5) TO 
           tordini-k-andamento-clides-SPLITBUF(1:5)
           MOVE tor-prg-destino(1:5) TO 
           tordini-k-andamento-clides-SPLITBUF(6:5)
           MOVE tor-agg-contab(1:1) TO 
           tordini-k-andamento-clides-SPLITBUF(11:1)
           MOVE tor-data-fattura(1:8) TO 
           tordini-k-andamento-clides-SPLITBUF(12:8)
           .

       tordini-k-promo-MERGE-SPLITBUF.
           INITIALIZE tordini-k-promo-SPLITBUF
           MOVE tor-stato(1:1) TO tordini-k-promo-SPLITBUF(1:1)
           MOVE tor-promo(1:1) TO tordini-k-promo-SPLITBUF(2:1)
           MOVE tor-data-ordine(1:8) TO tordini-k-promo-SPLITBUF(3:8)
           MOVE tor-numero(1:8) TO tordini-k-promo-SPLITBUF(11:8)
           MOVE tor-cod-cli(1:5) TO tordini-k-promo-SPLITBUF(19:5)
           MOVE tor-prg-destino(1:5) TO tordini-k-promo-SPLITBUF(24:5)
           .

       tordini-k-or-MERGE-SPLITBUF.
           INITIALIZE tordini-k-or-SPLITBUF
           MOVE tor-cod-cli(1:5) TO tordini-k-or-SPLITBUF(1:5)
           MOVE tor-prg-destino(1:5) TO tordini-k-or-SPLITBUF(6:5)
           MOVE tor-num-ord-cli(1:50) TO tordini-k-or-SPLITBUF(11:50)
           .

       tordini-k-tor-inviare-MERGE-SPLITBUF.
           INITIALIZE tordini-k-tor-inviare-SPLITBUF
           MOVE tor-da-inviare OF tordini(1:1) TO 
           tordini-k-tor-inviare-SPLITBUF(1:1)
           MOVE tor-chiave OF tordini(1:12) TO 
           tordini-k-tor-inviare-SPLITBUF(2:12)
           .

       tordini-k-tor-tipocli-MERGE-SPLITBUF.
           INITIALIZE tordini-k-tor-tipocli-SPLITBUF
           MOVE tor-tipocli OF tordini(1:2) TO 
           tordini-k-tor-tipocli-SPLITBUF(1:2)
           MOVE tor-cod-cli OF tordini(1:5) TO 
           tordini-k-tor-tipocli-SPLITBUF(3:5)
           MOVE tor-prg-destino OF tordini(1:5) TO 
           tordini-k-tor-tipocli-SPLITBUF(8:5)
           MOVE tor-chiave OF tordini(1:12) TO 
           tordini-k-tor-tipocli-SPLITBUF(13:12)
           .

       tordini-k-tor-gdo-MERGE-SPLITBUF.
           INITIALIZE tordini-k-tor-gdo-SPLITBUF
           MOVE tor-gdo OF tordini(1:5) TO 
           tordini-k-tor-gdo-SPLITBUF(1:5)
           MOVE tor-cod-cli OF tordini(1:5) TO 
           tordini-k-tor-gdo-SPLITBUF(6:5)
           MOVE tor-prg-destino OF tordini(1:5) TO 
           tordini-k-tor-gdo-SPLITBUF(11:5)
           MOVE tor-chiave OF tordini(1:12) TO 
           tordini-k-tor-gdo-SPLITBUF(16:12)
           .

       DataSet1-tordini-INITSTART.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tordini-KEY1-Asc
                 MOVE Low-Value TO tor-chiave
              ELSE
                 MOVE High-Value TO tor-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tordini-INITEND.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tordini-KEY1-Asc
                 MOVE High-Value TO tor-chiave
              ELSE
                 MOVE Low-Value TO tor-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           .   

       DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-tordini-KEY1-ORDER
           END-EVALUATE
           .

       DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-tordini-KEY1-ORDER
           END-EVALUATE
           .

      * tordini
       DataSet1-tordini-START.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tordini-KEY1-Asc
                 START tordini KEY >= tor-chiave
              ELSE
                 START tordini KEY <= tor-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tordini-START-NOTGREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tordini-KEY1-Asc
                 START tordini KEY <= tor-chiave
              ELSE
                 START tordini KEY >= tor-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tordini-START-GREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tordini-KEY1-Asc
                 START tordini KEY > tor-chiave
              ELSE
                 START tordini KEY < tor-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tordini-START-LESS.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tordini-KEY1-Asc
                 START tordini KEY < tor-chiave
              ELSE
                 START tordini KEY > tor-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tordini-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeReadRecord>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tordini-LOCK
                 READ tordini WITH LOCK 
                 KEY tor-chiave
              ELSE
                 READ tordini WITH NO LOCK 
                 KEY tor-chiave
              END-IF
           END-EVALUATE
           PERFORM tordini-k-causale-MERGE-SPLITBUF
           PERFORM tordini-k1-MERGE-SPLITBUF
           PERFORM tordini-k2-MERGE-SPLITBUF
           PERFORM tordini-k-bolla-MERGE-SPLITBUF
           PERFORM tordini-k3-MERGE-SPLITBUF
           PERFORM tordini-k-fattura-MERGE-SPLITBUF
           PERFORM tordini-k4-MERGE-SPLITBUF
           PERFORM tordini-k-contab-MERGE-SPLITBUF
           PERFORM tordini-k-tipo-MERGE-SPLITBUF
           PERFORM tordini-k-data-MERGE-SPLITBUF
           PERFORM tordini-k-agfatt-MERGE-SPLITBUF
           PERFORM tordini-k-stbolle-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-data-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-cliente-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-clides-MERGE-SPLITBUF
           PERFORM tordini-k-promo-MERGE-SPLITBUF
           PERFORM tordini-k-or-MERGE-SPLITBUF
           PERFORM tordini-k-tor-inviare-MERGE-SPLITBUF
           PERFORM tordini-k-tor-tipocli-MERGE-SPLITBUF
           PERFORM tordini-k-tor-gdo-MERGE-SPLITBUF
           MOVE STATUS-tordini TO TOTEM-ERR-STAT 
           MOVE "tordini" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tordini-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeReadNext>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tordini-KEY1-Asc
                 IF DataSet1-tordini-LOCK
                    READ tordini NEXT WITH LOCK
                 ELSE
                    READ tordini NEXT WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-tordini-LOCK
                    READ tordini PREVIOUS WITH LOCK
                 ELSE
                    READ tordini PREVIOUS WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           PERFORM tordini-k-causale-MERGE-SPLITBUF
           PERFORM tordini-k1-MERGE-SPLITBUF
           PERFORM tordini-k2-MERGE-SPLITBUF
           PERFORM tordini-k-bolla-MERGE-SPLITBUF
           PERFORM tordini-k3-MERGE-SPLITBUF
           PERFORM tordini-k-fattura-MERGE-SPLITBUF
           PERFORM tordini-k4-MERGE-SPLITBUF
           PERFORM tordini-k-contab-MERGE-SPLITBUF
           PERFORM tordini-k-tipo-MERGE-SPLITBUF
           PERFORM tordini-k-data-MERGE-SPLITBUF
           PERFORM tordini-k-agfatt-MERGE-SPLITBUF
           PERFORM tordini-k-stbolle-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-data-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-cliente-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-clides-MERGE-SPLITBUF
           PERFORM tordini-k-promo-MERGE-SPLITBUF
           PERFORM tordini-k-or-MERGE-SPLITBUF
           PERFORM tordini-k-tor-inviare-MERGE-SPLITBUF
           PERFORM tordini-k-tor-tipocli-MERGE-SPLITBUF
           PERFORM tordini-k-tor-gdo-MERGE-SPLITBUF
           MOVE STATUS-tordini TO TOTEM-ERR-STAT
           MOVE "tordini" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tordini-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeReadPrev>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tordini-KEY1-Asc
                 IF DataSet1-tordini-LOCK
                    READ tordini PREVIOUS WITH LOCK
                 ELSE
                    READ tordini PREVIOUS WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-tordini-LOCK
                    READ tordini NEXT WITH LOCK
                 ELSE
                    READ tordini NEXT WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           PERFORM tordini-k-causale-MERGE-SPLITBUF
           PERFORM tordini-k1-MERGE-SPLITBUF
           PERFORM tordini-k2-MERGE-SPLITBUF
           PERFORM tordini-k-bolla-MERGE-SPLITBUF
           PERFORM tordini-k3-MERGE-SPLITBUF
           PERFORM tordini-k-fattura-MERGE-SPLITBUF
           PERFORM tordini-k4-MERGE-SPLITBUF
           PERFORM tordini-k-contab-MERGE-SPLITBUF
           PERFORM tordini-k-tipo-MERGE-SPLITBUF
           PERFORM tordini-k-data-MERGE-SPLITBUF
           PERFORM tordini-k-agfatt-MERGE-SPLITBUF
           PERFORM tordini-k-stbolle-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-data-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-cliente-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-clides-MERGE-SPLITBUF
           PERFORM tordini-k-promo-MERGE-SPLITBUF
           PERFORM tordini-k-or-MERGE-SPLITBUF
           PERFORM tordini-k-tor-inviare-MERGE-SPLITBUF
           PERFORM tordini-k-tor-tipocli-MERGE-SPLITBUF
           PERFORM tordini-k-tor-gdo-MERGE-SPLITBUF
           MOVE STATUS-tordini TO TOTEM-ERR-STAT
           MOVE "tordini" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tordini-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tordini TO TOTEM-ERR-STAT
           MOVE "tordini" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tordini-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tordini TO TOTEM-ERR-STAT
           MOVE "tordini" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tordini-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tordini TO TOTEM-ERR-STAT
           MOVE "tordini" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterDelete>
      * <TOTEM:END>
           .

       tnotacr-k-causale-MERGE-SPLITBUF.
           INITIALIZE tnotacr-k-causale-SPLITBUF
           MOVE tno-causale(1:4) TO tnotacr-k-causale-SPLITBUF(1:4)
           MOVE tno-anno(1:4) TO tnotacr-k-causale-SPLITBUF(5:4)
           MOVE tno-numero(1:8) TO tnotacr-k-causale-SPLITBUF(9:8)
           .

       tnotacr-k1-MERGE-SPLITBUF.
           INITIALIZE tnotacr-k1-SPLITBUF
           MOVE tno-cod-cli(1:5) TO tnotacr-k1-SPLITBUF(1:5)
           MOVE tno-prg-destino(1:5) TO tnotacr-k1-SPLITBUF(6:5)
           MOVE tno-anno(1:4) TO tnotacr-k1-SPLITBUF(11:4)
           MOVE tno-numero(1:8) TO tnotacr-k1-SPLITBUF(15:8)
           .

       tnotacr-k2-MERGE-SPLITBUF.
           INITIALIZE tnotacr-k2-SPLITBUF
           MOVE tno-data-passaggio-ordine(1:8) TO 
           tnotacr-k2-SPLITBUF(1:8)
           MOVE tno-anno(1:4) TO tnotacr-k2-SPLITBUF(9:4)
           MOVE tno-numero(1:8) TO tnotacr-k2-SPLITBUF(13:8)
           .

       tnotacr-k-fattura-MERGE-SPLITBUF.
           INITIALIZE tnotacr-k-fattura-SPLITBUF
           MOVE tno-anno-fattura(1:4) TO tnotacr-k-fattura-SPLITBUF(1:4)
           MOVE tno-num-fattura(1:8) TO tnotacr-k-fattura-SPLITBUF(5:8)
           .

       tnotacr-k4-MERGE-SPLITBUF.
           INITIALIZE tnotacr-k4-SPLITBUF
           MOVE tno-anno-fattura(1:4) TO tnotacr-k4-SPLITBUF(1:4)
           MOVE tno-data-fattura(1:8) TO tnotacr-k4-SPLITBUF(5:8)
           MOVE tno-num-fattura(1:8) TO tnotacr-k4-SPLITBUF(13:8)
           MOVE tno-num-prenot(1:8) TO tnotacr-k4-SPLITBUF(21:8)
           MOVE tno-fatt-prenotata(1:1) TO tnotacr-k4-SPLITBUF(29:1)
           .

       tnotacr-k-contab-MERGE-SPLITBUF.
           INITIALIZE tnotacr-k-contab-SPLITBUF
           MOVE tno-agg-contab(1:1) TO tnotacr-k-contab-SPLITBUF(1:1)
           MOVE tno-anno-fattura(1:4) TO tnotacr-k-contab-SPLITBUF(2:4)
           MOVE tno-num-fattura(1:8) TO tnotacr-k-contab-SPLITBUF(6:8)
           .

       tnotacr-k-data-MERGE-SPLITBUF.
           INITIALIZE tnotacr-k-data-SPLITBUF
           MOVE tno-data(1:8) TO tnotacr-k-data-SPLITBUF(1:8)
           MOVE tno-numero(1:8) TO tnotacr-k-data-SPLITBUF(9:8)
           .

       tnotacr-k-agfatt-MERGE-SPLITBUF.
           INITIALIZE tnotacr-k-agfatt-SPLITBUF
           MOVE tno-anno-fattura(1:4) TO tnotacr-k-agfatt-SPLITBUF(1:4)
           MOVE tno-data-fattura(1:8) TO tnotacr-k-agfatt-SPLITBUF(5:8)
           MOVE tno-num-fattura(1:8) TO tnotacr-k-agfatt-SPLITBUF(13:8)
           MOVE tno-num-prenot(1:8) TO tnotacr-k-agfatt-SPLITBUF(21:8)
           MOVE tno-fatt-prenotata(1:1) TO 
           tnotacr-k-agfatt-SPLITBUF(29:1)
           MOVE tno-chiave(1:12) TO tnotacr-k-agfatt-SPLITBUF(30:12)
           .

       tnotacr-k-andamento-data-MERGE-SPLITBUF.
           INITIALIZE tnotacr-k-andamento-data-SPLITBUF
           MOVE tno-agg-contab(1:1) TO 
           tnotacr-k-andamento-data-SPLITBUF(1:1)
           MOVE tno-data-fattura(1:8) TO 
           tnotacr-k-andamento-data-SPLITBUF(2:8)
           .

       tnotacr-k-andamento-cliente-MERGE-SPLITBUF.
           INITIALIZE tnotacr-k-andamento-cliente-SPLITBUF
           MOVE tno-cod-cli(1:5) TO 
           tnotacr-k-andamento-cliente-SPLITBUF(1:5)
           MOVE tno-agg-contab(1:1) TO 
           tnotacr-k-andamento-cliente-SPLITBUF(6:1)
           MOVE tno-data-fattura(1:8) TO 
           tnotacr-k-andamento-cliente-SPLITBUF(7:8)
           .

       tnotacr-k-andamento-clides-MERGE-SPLITBUF.
           INITIALIZE tnotacr-k-andamento-clides-SPLITBUF
           MOVE tno-cod-cli(1:5) TO 
           tnotacr-k-andamento-clides-SPLITBUF(1:5)
           MOVE tno-prg-destino(1:5) TO 
           tnotacr-k-andamento-clides-SPLITBUF(6:5)
           MOVE tno-agg-contab(1:1) TO 
           tnotacr-k-andamento-clides-SPLITBUF(11:1)
           MOVE tno-data-fattura(1:8) TO 
           tnotacr-k-andamento-clides-SPLITBUF(12:8)
           .

       DataSet1-tnotacr-INITSTART.
           IF DataSet1-tnotacr-KEY-Asc
              MOVE Low-Value TO tno-chiave
           ELSE
              MOVE High-Value TO tno-chiave
           END-IF
           .

       DataSet1-tnotacr-INITEND.
           IF DataSet1-tnotacr-KEY-Asc
              MOVE High-Value TO tno-chiave
           ELSE
              MOVE Low-Value TO tno-chiave
           END-IF
           .

      * tnotacr
       DataSet1-tnotacr-START.
           IF DataSet1-tnotacr-KEY-Asc
              START tnotacr KEY >= tno-chiave
           ELSE
              START tnotacr KEY <= tno-chiave
           END-IF
           .

       DataSet1-tnotacr-START-NOTGREATER.
           IF DataSet1-tnotacr-KEY-Asc
              START tnotacr KEY <= tno-chiave
           ELSE
              START tnotacr KEY >= tno-chiave
           END-IF
           .

       DataSet1-tnotacr-START-GREATER.
           IF DataSet1-tnotacr-KEY-Asc
              START tnotacr KEY > tno-chiave
           ELSE
              START tnotacr KEY < tno-chiave
           END-IF
           .

       DataSet1-tnotacr-START-LESS.
           IF DataSet1-tnotacr-KEY-Asc
              START tnotacr KEY < tno-chiave
           ELSE
              START tnotacr KEY > tno-chiave
           END-IF
           .

       DataSet1-tnotacr-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tnotacr-LOCK
              READ tnotacr WITH LOCK 
              KEY tno-chiave
           ELSE
              READ tnotacr WITH NO LOCK 
              KEY tno-chiave
           END-IF
           PERFORM tnotacr-k-causale-MERGE-SPLITBUF
           PERFORM tnotacr-k1-MERGE-SPLITBUF
           PERFORM tnotacr-k2-MERGE-SPLITBUF
           PERFORM tnotacr-k-fattura-MERGE-SPLITBUF
           PERFORM tnotacr-k4-MERGE-SPLITBUF
           PERFORM tnotacr-k-contab-MERGE-SPLITBUF
           PERFORM tnotacr-k-data-MERGE-SPLITBUF
           PERFORM tnotacr-k-agfatt-MERGE-SPLITBUF
           PERFORM tnotacr-k-andamento-data-MERGE-SPLITBUF
           PERFORM tnotacr-k-andamento-cliente-MERGE-SPLITBUF
           PERFORM tnotacr-k-andamento-clides-MERGE-SPLITBUF
           MOVE STATUS-tnotacr TO TOTEM-ERR-STAT 
           MOVE "tnotacr" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tnotacr-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tnotacr-KEY-Asc
              IF DataSet1-tnotacr-LOCK
                 READ tnotacr NEXT WITH LOCK
              ELSE
                 READ tnotacr NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tnotacr-LOCK
                 READ tnotacr PREVIOUS WITH LOCK
              ELSE
                 READ tnotacr PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tnotacr-k-causale-MERGE-SPLITBUF
           PERFORM tnotacr-k1-MERGE-SPLITBUF
           PERFORM tnotacr-k2-MERGE-SPLITBUF
           PERFORM tnotacr-k-fattura-MERGE-SPLITBUF
           PERFORM tnotacr-k4-MERGE-SPLITBUF
           PERFORM tnotacr-k-contab-MERGE-SPLITBUF
           PERFORM tnotacr-k-data-MERGE-SPLITBUF
           PERFORM tnotacr-k-agfatt-MERGE-SPLITBUF
           PERFORM tnotacr-k-andamento-data-MERGE-SPLITBUF
           PERFORM tnotacr-k-andamento-cliente-MERGE-SPLITBUF
           PERFORM tnotacr-k-andamento-clides-MERGE-SPLITBUF
           MOVE STATUS-tnotacr TO TOTEM-ERR-STAT
           MOVE "tnotacr" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tnotacr-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tnotacr-KEY-Asc
              IF DataSet1-tnotacr-LOCK
                 READ tnotacr PREVIOUS WITH LOCK
              ELSE
                 READ tnotacr PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tnotacr-LOCK
                 READ tnotacr NEXT WITH LOCK
              ELSE
                 READ tnotacr NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tnotacr-k-causale-MERGE-SPLITBUF
           PERFORM tnotacr-k1-MERGE-SPLITBUF
           PERFORM tnotacr-k2-MERGE-SPLITBUF
           PERFORM tnotacr-k-fattura-MERGE-SPLITBUF
           PERFORM tnotacr-k4-MERGE-SPLITBUF
           PERFORM tnotacr-k-contab-MERGE-SPLITBUF
           PERFORM tnotacr-k-data-MERGE-SPLITBUF
           PERFORM tnotacr-k-agfatt-MERGE-SPLITBUF
           PERFORM tnotacr-k-andamento-data-MERGE-SPLITBUF
           PERFORM tnotacr-k-andamento-cliente-MERGE-SPLITBUF
           PERFORM tnotacr-k-andamento-clides-MERGE-SPLITBUF
           MOVE STATUS-tnotacr TO TOTEM-ERR-STAT
           MOVE "tnotacr" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tnotacr-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tnotacr TO TOTEM-ERR-STAT
           MOVE "tnotacr" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tnotacr-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tnotacr TO TOTEM-ERR-STAT
           MOVE "tnotacr" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tnotacr-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tnotacr TO TOTEM-ERR-STAT
           MOVE "tnotacr" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tparamge-INITSTART.
           IF DataSet1-tparamge-KEY-Asc
              MOVE Low-Value TO tge-chiave
           ELSE
              MOVE High-Value TO tge-chiave
           END-IF
           .

       DataSet1-tparamge-INITEND.
           IF DataSet1-tparamge-KEY-Asc
              MOVE High-Value TO tge-chiave
           ELSE
              MOVE Low-Value TO tge-chiave
           END-IF
           .

      * tparamge
       DataSet1-tparamge-START.
           IF DataSet1-tparamge-KEY-Asc
              START tparamge KEY >= tge-chiave
           ELSE
              START tparamge KEY <= tge-chiave
           END-IF
           .

       DataSet1-tparamge-START-NOTGREATER.
           IF DataSet1-tparamge-KEY-Asc
              START tparamge KEY <= tge-chiave
           ELSE
              START tparamge KEY >= tge-chiave
           END-IF
           .

       DataSet1-tparamge-START-GREATER.
           IF DataSet1-tparamge-KEY-Asc
              START tparamge KEY > tge-chiave
           ELSE
              START tparamge KEY < tge-chiave
           END-IF
           .

       DataSet1-tparamge-START-LESS.
           IF DataSet1-tparamge-KEY-Asc
              START tparamge KEY < tge-chiave
           ELSE
              START tparamge KEY > tge-chiave
           END-IF
           .

       DataSet1-tparamge-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tparamge-LOCK
              READ tparamge WITH LOCK 
              KEY tge-chiave
           ELSE
              READ tparamge WITH NO LOCK 
              KEY tge-chiave
           END-IF
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT 
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tparamge-KEY-Asc
              IF DataSet1-tparamge-LOCK
                 READ tparamge NEXT WITH LOCK
              ELSE
                 READ tparamge NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tparamge-LOCK
                 READ tparamge PREVIOUS WITH LOCK
              ELSE
                 READ tparamge PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tparamge-KEY-Asc
              IF DataSet1-tparamge-LOCK
                 READ tparamge PREVIOUS WITH LOCK
              ELSE
                 READ tparamge PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tparamge-LOCK
                 READ tparamge NEXT WITH LOCK
              ELSE
                 READ tparamge NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterDelete>
      * <TOTEM:END>
           .

       zoom-tno-fat-zoom-tno-fat-key01-MERGE-SPLITBUF.
           INITIALIZE zoom-tno-fat-zoom-tno-fat-key01-SPLITBUF
           MOVE zoom-tno-fat-chiave(1:12) TO 
           zoom-tno-fat-zoom-tno-fat-key01-SPLITBUF(1:12)
           .

       zoom-tno-fat-zoom-tno-fat-key01-SPLITBUF-TOFLD.
           MOVE zoom-tno-fat-zoom-tno-fat-key01-SPLITBUF(1:12) TO 
           zoom-tno-fat-chiave(1:12)
           .

       DataSet1-zoom-tno-fat-INITSTART.
           IF DataSet1-zoom-tno-fat-KEY-Asc
              MOVE Low-Value TO zoom-tno-fat-chiave
           ELSE
              MOVE High-Value TO zoom-tno-fat-chiave
           END-IF
           .

       DataSet1-zoom-tno-fat-INITEND.
           IF DataSet1-zoom-tno-fat-KEY-Asc
              MOVE High-Value to zoom-tno-fat-chiave
           ELSE
              MOVE Low-Value to zoom-tno-fat-chiave
           END-IF
           .

       DataSet1-zoom-tno-fat-TMPBUF-TO-FLD.
           MOVE DataSet1-zoom-tno-fat-SPLIT-BUF1(1:12) TO
                zoom-tno-fat-chiave(1:12)
           .

       DataSet1-zoom-tno-fat-FLD-TO-TMPBUF.
           MOVE zoom-tno-fat-chiave(1:12) TO
                DataSet1-zoom-tno-fat-SPLIT-BUF1(1:12)
           .

      * zoom-tno-fat
       DataSet1-zoom-tno-fat-START.
           IF DataSet1-zoom-tno-fat-KEY-Asc
              START zoom-tno-fat KEY >= zoom-tno-fat-key01
           ELSE
              START zoom-tno-fat KEY <= zoom-tno-fat-key01
           END-IF
           .

       DataSet1-zoom-tno-fat-START-NOTGREATER.
           IF DataSet1-zoom-tno-fat-KEY-Asc
              START zoom-tno-fat KEY <= zoom-tno-fat-key01
           ELSE
              START zoom-tno-fat KEY >= zoom-tno-fat-key01
           END-IF
           .

       DataSet1-zoom-tno-fat-START-GREATER.
           IF DataSet1-zoom-tno-fat-KEY-Asc
              START zoom-tno-fat KEY > zoom-tno-fat-key01
           ELSE
              START zoom-tno-fat KEY < zoom-tno-fat-key01
           END-IF
           .

       DataSet1-zoom-tno-fat-START-LESS.
           IF DataSet1-zoom-tno-fat-KEY-Asc
              START zoom-tno-fat KEY < zoom-tno-fat-key01
           ELSE
              START zoom-tno-fat KEY > zoom-tno-fat-key01
           END-IF
           .

       DataSet1-zoom-tno-fat-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tno-fat, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tno-fat, BeforeReadRecord>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tno-fat, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tno-fat, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-zoom-tno-fat-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tno-fat, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tno-fat, BeforeReadNext>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tno-fat, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tno-fat, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-zoom-tno-fat-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tno-fat, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tno-fat, BeforeReadPrev>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tno-fat, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tno-fat, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-zoom-tno-fat-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tno-fat, BeforeWrite>
      * <TOTEM:END>
           WRITE zoom-tno-fat-rec OF zoom-tno-fat.
           MOVE STATUS-zoom-tno-fat TO TOTEM-ERR-STAT
           MOVE "zoom-tno-fat" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tno-fat, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-zoom-tno-fat-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tno-fat, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-zoom-tno-fat TO TOTEM-ERR-STAT
           MOVE "zoom-tno-fat" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tno-fat, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-zoom-tno-fat-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tno-fat, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-zoom-tno-fat TO TOTEM-ERR-STAT
           MOVE "zoom-tno-fat" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tno-fat, AfterDelete>
      * <TOTEM:END>
           .

       zoom-tor-fat-zoom-tor-fat-key01-MERGE-SPLITBUF.
           INITIALIZE zoom-tor-fat-zoom-tor-fat-key01-SPLITBUF
           MOVE zoom-tor-fat-chiave(1:12) TO 
           zoom-tor-fat-zoom-tor-fat-key01-SPLITBUF(1:12)
           .

       zoom-tor-fat-zoom-tor-fat-key01-SPLITBUF-TOFLD.
           MOVE zoom-tor-fat-zoom-tor-fat-key01-SPLITBUF(1:12) TO 
           zoom-tor-fat-chiave(1:12)
           .

       DataSet1-zoom-tor-fat-INITSTART.
           IF DataSet1-zoom-tor-fat-KEY-Asc
              MOVE Low-Value TO zoom-tor-fat-chiave
           ELSE
              MOVE High-Value TO zoom-tor-fat-chiave
           END-IF
           .

       DataSet1-zoom-tor-fat-INITEND.
           IF DataSet1-zoom-tor-fat-KEY-Asc
              MOVE High-Value to zoom-tor-fat-chiave
           ELSE
              MOVE Low-Value to zoom-tor-fat-chiave
           END-IF
           .

       DataSet1-zoom-tor-fat-TMPBUF-TO-FLD.
           MOVE DataSet1-zoom-tor-fat-SPLIT-BUF1(1:12) TO
                zoom-tor-fat-chiave(1:12)
           .

       DataSet1-zoom-tor-fat-FLD-TO-TMPBUF.
           MOVE zoom-tor-fat-chiave(1:12) TO
                DataSet1-zoom-tor-fat-SPLIT-BUF1(1:12)
           .

      * zoom-tor-fat
       DataSet1-zoom-tor-fat-START.
           IF DataSet1-zoom-tor-fat-KEY-Asc
              START zoom-tor-fat KEY >= zoom-tor-fat-key01
           ELSE
              START zoom-tor-fat KEY <= zoom-tor-fat-key01
           END-IF
           .

       DataSet1-zoom-tor-fat-START-NOTGREATER.
           IF DataSet1-zoom-tor-fat-KEY-Asc
              START zoom-tor-fat KEY <= zoom-tor-fat-key01
           ELSE
              START zoom-tor-fat KEY >= zoom-tor-fat-key01
           END-IF
           .

       DataSet1-zoom-tor-fat-START-GREATER.
           IF DataSet1-zoom-tor-fat-KEY-Asc
              START zoom-tor-fat KEY > zoom-tor-fat-key01
           ELSE
              START zoom-tor-fat KEY < zoom-tor-fat-key01
           END-IF
           .

       DataSet1-zoom-tor-fat-START-LESS.
           IF DataSet1-zoom-tor-fat-KEY-Asc
              START zoom-tor-fat KEY < zoom-tor-fat-key01
           ELSE
              START zoom-tor-fat KEY > zoom-tor-fat-key01
           END-IF
           .

       DataSet1-zoom-tor-fat-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tor-fat, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tor-fat, BeforeReadRecord>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tor-fat, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tor-fat, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-zoom-tor-fat-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tor-fat, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tor-fat, BeforeReadNext>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tor-fat, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tor-fat, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-zoom-tor-fat-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tor-fat, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tor-fat, BeforeReadPrev>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tor-fat, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tor-fat, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-zoom-tor-fat-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tor-fat, BeforeWrite>
      * <TOTEM:END>
           WRITE zoom-tor-fat-rec OF zoom-tor-fat.
           MOVE STATUS-zoom-tor-fat TO TOTEM-ERR-STAT
           MOVE "zoom-tor-fat" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tor-fat, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-zoom-tor-fat-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tor-fat, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-zoom-tor-fat TO TOTEM-ERR-STAT
           MOVE "zoom-tor-fat" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tor-fat, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-zoom-tor-fat-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tor-fat, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-zoom-tor-fat TO TOTEM-ERR-STAT
           MOVE "zoom-tor-fat" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tor-fat, AfterDelete>
      * <TOTEM:END>
           .

       zoom-tor-bolle-zoom-tor-bol-key01-MERGE-SPLITBUF.
           INITIALIZE zoom-tor-bolle-zoom-tor-bol-key01-SPLITBUF
           MOVE zoom-tor-bol-chiave(1:12) TO 
           zoom-tor-bolle-zoom-tor-bol-key01-SPLITBUF(1:12)
           .

       zoom-tor-bolle-zoom-tor-bol-key01-SPLITBUF-TOFLD.
           MOVE zoom-tor-bolle-zoom-tor-bol-key01-SPLITBUF(1:12) TO 
           zoom-tor-bol-chiave(1:12)
           .

       DataSet1-zoom-tor-bolle-INITSTART.
           IF DataSet1-zoom-tor-bolle-KEY-Asc
              MOVE Low-Value TO zoom-tor-bol-chiave
           ELSE
              MOVE High-Value TO zoom-tor-bol-chiave
           END-IF
           .

       DataSet1-zoom-tor-bolle-INITEND.
           IF DataSet1-zoom-tor-bolle-KEY-Asc
              MOVE High-Value to zoom-tor-bol-chiave
           ELSE
              MOVE Low-Value to zoom-tor-bol-chiave
           END-IF
           .

       DataSet1-zoom-tor-bolle-TMPBUF-TO-FLD.
           MOVE DataSet1-zoom-tor-bolle-SPLIT-BUF1(1:12) TO
                zoom-tor-bol-chiave(1:12)
           .

       DataSet1-zoom-tor-bolle-FLD-TO-TMPBUF.
           MOVE zoom-tor-bol-chiave(1:12) TO
                DataSet1-zoom-tor-bolle-SPLIT-BUF1(1:12)
           .

      * zoom-tor-bolle
       DataSet1-zoom-tor-bolle-START.
           IF DataSet1-zoom-tor-bolle-KEY-Asc
              START zoom-tor-bolle KEY >= zoom-tor-bol-key01
           ELSE
              START zoom-tor-bolle KEY <= zoom-tor-bol-key01
           END-IF
           .

       DataSet1-zoom-tor-bolle-START-NOTGREATER.
           IF DataSet1-zoom-tor-bolle-KEY-Asc
              START zoom-tor-bolle KEY <= zoom-tor-bol-key01
           ELSE
              START zoom-tor-bolle KEY >= zoom-tor-bol-key01
           END-IF
           .

       DataSet1-zoom-tor-bolle-START-GREATER.
           IF DataSet1-zoom-tor-bolle-KEY-Asc
              START zoom-tor-bolle KEY > zoom-tor-bol-key01
           ELSE
              START zoom-tor-bolle KEY < zoom-tor-bol-key01
           END-IF
           .

       DataSet1-zoom-tor-bolle-START-LESS.
           IF DataSet1-zoom-tor-bolle-KEY-Asc
              START zoom-tor-bolle KEY < zoom-tor-bol-key01
           ELSE
              START zoom-tor-bolle KEY > zoom-tor-bol-key01
           END-IF
           .

       DataSet1-zoom-tor-bolle-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tor-bolle, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tor-bolle, BeforeReadRecord>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tor-bolle, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tor-bolle, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-zoom-tor-bolle-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tor-bolle, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tor-bolle, BeforeReadNext>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tor-bolle, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tor-bolle, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-zoom-tor-bolle-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tor-bolle, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tor-bolle, BeforeReadPrev>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tor-bolle, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tor-bolle, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-zoom-tor-bolle-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tor-bolle, BeforeWrite>
      * <TOTEM:END>
           WRITE zoom-tor-bol-rec OF zoom-tor-bolle.
           MOVE STATUS-zoom-tor-bolle TO TOTEM-ERR-STAT
           MOVE "zoom-tor-bolle" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tor-bolle, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-zoom-tor-bolle-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tor-bolle, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-zoom-tor-bolle TO TOTEM-ERR-STAT
           MOVE "zoom-tor-bolle" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tor-bolle, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-zoom-tor-bolle-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tor-bolle, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-zoom-tor-bolle TO TOTEM-ERR-STAT
           MOVE "zoom-tor-bolle" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-tor-bolle, AfterDelete>
      * <TOTEM:END>
           .

       clienti-cli-K1-MERGE-SPLITBUF.
           INITIALIZE clienti-cli-K1-SPLITBUF
           MOVE cli-tipo-CF OF clienti(1:1) TO 
           clienti-cli-K1-SPLITBUF(1:1)
           MOVE cli-ragsoc-1 OF clienti(1:40) TO 
           clienti-cli-K1-SPLITBUF(2:40)
           MOVE cli-codice OF clienti(1:5) TO 
           clienti-cli-K1-SPLITBUF(42:5)
           .

       clienti-cli-K3-MERGE-SPLITBUF.
           INITIALIZE clienti-cli-K3-SPLITBUF
           MOVE cli-gdo OF clienti(1:5) TO clienti-cli-K3-SPLITBUF(1:5)
           MOVE cli-chiave OF clienti(1:6) TO 
           clienti-cli-K3-SPLITBUF(6:6)
           .

       clienti-cli-K4-MERGE-SPLITBUF.
           INITIALIZE clienti-cli-K4-SPLITBUF
           MOVE cli-utf OF clienti(1:1) TO clienti-cli-K4-SPLITBUF(1:1)
           MOVE cli-chiave OF clienti(1:6) TO 
           clienti-cli-K4-SPLITBUF(2:6)
           .

       DataSet1-clienti-INITSTART.
           IF DataSet1-clienti-KEY-Asc
              MOVE Low-Value TO cli-chiave OF clienti
           ELSE
              MOVE High-Value TO cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-INITEND.
           IF DataSet1-clienti-KEY-Asc
              MOVE High-Value TO cli-chiave OF clienti
           ELSE
              MOVE Low-Value TO cli-chiave OF clienti
           END-IF
           .

      * clienti
       DataSet1-clienti-START.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY >= cli-chiave OF clienti
           ELSE
              START clienti KEY <= cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-START-NOTGREATER.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY <= cli-chiave OF clienti
           ELSE
              START clienti KEY >= cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-START-GREATER.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY > cli-chiave OF clienti
           ELSE
              START clienti KEY < cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-START-LESS.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY < cli-chiave OF clienti
           ELSE
              START clienti KEY > cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-clienti-LOCK
              READ clienti WITH LOCK 
              KEY cli-chiave OF clienti
           ELSE
              READ clienti WITH NO LOCK 
              KEY cli-chiave OF clienti
           END-IF
           PERFORM clienti-cli-K1-MERGE-SPLITBUF
           PERFORM clienti-cli-K3-MERGE-SPLITBUF
           PERFORM clienti-cli-K4-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT 
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-clienti-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-clienti-KEY-Asc
              IF DataSet1-clienti-LOCK
                 READ clienti NEXT WITH LOCK
              ELSE
                 READ clienti NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-clienti-LOCK
                 READ clienti PREVIOUS WITH LOCK
              ELSE
                 READ clienti PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM clienti-cli-K1-MERGE-SPLITBUF
           PERFORM clienti-cli-K3-MERGE-SPLITBUF
           PERFORM clienti-cli-K4-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-clienti-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-clienti-KEY-Asc
              IF DataSet1-clienti-LOCK
                 READ clienti PREVIOUS WITH LOCK
              ELSE
                 READ clienti PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-clienti-LOCK
                 READ clienti NEXT WITH LOCK
              ELSE
                 READ clienti NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM clienti-cli-K1-MERGE-SPLITBUF
           PERFORM clienti-cli-K3-MERGE-SPLITBUF
           PERFORM clienti-cli-K4-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterDelete>
      * <TOTEM:END>
           .

       destini-K1-MERGE-SPLITBUF.
           INITIALIZE destini-K1-SPLITBUF
           MOVE des-ragsoc-1(1:100) TO destini-K1-SPLITBUF(1:100)
           MOVE des-codice(1:5) TO destini-K1-SPLITBUF(101:5)
           MOVE des-prog(1:5) TO destini-K1-SPLITBUF(106:5)
           .

       destini-k-localita-MERGE-SPLITBUF.
           INITIALIZE destini-k-localita-SPLITBUF
           MOVE des-localita(1:35) TO destini-k-localita-SPLITBUF(1:35)
           .

       DataSet1-destini-INITSTART.
           IF DataSet1-destini-KEY-Asc
              MOVE Low-Value TO des-chiave
           ELSE
              MOVE High-Value TO des-chiave
           END-IF
           .

       DataSet1-destini-INITEND.
           IF DataSet1-destini-KEY-Asc
              MOVE High-Value TO des-chiave
           ELSE
              MOVE Low-Value TO des-chiave
           END-IF
           .

      * destini
       DataSet1-destini-START.
           IF DataSet1-destini-KEY-Asc
              START destini KEY >= des-chiave
           ELSE
              START destini KEY <= des-chiave
           END-IF
           .

       DataSet1-destini-START-NOTGREATER.
           IF DataSet1-destini-KEY-Asc
              START destini KEY <= des-chiave
           ELSE
              START destini KEY >= des-chiave
           END-IF
           .

       DataSet1-destini-START-GREATER.
           IF DataSet1-destini-KEY-Asc
              START destini KEY > des-chiave
           ELSE
              START destini KEY < des-chiave
           END-IF
           .

       DataSet1-destini-START-LESS.
           IF DataSet1-destini-KEY-Asc
              START destini KEY < des-chiave
           ELSE
              START destini KEY > des-chiave
           END-IF
           .

       DataSet1-destini-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-destini-LOCK
              READ destini WITH LOCK 
              KEY des-chiave
           ELSE
              READ destini WITH NO LOCK 
              KEY des-chiave
           END-IF
           PERFORM destini-K1-MERGE-SPLITBUF
           PERFORM destini-k-localita-MERGE-SPLITBUF
           MOVE STATUS-destini TO TOTEM-ERR-STAT 
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-destini-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-destini-KEY-Asc
              IF DataSet1-destini-LOCK
                 READ destini NEXT WITH LOCK
              ELSE
                 READ destini NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-destini-LOCK
                 READ destini PREVIOUS WITH LOCK
              ELSE
                 READ destini PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM destini-K1-MERGE-SPLITBUF
           PERFORM destini-k-localita-MERGE-SPLITBUF
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-destini-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-destini-KEY-Asc
              IF DataSet1-destini-LOCK
                 READ destini PREVIOUS WITH LOCK
              ELSE
                 READ destini PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-destini-LOCK
                 READ destini NEXT WITH LOCK
              ELSE
                 READ destini NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM destini-K1-MERGE-SPLITBUF
           PERFORM destini-k-localita-MERGE-SPLITBUF
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-destini-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-destini-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-destini-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterDelete>
      * <TOTEM:END>
           .

       tcaumag-k-mag-MERGE-SPLITBUF.
           INITIALIZE tcaumag-k-mag-SPLITBUF
           MOVE tca-cod-magaz(1:3) TO tcaumag-k-mag-SPLITBUF(1:3)
           MOVE tca-ord-forn(1:1) TO tcaumag-k-mag-SPLITBUF(4:1)
           .

       DataSet1-tcaumag-INITSTART.
           IF DataSet1-tcaumag-KEY-Asc
              MOVE Low-Value TO tca-chiave
           ELSE
              MOVE High-Value TO tca-chiave
           END-IF
           .

       DataSet1-tcaumag-INITEND.
           IF DataSet1-tcaumag-KEY-Asc
              MOVE High-Value TO tca-chiave
           ELSE
              MOVE Low-Value TO tca-chiave
           END-IF
           .

      * tcaumag
       DataSet1-tcaumag-START.
           IF DataSet1-tcaumag-KEY-Asc
              START tcaumag KEY >= tca-chiave
           ELSE
              START tcaumag KEY <= tca-chiave
           END-IF
           .

       DataSet1-tcaumag-START-NOTGREATER.
           IF DataSet1-tcaumag-KEY-Asc
              START tcaumag KEY <= tca-chiave
           ELSE
              START tcaumag KEY >= tca-chiave
           END-IF
           .

       DataSet1-tcaumag-START-GREATER.
           IF DataSet1-tcaumag-KEY-Asc
              START tcaumag KEY > tca-chiave
           ELSE
              START tcaumag KEY < tca-chiave
           END-IF
           .

       DataSet1-tcaumag-START-LESS.
           IF DataSet1-tcaumag-KEY-Asc
              START tcaumag KEY < tca-chiave
           ELSE
              START tcaumag KEY > tca-chiave
           END-IF
           .

       DataSet1-tcaumag-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tcaumag-LOCK
              READ tcaumag WITH LOCK 
              KEY tca-chiave
           ELSE
              READ tcaumag WITH NO LOCK 
              KEY tca-chiave
           END-IF
           PERFORM tcaumag-k-mag-MERGE-SPLITBUF
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT 
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tcaumag-KEY-Asc
              IF DataSet1-tcaumag-LOCK
                 READ tcaumag NEXT WITH LOCK
              ELSE
                 READ tcaumag NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tcaumag-LOCK
                 READ tcaumag PREVIOUS WITH LOCK
              ELSE
                 READ tcaumag PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tcaumag-k-mag-MERGE-SPLITBUF
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tcaumag-KEY-Asc
              IF DataSet1-tcaumag-LOCK
                 READ tcaumag PREVIOUS WITH LOCK
              ELSE
                 READ tcaumag PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tcaumag-LOCK
                 READ tcaumag NEXT WITH LOCK
              ELSE
                 READ tcaumag NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tcaumag-k-mag-MERGE-SPLITBUF
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterDelete>
      * <TOTEM:END>
           .

       tvettori-k-des-MERGE-SPLITBUF.
           INITIALIZE tvettori-k-des-SPLITBUF
           MOVE vet-descrizione(1:40) TO tvettori-k-des-SPLITBUF(1:40)
           .

       DataSet1-tvettori-INITSTART.
           IF DataSet1-tvettori-KEY-Asc
              MOVE Low-Value TO vet-chiave
           ELSE
              MOVE High-Value TO vet-chiave
           END-IF
           .

       DataSet1-tvettori-INITEND.
           IF DataSet1-tvettori-KEY-Asc
              MOVE High-Value TO vet-chiave
           ELSE
              MOVE Low-Value TO vet-chiave
           END-IF
           .

      * tvettori
       DataSet1-tvettori-START.
           IF DataSet1-tvettori-KEY-Asc
              START tvettori KEY >= vet-chiave
           ELSE
              START tvettori KEY <= vet-chiave
           END-IF
           .

       DataSet1-tvettori-START-NOTGREATER.
           IF DataSet1-tvettori-KEY-Asc
              START tvettori KEY <= vet-chiave
           ELSE
              START tvettori KEY >= vet-chiave
           END-IF
           .

       DataSet1-tvettori-START-GREATER.
           IF DataSet1-tvettori-KEY-Asc
              START tvettori KEY > vet-chiave
           ELSE
              START tvettori KEY < vet-chiave
           END-IF
           .

       DataSet1-tvettori-START-LESS.
           IF DataSet1-tvettori-KEY-Asc
              START tvettori KEY < vet-chiave
           ELSE
              START tvettori KEY > vet-chiave
           END-IF
           .

       DataSet1-tvettori-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tvettori-LOCK
              READ tvettori WITH LOCK 
              KEY vet-chiave
           ELSE
              READ tvettori WITH NO LOCK 
              KEY vet-chiave
           END-IF
           PERFORM tvettori-k-des-MERGE-SPLITBUF
           MOVE STATUS-tvettori TO TOTEM-ERR-STAT 
           MOVE "tvettori" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tvettori-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tvettori-KEY-Asc
              IF DataSet1-tvettori-LOCK
                 READ tvettori NEXT WITH LOCK
              ELSE
                 READ tvettori NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tvettori-LOCK
                 READ tvettori PREVIOUS WITH LOCK
              ELSE
                 READ tvettori PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tvettori-k-des-MERGE-SPLITBUF
           MOVE STATUS-tvettori TO TOTEM-ERR-STAT
           MOVE "tvettori" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tvettori-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tvettori-KEY-Asc
              IF DataSet1-tvettori-LOCK
                 READ tvettori PREVIOUS WITH LOCK
              ELSE
                 READ tvettori PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tvettori-LOCK
                 READ tvettori NEXT WITH LOCK
              ELSE
                 READ tvettori NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tvettori-k-des-MERGE-SPLITBUF
           MOVE STATUS-tvettori TO TOTEM-ERR-STAT
           MOVE "tvettori" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tvettori-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tvettori TO TOTEM-ERR-STAT
           MOVE "tvettori" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tvettori-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tvettori TO TOTEM-ERR-STAT
           MOVE "tvettori" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tvettori-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tvettori TO TOTEM-ERR-STAT
           MOVE "tvettori" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterDelete>
      * <TOTEM:END>
           .

       tmp-solleciti-k-evasione-MERGE-SPLITBUF.
           INITIALIZE tmp-solleciti-k-evasione-SPLITBUF
           MOVE tmp-sol-evasione(1:12) TO 
           tmp-solleciti-k-evasione-SPLITBUF(1:12)
           .

       tmp-solleciti-k-evasione-SPLITBUF-TOFLD.
           MOVE tmp-solleciti-k-evasione-SPLITBUF(1:12) TO 
           tmp-sol-evasione(1:12)
           .

       tmp-solleciti-k-bolla-MERGE-SPLITBUF.
           INITIALIZE tmp-solleciti-k-bolla-SPLITBUF
           MOVE tmp-sol-bolla(1:16) TO 
           tmp-solleciti-k-bolla-SPLITBUF(1:16)
           .

       tmp-solleciti-k-fatt-MERGE-SPLITBUF.
           INITIALIZE tmp-solleciti-k-fatt-SPLITBUF
           MOVE tmp-sol-fatt(1:16) TO 
           tmp-solleciti-k-fatt-SPLITBUF(1:16)
           .

       DataSet1-tmp-solleciti-INITSTART.
           IF DataSet1-tmp-solleciti-KEY-Asc
              MOVE Low-Value TO tmp-sol-evasione
           ELSE
              MOVE High-Value TO tmp-sol-evasione
           END-IF
           .

       DataSet1-tmp-solleciti-INITEND.
           IF DataSet1-tmp-solleciti-KEY-Asc
              MOVE High-Value to tmp-sol-evasione
           ELSE
              MOVE Low-Value to tmp-sol-evasione
           END-IF
           .

       DataSet1-tmp-solleciti-TMPBUF-TO-FLD.
           MOVE DataSet1-tmp-solleciti-SPLIT-BUF1(1:12) TO
                tmp-sol-evasione(1:12)
           .

       DataSet1-tmp-solleciti-FLD-TO-TMPBUF.
           MOVE tmp-sol-evasione(1:12) TO
                DataSet1-tmp-solleciti-SPLIT-BUF1(1:12)
           .

      * tmp-solleciti
       DataSet1-tmp-solleciti-START.
           IF DataSet1-tmp-solleciti-KEY-Asc
              START tmp-solleciti KEY >= k-evasione
           ELSE
              START tmp-solleciti KEY <= k-evasione
           END-IF
           .

       DataSet1-tmp-solleciti-START-NOTGREATER.
           IF DataSet1-tmp-solleciti-KEY-Asc
              START tmp-solleciti KEY <= k-evasione
           ELSE
              START tmp-solleciti KEY >= k-evasione
           END-IF
           .

       DataSet1-tmp-solleciti-START-GREATER.
           IF DataSet1-tmp-solleciti-KEY-Asc
              START tmp-solleciti KEY > k-evasione
           ELSE
              START tmp-solleciti KEY < k-evasione
           END-IF
           .

       DataSet1-tmp-solleciti-START-LESS.
           IF DataSet1-tmp-solleciti-KEY-Asc
              START tmp-solleciti KEY < k-evasione
           ELSE
              START tmp-solleciti KEY > k-evasione
           END-IF
           .

       DataSet1-tmp-solleciti-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-solleciti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-solleciti, BeforeReadRecord>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-solleciti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-solleciti, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tmp-solleciti-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-solleciti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-solleciti, BeforeReadNext>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-solleciti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-solleciti, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tmp-solleciti-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-solleciti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-solleciti, BeforeReadPrev>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-solleciti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-solleciti, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tmp-solleciti-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-solleciti, BeforeWrite>
      * <TOTEM:END>
           WRITE tmp-sol-rec OF tmp-solleciti.
           MOVE status-tmp-solleciti TO TOTEM-ERR-STAT
           MOVE "tmp-solleciti" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-solleciti, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tmp-solleciti-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-solleciti, BeforeRewrite>
      * <TOTEM:END>
           MOVE status-tmp-solleciti TO TOTEM-ERR-STAT
           MOVE "tmp-solleciti" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-solleciti, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tmp-solleciti-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-solleciti, BeforeDelete>
      * <TOTEM:END>
           MOVE status-tmp-solleciti TO TOTEM-ERR-STAT
           MOVE "tmp-solleciti" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-solleciti, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-INIT-RECORD.
           INITIALIZE tor-rec OF tordini
           INITIALIZE tno-rec OF tnotacr
           INITIALIZE tge-rec OF tparamge
           INITIALIZE zoom-tno-fat-rec OF zoom-tno-fat
           INITIALIZE zoom-tor-fat-rec OF zoom-tor-fat
           INITIALIZE zoom-tor-bol-rec OF zoom-tor-bolle
           INITIALIZE cli-rec OF clienti
           INITIALIZE des-rec OF destini
           INITIALIZE tca-rec OF tcaumag
           INITIALIZE vet-rec OF tvettori
           INITIALIZE tmp-sol-rec OF tmp-solleciti
           .


      * COMBO-BOX
       cbo-tipo-Content.
           .

      * GRID
       gd-ordini-Content.
      * CELLS' SETTING
              MODIFY gd-ordini, X = 2, Y = 1,
                CELL-DATA = "Anno",
      * CELLS' SETTING
              MODIFY gd-ordini, X = 3, Y = 1,
                CELL-DATA = "Evasione",
      * CELLS' SETTING
              MODIFY gd-ordini, X = 4, Y = 1,
                CELL-DATA = "Bolla",
      * CELLS' SETTING
              MODIFY gd-ordini, X = 5, Y = 1,
                CELL-DATA = "Dt. Bolla",
      * CELLS' SETTING
              MODIFY gd-ordini, X = 6, Y = 1,
                CELL-DATA = "Fattura",
      * CELLS' SETTING
              MODIFY gd-ordini, X = 7, Y = 1,
                CELL-DATA = "Dt. Fatt.",
      * CELLS' SETTING
              MODIFY gd-ordini, X = 8, Y = 1,
                CELL-DATA = "Ord. Cliente",
      * CELLS' SETTING
              MODIFY gd-ordini, X = 9, Y = 1,
                CELL-DATA = "Cliente",
      * CELLS' SETTING
              MODIFY gd-ordini, X = 10, Y = 1,
                CELL-DATA = "Località",
      * CELLS' SETTING
              MODIFY gd-ordini, X = 11, Y = 1,
                CELL-DATA = "Sito Vettore",
           .

      * FD's Initialize Paragraph
       DataSet1-tordini-INITREC.
           INITIALIZE tor-rec OF tordini
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tnotacr-INITREC.
           INITIALIZE tno-rec OF tnotacr
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tparamge-INITREC.
           INITIALIZE tge-rec OF tparamge
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-zoom-tno-fat-INITREC.
           INITIALIZE zoom-tno-fat-rec OF zoom-tno-fat
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-zoom-tor-fat-INITREC.
           INITIALIZE zoom-tor-fat-rec OF zoom-tor-fat
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-zoom-tor-bolle-INITREC.
           INITIALIZE zoom-tor-bol-rec OF zoom-tor-bolle
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-clienti-INITREC.
           INITIALIZE cli-rec OF clienti
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-destini-INITREC.
           INITIALIZE des-rec OF destini
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tcaumag-INITREC.
           INITIALIZE tca-rec OF tcaumag
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tvettori-INITREC.
           INITIALIZE vet-rec OF tvettori
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tmp-solleciti-INITREC.
           INITIALIZE tmp-sol-rec OF tmp-solleciti
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      *
       DataSet1-DISPATCH-BUFTOFLD.
           EVALUATE TOTEM-Form-Index ALSO TOTEM-Frame-Index
              WHEN 2 ALSO 0
                  PERFORM Form2-Buf-To-Fld
           END-EVALUATE
           .

       Form1-Open-Routine.
           PERFORM Form1-Scrn
           PERFORM Form1-Proc
           .

       Form1-Scrn.
           PERFORM Form1-Create-Win
           PERFORM Form1-Init-Value
           PERFORM Form1-Init-Data
      * Tab keystrok settings
      * Tool Bar
           DISPLAY Form1-Tb-1a
           PERFORM Form1-DISPLAY
           .

       Form1-Create-Win.
           Display Independent GRAPHICAL WINDOW
              LINES 27,44,
              SIZE 40,00,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 65793,
              CONTROL FONT Verdana12-Occidentale,
              LINK TO THREAD,
              MODELESS,
              NO SCROLL,
              TITLE-BAR,
              TITLE TITOLO,
              WITH SYSTEM MENU,
              USER-GRAY,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE Screen1-Event-Proc,
              HANDLE IS Form1-Handle,
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterCreateWin>


           .
      * <TOTEM:END>


      * Tool Bar    
           DISPLAY TOOL-BAR 
              LINES 2,67,   
              HANDLE IN Form1-Tb-1-Handlea
           DISPLAY Form1-Tb-1a UPON Form1-Tb-1-Handlea

      * Status-bar
           DISPLAY Form1 UPON Form1-Handle
      * DISPLAY-COLUMNS settings
           .

       Form1-PROC.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeAccept>
           move spaces to tge-codice.
           read tparamge no lock invalid continue end-read.
           move tge-anno to ef-anno-buf.
           move 1 to e-elenco.
           move 0 to e-ordine e-bolla e-fattura e-nc.
           modify cbo-tipo, item-to-add = "Inevasi".
           modify cbo-tipo, item-to-add = "Bolle".
           modify cbo-tipo, item-to-add = "Fatture".
           modify cbo-tipo, item-to-add = "Note Credito".
           perform INITIALIZE-ELENCO.
           display form1.
           set controllo-finale to false.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT Form1
                 ON EXCEPTION
                    PERFORM Form1-Evaluate-Func
                 MOVE 1 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY Form1-Handle
           INITIALIZE Key-Status
           .

       Form1-Evaluate-Func.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM Form1-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM Form1-Exit
                 END-IF
              WHEN Key-Status = 1000
                 PERFORM rb-elenco-LinkTo
              WHEN Key-Status = 1002
                 PERFORM rb-ordine-LinkTo
              WHEN Key-Status = 1003
                 PERFORM rb-bolla-LinkTo
              WHEN Key-Status = 1004
                 PERFORM rb-fattura-LinkTo
              WHEN Key-Status = 1005
                 PERFORM rb-nc-LinkTo
              WHEN Key-Status = 1001
                 PERFORM PB-ESEGUI-LinkTo
              WHEN Key-Status = 8
                 PERFORM TOOL-CERCA-LinkTo
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       Form1-CLEAR.
           PERFORM Form1-INIT-VALUE
           PERFORM Form1-DISPLAY
           .

       Form1-DISPLAY.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY Form1-Tb-1a
           DISPLAY Form1 UPON Form1-Handle
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterDisplay>
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       Form1-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeExit>
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       Form1-Init-Data.
           MOVE 1 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
      * COMBO-BOX
           PERFORM cbo-tipo-Content
           .

       Form1-Init-Value.
           MOVE TITOLO TO TOTEM-MSG-TITLE
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, SetDefault>
      * <TOTEM:END>
           PERFORM Form1-FLD-TO-BUF
           .


       Form1-ALLGRID-RESET.
           .

      * for Form's Validation
       Form1-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       Form1-Buf-To-Fld.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterBufToFld>
      * <TOTEM:END>
           .

       Form1-Fld-To-Buf.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeFldToBuf>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterFldToBuf>
      * <TOTEM:END>
           .

       Form1-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform Form1-BUF-TO-FLD.
           move 0 to scelta.
           .
       Form1-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM Form1-SHOW-MSG-ROUTINE
           .

       Form1-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM Form1-DISPLAY-MESSAGE
           .

       Form1-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       Form1-Save-Status.
           .             

       Form1-Restore-Status.
           .


      * Paragrafo per la struttura del codice in AFTER sulla screen Form1
      ***---
       Form1-AFTER-SCREEN.

      * Generazione risettaggio keyboard "." ---> "."

      * Generazione stringa perform CONTROLLO
           evaluate control-id
           |78-ID-EF-data-FROM è l'ID del campo EF-data-FROM
           when 78-ID-EF-data-FROM
                perform CONTROLLO
           |78-ID-EF-DATA-TO è l'ID del campo EF-DATA-TO
           when 78-ID-EF-DATA-TO
                perform CONTROLLO
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER CONTROLLO della screen
           when 99999 continue
           when other continue
           end-evaluate.

       Form2-Open-Routine.
           PERFORM Form2-Scrn
           PERFORM Form2-Proc
           .

       Form2-Scrn.
           PERFORM Form2-Create-Win
           PERFORM Form2-Init-Value
           PERFORM Form2-Init-Data
      * Tab keystrok settings
      * Tool Bar
           PERFORM Form2-DISPLAY
           .

       Form2-Create-Win.
           Display Floating GRAPHICAL WINDOW
              LINES 48,62,
              SIZE 222,50,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 65793,
              CONTROL FONT Small-Font,
              LABEL-OFFSET 23,
              LINK TO THREAD,
              MODELESS,
              NO SCROLL,
              TITLE-BAR,
              TITLE titolo,
              WITH SYSTEM MENU,
              USER-GRAY,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE Screen1-Event-Proc,
              HANDLE IS form2-Handle,
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
      * Status-bar
           DISPLAY Form2 UPON form2-Handle
      * DISPLAY-COLUMNS settings
              MODIFY gd-ordini, DISPLAY-COLUMNS (1, 4, 12, 24, 36, 49, 
           61, 74, 99, 119, 154)
           .

       Form2-PROC.
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeAccept>
           set CallManutenzione to false.
           perform FORM3-OPEN-ROUTINE.

           if not trovato
              display message box "Nessun ordine presente per i limiti r
      -    "ichiesti"
                      title = tit-err
                      icon mb-error-icon
              perform FORM2-EXIT
           else             
              modify form2-Handle, visible = 1 
              move 2 to riga, EVENT-DATA-2
              modify gd-ordini, CURSOR-Y = 2
              perform CAMBIA-FONT-RIGA
           end-if.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT Form2
                 ON EXCEPTION
                    PERFORM Form2-Evaluate-Func
                 MOVE 2 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterEndAccept>
           if CallManutenzione
              perform ORDINE-DA-GRIGLIA
              set CallManutenzione to false
           end-if

      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY form2-Handle
           INITIALIZE Key-Status
           .

       Form2-Evaluate-Func.
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM Form2-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM Form2-Exit
                 END-IF
              WHEN Key-Status = 1000
                 PERFORM pb-ok2-LinkTo
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       Form2-CLEAR.
           PERFORM Form2-INIT-VALUE
           PERFORM Form2-DISPLAY
           .

       Form2-DISPLAY.
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY Form2 UPON form2-Handle
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterDisplay>
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       Form2-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeExit>
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       Form2-Init-Data.
           MOVE 2 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
      * GRID
           PERFORM gd-ordini-Content
           .

       Form2-DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           PERFORM Form2-DataSet1-Update-Key
           .

       Form2-DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-tordini-KEY1-ORDER
           END-EVALUATE
           PERFORM Form2-DataSet1-Update-Key
           .

       Form2-DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-tordini-KEY1-ORDER
           END-EVALUATE
           PERFORM Form2-DataSet1-Update-Key
           .

       Form2-DataSet1-Update-Key.
           MOVE tor-rec OF tordini TO
                     Form2-MULKEY-TMPBUF
           PERFORM Form2-CLEAR
           PERFORM Form2-INIT-DATA
           MOVE Form2-MULKEY-TMPBUF TO
                     tor-rec OF tordini
           PERFORM DataSet1-tordini-Read
           PERFORM Form2-DUPLICATE-MOVEKEY
           PERFORM Form2-DUMMY-CURR
           PERFORM Form2-IUD-Display
           .

       Form2-DUPLICATE-MOVEKEY.
           .

       Form2-First.
           PERFORM Form2-DUMMY-FIRST
           PERFORM DataSet1-tordini-INITSTART
           PERFORM DataSet1-tordini-START
           IF NOT Valid-STATUS-tordini
              PERFORM Form2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeFirst>
      * <TOTEM:END>
           PERFORM DataSet1-tordini-Read-Next
           IF NOT Valid-STATUS-tordini
              PERFORM Form2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterFirst>
      * <TOTEM:END>
           PERFORM Form2-DUPLICATE-MOVEKEY.
           PERFORM Form2-IUD-Display
           .

       Form2-Previous.
              PERFORM Form2-Buf-To-Fld
              PERFORM DataSet1-tordini-START-LESS
           IF NOT Valid-STATUS-tordini
              PERFORM Form2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforePrevious>
      * <TOTEM:END>
           PERFORM DataSet1-tordini-Read-Prev
           IF NOT Valid-STATUS-tordini
              PERFORM Form2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterPrevious>
      * <TOTEM:END>
           PERFORM Form2-DUPLICATE-MOVEKEY
           PERFORM Form2-DUMMY-PREVIOUS
           PERFORM Form2-IUD-Display
           .

       Form2-Next.
              PERFORM Form2-Buf-To-Fld
              PERFORM DataSet1-tordini-START-GREATER
           IF NOT Valid-STATUS-tordini
              PERFORM Form2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeNext>
      * <TOTEM:END>
           PERFORM DataSet1-tordini-Read-Next
           IF NOT Valid-STATUS-tordini
              PERFORM Form2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterNext>
      * <TOTEM:END>
           PERFORM Form2-DUPLICATE-MOVEKEY
           PERFORM Form2-DUMMY-NEXT
           PERFORM Form2-IUD-Display
           .
      
       Form2-Last.
           PERFORM Form2-DUMMY-LAST
           PERFORM DataSet1-tordini-INITEND
           PERFORM DataSet1-tordini-START-NOTGREATER
           IF NOT Valid-STATUS-tordini
              PERFORM Form2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeLast>
      * <TOTEM:END>
           PERFORM DataSet1-tordini-Read-Prev
           IF NOT Valid-STATUS-tordini
              PERFORM Form2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterLast>
      * <TOTEM:END>
           PERFORM Form2-DUPLICATE-MOVEKEY.
           PERFORM Form2-IUD-Display
           .

       Form2-Curr.
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeCurrent>
      * <TOTEM:END>
           PERFORM Form2-Buf-To-Fld
           PERFORM DataSet1-tordini-Read
           PERFORM Form2-DUPLICATE-MOVEKEY
           PERFORM Form2-DUMMY-CURR
           PERFORM Form2-IUD-Display
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterCurrent>
      * <TOTEM:END>
           .

       Form2-IUD-Display.
           IF Valid-STATUS-tordini
              PERFORM Form2-ALLGRID-RESET
              PERFORM Form2-Fld-To-Buf
              PERFORM Form2-NAVI-FOR-MASTERGRID
              PERFORM Form2-DISPLAY
           ELSE
              IF Form2-FLAG-REFRESH
                 CONTINUE
              ELSE
                 PERFORM Form2-Extended-File-Status
              END-IF
           END-IF
           .

       Form2-Add.
           PERFORM Form2-Buf-To-Fld
           PERFORM Form2-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM Form2-DUMMY-ADD
           PERFORM DataSet1-tordini-INITREC
           PERFORM Form2-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeAdd>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-tordini-Rec-Write
           IF Valid-STATUS-tordini
              PERFORM Form2-RESUMMARY-INS
              PERFORM Form2-DUMMY-UPDATE-INIT
              MOVE "301" TO TOTEM-MSG-ID
              PERFORM Form2-IUD-Display
           END-IF
           PERFORM Form2-ERR-CHECKING
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterAdd>
      * <TOTEM:END>
           .
     
       Form2-Update.
           PERFORM Form2-Buf-To-Fld
           PERFORM DataSet1-tordini-START              
           IF NOT Valid-STATUS-tordini
              PERFORM Form2-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
           PERFORM DataSet1-tordini-Read
           PERFORM Form2-Buf-To-Fld
           PERFORM Form2-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM Form2-DUMMY-UPDATE
           PERFORM Form2-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeUpdate>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-tordini-Rec-Rewrite
           IF Valid-STATUS-tordini
              PERFORM Form2-RESUMMARY-DEL
              PERFORM Form2-DUMMY-UPDATE-INIT
              MOVE "302" TO TOTEM-MSG-ID
              PERFORM Form2-IUD-Display
           END-IF
           PERFORM Form2-ERR-CHECKING
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterUpdate>
      * <TOTEM:END>
           .

       Form2-Delete.
           MOVE "203" TO TOTEM-MSG-ID
           PERFORM MESSAGE-BOX-DISPLAY
           IF TOTEM-MSG-RETURN-VALUE NOT = 1
              INITIALIZE TOTEM-MSG-TEXT
              EXIT PARAGRAPH 
           END-IF
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeDelete>
      * <TOTEM:END>
           PERFORM Form2-DUMMY-DELETE
      * delete
           PERFORM Form2-Buf-To-Fld
           PERFORM DataSet1-tordini-Rec-Delete
           IF Valid-STATUS-tordini
              PERFORM Form2-CLEAR
              PERFORM Form2-DUMMY-DELETE-INIT
              MOVE "303" TO TOTEM-MSG-ID
              MOVE "00" to STATUS-tordini
           END-IF
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterDelete>
      * <TOTEM:END>
           PERFORM Form2-ERR-CHECKING
           .

       Form2-NAVI-FOR-MASTERGRID.
           .

       Form2-ERR-CHECKING.
           IF Valid-STATUS-tordini
              PERFORM Form2-SHOW-MSG-ROUTINE
           ELSE
              PERFORM Form2-Extended-File-Status
           END-IF
           .

       Form2-RESUMMARY-INS.
           .

       Form2-RESUMMARY-DEL.
           .


       Form2-DUMMY-FIRST.
           .

       Form2-DUMMY-PREVIOUS.
           .

       Form2-DUMMY-NEXT.
           .

       Form2-DUMMY-LAST.
           .

       Form2-DUMMY-CURR.
           .

       Form2-DUMMY-ADD.
           .

       Form2-DUMMY-UPDATE.
           .

       Form2-DUMMY-UPDATE-INIT.
           .

       Form2-DUMMY-DELETE.
           .

       Form2-DUMMY-DELETE-INIT.
           .

       Form2-Init-Value.
      * FORM : Form2
           PERFORM DataSet1-INIT-RECORD
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, SetDefault>
      * <TOTEM:END>
           PERFORM Form2-FLD-TO-BUF
           .


       Form2-ALLGRID-RESET.
           .

      * for Form's Validation
       Form2-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       Form2-Buf-To-Fld.
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterBufToFld>
      * <TOTEM:END>
           .

       Form2-Fld-To-Buf.
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeFldToBuf>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterFldToBuf>
      * <TOTEM:END>
           .

       Form2-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform Form2-BUF-TO-FLD.
           move 0 to scelta.
           .
       Form2-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM Form2-SHOW-MSG-ROUTINE
           .

       Form2-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM Form2-DISPLAY-MESSAGE
           .

       Form2-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       Form2-Save-Status.
           MOVE DataSet1-tordini-KEY1-ORDER TO TMP-Form2-KEY1-ORDER
           MOVE DataSet1-KEYIS TO TMP-Form2-KEYIS
           MOVE tor-rec OF tordini TO 
              TMP-Form2-tordini-RESTOREBUF
           .             

       Form2-Restore-Status.
           MOVE TMP-Form2-KEY1-ORDER TO DataSet1-tordini-KEY1-ORDER
           MOVE TMP-Form2-KEYIS TO DataSet1-KEYIS
           MOVE TMP-Form2-tordini-RESTOREBUF TO
              tor-rec OF tordini
           PERFORM DataSet1-tordini-START
           IF Valid-STATUS-tordini
              PERFORM DataSet1-tordini-Read-Next
           ELSE
              PERFORM DataSet1-tordini-INITREC
           END-IF
           PERFORM UNTIL NOT Valid-STATUS-tordini OR
              (Valid-STATUS-tordini AND
                 tor-rec OF tordini = 
                   TMP-Form2-tordini-RESTOREBUF)
              PERFORM DataSet1-tordini-Read-Next
           END-PERFORM
           .


      * Paragrafo per la struttura del codice in AFTER sulla screen Form2
      ***---
       Form2-AFTER-SCREEN.

      * Generazione risettaggio keyboard "." ---> "."

      * Generazione stringa perform CONTROLLO
           evaluate control-id
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER CONTROLLO della screen
           when 99999 continue
           when other continue
           end-evaluate.

       form3-Open-Routine.
           PERFORM form3-Scrn
           PERFORM form3-Proc
           .

       form3-Scrn.
           PERFORM form3-Create-Win
           PERFORM form3-Init-Value
           PERFORM form3-Init-Data
      * Tab keystrok settings
      * Tool Bar
           PERFORM form3-DISPLAY
           .

       form3-Create-Win.
           Display Floating GRAPHICAL WINDOW
              LINES 3,00,
              SIZE 40,00,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 65793,
              LINK TO THREAD,
              MODELESS,
              NO SCROLL,
              USER-GRAY,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE form3-Event-Proc,
              HANDLE IS form3-Handle,
      * <TOTEM:EPT. FORM:form3, FORM:form3, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
      * Status-bar
           DISPLAY form3 UPON form3-Handle
      * DISPLAY-COLUMNS settings
           .

       form3-PROC.
      * <TOTEM:EPT. FORM:form3, FORM:form3, BeforeAccept>
           set PrimaVolta to true.
           call "w$mouse" using set-mouse-shape, wait-pointer
           if note-credito perform CARICA-NOTE
           else            perform CARICA-ORDINI
           end-if.

           call "w$mouse" using set-mouse-shape, arrow-pointer.

           perform FORM3-EXIT.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT OMITTED LINE 1 COL 1
                 ON EXCEPTION
                    PERFORM form3-Evaluate-Func
                 MOVE 3 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:form3, FORM:form3, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:form3, FORM:form3, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY form3-Handle
           INITIALIZE Key-Status
           .

       form3-Evaluate-Func.
      * <TOTEM:EPT. FORM:form3, FORM:form3, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM form3-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM form3-Exit
                 END-IF
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       form3-CLEAR.
           PERFORM form3-INIT-VALUE
           PERFORM form3-DISPLAY
           .

       form3-DISPLAY.
      * <TOTEM:EPT. FORM:form3, FORM:form3, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY form3 UPON form3-Handle
      * <TOTEM:EPT. FORM:form3, FORM:form3, AfterDisplay>
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       form3-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:form3, FORM:form3, BeforeExit>
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       form3-Init-Data.
           MOVE 3 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
           .

       form3-Init-Value.
      * <TOTEM:EPT. FORM:form3, FORM:form3, SetDefault>
      * <TOTEM:END>
           PERFORM form3-FLD-TO-BUF
           .


       form3-ALLGRID-RESET.
           .

      * for Form's Validation
       form3-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       form3-Buf-To-Fld.
      * <TOTEM:EPT. FORM:form3, FORM:form3, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:form3, FORM:form3, AfterBufToFld>
      * <TOTEM:END>
           .

       form3-Fld-To-Buf.
      * <TOTEM:EPT. FORM:form3, FORM:form3, BeforeFldToBuf>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:form3, FORM:form3, AfterFldToBuf>
      * <TOTEM:END>
           .

       form3-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform form3-BUF-TO-FLD.
           move 0 to scelta.
           .
       form3-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM form3-SHOW-MSG-ROUTINE
           .

       form3-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM form3-DISPLAY-MESSAGE
           .

       form3-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       form3-Save-Status.
           .             

       form3-Restore-Status.
           .


      * Paragrafo per la struttura del codice in AFTER sulla screen form3
      ***---
       form3-AFTER-SCREEN.

      * Generazione risettaggio keyboard "." ---> "."

      * Generazione stringa perform CONTROLLO
           evaluate control-id
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER CONTROLLO della screen
           when 99999 continue
           when other continue
           end-evaluate.



       Form1-BeforeProcedure.
           EVALUATE Control-Id
           WHEN 5001 MOVE "." to TOTEM-HINT-TEXT
           WHEN 5002 MOVE "." to TOTEM-HINT-TEXT
           WHEN 5003 MOVE "." to TOTEM-HINT-TEXT
           WHEN 5004 MOVE "." to TOTEM-HINT-TEXT
           WHEN 5005 MOVE "." to TOTEM-HINT-TEXT
           WHEN 5006 MOVE "." to TOTEM-HINT-TEXT
           WHEN 5007 MOVE "." to TOTEM-HINT-TEXT
           WHEN 5008 MOVE "." to TOTEM-HINT-TEXT
           WHEN 5009 MOVE "." to TOTEM-HINT-TEXT
           WHEN 5010 MOVE "." to TOTEM-HINT-TEXT
           WHEN 5011 MOVE "." to TOTEM-HINT-TEXT
           WHEN 5012 MOVE "." to TOTEM-HINT-TEXT
           WHEN 5013 MOVE "." to TOTEM-HINT-TEXT
           WHEN 5014 MOVE "." to TOTEM-HINT-TEXT
           WHEN 5015 MOVE "." to TOTEM-HINT-TEXT
           WHEN 5016 MOVE "." to TOTEM-HINT-TEXT
           WHEN OTHER MOVE SPACES TO TOTEM-HINT-TEXT
           END-EVALUATE
           EVALUATE Control-Id
           When 5001 PERFORM ef-anno-BeforeProcedure
           When 5002 PERFORM Screen1-Rb-1-BeforeProcedure
           When 5003 PERFORM ef-cli-BeforeProcedure
           When 5004 PERFORM ef-dest-BeforeProcedure
           When 5005 PERFORM ef-num-BeforeProcedure
           When 5006 PERFORM EF-data-FROM-BeforeProcedure
           When 5007 PERFORM EF-DATA-TO-BeforeProcedure
           When 5008 PERFORM Form1-Cm-1-BeforeProcedure
           When 5009 PERFORM rb-ordine-BeforeProcedure
           When 5010 PERFORM ef-ordine-BeforeProcedure
           When 5011 PERFORM rb-bolla-BeforeProcedure
           When 5012 PERFORM ef-bolla-BeforeProcedure
           When 5013 PERFORM rb-fattura-BeforeProcedure
           When 5014 PERFORM ef-fattura-BeforeProcedure
           When 5015 PERFORM rb-nc-BeforeProcedure
           When 5016 PERFORM ef-nc-BeforeProcedure
           END-EVALUATE
           .

       Screen1-Event-Proc.
           .

       cbo-tipo-Event-Proc.
           .

       Screen1-Gd-1-Event-Proc.
           EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
           WHEN Msg-Begin-Drag ALSO 1 ALSO
                    form2-Handle 
              PERFORM gd-ordini-Ev-Msg-Begin-Drag
           WHEN Msg-Begin-Entry ALSO 1 ALSO
                    form2-Handle 
              PERFORM gd-ordini-Ev-Msg-Begin-Entry
           WHEN Msg-End-Drag ALSO 1 ALSO
                    form2-Handle 
              PERFORM gd-ordini-Ev-Msg-End-Drag
           WHEN Msg-Goto-Cell ALSO 1 ALSO
                    form2-Handle 
              PERFORM gd-ordini-Ev-Msg-Goto-Cell
           WHEN Msg-Goto-Cell-Drag ALSO 1 ALSO
                    form2-Handle 
              PERFORM gd-ordini-Ev-Msg-Goto-Cell-Drag
           WHEN Msg-Goto-Cell-Mouse ALSO 1 ALSO
                    form2-Handle 
              PERFORM gd-ordini-Ev-Msg-Goto-Cell-Mouse
           END-EVALUATE
           .

       form3-Event-Proc.
           .

      * USER DEFINE PARAGRAPH
       CAMBIA-FONT-RIGA.
      * <TOTEM:PARA. CAMBIA-FONT-RIGA>
           modify gd-ordini(riga), row-font = small-font.

           modify gd-ordini(riga, 1),
                  bitmap        = elemento-bmp,
                  bitmap-number = 1,
                  bitmap-width  = 16.


           move event-data-2 to riga.
           modify gd-ordini(riga), row-font = font-evidenzia-griglia.

           modify gd-ordini, (riga, 1),
                  bitmap        = elemento-bmp,
                  bitmap-number = 2,
                  bitmap-width  = 16.


           display form2 
           .
      * <TOTEM:END>

       CARICA-NOTE.
      * <TOTEM:PARA. CARICA-NOTE>
           move ef-cli-buf  to tno-cod-cli.
           move ef-dest-buf to tno-prg-destino.
           move ef-anno-buf to tno-anno.
           start tnotacr key is >= k1
                 invalid continue
             not invalid
                 set trovato to false
                 perform until 1 = 2
                    read tnotacr next no lock at end exit perform 
           end-read
                    if tno-cod-cli not = ef-cli-buf  exit perform end-if
                    if ef-dest-buf not = 0
                       if tno-prg-destino not = ef-dest-buf
                          exit perform
                       end-if
                    end-if
                    if tno-data-fattura >= como-data-1 and
                       tno-data-fattura <= como-data-2
                       perform SCRIVI-RECORD-NC
                    end-if
                 end-perform
           end-start.
           if trovato
              perform RIEMPI-GRID
           end-if 
           .
      * <TOTEM:END>

       CARICA-ORDINI.
      * <TOTEM:PARA. CARICA-ORDINI>
           move ef-cli-buf  to tor-cod-cli.
           move ef-dest-buf to tor-prg-destino.
           move low-value   to tor-anno.
           move low-value   to tor-numero.
           start tordini key is >= k1
                 invalid continue
             not invalid
                 set trovato to false
                 perform until 1 = 2
                    read tordini next no lock
                         at end exit perform
                    end-read
                    if tor-cod-cli not = ef-cli-buf  exit perform end-if
                    if ef-dest-buf not = 0
                       if tor-prg-destino not = ef-dest-buf
                          exit perform
                       end-if
                    end-if
                    set record-ok to true
                    evaluate true
                    when inevasi
                         if tor-data-creazione < como-data-1 or
                            tor-data-creazione > como-data-2 or
                            tor-anno not = ef-anno-buf
                            set record-ok to false
                         end-if
                         if tor-num-bolla    not = 0 or
                            tor-anno-bolla   not = 0 or
                            tor-data-bolla   not = 0 or
                            tor-data-fattura not = 0 or
                            tor-anno-fattura not = 0 or
                            tor-num-fattura  not = 0
                            set record-ok to false
                         end-if
                    when emessa-bolla
                         if tor-data-bolla < como-data-1 or
                            tor-data-bolla > como-data-2 or
                            tor-num-bolla = 0            or
                            tor-anno-bolla not = ef-anno-buf
                            set record-ok to false
                         end-if
                    when fatturati
                         if tor-data-fattura < como-data-1 or
                            tor-data-fattura > como-data-2 or
                            tor-num-fattura = 0            or
                            tor-anno-fattura not = ef-anno-buf
                            set record-ok to false
                         end-if
                    end-evaluate
                    if record-ok
                       if ef-num-buf not = spaces and
                          ef-num-buf not = tor-num-ord-cli
                          set record-ok to false
                       end-if
                    end-if
                    if record-ok
                       perform SCRIVI-RECORD-FATTURE
                    end-if
                 end-perform
           end-start.
           if trovato
              perform RIEMPI-GRID
           end-if 
           .
      * <TOTEM:END>

       CERCA.
      * <TOTEM:PARA. CERCA>
           evaluate control-id
           when 78-ID-ef-cli
                inquire ef-cli, value in cli-codice
                set cli-tipo-c to true
                move   "clienti-all"  to como-file
                call   "zoom-gt"   using como-file, cli-rec
                                  giving stato-zoom
                cancel "zoom-gt"
      
                if stato-zoom = 0
                   move cli-codice   to ef-cli-buf
                   move cli-ragsoc-1 to lab-cli-buf
                   display ef-cli lab-cli
                end-if

           when 78-ID-ef-dest
                inquire ef-cli,  value in des-codice
                inquire ef-dest, value in des-prog
                move "clienti-des"   to como-file
                call   "zoom-gt"  using como-file, des-rec
                                 giving stato-zoom
                cancel "zoom-gt"
                if stato-zoom = 0
                   move des-prog     to ef-dest-buf
                   move des-ragsoc-1 to lab-dest-buf
                   display ef-dest lab-dest
                   move 4 to accept-control
                end-if

           when 78-ID-ef-ordine
                inquire ef-anno,   value in tor-anno
                inquire ef-ordine, value in tor-numero
                move "tordini-no-pren"   to como-file
                call   "zoom-gt"  using como-file, tor-rec
                                 giving stato-zoom
                cancel "zoom-gt"
                if stato-zoom = 0
                   move tor-numero to ef-ordine-buf
                   display ef-ordine
                   move 4 to accept-control
                end-if

           when 78-ID-ef-bolla
                perform RIEMPI-TMP-TOR-BOLLE
                move "zoom-tor-bolle"   to como-file
                inquire ef-anno, value in zoom-tor-bol-anno
                inquire ef-bolla value in zoom-tor-bol-numero
      
                if trovato
                   move path-zoom-tor-bolle to ext-file
                   call "zoom-gt"   using como-file, zoom-tor-bol-rec
                                   giving stato-zoom
                   end-call
                   cancel "zoom-gt"
                else
                   move 1 to stato-zoom
                end-if
                perform CANCELLA-TMP-TOR-BOLLE
      
                if stato-zoom = 0
                   move zoom-tor-bol-numero to ef-bolla-buf
                   display ef-bolla
                end-if
      
           when 78-ID-ef-fattura
                perform RIEMPI-TMP-TOR-FAT
                move "zoom-tor-fat"      to como-file
                inquire ef-anno,   value in zoom-tor-fat-anno
                inquire ef-fattura value in zoom-tor-fat-numero
      
                if trovato
                   move path-zoom-tor-fat to ext-file
                   call "zoom-gt"   using como-file, zoom-tor-fat-rec
                                   giving stato-zoom
                   end-call
                   cancel "zoom-gt"
                else
                   move 1 to stato-zoom
                end-if
                perform CANCELLA-TMP-TOR-FAT
      
                if stato-zoom = 0
                   move zoom-tor-fat-numero to ef-fattura-buf
                   display ef-fattura
                end-if
      
           when 78-ID-ef-nc
                perform RIEMPI-TMP-TNO-FAT
                move "zoom-tno-fat"   to como-file
                inquire ef-anno, value in zoom-tno-fat-anno
                inquire ef-nc    value in zoom-tno-fat-numero
      
                if trovato
                   move path-zoom-tno-fat to ext-file
                   call "zoom-gt"   using como-file, zoom-tno-fat-rec
                                   giving stato-zoom
                   end-call
                   cancel "zoom-gt"
                else
                   move 1 to stato-zoom
                end-if
                perform CANCELLA-TMP-TNO-FAT
      
                if stato-zoom = 0
                   move zoom-tno-fat-numero to ef-nc-buf
                   display ef-nc
                end-if
           end-evaluate 
           .
      * <TOTEM:END>

       CHIAMA-MANUTENZIONE.
      * <TOTEM:PARA. CHIAMA-MANUTENZIONE>
           evaluate tipo-ricerca
           when 2
           when 4 if tor-ordine
                     move "stdocF" to LinkPgm
                     perform CALL-GORDCVAR
                  else
                     perform CALL-FATMANVAR
                  end-if
           when 3 move "stdocB" to LinkPgm
                  perform CALL-GORDCVAR
           when 5 perform CALL-NOTAVAR
           end-evaluate.
      
      ***---
       CALL-GORDCVAR.
           move tor-chiave         to LinkChiave.
      
           modify form1-Handle, visible = 0.
           call   "gordcvar" using lk-blockpgm
                                   user-codi
                                   1
                                   gordcvar-linkage.
           cancel "gordcvar".
           modify form1-Handle, visible = 1.
      
      ***--- 
       CALL-FATMANVAR.
           move tor-causale        to link-TipoFat.
           move tor-chiave         to FatChiave.
           move "stdoc"            to LinkPgm.
      
           modify form1-Handle, visible = 0.
           call   "fatmanvar"   using lk-blockpgm
                                      user-codi
                                      1
                                      fatman-linkage.
           cancel "fatmanvar".
           modify form1-Handle, visible = 1.
      
      ***---
       CALL-NOTAVAR.
           move tno-causale        to link-TipoNota.
           move tno-chiave         to NotaChiave.
           move "stdoc"            to LinkPgm.
      
           modify form1-Handle, visible = 0.
           call   "notavar"  using lk-blockpgm
                                   user-codi
                                   1
                                   notacr-linkage.
           cancel "notavar".
           modify form1-Handle, visible = 1 
           .
      * <TOTEM:END>

       CONTROLLO.
      * <TOTEM:PARA. CONTROLLO>
           set tutto-ok to true.

           evaluate control-id
           when 78-ID-ef-anno
                if e-elenco = 1
                   inquire ef-anno value in ef-anno-buf
                   if ef-anno-buf = 0
                      set errori to true
                      display message "Anno obbligatorio"
                                title tit-err
                                 icon 2
                   end-if
                end-if

           when 78-ID-ef-cli
                if e-elenco = 1
                   inquire ef-cli value in ef-cli-buf
                   move ef-cli-buf to cli-codice
                   set  cli-tipo-C to true
                   read clienti no lock
                        invalid
                        set errori to true
                        display message "Cliente non valido"
                                  title tit-err
                                   icon 2
                        move spaces to cli-ragsoc-1
                   end-read
                   move cli-ragsoc-1 to lab-cli-buf
                   display lab-cli
                end-if

           when 78-ID-ef-dest
                if e-elenco = 1
                   inquire ef-dest value in ef-dest-buf
                   inquire ef-cli, value in des-codice
                   move ef-dest-buf to des-prog
                   if des-prog = 0
                      move "TUTTI I DESTINI" to des-ragsoc-1
                   else
                      read destini no lock
                           invalid
                           set errori to true
                           display message "Destino non valido"
                                     title tit-err
                                      icon 2
                           move spaces to cli-ragsoc-1
                      end-read
                   end-if
                   move des-ragsoc-1 to lab-dest-buf
                   display lab-dest
                end-if

           when 78-ID-ef-dest
                if e-elenco = 1
                   inquire ef-dest value in ef-dest-buf
                   inquire ef-cli, value in des-codice
                   move ef-dest-buf to des-prog
                   if des-prog = 0
                      move spaces to des-ragsoc-1
                   else
                      read destini no lock
                           invalid
                           set errori to true
                           display message "Destino non valido"
                                     title tit-err
                                      icon 2
                           move spaces to cli-ragsoc-1
                      end-read
                   end-if
                   move des-ragsoc-1 to lab-dest-buf
                   display lab-dest
                end-if

           when 78-ID-ef-data-from
                if e-elenco = 1
                   inquire ef-data-from, value in como-data
                   if como-data not = 0
                      perform DATE-FORMAT
                      move como-data to ef-data-from-buf
                      display ef-data-from
                   end-if
                end-if

           when 78-ID-ef-data-to
                if e-elenco = 1
                   inquire ef-data-to, value in como-data
                   evaluate como-data
                   when 0
                        move 99999999 to como-data
                        move como-data to ef-data-to-buf
                        display ef-data-to
                   when 99999999 continue
                   when other
                        perform DATE-FORMAT
                        move como-data to ef-data-to-buf
                        display ef-data-to
                   end-evaluate
                   inquire ef-data-from, value in como-data
                   perform DATE-TO-FILE
                   move como-data to como-data-1
            
                   inquire ef-data-to, value in como-data
                   perform DATE-TO-FILE
                   move como-data to como-data-2
    
                   if como-data-1 > como-data-2
                      set errori to true
                      display message "Range date errato"
                                title tit-err
                                 icon 2
                      move 78-ID-ef-data-from to control-id
                   end-if
                end-if

           when 78-ID-ef-ordine
                if e-ordine = 1
                   inquire ef-anno,   value in tor-anno
                   inquire ef-ordine, value in tor-numero
                   read tordini no lock
                        invalid
                        if tor-numero = 0
                           if controllo-finale
                              set errori to true
                              display message "Ordine obbligatorio"
                                        title tit-err
                                         icon 2
                           end-if
                        else
                           set errori to true
                           display message "Ordine inesistente"
                                     title tit-err
                                      icon 2
                        end-if
                    not invalid
                        if tor-anno-fattura not = 0 or
                           tor-num-fattura  not = 0
                           set errori to true
                           display message "Ordine già fatturato"
                                     title tit-err
                                      icon 2
                        else
                           if tor-anno-bolla not = 0 or
                              tor-num-bolla  not = 0
                              set errori to true
                              display message "Ordine già bollettato"
                                        title tit-err
                                         icon 2
                           end-if
                        end-if
                   end-read
                end-if

           when 78-ID-ef-bolla
                if e-bolla = 1
                   inquire ef-anno,  value in tor-anno-bolla
                   inquire ef-bolla, value in tor-num-bolla
                   if tor-num-bolla = 0
                      if controllo-finale
                         set errori to true
                         display message "Inserimento N. Bolla mancante"
                                   title tit-err
                                    icon 2
                      end-if
                   else
                      read tordini no lock key is k-bolla
                           invalid
                           set errori to true
                           display message "Bolla inesistente"
                                     title tit-err
                                      icon 2
                      end-read
                   end-if
                end-if

           when 78-ID-ef-fattura
                if e-fattura = 1
                   inquire ef-anno,    value in tor-anno-fattura
                   inquire ef-fattura, value in tor-num-fattura
                   if tor-num-fattura = 0
                      if controllo-finale
                         set errori to true
                         display message "Inserimento N. fattura mancant
      -    "e"
                                   title tit-err
                                    icon 2
                      end-if
                   else
                      read tordini no lock key is k-fattura
                           invalid
                           set errori to true
                           display message "Fattura inesistente"
                                     title tit-err
                                      icon 2
                      end-read
                   end-if
                end-if

           when 78-ID-ef-nc
                if e-nc = 1
                   inquire ef-anno, value in tno-anno-fattura
                   inquire ef-nc,   value in tno-num-fattura
                   if tno-num-fattura = 0
                      if controllo-finale
                         set errori to true
                         display message "Inserimento N. nota mancante"
                                   title tit-err
                                    icon 2
                      end-if
                   else
                      read tnotacr no lock key is k-fattura
                           invalid
                           set errori to true
                           display message "Nota inesistente"
                                     title tit-err
                                      icon 2
                      end-read
                   end-if
                end-if
                
           end-evaluate.
      
           if errori
              perform CANCELLA-COLORE
              move control-id to store-id
              move 4          to accept-control
           end-if 
           .
      * <TOTEM:END>

       ELENCO.
      * <TOTEM:PARA. ELENCO>
           inquire  cbo-tipo,      value in cbo-tipo-buf.
           evaluate cbo-tipo-buf
           when "Inevasi"        set inevasi        to true
           when "Bolle"          set emessa-bolla   to true
           when "Fatture"        set fatturati      to true
           when "Note Credito"   set note-credito to true
           end-evaluate.

           modify form1-Handle, visible 0.
           perform FORM2-OPEN-ROUTINE.
           modify form1-Handle, visible 1 
           .
      * <TOTEM:END>

       INITIALIZE-ELENCO.
      * <TOTEM:PARA. INITIALIZE-ELENCO>
           perform CANCELLA-COLORE.
           move 99999999 to ef-data-to-buf.
           move        0 to ef-data-from-buf.

           move 0 to ef-cli-buf ef-dest-buf.
           move spaces to lab-cli-buf.
           move "<<HELP>> 0 = Tutti i destini del Cliente"
             to lab-dest-buf.

           move "Inevasi" to cbo-tipo-buf.
           modify cbo-tipo, value cbo-tipo-buf 
           .
      * <TOTEM:END>

       METTI-IN-GRIGLIA.
      * <TOTEM:PARA. METTI-IN-GRIGLIA>
           move tmp-sol-anno          to col-anno.
           move tmp-sol-numero        to col-numero.
           move tmp-sol-num-bolla     to col-bolla.
           move tmp-sol-data-bolla    to como-data.
           perform DATE-TO-SCREEN.
           move como-data             to col-dt-bolla.
           move tmp-sol-num-fatt      to col-fatt.
           move tmp-sol-data-fatt     to como-data.
           perform DATE-TO-SCREEN.
           move como-data             to col-dt-fatt.
           move tmp-sol-numord-cli    to col-num-ord.
           move tmp-sol-ragsoc        to col-ragsoc.
           move tmp-sol-localita      to col-localita.
           move tmp-sol-sito-vettore  to col-sito.

           modify gd-ordini, record-to-add Gd-ordini-Record.

           inquire gd-ordini, last-row = riga.
           modify  gd-ordini(riga, 11), cell-color = 514 
           .
      * <TOTEM:END>

       OPEN-OUTPUT-TMP-SOLLECITI.
      * <TOTEM:PARA. OPEN-OUTPUT-TMP-SOLLECITI>
           accept como-data from century-date.
           accept como-ora  from time.
           set PrimaVolta to false.
           initialize path-tmp-solleciti.
           accept  path-tmp-solleciti from environment "PATH_ST".
           inspect path-tmp-solleciti replacing trailing 
                                      spaces by low-value.
           string  path-tmp-solleciti delimited low-value
                   "tmp_solleciti"    delimited size
                   "_"                delimited size
                   como-data          delimited size
                   "_"                delimited size
                   como-ora           delimited size
                   ".tmp"             delimited size
                   into path-tmp-solleciti
           end-string.
           open output tmp-solleciti 
           .
      * <TOTEM:END>

       ORDINE-DA-GRIGLIA.
      * <TOTEM:PARA. ORDINE-DA-GRIGLIA>
           inquire gd-ordini(riga), record-data = Gd-ordini-Record.
      
           move col-anno            to tor-anno   tno-anno.
           move Col-numero          to tor-numero tno-numero.
           move riga                to store-riga.

           if note-credito read tnotacr invalid continue end-read
           else            read tordini invalid continue end-read
           end-if.
      
           move tipo-ricerca to save-tipo-ricerca.
           evaluate true
           when inevasi      move 2 to tipo-ricerca
           when emessa-bolla move 3 to tipo-ricerca
           when fatturati    move 4 to tipo-ricerca
           when note-credito move 5 to tipo-ricerca
           end-evaluate.
           perform CHIAMA-MANUTENZIONE.
           move save-tipo-ricerca to tipo-ricerca.
      
           modify gd-ordini, cursor-y = riga.
           perform CAMBIA-FONT-RIGA.
      
           move store-riga to riga, EVENT-DATA-2.
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>

       PARAGRAFO-COPY.
      * <TOTEM:PARA. PARAGRAFO-COPY>
           copy "color-custom.cpy".
           copy "utydata.cpy".
           copy "calcola-colore-trasparente.cpy" 
           .
      * <TOTEM:END>

       RIEMPI-GRID.
      * <TOTEM:PARA. RIEMPI-GRID>
           close tmp-solleciti.
           open input tmp-solleciti.
           modify gd-ordini, mass-update = 1.                    
           modify gd-ordini, reset-grid  = 1.
           perform GD-ORDINI-CONTENT.
           move low-value to tmp-sol-rec.
           evaluate true
           when inevasi       
                move 3 to colonna
                start tmp-solleciti key is >= k-evasione
                      invalid continue
                end-start
           when emessa-bolla  
                move 4 to colonna
                start tmp-solleciti key is >= k-bolla
                      invalid continue
                end-start
           when fatturati     
                move 6 to colonna
                start tmp-solleciti key is >= k-fatt
                      invalid continue
                end-start
           when note-credito  
                move 6 to colonna
                start tmp-solleciti key is >= k-fatt
                      invalid continue
                end-start
                modify gd-ordini(1, 3), cell-data = "Nr. Doc."
                modify gd-ordini(1, 4), cell-data = spaces
                modify gd-ordini(1, 5), cell-data = spaces
                modify gd-ordini(1, 6), cell-data = "Nota Cr."
                modify gd-ordini(1, 7), cell-data = "Dt N.C."
           end-evaluate.

           perform until 1 = 2
              read tmp-solleciti next at end exit perform end-read
              perform METTI-IN-GRIGLIA
           end-perform.

           modify gd-ordini(1, colonna), cell-color = 266.
           modify gd-ordini, mass-update = 0.
           close       tmp-solleciti.
           delete file tmp-solleciti.
           set PrimaVolta to true 
           .
      * <TOTEM:END>

       RIEMPI-TMP-TNO-FAT.
      * <TOTEM:PARA. RIEMPI-TMP-TNO-FAT>
           set record-ok to true
      
           accept  path-zoom-tno-fat      from environment "PATH_ST".
           accept  como-data              from century-date.
           accept  como-ora               from time.
           inspect path-zoom-tno-fat      replacing trailing
                                          spaces by low-value.
           string path-zoom-tno-fat       delimited by low-value
                  "zoom-tno-fat"          delimited by size
                  "_"                     delimited by size
                  como-data               delimited by size
                  "_"                     delimited by size
                  como-ora                delimited by size
                  into path-zoom-tno-fat
           end-string.
      
           set trovato to false.
           open output zoom-tno-fat.
           initialize tno-rec.
           move ef-anno-buf to tno-anno-fattura.
           move 1           to tno-num-fattura.
      
           start tnotacr key  is >= k-fattura
                 invalid continue 
             not invalid
                 perform until 1 = 2
                    read tnotacr next no lock at end exit perform 
           end-read
                    
                    if tno-anno-fattura not = ef-anno-buf or
                       tno-num-fattura  = 0
                       exit perform
                    end-if
      
                    set record-ok to true
      
                    if record-ok
                       move tno-anno-fattura   to zoom-tno-fat-anno
                       move tno-num-fattura    to zoom-tno-fat-numero
                       move tno-data-fattura   to zoom-tno-fat-data
                       move tno-causale        to zoom-tno-fat-causale
                       move tno-numero         to zoom-tno-fat-num-reg
                       move tno-cod-cli        to zoom-tno-fat-cod-cli
                                                  cli-codice
                       set cli-tipo-C          to true
      
                       read clienti no lock
                            invalid initialize cli-rec
                       end-read
                       move cli-ragsoc-1       to zoom-tno-fat-ragsoc-1
      
                       write zoom-tno-fat-rec invalid continue end-write
                       set trovato to true
                    end-if
      
                 end-perform
           end-start.
      
           close zoom-tno-fat 
           .
      * <TOTEM:END>

       RIEMPI-TMP-TOR-BOLLE.
      * <TOTEM:PARA. RIEMPI-TMP-TOR-BOLLE>
           set record-ok to true
      
           accept  path-zoom-tor-bolle    from environment "PATH_ST".
           accept  como-data              from century-date.
           accept  como-ora               from time.
           inspect path-zoom-tor-bolle    replacing trailing
                                          spaces by low-value.
           string path-zoom-tor-bolle     delimited by low-value
                  "zoom-tor-bolle"        delimited by size
                  "_"                     delimited by size
                  como-data               delimited by size
                  "_"                     delimited by size
                  como-ora                delimited by size
                  into path-zoom-tor-bolle
           end-string.
      
           set trovato to false.
           open output zoom-tor-bolle.
           initialize tor-rec.
           move ef-anno-buf to tor-anno-bolla.
           move 1           to tor-num-bolla.
      
           start tordini key  is >= k-bolla
                 invalid continue 
             not invalid
                 perform until 1 = 2
                    read tordini next no lock at end exit perform 
           end-read
                    
                    if tor-anno-bolla not = ef-anno-buf
                       exit perform
                    end-if
      
                    set record-ok to true
      
                    if record-ok
                       move tor-anno-bolla  to zoom-tor-bol-anno
                       move tor-num-bolla   to zoom-tor-bol-numero
                       move tor-data-bolla  to zoom-tor-bol-data
                       move tor-causale     to zoom-tor-bol-causale
                       move tor-numero      to zoom-tor-bol-num-reg
                       move tor-cod-cli     to zoom-tor-bol-cod-cli
                                               cli-codice
                       set cli-tipo-C       to true
      
                       read clienti no lock
                            invalid initialize cli-rec
                       end-read
                       move cli-ragsoc-1       to zoom-tor-bol-ragsoc-1
      
                       write zoom-tor-bol-rec invalid continue end-write
                       set trovato to true
                    end-if
      
                 end-perform
           end-start.
      
           close zoom-tor-bolle 
           .
      * <TOTEM:END>

       RIEMPI-TMP-TOR-FAT.
      * <TOTEM:PARA. RIEMPI-TMP-TOR-FAT>
           set record-ok to true
      
           accept  path-zoom-tor-fat      from environment "PATH_ST".
           accept  como-data              from century-date.
           accept  como-ora               from time.
           inspect path-zoom-tor-fat      replacing trailing
                                          spaces by low-value.
           string path-zoom-tor-fat       delimited by low-value
                  "zoom-tor-fat"          delimited by size
                  "_"                     delimited by size
                  como-data               delimited by size
                  "_"                     delimited by size
                  como-ora                delimited by size
                  into path-zoom-tor-fat
           end-string.
      
           set trovato to false.
           open output zoom-tor-fat.
           initialize tor-rec.
           move ef-anno-buf to tor-anno-fattura.
           move 1           to tor-num-fattura.
      
           start tordini key  is >= k-fattura
                 invalid continue
             not invalid
                 perform until 1 = 2
                    read tordini next no lock at end exit perform 
           end-read
                    
                    if tor-anno-fattura not = ef-anno-buf or
                       tor-num-fattura  = 0
                       exit perform
                    end-if
      
                    set record-ok to false
      
                    move tor-causale to tca-codice
                    read tcaumag no lock 
                         invalid continue 
                     not invalid
                         if tca-si-emissione 
                            set record-ok to true 
                         end-if
                    end-read
      
                    if record-ok
                       move tor-anno-fattura   to zoom-tor-fat-anno
                       move tor-num-fattura    to zoom-tor-fat-numero
                       move tor-data-fattura   to zoom-tor-fat-data
                       move tor-causale        to zoom-tor-fat-causale
                       move tor-numero         to zoom-tor-fat-num-reg
                       move tor-cod-cli        to zoom-tor-fat-cod-cli
                                                  cli-codice
                       set cli-tipo-C          to true
      
                       read clienti no lock
                            invalid initialize cli-rec
                       end-read
                       move cli-ragsoc-1       to zoom-tor-fat-ragsoc-1
      
                       write zoom-tor-fat-rec invalid continue end-write
                       set trovato to true
                    end-if
      
                 end-perform
           end-start.
      
           close zoom-tor-fat 
           .
      * <TOTEM:END>

       CANCELLA-TMP-TNO-FAT.
      * <TOTEM:PARA. CANCELLA-TMP-TNO-FAT>
           delete file zoom-tno-fat 
           .
      * <TOTEM:END>

       CANCELLA-TMP-TOR-BOLLE.
      * <TOTEM:PARA. CANCELLA-TMP-TOR-BOLLE>
           delete file zoom-tor-bolle 
           .
      * <TOTEM:END>

       CANCELLA-TMP-TOR-FAT.
      * <TOTEM:PARA. CANCELLA-TMP-TOR-FAT>
           delete file zoom-tor-fat 
           .
      * <TOTEM:END>

       SCRIVI-RECORD-FATTURE.
      * <TOTEM:PARA. SCRIVI-RECORD-FATTURE>
           set trovato to true.
           if PrimaVolta
              perform OPEN-OUTPUT-TMP-SOLLECITI
           end-if.

           initialize tmp-sol-rec replacing numeric data by zeroes
                                       alphanumeric data by spaces.
           move tor-anno         to tmp-sol-anno.
           move tor-numero       to tmp-sol-numero.
           move tor-num-bolla    to tmp-sol-num-bolla.
           move tor-data-bolla   to tmp-sol-data-bolla.
           move tor-num-fattura  to tmp-sol-num-fatt.
           move tor-data-fattura to tmp-sol-data-fatt.
           move tor-num-ord-cli  to tmp-sol-numord-cli.
           set  cli-tipo-C       to true.
           move tor-cod-cli      to cli-codice.
           read clienti  no lock invalid continue end-read.
           move cli-ragsoc-1     to tmp-sol-ragsoc.
           if tor-prg-destino = 0
              move cli-localita to tmp-sol-localita
           else
              move tor-cod-cli     to des-codice
              move tor-prg-destino to des-prog
              read destini no lock 
                   invalid 
                   move "** NON TROVATA **" to des-localita
              end-read
              move des-localita to tmp-sol-localita
           end-if.
           move tor-vettore to vet-codice.
           read tvettori no lock invalid move spaces to vet-url end-read
           move vet-url to tmp-sol-sito-vettore.
           write tmp-sol-rec invalid continue end-write 
           .
      * <TOTEM:END>

       SCRIVI-RECORD-NC.
      * <TOTEM:PARA. SCRIVI-RECORD-NC>
           set trovato to true.
           if PrimaVolta
              perform OPEN-OUTPUT-TMP-SOLLECITI
           end-if.

           initialize tmp-sol-rec replacing numeric data by zeroes
                                       alphanumeric data by spaces.
           move tno-anno         to tmp-sol-anno.
           move tno-numero       to tmp-sol-numero.
           move tno-num-fattura  to tmp-sol-num-fatt.
           move tno-data-fattura to tmp-sol-data-fatt.
           set  cli-tipo-C       to true.
           move tno-cod-cli      to cli-codice.
           read clienti  no lock invalid continue end-read.
           move cli-ragsoc-1     to tmp-sol-ragsoc.
           if tno-prg-destino = 0
              move cli-localita to tmp-sol-localita
           else
              move tno-cod-cli     to des-codice
              move tno-prg-destino to des-prog
              read destini no lock 
                   invalid 
                   move "** NON TROVATA **" to des-localita
              end-read
              move des-localita to tmp-sol-localita
           end-if.
           write tmp-sol-rec invalid continue end-write 
           .
      * <TOTEM:END>

       SPOSTAMENTO.
      * <TOTEM:PARA. SPOSTAMENTO>
           inquire gd-ordini, last-row in tot-righe.
           if event-data-2 < 2 move 2 to event-data-2 end-if.
           if event-data-2 > tot-righe move tot-righe to event-data-2 
           end-if.
           if riga not = event-data-2 
              perform CAMBIA-FONT-RIGA
           end-if 
           .
      * <TOTEM:END>

      * EVENT PARAGRAPH
       bprepb-Ev-Before-Program.
      * <TOTEM:PARA. bprepb-Ev-Before-Program>
           move spaces to tge-anno.
           open input tparamge.
           move spaces to tge-codice.
           read tparamge no lock invalid continue end-read.
           close tparamge.
           move LK-BL-PROG-ID    TO COMO-PROG-ID.
           perform CALCOLA-COLORE-TRASPARENTE.

      * Verdana10BI-Occidentale
           INITIALIZE WFONT-DATA, font-evidenzia-griglia
           MOVE 10                to wfont-size
           move "Arial"           to wfont-name
           set wfont-bold         to true
           set wfont-italic       to true
           set wfont-underline    to false
           set wfont-strikeout    to false
           set wfont-fixed-pitch  to false
           move 0 to wfont-char-set
           call "w$font" using wfont-get-font, 
                     font-evidenzia-griglia, wfont-data

           copy resource "elemento.bmp".
           call "W$BITMAP" using wbitmap-load, "elemento.bmp"
                          giving elemento-bmp 
           .
      * <TOTEM:END>
       ef-anno-BeforeProcedure.
      * <TOTEM:PARA. ef-anno-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-anno-AfterProcedure.
      * <TOTEM:PARA. ef-anno-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO 
           .
      * <TOTEM:END>
       TOOL-CERCA-LinkTo.
      * <TOTEM:PARA. TOOL-CERCA-LinkTo>
           inquire tool-cerca, enabled in e-cerca.
           if e-cerca = 1 perform CERCA end-if 
           .
      * <TOTEM:END>
       PB-ESEGUI-BeforeProcedure.
      * <TOTEM:PARA. PB-ESEGUI-BeforeProcedure>
           modify PB-ESEGUI, bitmap-number 2 
           .
      * <TOTEM:END>
       PB-ESEGUI-AfterProcedure.
      * <TOTEM:PARA. PB-ESEGUI-AfterProcedure>
           modify PB-ESEGUI, bitmap-number 1 
           .
      * <TOTEM:END>
       PB-ESEGUI-LinkTo.
      * <TOTEM:PARA. PB-ESEGUI-LinkTo>
           set tutto-ok to true.
           set controllo-finale to true.
           perform varying control-id from 78-ID-ef-anno by 1
                     until control-id > 78-ID-ef-nc
              perform CONTROLLO
              if errori
                 exit perform
              end-if
           end-perform.
           set controllo-finale to false.

           if tutto-ok
              perform CANCELLA-COLORE
              if tipo-ricerca = 1 perform ELENCO
              else                perform CHIAMA-MANUTENZIONE
              end-if
              modify pb-esegui, bitmap-number = 1
              move 78-ID-ef-anno to control-id
              move 4             to accept-control
           end-if 
           .
      * <TOTEM:END>
       Form1-Pb-2-BeforeProcedure.
      * <TOTEM:PARA. Form1-Pb-2-BeforeProcedure>
           modify pb-cancel, bitmap-number 2 
           .
      * <TOTEM:END>
       Form1-Pb-2-AfterProcedure.
      * <TOTEM:PARA. Form1-Pb-2-AfterProcedure>
           modify pb-cancel, bitmap-number 1 
           .
      * <TOTEM:END>
       Screen1-Rb-1-BeforeProcedure.
      * <TOTEM:PARA. Screen1-Rb-1-BeforeProcedure>
           modify control-handle, color = colore-nu
           .
      * <TOTEM:END>
       Screen1-Rb-1-AfterProcedure.
      * <TOTEM:PARA. Screen1-Rb-1-AfterProcedure>
           modify control-handle, color = colore-or
           .
      * <TOTEM:END>
       stdoc-Ev-After-Program.
      * <TOTEM:PARA. stdoc-Ev-After-Program>
           SET LK-BL-CANCELLAZIONE TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           destroy font-evidenzia-griglia.

           call "W$BITMAP" using wbitmap-destroy, elemento-bmp 
           .
      * <TOTEM:END>
       Form1-Cm-1-BeforeProcedure.
      * <TOTEM:PARA. Form1-Cm-1-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       Form1-Cm-1-AfterProcedure.
      * <TOTEM:PARA. Form1-Cm-1-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       ef-bolla-BeforeProcedure.
      * <TOTEM:PARA. ef-bolla-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-cli-BeforeProcedure.
      * <TOTEM:PARA. ef-cli-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           move 1 to e-cerca.
           modify tool-cerca, enabled e-cerca 
           .
      * <TOTEM:END>
       ef-dest-BeforeProcedure.
      * <TOTEM:PARA. ef-dest-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           move 1 to e-cerca.
           modify tool-cerca, enabled e-cerca 
           .
      * <TOTEM:END>
       EF-data-FROM-BeforeProcedure.
      * <TOTEM:PARA. EF-data-FROM-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       EF-DATA-TO-BeforeProcedure.
      * <TOTEM:PARA. EF-DATA-TO-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-ordine-BeforeProcedure.
      * <TOTEM:PARA. ef-ordine-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-fattura-BeforeProcedure.
      * <TOTEM:PARA. ef-fattura-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-nc-BeforeProcedure.
      * <TOTEM:PARA. ef-nc-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-bolla-AfterProcedure.
      * <TOTEM:PARA. ef-bolla-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO 
           .
      * <TOTEM:END>
       ef-cli-AfterProcedure.
      * <TOTEM:PARA. ef-cli-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           move 0 to e-cerca.
           modify tool-cerca, enabled e-cerca.
           perform CONTROLLO 
           .
      * <TOTEM:END>
       ef-dest-AfterProcedure.
      * <TOTEM:PARA. ef-dest-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           move 0 to e-cerca.
           modify tool-cerca, enabled e-cerca.
           perform CONTROLLO 
           .
      * <TOTEM:END>
       EF-data-FROM-AfterProcedure.
      * <TOTEM:PARA. EF-data-FROM-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO 
           .
      * <TOTEM:END>
       EF-DATA-TO-AfterProcedure.
      * <TOTEM:PARA. EF-DATA-TO-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO 
           .
      * <TOTEM:END>
       ef-ordine-AfterProcedure.
      * <TOTEM:PARA. ef-ordine-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO 
           .
      * <TOTEM:END>
       ef-fattura-AfterProcedure.
      * <TOTEM:PARA. ef-fattura-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO 
           .
      * <TOTEM:END>
       ef-nc-AfterProcedure.
      * <TOTEM:PARA. ef-nc-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO 
           .
      * <TOTEM:END>
       rb-elenco-LinkTo.
      * <TOTEM:PARA. rb-elenco-LinkTo>
           move 1 to e-elenco.
           move 0 to e-ordine e-bolla e-fattura e-nc.
           perform CANCELLA-COLORE.
           move 78-ID-ef-cli to control-id
           move 4 to accept-control.
           move 0 to ef-ordine-buf ef-bolla-buf ef-fattura-buf ef-nc-buf
           display form1 
           .
      * <TOTEM:END>
       rb-ordine-LinkTo.
      * <TOTEM:PARA. rb-ordine-LinkTo>
           move 1 to e-ordine.
           move 0 to e-elenco e-bolla e-fattura e-nc.
           perform CANCELLA-COLORE.
           move 78-ID-ef-ordine to control-id
           move 4 to accept-control.
           move 0 to ef-nc-buf ef-bolla-buf ef-fattura-buf.
           perform INITIALIZE-ELENCO.
           display form1 
           .
      * <TOTEM:END>
       rb-bolla-LinkTo.
      * <TOTEM:PARA. rb-bolla-LinkTo>
           move 1 to e-bolla.
           move 0 to e-elenco e-ordine e-fattura e-nc.
           perform CANCELLA-COLORE.
           move 78-ID-ef-bolla to control-id
           move 4 to accept-control.
           move 0 to ef-ordine-buf ef-fattura-buf ef-nc-buf.
           perform INITIALIZE-ELENCO.
           display form1 
           .
      * <TOTEM:END>
       rb-fattura-LinkTo.
      * <TOTEM:PARA. rb-fattura-LinkTo>
           move 1 to e-fattura.
           move 0 to e-elenco e-ordine e-bolla e-nc.
           perform CANCELLA-COLORE.
           move 78-ID-ef-fattura to control-id
           move 4 to accept-control.
           move 0 to ef-ordine-buf ef-bolla-buf ef-nc-buf.
           perform INITIALIZE-ELENCO.
           display form1 
           .
      * <TOTEM:END>
       rb-nc-LinkTo.
      * <TOTEM:PARA. rb-nc-LinkTo>
           move 1 to e-nc.
           move 0 to e-elenco e-ordine e-bolla e-fattura.
           perform CANCELLA-COLORE.
           move 78-ID-ef-nc to control-id
           move 4 to accept-control.
           move 0 to ef-ordine-buf ef-bolla-buf ef-fattura-buf.
           perform INITIALIZE-ELENCO.
           display form1 
           .
      * <TOTEM:END>
       rb-ordine-BeforeProcedure.
      * <TOTEM:PARA. rb-ordine-BeforeProcedure>
           modify control-handle, color = colore-nu
           .
      * <TOTEM:END>
       rb-bolla-BeforeProcedure.
      * <TOTEM:PARA. rb-bolla-BeforeProcedure>
           modify control-handle, color = colore-nu
           .
      * <TOTEM:END>
       rb-fattura-BeforeProcedure.
      * <TOTEM:PARA. rb-fattura-BeforeProcedure>
           modify control-handle, color = colore-nu
           .
      * <TOTEM:END>
       rb-nc-BeforeProcedure.
      * <TOTEM:PARA. rb-nc-BeforeProcedure>
           modify control-handle, color = colore-nu
           .
      * <TOTEM:END>
       rb-ordine-AfterProcedure.
      * <TOTEM:PARA. rb-ordine-AfterProcedure>
           modify control-handle, color = colore-or
           .
      * <TOTEM:END>
       rb-bolla-AfterProcedure.
      * <TOTEM:PARA. rb-bolla-AfterProcedure>
           modify control-handle, color = colore-or
           .
      * <TOTEM:END>
       rb-fattura-AfterProcedure.
      * <TOTEM:PARA. rb-fattura-AfterProcedure>
           modify control-handle, color = colore-or
           .
      * <TOTEM:END>
       rb-nc-AfterProcedure.
      * <TOTEM:PARA. rb-nc-AfterProcedure>
           modify control-handle, color = colore-or
           .
      * <TOTEM:END>
       gd-ordini-Ev-Msg-Begin-Drag.
      * <TOTEM:PARA. gd-ordini-Ev-Msg-Begin-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd-ordini-Ev-Msg-Begin-Entry.
      * <TOTEM:PARA. gd-ordini-Ev-Msg-Begin-Entry>
           inquire gd-ordini, entry-reason in como-x.

           set event-action to event-action-fail-terminate.
           evaluate como-x
           when X"00"|doppio click
                if event-data-1 = 11
                   initialize cmd call-status
                   inquire gd-ordini(riga, 11), cell-data in col-sito
                   if col-sito not = spaces
                      inspect col-sito replacing trailing spaces by 
           low-value
                      initialize cmd
                      string "START "   delimited size
                            x"22222022" delimited size
                            col-sito    delimited low-value
                            x"22"       delimited size
                            into cmd
                      end-string
                      call "C$SYSTEM" using cmd, 225
                                     giving call-status
            
                      inspect col-sito replacing trailing low-value by 
           spaces
                   end-if
                else
                   inquire gd-ordini, cursor-y in riga
                   set CallManutenzione to true
                end-if
           when X"0D"|invio
                inquire gd-ordini, cursor-y in riga
                set CallManutenzione to true
           end-evaluate 
           .
      * <TOTEM:END>
       gd-ordini-Ev-Msg-End-Drag.
      * <TOTEM:PARA. gd-ordini-Ev-Msg-End-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd-ordini-Ev-Msg-Goto-Cell.
      * <TOTEM:PARA. gd-ordini-Ev-Msg-Goto-Cell>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd-ordini-Ev-Msg-Goto-Cell-Drag.
      * <TOTEM:PARA. gd-ordini-Ev-Msg-Goto-Cell-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd-ordini-Ev-Msg-Goto-Cell-Mouse.
      * <TOTEM:PARA. gd-ordini-Ev-Msg-Goto-Cell-Mouse>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       pb-annulla2-BeforeProcedure.
      * <TOTEM:PARA. pb-annulla2-BeforeProcedure>
           modify pb-annulla2, bitmap-number = 2 
           .
      * <TOTEM:END>
       pb-annulla2-AfterProcedure.
      * <TOTEM:PARA. pb-annulla2-AfterProcedure>
           modify pb-annulla2, bitmap-number = 1 
           .
      * <TOTEM:END>
       pb-ok2-BeforeProcedure.
      * <TOTEM:PARA. pb-ok2-BeforeProcedure>
           modify pb-ok2, bitmap-number = 2 
           .
      * <TOTEM:END>
       pb-ok2-AfterProcedure.
      * <TOTEM:PARA. pb-ok2-AfterProcedure>
           modify pb-ok2, bitmap-number = 1 
           .
      * <TOTEM:END>
       pb-ok2-LinkTo.
      * <TOTEM:PARA. pb-ok2-LinkTo>
           inquire gd-ordini, CURSOR-Y = riga.

           perform ORDINE-DA-GRIGLIA 
           .
      * <TOTEM:END>
       ef-num-BeforeProcedure.
      * <TOTEM:PARA. ef-num-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-num-AfterProcedure.
      * <TOTEM:PARA. ef-num-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>

      *{TOTEM}END

      *{TOTEM}SHOW-MSG
       MESSAGE-FOR-FILEERROR.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
              MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           .

       SHOW-TRANSACTION-ROUTINE.
           IF TOTEM-TRANSACTION-FLAG = SPACES
              IF TRANSACTION-STATUS NOT = 0
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-1
              END-IF
           ELSE
              PERFORM SHOW-MSG-ROUTINE
              IF TRANSACTION-STATUS = 0
                 MOVE "Transazione terminata con Rollback." TO 
           TOTEM-MSG-3
              ELSE
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-3
              END-IF
           END-IF
           .

       SHOW-MSG-ROUTINE.
           MOVE SPACE TO TOTEM-MSG-1 TOTEM-MSG-2 TOTEM-MSG-3
           EVALUATE TOTEM-MSG-ID
               WHEN "10"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Nessun altro dato." TO TOTEM-MSG-2
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "22"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Chiave Duplicata." TO TOTEM-MSG-2
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "23"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Raggiunta fine file." TO TOTEM-MSG-2
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "101"
                    MOVE "Terminare l'applicazione?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "201"
                    MOVE "Aggiungere un nuovo record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "202"
                    MOVE "Aggiornare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "203"
                    MOVE "Cancellare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "204"
                    MOVE "Chiave duplicata." TO TOTEM-MSG-1
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "301"
                    MOVE "Inserimento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "302"
                    MOVE "Aggiornamento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "303"
                    MOVE "Cancellazione avvenuta con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "401"
                    MOVE "Shell non trovata." TO TOTEM-MSG-1
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN OTHER
                    MOVE TEXT-MESSAGE TO TOTEM-MSG-1
                    STRING "FILE:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-3
                    MOVE 0 TO TOTEM-IDX1
                    INSPECT TOTEM-MSG-3 TALLYING TOTEM-IDX1
                       FOR TRAILING SPACE
                    STRING TOTEM-MSG-3(1:TOTEM-MSG-LENGTH - 
           TOTEM-IDX1), 
                       ", FILE STATUS ", PRIMARY-ERROR "," 
                       SECONDARY-ERROR
                    DELIMITED BY SIZE INTO TOTEM-MSG-2
                    MOVE SPACES TO TOTEM-MSG-3
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
           END-EVALUATE
           PERFORM MESSAGE-BOX-ROUTINE
           .

       MESSAGE-BOX-ROUTINE.
           MOVE 1 TO TOTEM-MSG-TEXT-POINTER
           IF TOTEM-MSG-1 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-1 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              STRING TOTEM-MSG-1( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                 DELIMITED BY SIZE
                 INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-2 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-2 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-2( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-3 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-3 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-3( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-TEXT-POINTER = 1
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-TEXT TALLYING TOTEM-MSG-SIZE FOR 
           TRAILING SPACE
                  COMPUTE TOTEM-MSG-TEXT-POINTER = 
           TOTEM-MSG-FULL-LENGTH - TOTEM-MSG-SIZE + 1
           END-IF
           MOVE LOW-VALUES TO TOTEM-MSG-TEXT(TOTEM-MSG-TEXT-POINTER : 1 
           )
           .

       MESSAGE-BOX-DISPLAY.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

      *{TOTEM}END

