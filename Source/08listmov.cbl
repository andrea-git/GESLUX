      *{TOTEM}PRG-COMMENT
      * 08listmov.Cbl
      * 08listmov.Cbl is generated by TOTEM
      * This is a generated file. DO NOT modify this file directly.
      *{TOTEM}END
       IDENTIFICATION       DIVISION.
      *{TOTEM}PRGID
       PROGRAM-ID.          08listmov.
       AUTHOR.              ANDREA EVENTI.
       DATE-WRITTEN.        lunedì 15 ottobre 2018 11:00:02.
       REMARKS.
      *{TOTEM}END

       ENVIRONMENT          DIVISION.
       CONFIGURATION        SECTION.
       SPECIAL-NAMES.
      *{TOTEM}SPECIAL-NAME
      * <TOTEM:EPT. INIT:08listmov, INIT:08listmov, SpecialName>
      * <TOTEM:END>
      *{TOTEM}END
      *{TOTEM}ACTIVEX-DEF
      *{TOTEM}END
      *{TOTEM}DECIMAL-POINT
           DECIMAL-POINT IS COMMA.
      *{TOTEM}END

       INPUT-OUTPUT         SECTION.
       FILE-CONTROL.
      *{TOTEM}FILE-CONTROL
           COPY "tparamge.sl".
           COPY "anautf.sl".
           COPY "lineseq.sl".
      *{TOTEM}END
       DATA                 DIVISION.
       FILE                 SECTION.
      *{TOTEM}FILE
           COPY "tparamge.fd".
           COPY "anautf.fd".
           COPY "lineseq.fd".
      *{TOTEM}END

       WORKING-STORAGE      SECTION.
      *{TOTEM}ACU-DEF
               COPY "acugui.def".
               COPY "acucobol.def".
               COPY "fonts.def".
               COPY "crtvars.def".
               COPY "showmsg.def".
               COPY "totem.def".
               COPY "F:\lubex\geslux\Copylib\standard.def".
      *{TOTEM}END

      *{TOTEM}COPY-WORKING
      * Key Status
       77 Key-Status IS SPECIAL-NAMES CRT STATUS PIC 9(5) VALUE 0.
          88 Enter-Pushed VALUE 13.
          88 Exit-Pushed VALUE 27.
          88 Message-Received VALUE 95.
          88 Event-Occurred VALUE 96.
          88 Screen-No-Input-Field VALUE 97.
          88 Screen-Time-Out VALUE 99.
      * Properties & User defined Working Stoarge
           COPY  "SPLCRT2GRAF.LKS".
           COPY  "LINK-LISTMOV.DEF".
       78 titolo VALUE IS "Lista Entrate/Uscite per totali giornalieri"
           . 
       01 file-info.
           05 file-size        PIC  X(8)
                      USAGE IS COMP-X.
           05 file-date        PIC  9(8)
                      USAGE IS COMP-X.
           05 file-time        PIC  9(8)
                      USAGE IS COMP-X.
       77 ultima-data      PIC  9.
       77 data-oggi        PIC  9(8).
       77 mese PIC  99.
       77 giorno           PIC  99.
       77 como-anno        PIC  9(4).
       77 anno PIC  9(4).
       77 E-ESCI           PIC  9
                  VALUE IS 1.
       77 E-NUOVO          PIC  9
                  VALUE IS 1.
       77 E-CANCELLA       PIC  9
                  VALUE IS 1.
       77 E-SALVA          PIC  9
                  VALUE IS 1.
       77 Small-Font
                  USAGE IS HANDLE OF FONT SMALL-FONT.
       77 Default-Font
                  USAGE IS HANDLE OF FONT DEFAULT-FONT.
       77 form1-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 AUTO-ID          PIC  9(6)
                  VALUE IS 0.
       77 ok-73x21-bmp     PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 cancel-73x21-bmp PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 BLUE-FINO-28X24-BMP          PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 BLUE-DA-28X24-BMP            PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 como-data-to     PIC  9(8).
       77 como-data-from   PIC  9(8).
       77 entrate-z        PIC  ----.---.---.--9,999.
       77 uscite-z         PIC  ----.---.---.--9,999.
       77 giacenza-z       PIC  ----.---.---.--9,999.
       77 Form1-Tb-1-Handlea
                  USAGE IS HANDLE OF WINDOW.
       77 E-CERCA          PIC  9
                  VALUE IS 0.
       77 ef-data-from-buf PIC  99/99/9999.
       77 ef-data-to-buf   PIC  99/99/9999.
       77 ESCI-73X21-BMP   PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 bottone-ok-bmp   PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 bottone-cancel-bmp           PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 BOTTONE-EXIT-BMP PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 Verdana12-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 lab-codice-buf   PIC  z(5).
       77 Screen1-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 Verdana12B-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 ef-num-reg-buf   PIC  z(8).
       77 STATUS-tparamge  PIC  X(2).
           88 Valid-STATUS-tparamge VALUE IS "00" THRU "09". 
       77 lab-reg-buf      PIC  X(40).
       77 STATUS-anautf    PIC  X(2).
           88 Valid-STATUS-anautf VALUE IS "00" THRU "09". 
       77 toolbar-bmp      PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 e-data           PIC  9
                  VALUE IS 1.
       77 Verdana12BI-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 scr-calprovv-handle
                  USAGE IS HANDLE OF WINDOW.
       77 v-screen1        PIC  9
                  VALUE IS 1.
       77 BOTTONE-STAMPA-BMP           PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 e-cliente        PIC  9
                  VALUE IS 1.
       01 rec-grid.
           05 col-data         PIC  x(8).
           05 col-entrate      PIC  x(20).
           05 col-uscite       PIC  x(20).
           05 col-giacenza     PIC  x(20).
       77 scr-visua-handle
                  USAGE IS HANDLE OF WINDOW.
       77 tot-entrate      PIC  s9(15)v999.
       77 tot-uscite       PIC  s9(15)v999.
       77 tot-giacenza     PIC  s9(15)v999.
       77 como-entrate     PIC  s9(15)v999.
       77 como-uscite      PIC  s9(15)v999.
       77 como-giacenza    PIC  s9(15)v999.
       77 wstampa          PIC  X(256).
       77 STATUS-lineseq   PIC  X(2).
           88 Valid-STATUS-lineseq VALUE IS "00" THRU "09". 
       77 scr-visua2-handle
                  USAGE IS HANDLE OF WINDOW.

      ***********************************************************
      *   Code Gen's Buffer                                     *
      ***********************************************************
       77 STATUS-Form1-FLAG-REFRESH PIC  9.
          88 Form1-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 STATUS-screen1-FLAG-REFRESH PIC  9.
          88 screen1-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 STATUS-scr-visua-FLAG-REFRESH PIC  9.
          88 scr-visua-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 STATUS-scr-visua2-FLAG-REFRESH PIC  9.
          88 scr-visua2-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 TMP-DataSet1-tparamge-BUF     PIC X(815).
       77 TMP-DataSet1-anautf-BUF     PIC X(638).
       77 TMP-DataSet1-lineseq-BUF     PIC X(900).
      * VARIABLES FOR RECORD LENGTH.
       77  TotemFdSlRecordClearOffset   PIC 9(5) COMP-4.
       77  TotemFdSlRecordLength        PIC 9(5) COMP-4.
      * FILE'S LOCK MODE FLAG
       77 DataSet1-tparamge-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tparamge-LOCK  VALUE "Y".
       77 DataSet1-KEYIS   PIC 9(3) VALUE 1.
       77 DataSet1-tparamge-KEY1-ORDER  PIC X VALUE "A".
          88 DataSet1-tparamge-KEY1-Asc  VALUE "A".
          88 DataSet1-tparamge-KEY1-Desc VALUE "D".
       77 DataSet1-anautf-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-anautf-LOCK  VALUE "Y".
       77 DataSet1-anautf-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-anautf-KEY-Asc  VALUE "A".
          88 DataSet1-anautf-KEY-Desc VALUE "D".
       77 DataSet1-lineseq-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-lineseq-LOCK  VALUE "Y".
       77 DataSet1-lineseq-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-lineseq-KEY-Asc  VALUE "A".
          88 DataSet1-lineseq-KEY-Desc VALUE "D".


      *{TOTEM}END

      *{TOTEM}ID-LOGICI
      ***** Elenco ID Logici *****
       78  78-ID-ef-data-from VALUE 5001.
       78  78-ID-chk-data VALUE 5002.
       78  78-ID-ef-data-to VALUE 5003.
       78  78-ID-ef-num-reg VALUE 5004.
      ***** Fine ID Logici *****
      *{TOTEM}END

       LINKAGE          SECTION.
      *{TOTEM}LINKAGE
           COPY  "COMMON-LINKAGE.DEF".
      *{TOTEM}END

       SCREEN           SECTION.
      *{TOTEM}COPY-SCREEN
      * FORM
       01 
           Form1, 
           BEFORE PROCEDURE Form1-BeforeProcedure,
           AFTER PROCEDURE  Form1-AFTER-SCREEN
           .

      * FRAME
       05
           frame-limiti, 
           Frame, 
           COL 1,50, 
           LINE 1,56,
           LINES 9,56 ,
           SIZE 44,60 ,
           RAISED,
           ID IS 9,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           VERY-HEAVY,
           TITLE "Selezione limiti",
           TITLE-POSITION 2,
           .

      * ENTRY FIELD
       05
           ef-data-from, 
           Entry-Field, 
           COL 4,30, 
           LINE 3,33,
           LINES 1,33 ,
           SIZE 11,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED e-data,
           ID IS 78-ID-ef-data-from,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           NUMERIC,
           VALUE ef-data-from-buf,
           AFTER PROCEDURE ef-data-from-AfterProcedure, 
           BEFORE PROCEDURE ef-data-from-BeforeProcedure, 
           .


      * CHECK BOX
       05
           chk-data, 
           Check-Box, 
           COL 4,30, 
           LINE 5,39,
           LINES 1,00 ,
           SIZE 1,90 ,
           EXCEPTION-VALUE 1001
           FLAT,
           ID IS 78-ID-chk-data,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           VALUE ultima-data,
           AFTER PROCEDURE Screen4-Cb-1-AfterProcedure,
           .
      * ENTRY FIELD
       05
           ef-data-to, 
           Entry-Field, 
           COL 32,30, 
           LINE 3,33,
           LINES 1,33 ,
           SIZE 11,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED 1,
           ID IS 78-ID-ef-data-to,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           NUMERIC,
           VALUE ef-data-to-buf,
           AFTER PROCEDURE ef-data-to-AfterProcedure, 
           BEFORE PROCEDURE ef-data-to-BeforeProcedure, 
           .


      * LABEL
       05
           Screen3-La-1a, 
           Label, 
           COL 20,30, 
           LINE 3,28,
           LINES 1,17 ,
           SIZE 7,00 ,
           ID IS 100,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Data",
           .

      * BITMAP
       05
           Bitmap-freccia-fino, 
           Bitmap, 
           COL 28,30, 
           LINE 3,33,
           LINES 24,00 ,
           SIZE 28,00 ,
           TRANSPARENT-COLOR TR-COLOR,
           BITMAP-HANDLE BLUE-FINO-28X24-BMP,
           BITMAP-NUMBER 1,
           ID IS 13,
           .

      * BITMAP
       05
           Bitmap-freccia-da, 
           Bitmap, 
           COL 16,30, 
           LINE 3,33,
           LINES 24,00 ,
           SIZE 28,00 ,
           TRANSPARENT-COLOR TR-COLOR,
           BITMAP-HANDLE BLUE-DA-28X24-BMP,
           BITMAP-NUMBER 1,
           ID IS 14,
           .

      * LABEL
       05
           Screen4-blockpgm-1, 
           Label, 
           COL 20,00, 
           LINE 2,56,
           LINES 0,44 ,
           SIZE 1,60 ,
           ID IS 1,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "BlockPgm",
           VISIBLE v-custom,
           .

      * LABEL
       05
           Screen4-Custom1-2, 
           Label, 
           COL 4,00, 
           LINE 2,45,
           LINES 0,50 ,
           SIZE 2,20 ,
           ID IS 8,
           TRANSPARENT,
           TITLE "CUSTOM CONTROL",
           VISIBLE v-custom,
           .

      * LABEL
       05
           Screen4-La-4, 
           Label, 
           COL 4,30, 
           LINE 8,56,
           LINES 1,33 ,
           SIZE 7,00 ,
           ID IS 20,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Registro",
           .

      * LABEL
       05
           Form1-La-1abbbaab, 
           Label, 
           COL 16,30, 
           LINE 6,73,
           LINES 1,11 ,
           SIZE 15,00 ,
           COLOR IS 80,
           ID IS 561,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TITLE "Filtri di stampa",
           .

      * BAR
       05
           Screen4-Br-1aaaaba, 
           Bar,
           COL 1,90, 
           LINE 7,28,
           SIZE 14,20 ,
           ID IS 562,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           COLORS (8, 8),
           SHADING (-1, 1),
           WIDTH 2,
           .

      * BAR
       05
           Screen4-Br-1aaaabaa, 
           Bar,
           COL 31,50, 
           LINE 7,28,
           SIZE 14,20 ,
           ID IS 563,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           COLORS (8, 8),
           SHADING (-1, 1),
           WIDTH 2,
           .

      * ENTRY FIELD
       05
           ef-num-reg, 
           Entry-Field, 
           COL 12,50, 
           LINE 8,56,
           LINES 1,33 ,
           SIZE 10,00 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-ef-num-reg,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           VALUE ef-num-reg-buf,
           AFTER PROCEDURE ef-num-reg-AfterProcedure, 
           BEFORE PROCEDURE ef-num-reg-BeforeProcedure, 
           .

      * LABEL
       05
           lab-reg, 
           Label, 
           COL 23,50, 
           LINE 8,56,
           LINES 2,00 ,
           SIZE 21,60 ,
           COLOR IS 5,
           ID IS 4,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-reg-buf,
           .

      * LABEL
       05
           Screen4-La-1, 
           Label, 
           COL 6,50, 
           LINE 5,06,
           LINES 1,00 ,
           SIZE 29,70 ,
           ID IS 6,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Utilizza ultima data da registro",
           .

      * FRAME
       05
           Screen4-Fr-1, 
           Frame, 
           COL 1,00, 
           LINE 11,22,
           LINES 2,78 ,
           SIZE 45,90 ,
           LOWERED,
           ID IS 29,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           .

      * PUSH BUTTON
       05
           pb-ok, 
           Push-Button, 
           COL 30,90, 
           LINE 11,91,
           LINES 30,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE BOTTONE-OK-BMP,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 1000,
           FLAT,
           ID IS 200,
           AFTER PROCEDURE pb-ok-AfterProcedure, 
           BEFORE PROCEDURE pb-ok-BeforeProcedure, 
           .

      * PUSH BUTTON
       05
           pb-annulla, 
           Push-Button, 
           COL 38,80, 
           LINE 11,91,
           LINES 30,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE BOTTONE-CANCEL-BMP,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 27,
           FLAT,
           ID IS 201,
           SELF-ACT,
           ESCAPE-BUTTON,
           AFTER PROCEDURE pb-annulla-AfterProcedure, 
           BEFORE PROCEDURE pb-annulla-BeforeProcedure, 
           .

      * TOOLBAR
       01
           Form1-Tb-1a,
           .    

      * PUSH BUTTON
       05
           TOOL-ESCI, 
           Push-Button, 
           COL 1,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           ENABLED E-ESCI,
           EXCEPTION-VALUE 27,
           FLAT,
           ID IS 202,
           SELF-ACT,
           ESCAPE-BUTTON,
           TITLE "&Esci",
           .

      * PUSH BUTTON
       05
           TOOL-CERCA, 
           Push-Button, 
           COL 6,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           BITMAP-NUMBER 8,
           UNFRAMED,
           SQUARE,
           ENABLED E-CERCA,
           EXCEPTION-VALUE 8,
           FLAT,
           ID IS 12,
           SELF-ACT,
           TITLE "Cerca (F8)",
           .

      * FORM
       01 
           screen1, 
           AFTER PROCEDURE  screen1-AFTER-SCREEN
           .

      * LABEL
       05
           Screen1-blockpgm-1, 
           Label, 
           COL 1,00, 
           LINE 1,00,
           LINES 0,56 ,
           SIZE 1,82 ,
           ID IS 1,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "BlockPgm",
           VISIBLE v-custom,
           .

      * LABEL
       05
           Screen1-La-1b, 
           Label, 
           COL 2,45, 
           LINE 1,67,
           LINES 1,00 ,
           SIZE 35,00 ,
           ID IS 2,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Caricamento movimentazioni UTF in corso...",
           .

      * FORM
       01 
           scr-visua, 
           AFTER PROCEDURE  scr-visua-AFTER-SCREEN
           .

      * PUSH BUTTON
       05
           pb-stampa, 
           Push-Button, 
           COL 29,10, 
           LINE 34,17,
           LINES 30,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE BOTTONE-STAMPA-BMP,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 1000,
           FLAT,
           FONT IS Small-Font,
           ID IS 1,
           TITLE "Stampa",
           AFTER PROCEDURE pb-stampa-AfterProcedure, 
           BEFORE PROCEDURE pb-stampa-BeforeProcedure, 
           .

      * GRID
       05
           gd1, 
           Grid, 
           COL 2,10, 
           LINE 9,00,
           LINES 21,89 ,
           SIZE 62,00 ,
           BOXED,
           CENTERED-HEADINGS,
           DATA-COLUMNS (1, 9, 29),
           ALIGNMENT ("C", "R", "R"),
           SEPARATION (5, 5, 5),
           DATA-TYPES ("D(8)", "X", "X"),
           NUM-COL-HEADINGS 1,
           COLUMN-HEADINGS,
           CURSOR-FRAME-WIDTH 0,
           DIVIDER-COLOR 1,
           HEADING-COLOR 257,
           HEADING-DIVIDER-COLOR 1,
           HEADING-FONT IS Verdana12BI-Occidentale,
           ID IS 5,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TILED-HEADINGS,
           VIRTUAL-WIDTH 60,
           VPADDING 50,
           EVENT PROCEDURE gd-mov-Event-Proc,
           .

      * LABEL
       05
           Screen1-La-1, 
           Label, 
           COL 28,10, 
           LINE 2,00,
           LINES 1,00 ,
           SIZE 10,00 ,
           FONT IS Verdana12BI-Occidentale,
           ID IS 2,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Registro",
           .

      * LABEL
       05
           lab-num, 
           Label, 
           COL 28,10, 
           LINE 4,00,
           LINES 1,00 ,
           SIZE 10,00 ,
           COLOR IS 5,
           FONT IS Verdana12BI-Occidentale,
           ID IS 3,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE ef-num-reg-buf,
           .

      * LABEL
       05
           lab-des, 
           Label, 
           COL 8,10, 
           LINE 6,00,
           LINES 1,00 ,
           SIZE 50,00 ,
           COLOR IS 5,
           FONT IS Verdana12BI-Occidentale,
           ID IS 4,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE lab-reg-buf,
           .

      * GRID
       05
           gd-tot, 
           Grid, 
           COL 2,10, 
           LINE 32,00,
           LINES 1,67 ,
           SIZE 62,00 ,
           BOXED,
           CENTERED-HEADINGS,
           DATA-COLUMNS (1, 11, 30),
           ALIGNMENT ("C", "R", "R"),
           SEPARATION (5, 5, 5),
           DATA-TYPES ("D(10)", "X", "X"),
           CURSOR-FRAME-WIDTH 0,
           DIVIDER-COLOR 1,
           HEADING-COLOR 257,
           HEADING-DIVIDER-COLOR 1,
           ID IS 6,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           NUM-ROWS 1,
           ROW-HEADINGS,
           TILED-HEADINGS,
           VIRTUAL-WIDTH 60,
           VPADDING 50,
           BEFORE PROCEDURE gd-mov-BeforeProcedure, 
           EVENT PROCEDURE gd-mov-Event-Proc,
           .

      * BAR
       05
           Screen1-Br-1, 
           Bar,
           COL 2,10, 
           LINE 31,17,
           SIZE 62,00 ,
           ID IS 7,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           COLORS (8, 8),
           SHADING (-1, 1),
           WIDTH 2,
           .

      * BAR
       05
           Screen1-Br-1a, 
           Bar,
           COL 2,10, 
           LINE 31,50,
           SIZE 62,00 ,
           ID IS 8,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           COLORS (8, 8),
           SHADING (-1, 1),
           WIDTH 2,
           .

      * FRAME
       05
           Screen1-Fr-1, 
           Frame, 
           COL 2,10, 
           LINE 1,00,
           LINES 7,39 ,
           SIZE 62,00 ,
           ID IS 9,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           .

      * FORM
       01 
           scr-visua2, 
           AFTER PROCEDURE  scr-visua2-AFTER-SCREEN
           .

      * PUSH BUTTON
       05
           pb-stampa2, 
           Push-Button, 
           COL 38,20, 
           LINE 34,17,
           LINES 30,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE BOTTONE-STAMPA-BMP,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 1000,
           FLAT,
           FONT IS Small-Font,
           ID IS 1,
           TITLE "Stampa",
           AFTER PROCEDURE pb-stampa2-AfterProcedure, 
           BEFORE PROCEDURE pb-stampa2-BeforeProcedure, 
           .

      * GRID
       05
           gd2, 
           Grid, 
           COL 2,20, 
           LINE 9,00,
           LINES 21,89 ,
           SIZE 80,20 ,
           BOXED,
           CENTERED-HEADINGS,
           DATA-COLUMNS (1, 9, 29, 49),
           ALIGNMENT ("C", "R", "R", "R"),
           SEPARATION (5, 5, 5, 5),
           DATA-TYPES ("D(8)", "X", "X", "X"),
           NUM-COL-HEADINGS 1,
           COLUMN-HEADINGS,
           CURSOR-FRAME-WIDTH 0,
           DIVIDER-COLOR 1,
           HEADING-COLOR 257,
           HEADING-DIVIDER-COLOR 1,
           HEADING-FONT IS Verdana12BI-Occidentale,
           ID IS 5,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TILED-HEADINGS,
           VIRTUAL-WIDTH 80,
           VPADDING 50,
           EVENT PROCEDURE gd-mov-Event-Proc,
           .

      * LABEL
       05
           Screen1-La-1a, 
           Label, 
           COL 37,30, 
           LINE 2,00,
           LINES 1,00 ,
           SIZE 10,00 ,
           FONT IS Verdana12BI-Occidentale,
           ID IS 2,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Registro",
           .

      * LABEL
       05
           lab-numa, 
           Label, 
           COL 37,30, 
           LINE 4,00,
           LINES 1,00 ,
           SIZE 10,00 ,
           COLOR IS 5,
           FONT IS Verdana12BI-Occidentale,
           ID IS 3,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE ef-num-reg-buf,
           .

      * LABEL
       05
           lab-desa, 
           Label, 
           COL 17,30, 
           LINE 6,00,
           LINES 1,00 ,
           SIZE 50,00 ,
           COLOR IS 5,
           FONT IS Verdana12BI-Occidentale,
           ID IS 4,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE lab-reg-buf,
           .

      * GRID
       05
           gd-tot2, 
           Grid, 
           COL 2,20, 
           LINE 32,00,
           LINES 1,67 ,
           SIZE 80,20 ,
           BOXED,
           CENTERED-HEADINGS,
           DATA-COLUMNS (1, 9, 28, 47),
           ALIGNMENT ("C", "R", "R", "R"),
           SEPARATION (5, 5, 5, 5),
           DATA-TYPES ("D(10)", "X", "X", "X"),
           CURSOR-FRAME-WIDTH 0,
           DIVIDER-COLOR 1,
           HEADING-COLOR 257,
           HEADING-DIVIDER-COLOR 1,
           ID IS 6,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           NUM-ROWS 1,
           ROW-HEADINGS,
           TILED-HEADINGS,
           VIRTUAL-WIDTH 80,
           VPADDING 50,
           BEFORE PROCEDURE gd-mov-BeforeProcedure, 
           EVENT PROCEDURE gd-mov-Event-Proc,
           .

      * BAR
       05
           Screen1-Br-1b, 
           Bar,
           COL 2,20, 
           LINE 31,17,
           SIZE 80,20 ,
           ID IS 7,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           COLORS (8, 8),
           SHADING (-1, 1),
           WIDTH 2,
           .

      * BAR
       05
           Screen1-Br-1aa, 
           Bar,
           COL 2,20, 
           LINE 31,50,
           SIZE 80,20 ,
           ID IS 8,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           COLORS (8, 8),
           SHADING (-1, 1),
           WIDTH 2,
           .

      * FRAME
       05
           Screen1-Fr-1a, 
           Frame, 
           COL 2,20, 
           LINE 1,00,
           LINES 7,39 ,
           SIZE 80,20 ,
           ID IS 9,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           .

      *{TOTEM}END

      *{TOTEM}LINKPARA
       PROCEDURE  DIVISION USING LK-BLOCKPGM, USER-CODI, LIVELLO-ABIL.
      *{TOTEM}END

      *{TOTEM}DECLARATIVE
       DECLARATIVES.
      * <TOTEM:EPT. INIT:08listmov, INIT:08listmov, BeforeDeclarative>
      ***---
       TPARAMGE-ERR SECTION.
           use after error procedure on tparamge.
           set tutto-ok  to true.
           evaluate status-tparamge
           when "35"
                display message "File [TPARAMGE] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TPARAMGE] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TPARAMGE] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       ANAUTF-ERR SECTION.
           use after error procedure on anautf.
           set tutto-ok  to true.
           evaluate status-anautf
           when "35"
                display message "File [ANAUTF] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [ANAUTF] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[ANAUTF] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       LINESEQ-ERR SECTION.
           use after error procedure on lineseq.
           set tutto-ok  to true.
           evaluate status-lineseq
           when "35"
                display message "File [LINESEQ] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [LINESEQ] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[LINESEQ] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.

      * <TOTEM:END>
       INPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON INPUT.
       0100-DECL.
           EXIT.
       I-O-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON I-O.
       0200-DECL.
           EXIT.
       OUTPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON OUTPUT.
       0300-DECL.
           EXIT.
       TRANSACTION-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON TRANSACTION.
       0400-DECL.
           EXIT.
       END DECLARATIVES.
      *{TOTEM}END

       MAIN-LOGIC.
      *{TOTEM}ENTRY-BEFPRG
      *    Before-Program
           PERFORM ginqui-Ev-Before-Program
      *{TOTEM}END
           PERFORM INITIALIZE-ROUTINE.
      * run main screen
      *{TOTEM}RUN-MAINSCR
           PERFORM Form1-OPEN-ROUTINE.
      *{TOTEM}END

      *{TOTEM}COPY-PROCEDURE
       EXIT-STOP-ROUTINE.
           PERFORM CLOSE-FILE-RTN
      * <TOTEM:EPT. INIT:08listmov, INIT:08listmov, BeforeDestroyResource>
      * <TOTEM:END>
           DESTROY Verdana12-Occidentale
           DESTROY Verdana12BI-Occidentale
           CALL "w$bitmap" USING WBITMAP-DESTROY, BLUE-FINO-28X24-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, BLUE-DA-28X24-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, BOTTONE-OK-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, BOTTONE-CANCEL-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, toolbar-bmp
           CALL "w$bitmap" USING WBITMAP-DESTROY, TOOLBAR-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, BOTTONE-STAMPA-BMP
      *    After-Program
           PERFORM ginqui-Ev-After-Program
           EXIT PROGRAM TOTEM-PgmStatus
           STOP RUN.

       INITIALIZE-ROUTINE.
      *    Before Init
      * initialize program status variable
           Initialize TOTEM-PgmStatus.
      * get system information
           ACCEPT SYSTEM-INFORMATION FROM SYSTEM-INFO.
      * get terminal information
           ACCEPT TERMINAL-ABILITIES FROM TERMINAL-INFO.
      * set font
           PERFORM INIT-FONT.
      * load bitmap
           PERFORM INIT-BMP.
      * load resource
           PERFORM INIT-RES.
      * create pop-up menu
           PERFORM INIT-POPUP.
      * open files
           PERFORM OPEN-FILE-RTN.
      *    After Init
           .
    
       INIT-FONT.
      * Verdana12-Occidentale
           INITIALIZE WFONT-DATA Verdana12-Occidentale
           MOVE 12 TO WFONT-SIZE
           MOVE "Verdana" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO FALSE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Verdana12-Occidentale, WFONT-DATA
      * Verdana12BI-Occidentale
           INITIALIZE WFONT-DATA Verdana12BI-Occidentale
           MOVE 12 TO WFONT-SIZE
           MOVE "Verdana" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO TRUE
           SET WFONT-ITALIC TO TRUE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Verdana12BI-Occidentale, WFONT-DATA
           .

       INIT-BMP.
      * Bitmap-freccia-fino
           COPY RESOURCE "BLUE-FINO-28X24.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "BLUE-FINO-28X24.BMP", 
                   GIVING BLUE-FINO-28X24-BMP.
      * Bitmap-freccia-da
           COPY RESOURCE "BLUE-DA-28X24.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "BLUE-DA-28X24.BMP", 
                   GIVING BLUE-DA-28X24-BMP.
      * pb-ok
           COPY RESOURCE "BOTTONE-OK.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "BOTTONE-OK.BMP", 
                   GIVING BOTTONE-OK-BMP.
      * pb-annulla
           COPY RESOURCE "BOTTONE-CANCEL.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "BOTTONE-CANCEL.BMP", 
                   GIVING BOTTONE-CANCEL-BMP.
      * TOOL-ESCI
           COPY RESOURCE "toolbar.bmp".
           CALL "w$bitmap" USING WBITMAP-LOAD "toolbar.bmp", 
                   GIVING toolbar-bmp.
      * TOOL-CERCA
           COPY RESOURCE "TOOLBAR.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "TOOLBAR.BMP", 
                   GIVING TOOLBAR-BMP.
      * pb-stampa
           COPY RESOURCE "BOTTONE-STAMPA.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "BOTTONE-STAMPA.BMP", 
                   GIVING BOTTONE-STAMPA-BMP.
           .

       INIT-RES.
           .

       INIT-POPUP.
           .

       OPEN-FILE-RTN.
      *    Before Open
           PERFORM OPEN-tparamge
           PERFORM OPEN-anautf
      *    lineseq OPEN MODE IS FALSE
      *    PERFORM OPEN-lineseq
      *    After Open
           .

       OPEN-tparamge.
      * <TOTEM:EPT. INIT:08listmov, FD:tparamge, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tparamge
           IF NOT Valid-STATUS-tparamge
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:08listmov, FD:tparamge, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-anautf.
      * <TOTEM:EPT. INIT:08listmov, FD:anautf, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT anautf
           IF NOT Valid-STATUS-anautf
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:08listmov, FD:anautf, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-lineseq.
      * <TOTEM:EPT. INIT:08listmov, FD:lineseq, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT lineseq
           IF NOT Valid-STATUS-lineseq
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:08listmov, FD:lineseq, AfterOpen>
      * <TOTEM:END>
           .

       CLOSE-FILE-RTN.
      *    Before Close
           PERFORM CLOSE-tparamge
           PERFORM CLOSE-anautf
      *    lineseq CLOSE MODE IS FALSE
      *    PERFORM CLOSE-lineseq
      *    After Close
           .

       CLOSE-tparamge.
      * <TOTEM:EPT. INIT:08listmov, FD:tparamge, BeforeClose>
      * <TOTEM:END>
           CLOSE tparamge
           .

       CLOSE-anautf.
      * <TOTEM:EPT. INIT:08listmov, FD:anautf, BeforeClose>
      * <TOTEM:END>
           CLOSE anautf
           .

       CLOSE-lineseq.
      * <TOTEM:EPT. INIT:08listmov, FD:lineseq, BeforeClose>
      * <TOTEM:END>
           .

       DataSet1-tparamge-INITSTART.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tparamge-KEY1-Asc
                 MOVE Low-Value TO tge-chiave
              ELSE
                 MOVE High-Value TO tge-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tparamge-INITEND.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tparamge-KEY1-Asc
                 MOVE High-Value TO tge-chiave
              ELSE
                 MOVE Low-Value TO tge-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           .   

       DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-tparamge-KEY1-ORDER
           END-EVALUATE
           .

       DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-tparamge-KEY1-ORDER
           END-EVALUATE
           .

      * tparamge
       DataSet1-tparamge-START.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tparamge-KEY1-Asc
                 START tparamge KEY >= tge-chiave
              ELSE
                 START tparamge KEY <= tge-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tparamge-START-NOTGREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tparamge-KEY1-Asc
                 START tparamge KEY <= tge-chiave
              ELSE
                 START tparamge KEY >= tge-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tparamge-START-GREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tparamge-KEY1-Asc
                 START tparamge KEY > tge-chiave
              ELSE
                 START tparamge KEY < tge-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tparamge-START-LESS.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tparamge-KEY1-Asc
                 START tparamge KEY < tge-chiave
              ELSE
                 START tparamge KEY > tge-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tparamge-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeReadRecord>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tparamge-LOCK
                 READ tparamge WITH LOCK 
                 KEY tge-chiave
              ELSE
                 READ tparamge WITH NO LOCK 
                 KEY tge-chiave
              END-IF
           END-EVALUATE
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT 
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeReadNext>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tparamge-KEY1-Asc
                 IF DataSet1-tparamge-LOCK
                    READ tparamge NEXT WITH LOCK
                 ELSE
                    READ tparamge NEXT WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-tparamge-LOCK
                    READ tparamge PREVIOUS WITH LOCK
                 ELSE
                    READ tparamge PREVIOUS WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeReadPrev>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tparamge-KEY1-Asc
                 IF DataSet1-tparamge-LOCK
                    READ tparamge PREVIOUS WITH LOCK
                 ELSE
                    READ tparamge PREVIOUS WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-tparamge-LOCK
                    READ tparamge NEXT WITH LOCK
                 ELSE
                    READ tparamge NEXT WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-anautf-INITSTART.
           IF DataSet1-anautf-KEY-Asc
              MOVE Low-Value TO utf-chiave
           ELSE
              MOVE High-Value TO utf-chiave
           END-IF
           .

       DataSet1-anautf-INITEND.
           IF DataSet1-anautf-KEY-Asc
              MOVE High-Value TO utf-chiave
           ELSE
              MOVE Low-Value TO utf-chiave
           END-IF
           .

      * anautf
       DataSet1-anautf-START.
           IF DataSet1-anautf-KEY-Asc
              START anautf KEY >= utf-chiave
           ELSE
              START anautf KEY <= utf-chiave
           END-IF
           .

       DataSet1-anautf-START-NOTGREATER.
           IF DataSet1-anautf-KEY-Asc
              START anautf KEY <= utf-chiave
           ELSE
              START anautf KEY >= utf-chiave
           END-IF
           .

       DataSet1-anautf-START-GREATER.
           IF DataSet1-anautf-KEY-Asc
              START anautf KEY > utf-chiave
           ELSE
              START anautf KEY < utf-chiave
           END-IF
           .

       DataSet1-anautf-START-LESS.
           IF DataSet1-anautf-KEY-Asc
              START anautf KEY < utf-chiave
           ELSE
              START anautf KEY > utf-chiave
           END-IF
           .

       DataSet1-anautf-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:anautf, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:anautf, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-anautf-LOCK
              READ anautf WITH LOCK 
              KEY utf-chiave
           ELSE
              READ anautf WITH NO LOCK 
              KEY utf-chiave
           END-IF
           MOVE STATUS-anautf TO TOTEM-ERR-STAT 
           MOVE "anautf" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:anautf, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:anautf, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-anautf-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:anautf, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:anautf, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-anautf-KEY-Asc
              IF DataSet1-anautf-LOCK
                 READ anautf NEXT WITH LOCK
              ELSE
                 READ anautf NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-anautf-LOCK
                 READ anautf PREVIOUS WITH LOCK
              ELSE
                 READ anautf PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-anautf TO TOTEM-ERR-STAT
           MOVE "anautf" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:anautf, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:anautf, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-anautf-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:anautf, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:anautf, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-anautf-KEY-Asc
              IF DataSet1-anautf-LOCK
                 READ anautf PREVIOUS WITH LOCK
              ELSE
                 READ anautf PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-anautf-LOCK
                 READ anautf NEXT WITH LOCK
              ELSE
                 READ anautf NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-anautf TO TOTEM-ERR-STAT
           MOVE "anautf" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:anautf, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:anautf, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-anautf-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:anautf, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-anautf TO TOTEM-ERR-STAT
           MOVE "anautf" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:anautf, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-anautf-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:anautf, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-anautf TO TOTEM-ERR-STAT
           MOVE "anautf" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:anautf, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-anautf-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:anautf, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-anautf TO TOTEM-ERR-STAT
           MOVE "anautf" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:anautf, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-lineseq-INITSTART.
           .

       DataSet1-lineseq-INITEND.
           .

       DataSet1-lineseq-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-lineseq-LOCK
              READ lineseq WITH LOCK 
           ELSE
              READ lineseq WITH NO LOCK 
           END-IF
           MOVE STATUS-lineseq TO TOTEM-ERR-STAT 
           MOVE "lineseq" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-lineseq-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-lineseq-KEY-Asc
              IF DataSet1-lineseq-LOCK
                 READ lineseq NEXT WITH LOCK
              ELSE
                 READ lineseq NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-lineseq TO TOTEM-ERR-STAT
           MOVE "lineseq" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-lineseq-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeReadPrev>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-lineseq-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-lineseq TO TOTEM-ERR-STAT
           MOVE "lineseq" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-lineseq-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-lineseq TO TOTEM-ERR-STAT
           MOVE "lineseq" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-lineseq-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-lineseq TO TOTEM-ERR-STAT
           MOVE "lineseq" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-INIT-RECORD.
           INITIALIZE tge-rec OF tparamge
           INITIALIZE utf-rec OF anautf
           INITIALIZE line-riga OF lineseq
           .


      * GRID
       gd1-Content.
      * CELLS' SETTING
              MODIFY gd1, X = 1, Y = 1,
                CELL-DATA = "Giorno",
      * CELLS' SETTING
              MODIFY gd1, X = 2, Y = 1,
                CELL-DATA = "Entrate Kg.",
      * CELLS' SETTING
              MODIFY gd1, X = 3, Y = 1,
                CELL-DATA = "Uscite Kg.",
           .

      * GRID
       gd-tot-Content.
      * CELLS' SETTING
              MODIFY gd-tot, X = 1, Y = 1,
                CELL-DATA = "T O T A L E",
           .

      * GRID
       gd2-Content.
      * CELLS' SETTING
              MODIFY gd2, X = 1, Y = 1,
                CELL-DATA = "Giorno",
      * CELLS' SETTING
              MODIFY gd2, X = 2, Y = 1,
                CELL-DATA = "Entrate Kg.",
      * CELLS' SETTING
              MODIFY gd2, X = 3, Y = 1,
                CELL-DATA = "Uscite Kg.",
      * CELLS' SETTING
              MODIFY gd2, X = 4, Y = 1,
                CELL-DATA = "Giacenza",
           .

      * GRID
       gd-tot2-Content.
      * CELLS' SETTING
              MODIFY gd-tot2, X = 1, Y = 1,
                CELL-DATA = "T O T A L E",
           .

      * FD's Initialize Paragraph
       DataSet1-tparamge-INITREC.
           INITIALIZE tge-rec OF tparamge
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-anautf-INITREC.
           INITIALIZE utf-rec OF anautf
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-lineseq-INITREC.
           INITIALIZE line-riga OF lineseq
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      *
       DataSet1-DISPATCH-BUFTOFLD.
           .

       Form1-Open-Routine.
           PERFORM Form1-Scrn
           PERFORM Form1-Proc
           .

       Form1-Scrn.
           PERFORM Form1-Create-Win
           PERFORM Form1-Init-Value
           PERFORM Form1-Init-Data
      * Tab keystrok settings
      * Tool Bar
           DISPLAY Form1-Tb-1a
           PERFORM Form1-DISPLAY
           .

       Form1-Create-Win.
           Display Independent GRAPHICAL WINDOW
              LINES 13,00,
              SIZE 45,90,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 65793,
              CONTROL FONT Verdana12-Occidentale,
              LABEL-OFFSET 23,
              LINK TO THREAD,
              NO SCROLL,
              TITLE-BAR,
              TITLE TITOLO,
              AUTO-MINIMIZE,
              WITH SYSTEM MENU,
              USER-GRAY,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE Screen4-Event-Proc,
              HANDLE IS form1-Handle,
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
           DISPLAY TOOL-BAR 
              LINES 2,67,   
              HANDLE IN Form1-Tb-1-Handlea
           DISPLAY Form1-Tb-1a UPON Form1-Tb-1-Handlea

      * Status-bar
           DISPLAY Form1 UPON form1-Handle
      * DISPLAY-COLUMNS settings
           .

       Form1-PROC.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeAccept>
           accept data-oggi from century-date.
           move spaces to tge-codice.
           read tparamge no lock invalid continue end-read.

           if tge-anno = data-oggi(1:4)
              move data-oggi(5:2) to mese
           else
              move 12 to mese
           end-if

           string "01"     delimited size
                  mese     delimited size
                  tge-anno delimited size
                  into como-data
           end-string.

           move como-data to ef-data-from-buf.

           move tge-anno to anno.

           perform ULTIMO-GIORNO-DEL-MESE.

           string giorno   delimited size
                  mese     delimited size
                  tge-anno delimited size
                  into como-data
           end-string.

           move como-data to ef-data-to-buf.

           display ef-data-from ef-data-to.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT Form1
                 ON EXCEPTION
                    PERFORM Form1-Evaluate-Func
                 MOVE 1 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY form1-Handle
           INITIALIZE Key-Status
           .

       Form1-Evaluate-Func.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM Form1-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM Form1-Exit
                 END-IF
              WHEN Key-Status = 1001
                 PERFORM chk-data-LinkTo
              WHEN Key-Status = 1000
                 PERFORM pb-ok-LinkTo
              WHEN Key-Status = 8
                 PERFORM TOOL-CERCA-LinkTo
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       Form1-CLEAR.
           PERFORM Form1-INIT-VALUE
           PERFORM Form1-DISPLAY
           .

       Form1-DISPLAY.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY Form1-Tb-1a
           DISPLAY Form1 UPON form1-Handle
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterDisplay>
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       Form1-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeExit>
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       Form1-Init-Data.
           MOVE 1 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
           .

       Form1-Init-Value.
           MOVE TITOLO TO TOTEM-MSG-TITLE
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, SetDefault>
      * <TOTEM:END>
           PERFORM Form1-FLD-TO-BUF
           .


       Form1-ALLGRID-RESET.
           .

      * for Form's Validation
       Form1-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       Form1-Buf-To-Fld.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterBufToFld>
      * <TOTEM:END>
           .

       Form1-Fld-To-Buf.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeFldToBuf>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterFldToBuf>
      * <TOTEM:END>
           .

       Form1-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform Form1-BUF-TO-FLD.
           move 0 to scelta.
           .
       Form1-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM Form1-SHOW-MSG-ROUTINE
           .

       Form1-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM Form1-DISPLAY-MESSAGE
           .

       Form1-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       Form1-Save-Status.
           .             

       Form1-Restore-Status.
           .


      * Paragrafo per la struttura del codice in AFTER sulla screen Form1
      ***---
       Form1-AFTER-SCREEN.

      * Generazione risettaggio keyboard "." ---> "."

      * Generazione stringa perform CONTROLLO
           evaluate control-id
           |78-ID-ef-data-from è l'ID del campo ef-data-from
           when 78-ID-ef-data-from
                perform CONTROLLO
           |78-ID-ef-data-to è l'ID del campo ef-data-to
           when 78-ID-ef-data-to
                perform CONTROLLO
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER CONTROLLO della screen
           when 99999 continue
           when other continue
           end-evaluate.

       screen1-Open-Routine.
           PERFORM screen1-Scrn
           PERFORM screen1-Proc
           .

       screen1-Scrn.
           PERFORM screen1-Create-Win
           PERFORM screen1-Init-Value
           PERFORM screen1-Init-Data
      * Tab keystrok settings
      * Tool Bar
           PERFORM screen1-DISPLAY
           .

       screen1-Create-Win.
           Display Independent GRAPHICAL WINDOW
              LINES 2,39,
              SIZE 38,00,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 65793,
              CONTROL FONT Verdana12BI-Occidentale,
              LINK TO THREAD,
              NO SCROLL,
              USER-GRAY,
           VISIBLE v-screen1,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE Screen1-Event-Proc,
              HANDLE IS scr-calprovv-handle,
      * <TOTEM:EPT. FORM:screen1, FORM:screen1, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
      * Status-bar
           DISPLAY screen1 UPON scr-calprovv-handle
      * DISPLAY-COLUMNS settings
           .

       screen1-PROC.
      * <TOTEM:EPT. FORM:screen1, FORM:screen1, BeforeAccept>
           move 0 to tot-entrate tot-uscite.
           move listmov-path to wstampa.
           open input lineseq.
           perform 7 times
              read lineseq next
           end-perform.

           if listmov-data-from-anautf
              modify gd2, reset-grid = 1
              perform GD2-CONTENT
           else
              modify gd1, reset-grid = 1
              perform GD1-CONTENT
           end-if.

           move 1 to riga.
           perform until 1 = 2
              add 1 to riga
              initialize line-riga
              read lineseq next at end exit perform end-read
              if line-riga = spaces    exit perform end-if
              move line-riga(1:8)   to col-data
              move line-riga(11:20) to col-entrate
              move line-riga(34:20) to col-uscite 
              if listmov-data-from-anautf
                 move line-riga(57:20) to col-giacenza
                 modify gd2,(riga, 1), cell-data = col-data
                 modify gd2,(riga, 2), cell-data = col-entrate
                 modify gd2,(riga, 3), cell-data = col-uscite
                 modify gd2,(riga, 4), cell-data = col-giacenza
              else
                 modify gd1,(riga, 1), cell-data = col-data
                 modify gd1,(riga, 2), cell-data = col-entrate
                 modify gd1,(riga, 3), cell-data = col-uscite
              end-if
           end-perform.
           close lineseq.

           if listmov-data-from-anautf
              inquire gd2, last-row in tot-righe
              perform varying riga from 2 by 1 until riga > tot-righe
                 inquire gd2(riga, 2), cell-data in como-entrate
                 inquire gd2(riga, 3), cell-data in como-uscite
                 add como-entrate  to tot-entrate
                 add como-uscite   to tot-uscite
              end-perform
              modify gd-tot2, reset-grid = 1
              perform GD-TOT2-CONTENT
              move tot-entrate to entrate-z
              move tot-uscite  to uscite-z
              move link-finale to giacenza-z
              modify gd-tot2(1, 2), cell-data = entrate-z
              modify gd-tot2(1, 3), cell-data = uscite-z
              modify gd-tot2(1, 4), cell-data = giacenza-z
              modify gd-tot2(1),     row-font = Verdana12BI-Occidentale
           else
              inquire gd1, last-row in tot-righe
              perform varying riga from 2 by 1 until riga > tot-righe
                 inquire gd1(riga, 2), cell-data in como-entrate
                 inquire gd1(riga, 3), cell-data in como-uscite
                 add como-entrate to tot-entrate
                 add como-uscite  to tot-uscite
              end-perform
              modify gd-tot, reset-grid = 1
              perform GD-TOT-CONTENT
              move tot-entrate to entrate-z
              move tot-uscite  to uscite-z
              modify gd-tot(1, 2), cell-data = entrate-z
              modify gd-tot(1, 3), cell-data = uscite-z
              modify gd-tot(1),     row-font = Verdana12BI-Occidentale
           end-if.

           move 27 to key-status.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT OMITTED LINE 1 COL 1
                 ON EXCEPTION
                    PERFORM screen1-Evaluate-Func
                 MOVE 2 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:screen1, FORM:screen1, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:screen1, FORM:screen1, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY scr-calprovv-handle
           INITIALIZE Key-Status
           .

       screen1-Evaluate-Func.
      * <TOTEM:EPT. FORM:screen1, FORM:screen1, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM screen1-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM screen1-Exit
                 END-IF
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       screen1-CLEAR.
           PERFORM screen1-INIT-VALUE
           PERFORM screen1-DISPLAY
           .

       screen1-DISPLAY.
      * <TOTEM:EPT. FORM:screen1, FORM:screen1, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY screen1 UPON scr-calprovv-handle
      * <TOTEM:EPT. FORM:screen1, FORM:screen1, AfterDisplay>
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       screen1-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:screen1, FORM:screen1, BeforeExit>
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       screen1-Init-Data.
           MOVE 2 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
           .

       screen1-Init-Value.
      * <TOTEM:EPT. FORM:screen1, FORM:screen1, SetDefault>
      * <TOTEM:END>
           PERFORM screen1-FLD-TO-BUF
           .


       screen1-ALLGRID-RESET.
           .

      * for Form's Validation
       screen1-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       screen1-Buf-To-Fld.
      * <TOTEM:EPT. FORM:screen1, FORM:screen1, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:screen1, FORM:screen1, AfterBufToFld>
      * <TOTEM:END>
           .

       screen1-Fld-To-Buf.
      * <TOTEM:EPT. FORM:screen1, FORM:screen1, BeforeFldToBuf>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:screen1, FORM:screen1, AfterFldToBuf>
      * <TOTEM:END>
           .

       screen1-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform screen1-BUF-TO-FLD.
           move 0 to scelta.
           .
       screen1-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM screen1-SHOW-MSG-ROUTINE
           .

       screen1-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM screen1-DISPLAY-MESSAGE
           .

       screen1-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       screen1-Save-Status.
           .             

       screen1-Restore-Status.
           .


      * Paragrafo per la struttura del codice in AFTER sulla screen screen1
      ***---
       screen1-AFTER-SCREEN.

      * Generazione risettaggio keyboard "." ---> "."

      * Generazione stringa perform CONTROLLO
           evaluate control-id
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER CONTROLLO della screen
           when 99999 continue
           when other continue
           end-evaluate.

       scr-visua-Open-Routine.
           PERFORM scr-visua-Scrn
           PERFORM scr-visua-Proc
           .

       scr-visua-Scrn.
           PERFORM scr-visua-Create-Win
           PERFORM scr-visua-Init-Value
           PERFORM scr-visua-Init-Data
      * Tab keystrok settings
      * Tool Bar
           PERFORM scr-visua-DISPLAY
           .

       scr-visua-Create-Win.
           Display Independent GRAPHICAL WINDOW
              LINES 35,83,
              SIZE 64,30,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 65793,
              CONTROL FONT Verdana12-Occidentale,
              LINK TO THREAD,
              MODELESS,
              NO SCROLL,
              TITLE-BAR,
              TITLE "                                                   
      -    "    .:: MOVIMENTAZIONE UTF ::.",
              AUTO-MINIMIZE,
              WITH SYSTEM MENU,
              USER-GRAY,
           VISIBLE 0,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE Screen1-Event-Proc,
              HANDLE IS scr-visua-handle,
      * <TOTEM:EPT. FORM:scr-visua, FORM:scr-visua, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
      * Status-bar
           DISPLAY scr-visua UPON scr-visua-handle
      * DISPLAY-COLUMNS settings
              MODIFY gd1, DISPLAY-COLUMNS (1, 21, 41)
              MODIFY gd-tot, DISPLAY-COLUMNS (1, 21, 41)
           .

       scr-visua-PROC.
      * <TOTEM:EPT. FORM:scr-visua, FORM:scr-visua, BeforeAccept>
           perform SCREEN1-OPEN-ROUTINE.
           modify scr-visua-handle, visible true.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT scr-visua
                 ON EXCEPTION
                    PERFORM scr-visua-Evaluate-Func
                 MOVE 3 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:scr-visua, FORM:scr-visua, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:scr-visua, FORM:scr-visua, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY scr-visua-handle
           INITIALIZE Key-Status
           .

       scr-visua-Evaluate-Func.
      * <TOTEM:EPT. FORM:scr-visua, FORM:scr-visua, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM scr-visua-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM scr-visua-Exit
                 END-IF
              WHEN Key-Status = 1000
                 PERFORM pb-stampa-LinkTo
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       scr-visua-CLEAR.
           PERFORM scr-visua-INIT-VALUE
           PERFORM scr-visua-DISPLAY
           .

       scr-visua-DISPLAY.
      * <TOTEM:EPT. FORM:scr-visua, FORM:scr-visua, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY scr-visua UPON scr-visua-handle
      * <TOTEM:EPT. FORM:scr-visua, FORM:scr-visua, AfterDisplay>
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       scr-visua-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:scr-visua, FORM:scr-visua, BeforeExit>
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       scr-visua-Init-Data.
           MOVE 3 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
      * GRID
           PERFORM gd1-Content
      * GRID
           PERFORM gd-tot-Content
           .

       scr-visua-Init-Value.
      * <TOTEM:EPT. FORM:scr-visua, FORM:scr-visua, SetDefault>
      * <TOTEM:END>
           PERFORM scr-visua-FLD-TO-BUF
           .


       scr-visua-ALLGRID-RESET.
           .

      * for Form's Validation
       scr-visua-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       scr-visua-Buf-To-Fld.
      * <TOTEM:EPT. FORM:scr-visua, FORM:scr-visua, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:scr-visua, FORM:scr-visua, AfterBufToFld>
      * <TOTEM:END>
           .

       scr-visua-Fld-To-Buf.
      * <TOTEM:EPT. FORM:scr-visua, FORM:scr-visua, BeforeFldToBuf>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:scr-visua, FORM:scr-visua, AfterFldToBuf>
      * <TOTEM:END>
           .

       scr-visua-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform scr-visua-BUF-TO-FLD.
           move 0 to scelta.
           .
       scr-visua-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM scr-visua-SHOW-MSG-ROUTINE
           .

       scr-visua-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM scr-visua-DISPLAY-MESSAGE
           .

       scr-visua-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       scr-visua-Save-Status.
           .             

       scr-visua-Restore-Status.
           .


      * Paragrafo per la struttura del codice in AFTER sulla screen scr-visua
      ***---
       scr-visua-AFTER-SCREEN.

      * Generazione risettaggio keyboard "." ---> "."

      * Generazione stringa perform CONTROLLO
           evaluate control-id
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER CONTROLLO della screen
           when 99999 continue
           when other continue
           end-evaluate.

       scr-visua2-Open-Routine.
           PERFORM scr-visua2-Scrn
           PERFORM scr-visua2-Proc
           .

       scr-visua2-Scrn.
           PERFORM scr-visua2-Create-Win
           PERFORM scr-visua2-Init-Value
           PERFORM scr-visua2-Init-Data
      * Tab keystrok settings
      * Tool Bar
           PERFORM scr-visua2-DISPLAY
           .

       scr-visua2-Create-Win.
           Display Independent GRAPHICAL WINDOW
              LINES 35,83,
              SIZE 82,60,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 65793,
              CONTROL FONT Verdana12-Occidentale,
              LINK TO THREAD,
              MODELESS,
              NO SCROLL,
              TITLE-BAR,
              TITLE "                                                   
      -    "                           .:: MOVIMENTAZIONE UTF ::.",
              AUTO-MINIMIZE,
              WITH SYSTEM MENU,
              USER-GRAY,
           VISIBLE 0,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE Screen1-Event-Proc,
              HANDLE IS scr-visua2-handle,
      * <TOTEM:EPT. FORM:scr-visua2, FORM:scr-visua2, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
      * Status-bar
           DISPLAY scr-visua2 UPON scr-visua2-handle
      * DISPLAY-COLUMNS settings
              MODIFY gd2, DISPLAY-COLUMNS (1, 21, 41, 61)
              MODIFY gd-tot2, DISPLAY-COLUMNS (1, 21, 41, 61)
           .

       scr-visua2-PROC.
      * <TOTEM:EPT. FORM:scr-visua2, FORM:scr-visua2, BeforeAccept>
           perform SCREEN1-OPEN-ROUTINE.
           modify scr-visua2-handle, visible true.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT scr-visua2
                 ON EXCEPTION
                    PERFORM scr-visua2-Evaluate-Func
                 MOVE 4 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:scr-visua2, FORM:scr-visua2, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:scr-visua2, FORM:scr-visua2, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY scr-visua2-handle
           INITIALIZE Key-Status
           .

       scr-visua2-Evaluate-Func.
      * <TOTEM:EPT. FORM:scr-visua2, FORM:scr-visua2, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM scr-visua2-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM scr-visua2-Exit
                 END-IF
              WHEN Key-Status = 1000
                 PERFORM pb-stampa-LinkTo
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       scr-visua2-CLEAR.
           PERFORM scr-visua2-INIT-VALUE
           PERFORM scr-visua2-DISPLAY
           .

       scr-visua2-DISPLAY.
      * <TOTEM:EPT. FORM:scr-visua2, FORM:scr-visua2, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY scr-visua2 UPON scr-visua2-handle
      * <TOTEM:EPT. FORM:scr-visua2, FORM:scr-visua2, AfterDisplay>
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       scr-visua2-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:scr-visua2, FORM:scr-visua2, BeforeExit>
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       scr-visua2-Init-Data.
           MOVE 4 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
      * GRID
           PERFORM gd2-Content
      * GRID
           PERFORM gd-tot2-Content
           .

       scr-visua2-Init-Value.
      * <TOTEM:EPT. FORM:scr-visua2, FORM:scr-visua2, SetDefault>
      * <TOTEM:END>
           PERFORM scr-visua2-FLD-TO-BUF
           .


       scr-visua2-ALLGRID-RESET.
           .

      * for Form's Validation
       scr-visua2-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       scr-visua2-Buf-To-Fld.
      * <TOTEM:EPT. FORM:scr-visua2, FORM:scr-visua2, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:scr-visua2, FORM:scr-visua2, AfterBufToFld>
      * <TOTEM:END>
           .

       scr-visua2-Fld-To-Buf.
      * <TOTEM:EPT. FORM:scr-visua2, FORM:scr-visua2, BeforeFldToBuf>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:scr-visua2, FORM:scr-visua2, AfterFldToBuf>
      * <TOTEM:END>
           .

       scr-visua2-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform scr-visua2-BUF-TO-FLD.
           move 0 to scelta.
           .
       scr-visua2-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM scr-visua2-SHOW-MSG-ROUTINE
           .

       scr-visua2-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM scr-visua2-DISPLAY-MESSAGE
           .

       scr-visua2-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       scr-visua2-Save-Status.
           .             

       scr-visua2-Restore-Status.
           .


      * Paragrafo per la struttura del codice in AFTER sulla screen scr-visua2
      ***---
       scr-visua2-AFTER-SCREEN.

      * Generazione risettaggio keyboard "." ---> "."

      * Generazione stringa perform CONTROLLO
           evaluate control-id
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER CONTROLLO della screen
           when 99999 continue
           when other continue
           end-evaluate.



       Form1-BeforeProcedure.
           EVALUATE Control-Id
           WHEN 5002 MOVE "." to TOTEM-HINT-TEXT
           WHEN OTHER MOVE SPACES TO TOTEM-HINT-TEXT
           END-EVALUATE
           EVALUATE Control-Id
           When 5002 PERFORM Screen4-Cb-1-BeforeProcedure
           END-EVALUATE
           .

       Screen4-Event-Proc.
           .

       Screen1-Event-Proc.
           .

       gd-mov-Event-Proc.
           EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
           WHEN Msg-Begin-Drag ALSO 5 ALSO
                    scr-visua-handle 
              PERFORM gd-mov-Ev-Msg-Begin-Drag
           WHEN Msg-End-Drag ALSO 5 ALSO
                    scr-visua-handle 
              PERFORM gd-mov-Ev-Msg-End-Drag
           WHEN Msg-Goto-Cell ALSO 5 ALSO
                    scr-visua-handle 
              PERFORM gd-mov-Ev-Msg-Goto-Cell
           WHEN Msg-Goto-Cell-Drag ALSO 5 ALSO
                    scr-visua-handle 
              PERFORM gd-mov-Ev-Msg-Goto-Cell-Drag
           WHEN Msg-Goto-Cell-Mouse ALSO 5 ALSO
                    scr-visua-handle 
              PERFORM gd-mov-Ev-Msg-Goto-Cell-Mouse
           WHEN Msg-Begin-Drag ALSO 6 ALSO
                    scr-visua-handle 
              PERFORM gd-mov-Ev-Msg-Begin-Drag
           WHEN Msg-Begin-Entry ALSO 6 ALSO
                    scr-visua-handle 
              PERFORM gd-mov-Ev-Msg-Begin-Entry
           WHEN Msg-End-Drag ALSO 6 ALSO
                    scr-visua-handle 
              PERFORM gd-mov-Ev-Msg-End-Drag
           WHEN Msg-Goto-Cell ALSO 6 ALSO
                    scr-visua-handle 
              PERFORM gd-mov-Ev-Msg-Goto-Cell
           WHEN Msg-Goto-Cell-Drag ALSO 6 ALSO
                    scr-visua-handle 
              PERFORM gd-mov-Ev-Msg-Goto-Cell-Drag
           WHEN Msg-Goto-Cell-Mouse ALSO 6 ALSO
                    scr-visua-handle 
              PERFORM gd-mov-Ev-Msg-Goto-Cell-Mouse
           WHEN Msg-Begin-Drag ALSO 5 ALSO
                    scr-visua2-handle 
              PERFORM gd2-Ev-Msg-Begin-Drag
           WHEN Msg-End-Drag ALSO 5 ALSO
                    scr-visua2-handle 
              PERFORM gd2-Ev-Msg-End-Drag
           WHEN Msg-Goto-Cell ALSO 5 ALSO
                    scr-visua2-handle 
              PERFORM gd2-Ev-Msg-Goto-Cell
           WHEN Msg-Goto-Cell-Drag ALSO 5 ALSO
                    scr-visua2-handle 
              PERFORM gd2-Ev-Msg-Goto-Cell-Drag
           WHEN Msg-Goto-Cell-Mouse ALSO 5 ALSO
                    scr-visua2-handle 
              PERFORM gd2-Ev-Msg-Goto-Cell-Mouse
           WHEN Msg-Begin-Drag ALSO 6 ALSO
                    scr-visua2-handle 
              PERFORM gd-mov-Ev-Msg-Begin-Drag
           WHEN Msg-Begin-Entry ALSO 6 ALSO
                    scr-visua2-handle 
              PERFORM gd-mov-Ev-Msg-Begin-Entry
           WHEN Msg-End-Drag ALSO 6 ALSO
                    scr-visua2-handle 
              PERFORM gd-mov-Ev-Msg-End-Drag
           WHEN Msg-Goto-Cell ALSO 6 ALSO
                    scr-visua2-handle 
              PERFORM gd-mov-Ev-Msg-Goto-Cell
           WHEN Msg-Goto-Cell-Drag ALSO 6 ALSO
                    scr-visua2-handle 
              PERFORM gd-mov-Ev-Msg-Goto-Cell-Drag
           WHEN Msg-Goto-Cell-Mouse ALSO 6 ALSO
                    scr-visua2-handle 
              PERFORM gd-mov-Ev-Msg-Goto-Cell-Mouse
           END-EVALUATE
           .

      * USER DEFINE PARAGRAPH
       CERCA.
      * <TOTEM:PARA. CERCA>
           evaluate control-id
           when 78-ID-ef-num-reg
                move tge-anno             to utf-anno
                inquire ef-num-reg, value in utf-num-reg

                move "anautf-anno"  to como-file
                call "zoom-gt"   using como-file, utf-rec
                                giving stato-zoom
                cancel "zoom-gt"
      
                if stato-zoom = 0
                   move utf-num-reg to ef-num-reg-buf
                   move utf-desc1   to lab-reg-buf
                   display ef-num-reg lab-reg
                end-if
           end-evaluate
           .
      * <TOTEM:END>

       CONTROLLO.
      * <TOTEM:PARA. CONTROLLO>
           set tutto-ok to true.

           evaluate CONTROL-ID
           when 78-ID-ef-data-from                          
                inquire ef-data-from, value in ef-data-from-buf
                move ef-data-from-buf to como-data
                if como-data not = 0
                   perform DATE-FORMAT
                   move como-data to ef-data-from-buf
                else
                   inquire ef-num-reg, value in ef-num-reg-buf
                   move ef-num-reg-buf to utf-num-reg
                   move tge-anno       to utf-anno
                   string "01"   delimited size
                          mese   delimited size
                          anno   delimited size
                          into como-data
                   end-string
                   move como-data to ef-data-from-buf
                end-if
                display ef-data-from
      *
           when 78-ID-ef-data-to
                inquire ef-data-from, value in ef-data-from-buf
                inquire ef-data-to,   value in ef-data-to-buf
                move ef-data-to-buf to como-data
                if como-data not = 0
                   perform DATE-FORMAT
                   move como-data to ef-data-to-buf
                else
                   move ef-data-from-buf    to como-data-from
                   move como-data-from(3:2) to mese
                   move como-data-from(5:4) to anno
                   perform ULTIMO-GIORNO-DEL-MESE
                   string giorno delimited size
                          mese   delimited size
                          anno   delimited size
                          into como-data
                   end-string
                end-if

                move como-data to ef-data-to-buf
                display ef-data-to

                perform DATE-TO-FILE
                move como-data        to como-data-to

                move ef-data-from-buf to como-data
                perform DATE-TO-FILE
                move como-data    to como-data-from

                if como-data-to < como-data-from
                   set errori to true
                   display message box "Intervallo limiti data errato!"
                           title = tit-err
                           icon 2
                   move 78-ID-ef-data-from to control-id
                else
                   if como-data-to(1:4) not = como-data-from(1:4)
                      set errori to true
                      display message "L'anno delle date NON coincide!"
                                title tit-err
                                 icon 2
                      move 78-ID-ef-data-from to control-id
                   else
                      if como-data-to(5:2) not = como-data-from(5:2)
                         set errori to true
                         display message "Il meseo delle date NON coinci
      -    "de!"
                                   title tit-err
                                    icon 2
                         move 78-ID-ef-data-from to control-id
                      end-if
                   end-if
                end-if
      *
           when 78-ID-ef-num-reg
                inquire ef-num-reg, value in ef-num-reg-buf
                move ef-num-reg-buf to utf-num-reg
                move tge-anno       to utf-anno
                read anautf no lock
                     invalid
                     move spaces to lab-reg-buf
                     set errori to true
                     display message "Num. registro NON valido"
                               title tit-err
                                icon 2
                     move 78-ID-ef-num-reg to control-id
                 not invalid
                     move utf-desc1 to lab-reg-buf
                end-read
                display lab-reg
      *
           end-evaluate.

           if errori
              perform CANCELLA-COLORE
              move CONTROL-ID to STORE-ID        
              move 4          to ACCEPT-CONTROL  
           end-if 
           .
      * <TOTEM:END>

       PARAGRAFO-COPY.
      * <TOTEM:PARA. PARAGRAFO-COPY>
           copy "color-custom.cpy".
           copy "utydata.cpy".
           copy "calcola-colore-trasparente.cpy".

      ***--- DUMMY ---> NON TOCCARE!!!!
       STATUS-HELP.
           continue.

      *****     move    intfat-path             to splcrt2graf-percorso-stampa
      *****     set     splcrt2graf-stampa      to true.
      *****     set     splcrt2graf-windows     to true.
      *****     set     splcrt2graf-orizzontale to true.
      *****     set     splcrt2graf-forza-crt   to true.
      *****     set     splcrt2graf-10pt        to true.
      *****     call   "splcrt2graf"   using splcrt2graf-link.
      *****     cancel "splcrt2graf" 
           .
      * <TOTEM:END>

       SPOSTAMENTO.
      * <TOTEM:PARA. SPOSTAMENTO>
           if event-data-2 < 2 
              move 2 to event-data-2 
           end-if.

           if event-data-2 > tot-righe 
              move tot-righe to event-data-2 
           end-if.

           modify gd1, y = event-data-2, start-y = event-data-2
                       x = 3,            start-x = 1,
                       region-color = 80 
           .
      * <TOTEM:END>

       SPOSTAMENTO2.
      * <TOTEM:PARA. SPOSTAMENTO2>
           if event-data-2 < 2 
              move 2 to event-data-2 
           end-if.

           if event-data-2 > tot-righe 
              move tot-righe to event-data-2 
           end-if.

           modify gd2, y = event-data-2, start-y = event-data-2
                       x = 4,            start-x = 1,
                       region-color = 80 
           .
      * <TOTEM:END>

       ULTIMO-GIORNO-DEL-MESE.
      * <TOTEM:PARA. ULTIMO-GIORNO-DEL-MESE>
           evaluate mese
           when 02 
                divide        anno by 4 giving como-anno
                multiply como-anno by 4 giving anno
                if anno = como-anno
                   move 29 to giorno
                else
                   move 28 to giorno
                end-if

           when 01
           when 03
           when 05
           when 07
           when 08
           when 10
           when 12 move 31 to giorno
           
           when 11
           when 04
           when 06
           when 09 move 30 to giorno

           end-evaluate 
           .
      * <TOTEM:END>

      * EVENT PARAGRAPH
       ginqui-Ev-Before-Program.
      * <TOTEM:PARA. ginqui-Ev-Before-Program>
           move LK-BL-PROG-ID    TO COMO-PROG-ID.
           perform CALCOLA-COLORE-TRASPARENTE.
           move LK-BL-PROG-ID    TO COMO-PROG-ID 
           .
      * <TOTEM:END>
       ginqui-Ev-After-Program.
      * <TOTEM:PARA. ginqui-Ev-After-Program>
           SET LK-BL-CANCELLAZIONE TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           SET LK-BL-CANCELLAZIONE TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM 
           .
      * <TOTEM:END>
       ef-data-from-BeforeProcedure.
      * <TOTEM:PARA. ef-data-from-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-data-to-BeforeProcedure.
      * <TOTEM:PARA. ef-data-to-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-data-from-AfterProcedure.
      * <TOTEM:PARA. ef-data-from-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO 
           .
      * <TOTEM:END>
       ef-data-to-AfterProcedure.
      * <TOTEM:PARA. ef-data-to-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO 
           .
      * <TOTEM:END>
       pb-ok-BeforeProcedure.
      * <TOTEM:PARA. pb-ok-BeforeProcedure>
           modify pb-ok, bitmap-number 2 
           .
      * <TOTEM:END>
       pb-ok-AfterProcedure.
      * <TOTEM:PARA. pb-ok-AfterProcedure>
           modify pb-ok, bitmap-number 1 
           .
      * <TOTEM:END>
       pb-ok-LinkTo.
      * <TOTEM:PARA. pb-ok-LinkTo>
           move CONTROL-ID to mem-id.

           perform  varying CONTROL-ID from 78-ID-ef-data-from by 1
                      until CONTROL-ID > 78-ID-ef-num-reg
              perform CONTROLLO
              if errori exit perform end-if
           end-perform.

           if tutto-ok
              modify form1-Handle, visible 0
              initialize listmov-linkage
              if ultima-data = 1 set listmov-data-from-anautf to true
              else               set listmov-data-from-accept to true
              end-if
              move como-data-to     to listmov-data-to
              move como-data-from   to listmov-data-from
              move ef-num-reg-buf   to listmov-num-reg
              call   "08listmov-p" using listmov-linkage
              cancel "08listmov-p"
              
              initialize file-info

              call "C$FILEINFO" using listmov-path, file-info

              if file-size not = 0
                 if listmov-data-from-anautf
                    perform SCR-VISUA2-OPEN-ROUTINE
                 else
                    perform SCR-VISUA-OPEN-ROUTINE
                 end-if
              end-if

              call "C$DELETE" using listmov-path, "S"

              modify form1-Handle, visible = 1
              modify pb-ok,  bitmap-number = 1
              move 78-ID-ef-data-from   to CONTROL-ID     
              move 4                    to ACCEPT-CONTROL 
           end-if 
           .
      * <TOTEM:END>
       pb-annulla-BeforeProcedure.
      * <TOTEM:PARA. pb-annulla-BeforeProcedure>
           modify pb-annulla, bitmap-number 2 
           .
      * <TOTEM:END>
       pb-annulla-AfterProcedure.
      * <TOTEM:PARA. pb-annulla-AfterProcedure>
           modify pb-annulla, bitmap-number 1 
           .
      * <TOTEM:END>
       ef-num-reg-BeforeProcedure.
      * <TOTEM:PARA. ef-num-reg-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           move 1 to e-cerca.
           modify tool-cerca, enabled e-cerca 
           .
      * <TOTEM:END>
       ef-num-reg-AfterProcedure.
      * <TOTEM:PARA. ef-num-reg-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           move 0 to e-cerca.           
           modify tool-cerca, enabled e-cerca.
           perform CONTROLLO   
           .
      * <TOTEM:END>
       TOOL-CERCA-LinkTo.
      * <TOTEM:PARA. TOOL-CERCA-LinkTo>
           inquire tool-cerca, enabled in e-cerca.
           if e-cerca = 1
              perform CERCA
           end-if 
           .
      * <TOTEM:END>
       Screen4-Cb-1-BeforeProcedure.
      * <TOTEM:PARA. Screen4-Cb-1-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       Screen4-Cb-1-AfterProcedure.
      * <TOTEM:PARA. Screen4-Cb-1-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       chk-data-LinkTo.
      * <TOTEM:PARA. chk-data-LinkTo>
           inquire chk-data, value in ultima-data.
           if ultima-data = 1
              inquire ef-num-reg, value in utf-num-reg
              if utf-num-reg = 0
                 display message "Occorre indicare il numero di registro
      -    ""
                           title tit-err
                            icon 2
                 move 0 to ultima-data
              else
                 move 0 to como-data
                 move tge-anno to utf-anno
                 read anautf no lock
                      invalid continue
                  not invalid
                      move utf-data-ult-stampa to como-data
                      perform DATE-TO-SCREEN
                      move como-data to ef-data-from-buf
                 end-read
                 if como-data = 0
                    move 1 to e-data
                    move 0 to ultima-data
                 else
                    move 1 to ultima-data
                    move 0 to e-data
                 end-if
              end-if
           else
              move 1 to e-data
           end-if.

           display ef-data-from.
           modify chk-data, value ultima-data 
           .
      * <TOTEM:END>
       pb-stampa-BeforeProcedure.
      * <TOTEM:PARA. pb-stampa-BeforeProcedure>
           modify pb-stampa, bitmap-number = 2 
           .
      * <TOTEM:END>
       pb-stampa-AfterProcedure.
      * <TOTEM:PARA. pb-stampa-AfterProcedure>
           modify pb-stampa, bitmap-number = 2 
           .
      * <TOTEM:END>
       pb-stampa-LinkTo.
      * <TOTEM:PARA. pb-stampa-LinkTo>
           move    listmov-path          to splcrt2graf-percorso-stampa.
           set     splcrt2graf-stampa    to true.
           set     splcrt2graf-windows   to true.
           set     splcrt2graf-verticale to true.
           set     splcrt2graf-forza-crt to true.
           set     splcrt2graf-10pt      to true.
           call   "splcrt2graf"   using splcrt2graf-link.
           cancel "splcrt2graf" 
           .
      * <TOTEM:END>
       gd-mov-Ev-Msg-Begin-Drag.
      * <TOTEM:PARA. gd-mov-Ev-Msg-Begin-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd-mov-Ev-Msg-Begin-Entry.
      * <TOTEM:PARA. gd-mov-Ev-Msg-Begin-Entry>
           .
      * <TOTEM:END>
       gd-mov-Ev-Msg-End-Drag.
      * <TOTEM:PARA. gd-mov-Ev-Msg-End-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd-mov-Ev-Msg-Goto-Cell.
      * <TOTEM:PARA. gd-mov-Ev-Msg-Goto-Cell>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd-mov-Ev-Msg-Goto-Cell-Drag.
      * <TOTEM:PARA. gd-mov-Ev-Msg-Goto-Cell-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd-mov-Ev-Msg-Goto-Cell-Mouse.
      * <TOTEM:PARA. gd-mov-Ev-Msg-Goto-Cell-Mouse>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd-mov-BeforeProcedure.
      * <TOTEM:PARA. gd-mov-BeforeProcedure>
           .
      * <TOTEM:END>
       pb-stampa2-BeforeProcedure.
      * <TOTEM:PARA. pb-stampa2-BeforeProcedure>
           modify pb-stampa2, bitmap-number = 2 
           .
      * <TOTEM:END>
       pb-stampa2-AfterProcedure.
      * <TOTEM:PARA. pb-stampa2-AfterProcedure>
           modify pb-stampa2, bitmap-number = 1 
           .
      * <TOTEM:END>
       gd2-Ev-Msg-Begin-Drag.
      * <TOTEM:PARA. gd2-Ev-Msg-Begin-Drag>
           perform SPOSTAMENTO2 
           .
      * <TOTEM:END>
       gd2-Ev-Msg-End-Drag.
      * <TOTEM:PARA. gd2-Ev-Msg-End-Drag>
           perform SPOSTAMENTO2 
           .
      * <TOTEM:END>
       gd2-Ev-Msg-Goto-Cell.
      * <TOTEM:PARA. gd2-Ev-Msg-Goto-Cell>
           perform SPOSTAMENTO2 
           .
      * <TOTEM:END>
       gd2-Ev-Msg-Goto-Cell-Drag.
      * <TOTEM:PARA. gd2-Ev-Msg-Goto-Cell-Drag>
           perform SPOSTAMENTO2 
           .
      * <TOTEM:END>
       gd2-Ev-Msg-Goto-Cell-Mouse.
      * <TOTEM:PARA. gd2-Ev-Msg-Goto-Cell-Mouse>
           perform SPOSTAMENTO2 
           .
      * <TOTEM:END>

      *{TOTEM}END

      *{TOTEM}SHOW-MSG
       MESSAGE-FOR-FILEERROR.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
              MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           .

       SHOW-TRANSACTION-ROUTINE.
           IF TOTEM-TRANSACTION-FLAG = SPACES
              IF TRANSACTION-STATUS NOT = 0
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-1
              END-IF
           ELSE
              PERFORM SHOW-MSG-ROUTINE
              IF TRANSACTION-STATUS = 0
                 MOVE "Transazione terminata con Rollback." TO 
           TOTEM-MSG-3
              ELSE
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-3
              END-IF
           END-IF
           .

       SHOW-MSG-ROUTINE.
           MOVE SPACE TO TOTEM-MSG-1 TOTEM-MSG-2 TOTEM-MSG-3
           EVALUATE TOTEM-MSG-ID
               WHEN "10"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Nessun altro dato." TO TOTEM-MSG-2
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "22"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Chiave Duplicata." TO TOTEM-MSG-2
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "23"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Raggiunta fine file." TO TOTEM-MSG-2
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "101"
                    MOVE "Terminare l'applicazione?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "201"
                    MOVE "Aggiungere un nuovo record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "202"
                    MOVE "Aggiornare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "203"
                    MOVE "Cancellare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "204"
                    MOVE "Chiave duplicata." TO TOTEM-MSG-1
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "301"
                    MOVE "Inserimento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "302"
                    MOVE "Aggiornamento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "303"
                    MOVE "Cancellazione avvenuta con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "401"
                    MOVE "Shell non trovata." TO TOTEM-MSG-1
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN OTHER
                    MOVE TEXT-MESSAGE TO TOTEM-MSG-1
                    STRING "FILE:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-3
                    MOVE 0 TO TOTEM-IDX1
                    INSPECT TOTEM-MSG-3 TALLYING TOTEM-IDX1
                       FOR TRAILING SPACE
                    STRING TOTEM-MSG-3(1:TOTEM-MSG-LENGTH - 
           TOTEM-IDX1), 
                       ", FILE STATUS ", PRIMARY-ERROR "," 
                       SECONDARY-ERROR
                    DELIMITED BY SIZE INTO TOTEM-MSG-2
                    MOVE SPACES TO TOTEM-MSG-3
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
           END-EVALUATE
           PERFORM MESSAGE-BOX-ROUTINE
           .

       MESSAGE-BOX-ROUTINE.
           MOVE 1 TO TOTEM-MSG-TEXT-POINTER
           IF TOTEM-MSG-1 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-1 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              STRING TOTEM-MSG-1( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                 DELIMITED BY SIZE
                 INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-2 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-2 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-2( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-3 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-3 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-3( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-TEXT-POINTER = 1
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-TEXT TALLYING TOTEM-MSG-SIZE FOR 
           TRAILING SPACE
                  COMPUTE TOTEM-MSG-TEXT-POINTER = 
           TOTEM-MSG-FULL-LENGTH - TOTEM-MSG-SIZE + 1
           END-IF
           MOVE LOW-VALUES TO TOTEM-MSG-TEXT(TOTEM-MSG-TEXT-POINTER : 1 
           )
           .

       MESSAGE-BOX-DISPLAY.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

      *{TOTEM}END

