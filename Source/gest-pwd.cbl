      *{TOTEM}PRG-COMMENT
      * gest-pwd.Cbl
      * gest-pwd.Cbl is generated by TOTEM
      * This is a generated file. DO NOT modify this file directly.
      *{TOTEM}END
       IDENTIFICATION       DIVISION.
      *{TOTEM}PRGID
       PROGRAM-ID.          gest-pwd.
       AUTHOR.              ANDREA EVENTI.
       DATE-WRITTEN.        lunedì 2 luglio 2018 10:50:15.
       REMARKS.
      *{TOTEM}END

       ENVIRONMENT          DIVISION.
       CONFIGURATION        SECTION.
       SPECIAL-NAMES.
      *{TOTEM}SPECIAL-NAME
      * <TOTEM:EPT. INIT:gest-pwd, INIT:gest-pwd, SpecialName>
      * <TOTEM:END>
      *{TOTEM}END
      *{TOTEM}ACTIVEX-DEF
      *{TOTEM}END
      *{TOTEM}DECIMAL-POINT
           DECIMAL-POINT IS COMMA.
      *{TOTEM}END

       INPUT-OUTPUT         SECTION.
       FILE-CONTROL.
      *{TOTEM}FILE-CONTROL
           COPY "USER.sl".
           COPY "USER-PGM.sl"
                REPLACING ==USER-PGM== BY ==USER-PGM1==,
                          ==STATUS-user-pgm== BY 
           ==STATUS-user-pgm-USER-PGM1==
                .
           COPY "USER-PGM.sl".
      *{TOTEM}END
       DATA                 DIVISION.
       FILE                 SECTION.
      *{TOTEM}FILE
           COPY "USER.fd".
           COPY "USER-PGM.fd"
                REPLACING ==USER-PGM== BY ==USER-PGM1==,
                          ==STATUS-user-pgm== BY 
           ==STATUS-user-pgm-USER-PGM1==
                .
           COPY "USER-PGM.fd".
      *{TOTEM}END

       WORKING-STORAGE      SECTION.
      *{TOTEM}ACU-DEF
               COPY "acugui.def".
               COPY "acucobol.def".
               COPY "fonts.def".
               COPY "crtvars.def".
               COPY "showmsg.def".
               COPY "totem.def".
               COPY "F:\lubex\geslux\Copylib\standard.def".
      *{TOTEM}END

      *{TOTEM}COPY-WORKING
      * Key Status
       77 Key-Status IS SPECIAL-NAMES CRT STATUS PIC 9(5) VALUE 0.
          88 Enter-Pushed VALUE 13.
          88 Exit-Pushed VALUE 27.
          88 Message-Received VALUE 95.
          88 Event-Occurred VALUE 96.
          88 Screen-No-Input-Field VALUE 97.
      * Properties & User defined Working Stoarge
       77 Form1-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 Small-Font
                  USAGE IS HANDLE OF FONT SMALL-FONT.
           COPY  "LINK-USR-TEL.DEF".
       77 STATUS-USER      PIC  X(2).
           88 VALID-STATUS-USER VALUE IS "00" THRU "09". 
       77 Form1-Tb-1-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 UTENTI15X16-bmp
                  USAGE IS HANDLE OF BITMAP
                  VALUE IS 0.
       77 PWD15X16-bmp
                  USAGE IS HANDLE OF BITMAP
                  VALUE IS 0.
       77 Form1-St-1-Handle
                  USAGE IS HANDLE OF STATUS-BAR.
       77 BitmapNumScheda  PIC  9.
       77 Times-New-Roman9B
                  USAGE IS HANDLE OF FONT.
       77 toolbar-bmp
                  USAGE IS HANDLE OF BITMAP
                  VALUE IS 0.
       77 como-pwd         PIC  x(20).
       77 toolbar-pwd-BMP  PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 como-anno        PIC  9(4).
       77 UtenteInUso      PIC  x(20).
       77 UtenteFrom       PIC  x(20).
       77 BitmapNumScad    PIC  9.
       01 como-record      PIC  x(1000).
       01 messaggio        PIC  x(80).
       01 FILLER           PIC  9.
           88 bisestile VALUE IS 1    WHEN SET TO FALSE  0. 
       01 data-validita.
           05 anno PIC  9999.
           05 mese PIC  99.
           05 giorno           PIC  99.
       77 counter          PIC  9(3).
       77 E-SALVA          PIC  9
                  VALUE IS 1.
       77 Verdana10-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 Verdana12-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 bottone-gestutenti-bmp       PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       78 titolo VALUE IS "GESLUX - Gestione utenti". 
       77 v-boss           PIC  9
                  VALUE IS 0.
       77 cambio-pwd-bmp   PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 win-lines        PIC  S9(4)V9(2)
                  VALUE IS 35,00.
       77 OLD-PASS         PIC  X(20).
       77 NEW-PASS         PIC  X(20).
       77 PASS PIC  X(20).
       77 Default-Font
                  USAGE IS HANDLE OF FONT DEFAULT-FONT.
       77 AUTO-ID          PIC  9(6)
                  VALUE IS 0,00.
       77 BitmapNumModuli  PIC  9
                  VALUE IS 3.
       77 BitmapNumImporta PIC  9
                  VALUE IS 3.
       77 BitmapNumChange  PIC  9.
       77 e-altri          PIC  9
                  VALUE IS 0.
       77 ABIL-MODULI-BMP  PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 descr            PIC  X(30).
       77 e-id PIC  9
                  VALUE IS 0.
       77 e-pwd            PIC  9
                  VALUE IS 0.
       77 validita         PIC  99/99/9999.
       77 data-pass        PIC  99/99/9999.
       77 modifica-dati-bmp            PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 v-cancella       PIC  9
                  VALUE IS 0.
       77 v-scorr          PIC  9
                  VALUE IS 0.
       77 e-scorr          PIC  9
                  VALUE IS 1.
       77 e-cancella       PIC  9
                  VALUE IS 0.
       77 STATUS-user-pgm  PIC  X(2).
           88 Valid-STATUS-user-pgm VALUE IS "00" THRU "09". 
       77 STATUS-USER1     PIC  X(2).
           88 VALID-STATUS-USER1 VALUE IS "00" THRU "09". 
       77 STATUS-user-pgm-USER-PGM1    PIC  X(2).
           88 VALID-STATUS-user-pgm-USER-PGM1 VALUE IS "00" THRU "09". 
       77 importa-bmp      PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 v-boss-salvato   PIC  9
                  VALUE IS 0.
       77 scadute-bmp      PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 scheda-bmp       PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 tel-dir          PIC  X(20).
       77 cbo-SO-buf       PIC  X(30).
       77 cbo-office-buf   PIC  X(30).
       77 ef-path-bullzip-buf          PIC  X(128).
       77 ef-path-acuthin-buf          PIC  X(200).

      ***********************************************************
      *   Code Gen's Buffer                                     *
      ***********************************************************
       77 STATUS-Form1-FLAG-REFRESH PIC  9.
          88 Form1-FLAG-REFRESH  VALUE 1 FALSE 0. 
      * DATA CONTROL BUFFER
       01 Form1-BUF.
      * Data.Check-Box
              05 chk-msg-BUF PIC 9 VALUE ZERO.
      * Data.Check-Box
              05 chk-banner-t-BUF PIC 9 VALUE ZERO.
      * Data.Check-Box
              05 chk-banner-g-BUF PIC 9 VALUE ZERO.
      * Data.Check-Box
              05 chk-ev-man-BUF PIC 9 VALUE ZERO.

       77 TMP-Form1-KEY1-ORDER  PIC X VALUE "A".
       77 TMP-Form1-USER-RESTOREBUF  PIC X(1015).
       77 TMP-Form1-KEYIS  PIC 9(3) VALUE 1.
       77 Form1-MULKEY-TMPBUF   PIC X(1015).
       77 TMP-DataSet1-USER-BUF     PIC X(1015).
       77 TMP-DataSet1-USER-PGM1-BUF     PIC X(26).
       77 TMP-DataSet1-USER-PGM-BUF     PIC X(26).
      * VARIABLES FOR RECORD LENGTH.
       77  TotemFdSlRecordClearOffset   PIC 9(5) COMP-4.
       77  TotemFdSlRecordLength        PIC 9(5) COMP-4.
      * FILE'S LOCK MODE FLAG
       77 DataSet1-USER-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-USER-LOCK  VALUE "Y".
       77 DataSet1-KEYIS   PIC 9(3) VALUE 1.
       77 DataSet1-USER-KEY1-ORDER  PIC X VALUE "A".
          88 DataSet1-USER-KEY1-Asc  VALUE "A".
          88 DataSet1-USER-KEY1-Desc VALUE "D".
       77 DataSet1-USER-PGM1-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-USER-PGM1-LOCK  VALUE "Y".
       77 DataSet1-USER-PGM1-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-USER-PGM1-KEY-Asc  VALUE "A".
          88 DataSet1-USER-PGM1-KEY-Desc VALUE "D".
       77 DataSet1-USER-PGM-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-USER-PGM-LOCK  VALUE "Y".
       77 DataSet1-USER-PGM-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-USER-PGM-KEY-Asc  VALUE "A".
          88 DataSet1-USER-PGM-KEY-Desc VALUE "D".


      *{TOTEM}END

      *{TOTEM}ID-LOGICI
      ***** Elenco ID Logici *****
       78  78-ID-EF-id VALUE 5001.
       78  78-ID-EF-OLD-PASS VALUE 5002.
       78  78-ID-ef-nome VALUE 5003.
       78  78-ID-ef-tel-dir VALUE 5004.
       78  78-ID-EF-NEW-PASS VALUE 5005.
       78  78-ID-EF-PASS VALUE 5006.
       78  78-ID-cbo-office VALUE 5007.
       78  78-ID-cbo-SO VALUE 5008.
       78  78-ID-chk-ev-man VALUE 5009.
       78  78-ID-ef-path-bullzip VALUE 5010.
      ***** Fine ID Logici *****
      *{TOTEM}END

       LINKAGE          SECTION.
      *{TOTEM}LINKAGE
           COPY  "COMMON-LINKAGE.DEF".

      *{TOTEM}END

       SCREEN           SECTION.
      *{TOTEM}COPY-SCREEN
      * FORM
       01 
           Form1, 
           AFTER PROCEDURE Form1-AfterProcedure,
           BEFORE PROCEDURE Form1-BeforeProcedure,
           .

      * ENTRY FIELD
       05
           EF-id, 
           Entry-Field, 
           COL 17,00, 
           LINE 1,50,
           LINES 1,33 CELLS,
           SIZE 21,00 CELLS,
           BOXED,
           ENABLED e-id,
           ID IS 78-ID-EF-id,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 10,
           VALUE USER-ID,
           AFTER PROCEDURE EF-id-AfterProcedure, 
           .

      * ENTRY FIELD
       05
           EF-OLD-PASS, 
           Entry-Field, 
           COL 17,00, 
           LINE 3,28,
           LINES 1,33 CELLS,
           SIZE 21,00 CELLS,
           BOXED,
           ENABLED e-pwd,
           ID IS 78-ID-EF-OLD-PASS,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 20,
           SECURE,
           VALUE OLD-PASS,
           AFTER PROCEDURE EF-OLD-PASS-AfterProcedure, 
           .

      * PUSH BUTTON
       05
           pb-cambio, 
           Push-Button, 
           COL 39,00, 
           LINE 3,00,
           LINES 30,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE MODIFICA_DATI-BMP,
           FRAMED,
           SQUARE,
           ENABLED e-pwd,
           EXCEPTION-VALUE 1001,
           FLAT,
           FONT IS Small-Font,
           ID IS 11,
           TITLE "&Modifica Dati",
           BITMAP-NUMBER BitmapNumChange
           AFTER PROCEDURE pb-cambio-AfterProcedure, 
           BEFORE PROCEDURE pb-cambio-BeforeProcedure, 
           .

      * PUSH BUTTON
       05
           pb-scadute, 
           Push-Button, 
           COL 39,00, 
           LINE 1,00,
           LINES 30,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE SCADUTE-BMP,
           FRAMED,
           SQUARE,
           ENABLED e-pwd,
           EXCEPTION-VALUE 1005,
           FLAT,
           FONT IS Small-Font,
           ID IS 666,
           TITLE "Stampa un elenco delle password scadute",
           BITMAP-NUMBER BitmapNumScad
           AFTER PROCEDURE pb-scadute-AfterProcedure, 
           BEFORE PROCEDURE pb-scadute-BeforeProcedure, 
           .

      * ENTRY FIELD
       05
           ef-nome, 
           Entry-Field, 
           COL 17,00, 
           LINE 6,33,
           LINES 1,33 CELLS,
           SIZE 30,00 CELLS,
           BOXED,
           ENABLED e-altri,
           ID IS 78-ID-ef-nome,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 20,
           VALUE descr,
           VISIBLE 1,
           AFTER PROCEDURE ef-nome-AfterProcedure, 
           .

      * ENTRY FIELD
       05
           ef-tel-dir, 
           Entry-Field, 
           COL 17,00, 
           LINE 8,33,
           LINES 1,33 CELLS,
           SIZE 30,00 CELLS,
           BOXED,
           ENABLED e-altri,
           ID IS 78-ID-ef-tel-dir,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 20,
           VALUE tel-dir,
           VISIBLE 1,
           AFTER PROCEDURE ef-nome-AfterProcedure, 
           .

      * ENTRY FIELD
       05
           EF-NEW-PASS, 
           Entry-Field, 
           COL 17,00, 
           LINE 10,33,
           LINES 1,31 CELLS,
           SIZE 21,00 CELLS,
           BOXED,
           ENABLED e-altri,
           ID IS 78-ID-EF-NEW-PASS,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 20,
           SECURE,
           VALUE NEW-PASS,
           VISIBLE 1,
           AFTER PROCEDURE EF-NEW-PASS-AfterProcedure, 
           .

      * ENTRY FIELD
       05
           EF-PASS, 
           Entry-Field, 
           COL 17,00, 
           LINE 12,33,
           LINES 1,33 CELLS,
           SIZE 21,00 CELLS,
           BOXED,
           ENABLED e-altri,
           ID IS 78-ID-EF-PASS,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 20,
           SECURE,
           VALUE PASS,
           VISIBLE 1,
           AFTER PROCEDURE EF-PASS-AfterProcedure, 
           .

      * CHECK BOX
       05
           chk-msg, 
           Check-Box, 
           COL 17,00, 
           LINE 14,78,
           LINES 1,33 CELLS,
           SIZE 1,60 CELLS,
           ENABLED e-altri,
           FLAT,
           ID IS 27,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           VALUE chk-msg-BUF,
           BEFORE PROCEDURE Form1-DaCb-1-BeforeProcedure, 
            .
      * CHECK BOX
       05
           chk-banner-t, 
           Check-Box, 
           COL 17,00, 
           LINE 16,50,
           LINES 1,33 CELLS,
           SIZE 1,60 CELLS,
           ENABLED e-altri,
           FLAT,
           ID IS 28,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           VALUE chk-banner-t-BUF,
           BEFORE PROCEDURE Form1-DaCb-1-BeforeProcedure, 
            .
      * CHECK BOX
       05
           chk-banner-g, 
           Check-Box, 
           COL 17,00, 
           LINE 18,22,
           LINES 1,33 CELLS,
           SIZE 1,60 CELLS,
           ENABLED e-altri,
           FLAT,
           ID IS 29,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           VALUE chk-banner-g-BUF,
           BEFORE PROCEDURE Form1-DaCb-1-BeforeProcedure, 
            .
      * COMBO-BOX
       05
           cbo-office, 
           Combo-Box, 
           COL 17,00, 
           LINE 20,17,
           LINES 5,00 CELLS,
           SIZE 12,80 CELLS,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-cbo-office,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MASS-UPDATE 0,
           DROP-LIST,
           UNSORTED,
           VALUE cbo-office-buf,
           AFTER PROCEDURE Form1-Cm-1-AfterProcedure, 
           BEFORE PROCEDURE Form1-Cm-1-BeforeProcedure, 
           .
      * COMBO-BOX
       05
           cbo-SO, 
           Combo-Box, 
           COL 37,00, 
           LINE 20,17,
           LINES 5,00 CELLS,
           SIZE 10,00 CELLS,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-cbo-SO,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MASS-UPDATE 0,
           DROP-LIST,
           UNSORTED,
           VALUE cbo-SO-buf,
           AFTER PROCEDURE Form1-Cm-1-AfterProcedure, 
           BEFORE PROCEDURE Form1-Cm-1-BeforeProcedure, 
           .
      * CHECK BOX
       05
           chk-ev-man, 
           Check-Box, 
           COL 38,00, 
           LINE 14,78,
           LINES 1,33 CELLS,
           SIZE 1,60 CELLS,
           ENABLED e-altri,
           FLAT,
           ID IS 78-ID-chk-ev-man,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           VALUE chk-ev-man-BUF,
           BEFORE PROCEDURE Form1-DaCb-1-BeforeProcedure, 
            .
      * PUSH BUTTON
       05
           pb-moduli, 
           Push-Button, 
           COL 29,60, 
           LINE 22,06,
           LINES 30,00 ,
           SIZE 167,00 ,
           BITMAP-HANDLE ABIL_MODULI-BMP,
           UNFRAMED,
           SQUARE,
           ENABLED e-altri,
           EXCEPTION-VALUE 1000,
           FLAT,
           FONT IS Small-Font,
           ID IS 9,
           TITLE "&Abilitazione moduli",
           VISIBLE v-boss-salvato,
           BITMAP-NUMBER=BitmapNumModuli
           AFTER PROCEDURE pb-moduli-AfterProcedure, 
           BEFORE PROCEDURE pb-moduli-BeforeProcedure, 
           .

      * PUSH BUTTON
       05
           pb-importa, 
           Push-Button, 
           COL 34,90, 
           LINE 24,06,
           LINES 30,00 ,
           SIZE 114,00 ,
           BITMAP-HANDLE IMPORTA-BMP,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 1004,
           FLAT,
           FONT IS Small-Font,
           ID IS 3,
           TITLE "Importa le abilitazioni del menu da un altro utente",
           VISIBLE v-boss-salvato,
           BITMAP-NUMBER=BitmapNumImporta
           AFTER PROCEDURE pb-importa-AfterProcedure, 
           BEFORE PROCEDURE pb-importa-BeforeProcedure, 
           .

      * PUSH BUTTON
       05
           pb-scheda, 
           Push-Button, 
           COL 29,70, 
           LINE 26,06,
           LINES 30,00 ,
           SIZE 166,00 ,
           BITMAP-HANDLE SCHEDA-BMP,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 1006,
           FLAT,
           FONT IS Small-Font,
           ID IS 26,
           TITLE "Gestione dati configurazione mail",
           VISIBLE v-boss-salvato,
           BITMAP-NUMBER=BitmapNumScheda
           AFTER PROCEDURE pb-scheda-AfterProcedure, 
           BEFORE PROCEDURE pb-scheda-BeforeProcedure, 
           .

      * LABEL
       05
           Form1-La-1, 
           Label, 
           COL 2,00, 
           LINE 1,50,
           LINES 1,33 CELLS,
           SIZE 8,60 CELLS,
           COLOR IS 512,
           ID IS 1,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "User-ID",
           .

      * LABEL
       05
           Form1-La-2, 
           Label, 
           COL 2,00, 
           LINE 3,28,
           LINES 1,31 CELLS,
           SIZE 12,86 CELLS,
           COLOR IS 512,
           ID IS 2,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Password",
           .

      * LABEL
       05
           Form1-La-3, 
           Label, 
           COL 2,00, 
           LINE 10,33,
           LINES 1,31 CELLS,
           SIZE 14,00 CELLS,
           COLOR IS 512,
           ID IS 5,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Nuova Password",
           VISIBLE 1,
           .

      * LABEL
       05
           Form1-La-3a, 
           Label, 
           COL 2,00, 
           LINE 12,33,
           LINES 2,00 CELLS,
           SIZE 14,00 CELLS,
           COLOR IS 512,
           ID IS 6,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Conferma nuova Password",
           VISIBLE 1,
           .

      * LABEL
       05
           Form1-blockpgm-1, 
           Label, 
           COL 7,80, 
           LINE 1,17,
           LINES 0,61 CELLS,
           SIZE 2,10 CELLS,
           ID IS 15,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "BlockPgm",
           VISIBLE v-custom,
           .

      * BAR
       05
           Form1-Br-1, 
           Bar,
           COL 1,00, 
           LINE 5,17,
           SIZE 46,80 CELLS,
           ID IS 13,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           COLORS (1),
           SHADING (-1),
           WIDTH 1,
           .

      * BAR
       05
           Form1-Br-1a, 
           Bar,
           COL 1,00, 
           LINE 5,61,
           SIZE 46,80 CELLS,
           ID IS 14,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           COLORS (1),
           SHADING (-1),
           WIDTH 1,
           .

      * LABEL
       05
           Form1-Custom1-1, 
           Label, 
           COL 2,60, 
           LINE 1,28,
           LINES 1,00 CELLS,
           SIZE 1,00 CELLS,
           FONT IS Default-Font,
           ID IS 16,
           TRANSPARENT,
           TITLE "CUSTOM CONTROL",
           VISIBLE v-custom,
           .

      * LABEL
       05
           Form1-La-3aa, 
           Label, 
           COL 2,00, 
           LINE 23,44,
           LINES 1,33 CELLS,
           SIZE 14,00 CELLS,
           COLOR IS 512,
           ID IS 17,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Data Password",
           VISIBLE 1,
           .

      * LABEL
       05
           Form1-La-3aaa, 
           Label, 
           COL 2,00, 
           LINE 25,17,
           LINES 1,33 CELLS,
           SIZE 14,00 CELLS,
           COLOR IS 512,
           ID IS 18,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Valida fino al",
           VISIBLE 1,
           .

      * LABEL
       05
           lab-data, 
           Label, 
           COL 17,00, 
           LINE 23,44,
           LINES 1,33 CELLS,
           SIZE 10,00 CELLS,
           COLOR IS 517,
           ID IS 19,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TITLE data-pass,
           VISIBLE 1,
           .

      * LABEL
       05
           lab-validita, 
           Label, 
           COL 17,00, 
           LINE 25,17,
           LINES 1,33 CELLS,
           SIZE 10,00 CELLS,
           COLOR IS 517,
           ID IS 20,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TITLE validita,
           VISIBLE 1,
           .

      * LABEL
       05
           Form1-La-3b, 
           Label, 
           COL 2,00, 
           LINE 6,33,
           LINES 1,33 CELLS,
           SIZE 14,00 CELLS,
           COLOR IS 512,
           ID IS 669,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Descrizione",
           VISIBLE 1,
           .

      * LABEL
       05
           Form1-La-3c, 
           Label, 
           COL 2,00, 
           LINE 14,78,
           LINES 1,33 CELLS,
           SIZE 14,00 CELLS,
           COLOR IS 512,
           ID IS 670,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Mess. promo",
           VISIBLE 1,
           .

      * LABEL
       05
           Form1-La-3ca, 
           Label, 
           COL 2,00, 
           LINE 18,22,
           LINES 1,33 CELLS,
           SIZE 14,00 CELLS,
           COLOR IS 512,
           ID IS 671,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Mess. Banner G",
           VISIBLE 1,
           .

      * LABEL
       05
           Form1-La-3caa, 
           Label, 
           COL 2,00, 
           LINE 16,50,
           LINES 1,33 CELLS,
           SIZE 14,00 CELLS,
           COLOR IS 512,
           ID IS 672,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Mess. Banner T",
           VISIBLE 1,
           .

      * LABEL
       05
           Form1-La-3ba, 
           Label, 
           COL 2,00, 
           LINE 8,33,
           LINES 1,33 CELLS,
           SIZE 14,00 CELLS,
           COLOR IS 512,
           ID IS 673,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Tel. Diretto",
           VISIBLE 1,
           .

      * LABEL
       05
           Form1-La-3cab, 
           Label, 
           COL 21,00, 
           LINE 14,61,
           LINES 1,33 CELLS,
           SIZE 15,00 CELLS,
           COLOR IS 512,
           ID IS 674,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Evasione manuale",
           VISIBLE 1,
           .

      * LABEL
       05
           Form1-La-3cac, 
           Label, 
           COL 1,90, 
           LINE 20,17,
           LINES 1,33 CELLS,
           SIZE 14,00 CELLS,
           COLOR IS 512,
           ID IS 675,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Office",
           VISIBLE 1,
           .

      * LABEL
       05
           Form1-La-3caca, 
           Label, 
           COL 31,90, 
           LINE 20,17,
           LINES 1,33 CELLS,
           SIZE 4,00 CELLS,
           COLOR IS 512,
           ID IS 676,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "S.O.",
           VISIBLE 1,
           .

      * LABEL
       05
           Form1-La-3aaaa, 
           Label, 
           COL 2,00, 
           LINE 27,89,
           LINES 1,00 CELLS,
           SIZE 26,70 CELLS,
           COLOR IS 512,
           ID IS 677,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE 'Path Bullzip (terminare con "\")',
           VISIBLE 1,
           .

      * ENTRY FIELD
       05
           ef-path-bullzip, 
           Entry-Field, 
           COL 2,00, 
           LINE 29,22,
           LINES 1,31 CELLS,
           SIZE 45,00 CELLS,
           BOXED,
           ENABLED e-altri,
           ID IS 78-ID-ef-path-bullzip,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 128,
           VALUE ef-path-bullzip-buf,
           VISIBLE 1,
           AFTER PROCEDURE EF-NEW-PASS-AfterProcedure, 
           .

      * LABEL
       05
           Form1-La-3aaaaa, 
           Label, 
           COL 2,00, 
           LINE 31,22,
           LINES 1,00 CELLS,
           SIZE 26,70 CELLS,
           COLOR IS 512,
           ID IS 679,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Path ACUTHIN installato",
           VISIBLE 1,
           .

      * ENTRY FIELD
       05
           ef-path-acuthin, 
           Entry-Field, 
           COL 1,80, 
           LINE 32,56,
           LINES 1,31 CELLS,
           SIZE 45,00 CELLS,
           BOXED,
           ENABLED e-altri,
           ID IS 680,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 128,
           VALUE ef-path-acuthin-buf,
           VISIBLE 1,
           AFTER PROCEDURE EF-NEW-PASS-AfterProcedure, 
           .

      * TOOLBAR
       01
           Form1-Tb-1,
           .    

      * PUSH BUTTON
       05
           PB-ESCI, 
           Push-Button, 
           COL 1,00, 
           LINE 1,28,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           ENABLED 1,
           EXCEPTION-VALUE 27,
           FLAT,
           ID IS 12,
           SELF-ACT,
           ESCAPE-BUTTON,
           TITLE "Esci  ",
           .

      * PUSH BUTTON
       05
           TOOL-SALVA, 
           Push-Button, 
           COL 4,30, 
           LINE 1,28,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           UNFRAMED,
           SQUARE,
           ENABLED E-SALVA,
           EXCEPTION-VALUE 3,
           FLAT,
           ID IS 10,
           SELF-ACT,
           TITLE "Salva (F3) ",
           BITMAP-NUMBER BitmapNumSave
           .

      * PUSH BUTTON
       05
           TOOL-CANCELLA, 
           Push-Button, 
           COL 7,60, 
           LINE 1,28,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           UNFRAMED,
           SQUARE,
           ENABLED e-cancella,
           EXCEPTION-VALUE 4,
           FLAT,
           ID IS 21,
           SELF-ACT,
           TITLE "Salva (F3) ",
           VISIBLE v-cancella,
           BITMAP-NUMBER BitmapNumDelete
           .

      * PUSH BUTTON
       05
           TOOL-PRIMO, 
           Push-Button, 
           COL 10,90, 
           LINE 1,28,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           BITMAP-NUMBER 10,
           UNFRAMED,
           SQUARE,
           ENABLED e-scorr,
           EXCEPTION-VALUE 1002,
           FLAT,
           ID IS 22,
           SELF-ACT,
           TITLE "Salva (F3) ",
           VISIBLE v-scorr,
           .

      * PUSH BUTTON
       05
           TOOL-PRECEDENTE, 
           Push-Button, 
           COL 14,10, 
           LINE 1,28,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           BITMAP-NUMBER 11,
           UNFRAMED,
           SQUARE,
           ENABLED e-scorr,
           EXCEPTION-VALUE 67,
           FLAT,
           ID IS 23,
           SELF-ACT,
           TITLE "Salva (F3) ",
           VISIBLE v-scorr,
           .

      * PUSH BUTTON
       05
           TOOL-SUCCESSIVO, 
           Push-Button, 
           COL 17,30, 
           LINE 1,28,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           BITMAP-NUMBER 12,
           UNFRAMED,
           SQUARE,
           ENABLED e-scorr,
           EXCEPTION-VALUE 68,
           FLAT,
           ID IS 24,
           SELF-ACT,
           TITLE "Salva (F3) ",
           VISIBLE v-scorr,
           .

      * PUSH BUTTON
       05
           TOOL-ULTIMO, 
           Push-Button, 
           COL 20,50, 
           LINE 1,28,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           BITMAP-NUMBER 13,
           UNFRAMED,
           SQUARE,
           ENABLED e-scorr,
           EXCEPTION-VALUE 1003,
           FLAT,
           ID IS 25,
           SELF-ACT,
           TITLE "Salva (F3) ",
           VISIBLE v-scorr,
           .

      *{TOTEM}END

      *{TOTEM}LINKPARA
       PROCEDURE  DIVISION USING LK-BLOCKPGM, USER-CODI, LIVELLO-ABIL.
      *{TOTEM}END

      *{TOTEM}DECLARATIVE
       DECLARATIVES.
      * <TOTEM:EPT. INIT:gest-pwd, INIT:gest-pwd, BeforeDeclarative>
       USER-ERR SECTION.
           use after error procedure on user.
           set RecLocked to false.
           evaluate status-user
           when "35"
                display message "File [USER] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [USER] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[USER] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           when "99"
           when "93"
                set RecLocked to true
                set errori    to true

                display message MSG-Record-gia-in-uso
                          title tit-err
                           icon 2
           end-evaluate.

      ***---
       USER-PGM-ERROR SECTION.
           use after error procedure on user-pgm.
           set RecLocked to false.
           evaluate status-user-pgm
           when "35"
                display message "File [USER-PGM] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [USER-PGM] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[USER-PGM] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           when "99"
           when "93"
                set RecLocked to true
                set errori    to true
           end-evaluate.

      * <TOTEM:END>
       INPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON INPUT.
       0100-DECL.
           EXIT.
       I-O-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON I-O.
       0200-DECL.
           EXIT.
       OUTPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON OUTPUT.
       0300-DECL.
           EXIT.
       TRANSACTION-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON TRANSACTION.
       0400-DECL.
           EXIT.
       END DECLARATIVES.
      *{TOTEM}END

       MAIN-LOGIC.
      *{TOTEM}ENTRY-BEFPRG
      *    Before-Program
           PERFORM Gest-Pwd-Ev-Before-Program
      *{TOTEM}END
           PERFORM INITIALIZE-ROUTINE.
      * run main screen
      *{TOTEM}RUN-MAINSCR
           PERFORM Form1-OPEN-ROUTINE.
      *{TOTEM}END

      *{TOTEM}COPY-PROCEDURE
       EXIT-STOP-ROUTINE.
           PERFORM CLOSE-FILE-RTN
      * <TOTEM:EPT. INIT:gest-pwd, INIT:gest-pwd, BeforeDestroyResource>
      * <TOTEM:END>
           DESTROY Verdana12-Occidentale
           CALL "w$bitmap" USING WBITMAP-DESTROY, MODIFICA_DATI-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, SCADUTE-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, ABIL_MODULI-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, IMPORTA-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, SCHEDA-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, TOOLBAR-BMP
      *    After-Program
           PERFORM I-O-BLOCCO
           EXIT PROGRAM TOTEM-PgmStatus
           STOP RUN.

       INITIALIZE-ROUTINE.
      *    Before Init
      * initialize program status variable
           Initialize TOTEM-PgmStatus.
      * get system information
           ACCEPT SYSTEM-INFORMATION FROM SYSTEM-INFO.
      * get terminal information
           ACCEPT TERMINAL-ABILITIES FROM TERMINAL-INFO.
      * set font
           PERFORM INIT-FONT.
      * load bitmap
           PERFORM INIT-BMP.
      * load resource
           PERFORM INIT-RES.
      * create pop-up menu
           PERFORM INIT-POPUP.
      * open files
           PERFORM OPEN-FILE-RTN.
      *    After Init
           .
    
       INIT-FONT.
      * Verdana12-Occidentale
           INITIALIZE WFONT-DATA Verdana12-Occidentale
           MOVE 12 TO WFONT-SIZE
           MOVE "Verdana" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO FALSE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Verdana12-Occidentale, WFONT-DATA
           .

       INIT-BMP.
      * pb-cambio
           COPY RESOURCE "MODIFICA_DATI.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "MODIFICA_DATI.BMP", 
                   GIVING MODIFICA_DATI-BMP.
      * pb-scadute
           COPY RESOURCE "SCADUTE.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "SCADUTE.BMP", 
                   GIVING SCADUTE-BMP.
      * pb-moduli
           COPY RESOURCE "ABIL_MODULI.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "ABIL_MODULI.BMP", 
                   GIVING ABIL_MODULI-BMP.
      * pb-importa
           COPY RESOURCE "IMPORTA.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "IMPORTA.BMP", 
                   GIVING IMPORTA-BMP.
      * pb-scheda
           COPY RESOURCE "SCHEDA.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "SCHEDA.BMP", 
                   GIVING SCHEDA-BMP.
      * PB-ESCI
           COPY RESOURCE "TOOLBAR.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "TOOLBAR.BMP", 
                   GIVING TOOLBAR-BMP.
           .

       INIT-RES.
           .

       INIT-POPUP.
           .

       OPEN-FILE-RTN.
      *    Before Open
           PERFORM OPEN-USER
           PERFORM OPEN-USER-PGM1
           PERFORM OPEN-USER-PGM
      *    After Open
           .

       OPEN-USER.
      * <TOTEM:EPT. INIT:gest-pwd, FD:USER, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O USER
           IF STATUS-USER = "35"
              OPEN OUTPUT USER
                IF VALID-STATUS-USER
                   CLOSE USER
                   OPEN I-O USER
                END-IF
           END-IF
           IF NOT VALID-STATUS-USER
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gest-pwd, FD:USER, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-USER-PGM1.
      * <TOTEM:EPT. INIT:gest-pwd, FD:USER-PGM1, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT USER-PGM1
           IF NOT VALID-STATUS-user-pgm-USER-PGM1
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gest-pwd, FD:USER-PGM1, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-USER-PGM.
      * <TOTEM:EPT. INIT:gest-pwd, FD:USER-PGM, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O USER-PGM
           IF STATUS-user-pgm = "35"
              OPEN OUTPUT USER-PGM
                IF Valid-STATUS-user-pgm
                   CLOSE USER-PGM
                   OPEN I-O USER-PGM
                END-IF
           END-IF
           IF NOT Valid-STATUS-user-pgm
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gest-pwd, FD:USER-PGM, AfterOpen>
      * <TOTEM:END>
           .

       CLOSE-FILE-RTN.
      *    Before Close
           PERFORM CLOSE-USER
           PERFORM CLOSE-USER-PGM1
           PERFORM CLOSE-USER-PGM
      *    After Close
           .

       CLOSE-USER.
      * <TOTEM:EPT. INIT:gest-pwd, FD:USER, BeforeClose>
      * <TOTEM:END>
           CLOSE USER
           .

       CLOSE-USER-PGM1.
      * <TOTEM:EPT. INIT:gest-pwd, FD:USER-PGM1, BeforeClose>
      * <TOTEM:END>
           CLOSE USER-PGM1
           .

       CLOSE-USER-PGM.
      * <TOTEM:EPT. INIT:gest-pwd, FD:USER-PGM, BeforeClose>
      * <TOTEM:END>
           CLOSE USER-PGM
           .

       DataSet1-USER-INITSTART.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-USER-KEY1-Asc
                 MOVE Low-Value TO user-chiave
              ELSE
                 MOVE High-Value TO user-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-USER-INITEND.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-USER-KEY1-Asc
                 MOVE High-Value TO user-chiave
              ELSE
                 MOVE Low-Value TO user-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           .   

       DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-USER-KEY1-ORDER
           END-EVALUATE
           .

       DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-USER-KEY1-ORDER
           END-EVALUATE
           .

      * USER
       DataSet1-USER-START.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-USER-KEY1-Asc
                 START USER KEY >= user-chiave
              ELSE
                 START USER KEY <= user-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-USER-START-NOTGREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-USER-KEY1-Asc
                 START USER KEY <= user-chiave
              ELSE
                 START USER KEY >= user-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-USER-START-GREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-USER-KEY1-Asc
                 START USER KEY > user-chiave
              ELSE
                 START USER KEY < user-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-USER-START-LESS.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-USER-KEY1-Asc
                 START USER KEY < user-chiave
              ELSE
                 START USER KEY > user-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-USER-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:USER, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:USER, BeforeReadRecord>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-USER-LOCK
                 READ USER WITH LOCK 
                 KEY user-chiave
              ELSE
                 READ USER WITH NO LOCK 
                 KEY user-chiave
              END-IF
           END-EVALUATE
           MOVE STATUS-USER TO TOTEM-ERR-STAT 
           MOVE "USER" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:USER, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:USER, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-USER-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:USER, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:USER, BeforeReadNext>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-USER-KEY1-Asc
                 IF DataSet1-USER-LOCK
                    READ USER NEXT WITH LOCK
                 ELSE
                    READ USER NEXT WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-USER-LOCK
                    READ USER PREVIOUS WITH LOCK
                 ELSE
                    READ USER PREVIOUS WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           MOVE STATUS-USER TO TOTEM-ERR-STAT
           MOVE "USER" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:USER, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:USER, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-USER-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:USER, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:USER, BeforeReadPrev>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-USER-KEY1-Asc
                 IF DataSet1-USER-LOCK
                    READ USER PREVIOUS WITH LOCK
                 ELSE
                    READ USER PREVIOUS WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-USER-LOCK
                    READ USER NEXT WITH LOCK
                 ELSE
                    READ USER NEXT WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           MOVE STATUS-USER TO TOTEM-ERR-STAT
           MOVE "USER" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:USER, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:USER, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-USER-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:USER, BeforeWrite>
      * <TOTEM:END>
           WRITE user-rec OF USER.
           MOVE STATUS-USER TO TOTEM-ERR-STAT
           MOVE "USER" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:USER, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-USER-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:USER, BeforeRewrite>
      * <TOTEM:END>
           REWRITE user-rec OF USER.
           MOVE STATUS-USER TO TOTEM-ERR-STAT
           MOVE "USER" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:USER, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-USER-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:USER, BeforeDelete>
      * <TOTEM:END>
           DELETE USER.
           MOVE STATUS-USER TO TOTEM-ERR-STAT
           MOVE "USER" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:USER, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-USER-PGM1-INITSTART.
           IF DataSet1-USER-PGM1-KEY-Asc
              MOVE Low-Value TO UP-CHIAVE OF USER-PGM1
           ELSE
              MOVE High-Value TO UP-CHIAVE OF USER-PGM1
           END-IF
           .

       DataSet1-USER-PGM1-INITEND.
           IF DataSet1-USER-PGM1-KEY-Asc
              MOVE High-Value TO UP-CHIAVE OF USER-PGM1
           ELSE
              MOVE Low-Value TO UP-CHIAVE OF USER-PGM1
           END-IF
           .

      * USER-PGM1
       DataSet1-USER-PGM1-START.
           IF DataSet1-USER-PGM1-KEY-Asc
              START USER-PGM1 KEY >= UP-CHIAVE OF USER-PGM1
           ELSE
              START USER-PGM1 KEY <= UP-CHIAVE OF USER-PGM1
           END-IF
           .

       DataSet1-USER-PGM1-START-NOTGREATER.
           IF DataSet1-USER-PGM1-KEY-Asc
              START USER-PGM1 KEY <= UP-CHIAVE OF USER-PGM1
           ELSE
              START USER-PGM1 KEY >= UP-CHIAVE OF USER-PGM1
           END-IF
           .

       DataSet1-USER-PGM1-START-GREATER.
           IF DataSet1-USER-PGM1-KEY-Asc
              START USER-PGM1 KEY > UP-CHIAVE OF USER-PGM1
           ELSE
              START USER-PGM1 KEY < UP-CHIAVE OF USER-PGM1
           END-IF
           .

       DataSet1-USER-PGM1-START-LESS.
           IF DataSet1-USER-PGM1-KEY-Asc
              START USER-PGM1 KEY < UP-CHIAVE OF USER-PGM1
           ELSE
              START USER-PGM1 KEY > UP-CHIAVE OF USER-PGM1
           END-IF
           .

       DataSet1-USER-PGM1-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:USER-PGM1, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:USER-PGM1, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-USER-PGM1-LOCK
              READ USER-PGM1 WITH LOCK 
              KEY UP-CHIAVE OF USER-PGM1
           ELSE
              READ USER-PGM1 WITH NO LOCK 
              KEY UP-CHIAVE OF USER-PGM1
           END-IF
           MOVE STATUS-user-pgm-USER-PGM1 TO TOTEM-ERR-STAT 
           MOVE "USER-PGM1" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:USER-PGM1, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:USER-PGM1, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-USER-PGM1-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:USER-PGM1, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:USER-PGM1, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-USER-PGM1-KEY-Asc
              IF DataSet1-USER-PGM1-LOCK
                 READ USER-PGM1 NEXT WITH LOCK
              ELSE
                 READ USER-PGM1 NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-USER-PGM1-LOCK
                 READ USER-PGM1 PREVIOUS WITH LOCK
              ELSE
                 READ USER-PGM1 PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-user-pgm-USER-PGM1 TO TOTEM-ERR-STAT
           MOVE "USER-PGM1" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:USER-PGM1, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:USER-PGM1, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-USER-PGM1-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:USER-PGM1, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:USER-PGM1, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-USER-PGM1-KEY-Asc
              IF DataSet1-USER-PGM1-LOCK
                 READ USER-PGM1 PREVIOUS WITH LOCK
              ELSE
                 READ USER-PGM1 PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-USER-PGM1-LOCK
                 READ USER-PGM1 NEXT WITH LOCK
              ELSE
                 READ USER-PGM1 NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-user-pgm-USER-PGM1 TO TOTEM-ERR-STAT
           MOVE "USER-PGM1" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:USER-PGM1, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:USER-PGM1, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-USER-PGM1-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:USER-PGM1, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-user-pgm-USER-PGM1 TO TOTEM-ERR-STAT
           MOVE "USER-PGM1" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:USER-PGM1, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-USER-PGM1-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:USER-PGM1, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-user-pgm-USER-PGM1 TO TOTEM-ERR-STAT
           MOVE "USER-PGM1" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:USER-PGM1, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-USER-PGM1-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:USER-PGM1, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-user-pgm-USER-PGM1 TO TOTEM-ERR-STAT
           MOVE "USER-PGM1" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:USER-PGM1, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-USER-PGM-INITSTART.
           IF DataSet1-USER-PGM-KEY-Asc
              MOVE Low-Value TO UP-CHIAVE OF USER-PGM
           ELSE
              MOVE High-Value TO UP-CHIAVE OF USER-PGM
           END-IF
           .

       DataSet1-USER-PGM-INITEND.
           IF DataSet1-USER-PGM-KEY-Asc
              MOVE High-Value TO UP-CHIAVE OF USER-PGM
           ELSE
              MOVE Low-Value TO UP-CHIAVE OF USER-PGM
           END-IF
           .

      * USER-PGM
       DataSet1-USER-PGM-START.
           IF DataSet1-USER-PGM-KEY-Asc
              START USER-PGM KEY >= UP-CHIAVE OF USER-PGM
           ELSE
              START USER-PGM KEY <= UP-CHIAVE OF USER-PGM
           END-IF
           .

       DataSet1-USER-PGM-START-NOTGREATER.
           IF DataSet1-USER-PGM-KEY-Asc
              START USER-PGM KEY <= UP-CHIAVE OF USER-PGM
           ELSE
              START USER-PGM KEY >= UP-CHIAVE OF USER-PGM
           END-IF
           .

       DataSet1-USER-PGM-START-GREATER.
           IF DataSet1-USER-PGM-KEY-Asc
              START USER-PGM KEY > UP-CHIAVE OF USER-PGM
           ELSE
              START USER-PGM KEY < UP-CHIAVE OF USER-PGM
           END-IF
           .

       DataSet1-USER-PGM-START-LESS.
           IF DataSet1-USER-PGM-KEY-Asc
              START USER-PGM KEY < UP-CHIAVE OF USER-PGM
           ELSE
              START USER-PGM KEY > UP-CHIAVE OF USER-PGM
           END-IF
           .

       DataSet1-USER-PGM-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:USER-PGM, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:USER-PGM, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-USER-PGM-LOCK
              READ USER-PGM WITH LOCK 
              KEY UP-CHIAVE OF USER-PGM
           ELSE
              READ USER-PGM WITH NO LOCK 
              KEY UP-CHIAVE OF USER-PGM
           END-IF
           MOVE STATUS-user-pgm TO TOTEM-ERR-STAT 
           MOVE "USER-PGM" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:USER-PGM, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:USER-PGM, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-USER-PGM-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:USER-PGM, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:USER-PGM, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-USER-PGM-KEY-Asc
              IF DataSet1-USER-PGM-LOCK
                 READ USER-PGM NEXT WITH LOCK
              ELSE
                 READ USER-PGM NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-USER-PGM-LOCK
                 READ USER-PGM PREVIOUS WITH LOCK
              ELSE
                 READ USER-PGM PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-user-pgm TO TOTEM-ERR-STAT
           MOVE "USER-PGM" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:USER-PGM, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:USER-PGM, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-USER-PGM-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:USER-PGM, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:USER-PGM, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-USER-PGM-KEY-Asc
              IF DataSet1-USER-PGM-LOCK
                 READ USER-PGM PREVIOUS WITH LOCK
              ELSE
                 READ USER-PGM PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-USER-PGM-LOCK
                 READ USER-PGM NEXT WITH LOCK
              ELSE
                 READ USER-PGM NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-user-pgm TO TOTEM-ERR-STAT
           MOVE "USER-PGM" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:USER-PGM, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:USER-PGM, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-USER-PGM-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:USER-PGM, BeforeWrite>
      * <TOTEM:END>
           WRITE UP-RECORD OF USER-PGM.
           MOVE STATUS-user-pgm TO TOTEM-ERR-STAT
           MOVE "USER-PGM" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:USER-PGM, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-USER-PGM-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:USER-PGM, BeforeRewrite>
      * <TOTEM:END>
           REWRITE UP-RECORD OF USER-PGM.
           MOVE STATUS-user-pgm TO TOTEM-ERR-STAT
           MOVE "USER-PGM" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:USER-PGM, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-USER-PGM-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:USER-PGM, BeforeDelete>
      * <TOTEM:END>
           DELETE USER-PGM.
           MOVE STATUS-user-pgm TO TOTEM-ERR-STAT
           MOVE "USER-PGM" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:USER-PGM, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-INIT-RECORD.
           INITIALIZE user-rec OF USER
           INITIALIZE UP-RECORD OF USER-PGM1
           INITIALIZE UP-RECORD OF USER-PGM
           .


      * COMBO-BOX
       cbo-office-Content.
           .

      * COMBO-BOX
       cbo-SO-Content.
           .

      * FD's Initialize Paragraph
       DataSet1-USER-INITREC.
           INITIALIZE user-rec OF USER
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-USER-PGM1-INITREC.
           INITIALIZE UP-RECORD OF USER-PGM1
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-USER-PGM-INITREC.
           INITIALIZE UP-RECORD OF USER-PGM
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      *
       DataSet1-DISPATCH-BUFTOFLD.
           EVALUATE TOTEM-Form-Index ALSO TOTEM-Frame-Index
              WHEN 1 ALSO 0
                  PERFORM Form1-Buf-To-Fld
           END-EVALUATE
           .

       Form1-DISPLAY-STATUS-MSG.
            MODIFY Form1-St-1-Handle PANEL-INDEX = 1
                PANEL-TEXT = TOTEM-HINT-TEXT
           .

       Form1-CLEAR-STATUS-MSG.
           MOVE SPACES TO TOTEM-MSG-1, TOTEM-MSG-2, TOTEM-MSG-3, 
           TOTEM-MSG-TEXT
           PERFORM Form1-DISPLAY-STATUS-MSG
           .

       Form1-Open-Routine.
           PERFORM Form1-Scrn
           PERFORM Form1-Proc
           .

       Form1-Scrn.
           PERFORM Form1-Create-Win
           PERFORM Form1-Init-Value
           PERFORM Form1-Init-Data
      * Tab keystrok settings
      * Tool Bar
           DISPLAY Form1-Tb-1
           PERFORM Form1-DISPLAY
           .

       Form1-Create-Win.
           Display Independent GRAPHICAL WINDOW
              LINES win-lines,
              SIZE 46,80,
              CELL HEIGHT 18,
              CELL WIDTH 10,
              COLOR 65793,
              CONTROL FONT Verdana12-Occidentale,
              LABEL-OFFSET 23,
              LINK TO THREAD,
              MODELESS,
              NO SCROLL,
              TITLE-BAR,
              TITLE titolo,
              AUTO-MINIMIZE,
              WITH SYSTEM MENU,
              USER-GRAY,
           VISIBLE 0,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE Form1-Event-Proc,
              HANDLE IS Form1-Handle,
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
           DISPLAY TOOL-BAR 
              CELL HEIGHT 18, CELL WIDTH 10, 
              LINES 1,94 CELLS,   
              HANDLE IN Form1-Tb-1-Handle
           DISPLAY Form1-Tb-1 UPON Form1-Tb-1-Handle

      * Status-bar
           DISPLAY STATUS-BAR
              GRIP,
              PANEL-WIDTHS 47,
              PANEL-STYLE  1,
              PANEL-TEXT   (SPACE),
              HANDLE IS Form1-St-1-Handle
           DISPLAY Form1 UPON Form1-Handle
      * DISPLAY-COLUMNS settings
           .

       Form1-PROC.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeAccept>
           move 0 to v-cancella v-boss-salvato.
           set vecchio to true.
           if user-codi = "BOSS"
              move  1 to v-boss
              move  1 to e-id
              move  0 to e-pwd
              move  1 to v-scorr
              move  3 to BitmapNumChange BitmapNumScad
              move 16 to BitmapNumDelete
              move  1 to v-cancella
           else
              move 0 to v-boss
              move 0 to e-id
              move 1 to e-pwd
              move 1 to BitmapNumChange BitmapNumScad
              move 0 to v-cancella
           end-if.
           display tool-primo 
                   tool-successivo 
                   tool-precedente 
                   tool-ultimo
                   tool-cancella.

           move 5,2 to win-lines.
           modify form1-handle lines win-lines.

           move 0 to e-salva.

           move 15 to BitmapNumSave.
           move  5 to BitmapNumEdit.

           move user-codi to user-id.

           display form1.

           display tool-salva.

           move user-codi to user-cod.
           read user no lock invalid continue end-read.
           modify form1-handle, visible true.

           modify cbo-office, reset-list = 1.
           modify cbo-office, item-to-add = "2003".
           modify cbo-office, item-to-add = "2007". 
           modify cbo-office, item-to-add = "2010".

           modify cbo-SO,     reset-list = 1.
           modify cbo-SO,     item-to-add = "XP".
           modify cbo-SO,     item-to-add = "Vista".
           modify cbo-SO,     item-to-add = "7".

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT Form1
                 ON EXCEPTION
                    PERFORM Form1-Evaluate-Func
                 MOVE 1 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY Form1-Handle
           INITIALIZE Key-Status
           .

       Form1-Evaluate-Func.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM Form1-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM Form1-Exit
                 END-IF
              WHEN Key-Status = 1001
                 PERFORM pb-cambio-LinkTo
              WHEN Key-Status = 1005
                 PERFORM pb-scadute-LinkTo
              WHEN Key-Status = 1000
                 PERFORM Form1-Pb-1-LinkTo
              WHEN Key-Status = 1004
                 PERFORM pb-importa-LinkTo
              WHEN Key-Status = 1006
                 PERFORM pb-scheda-LinkTo
              WHEN Key-Status = 27
                 PERFORM PB-ESCI-LinkTo
              WHEN Key-Status = 3
                 PERFORM PB-SALVA-LinkTo
              WHEN Key-Status = 4
                 PERFORM TOOL-CANCELLA-LinkTo
              WHEN Key-Status = 1002
                 PERFORM TOOL-PRIMO-LinkTo
              WHEN Key-Status = 67
                 PERFORM TOOL-PRECEDENTE-LinkTo
              WHEN Key-Status = 68
                 PERFORM TOOL-SUCCESSIVO-LinkTo
              WHEN Key-Status = 1003
                 PERFORM TOOL-ULTIMO-LinkTo
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       Form1-CLEAR.
           PERFORM Form1-INIT-VALUE
           PERFORM Form1-DISPLAY
           .

       Form1-DISPLAY.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY Form1-Tb-1
           DISPLAY Form1 UPON Form1-Handle
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterDisplay>
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       Form1-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeExit>
           if win-lines = 23,00
              display message "Uscire dalla modifica dati?"
                        title titolo
                         type mb-yes-no
                       giving scelta
                      default mb-no
              if scelta = mb-yes
                 perform TORNA-IN-VISUA
              end-if
              move 26 to key-status
              exit paragraph
           end-if.

           .
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       Form1-Init-Data.
           MOVE 1 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
      * COMBO-BOX
           PERFORM cbo-office-Content
      * COMBO-BOX
           PERFORM cbo-SO-Content
           .

       Form1-DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-USER-KEY1-ORDER
           END-EVALUATE
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-USER-KEY1-ORDER
           END-EVALUATE
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Update-Key.
           MOVE user-rec OF USER TO
                     Form1-MULKEY-TMPBUF
           PERFORM Form1-CLEAR
           PERFORM Form1-INIT-DATA
           MOVE Form1-MULKEY-TMPBUF TO
                     user-rec OF USER
           PERFORM DataSet1-USER-Read
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-CURR
           PERFORM Form1-IUD-Display
           .

       Form1-DUPLICATE-MOVEKEY.
           .

       Form1-First.
           PERFORM Form1-DUMMY-FIRST
           PERFORM DataSet1-USER-INITSTART
           PERFORM DataSet1-USER-START
           IF NOT VALID-STATUS-USER
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeFirst>
      * <TOTEM:END>
           PERFORM DataSet1-USER-Read-Next
           IF NOT VALID-STATUS-USER
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterFirst>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY.
           PERFORM Form1-IUD-Display
           .

       Form1-Previous.
              PERFORM Form1-Buf-To-Fld
              PERFORM DataSet1-USER-START-LESS
           IF NOT VALID-STATUS-USER
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforePrevious>
      * <TOTEM:END>
           PERFORM DataSet1-USER-Read-Prev
           IF NOT VALID-STATUS-USER
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterPrevious>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-PREVIOUS
           PERFORM Form1-IUD-Display
           .

       Form1-Next.
              PERFORM Form1-Buf-To-Fld
              PERFORM DataSet1-USER-START-GREATER
           IF NOT VALID-STATUS-USER
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeNext>
      * <TOTEM:END>
           PERFORM DataSet1-USER-Read-Next
           IF NOT VALID-STATUS-USER
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterNext>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-NEXT
           PERFORM Form1-IUD-Display
           .
      
       Form1-Last.
           PERFORM Form1-DUMMY-LAST
           PERFORM DataSet1-USER-INITEND
           PERFORM DataSet1-USER-START-NOTGREATER
           IF NOT VALID-STATUS-USER
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeLast>
      * <TOTEM:END>
           PERFORM DataSet1-USER-Read-Prev
           IF NOT VALID-STATUS-USER
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterLast>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY.
           PERFORM Form1-IUD-Display
           .

       Form1-Curr.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeCurrent>
      * <TOTEM:END>
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-USER-Read
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-CURR
           PERFORM Form1-IUD-Display
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterCurrent>
      * <TOTEM:END>
           .

       Form1-IUD-Display.
           IF VALID-STATUS-USER
              PERFORM Form1-ALLGRID-RESET
              PERFORM Form1-Fld-To-Buf
              PERFORM Form1-NAVI-FOR-MASTERGRID
              PERFORM Form1-DISPLAY
           ELSE
              IF Form1-FLAG-REFRESH
                 CONTINUE
              ELSE
                 PERFORM Form1-Extended-File-Status
              END-IF
           END-IF
           .

       Form1-Add.
           PERFORM Form1-Buf-To-Fld
           PERFORM Form1-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM Form1-DUMMY-ADD
           PERFORM DataSet1-USER-INITREC
           PERFORM Form1-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeAdd>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-USER-Rec-Write
           IF VALID-STATUS-USER
              PERFORM Form1-RESUMMARY-INS
              PERFORM Form1-DUMMY-UPDATE-INIT
              MOVE "301" TO TOTEM-MSG-ID
              PERFORM Form1-IUD-Display
           END-IF
           PERFORM Form1-ERR-CHECKING
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterAdd>
      * <TOTEM:END>
           .
     
       Form1-Update.
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-USER-START              
           IF NOT VALID-STATUS-USER
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
           PERFORM DataSet1-USER-Read
           PERFORM Form1-Buf-To-Fld
           PERFORM Form1-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM Form1-DUMMY-UPDATE
           PERFORM Form1-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeUpdate>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-USER-Rec-Rewrite
           IF VALID-STATUS-USER
              PERFORM Form1-RESUMMARY-DEL
              PERFORM Form1-DUMMY-UPDATE-INIT
              MOVE "302" TO TOTEM-MSG-ID
              PERFORM Form1-IUD-Display
           END-IF
           PERFORM Form1-ERR-CHECKING
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterUpdate>
      * <TOTEM:END>
           .

       Form1-Delete.
           MOVE "203" TO TOTEM-MSG-ID
           PERFORM MESSAGE-BOX-DISPLAY
           IF TOTEM-MSG-RETURN-VALUE NOT = 1
              INITIALIZE TOTEM-MSG-TEXT
              EXIT PARAGRAPH 
           END-IF
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDelete>
      * <TOTEM:END>
           PERFORM Form1-DUMMY-DELETE
      * delete
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-USER-Rec-Delete
           IF VALID-STATUS-USER
              PERFORM Form1-CLEAR
              PERFORM Form1-DUMMY-DELETE-INIT
              MOVE "303" TO TOTEM-MSG-ID
              MOVE "00" to STATUS-USER
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterDelete>
      * <TOTEM:END>
           PERFORM Form1-ERR-CHECKING
           .

       Form1-NAVI-FOR-MASTERGRID.
           .

       Form1-ERR-CHECKING.
           IF VALID-STATUS-USER
              PERFORM Form1-SHOW-MSG-ROUTINE
           ELSE
              PERFORM Form1-Extended-File-Status
           END-IF
           .

       Form1-RESUMMARY-INS.
           .

       Form1-RESUMMARY-DEL.
           .


       Form1-DUMMY-FIRST.
           .

       Form1-DUMMY-PREVIOUS.
           .

       Form1-DUMMY-NEXT.
           .

       Form1-DUMMY-LAST.
           .

       Form1-DUMMY-CURR.
           .

       Form1-DUMMY-ADD.
           .

       Form1-DUMMY-UPDATE.
           .

       Form1-DUMMY-UPDATE-INIT.
           .

       Form1-DUMMY-DELETE.
           .

       Form1-DUMMY-DELETE-INIT.
           .

       Form1-Init-Value.
           MOVE titolo TO TOTEM-MSG-TITLE
           INITIALIZE Form1-BUF
      * FORM : Form1
           PERFORM DataSet1-INIT-RECORD
      * DB_CHECK BOX
              MOVE 0 TO user-msg-promo
      * DB_CHECK BOX
              MOVE 0 TO user-msg-banner-t
      * DB_CHECK BOX
              MOVE 0 TO user-msg-banner-g
      * DB_CHECK BOX
              MOVE 0 TO user-ev-man
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, SetDefault>
      * <TOTEM:END>
           PERFORM Form1-FLD-TO-BUF
           .


       Form1-ALLGRID-RESET.
           .

      * for Form's Validation
       Form1-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       Form1-Buf-To-Fld.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeBufToFld>
      * <TOTEM:END>
      * DB_CHECK BOX : chk-msg
              IF chk-msg-BUF = 1
                 MOVE 1 TO user-msg-promo
              ELSE
                 MOVE 0 TO user-msg-promo
              END-IF
      * DB_CHECK BOX : chk-banner-t
              IF chk-banner-t-BUF = 1
                 MOVE 1 TO user-msg-banner-t
              ELSE
                 MOVE 0 TO user-msg-banner-t
              END-IF
      * DB_CHECK BOX : chk-banner-g
              IF chk-banner-g-BUF = 1
                 MOVE 1 TO user-msg-banner-g
              ELSE
                 MOVE 0 TO user-msg-banner-g
              END-IF
      * DB_CHECK BOX : chk-ev-man
              IF chk-ev-man-BUF = 1
                 MOVE 1 TO user-ev-man
              ELSE
                 MOVE 0 TO user-ev-man
              END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterBufToFld>
      * <TOTEM:END>
           .

       Form1-Fld-To-Buf.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeFldToBuf>
      * <TOTEM:END>
      * DB_CHECK BOX : chk-msg
              IF user-msg-promo = 1
                 MOVE 1 TO chk-msg-BUF
              ELSE
                 MOVE 0 TO chk-msg-BUF
              END-IF
      * DB_CHECK BOX : chk-banner-t
              IF user-msg-banner-t = 1
                 MOVE 1 TO chk-banner-t-BUF
              ELSE
                 MOVE 0 TO chk-banner-t-BUF
              END-IF
      * DB_CHECK BOX : chk-banner-g
              IF user-msg-banner-g = 1
                 MOVE 1 TO chk-banner-g-BUF
              ELSE
                 MOVE 0 TO chk-banner-g-BUF
              END-IF
      * DB_CHECK BOX : chk-ev-man
              IF user-ev-man = 1
                 MOVE 1 TO chk-ev-man-BUF
              ELSE
                 MOVE 0 TO chk-ev-man-BUF
              END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterFldToBuf>
      * <TOTEM:END>
           .

       Form1-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform Form1-BUF-TO-FLD.
           move 0 to scelta.
           .
       Form1-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM Form1-SHOW-MSG-ROUTINE
           .

       Form1-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM Form1-DISPLAY-MESSAGE
           .

       Form1-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       Form1-Save-Status.
           MOVE DataSet1-USER-KEY1-ORDER TO TMP-Form1-KEY1-ORDER
           MOVE DataSet1-KEYIS TO TMP-Form1-KEYIS
           MOVE user-rec OF USER TO 
              TMP-Form1-USER-RESTOREBUF
           .             

       Form1-Restore-Status.
           MOVE TMP-Form1-KEY1-ORDER TO DataSet1-USER-KEY1-ORDER
           MOVE TMP-Form1-KEYIS TO DataSet1-KEYIS
           MOVE TMP-Form1-USER-RESTOREBUF TO
              user-rec OF USER
           PERFORM DataSet1-USER-START
           IF VALID-STATUS-USER
              PERFORM DataSet1-USER-Read-Next
           ELSE
              PERFORM DataSet1-USER-INITREC
           END-IF
           PERFORM UNTIL NOT VALID-STATUS-USER OR
              (VALID-STATUS-USER AND
                 user-rec OF USER = 
                   TMP-Form1-USER-RESTOREBUF)
              PERFORM DataSet1-USER-Read-Next
           END-PERFORM
           .



       Form1-BeforeProcedure.
           EVALUATE Control-Id
           WHEN 5001 MOVE "User ID" to TOTEM-HINT-TEXT
           WHEN 5002 MOVE "Digitare la password" to TOTEM-HINT-TEXT
           WHEN 5003 MOVE "Digitare la descrizione" to TOTEM-HINT-TEXT
           WHEN 5004 MOVE "Digitare la descrizione" to TOTEM-HINT-TEXT
           WHEN 5005 MOVE "Digitare la nuova password" to 
           TOTEM-HINT-TEXT
           WHEN 5006 MOVE "Confermare la password" to TOTEM-HINT-TEXT
           WHEN 5010 MOVE "Se impostata verrà usata come PATH_INI" to 
           TOTEM-HINT-TEXT
           WHEN 680 MOVE "Se impostata verrà usata come PATH_INI" to 
           TOTEM-HINT-TEXT
           WHEN OTHER MOVE SPACES TO TOTEM-HINT-TEXT
           END-EVALUATE
           EVALUATE Control-Id
           When 5001 PERFORM EF-id-BeforeProcedure
           When 5002 PERFORM EF-OLD-PASS-BeforeProcedure
           When 5003 PERFORM ef-nome-BeforeProcedure
           When 5004 PERFORM ef-nome-BeforeProcedure
           When 5005 PERFORM EF-NEW-PASS-BeforeProcedure
           When 5006 PERFORM EF-PASS-BeforeProcedure
           When 5010 PERFORM EF-NEW-PASS-BeforeProcedure
           When 680 PERFORM EF-NEW-PASS-BeforeProcedure
           END-EVALUATE
           PERFORM Form1-DISPLAY-STATUS-MSG
           .

       Form1-AfterProcedure.
           EVALUATE Control-Id
           When 27 PERFORM Form1-DaCb-1-AfterProcedure
           When 28 PERFORM Form1-DaCb-1-AfterProcedure
           When 29 PERFORM Form1-DaCb-1-AfterProcedure
           When 5009 PERFORM Form1-DaCb-1-AfterProcedure
           END-EVALUATE
           .

       Form1-Event-Proc.
           .

      * USER DEFINE PARAGRAPH
       AGGIUNGI-6-MESI.
      * <TOTEM:PARA. AGGIUNGI-6-MESI>
           move user-pass-data to como-data.
           move como-data(1:4) to anno.
           move como-data(5:2) to mese.
           move como-data(7:2) to giorno.
           add  6 to mese.

           if mese > 12
              subtract 12 from mese
              add 1 to anno
           end-if.

           if mese = 2
              divide        anno by 4 giving como-anno
              multiply como-anno by 4 giving como-anno
              if como-anno = anno
                 set bisestile to true
              else
                 set bisestile to false
              end-if
              evaluate true
              when giorno >= 29
                   if bisestile
                      move 29 to giorno
                   else
                      move 28 to giorno
                   end-if
              end-evaluate
           else
              if giorno = 31
                 evaluate mese
                 when  4
                 when  6
                 when  9
                 when 11  move 30 to giorno
                 end-evaluate
              end-if
           end-if.

           move data-validita to como-data.
           perform DATE-TO-SCREEN.
           move como-data to validita.
           display lab-validita 
           .
      * <TOTEM:END>

       CANCELLA.
      * <TOTEM:PARA. CANCELLA>
           display message "Cancellare l'utente in uso?"
                     title titolo
                      type mb-yes-no
                    giving scelta
                   default mb-no.

           if scelta = mb-yes
              inquire ef-id, value in user-cod
              delete user record invalid continue end-delete

              move low-value to up-chiave  of user-pgm
              move user-cod  to up-user-id of user-pgm
              start user-pgm key is >= up-chiave of user-pgm
                    invalid continue
                not invalid
                    perform until 1 = 2
                       read user-pgm next no lock at end exit perform 
           end-read
                       if up-user-id of user-pgm not = user-cod
                          exit perform
                       end-if
                       delete user-pgm record invalid continue 
           end-delete
                    end-perform
              end-start
              perform TORNA-IN-VISUA
              move user-codi to user-id
              display ef-id
           end-if 
           .
      * <TOTEM:END>

       CONTROLLO.
      * <TOTEM:PARA. CONTROLLO>
           set tutto-ok to true.

           evaluate control-id
           when 78-ID-ef-id
                inquire ef-id, value in user-cod
                read user no lock
                     invalid
                     if user-codi not = "BOSS"
                        display message "Utente NON valido"
                                  title tit-err
                                   icon 2
                        move 0 to e-pwd
                        move 3 to BitmapNumChange BitmapNumScad
                        set errori to true
                     else
                        display message "Utente non trovato. Inserirlo?"
                                  title titolo
                                   type mb-yes-no
                                 giving scelta
                        if scelta = mb-no      
                           move 0 to e-pwd
                           move 3 to BitmapNumChange BitmapNumScad
                           set errori to true
                        else
                           set nuovo to true
                           perform PORTA-IN-MODIFICA
                        end-if
                     end-if
                 not invalid
                     set vecchio to true
                     move 1 to e-pwd
                     move 1 to BitmapNumChange BitmapNumScad
                end-read
                move spaces to old-pass
                display form1

           when 78-ID-ef-old-pass
                inquire ef-old-pass, value in old-pass
                if old-pass not = user-pass
                   set errori to true
                   display message "Password errata!"
                             title tit-err
                              icon 2
                end-if

           when 78-ID-ef-new-pass
                inquire ef-new-pass, value in new-pass
                if new-pass not = spaces
                   if new-pass = old-pass
                      set errori to true
                      display message "La nuova password dev'essere dive
      -    "rsa da quella vecchia"
                                title tit-err
                                 icon 2
                   else
                      move 0 to Counter
                      move new-pass to como-pwd
                      inspect como-pwd 
                              replacing trailing spaces by low-value
                      inspect como-pwd
                              tallying counter 
                              for characters before low-value
                      if counter < 8
                         set errori to true
                         display message "La password deve contenere alm
      -    "eno 8 caratteri"
                                   title tit-err
                                    icon 2
                      end-if
                   end-if
                else
                   if nuovo
                      set errori to true
                      display message "Inserire la password"
                                title tit-err
                                 icon 2
                   end-if
                end-if

           when 78-ID-ef-pass
                inquire ef-pass,     value in pass
                inquire ef-new-pass, value in new-pass
                if new-pass = spaces
                   move spaces to pass
                   modify ef-pass, value pass
                else
                   if pass not = new-pass
                      set errori to true
                      display message "Conferma passowrd errata"
                                title tit-err
                                 icon 2
                   end-if
                end-if

           end-evaluate.

           if errori
              perform CANCELLA-COLORE
              move 4        to accept-control
           end-if 
           .
      * <TOTEM:END>

       PARAGRAFO-COPY.
      * <TOTEM:PARA. PARAGRAFO-COPY>
           copy "color-custom.cpy".
           copy "utydata.cpy" 
           .
      * <TOTEM:END>

       PORTA-IN-MODIFICA.
      * <TOTEM:PARA. PORTA-IN-MODIFICA>
           move 35,00 to win-lines.
           modify form1-handle, lines win-lines.
           move 0 to e-pwd.
           move 3 to BitmapNumChange BitmapNumScad.
           move 0 to e-id.
           move 1 to BitmapNumModuli BitmapNumImporta BitmapNumScheda.
           move 1 to e-altri.                                 

           move "2003"    to cbo-office-buf.
           move "XP"      to cbo-SO-buf.

           if vecchio
              move user-pass-data    to como-data
              move user-name         to descr
              move user-msg-promo    to chk-msg-buf
              move user-msg-banner-t to chk-banner-t-buf
              move user-msg-banner-g to chk-banner-g-buf
              move user-ev-man       to chk-ev-man-buf     
              move user-path-bullzip to ef-path-bullzip-buf
              move user-path-acuthin to ef-path-acuthin-buf
              move user-tel-diretto  to tel-dir
              evaluate true
              when user-office-2003 move "2003" to cbo-office-buf
              when user-office-2007 move "2007" to cbo-office-buf
              when user-office-2010 move "2010" to cbo-office-buf
              end-evaluate
              evaluate true
              when user-SO-XP      move "XP"    to cbo-SO-buf
              when user-SO-Vista   move "Vista" to cbo-SO-buf
              when user-SO-7       move "7"     to cbo-SO-buf
              end-evaluate
           else
              move 0 to chk-msg-buf
                        chk-banner-t-buf
                        chk-banner-g-buf
              move spaces to descr 
                             tel-dir
                             pass 
                             new-pass
              accept como-data from century-date
              move   como-data to user-pass-data
           end-if.
           modify cbo-office,    value cbo-office-buf.
           modify cbo-SO,        value cbo-SO-buf.

           perform DATE-TO-SCREEN.
           move como-data to data-pass.
           perform AGGIUNGI-6-MESI.
           move 1 to e-salva.
           move 3 to BitmapNumSave.
           display tool-salva.

           if user-codi = "BOSS"
              if user-id not = "BOSS"
                 move  1 to e-cancella
                 move  4 to BitmapNumDelete
                 display tool-cancella
              end-if
              if vecchio
                 move 1 to v-boss-salvato
              else
                 move 0 to v-boss-salvato
              end-if
              move 0 to e-scorr
              display tool-primo
                      tool-successivo
                      tool-precedente
                      tool-ultimo
           end-if.

           move 78-ID-ef-nome to control-id.
           move 4             to accept-control 
           .
      * <TOTEM:END>

       SALVA.
      * <TOTEM:PARA. SALVA>
           set tutto-ok to true.

           perform varying control-id from 78-ID-ef-nome by 1
                     until control-id > 78-ID-ef-pass
              perform CONTROLLO
              if errori
                 exit perform
              end-if
           end-perform.

           if tutto-ok
              accept como-data from century-date
              accept como-ora  from time
              move user-id     to user-cod
              move descr       to user-name
              move tel-dir     to user-tel-diretto
              if pass = spaces
                 move old-pass to pass
              else
                 if user-codi not = "BOSS"
                    display message "Notificare al gestore delle passwor
      -    "d la modifica!"
                              title titolo
                 end-if
                 perform DATE-TO-SCREEN
                 move como-data to data-pass
              end-if
              move pass              to user-pass
              move data-pass         to como-data
              perform DATE-TO-FILE
              move como-data         to user-pass-data
              move chk-msg-buf       to user-msg-promo
              move chk-banner-t-buf  to user-msg-banner-t
              move chk-banner-g-buf  to user-msg-banner-g
              move chk-ev-man-buf    to user-ev-man

              evaluate cbo-office-buf
              when "2003" set user-office-2003 to true
              when "2007" set user-office-2007 to true
              when "2010" set user-office-2010 to true
              end-evaluate

              evaluate cbo-SO-buf
              when "XP"    set user-SO-XP    to true
              when "Vista" set user-SO-Vista to true
              when "7"     set user-SO-7     to true
              end-evaluate

              if nuovo
                 accept user-data-creazione from century-date
                 accept user-ora-creazione  from time
                 move   user-codi to user-utente-creazione
              else
                 accept user-data-ultima-modifica from century-date
                 accept user-ora-ultima-modifica  from time
                 move   user-codi to user-utente-ultima-modifica
              end-if

              move ef-path-bullzip-buf to user-path-bullzip
              move ef-path-acuthin-buf to user-path-acuthin
              write user-rec invalid rewrite user-rec end-write
              perform TORNA-IN-VISUA
           end-if 
           .
      * <TOTEM:END>

       TORNA-IN-VISUA.
      * <TOTEM:PARA. TORNA-IN-VISUA>
           modify ef-nome,     color colore-or.
           modify ef-new-pass, color colore-or.
           modify ef-pass,     color colore-or.

           move 0 to e-salva.
           move spaces to old-pass descr new-pass pass.
           if user-codi = "BOSS"
              move 1 to e-id
              move 0 to e-pwd
              move 3 to BitmapNumChange BitmapNumScad
           else
              move 0 to e-id
              move 1 to e-pwd
              move 1 to BitmapNumChange BitmapNumScad
           end-if.
           move 6,4 to win-lines.
           modify form1-handle, lines win-lines.
           move 0 to e-altri.
           display form1.
           move 78-ID-ef-id to control-id.
           move  4 to accept-control.
           move 15 to BitmapNumSave.
           display tool-salva.
           if user-codi = "BOSS" 
              if user-id not = "BOSS"
                 move  0 to e-cancella
                 move 16 to BitmapNumDelete
                 display tool-cancella
              end-if
              move 1 to e-scorr
              display tool-primo 
                      tool-successivo 
                      tool-precedente 
                      tool-ultimo
           end-if.
           perform CANCELLA-COLORE.

           unlock user all records 
           .
      * <TOTEM:END>

      * EVENT PARAGRAPH
       PB-SALVA-LinkTo.
      * <TOTEM:PARA. PB-SALVA-LinkTo>
           inquire tool-salva, enabled in e-salva.
           if e-salva = 1
              perform SALVA
           end-if 
           .
      * <TOTEM:END>
       PB-ESCI-LinkTo.
      * <TOTEM:PARA. PB-ESCI-LinkTo>
           .
      * <TOTEM:END>
       EF-PASS-BeforeProcedure.
      * <TOTEM:PARA. EF-PASS-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       EF-NEW-PASS-BeforeProcedure.
      * <TOTEM:PARA. EF-NEW-PASS-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       EF-OLD-PASS-BeforeProcedure.
      * <TOTEM:PARA. EF-OLD-PASS-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       I-O-BLOCCO.
      * <TOTEM:PARA. I-O-BLOCCO>
           SET LK-BL-CANCELLAZIONE TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM 
           .
      * <TOTEM:END>
       Gest-Pwd-Ev-Before-Program.
      * <TOTEM:PARA. Gest-Pwd-Ev-Before-Program>
           move LK-BL-PROG-ID    TO COMO-PROG-ID 
           .
      * <TOTEM:END>
       EF-OLD-PASS-AfterProcedure.
      * <TOTEM:PARA. EF-OLD-PASS-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO 
           .
      * <TOTEM:END>
       EF-NEW-PASS-AfterProcedure.
      * <TOTEM:PARA. EF-NEW-PASS-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO 
           .
      * <TOTEM:END>
       EF-PASS-AfterProcedure.
      * <TOTEM:PARA. EF-PASS-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO 
           .
      * <TOTEM:END>
       pb-cambio-BeforeProcedure.
      * <TOTEM:PARA. pb-cambio-BeforeProcedure>
           move 2 to BitmapNumChange.
           modify pb-cambio, bitmap-number = 2 
           .
      * <TOTEM:END>
       pb-cambio-AfterProcedure.
      * <TOTEM:PARA. pb-cambio-AfterProcedure>
           move 1 to BitmapNumChange.
           modify pb-cambio, bitmap-number = 1 
           .
      * <TOTEM:END>
       pb-cambio-LinkTo.
      * <TOTEM:PARA. pb-cambio-LinkTo>
           inquire ef-old-pass, value in old-pass.
           if old-pass = user-pass
              set tutto-ok to true
              if vecchio
                 move user-id to user-cod
                 read user lock invalid continue end-read
              end-if
              if tutto-ok
                 perform PORTA-IN-MODIFICA
              end-if
           else
              display message "Password errata!"
                        title tit-err
                         icon 2
              move 78-ID-ef-old-pass to control-id
              move 4                 to accept-control
           end-if.

           display form1 
           .
      * <TOTEM:END>
       pb-moduli-BeforeProcedure.
      * <TOTEM:PARA. pb-moduli-BeforeProcedure>
           move 2 to BitmapNumModuli.
           display pb-moduli 
           .
      * <TOTEM:END>
       pb-moduli-AfterProcedure.
      * <TOTEM:PARA. pb-moduli-AfterProcedure>
           move 1 to BitmapNumModuli.
           display pb-moduli 
           .
      * <TOTEM:END>
       Form1-Pb-1-LinkTo.
      * <TOTEM:PARA. Form1-Pb-1-LinkTo>
           modify form1-handle, visible 0.
           call   "gest-abil" using user-cod,
                                    user-name.
           cancel "gest-abil".
           modify form1-handle, visible 1 
           .
      * <TOTEM:END>
       ef-nome-BeforeProcedure.
      * <TOTEM:PARA. ef-nome-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-nome-AfterProcedure.
      * <TOTEM:PARA. ef-nome-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       EF-id-BeforeProcedure.
      * <TOTEM:PARA. EF-id-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       EF-id-AfterProcedure.
      * <TOTEM:PARA. EF-id-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO 
           .
      * <TOTEM:END>
       TOOL-CANCELLA-LinkTo.
      * <TOTEM:PARA. TOOL-CANCELLA-LinkTo>
           inquire tool-cancella, enabled in e-cancella.
           if e-cancella = 1
              perform CANCELLA
           end-if 
           .
      * <TOTEM:END>
       TOOL-PRIMO-LinkTo.
      * <TOTEM:PARA. TOOL-PRIMO-LinkTo>
           if v-scorr + e-scorr = 2 |Visibile ed abilitato
              move low-value to user-rec
              start user key is >= user-chiave
                    invalid continue
                not invalid
                    read user next no lock
                    move user-cod to user-id
                    move spaces   to old-pass
                    move 1 to e-id
                    move 0 to e-pwd
                    move 3 to BitmapNumChange BitmapNumScad
                    perform CANCELLA-COLORE
                    display form1
              end-start
           end-if 
           .
      * <TOTEM:END>
       TOOL-ULTIMO-LinkTo.
      * <TOTEM:PARA. TOOL-ULTIMO-LinkTo>
           if v-scorr + e-scorr = 2 |Visibile ed abilitato
              move high-value to user-rec
              start user key is <= user-chiave
                    invalid continue
                not invalid
                    read user previous no lock
                    move user-cod to user-id
                    move spaces   to old-pass
                    move 1 to e-id
                    move 0 to e-pwd
                    move 3 to BitmapNumChange BitmapNumScad
                    perform CANCELLA-COLORE
                    display form1
              end-start
           end-if 
           .
      * <TOTEM:END>
       TOOL-PRECEDENTE-LinkTo.
      * <TOTEM:PARA. TOOL-PRECEDENTE-LinkTo>
           if v-scorr + e-scorr = 2 |Visibile ed abilitato
              inquire ef-id, value in user-cod
              start user key is < user-chiave
                    invalid continue
                not invalid
                    read user previous no lock
                    move user-cod to user-id
                    move spaces   to old-pass
                    move 1 to e-id
                    move 0 to e-pwd
                    move 3 to BitmapNumChange BitmapNumScad
                    perform CANCELLA-COLORE
                    display form1
              end-start
           end-if 
           .
      * <TOTEM:END>
       TOOL-SUCCESSIVO-LinkTo.
      * <TOTEM:PARA. TOOL-SUCCESSIVO-LinkTo>
           if v-scorr + e-scorr = 2 |Visibile ed abilitato
              inquire ef-id, value in user-cod
              start user key is > user-chiave
                    invalid continue
                not invalid
                    read user next no lock
                    move user-cod to user-id
                    move spaces   to old-pass
                    move 1 to e-id
                    move 0 to e-pwd
                    move 3 to BitmapNumChange BitmapNumScad
                    perform CANCELLA-COLORE
                    display form1
              end-start
           end-if 
           .
      * <TOTEM:END>
       pb-importa-LinkTo.
      * <TOTEM:PARA. pb-importa-LinkTo>
           move user-id to como-record(1:10).
           move "user-diversi" to como-file.
           call "zoom-gt"   using como-file, como-record
                           giving stato-zoom
           end-call.
           cancel "zoom-gt".
           if stato-zoom = 0
              move user-id           to UtenteInUso
              move como-record(1:10) to UtenteFrom
              inspect UtenteInUso replacing trailing spaces by low-value
              inspect UtenteFrom  replacing trailing spaces by low-value
              initialize messaggio
              string "Effettuare l'importazione" delimited size
                     " delle abilitazioni da "   delimited size
                    x"0d0a"                      delimited size
                     UtenteFrom                  delimited low-value
                     " verso l'utente "          delimited size
                     UtenteInUso                 delimited low-value
                     "?"                         delimited size
                     into messaggio
              end-string
              display message messaggio
                        title titolo
                         type mb-yes-no
                       giving scelta
              if scelta = mb-yes
                 move como-record(1:10) to up-user-id of user-pgm1
                 move low-value         to up-prog-id of user-pgm1
                 start user-pgm1 key is >= up-chiave of user-pgm1
                       invalid continue
                   not invalid
                       move 0 to idx
                       call "W$MOUSE" using set-mouse-shape, 
           wait-pointer
                       perform until 1 = 2
                          read user-pgm1 next no lock at end exit 
           perform end-read
                          if up-user-id of user-pgm1 not =  
           como-record(1:10)
                             exit perform
                          end-if
                          add 1 to idx
                          move user-id                 
                            to up-user-id      of user-pgm
                          move up-prog-id      of user-pgm1
                            to up-prog-id      of user-pgm
                          move up-livello-abil of user-pgm1
                            to up-livello-abil of user-pgm
                          write up-record of user-pgm 
                                invalid rewrite up-record of user-pgm 
                          end-write
                       end-perform
                       if idx > 0
                          display message "Operazione effettuata!"
                                    title titolo
                       else
                          display message "Nessun abilitazione trovata!"
                                    title titolo
                                     icon 2
                       end-if
                       call "W$MOUSE" using set-mouse-shape, 
           arrow-pointer
                 end-start
              end-if
           end-if 
           .
      * <TOTEM:END>
       pb-importa-BeforeProcedure.
      * <TOTEM:PARA. pb-importa-BeforeProcedure>
           move 2 to BitmapNumImporta.
           display pb-importa 
           .
      * <TOTEM:END>
       pb-importa-AfterProcedure.
      * <TOTEM:PARA. pb-importa-AfterProcedure>
           move 1 to BitmapNumImporta.
           display pb-importa 
           .
      * <TOTEM:END>
       pb-scadute-BeforeProcedure.
      * <TOTEM:PARA. pb-scadute-BeforeProcedure>
           move 2 to BitmapNumScad.
           modify pb-scadute, bitmap-number = BitmapNumScad 
           .
      * <TOTEM:END>
       pb-scadute-AfterProcedure.
      * <TOTEM:PARA. pb-scadute-AfterProcedure>
           move 1 to BitmapNumScad.
           modify pb-scadute, bitmap-number = BitmapNumScad 
           .
      * <TOTEM:END>
       pb-scadute-LinkTo.
      * <TOTEM:PARA. pb-scadute-LinkTo>
           if user-codi = "BOSS"
              call   "st-pwd-scad"
              cancel "st-pwd-scad"
              move 666 to control-id
              move   4 to accept-control
           else
              display message "SOLO PER UTENTE BOSS!"
                        title titolo
                         icon 2
           end-if 
           .
      * <TOTEM:END>
       pb-scheda-BeforeProcedure.
      * <TOTEM:PARA. pb-scheda-BeforeProcedure>
           modify pb-scheda, bitmap-number = 2 
           .
      * <TOTEM:END>
       pb-scheda-AfterProcedure.
      * <TOTEM:PARA. pb-scheda-AfterProcedure>
           modify pb-scheda, bitmap-number = 1 
           .
      * <TOTEM:END>
       pb-scheda-LinkTo.
      * <TOTEM:PARA. pb-scheda-LinkTo>
           move 1               to link-mod.
           inquire ef-id, value in link-user.
           modify form1-handle, visible false.
           call   "gusr-tel" using usr-tel-linkage.
           cancel "gusr-tel".
           modify form1-handle, visible true 
           .
      * <TOTEM:END>
       Form1-DaCb-1-BeforeProcedure.
      * <TOTEM:PARA. Form1-DaCb-1-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       Form1-DaCb-1-AfterProcedure.
      * <TOTEM:PARA. Form1-DaCb-1-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       Form1-Cm-1-BeforeProcedure.
      * <TOTEM:PARA. Form1-Cm-1-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       Form1-Cm-1-AfterProcedure.
      * <TOTEM:PARA. Form1-Cm-1-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>

      *{TOTEM}END

      *{TOTEM}SHOW-MSG
       MESSAGE-FOR-FILEERROR.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
              MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           .

       SHOW-TRANSACTION-ROUTINE.
           IF TOTEM-TRANSACTION-FLAG = SPACES
              IF TRANSACTION-STATUS NOT = 0
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-1
              END-IF
           ELSE
              PERFORM SHOW-MSG-ROUTINE
              IF TRANSACTION-STATUS = 0
                 MOVE "Transazione terminata con Rollback." TO 
           TOTEM-MSG-3
              ELSE
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-3
              END-IF
           END-IF
           .

       SHOW-MSG-ROUTINE.
           MOVE SPACE TO TOTEM-MSG-1 TOTEM-MSG-2 TOTEM-MSG-3
           EVALUATE TOTEM-MSG-ID
               WHEN "10"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Nessun altro dato." TO TOTEM-MSG-2
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "22"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Chiave Duplicata." TO TOTEM-MSG-2
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "23"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Raggiunta fine file." TO TOTEM-MSG-2
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "101"
                    MOVE "Terminare l'applicazione?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "201"
                    MOVE "Aggiungere un nuovo record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "202"
                    MOVE "Aggiornare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "203"
                    MOVE "Cancellare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "204"
                    MOVE "Chiave duplicata." TO TOTEM-MSG-1
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "301"
                    MOVE "Inserimento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "302"
                    MOVE "Aggiornamento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "303"
                    MOVE "Cancellazione avvenuta con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "401"
                    MOVE "Shell non trovata." TO TOTEM-MSG-1
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN OTHER
                    MOVE TEXT-MESSAGE TO TOTEM-MSG-1
                    STRING "FILE:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-3
                    MOVE 0 TO TOTEM-IDX1
                    INSPECT TOTEM-MSG-3 TALLYING TOTEM-IDX1
                       FOR TRAILING SPACE
                    STRING TOTEM-MSG-3(1:TOTEM-MSG-LENGTH - 
           TOTEM-IDX1), 
                       ", FILE STATUS ", PRIMARY-ERROR "," 
                       SECONDARY-ERROR
                    DELIMITED BY SIZE INTO TOTEM-MSG-2
                    MOVE SPACES TO TOTEM-MSG-3
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
           END-EVALUATE
           PERFORM MESSAGE-BOX-ROUTINE
           .

       MESSAGE-BOX-ROUTINE.
           MOVE 1 TO TOTEM-MSG-TEXT-POINTER
           IF TOTEM-MSG-1 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-1 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              STRING TOTEM-MSG-1( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                 DELIMITED BY SIZE
                 INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-2 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-2 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-2( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-3 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-3 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-3( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-TEXT-POINTER = 1
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-TEXT TALLYING TOTEM-MSG-SIZE FOR 
           TRAILING SPACE
                  COMPUTE TOTEM-MSG-TEXT-POINTER = 
           TOTEM-MSG-FULL-LENGTH - TOTEM-MSG-SIZE + 1
           END-IF
           MOVE LOW-VALUES TO TOTEM-MSG-TEXT(TOTEM-MSG-TEXT-POINTER : 1 
           )
           .

       MESSAGE-BOX-DISPLAY.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

      *{TOTEM}END

