      *{TOTEM}PRG-COMMENT
      * notacr.Cbl
      * notacr.Cbl is generated by TOTEM
      * This is a generated file. DO NOT modify this file directly.
      *{TOTEM}END
       IDENTIFICATION       DIVISION.
      *{TOTEM}PRGID
       PROGRAM-ID.          notacr.
       AUTHOR.              andre.
       DATE-WRITTEN.        martedì 23 luglio 2019 15:17:09.
       REMARKS.
      *{TOTEM}END

       ENVIRONMENT          DIVISION.
       CONFIGURATION        SECTION.
       SPECIAL-NAMES.
      *{TOTEM}SPECIAL-NAME
      * <TOTEM:EPT. INIT:notacr, INIT:notacr, SpecialName>
      * <TOTEM:END>
      *{TOTEM}END
      *{TOTEM}ACTIVEX-DEF
      *{TOTEM}END
      *{TOTEM}DECIMAL-POINT
           DECIMAL-POINT IS COMMA.
      *{TOTEM}END

       INPUT-OUTPUT         SECTION.
       FILE-CONTROL.
      *{TOTEM}FILE-CONTROL
           COPY "tnotacr.sl".
           COPY "agenti.sl".
           COPY "tparamge.sl".
           COPY "rnotacr.sl".
           COPY "destini.sl".
           COPY "tcodpag.sl".
           COPY "clienti.sl".
           COPY "articoli.sl".
           COPY "tordini.sl".
           COPY "rordini.sl".
           COPY "tcaumag.sl".
           COPY "progmag.sl".
           COPY "MAS.sl".
           COPY "timballi.sl".
           COPY "timbalqta.sl".
           COPY "tmagaz.sl".
           COPY "recapiti.sl".
           COPY "tmp-progmag-zoom.sl".
           COPY "btnotacr.sl".
           COPY "brnotacr.sl".
           COPY "tvettori.sl".
           COPY "tivaese.sl".
      *{TOTEM}END
       DATA                 DIVISION.
       FILE                 SECTION.
      *{TOTEM}FILE
           COPY "tnotacr.fd".
           COPY "agenti.fd".
           COPY "tparamge.fd".
           COPY "rnotacr.fd".
           COPY "destini.fd".
           COPY "tcodpag.fd".
           COPY "clienti.fd".
           COPY "articoli.fd".
           COPY "tordini.fd".
           COPY "rordini.fd".
           COPY "tcaumag.fd".
           COPY "progmag.fd".
           COPY "MAS.fd".
           COPY "timballi.fd".
           COPY "timbalqta.fd".
           COPY "tmagaz.fd".
           COPY "recapiti.fd".
           COPY "tmp-progmag-zoom.fd".
           COPY "btnotacr.fd".
           COPY "brnotacr.fd".
           COPY "tvettori.fd".
           COPY "tivaese.fd".
      *{TOTEM}END

       WORKING-STORAGE      SECTION.
      *{TOTEM}ACU-DEF
               COPY "ACUGUI.DEF".
               COPY "ACUCOBOL.DEF".
               COPY "FONTS.DEF".
               COPY "CRTVARS.DEF".
               COPY "SHOWMSG.DEF".
               COPY "totem.def".
               COPY "standard.def".
      *{TOTEM}END

      *{TOTEM}COPY-WORKING
      * Key Status
       77 Key-Status IS SPECIAL-NAMES CRT STATUS PIC 9(5) VALUE 0.
          88 Enter-Pushed VALUE 13.
          88 Exit-Pushed VALUE 27.
          88 Message-Received VALUE 95.
          88 Event-Occurred VALUE 96.
          88 Screen-No-Input-Field VALUE 97.
          88 Screen-Time-Out VALUE 99.
      * Properties & User defined Working Stoarge
       01 LinkChiave.
           05 LinkAnno         PIC  9(4).
           05 LinkNumero       PIC  9(8).
       77 Screen1-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 num-codici-iva   PIC  9(3).
           COPY  "LINK-PASSWD.DEF".
           COPY  "COMBO-STATO.DEF".
           COPY  "LINK-NAMBAR.DEF".
           COPY  "LINK-GESLOCK.DEF".
           COPY  "LINK-WPROGMAG.DEF".
           COPY  "EXTERNALS.DEF".
       01 FILLER           PIC  9.
           88 EsisteIVA VALUE IS 1    WHEN SET TO FALSE  0. 
       77 StoreDesMagazzino            PIC  x(50).
       77 sum  PIC  9(15)v99.
       77 art-codice-x     PIC  x(6).
       77 SavePrezzo       PIC  9(12)v99.
       77 imballo-descrizione          PIC  x(80).
       77 hid-imballi      PIC  9(4).
       01 FILLER           PIC  xx.
           88 TotaleSiZero VALUE IS "SI". 
           88 TotaleNoZero VALUE IS "NO". 
       77 data-oggi        PIC  9(8).
       77 cod-iva          PIC  x(3)
                  OCCURS 3 TIMES.
       01 CallWProgmagFlag PIC  9.
           88 CallWProgmag VALUE IS 1    WHEN SET TO FALSE  0. 
       78 78-GridLineWith VALUE IS 23,50. 
       78 78-GridLinesWith VALUE IS 17,08. 
       78 78-GridLineWithout VALUE IS 5,00. 
       78 78-GridLinesWithout VALUE IS 34. 
       01 HiddenPeso.
           05 HiddenUtf        PIC  9(5)V9(3).
           05 HiddenNonUtf     PIC  9(5)V9(3).
       01 FILLER           PIC  9.
           88 ArticoloSetFocus VALUE IS 1    WHEN SET TO FALSE  0. 
       01 FILLER           PIC  9.
           88 PrimaVolta VALUE IS 1    WHEN SET TO FALSE  0. 
       77 Small-Font
                  USAGE IS HANDLE OF FONT SMALL-FONT.
       77 pagina           PIC  9.
       01 HiddenValori.
           05 hid-old-qta      PIC  9(8).
           05 hid-old-prz      PIC  9(9)v99.
           05 hid-old-consumo  PIC  9(9)v99.
           05 hid-old-coubat   PIC  9(9)v99.
           05 hid-old-piombo   PIC  9(9)v99.
           05 hid-old-iva      PIC  x(3).
           05 hid-peso-utf     PIC  9(5)V9(3).
           05 hid-peso-non-utf PIC  9(5)V9(3).
       77 num-articoli     PIC  9(7).
       01 FILLER           PIC  9.
           88 InsertRow VALUE IS 1    WHEN SET TO FALSE  0. 
       01 tab-id.
           05 min-id           PIC  9(5)
                      OCCURS 9 TIMES.
           05 max-id           PIC  9(5)
                      OCCURS 9 TIMES.
       77 riga-edit        PIC  zzz.zzz.zz9.
       77 Screen1-Pg-1-Visible         PIC  9
                  VALUE IS 0.
       77 hidden-sel       PIC  9.
       77 conferma-bmp
                  USAGE IS HANDLE OF BITMAP.
       77 tipo-nota        PIC  x(50).
       77 imballi-ed       PIC  zz.zz9.
       77 Screen1-Pg-2-Visible         PIC  9
                  VALUE IS 0.
       77 como-prezzo      PIC  9(15)v999.
       77 codice-ed        PIC  z(5).
       77 Form1-St-1-Handle
                  USAGE IS HANDLE OF STATUS-BAR.
       77 Form1-Tb-1-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 CountChar        PIC  9(3)
                  VALUE IS 0.
       77 TOOLBAR-BMP      PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 E-ESCI           PIC  9
                  VALUE IS 1.
       77 E-NUOVO          PIC  9
                  VALUE IS 0.
       77 E-CANCELLA       PIC  9
                  VALUE IS 0.
       77 E-SALVA          PIC  9
                  VALUE IS 1.
       77 E-ANTEPRIMA      PIC  9
                  VALUE IS 0.
       77 E-MODIFICA       PIC  9
                  VALUE IS 1.
       77 E-STAMPA         PIC  9
                  VALUE IS 0.
       77 E-CERCA          PIC  9
                  VALUE IS 0.
       77 E-SELEZIONA      PIC  9
                  VALUE IS 0.
       77 STATUS-tnotacr   PIC  X(2).
           88 Valid-STATUS-tnotacr VALUE IS "00" THRU "09". 
       77 STATUS-rnotacr   PIC  X(2).
           88 Valid-STATUS-rnotacr VALUE IS "00" THRU "09". 
       77 STATUS-agenti    PIC  X(2).
           88 Valid-STATUS-agenti VALUE IS "00" THRU "09". 
       77 STATUS-articoli  PIC  X(2).
           88 Valid-STATUS-articoli VALUE IS "00" THRU "09". 
       77 STATUS-clienti   PIC  X(2).
           88 Valid-STATUS-clienti VALUE IS "00" THRU "09". 
       77 STATUS-destini   PIC  X(2).
           88 Valid-STATUS-destini VALUE IS "00" THRU "09". 
       77 path-txt         PIC  X(32).
       77 STATUS-pass      PIC  X(2).
           88 Valid-STATUS-pass VALUE IS "00" THRU "09". 
       77 status-tcodpag   PIC  X(2).
           88 Valid-status-tcodpag VALUE IS "00" THRU "09". 
       77 STATUS-tcontat   PIC  X(2).
           88 Valid-STATUS-tcontat VALUE IS "00" THRU "09". 
       77 STATUS-tivaese   PIC  X(2).
           88 Valid-STATUS-tivaese VALUE IS "00" THRU "09". 
       77 STATUS-tparamge  PIC  X(2).
           88 Valid-STATUS-tparamge VALUE IS "00" THRU "09". 
       77 STATUS-tordini   PIC  X(2).
           88 Valid-STATUS-tordini VALUE IS "00" THRU "09". 
       77 v-manuale        PIC  9
                  VALUE IS 1.
       01 rec-grid.
           05 col-riga         PIC  z(5).
           05 col-codice       PIC  zzzzz9.
           05 col-descr        PIC  x(150).
           05 col-quantita     PIC  z(7)9.
           05 col-prezzo       PIC  zzz.zzz.zz9,99.
           05 col-consumo      PIC  z.zz9,99.
           05 col-coubat       PIC  z.zz9,99.
           05 col-add          PIC  z.zz9,99.
           05 col-cod-iva      PIC  x(3).
       01 rec-visua.
           05 col-num          PIC  z(5).
           05 col-art          PIC  zzzzz9.
           05 col-des          PIC  x(150).
           05 col-qta          PIC  z(7)9.
           05 col-uni          PIC  zzz.zzz.zz9,99.
           05 col-sconto       PIC  z9,99.
           05 col-cons         PIC  z.zz9,99.
           05 col-cou          PIC  z.zz9,99.
           05 col-add-pb       PIC  z.zz9,99.
           05 col-imp          PIC  zzz.zzz.zz9,99.
           05 col-iva          PIC  x(3).
           05 col-oma          PIC  x.
       77 v-grid           PIC  9
                  VALUE IS 0.
       77 grid-line        PIC  S9(4)V9(2).
       77 grid-lines       PIC  S9(4)V9(2).
       77 genera-bmp       PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 lab-iva-buf      PIC  x(100).
       77 lab-pag-buf      PIC  x(100).
       77 lab-age-buf      PIC  x(100).
       77 lab-des-buf      PIC  x(100).
       77 lab-cli-buf      PIC  x(100).
       77 lab-ind-buf      PIC  x(100).
       77 lab-loca-bud     PIC  x(100).
       77 lab-loca-buf     PIC  x(100).
       77 lab-ind-d-buf    PIC  x(100).
       77 lab-loca-d-buf   PIC  x(100).
       77 AUTO-ID          PIC  9(6)
                  VALUE IS 96.
       01 old-tno-rec.
           05 old-tno-chiave.
               10 old-tno-anno     PIC  9(4).
               10 old-tno-numero   PIC  9(8).
           05 old-tno-dati.
               10 old-tno-causale  PIC  x(4).
               10 old-tno-cod-cli  PIC  9(5).
               10 old-tno-prg-destino          PIC  9(5).
               10 old-tno-data     PIC  9(8).
               10 old-tno-data-passaggio-ordine            PIC  9(8).
               10 old-tno-cod-agente           PIC  9(5).
               10 old-tno-cod-pagamento        PIC  x(3).
               10 old-tno-cod-ese-iva          PIC  x(3).
               10 old-tno-spostam-ric-ago      PIC  X(1).
                   88 old-tno-si-ric-ago VALUE IS "S". 
                   88 old-tno-no-ric-ago VALUE IS "N". 
               10 old-tno-spostam-ric-dic      PIC  X(1).
                   88 old-tno-si-ric-dic VALUE IS "S". 
                   88 old-tno-no-ric-dic VALUE IS "N". 
               10 old-tno-note     PIC  X(500).
               10 old-tno-invio    PIC  x.
                   88 old-tno-invio-manuale VALUE IS "M". 
                   88 old-tno-invio-postel VALUE IS "P". 
               10 old-tno-fattura.
                   15 old-tno-anno-fattura         PIC  9(4).
                   15 old-tno-num-fattura          PIC  9(8).
                   15 old-tno-data-fattura         PIC  9(8).
                   15 old-tno-num-prenot           PIC  9(8).
                   15 old-tno-fatt-prenotata       PIC  x.
                       88 old-tno-fatt-si-prenotata VALUE IS "S". 
                       88 old-tno-fatt-no-prenotata VALUE IS "N". 
               10 old-tno-agg-contab           PIC  x.
                   88 old-tno-si-agg-contab VALUE IS "S". 
                   88 old-tno-no-agg-contab VALUE IS "N". 
               10 old-tno-contropartita        PIC  X(8).
               10 old-tno-stato    PIC  X(1).
                   88 old-tno-attivo VALUE IS "A". 
                   88 old-tno-disattivo VALUE IS "D". 
                   88 old-tno-bloccato VALUE IS "B". 
               10 old-tno-dati-comuni.
                   15 old-tno-data-creazione       PIC  9(8).
                   15 old-tno-ora-creazione        PIC  9(8).
                   15 old-tno-utente-creazione     PIC  X(10).
                   15 old-tno-data-ultima-modifica PIC  9(8).
                   15 old-tno-ora-ultima-modifica  PIC  9(8).
                   15 old-tno-utente-ultima-modifica           PIC  
           X(10).
               10 old-tno-vuoti.
                   15 old-tno-data-contab          PIC  9(8).
                   15 old-tno-fattura-from.
                       20 old-tno-fattura-from-data    PIC  9(8).
                       20 old-tno-fattura-from-numero  PIC  9(8).
                   15 old-tno-bolla-from.
                       20 old-tno-bolla-from-data      PIC  9(8).
                       20 old-tno-bolla-from-numero    PIC  x(8).
                   15 tno-num-vuoto-3  PIC  9(5).
               10 old-tno-data-ingresso        PIC  9(8).
               10 FILLER           PIC  x(52).
       77 cbo-stato-buf    PIC  X(10).
       01 GiacenzaKey.
           10 gia-cod-articolo PIC  9(6).
           10 gia-cod-magazzino            PIC  X(3).
           10 gia-tipo-imballo PIC  X(3).
           10 gia-peso         PIC  9(5)V9(3).
       01 HiddenKey.
           10 hid-cod-articolo PIC  9(6).
           10 hid-cod-magazzino            PIC  X(3).
           10 hid-tipo-imballo PIC  X(3).
           10 hid-peso         PIC  9(5)V9(3).
       01 FILLER           PIC  9
                  VALUE IS 0.
           88 NonCambiareTab VALUE IS 1    WHEN SET TO FALSE  0. 
       01 FILLER           PIC  9
                  VALUE IS 0.
           88 ControllaCampi VALUE IS 1    WHEN SET TO FALSE  0. 
       01 FILLER           PIC  9
                  VALUE IS 1.
           88 CheckDestini VALUE IS 1    WHEN SET TO FALSE  0. 
       77 nome-file        PIC  x(15).
       77 titolo           PIC  x(100).
       77 Default-Font
                  USAGE IS HANDLE OF FONT DEFAULT-FONT.
       77 Form1-handle
                  USAGE IS HANDLE OF WINDOW.
       77 lab-data-buf     PIC  99/99/9999.
       77 lab-num-buf      PIC  z(8).
       77 STATUS-rordini   PIC  X(2).
           88 Valid-STATUS-rordini VALUE IS "00" THRU "09". 
       77 tit-screen       PIC  x(100).
       77 v-ncpz           PIC  9
                  VALUE IS 0.
       77 v-ncre           PIC  9
                  VALUE IS 1.
       77 v-ncnc           PIC  9
                  VALUE IS 0.
       77 strip-grid-gclienti-bmp      PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 ef-iva-NCNC-buf  PIC  x(3).
       77 ef-prz-NCNC-buf  PIC  zzz.zzz.zz9,99.
       77 ef-descr-buf     PIC  X(150).
       77 ef-qta-NCRE-buf  PIC  z(8).
       77 ef-iva-NCPZ-buf  PIC  X(3).
       77 ef-prz-NCPZ-buf  PIC  zzz.zzz.zz9,99.
       77 ef-qta-NCPZ-buf  PIC  z(8).
       77 sel-tutto-bmp    PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 lab-data-nc-buf  PIC  99/99/9999.
       77 lab-anno-nc-buf  PIC  9(4).
       77 Courier-New18-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 v-0  PIC  9
                  VALUE IS 0.
       77 ef-art-buf       PIC  z(6).
       77 lab-art-buf      PIC  x(50).
       77 ef-qta-buf       PIC  z(8).
       77 ef-prz-buf       PIC  zzz.zzz.zz9,99.
       77 ef-iva-buf       PIC  X(3).
       77 pb-nuovo-0-column            PIC  9(3)v99.
       77 pb-elimina-0-column          PIC  9(3)v99.
       77 EF-LinesWithout  PIC  S9(4)V9(2).
       77 LastPrg          PIC  9(5).
       77 STATUS-tmarche   PIC  X(2).
           88 Valid-STATUS-tmarche VALUE IS "00" THRU "09". 
       77 STATUS-timposte  PIC  X(2).
           88 Valid-STATUS-timposte VALUE IS "00" THRU "09". 
       77 STATUS-tcaumag   PIC  X(2).
           88 Valid-STATUS-tcaumag VALUE IS "00" THRU "09". 
       77 STATUS-progmag   PIC  X(2).
           88 Valid-STATUS-progmag VALUE IS "00" THRU "09". 
       77 ef-coubat-buf    PIC  z.zz9,99.
       77 ef-consumo-buf   PIC  zzz.zzz.zz9,99.
       77 ef-coubat-NCNC-buf           PIC  z.zz9,99.
       77 ef-consumo-NCNC-buf          PIC  z.zz9,99.
       77 ef-consumo-ncpz-buf          PIC  z.zz9,99.
       77 ef-coubat-ncpz-buf           PIC  z.zz9,99.
       77 v-screen         PIC  9
                  VALUE IS 0.
       77 v-fatt           PIC  9
                  VALUE IS 1.
       77 v-bozza          PIC  9
                  VALUE IS 0.
       77 lab-cont-buf     PIC  x(100).
       77 lab-piano-buf    PIC  x(100).
       77 SaveArticolo     PIC  9(6).
       77 como-articolo    PIC  9(6).
       77 como-magazzino   PIC  x(3).
       77 como-giacenza    PIC  s9(8).
       77 como-record      PIC  x(32000).
       01 FILLER           PIC  9.
           88 CheckAfterZoom VALUE IS 1    WHEN SET TO FALSE  0. 
       01 FILLER           PIC  9.
           88 record-ok VALUE IS 1    WHEN SET TO FALSE  0. 
       01 FILLER           PIC  9.
           88 filtro-articoli VALUE IS 1    WHEN SET TO FALSE  0. 
       77 status-mas       PIC  X(2).
           88 Valid-status-mas VALUE IS "00" THRU "09". 
       77 path-tmp-progmag-zoom        PIC  X(256).
       77 STATUS-tmp-progmag-zoom      PIC  X(2).
           88 Valid-STATUS-tmp-progmag-zoom VALUE IS "00" THRU "09". 
       77 STATUS-timballi  PIC  X(2).
           88 Valid-STATUS-timballi VALUE IS "00" THRU "09". 
       77 STATUS-timbalqta PIC  X(2).
           88 Valid-STATUS-timbalqta VALUE IS "00" THRU "09". 
       77 STATUS-tmagaz    PIC  X(2).
           88 Valid-STATUS-tmagaz VALUE IS "00" THRU "09". 
       77 STATUS-recapiti  PIC  X(2).
           88 Valid-STATUS-recapiti VALUE IS "00" THRU "09". 
       77 Verdana12B-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 lab-anno-buf     PIC  X(20).
       77 ef-add-buf       PIC  z.zz9,99.
       77 ef-add-ncpz-buf  PIC  z.zz9,99.
       77 ef-add-NCNC-buf  PIC  z.zz9,99.
       77 lab-tipodoc-buf  PIC  X(30).
       77 lab-motivo-buf   PIC  x(500).
       77 lab-colpa-buf    PIC  x(30).
       77 lab-altre-buf    PIC  x(500).
       77 STATUS-brnotacr  PIC  X(2).
           88 Valid-STATUS-brnotacr VALUE IS "00" THRU "09". 
       77 STATUS-btnotacr  PIC  X(2).
           88 Valid-STATUS-btnotacr VALUE IS "00" THRU "09". 
       77 lab-corriere-des-buf         PIC  x(50).
       77 lab-corriere-buf PIC  z(5).
       77 STATUS-tvettori  PIC  X(2).
           88 Valid-STATUS-tvettori VALUE IS "00" THRU "09". 
       77 mod-campi        PIC  9
                  VALUE IS 1.
       77 lab-num-f-buf    PIC  z(8).
       77 lab-data-f-buf   PIC  99/99/9999.
       77 lab-num-bolla-buf            PIC  x(20)
                  VALUE IS "XXXXXXXXXXXXXXXXXXX0".
       77 lab-data-bolla-buf           PIC  99/99/9999.
       77 v-sel-tutto      PIC  9
                  VALUE IS 1.

      ***********************************************************
      *   Code Gen's Buffer                                     *
      ***********************************************************
       77 Screen1-Ta-1-TAB-VALUE  PIC  99  VALUE 1.
       77 STATUS-Form1-FLAG-REFRESH PIC  9.
          88 Form1-FLAG-REFRESH  VALUE 1 FALSE 0. 
      * DATA CONTROL BUFFER
       01 Form1-BUF.
      * Page
              05 Screen1-Pg-1-BUF.
      * Data.Entry-Field
              10 ef-cli-BUF PIC x(5).
      * Data.Entry-Field
              10 ef-des-BUF PIC x(5).
      * Data.Entry-Field
              10 ef-age-BUF PIC zzzz9.
      * Data.Entry-Field
              10 ef-pag-BUF PIC X(3).
      * Data.Entry-Field
              10 ef-iva-ese-BUF PIC X(3).
      * Data.Entry-Field
              10 ef-piano-BUF PIC X(8).
      * Data.Entry-Field
              10 ef-data-ingresso-BUF PIC 99/99/9999 blank zero.
      * Data.Entry-Field
              10 ef-note-BUF PIC X(500).
      * Data.Entry-Field
              10 ef-bolla-num-BUF PIC x(8).
      * Data.Entry-Field
              10 ef-bolla-data-BUF PIC 99/99/9999.
      * Data.Entry-Field
              10 ef-fatt-num-BUF PIC z(8).
      * Data.Entry-Field
              10 ef-fatt-data-BUF PIC 99/99/9999.

       77 TMP-DataSet1-tnotacr-BUF     PIC X(752).
       77 TMP-DataSet1-agenti-BUF     PIC X(1233).
       77 TMP-DataSet1-tparamge-BUF     PIC X(815).
       77 TMP-DataSet1-rnotacr-BUF     PIC X(545).
       77 TMP-DataSet1-destini-BUF     PIC X(3386).
       77 TMP-DataSet1-tcodpag-BUF     PIC X(1380).
       77 TMP-DataSet1-clienti-BUF     PIC X(1910).
       77 TMP-DataSet1-articoli-BUF     PIC X(3669).
       77 TMP-DataSet1-tordini-BUF     PIC X(3898).
       77 TMP-DataSet1-rordini-BUF     PIC X(667).
       77 TMP-DataSet1-tcaumag-BUF     PIC X(254).
       77 TMP-DataSet1-progmag-BUF     PIC X(1090).
       77 TMP-DataSet1-MAS-BUF     PIC X(512).
       77 TMP-DataSet1-timballi-BUF     PIC X(210).
       77 TMP-DataSet1-timbalqta-BUF     PIC X(167).
       77 TMP-DataSet1-tmagaz-BUF     PIC X(212).
       77 TMP-DataSet1-recapiti-BUF     PIC X(328).
       77 TMP-DataSet1-tmp-progmag-zoom-BUF     PIC X(195).
       77 TMP-DataSet1-btnotacr-BUF     PIC X(912).
       77 TMP-DataSet1-brnotacr-BUF     PIC X(424).
       77 TMP-DataSet1-tvettori-BUF     PIC X(1847).
       77 TMP-DataSet1-tivaese-BUF     PIC X(1380).
      * VARIABLES FOR RECORD LENGTH.
       77  TotemFdSlRecordClearOffset   PIC 9(5) COMP-4.
       77  TotemFdSlRecordLength        PIC 9(5) COMP-4.
      * FILE'S LOCK MODE FLAG
       77 DataSet1-tnotacr-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tnotacr-LOCK  VALUE "Y".
       77 DataSet1-KEYIS   PIC 9(3) VALUE 1.
       77 DataSet1-tnotacr-KEY1-ORDER  PIC X VALUE "A".
          88 DataSet1-tnotacr-KEY1-Asc  VALUE "A".
          88 DataSet1-tnotacr-KEY1-Desc VALUE "D".
       77 DataSet1-agenti-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-agenti-LOCK  VALUE "Y".
       77 DataSet1-agenti-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-agenti-KEY-Asc  VALUE "A".
          88 DataSet1-agenti-KEY-Desc VALUE "D".
       77 DataSet1-tparamge-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tparamge-LOCK  VALUE "Y".
       77 DataSet1-tparamge-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tparamge-KEY-Asc  VALUE "A".
          88 DataSet1-tparamge-KEY-Desc VALUE "D".
       77 DataSet1-rnotacr-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-rnotacr-LOCK  VALUE "Y".
       77 DataSet1-rnotacr-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-rnotacr-KEY-Asc  VALUE "A".
          88 DataSet1-rnotacr-KEY-Desc VALUE "D".
       77 DataSet1-destini-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-destini-LOCK  VALUE "Y".
       77 DataSet1-destini-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-destini-KEY-Asc  VALUE "A".
          88 DataSet1-destini-KEY-Desc VALUE "D".
       77 DataSet1-tcodpag-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tcodpag-LOCK  VALUE "Y".
       77 DataSet1-tcodpag-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tcodpag-KEY-Asc  VALUE "A".
          88 DataSet1-tcodpag-KEY-Desc VALUE "D".
       77 DataSet1-clienti-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-clienti-LOCK  VALUE "Y".
       77 DataSet1-clienti-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-clienti-KEY-Asc  VALUE "A".
          88 DataSet1-clienti-KEY-Desc VALUE "D".
       77 DataSet1-articoli-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-articoli-LOCK  VALUE "Y".
       77 DataSet1-articoli-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-articoli-KEY-Asc  VALUE "A".
          88 DataSet1-articoli-KEY-Desc VALUE "D".
       77 DataSet1-tordini-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tordini-LOCK  VALUE "Y".
       77 DataSet1-tordini-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tordini-KEY-Asc  VALUE "A".
          88 DataSet1-tordini-KEY-Desc VALUE "D".
       77 DataSet1-rordini-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-rordini-LOCK  VALUE "Y".
       77 DataSet1-rordini-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-rordini-KEY-Asc  VALUE "A".
          88 DataSet1-rordini-KEY-Desc VALUE "D".
       77 DataSet1-tcaumag-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tcaumag-LOCK  VALUE "Y".
       77 DataSet1-tcaumag-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tcaumag-KEY-Asc  VALUE "A".
          88 DataSet1-tcaumag-KEY-Desc VALUE "D".
       77 DataSet1-progmag-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-progmag-LOCK  VALUE "Y".
       77 DataSet1-progmag-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-progmag-KEY-Asc  VALUE "A".
          88 DataSet1-progmag-KEY-Desc VALUE "D".
       77 DataSet1-MAS-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-MAS-LOCK  VALUE "Y".
       77 DataSet1-MAS-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-MAS-KEY-Asc  VALUE "A".
          88 DataSet1-MAS-KEY-Desc VALUE "D".
       77 DataSet1-timballi-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-timballi-LOCK  VALUE "Y".
       77 DataSet1-timballi-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-timballi-KEY-Asc  VALUE "A".
          88 DataSet1-timballi-KEY-Desc VALUE "D".
       77 DataSet1-timbalqta-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-timbalqta-LOCK  VALUE "Y".
       77 DataSet1-timbalqta-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-timbalqta-KEY-Asc  VALUE "A".
          88 DataSet1-timbalqta-KEY-Desc VALUE "D".
       77 DataSet1-tmagaz-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tmagaz-LOCK  VALUE "Y".
       77 DataSet1-tmagaz-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tmagaz-KEY-Asc  VALUE "A".
          88 DataSet1-tmagaz-KEY-Desc VALUE "D".
       77 DataSet1-recapiti-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-recapiti-LOCK  VALUE "Y".
       77 DataSet1-recapiti-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-recapiti-KEY-Asc  VALUE "A".
          88 DataSet1-recapiti-KEY-Desc VALUE "D".
       77 DataSet1-tmp-progmag-zoom-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tmp-progmag-zoom-LOCK  VALUE "Y".
       77 DataSet1-tmp-progmag-zoom-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tmp-progmag-zoom-KEY-Asc  VALUE "A".
          88 DataSet1-tmp-progmag-zoom-KEY-Desc VALUE "D".
       77 DataSet1-btnotacr-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-btnotacr-LOCK  VALUE "Y".
       77 DataSet1-btnotacr-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-btnotacr-KEY-Asc  VALUE "A".
          88 DataSet1-btnotacr-KEY-Desc VALUE "D".
       77 DataSet1-brnotacr-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-brnotacr-LOCK  VALUE "Y".
       77 DataSet1-brnotacr-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-brnotacr-KEY-Asc  VALUE "A".
          88 DataSet1-brnotacr-KEY-Desc VALUE "D".
       77 DataSet1-tvettori-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tvettori-LOCK  VALUE "Y".
       77 DataSet1-tvettori-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tvettori-KEY-Asc  VALUE "A".
          88 DataSet1-tvettori-KEY-Desc VALUE "D".
       77 DataSet1-tivaese-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tivaese-LOCK  VALUE "Y".
       77 DataSet1-tivaese-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tivaese-KEY-Asc  VALUE "A".
          88 DataSet1-tivaese-KEY-Desc VALUE "D".

       77 tnotacr-k-causale-SPLITBUF  PIC X(17).
       77 tnotacr-k1-SPLITBUF  PIC X(23).
       77 tnotacr-k2-SPLITBUF  PIC X(21).
       77 tnotacr-k-fattura-SPLITBUF  PIC X(13).
       77 tnotacr-k4-SPLITBUF  PIC X(30).
       77 tnotacr-k-contab-SPLITBUF  PIC X(14).
       77 tnotacr-k-data-SPLITBUF  PIC X(17).
       77 tnotacr-k-agfatt-SPLITBUF  PIC X(42).
       77 tnotacr-k-andamento-data-SPLITBUF  PIC X(10).
       77 tnotacr-k-andamento-cliente-SPLITBUF  PIC X(15).
       77 tnotacr-k-andamento-clides-SPLITBUF  PIC X(20).
       77 rnotacr-rno-k-articolo-SPLITBUF  PIC X(24).
       77 destini-K1-SPLITBUF  PIC X(51).
       77 destini-k-localita-SPLITBUF  PIC X(36).
       77 tcodpag-TBL-CODICE-01-SPLITBUF  PIC X(53).
       77 clienti-cli-K1-SPLITBUF  PIC X(47).
       77 clienti-cli-K3-SPLITBUF  PIC X(12).
       77 clienti-cli-K4-SPLITBUF  PIC X(8).
       77 articoli-art-k1-SPLITBUF  PIC X(51).
       77 articoli-art-k-frn-SPLITBUF  PIC X(16).
       77 tordini-k-causale-SPLITBUF  PIC X(17).
       77 tordini-k1-SPLITBUF  PIC X(23).
       77 tordini-k2-SPLITBUF  PIC X(21).
       77 tordini-k-bolla-SPLITBUF  PIC X(13).
       77 tordini-k3-SPLITBUF  PIC X(22).
       77 tordini-k-fattura-SPLITBUF  PIC X(13).
       77 tordini-k4-SPLITBUF  PIC X(30).
       77 tordini-k-contab-SPLITBUF  PIC X(14).
       77 tordini-k-tipo-SPLITBUF  PIC X(14).
       77 tordini-k-data-SPLITBUF  PIC X(17).
       77 tordini-k-agfatt-SPLITBUF  PIC X(42).
       77 tordini-k-stbolle-SPLITBUF  PIC X(34).
       77 tordini-k-andamento-data-SPLITBUF  PIC X(10).
       77 tordini-k-andamento-cliente-SPLITBUF  PIC X(15).
       77 tordini-k-andamento-clides-SPLITBUF  PIC X(20).
       77 tordini-k-promo-SPLITBUF  PIC X(29).
       77 tordini-k-or-SPLITBUF  PIC X(21).
       77 tordini-k-tor-inviare-SPLITBUF  PIC X(14).
       77 tordini-k-tor-tipocli-SPLITBUF  PIC X(25).
       77 tordini-k-tor-gdo-SPLITBUF  PIC X(28).
       77 rordini-ror-k-promo-SPLITBUF  PIC X(16).
       77 rordini-ror-k-articolo-SPLITBUF  PIC X(24).
       77 rordini-ror-k-master-SPLITBUF  PIC X(35).
       77 rordini-ror-k-stbolle-SPLITBUF  PIC X(30).
       77 tcaumag-k-mag-SPLITBUF  PIC X(5).
       77 progmag-key01-SPLITBUF  PIC X(21).
       77 MAS-MAS-CODICE1-SPLITBUF  PIC X(39).
       77 MAS-MAS-CODICE2-SPLITBUF  PIC X(39).
       77 tmp-progmag-zoom-key-des-SPLITBUF  PIC X(64).
       77 tmp-progmag-zoom-key-art-SPLITBUF  PIC X(7).
       77 btnotacr-k1-SPLITBUF  PIC X(23).
       77 btnotacr-k-data-SPLITBUF  PIC X(17).
       77 btnotacr-k-fattura-SPLITBUF  PIC X(13).
       77 btnotacr-k-reso-SPLITBUF  PIC X(13).
       77 btnotacr-k-bolla-SPLITBUF  PIC X(25).
       77 btnotacr-k-vettore-SPLITBUF  PIC X(18).
       77 btnotacr-k-nota-SPLITBUF  PIC X(13).
       77 btnotacr-k-fatman-SPLITBUF  PIC X(13).
       77 brnotacr-brno-k-articolo-SPLITBUF  PIC X(25).
       77 tvettori-k-des-SPLITBUF  PIC X(41).
       77 tivaese-key01-SPLITBUF  PIC X(53).
      * FOR SPLIT KEY BUFFER
       77 DataSet1-tmp-progmag-zoom-SPLIT-BUF1   PIC X(64).


      *{TOTEM}END

      *{TOTEM}ID-LOGICI
      ***** Elenco ID Logici *****
       78  78-ID-ef-cli VALUE 5001.
       78  78-ID-ef-des VALUE 5002.
       78  78-ID-ef-age VALUE 5003.
       78  78-ID-ef-pag VALUE 5004.
       78  78-ID-ef-iva-ese VALUE 5005.
       78  78-ID-ef-piano VALUE 5006.
       78  78-ID-ef-data-ingresso VALUE 5007.
       78  78-ID-ef-note VALUE 5008.
       78  78-ID-cbo-stato VALUE 5009.
       78  78-ID-ef-bolla-num VALUE 5010.
       78  78-ID-ef-bolla-data VALUE 5011.
       78  78-ID-ef-fatt-num VALUE 5012.
       78  78-ID-ef-fatt-data VALUE 5013.
       78  78-ID-form1-gd-1 VALUE 5014.
       78  78-ID-ef-qta-NCPZ VALUE 5015.
       78  78-ID-ef-prz-NCPZ VALUE 5016.
       78  78-ID-ef-consumo-NCPZ VALUE 5017.
       78  78-ID-ef-coubat-NCPZ VALUE 5018.
       78  78-ID-ef-add-NCPZ VALUE 5019.
       78  78-ID-ef-iva-NCPZ VALUE 5020.
       78  78-ID-ef-qta-NCRE VALUE 5021.
       78  78-ID-ef-descr VALUE 5022.
       78  78-ID-ef-prz-NCNC VALUE 5023.
       78  78-ID-ef-consumo-NCNC VALUE 5024.
       78  78-ID-ef-coubat-NCNC VALUE 5025.
       78  78-ID-ef-add-NCNC VALUE 5026.
       78  78-ID-ef-iva-NCNC VALUE 5027.
       78  78-ID-ef-art VALUE 5028.
       78  78-ID-ef-qta VALUE 5029.
       78  78-ID-ef-prz VALUE 5030.
       78  78-ID-ef-consumo VALUE 5031.
       78  78-ID-ef-coubat VALUE 5032.
       78  78-ID-ef-add VALUE 5033.
       78  78-ID-ef-iva VALUE 5034.
       78  78-ID-gd-fatt VALUE 5035.
      ***** Fine ID Logici *****
      *{TOTEM}END

       LINKAGE          SECTION.
      *{TOTEM}LINKAGE
           COPY  "COMMON-LINKAGE.DEF".
           COPY  "LINK-NOTACR.DEF".
      *{TOTEM}END

       SCREEN           SECTION.
      *{TOTEM}COPY-SCREEN
      * FORM
       01 
           Form1, 
           AFTER PROCEDURE Form1-AfterProcedure,
           BEFORE PROCEDURE Form1-BeforeProcedure,
           .

      * TAB
       05
           Screen1-Ta-1, 
           Tab-Control, 
           COL 1,14, 
           LINE 1,77,
           LINES 44,54 ,
           SIZE 157,00 ,
           FONT IS Small-Font,
           ID IS 1,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           EVENT PROCEDURE Screen1-Ta-1-Event-Proc,
           .

      * PAGE
       05
           Screen1-Pg-1, 
           VISIBLE Screen1-Pg-1-Visible,
           COL 2, 
           LINE 4,
           .

      * ENTRY FIELD
       10
           ef-cli, 
           Entry-Field, 
           COL 22,81, 
           LINE 16,84,
           LINES 1,31 ,
           SIZE 7,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 78-ID-ef-cli,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 5,
           VALUE ef-cli-BUF,
           .

      * ENTRY FIELD
       10
           ef-des, 
           Entry-Field, 
           COL 22,81, 
           LINE 19,08,
           LINES 1,31 ,
           SIZE 7,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 78-ID-ef-des,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 5,
           VALUE ef-des-BUF,
           .

      * ENTRY FIELD
       10
           ef-age, 
           Entry-Field, 
           COL 22,81, 
           LINE 21,31,
           LINES 1,31 ,
           SIZE 7,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 78-ID-ef-age,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 5,
           VALUE ef-age-BUF,
           .

      * ENTRY FIELD
       10
           ef-pag, 
           Entry-Field, 
           COL 22,81, 
           LINE 23,54,
           LINES 1,31 ,
           SIZE 7,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 78-ID-ef-pag,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 3,
           VALUE ef-pag-BUF,
           .

      * ENTRY FIELD
       10
           ef-iva-ese, 
           Entry-Field, 
           COL 22,81, 
           LINE 25,77,
           LINES 1,31 ,
           SIZE 7,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 78-ID-ef-iva-ese,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 3,
           VALUE ef-iva-ese-BUF,
           .

      * ENTRY FIELD
       10
           ef-piano, 
           Entry-Field, 
           COL 22,81, 
           LINE 28,00,
           LINES 1,31 ,
           SIZE 11,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 78-ID-ef-piano,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 8,
           VALUE ef-piano-BUF,
           .

      * ENTRY FIELD
       10
           ef-data-ingresso, 
           Entry-Field, 
           COL 22,81, 
           LINE 29,92,
           LINES 1,31 ,
           SIZE 11,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 78-ID-ef-data-ingresso,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           MAX-TEXT 8,
           VALUE ef-data-ingresso-BUF,
           .

      * ENTRY FIELD
       10
           ef-note, 
           Entry-Field, 
           COL 22,81, 
           LINE 31,77,
           LINES 9,00 ,
           SIZE 121,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod,
           FONT IS Courier-New18-Occidentale,
           ID IS 78-ID-ef-note,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 160,
           VSCROLL-BAR,
           USE-RETURN,
           VALUE ef-note-BUF,
           .

      * COMBO-BOX
       10
           cbo-stato, 
           Combo-Box, 
           COL 22,81, 
           LINE 41,77,
           LINES 3,00 ,
           SIZE 17,00 ,
           3-D,
           COLOR IS 513,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 78-ID-cbo-stato,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MASS-UPDATE 0,
           NOTIFY-SELCHANGE,
           DROP-LIST,
           UNSORTED,
           VALUE cbo-stato-buf,
           AFTER PROCEDURE cbo-stato-AfterProcedure, 
           .

      * FRAME
       10
           Screen1-Fr-1b, 
           Frame, 
           COL 2,98, 
           LINE 4,00,
           LINES 11,54 ,
           SIZE 112,50 ,
           COLOR IS 2,
           ID IS 15,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Dati Bozza",
           TITLE-POSITION 3,
           VISIBLE v-bozza,
           .

      * LABEL
       10
           Screen1-La-9b, 
           Label, 
           COL 34,15, 
           LINE 5,00,
           LINES 1,31 ,
           SIZE 3,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 16,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "del",
           VISIBLE v-bozza,
           .

      * LABEL
       10
           lab-tipodocb, 
           Label, 
           COL 4,48, 
           LINE 5,00,
           LINES 1,31 ,
           SIZE 8,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 17,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Bolla n.",
           VISIBLE v-bozza,
           .

      * LABEL
       10
           lab-tipodocba, 
           Label, 
           COL 4,48, 
           LINE 6,92,
           LINES 2,54 ,
           SIZE 11,67 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 20,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Motivo contestazione",
           VISIBLE v-bozza,
           .

      * LABEL
       10
           lab-motivo, 
           Label, 
           COL 17,31, 
           LINE 6,92,
           LINES 2,54 ,
           SIZE 95,33 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 21,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-motivo-buf,
           VISIBLE v-bozza,
           .

      * LABEL
       10
           lab-tipodocbb, 
           Label, 
           COL 4,48, 
           LINE 10,15,
           LINES 1,31 ,
           SIZE 11,67 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 22,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Errore colpa",
           VISIBLE v-bozza,
           .

      * LABEL
       10
           lab-colpa, 
           Label, 
           COL 17,31, 
           LINE 10,15,
           LINES 1,31 ,
           SIZE 17,83 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 23,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-colpa-buf,
           VISIBLE v-bozza,
           .

      * LABEL
       10
           lab-tipodocbaa, 
           Label, 
           COL 4,65, 
           LINE 12,23,
           LINES 2,54 ,
           SIZE 11,67 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 24,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Altre annotazioni",
           VISIBLE v-bozza,
           .

      * LABEL
       10
           lab-altre, 
           Label, 
           COL 17,31, 
           LINE 12,23,
           LINES 2,00 ,
           SIZE 97,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 25,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-altre-buf,
           VISIBLE v-bozza,
           .

      * LABEL
       10
           lab-corriere, 
           Label, 
           COL 47,98, 
           LINE 10,15,
           LINES 1,31 ,
           SIZE 5,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 26,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-corriere-buf,
           VISIBLE v-bozza,
           .

      * LABEL
       10
           lab-tipodocbba, 
           Label, 
           COL 39,65, 
           LINE 10,15,
           LINES 1,31 ,
           SIZE 7,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 27,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Corriere",
           VISIBLE v-bozza,
           .

      * LABEL
       10
           lab-corriere-des, 
           Label, 
           COL 54,98, 
           LINE 10,15,
           LINES 1,31 ,
           SIZE 40,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 28,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-corriere-des-buf,
           VISIBLE v-bozza,
           .

      * LABEL
       10
           lab-num-bolla, 
           Label, 
           COL 17,31, 
           LINE 5,00,
           LINES 1,31 ,
           SIZE 15,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 10,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           TRANSPARENT,
           TITLE lab-num-bolla-buf,
           VISIBLE v-bozza,
           .

      * LABEL
       10
           lab-data-bolla, 
           Label, 
           COL 39,81, 
           LINE 5,00,
           LINES 1,31 ,
           SIZE 10,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 9,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE lab-data-bolla-buf,
           VISIBLE v-bozza,
           .

      * FRAME
       10
           Screen1-Fr-1a, 
           Frame, 
           COL 118,48, 
           LINE 4,00,
           LINES 4,85 ,
           SIZE 38,00 ,
           COLOR IS 2,
           ID IS 6,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Riferimenti documento",
           TITLE-POSITION 3,
           VISIBLE v-bozza,
           .

      * LABEL
       10
           Screen1-La-9a, 
           Label, 
           COL 140,48, 
           LINE 5,23,
           LINES 1,31 ,
           SIZE 3,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 7,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "del",
           VISIBLE v-bozza,
           .

      * LABEL
       10
           lab-tipodoca, 
           Label, 
           COL 119,98, 
           LINE 5,23,
           LINES 1,31 ,
           SIZE 8,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 8,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Bozza n.",
           VISIBLE v-bozza,
           .

      * LABEL
       10
           lab-data-b, 
           Label, 
           COL 144,48, 
           LINE 5,23,
           LINES 1,31 ,
           SIZE 10,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 11,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE lab-data-buf,
           VISIBLE v-bozza,
           .

      * LABEL
       10
           lab-num-b, 
           Label, 
           COL 129,48, 
           LINE 5,23,
           LINES 1,31 ,
           SIZE 9,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 12,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           TRANSPARENT,
           TITLE lab-num-buf,
           VISIBLE v-bozza,
           .

      * LABEL
       10
           lab-tipodocaa, 
           Label, 
           COL 119,98, 
           LINE 7,08,
           LINES 1,31 ,
           SIZE 8,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 13,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Fattura n.",
           VISIBLE v-bozza,
           .

      * LABEL
       10
           Screen1-La-9aa, 
           Label, 
           COL 140,48, 
           LINE 7,08,
           LINES 1,31 ,
           SIZE 3,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 14,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "del",
           VISIBLE v-bozza,
           .

      * LABEL
       10
           lab-num-f, 
           Label, 
           COL 129,48, 
           LINE 7,08,
           LINES 1,31 ,
           SIZE 9,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 18,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           TRANSPARENT,
           TITLE lab-num-f-buf,
           VISIBLE v-bozza,
           .

      * LABEL
       10
           lab-data-f, 
           Label, 
           COL 144,48, 
           LINE 7,08,
           LINES 1,31 ,
           SIZE 10,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 19,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE lab-data-f-buf,
           VISIBLE v-bozza,
           .

      * FRAME
       10
           Screen1-Fr-1, 
           Frame, 
           COL 118,48, 
           LINE 12,77,
           LINES 2,77 ,
           SIZE 38,00 ,
           COLOR IS 2,
           ID IS 61,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Riferimenti documento",
           TITLE-POSITION 3,
           VISIBLE v-fatt,
           .

      * LABEL
       10
           Screen1-La-9, 
           Label, 
           COL 140,48, 
           LINE 13,77,
           LINES 1,31 ,
           SIZE 3,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 62,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "del",
           VISIBLE v-fatt,
           .

      * LABEL
       10
           lab-tipodoc, 
           Label, 
           COL 119,98, 
           LINE 13,77,
           LINES 1,31 ,
           SIZE 8,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 63,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Fattura n.",
           VISIBLE v-fatt,
           .

      * LABEL
       10
           lab-num, 
           Label, 
           COL 129,48, 
           LINE 13,77,
           LINES 1,31 ,
           SIZE 9,00 ,
           COLOR IS 2,
           ID IS 64,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           TRANSPARENT,
           TITLE lab-num-buf,
           VISIBLE v-fatt,
           .

      * LABEL
       10
           lab-data, 
           Label, 
           COL 144,48, 
           LINE 13,77,
           LINES 1,31 ,
           SIZE 11,00 ,
           COLOR IS 2,
           ID IS 65,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE lab-data-buf,
           VISIBLE v-fatt,
           .

      * LABEL
       10
           Screen1-La-1, 
           Label, 
           COL 3,81, 
           LINE 16,84,
           LINES 1,31 ,
           SIZE 18,00 ,
           FONT IS Small-Font,
           ID IS 81,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Codice Cliente",
           .

      * LABEL
       10
           Screen1-La-2, 
           Label, 
           COL 3,81, 
           LINE 19,08,
           LINES 1,30 ,
           SIZE 18,00 ,
           FONT IS Small-Font,
           ID IS 83,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Progressivo Destino",
           .

      * LABEL
       10
           Screen1-La-4, 
           Label, 
           COL 3,81, 
           LINE 21,31,
           LINES 1,30 ,
           SIZE 18,00 ,
           FONT IS Small-Font,
           ID IS 87,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Codice Agente",
           .

      * LABEL
       10
           Screen1-La-5, 
           Label, 
           COL 3,81, 
           LINE 23,54,
           LINES 1,30 ,
           SIZE 18,00 ,
           FONT IS Small-Font,
           ID IS 89,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Codice Pagamento",
           .

      * LABEL
       10
           Screen1-La-6, 
           Label, 
           COL 3,81, 
           LINE 25,77,
           LINES 1,31 ,
           SIZE 18,00 ,
           FONT IS Small-Font,
           ID IS 91,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Codice Esenzione IVA",
           .

      * LABEL
       10
           Screen1-La-7, 
           Label, 
           COL 3,81, 
           LINE 31,77,
           LINES 1,31 ,
           SIZE 18,00 ,
           FONT IS Small-Font,
           ID IS 93,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Intestazione",
           .

      * LABEL
       10
           lab-iva, 
           Label, 
           COL 30,81, 
           LINE 25,77,
           LINES 1,31 ,
           SIZE 77,00 ,
           COLOR IS 5,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 97,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-iva-buf,
           .

      * LABEL
       10
           lab-pag, 
           Label, 
           COL 30,81, 
           LINE 23,54,
           LINES 1,31 ,
           SIZE 77,00 ,
           COLOR IS 5,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 98,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-pag-buf,
           .

      * LABEL
       10
           lab-age, 
           Label, 
           COL 30,81, 
           LINE 21,31,
           LINES 1,31 ,
           SIZE 77,00 ,
           COLOR IS 5,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 99,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-age-buf,
           .

      * LABEL
       10
           lab-cli, 
           Label, 
           COL 30,81, 
           LINE 16,84,
           LINES 2,00 ,
           SIZE 40,00 ,
           COLOR IS 5,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 100,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-cli-buf,
           .

      * LABEL
       10
           lab-ind, 
           Label, 
           COL 72,81, 
           LINE 16,84,
           LINES 2,00 ,
           SIZE 40,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 101,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-ind-buf,
           .

      * LABEL
       10
           lab-loca, 
           Label, 
           COL 114,81, 
           LINE 16,84,
           LINES 2,00 ,
           SIZE 40,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 102,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-loca-buf,
           .

      * LABEL
       10
           lab-des, 
           Label, 
           COL 30,81, 
           LINE 19,08,
           LINES 2,00 ,
           SIZE 40,00 ,
           COLOR IS 5,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 103,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-des-buf,
           .

      * LABEL
       10
           lab-ind-d, 
           Label, 
           COL 72,81, 
           LINE 19,08,
           LINES 2,00 ,
           SIZE 40,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 104,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-ind-d-buf,
           .

      * LABEL
       10
           lab-loca-d, 
           Label, 
           COL 114,81, 
           LINE 19,08,
           LINES 2,00 ,
           SIZE 40,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 105,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-loca-d-buf,
           .

      * LABEL
       10
           Form1-La-29, 
           Label, 
           COL 3,81, 
           LINE 41,77,
           LINES 1,31 ,
           SIZE 15,00 ,
           FONT IS Small-Font,
           ID IS 57,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Stato",
           .

      * LABEL
       10
           Screen1-blockpgm-1, 
           Label, 
           COL 152,64, 
           LINE 17,15,
           LINES 0,77 ,
           SIZE 3,17 ,
           ID IS 59,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "BlockPgm",
           VISIBLE v-custom,
           .

      * LABEL
       10
           Screen1-Custom1-1, 
           Label, 
           COL 140,64, 
           LINE 17,00,
           LINES 0,69 ,
           SIZE 4,83 ,
           FONT IS Default-Font,
           ID IS 60,
           TRANSPARENT,
           TITLE "CUSTOM CONTROL",
           VISIBLE v-custom,
           .

      * LABEL
       10
           Screen1-La-8a, 
           Label, 
           COL 3,81, 
           LINE 28,00,
           LINES 1,31 ,
           SIZE 18,00 ,
           FONT IS Small-Font,
           ID IS 2,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Contropartita Contabile",
           .

      * LABEL
       10
           lab-piano, 
           Label, 
           COL 34,81, 
           LINE 28,00,
           LINES 1,31 ,
           SIZE 82,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 5,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-piano-buf,
           .

      * BAR
       10
           Screen1-Br-2, 
           Bar,
           COL 90,81, 
           LINE 30,77,
           LINES 1,00 ,
           ID IS 29,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           WIDTH 2,
           .

      * FRAME
       10
           Screen1-Fr-1aa, 
           Frame, 
           COL 118,48, 
           LINE 25,54,
           LINES 5,00 ,
           SIZE 38,00 ,
           COLOR IS 2,
           ID IS 30,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Riferimenti documento per EDI",
           TITLE-POSITION 3,
           .

      * LABEL
       10
           Screen1-La-9ab, 
           Label, 
           COL 140,48, 
           LINE 26,77,
           LINES 1,31 ,
           SIZE 3,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 31,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "del",
           .

      * LABEL
       10
           lab-tipodocab, 
           Label, 
           COL 119,98, 
           LINE 26,77,
           LINES 1,31 ,
           SIZE 8,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 32,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Bolla n.",
           .

      * LABEL
       10
           lab-tipodocaaa, 
           Label, 
           COL 119,98, 
           LINE 28,62,
           LINES 1,31 ,
           SIZE 8,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 33,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Fattura n.",
           .

      * LABEL
       10
           Screen1-La-9aaa, 
           Label, 
           COL 140,48, 
           LINE 28,62,
           LINES 1,31 ,
           SIZE 3,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 34,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "del",
           .

      * ENTRY FIELD
       10
           ef-bolla-num, 
           Entry-Field, 
           COL 129,48, 
           LINE 26,77,
           LINES 1,31 ,
           SIZE 9,50 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-ef-bolla-num,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 8,
           VALUE ef-bolla-num-BUF,
           BEFORE PROCEDURE Screen1-DaEf-1-BeforeProcedure, 
           .
      * ENTRY FIELD
       10
           ef-bolla-data, 
           Entry-Field, 
           COL 144,48, 
           LINE 26,77,
           LINES 1,31 ,
           SIZE 11,00 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-ef-bolla-data,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           MAX-TEXT 8,
           VALUE ef-bolla-data-BUF,
           BEFORE PROCEDURE Screen1-DaEf-2-BeforeProcedure, 
           .

      * ENTRY FIELD
       10
           ef-fatt-num, 
           Entry-Field, 
           COL 129,48, 
           LINE 28,62,
           LINES 1,31 ,
           SIZE 9,00 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-ef-fatt-num,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 8,
           VALUE ef-fatt-num-BUF,
           BEFORE PROCEDURE Screen1-DaEf-3-BeforeProcedure, 
           .
      * ENTRY FIELD
       10
           ef-fatt-data, 
           Entry-Field, 
           COL 144,48, 
           LINE 28,62,
           LINES 1,31 ,
           SIZE 11,00 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-ef-fatt-data,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           MAX-TEXT 8,
           VALUE ef-fatt-data-BUF,
           BEFORE PROCEDURE Screen1-DaEf-4-BeforeProcedure, 
           .

      * LABEL
       10
           Screen1-La-8aa, 
           Label, 
           COL 3,81, 
           LINE 29,92,
           LINES 1,31 ,
           SIZE 18,00 ,
           FONT IS Small-Font,
           ID IS 39,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Data ingresso merce",
           .

      * PAGE
       05
           Screen1-Pg-2, 
           VISIBLE Screen1-Pg-2-Visible,
           COL 2, 
           LINE 4,
           .

      * PUSH BUTTON
       10
           pb-nuovo-0, 
           Push-Button, 
           COL pb-nuovo-0-column,
           LINE 39,15,
           LINES 21,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE STRIP_GRID_GCLIENTI-BMP,
           BITMAP-NUMBER 5,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 5000,
           FLAT,
           FONT IS Small-Font,
           ID IS 40,
           SELF-ACT,
           TITLE "N&uova riga",
           VISIBLE v-0,
           AFTER PROCEDURE pb-nuovo-0-AfterProcedure, 
           BEFORE PROCEDURE pb-nuovo-0-BeforeProcedure, 
           .

      * PUSH BUTTON
       10
           pb-elimina-0, 
           Push-Button, 
           COL pb-elimina-0-column,
           LINE 39,15,
           LINES 21,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE STRIP_GRID_GCLIENTI-BMP,
           BITMAP-NUMBER 4,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 5001,
           FLAT,
           FONT IS Small-Font,
           ID IS 41,
           SELF-ACT,
           TITLE "&Elimina la riga selezionata",
           VISIBLE v-0,
           AFTER PROCEDURE pb-elimina-0-AfterProcedure, 
           BEFORE PROCEDURE pb-elimina-0-BeforeProcedure, 
           .

      * PUSH BUTTON
       10
           pb-nuovo-ncnc, 
           Push-Button, 
           COL 129,14, 
           LINE 39,15,
           LINES 21,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE STRIP_GRID_GCLIENTI-BMP,
           BITMAP-NUMBER 5,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 5002,
           FLAT,
           FONT IS Small-Font,
           ID IS 42,
           SELF-ACT,
           TITLE "N&uova riga",
           VISIBLE v-ncnc,
           AFTER PROCEDURE pb-nuovo-ncnc-AfterProcedure, 
           BEFORE PROCEDURE pb-nuovo-ncnc-BeforeProcedure, 
           .

      * PUSH BUTTON
       10
           pb-elimina-ncnc, 
           Push-Button, 
           COL 142,14, 
           LINE 39,15,
           LINES 21,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE STRIP_GRID_GCLIENTI-BMP,
           BITMAP-NUMBER 4,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 5003,
           FLAT,
           FONT IS Small-Font,
           ID IS 43,
           SELF-ACT,
           TITLE "&Elimina la riga selezionata",
           VISIBLE v-ncnc,
           AFTER PROCEDURE pb-elimina-ncnc-AfterProcedure, 
           BEFORE PROCEDURE pb-elimina-ncnc-BeforeProcedure, 
           .

      * GRID
       10
           form1-gd-1, 
           Grid, 
           COL 3,81, 
           LINE grid-line,
           LINES grid-lines ,
           SIZE 151,00 ,
           ADJUSTABLE-COLUMNS,
           BOXED,
           CENTERED-HEADINGS,
           COLOR IS 516,
           DATA-COLUMNS (1, 6, 12, 162, 170, 184, 198, 212, 220),
           ALIGNMENT ("R", "R", "U", "R", "R", "R", "R", "R", "C"),
           SEPARATION (5, 5, 5, 5, 5, 5, 5, 5, 5),
           DATA-TYPES ("9(5)", "9(6)", "X", "9(8)", "9(12)", "9(12)", "9
      -    "(12)", "X", "x(3)"),
           NUM-COL-HEADINGS 1,
           COLUMN-HEADINGS,
           CURSOR-FRAME-WIDTH 0,
           DIVIDER-COLOR 1,
           HEADING-COLOR 257,
           HEADING-DIVIDER-COLOR 1,
           ID IS 78-ID-form1-gd-1,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           ROW-HEADINGS,
           TILED-HEADINGS,
           VIRTUAL-WIDTH 147,
           VPADDING 50,
           VSCROLL,
           BEFORE PROCEDURE form1-gd-1-BeforeProcedure, 
           EVENT PROCEDURE form1-gd-1-Event-Proc,
           .

      * ENTRY FIELD
       10
           ef-qta-NCPZ, 
           Entry-Field, 
           COL 10,81, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 10,50 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 78-ID-ef-qta-NCPZ,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 8,
           VALUE ef-qta-NCPZ-buf,
           VISIBLE v-ncpz,
           AFTER PROCEDURE ef-qta-NCPZ-AfterProcedure, 
           .


      * ENTRY FIELD
       10
           ef-prz-NCPZ, 
           Entry-Field, 
           COL 31,81, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 10,50 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 78-ID-ef-prz-NCPZ,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 11,
           VALUE ef-prz-NCPZ-buf,
           VISIBLE v-ncpz,
           AFTER PROCEDURE ef-prz-NCPZ-AfterProcedure, 
           .


      * ENTRY FIELD
       10
           ef-consumo-NCPZ, 
           Entry-Field, 
           COL 54,81, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 8,00 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 78-ID-ef-consumo-NCPZ,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 6,
           VALUE ef-consumo-ncpz-buf,
           VISIBLE v-ncpz,
           AFTER PROCEDURE ef-consumo-NCPZ-AfterProcedure, 
           .


      * ENTRY FIELD
       10
           ef-coubat-NCPZ, 
           Entry-Field, 
           COL 77,81, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 8,00 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 78-ID-ef-coubat-NCPZ,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 6,
           VALUE ef-coubat-ncpz-buf,
           VISIBLE v-ncpz,
           AFTER PROCEDURE ef-coubat-NCPZ-AfterProcedure, 
           .


      * ENTRY FIELD
       10
           ef-add-NCPZ, 
           Entry-Field, 
           COL 99,48, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 8,00 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 78-ID-ef-add-NCPZ,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 6,
           VALUE ef-add-ncpz-buf,
           VISIBLE v-ncpz,
           AFTER PROCEDURE ef-add-NCPZ-AfterProcedure, 
           .


      * ENTRY FIELD
       10
           ef-iva-NCPZ, 
           Entry-Field, 
           COL 121,14, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 7,00 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 78-ID-ef-iva-NCPZ,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 3,
           VALUE ef-iva-NCPZ-buf,
           VISIBLE v-ncpz,
           AFTER PROCEDURE ef-iva-NCPZ-AfterProcedure, 
           .

      * ENTRY FIELD
       10
           ef-qta-NCRE, 
           Entry-Field, 
           COL 137,48, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 10,50 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 78-ID-ef-qta-NCRE,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 8,
           VALUE ef-qta-NCRE-buf,
           VISIBLE v-ncre,
           AFTER PROCEDURE ef-qta-NCRE-AfterProcedure, 
           .

      * ENTRY FIELD
       10
           ef-art-ncnc, 
           Entry-Field, 
           COL 10,31, 
           LINE 39,61,
           LINES 1,31 ,
           SIZE 8,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod-campi,
           FONT IS Small-Font,
           ID IS 45,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 6,
           VALUE ef-art-buf,
           VISIBLE v-ncnc,
           AFTER PROCEDURE ef-art-ncnc-AfterProcedure, 
           .


      * PUSH BUTTON
       10
           pb-art-ncnc, 
           Push-Button, 
           COL 19,64, 
           LINE 39,61,
           LINES 1,31 ,
           SIZE 3,17 ,
           ENABLED mod-campi,
           EXCEPTION-VALUE 2345,
           FONT IS Small-Font,
           ID IS 46,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "...",
           VISIBLE v-ncnc,
           .

      * ENTRY FIELD
       10
           ef-descr, 
           Entry-Field, 
           COL 10,81, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 58,00 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 78-ID-ef-descr,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 150,
           VALUE ef-descr-buf,
           VISIBLE v-ncnc,
           AFTER PROCEDURE ef-descr-AfterProcedure, 
           .

      * ENTRY FIELD
       10
           ef-prz-NCNC, 
           Entry-Field, 
           COL 76,98, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 10,00 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 78-ID-ef-prz-NCNC,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 11,
           VALUE ef-prz-NCNC-buf,
           VISIBLE v-ncnc,
           AFTER PROCEDURE ef-prz-NCNC-AfterProcedure, 
           .

      * ENTRY FIELD
       10
           ef-consumo-NCNC, 
           Entry-Field, 
           COL 93,81, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 8,00 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 78-ID-ef-consumo-NCNC,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 6,
           VALUE ef-consumo-NCNC-buf,
           VISIBLE v-ncnc,
           AFTER PROCEDURE ef-consumo-NCNC-AfterProcedure, 
           .


      * ENTRY FIELD
       10
           ef-coubat-NCNC, 
           Entry-Field, 
           COL 112,48, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 8,00 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 78-ID-ef-coubat-NCNC,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 6,
           VALUE ef-coubat-NCNC-buf,
           VISIBLE v-ncnc,
           AFTER PROCEDURE ef-coubat-NCNC-AfterProcedure, 
           .


      * ENTRY FIELD
       10
           ef-add-NCNC, 
           Entry-Field, 
           COL 132,14, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 8,00 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 78-ID-ef-add-NCNC,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 6,
           VALUE ef-add-NCNC-buf,
           VISIBLE v-ncnc,
           AFTER PROCEDURE ef-add-NCNC-AfterProcedure, 
           .


      * ENTRY FIELD
       10
           ef-iva-NCNC, 
           Entry-Field, 
           COL 147,81, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 7,00 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 78-ID-ef-iva-NCNC,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 3,
           VALUE ef-iva-NCNC-buf,
           VISIBLE v-ncnc,
           AFTER PROCEDURE ef-iva-NCNC-AfterProcedure, 
           .

      * ENTRY FIELD
       10
           ef-art, 
           Entry-Field, 
           COL 10,81, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 8,00 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 78-ID-ef-art,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 6,
           VALUE ef-art-buf,
           VISIBLE v-0,
           AFTER PROCEDURE ef-art-AfterProcedure, 
           .


      * ENTRY FIELD
       10
           ef-qta, 
           Entry-Field, 
           COL 64,14, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 7,00 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 78-ID-ef-qta,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 8,
           VALUE ef-qta-buf,
           VISIBLE v-0,
           AFTER PROCEDURE ef-qta-AfterProcedure, 
           .


      * ENTRY FIELD
       10
           ef-prz, 
           Entry-Field, 
           COL 79,48, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 10,00 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 78-ID-ef-prz,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 11,
           VALUE ef-prz-buf,
           VISIBLE v-0,
           AFTER PROCEDURE ef-prz-AfterProcedure, 
           .


      * ENTRY FIELD
       10
           ef-consumo, 
           Entry-Field, 
           COL 95,81, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 8,00 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 78-ID-ef-consumo,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 6,
           VALUE ef-consumo-buf,
           VISIBLE v-0,
           AFTER PROCEDURE ef-consumo-AfterProcedure, 
           .


      * ENTRY FIELD
       10
           ef-coubat, 
           Entry-Field, 
           COL 113,98, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 8,00 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 78-ID-ef-coubat,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 6,
           VALUE ef-coubat-buf,
           VISIBLE v-0,
           AFTER PROCEDURE ef-coubat-AfterProcedure, 
           .


      * ENTRY FIELD
       10
           ef-add, 
           Entry-Field, 
           COL 132,31, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 8,00 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 78-ID-ef-add,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 6,
           VALUE ef-add-buf,
           VISIBLE v-0,
           AFTER PROCEDURE ef-add-AfterProcedure, 
           .


      * ENTRY FIELD
       10
           ef-iva, 
           Entry-Field, 
           COL 147,81, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 7,00 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 78-ID-ef-iva,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 3,
           VALUE ef-iva-buf,
           VISIBLE v-0,
           AFTER PROCEDURE ef-iva-AfterProcedure, 
           .


      * GRID
       10
           gd-fatt, 
           Grid, 
           COL 3,81, 
           LINE 4,46,
           LINES 15,54 ,
           SIZE 151,00 ,
           ADJUSTABLE-COLUMNS,
           BOXED,
           CENTERED-HEADINGS,
           COLOR IS 516,
           DATA-COLUMNS (1, 6, 12, 62, 70, 84, 89, 97, 105, 113, 127, 
           130),
           ALIGNMENT ("R", "R", "U", "R", "R", "R", "R", "R", "R", "R", 
           "C", "C"),
           SEPARATION (5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5),
           DATA-TYPES ("9(5)", "9(6)", "X", "9(8)", "9(12)", "9(5)", "9(
      -    "7)", "9(7)", "X", "9(12)", "x(3)", "X"),
           NUM-COL-HEADINGS 1,
           COLUMN-HEADINGS,
           CURSOR-FRAME-WIDTH 0,
           DIVIDER-COLOR 1,
           HEADING-COLOR 257,
           HEADING-DIVIDER-COLOR 1,
           ID IS 78-ID-gd-fatt,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           ROW-HEADINGS,
           TILED-HEADINGS,
           VISIBLE v-grid,
           VPADDING 50,
           VSCROLL,
           EVENT PROCEDURE gd-fatt-Event-Proc,
           .

      * PUSH BUTTON
       10
           pb-sel-tutto, 
           Push-Button, 
           COL 3,14, 
           LINE 20,46,
           LINES 29,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE SEL-TUTTO-BMP,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 1003,
           FLAT,
           ID IS 7001,
           TITLE "Seleziona tutto",
           VISIBLE v-sel-tutto,
           AFTER PROCEDURE pb-sel-tutto-AfterProcedure, 
           BEFORE PROCEDURE pb-sel-tutto-BeforeProcedure, 
           .

      * PUSH BUTTON
       10
           pb-genera, 
           Push-Button, 
           COL 72,81, 
           LINE 20,46,
           LINES 29,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE GENERA-BMP,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 1000,
           FLAT,
           ID IS 73,
           SELF-ACT,
           TITLE "Genera",
           VISIBLE v-grid,
           AFTER PROCEDURE pb-genera-AfterProcedure, 
           BEFORE PROCEDURE pb-genera-BeforeProcedure, 
           .

      * BAR
       10
           Screen1-Br-1, 
           Bar,
           COL 3,81, 
           LINE 41,46,
           SIZE 151,00 ,
           ID IS 86,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           COLORS (1),
           SHADING (-1),
           WIDTH 1,
           .

      * BAR
       10
           Screen1-Br-1a, 
           Bar,
           COL 3,81, 
           LINE 42,00,
           SIZE 151,00 ,
           ID IS 95,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           COLORS (1),
           SHADING (-1),
           WIDTH 1,
           .

      * LABEL
       10
           Screen1-La-11, 
           Label, 
           COL 3,81, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 4,00 ,
           FONT IS Small-Font,
           ID IS 96,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Q.tà",
           VISIBLE v-ncpz,
           .

      * LABEL
       10
           Screen1-La-12, 
           Label, 
           COL 24,81, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 6,00 ,
           FONT IS Small-Font,
           ID IS 106,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Prezzo",
           VISIBLE v-ncpz,
           .

      * LABEL
       10
           Screen1-La-13, 
           Label, 
           COL 112,14, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 8,00 ,
           FONT IS Small-Font,
           ID IS 107,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Cod. IVA",
           VISIBLE v-ncpz,
           .

      * LABEL
       10
           Screen1-La-11a, 
           Label, 
           COL 130,48, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 4,00 ,
           FONT IS Small-Font,
           ID IS 108,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Q.tà",
           VISIBLE v-ncre,
           .

      * LABEL
       10
           Screen1-La-14, 
           Label, 
           COL 3,81, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 5,00 ,
           FONT IS Small-Font,
           ID IS 109,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Voce",
           VISIBLE v-ncnc,
           .

      * LABEL
       10
           Screen1-La-12a, 
           Label, 
           COL 69,98, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 6,00 ,
           FONT IS Small-Font,
           ID IS 110,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Importo",
           VISIBLE v-ncnc,
           .

      * LABEL
       10
           Screen1-La-13a, 
           Label, 
           COL 141,81, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 5,50 ,
           FONT IS Small-Font,
           ID IS 111,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "C. IVA",
           VISIBLE v-ncnc,
           .

      * LABEL
       10
           Screen1-La-3, 
           Label, 
           COL 3,81, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 6,00 ,
           FONT IS Small-Font,
           ID IS 112,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Articolo",
           VISIBLE v-0,
           .

      * LABEL
       10
           lab-art, 
           Label, 
           COL 19,81, 
           LINE EF-LinesWithout,
           LINES 2,00 ,
           SIZE 39,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 113,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-art-buf,
           VISIBLE v-0,
           .

      * LABEL
       10
           Screen1-La-15, 
           Label, 
           COL 59,81, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 4,00 ,
           FONT IS Small-Font,
           ID IS 114,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Q.tà",
           VISIBLE v-0,
           .

      * LABEL
       10
           Screen1-La-16, 
           Label, 
           COL 72,48, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 6,00 ,
           FONT IS Small-Font,
           ID IS 115,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Prezzo",
           VISIBLE v-0,
           .

      * LABEL
       10
           Screen1-La-17, 
           Label, 
           COL 141,31, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 5,50 ,
           FONT IS Small-Font,
           ID IS 116,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "C. IVA",
           VISIBLE v-0,
           .

      * LABEL
       10
           Screen1-La-16a, 
           Label, 
           COL 90,14, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 5,00 ,
           FONT IS Small-Font,
           ID IS 117,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Cons.",
           VISIBLE v-0,
           .

      * LABEL
       10
           Screen1-La-16aa, 
           Label, 
           COL 104,48, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 9,00 ,
           FONT IS Small-Font,
           ID IS 118,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Cou/Cobat",
           VISIBLE v-0,
           .

      * LABEL
       10
           Screen1-La-16aaa, 
           Label, 
           COL 102,98, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 9,00 ,
           FONT IS Small-Font,
           ID IS 119,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Cou/Cobat",
           VISIBLE v-ncnc,
           .

      * LABEL
       10
           Screen1-La-16ab, 
           Label, 
           COL 88,14, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 5,00 ,
           FONT IS Small-Font,
           ID IS 120,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Cons.",
           VISIBLE v-ncnc,
           .

      * LABEL
       10
           Screen1-La-16aab, 
           Label, 
           COL 66,81, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 9,00 ,
           FONT IS Small-Font,
           ID IS 121,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Cou/Cobat",
           VISIBLE v-ncpz,
           .

      * LABEL
       10
           Screen1-La-16ac, 
           Label, 
           COL 45,81, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 8,00 ,
           FONT IS Small-Font,
           ID IS 122,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Consumo",
           VISIBLE v-ncpz,
           .

      * LABEL
       10
           Screen1-La-16aac, 
           Label, 
           COL 122,81, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 9,00 ,
           FONT IS Small-Font,
           ID IS 123,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Ad. piombo",
           VISIBLE v-0,
           .

      * LABEL
       10
           Screen1-La-16aaba, 
           Label, 
           COL 88,48, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 10,00 ,
           FONT IS Small-Font,
           ID IS 124,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Ad. piombo",
           VISIBLE v-ncpz,
           .

      * LABEL
       10
           Screen1-La-16aaaa, 
           Label, 
           COL 122,64, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 9,00 ,
           FONT IS Small-Font,
           ID IS 125,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Ad. piombo",
           VISIBLE v-ncnc,
           .

      * LABEL
       10
           lab-art-ncnc, 
           Label, 
           COL 3,81, 
           LINE 39,61,
           LINES 1,31 ,
           SIZE 6,00 ,
           FONT IS Small-Font,
           ID IS 126,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Articolo",
           VISIBLE v-ncnc,
           .

      * LABEL
       05
           lab-anno, 
           Label, 
           COL 62,50, 
           LINE 1,38,
           LINES 1,54 ,
           SIZE 35,00 ,
           COLOR IS 2,
           FONT IS Verdana12B-Occidentale,
           ID IS 127,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE lab-anno-buf,
           .

      * TOOLBAR
       01
           Form1-Tb-1,
           .    

      * PUSH BUTTON
       05
           TOOL-ESCI, 
           Push-Button, 
           COL 1,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           ENABLED E-ESCI,
           EXCEPTION-VALUE 27,
           FLAT,
           ID IS 128,
           SELF-ACT,
           ESCAPE-BUTTON,
           TITLE "Esci (Esc)",
           .

      * PUSH BUTTON
       05
           TOOL-NUOVO, 
           Push-Button, 
           COL 6,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           BITMAP-NUMBER 23,
           FRAMED,
           SQUARE,
           ENABLED E-NUOVO,
           FLAT,
           ID IS 129,
           SELF-ACT,
           TITLE "Nuovo (F2)",
           .

      * PUSH BUTTON
       05
           TOOL-CANCELLA, 
           Push-Button, 
           COL 16,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           FRAMED,
           SQUARE,
           ENABLED E-CANCELLA,
           FLAT,
           ID IS 68,
           SELF-ACT,
           TITLE "Cancella (F4)",
           BITMAP-NUMBER BitmapNumDelete
           .

      * PUSH BUTTON
       05
           TOOL-SALVA, 
           Push-Button, 
           COL 11,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           FRAMED,
           SQUARE,
           ENABLED E-SALVA,
           EXCEPTION-VALUE 3,
           FLAT,
           ID IS 69,
           SELF-ACT,
           TITLE "Salva (F3)",
           BITMAP-NUMBER BitmapNumSave
           .

      * PUSH BUTTON
       05
           TOOL-ANTEPRIMA, 
           Push-Button, 
           COL 26,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           BITMAP-NUMBER 17,
           FRAMED,
           SQUARE,
           ENABLED E-ANTEPRIMA,
           EXCEPTION-VALUE 6,
           FLAT,
           ID IS 70,
           SELF-ACT,
           TITLE "Anteprima (F6)",
           .

      * CHECK BOX
       05
           TOOL-MODIFICA, 
           Check-Box, 
           COL 21,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           BITMAP-NUMBER 5,
           FRAMED,
           SQUARE,
           ENABLED E-MODIFICA,
           EXCEPTION-VALUE 150
           FLAT,
           ID IS 71,
           SELF-ACT,
           TITLE "Modifica (F5)",
           VALUE 1,
           BITMAP-NUMBER BitmapNumEdit
           AFTER PROCEDURE TOOL-MODIFICA-AfterProcedure,
           BEFORE PROCEDURE TOOL-MODIFICA-BeforeProcedure, 
           .
      * PUSH BUTTON
       05
           TOOL-STAMPA, 
           Push-Button, 
           COL 31,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           BITMAP-NUMBER 18,
           FRAMED,
           SQUARE,
           ENABLED E-STAMPA,
           EXCEPTION-VALUE 7,
           FLAT,
           ID IS 72,
           SELF-ACT,
           TITLE "Stampa (F7)",
           .

      * PUSH BUTTON
       05
           TOOL-CERCA, 
           Push-Button, 
           COL 36,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           FRAMED,
           SQUARE,
           ENABLED E-CERCA,
           EXCEPTION-VALUE 8,
           FLAT,
           ID IS 130,
           SELF-ACT,
           TITLE "Cerca (F8)",
           BITMAP-NUMBER=BitmapNumZoom
           .

      * PUSH BUTTON
       05
           TOOL-SELEZIONA, 
           Push-Button, 
           COL 41,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           FRAMED,
           SQUARE,
           ENABLED E-SELEZIONA,
           FLAT,
           ID IS 131,
           SELF-ACT,
           TITLE "Seleziona (F9)",
           BITMAP-NUMBER BitmapNumSelect
           .

      *{TOTEM}END

      *{TOTEM}LINKPARA
       PROCEDURE  DIVISION USING LK-BLOCKPGM, USER-CODI, LIVELLO-ABIL, 
           notacr-linkage.
      *{TOTEM}END

      *{TOTEM}DECLARATIVE
       DECLARATIVES.
      * <TOTEM:EPT. INIT:notacr, INIT:notacr, BeforeDeclarative>
      ***---
       AGENTI-ERR SECTION.
           use after error procedure on agenti.
           set tutto-ok  to true.
           evaluate status-agenti
           when "35"
                display message "File [AGENTI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [AGENTI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[AGENTI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       TPARAMGE-ERR SECTION.
           use after error procedure on tparamge.
           set tutto-ok  to true.
           evaluate status-tparamge
           when "35"
                display message "File [TPARAMGE] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TPARAMGE] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TPARAMGE] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       RNOTACR-ERR SECTION.
           use after error procedure on rnotacr.
           set tutto-ok  to true.
           evaluate status-rnotacr
           when "35"
                display message "File [RNOTACR] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [RNOTACR] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[RNOTACR] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       DESTINI-ERR SECTION.
           use after error procedure on destini.
           set tutto-ok  to true.
           evaluate status-destini
           when "35"
                display message "File [DESTINI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [DESTINI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[DESTINI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       TIVAESE-ERR SECTION.
           use after error procedure on tivaese.
           set tutto-ok  to true.
           evaluate status-tivaese
           when "35"
                display message "File [TIVAESE] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TIVAESE] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TIVAESE] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       TCODPAG-ERR SECTION.
           use after error procedure on tcodpag.
           set tutto-ok  to true.
           evaluate status-tcodpag
           when "35"
                display message "File [TCODPAG] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TCODPAG] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TCODPAG] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       CLIENTI-ERR SECTION.
           use after error procedure on clienti.
           set tutto-ok  to true.
           evaluate status-clienti
           when "35"
                display message "File [CLIENTI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [CLIENTI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[CLIENTI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       ARTICOLI-ERR SECTION.
           use after error procedure on articoli.
           set tutto-ok  to true.
           evaluate status-articoli
           when "35"
                display message "File [ARTICOLI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [ARTICOLI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[ARTICOLI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       TORDINI-ERR SECTION.
           use after error procedure on tordini.
           set tutto-ok  to true.
           evaluate status-tordini
           when "35"
                display message "File [TORDINI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TORDINI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TORDINI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       RORDINI-ERR SECTION.
           use after error procedure on rordini.
           set tutto-ok  to true.
           evaluate status-rordini
           when "35"
                display message "File [RORDINI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [RORDINI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[RORDINI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       BTNOTACR-ERR SECTION.
           use after error procedure on btnotacr.
           set tutto-ok  to true.
           evaluate status-btnotacr
           when "35"
                display message "File [BTNOTACR] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [BTNOTACR] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[BTNOTACR] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           when "93"
           when "99"
                set RecLocked to true
                set errori    to true
           end-evaluate.
 
      ***---
       BRNOTACR-ERR SECTION.
           use after error procedure on brnotacr.
           set tutto-ok  to true.
           evaluate status-brnotacr
           when "35"
                display message "File [BRNOTACR] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [BRNOTACR] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[BRNOTACR] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       TCAUMAG-ERR SECTION.
           use after error procedure on tcaumag.
           set tutto-ok  to true.
           evaluate status-tcaumag
           when "35"
                display message "File [TCAUMAG] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TCAUMAG] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TCAUMAG] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       PROGMAG-ERR SECTION.
           use after error procedure on progmag.
           set tutto-ok  to true.
           evaluate status-progmag
           when "35"
                display message "File [PROGMAG] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [PROGMAG] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[PROGMAG] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       MAS-ERR SECTION.
           use after error procedure on MAS.
           set tutto-ok  to true.
           evaluate status-MAS
           when "35"
                display message "File [MAS] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [MAS] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[MAS] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       TMP-PROGMAG-ZOOM-ERR SECTION.
           use after error procedure on tmp-progmag-zoom.
           set tutto-ok  to true.
           evaluate status-tmp-progmag-zoom
           when "35"
                display message "File [TMP-PROGMAG-ZOOM] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TMP-PROGMAG-ZOOM] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TMP-PROGMAG-ZOOM] Indexed file corrupt
      -    "!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       TIMBALLI-ERR SECTION.
           use after error procedure on timballi.
           set tutto-ok  to true.
           evaluate status-timballi
           when "35"
                display message "File [TIMBALLI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TIMBALLI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TIMBALLI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       TIMBALQTA-ERR SECTION.
           use after error procedure on timbalqta.
           set tutto-ok  to true.
           evaluate status-timbalqta
           when "35"
                display message "File [TIMBALQTA] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TIMBALQTA] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TIMBALQTA] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       TMAGAZ-ERR SECTION.
           use after error procedure on tmagaz.
           set tutto-ok  to true.
           evaluate status-tmagaz
           when "35"
                display message "File [TMAGAZ] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TMAGAZ] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TMAGAZ] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.

      * <TOTEM:END>
       INPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON INPUT.
       0100-DECL.
           EXIT.
       I-O-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON I-O.
       0200-DECL.
           EXIT.
       OUTPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON OUTPUT.
       0300-DECL.
           EXIT.
       TRANSACTION-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON TRANSACTION.
       0400-DECL.
           EXIT.
       END DECLARATIVES.
      *{TOTEM}END

       MAIN-LOGIC.
      *{TOTEM}ENTRY-BEFPRG
      *    Before-Program
           PERFORM notacr-Ev-Before-Program
      *{TOTEM}END
           PERFORM INITIALIZE-ROUTINE.
      * run main screen
      *{TOTEM}RUN-MAINSCR
           PERFORM Form1-OPEN-ROUTINE.
      *{TOTEM}END

      *{TOTEM}COPY-PROCEDURE
       EXIT-STOP-ROUTINE.
           PERFORM CLOSE-FILE-RTN
      * <TOTEM:EPT. INIT:notacr, INIT:notacr, BeforeDestroyResource>
      * <TOTEM:END>
           DESTROY Courier-New18-Occidentale
           DESTROY Verdana12B-Occidentale
           CALL "w$bitmap" USING WBITMAP-DESTROY, 
           STRIP_GRID_GCLIENTI-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, SEL-TUTTO-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, GENERA-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, TOOLBAR-BMP
      *    After-Program
           PERFORM notacr-Ev-After-Program
           EXIT PROGRAM TOTEM-PgmStatus
           STOP RUN.

       INITIALIZE-ROUTINE.
      *    Before Init
      * initialize program status variable
           Initialize TOTEM-PgmStatus.
      * get system information
           ACCEPT SYSTEM-INFORMATION FROM SYSTEM-INFO.
      * get terminal information
           ACCEPT TERMINAL-ABILITIES FROM TERMINAL-INFO.
      * set font
           PERFORM INIT-FONT.
      * load bitmap
           PERFORM INIT-BMP.
      * load resource
           PERFORM INIT-RES.
      * create pop-up menu
           PERFORM INIT-POPUP.
      * open files
           PERFORM OPEN-FILE-RTN.
      *    After Init
           .
    
       INIT-FONT.
      * Courier-New18-Occidentale
           INITIALIZE WFONT-DATA Courier-New18-Occidentale
           MOVE 18 TO WFONT-SIZE
           MOVE "Courier New" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO FALSE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Courier-New18-Occidentale, WFONT-DATA
      * Verdana12B-Occidentale
           INITIALIZE WFONT-DATA Verdana12B-Occidentale
           MOVE 12 TO WFONT-SIZE
           MOVE "Verdana" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO TRUE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Verdana12B-Occidentale, WFONT-DATA
           .

       INIT-BMP.
      * pb-nuovo-0
           COPY RESOURCE "STRIP_GRID_GCLIENTI.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "STRIP_GRID_GCLIENTI.BMP"
           , 
                   GIVING STRIP_GRID_GCLIENTI-BMP.
      * pb-sel-tutto
           COPY RESOURCE "SEL-TUTTO.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "SEL-TUTTO.BMP", 
                   GIVING SEL-TUTTO-BMP.
      * pb-genera
           COPY RESOURCE "GENERA.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "GENERA.BMP", 
                   GIVING GENERA-BMP.
      * TOOL-ESCI
           COPY RESOURCE "TOOLBAR.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "TOOLBAR.BMP", 
                   GIVING TOOLBAR-BMP.
           .

       INIT-RES.
           .

       INIT-POPUP.
           .

       OPEN-FILE-RTN.
      *    Before Open
           PERFORM OPEN-tnotacr
           PERFORM OPEN-agenti
           PERFORM OPEN-tparamge
           PERFORM OPEN-rnotacr
           PERFORM OPEN-destini
           PERFORM OPEN-tcodpag
           PERFORM OPEN-clienti
           PERFORM OPEN-articoli
           PERFORM OPEN-tordini
           PERFORM OPEN-rordini
           PERFORM OPEN-tcaumag
           PERFORM OPEN-progmag
           PERFORM OPEN-MAS
           PERFORM OPEN-timballi
           PERFORM OPEN-timbalqta
           PERFORM OPEN-tmagaz
           PERFORM OPEN-recapiti
      *    tmp-progmag-zoom OPEN MODE IS FALSE
      *    PERFORM OPEN-tmp-progmag-zoom
           PERFORM OPEN-btnotacr
           PERFORM OPEN-brnotacr
           PERFORM OPEN-tvettori
           PERFORM OPEN-tivaese
      *    After Open
           .

       OPEN-tnotacr.
      * <TOTEM:EPT. INIT:notacr, FD:tnotacr, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O tnotacr
           IF STATUS-tnotacr = "35"
              OPEN OUTPUT tnotacr
                IF Valid-STATUS-tnotacr
                   CLOSE tnotacr
                   OPEN I-O tnotacr
                END-IF
           END-IF
           IF NOT Valid-STATUS-tnotacr
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:notacr, FD:tnotacr, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-agenti.
      * <TOTEM:EPT. INIT:notacr, FD:agenti, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT agenti
           IF NOT Valid-STATUS-agenti
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:notacr, FD:agenti, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tparamge.
      * <TOTEM:EPT. INIT:notacr, FD:tparamge, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tparamge
           IF NOT Valid-STATUS-tparamge
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:notacr, FD:tparamge, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-rnotacr.
      * <TOTEM:EPT. INIT:notacr, FD:rnotacr, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O rnotacr
           IF STATUS-rnotacr = "35"
              OPEN OUTPUT rnotacr
                IF Valid-STATUS-rnotacr
                   CLOSE rnotacr
                   OPEN I-O rnotacr
                END-IF
           END-IF
           IF NOT Valid-STATUS-rnotacr
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:notacr, FD:rnotacr, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-destini.
      * <TOTEM:EPT. INIT:notacr, FD:destini, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT destini
           IF NOT Valid-STATUS-destini
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:notacr, FD:destini, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tcodpag.
      * <TOTEM:EPT. INIT:notacr, FD:tcodpag, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tcodpag
           IF NOT Valid-status-tcodpag
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:notacr, FD:tcodpag, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-clienti.
      * <TOTEM:EPT. INIT:notacr, FD:clienti, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT clienti
           IF NOT Valid-STATUS-clienti
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:notacr, FD:clienti, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-articoli.
      * <TOTEM:EPT. INIT:notacr, FD:articoli, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT articoli
           IF NOT Valid-STATUS-articoli
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:notacr, FD:articoli, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tordini.
      * <TOTEM:EPT. INIT:notacr, FD:tordini, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tordini
           IF NOT Valid-STATUS-tordini
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:notacr, FD:tordini, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-rordini.
      * <TOTEM:EPT. INIT:notacr, FD:rordini, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT rordini
           IF NOT Valid-STATUS-rordini
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:notacr, FD:rordini, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tcaumag.
      * <TOTEM:EPT. INIT:notacr, FD:tcaumag, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tcaumag
           IF NOT Valid-STATUS-tcaumag
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:notacr, FD:tcaumag, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-progmag.
      * <TOTEM:EPT. INIT:notacr, FD:progmag, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT progmag
           IF NOT Valid-STATUS-progmag
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:notacr, FD:progmag, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-MAS.
      * <TOTEM:EPT. INIT:notacr, FD:MAS, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT MAS
           IF NOT Valid-status-mas
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:notacr, FD:MAS, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-timballi.
      * <TOTEM:EPT. INIT:notacr, FD:timballi, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT timballi
           IF NOT Valid-STATUS-timballi
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:notacr, FD:timballi, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-timbalqta.
      * <TOTEM:EPT. INIT:notacr, FD:timbalqta, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT timbalqta
           IF NOT Valid-STATUS-timbalqta
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:notacr, FD:timbalqta, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tmagaz.
      * <TOTEM:EPT. INIT:notacr, FD:tmagaz, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tmagaz
           IF NOT Valid-STATUS-tmagaz
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:notacr, FD:tmagaz, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-recapiti.
      * <TOTEM:EPT. INIT:notacr, FD:recapiti, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT recapiti
           IF NOT Valid-STATUS-recapiti
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:notacr, FD:recapiti, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tmp-progmag-zoom.
      * <TOTEM:EPT. INIT:notacr, FD:tmp-progmag-zoom, BeforeOpen>
      * <TOTEM:END>
           OPEN  OUTPUT tmp-progmag-zoom
           IF NOT Valid-STATUS-tmp-progmag-zoom
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:notacr, FD:tmp-progmag-zoom, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-btnotacr.
      * <TOTEM:EPT. INIT:notacr, FD:btnotacr, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT btnotacr
           IF NOT Valid-STATUS-btnotacr
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:notacr, FD:btnotacr, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-brnotacr.
      * <TOTEM:EPT. INIT:notacr, FD:brnotacr, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT brnotacr
           IF NOT Valid-STATUS-brnotacr
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:notacr, FD:brnotacr, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tvettori.
      * <TOTEM:EPT. INIT:notacr, FD:tvettori, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tvettori
           IF NOT Valid-STATUS-tvettori
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:notacr, FD:tvettori, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tivaese.
      * <TOTEM:EPT. INIT:notacr, FD:tivaese, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tivaese
           IF NOT Valid-STATUS-tivaese
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:notacr, FD:tivaese, AfterOpen>
      * <TOTEM:END>
           .

       CLOSE-FILE-RTN.
      *    Before Close
           PERFORM CLOSE-tnotacr
           PERFORM CLOSE-agenti
           PERFORM CLOSE-tparamge
           PERFORM CLOSE-rnotacr
           PERFORM CLOSE-destini
           PERFORM CLOSE-tcodpag
           PERFORM CLOSE-clienti
           PERFORM CLOSE-articoli
           PERFORM CLOSE-tordini
           PERFORM CLOSE-rordini
           PERFORM CLOSE-tcaumag
           PERFORM CLOSE-progmag
           PERFORM CLOSE-MAS
           PERFORM CLOSE-timballi
           PERFORM CLOSE-timbalqta
           PERFORM CLOSE-tmagaz
           PERFORM CLOSE-recapiti
      *    tmp-progmag-zoom CLOSE MODE IS FALSE
      *    PERFORM CLOSE-tmp-progmag-zoom
           PERFORM CLOSE-btnotacr
           PERFORM CLOSE-brnotacr
           PERFORM CLOSE-tvettori
           PERFORM CLOSE-tivaese
      *    After Close
           .

       CLOSE-tnotacr.
      * <TOTEM:EPT. INIT:notacr, FD:tnotacr, BeforeClose>
      * <TOTEM:END>
           CLOSE tnotacr
           .

       CLOSE-agenti.
      * <TOTEM:EPT. INIT:notacr, FD:agenti, BeforeClose>
      * <TOTEM:END>
           CLOSE agenti
           .

       CLOSE-tparamge.
      * <TOTEM:EPT. INIT:notacr, FD:tparamge, BeforeClose>
      * <TOTEM:END>
           CLOSE tparamge
           .

       CLOSE-rnotacr.
      * <TOTEM:EPT. INIT:notacr, FD:rnotacr, BeforeClose>
      * <TOTEM:END>
           CLOSE rnotacr
           .

       CLOSE-destini.
      * <TOTEM:EPT. INIT:notacr, FD:destini, BeforeClose>
      * <TOTEM:END>
           CLOSE destini
           .

       CLOSE-tcodpag.
      * <TOTEM:EPT. INIT:notacr, FD:tcodpag, BeforeClose>
      * <TOTEM:END>
           CLOSE tcodpag
           .

       CLOSE-clienti.
      * <TOTEM:EPT. INIT:notacr, FD:clienti, BeforeClose>
      * <TOTEM:END>
           CLOSE clienti
           .

       CLOSE-articoli.
      * <TOTEM:EPT. INIT:notacr, FD:articoli, BeforeClose>
      * <TOTEM:END>
           CLOSE articoli
           .

       CLOSE-tordini.
      * <TOTEM:EPT. INIT:notacr, FD:tordini, BeforeClose>
      * <TOTEM:END>
           CLOSE tordini
           .

       CLOSE-rordini.
      * <TOTEM:EPT. INIT:notacr, FD:rordini, BeforeClose>
      * <TOTEM:END>
           CLOSE rordini
           .

       CLOSE-tcaumag.
      * <TOTEM:EPT. INIT:notacr, FD:tcaumag, BeforeClose>
      * <TOTEM:END>
           CLOSE tcaumag
           .

       CLOSE-progmag.
      * <TOTEM:EPT. INIT:notacr, FD:progmag, BeforeClose>
      * <TOTEM:END>
           CLOSE progmag
           .

       CLOSE-MAS.
      * <TOTEM:EPT. INIT:notacr, FD:MAS, BeforeClose>
      * <TOTEM:END>
           CLOSE MAS
           .

       CLOSE-timballi.
      * <TOTEM:EPT. INIT:notacr, FD:timballi, BeforeClose>
      * <TOTEM:END>
           CLOSE timballi
           .

       CLOSE-timbalqta.
      * <TOTEM:EPT. INIT:notacr, FD:timbalqta, BeforeClose>
      * <TOTEM:END>
           CLOSE timbalqta
           .

       CLOSE-tmagaz.
      * <TOTEM:EPT. INIT:notacr, FD:tmagaz, BeforeClose>
      * <TOTEM:END>
           CLOSE tmagaz
           .

       CLOSE-recapiti.
      * <TOTEM:EPT. INIT:notacr, FD:recapiti, BeforeClose>
      * <TOTEM:END>
           CLOSE recapiti
           .

       CLOSE-tmp-progmag-zoom.
      * <TOTEM:EPT. INIT:notacr, FD:tmp-progmag-zoom, BeforeClose>
      * <TOTEM:END>
           .

       CLOSE-btnotacr.
      * <TOTEM:EPT. INIT:notacr, FD:btnotacr, BeforeClose>
      * <TOTEM:END>
           CLOSE btnotacr
           .

       CLOSE-brnotacr.
      * <TOTEM:EPT. INIT:notacr, FD:brnotacr, BeforeClose>
      * <TOTEM:END>
           CLOSE brnotacr
           .

       CLOSE-tvettori.
      * <TOTEM:EPT. INIT:notacr, FD:tvettori, BeforeClose>
      * <TOTEM:END>
           CLOSE tvettori
           .

       CLOSE-tivaese.
      * <TOTEM:EPT. INIT:notacr, FD:tivaese, BeforeClose>
      * <TOTEM:END>
           CLOSE tivaese
           .

       tnotacr-k-causale-MERGE-SPLITBUF.
           INITIALIZE tnotacr-k-causale-SPLITBUF
           MOVE tno-causale(1:4) TO tnotacr-k-causale-SPLITBUF(1:4)
           MOVE tno-anno(1:4) TO tnotacr-k-causale-SPLITBUF(5:4)
           MOVE tno-numero(1:8) TO tnotacr-k-causale-SPLITBUF(9:8)
           .

       tnotacr-k1-MERGE-SPLITBUF.
           INITIALIZE tnotacr-k1-SPLITBUF
           MOVE tno-cod-cli(1:5) TO tnotacr-k1-SPLITBUF(1:5)
           MOVE tno-prg-destino(1:5) TO tnotacr-k1-SPLITBUF(6:5)
           MOVE tno-anno(1:4) TO tnotacr-k1-SPLITBUF(11:4)
           MOVE tno-numero(1:8) TO tnotacr-k1-SPLITBUF(15:8)
           .

       tnotacr-k2-MERGE-SPLITBUF.
           INITIALIZE tnotacr-k2-SPLITBUF
           MOVE tno-data-passaggio-ordine(1:8) TO 
           tnotacr-k2-SPLITBUF(1:8)
           MOVE tno-anno(1:4) TO tnotacr-k2-SPLITBUF(9:4)
           MOVE tno-numero(1:8) TO tnotacr-k2-SPLITBUF(13:8)
           .

       tnotacr-k-fattura-MERGE-SPLITBUF.
           INITIALIZE tnotacr-k-fattura-SPLITBUF
           MOVE tno-anno-fattura(1:4) TO tnotacr-k-fattura-SPLITBUF(1:4)
           MOVE tno-num-fattura(1:8) TO tnotacr-k-fattura-SPLITBUF(5:8)
           .

       tnotacr-k4-MERGE-SPLITBUF.
           INITIALIZE tnotacr-k4-SPLITBUF
           MOVE tno-anno-fattura(1:4) TO tnotacr-k4-SPLITBUF(1:4)
           MOVE tno-data-fattura(1:8) TO tnotacr-k4-SPLITBUF(5:8)
           MOVE tno-num-fattura(1:8) TO tnotacr-k4-SPLITBUF(13:8)
           MOVE tno-num-prenot(1:8) TO tnotacr-k4-SPLITBUF(21:8)
           MOVE tno-fatt-prenotata(1:1) TO tnotacr-k4-SPLITBUF(29:1)
           .

       tnotacr-k-contab-MERGE-SPLITBUF.
           INITIALIZE tnotacr-k-contab-SPLITBUF
           MOVE tno-agg-contab(1:1) TO tnotacr-k-contab-SPLITBUF(1:1)
           MOVE tno-anno-fattura(1:4) TO tnotacr-k-contab-SPLITBUF(2:4)
           MOVE tno-num-fattura(1:8) TO tnotacr-k-contab-SPLITBUF(6:8)
           .

       tnotacr-k-data-MERGE-SPLITBUF.
           INITIALIZE tnotacr-k-data-SPLITBUF
           MOVE tno-data(1:8) TO tnotacr-k-data-SPLITBUF(1:8)
           MOVE tno-numero(1:8) TO tnotacr-k-data-SPLITBUF(9:8)
           .

       tnotacr-k-agfatt-MERGE-SPLITBUF.
           INITIALIZE tnotacr-k-agfatt-SPLITBUF
           MOVE tno-anno-fattura(1:4) TO tnotacr-k-agfatt-SPLITBUF(1:4)
           MOVE tno-data-fattura(1:8) TO tnotacr-k-agfatt-SPLITBUF(5:8)
           MOVE tno-num-fattura(1:8) TO tnotacr-k-agfatt-SPLITBUF(13:8)
           MOVE tno-num-prenot(1:8) TO tnotacr-k-agfatt-SPLITBUF(21:8)
           MOVE tno-fatt-prenotata(1:1) TO 
           tnotacr-k-agfatt-SPLITBUF(29:1)
           MOVE tno-chiave(1:12) TO tnotacr-k-agfatt-SPLITBUF(30:12)
           .

       tnotacr-k-andamento-data-MERGE-SPLITBUF.
           INITIALIZE tnotacr-k-andamento-data-SPLITBUF
           MOVE tno-agg-contab(1:1) TO 
           tnotacr-k-andamento-data-SPLITBUF(1:1)
           MOVE tno-data-fattura(1:8) TO 
           tnotacr-k-andamento-data-SPLITBUF(2:8)
           .

       tnotacr-k-andamento-cliente-MERGE-SPLITBUF.
           INITIALIZE tnotacr-k-andamento-cliente-SPLITBUF
           MOVE tno-cod-cli(1:5) TO 
           tnotacr-k-andamento-cliente-SPLITBUF(1:5)
           MOVE tno-agg-contab(1:1) TO 
           tnotacr-k-andamento-cliente-SPLITBUF(6:1)
           MOVE tno-data-fattura(1:8) TO 
           tnotacr-k-andamento-cliente-SPLITBUF(7:8)
           .

       tnotacr-k-andamento-clides-MERGE-SPLITBUF.
           INITIALIZE tnotacr-k-andamento-clides-SPLITBUF
           MOVE tno-cod-cli(1:5) TO 
           tnotacr-k-andamento-clides-SPLITBUF(1:5)
           MOVE tno-prg-destino(1:5) TO 
           tnotacr-k-andamento-clides-SPLITBUF(6:5)
           MOVE tno-agg-contab(1:1) TO 
           tnotacr-k-andamento-clides-SPLITBUF(11:1)
           MOVE tno-data-fattura(1:8) TO 
           tnotacr-k-andamento-clides-SPLITBUF(12:8)
           .

       DataSet1-tnotacr-INITSTART.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tnotacr-KEY1-Asc
                 MOVE Low-Value TO tno-chiave
              ELSE
                 MOVE High-Value TO tno-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tnotacr-INITEND.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tnotacr-KEY1-Asc
                 MOVE High-Value TO tno-chiave
              ELSE
                 MOVE Low-Value TO tno-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           .   

       DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-tnotacr-KEY1-ORDER
           END-EVALUATE
           .

       DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-tnotacr-KEY1-ORDER
           END-EVALUATE
           .

      * tnotacr
       DataSet1-tnotacr-START.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tnotacr-KEY1-Asc
                 START tnotacr KEY >= tno-chiave
              ELSE
                 START tnotacr KEY <= tno-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tnotacr-START-NOTGREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tnotacr-KEY1-Asc
                 START tnotacr KEY <= tno-chiave
              ELSE
                 START tnotacr KEY >= tno-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tnotacr-START-GREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tnotacr-KEY1-Asc
                 START tnotacr KEY > tno-chiave
              ELSE
                 START tnotacr KEY < tno-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tnotacr-START-LESS.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tnotacr-KEY1-Asc
                 START tnotacr KEY < tno-chiave
              ELSE
                 START tnotacr KEY > tno-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tnotacr-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, BeforeReadRecord>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tnotacr-LOCK
                 READ tnotacr WITH LOCK 
                 KEY tno-chiave
              ELSE
                 READ tnotacr WITH NO LOCK 
                 KEY tno-chiave
              END-IF
           END-EVALUATE
           PERFORM tnotacr-k-causale-MERGE-SPLITBUF
           PERFORM tnotacr-k1-MERGE-SPLITBUF
           PERFORM tnotacr-k2-MERGE-SPLITBUF
           PERFORM tnotacr-k-fattura-MERGE-SPLITBUF
           PERFORM tnotacr-k4-MERGE-SPLITBUF
           PERFORM tnotacr-k-contab-MERGE-SPLITBUF
           PERFORM tnotacr-k-data-MERGE-SPLITBUF
           PERFORM tnotacr-k-agfatt-MERGE-SPLITBUF
           PERFORM tnotacr-k-andamento-data-MERGE-SPLITBUF
           PERFORM tnotacr-k-andamento-cliente-MERGE-SPLITBUF
           PERFORM tnotacr-k-andamento-clides-MERGE-SPLITBUF
           MOVE STATUS-tnotacr TO TOTEM-ERR-STAT 
           MOVE "tnotacr" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tnotacr-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, BeforeReadNext>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tnotacr-KEY1-Asc
                 IF DataSet1-tnotacr-LOCK
                    READ tnotacr NEXT WITH LOCK
                 ELSE
                    READ tnotacr NEXT WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-tnotacr-LOCK
                    READ tnotacr PREVIOUS WITH LOCK
                 ELSE
                    READ tnotacr PREVIOUS WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           PERFORM tnotacr-k-causale-MERGE-SPLITBUF
           PERFORM tnotacr-k1-MERGE-SPLITBUF
           PERFORM tnotacr-k2-MERGE-SPLITBUF
           PERFORM tnotacr-k-fattura-MERGE-SPLITBUF
           PERFORM tnotacr-k4-MERGE-SPLITBUF
           PERFORM tnotacr-k-contab-MERGE-SPLITBUF
           PERFORM tnotacr-k-data-MERGE-SPLITBUF
           PERFORM tnotacr-k-agfatt-MERGE-SPLITBUF
           PERFORM tnotacr-k-andamento-data-MERGE-SPLITBUF
           PERFORM tnotacr-k-andamento-cliente-MERGE-SPLITBUF
           PERFORM tnotacr-k-andamento-clides-MERGE-SPLITBUF
           MOVE STATUS-tnotacr TO TOTEM-ERR-STAT
           MOVE "tnotacr" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tnotacr-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, BeforeReadPrev>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tnotacr-KEY1-Asc
                 IF DataSet1-tnotacr-LOCK
                    READ tnotacr PREVIOUS WITH LOCK
                 ELSE
                    READ tnotacr PREVIOUS WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-tnotacr-LOCK
                    READ tnotacr NEXT WITH LOCK
                 ELSE
                    READ tnotacr NEXT WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           PERFORM tnotacr-k-causale-MERGE-SPLITBUF
           PERFORM tnotacr-k1-MERGE-SPLITBUF
           PERFORM tnotacr-k2-MERGE-SPLITBUF
           PERFORM tnotacr-k-fattura-MERGE-SPLITBUF
           PERFORM tnotacr-k4-MERGE-SPLITBUF
           PERFORM tnotacr-k-contab-MERGE-SPLITBUF
           PERFORM tnotacr-k-data-MERGE-SPLITBUF
           PERFORM tnotacr-k-agfatt-MERGE-SPLITBUF
           PERFORM tnotacr-k-andamento-data-MERGE-SPLITBUF
           PERFORM tnotacr-k-andamento-cliente-MERGE-SPLITBUF
           PERFORM tnotacr-k-andamento-clides-MERGE-SPLITBUF
           MOVE STATUS-tnotacr TO TOTEM-ERR-STAT
           MOVE "tnotacr" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tnotacr-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, BeforeWrite>
      * <TOTEM:END>
           WRITE tno-rec OF tnotacr.
           MOVE STATUS-tnotacr TO TOTEM-ERR-STAT
           MOVE "tnotacr" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tnotacr-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, BeforeRewrite>
      * <TOTEM:END>
           REWRITE tno-rec OF tnotacr.
           MOVE STATUS-tnotacr TO TOTEM-ERR-STAT
           MOVE "tnotacr" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tnotacr-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, BeforeDelete>
      * <TOTEM:END>
           DELETE tnotacr.
           MOVE STATUS-tnotacr TO TOTEM-ERR-STAT
           MOVE "tnotacr" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tnotacr, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-agenti-INITSTART.
           IF DataSet1-agenti-KEY-Asc
              MOVE Low-Value TO age-chiave
           ELSE
              MOVE High-Value TO age-chiave
           END-IF
           .

       DataSet1-agenti-INITEND.
           IF DataSet1-agenti-KEY-Asc
              MOVE High-Value TO age-chiave
           ELSE
              MOVE Low-Value TO age-chiave
           END-IF
           .

      * agenti
       DataSet1-agenti-START.
           IF DataSet1-agenti-KEY-Asc
              START agenti KEY >= age-chiave
           ELSE
              START agenti KEY <= age-chiave
           END-IF
           .

       DataSet1-agenti-START-NOTGREATER.
           IF DataSet1-agenti-KEY-Asc
              START agenti KEY <= age-chiave
           ELSE
              START agenti KEY >= age-chiave
           END-IF
           .

       DataSet1-agenti-START-GREATER.
           IF DataSet1-agenti-KEY-Asc
              START agenti KEY > age-chiave
           ELSE
              START agenti KEY < age-chiave
           END-IF
           .

       DataSet1-agenti-START-LESS.
           IF DataSet1-agenti-KEY-Asc
              START agenti KEY < age-chiave
           ELSE
              START agenti KEY > age-chiave
           END-IF
           .

       DataSet1-agenti-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-agenti-LOCK
              READ agenti WITH LOCK 
              KEY age-chiave
           ELSE
              READ agenti WITH NO LOCK 
              KEY age-chiave
           END-IF
           MOVE STATUS-agenti TO TOTEM-ERR-STAT 
           MOVE "agenti" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-agenti-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-agenti-KEY-Asc
              IF DataSet1-agenti-LOCK
                 READ agenti NEXT WITH LOCK
              ELSE
                 READ agenti NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-agenti-LOCK
                 READ agenti PREVIOUS WITH LOCK
              ELSE
                 READ agenti PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-agenti TO TOTEM-ERR-STAT
           MOVE "agenti" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-agenti-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-agenti-KEY-Asc
              IF DataSet1-agenti-LOCK
                 READ agenti PREVIOUS WITH LOCK
              ELSE
                 READ agenti PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-agenti-LOCK
                 READ agenti NEXT WITH LOCK
              ELSE
                 READ agenti NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-agenti TO TOTEM-ERR-STAT
           MOVE "agenti" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-agenti-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-agenti TO TOTEM-ERR-STAT
           MOVE "agenti" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-agenti-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-agenti TO TOTEM-ERR-STAT
           MOVE "agenti" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-agenti-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-agenti TO TOTEM-ERR-STAT
           MOVE "agenti" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tparamge-INITSTART.
           IF DataSet1-tparamge-KEY-Asc
              MOVE Low-Value TO tge-chiave
           ELSE
              MOVE High-Value TO tge-chiave
           END-IF
           .

       DataSet1-tparamge-INITEND.
           IF DataSet1-tparamge-KEY-Asc
              MOVE High-Value TO tge-chiave
           ELSE
              MOVE Low-Value TO tge-chiave
           END-IF
           .

      * tparamge
       DataSet1-tparamge-START.
           IF DataSet1-tparamge-KEY-Asc
              START tparamge KEY >= tge-chiave
           ELSE
              START tparamge KEY <= tge-chiave
           END-IF
           .

       DataSet1-tparamge-START-NOTGREATER.
           IF DataSet1-tparamge-KEY-Asc
              START tparamge KEY <= tge-chiave
           ELSE
              START tparamge KEY >= tge-chiave
           END-IF
           .

       DataSet1-tparamge-START-GREATER.
           IF DataSet1-tparamge-KEY-Asc
              START tparamge KEY > tge-chiave
           ELSE
              START tparamge KEY < tge-chiave
           END-IF
           .

       DataSet1-tparamge-START-LESS.
           IF DataSet1-tparamge-KEY-Asc
              START tparamge KEY < tge-chiave
           ELSE
              START tparamge KEY > tge-chiave
           END-IF
           .

       DataSet1-tparamge-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tparamge-LOCK
              READ tparamge WITH LOCK 
              KEY tge-chiave
           ELSE
              READ tparamge WITH NO LOCK 
              KEY tge-chiave
           END-IF
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT 
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tparamge-KEY-Asc
              IF DataSet1-tparamge-LOCK
                 READ tparamge NEXT WITH LOCK
              ELSE
                 READ tparamge NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tparamge-LOCK
                 READ tparamge PREVIOUS WITH LOCK
              ELSE
                 READ tparamge PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tparamge-KEY-Asc
              IF DataSet1-tparamge-LOCK
                 READ tparamge PREVIOUS WITH LOCK
              ELSE
                 READ tparamge PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tparamge-LOCK
                 READ tparamge NEXT WITH LOCK
              ELSE
                 READ tparamge NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterDelete>
      * <TOTEM:END>
           .

       rnotacr-rno-k-articolo-MERGE-SPLITBUF.
           INITIALIZE rnotacr-rno-k-articolo-SPLITBUF
           MOVE rno-cod-articolo(1:6) TO 
           rnotacr-rno-k-articolo-SPLITBUF(1:6)
           MOVE rno-chiave(1:17) TO 
           rnotacr-rno-k-articolo-SPLITBUF(7:17)
           .

       DataSet1-rnotacr-INITSTART.
           IF DataSet1-rnotacr-KEY-Asc
              MOVE Low-Value TO rno-chiave
           ELSE
              MOVE High-Value TO rno-chiave
           END-IF
           .

       DataSet1-rnotacr-INITEND.
           IF DataSet1-rnotacr-KEY-Asc
              MOVE High-Value TO rno-chiave
           ELSE
              MOVE Low-Value TO rno-chiave
           END-IF
           .

      * rnotacr
       DataSet1-rnotacr-START.
           IF DataSet1-rnotacr-KEY-Asc
              START rnotacr KEY >= rno-chiave
           ELSE
              START rnotacr KEY <= rno-chiave
           END-IF
           .

       DataSet1-rnotacr-START-NOTGREATER.
           IF DataSet1-rnotacr-KEY-Asc
              START rnotacr KEY <= rno-chiave
           ELSE
              START rnotacr KEY >= rno-chiave
           END-IF
           .

       DataSet1-rnotacr-START-GREATER.
           IF DataSet1-rnotacr-KEY-Asc
              START rnotacr KEY > rno-chiave
           ELSE
              START rnotacr KEY < rno-chiave
           END-IF
           .

       DataSet1-rnotacr-START-LESS.
           IF DataSet1-rnotacr-KEY-Asc
              START rnotacr KEY < rno-chiave
           ELSE
              START rnotacr KEY > rno-chiave
           END-IF
           .

       DataSet1-rnotacr-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:rnotacr, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rnotacr, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-rnotacr-LOCK
              READ rnotacr WITH LOCK 
              KEY rno-chiave
           ELSE
              READ rnotacr WITH NO LOCK 
              KEY rno-chiave
           END-IF
           PERFORM rnotacr-rno-k-articolo-MERGE-SPLITBUF
           MOVE STATUS-rnotacr TO TOTEM-ERR-STAT 
           MOVE "rnotacr" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rnotacr, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rnotacr, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-rnotacr-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:rnotacr, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rnotacr, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-rnotacr-KEY-Asc
              IF DataSet1-rnotacr-LOCK
                 READ rnotacr NEXT WITH LOCK
              ELSE
                 READ rnotacr NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-rnotacr-LOCK
                 READ rnotacr PREVIOUS WITH LOCK
              ELSE
                 READ rnotacr PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM rnotacr-rno-k-articolo-MERGE-SPLITBUF
           MOVE STATUS-rnotacr TO TOTEM-ERR-STAT
           MOVE "rnotacr" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rnotacr, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rnotacr, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-rnotacr-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:rnotacr, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rnotacr, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-rnotacr-KEY-Asc
              IF DataSet1-rnotacr-LOCK
                 READ rnotacr PREVIOUS WITH LOCK
              ELSE
                 READ rnotacr PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-rnotacr-LOCK
                 READ rnotacr NEXT WITH LOCK
              ELSE
                 READ rnotacr NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM rnotacr-rno-k-articolo-MERGE-SPLITBUF
           MOVE STATUS-rnotacr TO TOTEM-ERR-STAT
           MOVE "rnotacr" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rnotacr, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rnotacr, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-rnotacr-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:rnotacr, BeforeWrite>
      * <TOTEM:END>
           WRITE rno-rec OF rnotacr.
           MOVE STATUS-rnotacr TO TOTEM-ERR-STAT
           MOVE "rnotacr" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rnotacr, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-rnotacr-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:rnotacr, BeforeRewrite>
      * <TOTEM:END>
           REWRITE rno-rec OF rnotacr.
           MOVE STATUS-rnotacr TO TOTEM-ERR-STAT
           MOVE "rnotacr" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rnotacr, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-rnotacr-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:rnotacr, BeforeDelete>
      * <TOTEM:END>
           DELETE rnotacr.
           MOVE STATUS-rnotacr TO TOTEM-ERR-STAT
           MOVE "rnotacr" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rnotacr, AfterDelete>
      * <TOTEM:END>
           .

       destini-K1-MERGE-SPLITBUF.
           INITIALIZE destini-K1-SPLITBUF
           MOVE des-ragsoc-1(1:40) TO destini-K1-SPLITBUF(1:40)
           MOVE des-codice(1:5) TO destini-K1-SPLITBUF(41:5)
           MOVE des-prog(1:5) TO destini-K1-SPLITBUF(46:5)
           .

       destini-k-localita-MERGE-SPLITBUF.
           INITIALIZE destini-k-localita-SPLITBUF
           MOVE des-localita(1:35) TO destini-k-localita-SPLITBUF(1:35)
           .

       DataSet1-destini-INITSTART.
           IF DataSet1-destini-KEY-Asc
              MOVE Low-Value TO des-chiave
           ELSE
              MOVE High-Value TO des-chiave
           END-IF
           .

       DataSet1-destini-INITEND.
           IF DataSet1-destini-KEY-Asc
              MOVE High-Value TO des-chiave
           ELSE
              MOVE Low-Value TO des-chiave
           END-IF
           .

      * destini
       DataSet1-destini-START.
           IF DataSet1-destini-KEY-Asc
              START destini KEY >= des-chiave
           ELSE
              START destini KEY <= des-chiave
           END-IF
           .

       DataSet1-destini-START-NOTGREATER.
           IF DataSet1-destini-KEY-Asc
              START destini KEY <= des-chiave
           ELSE
              START destini KEY >= des-chiave
           END-IF
           .

       DataSet1-destini-START-GREATER.
           IF DataSet1-destini-KEY-Asc
              START destini KEY > des-chiave
           ELSE
              START destini KEY < des-chiave
           END-IF
           .

       DataSet1-destini-START-LESS.
           IF DataSet1-destini-KEY-Asc
              START destini KEY < des-chiave
           ELSE
              START destini KEY > des-chiave
           END-IF
           .

       DataSet1-destini-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-destini-LOCK
              READ destini WITH LOCK 
              KEY des-chiave
           ELSE
              READ destini WITH NO LOCK 
              KEY des-chiave
           END-IF
           PERFORM destini-K1-MERGE-SPLITBUF
           PERFORM destini-k-localita-MERGE-SPLITBUF
           MOVE STATUS-destini TO TOTEM-ERR-STAT 
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-destini-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-destini-KEY-Asc
              IF DataSet1-destini-LOCK
                 READ destini NEXT WITH LOCK
              ELSE
                 READ destini NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-destini-LOCK
                 READ destini PREVIOUS WITH LOCK
              ELSE
                 READ destini PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM destini-K1-MERGE-SPLITBUF
           PERFORM destini-k-localita-MERGE-SPLITBUF
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-destini-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-destini-KEY-Asc
              IF DataSet1-destini-LOCK
                 READ destini PREVIOUS WITH LOCK
              ELSE
                 READ destini PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-destini-LOCK
                 READ destini NEXT WITH LOCK
              ELSE
                 READ destini NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM destini-K1-MERGE-SPLITBUF
           PERFORM destini-k-localita-MERGE-SPLITBUF
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-destini-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-destini-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-destini-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterDelete>
      * <TOTEM:END>
           .

       tcodpag-TBL-CODICE-01-MERGE-SPLITBUF.
           INITIALIZE tcodpag-TBL-CODICE-01-SPLITBUF
           MOVE TBLPA-CODICE1(1:2) TO 
           tcodpag-TBL-CODICE-01-SPLITBUF(1:2)
           MOVE TBLPA-DESCRIZIONE1(1:30) TO 
           tcodpag-TBL-CODICE-01-SPLITBUF(3:30)
           MOVE TBLPA-CODICE2(1:20) TO 
           tcodpag-TBL-CODICE-01-SPLITBUF(33:20)
           .

       DataSet1-tcodpag-INITSTART.
           IF DataSet1-tcodpag-KEY-Asc
              MOVE Low-Value TO TBLPA-CODICE
           ELSE
              MOVE High-Value TO TBLPA-CODICE
           END-IF
           .

       DataSet1-tcodpag-INITEND.
           IF DataSet1-tcodpag-KEY-Asc
              MOVE High-Value TO TBLPA-CODICE
           ELSE
              MOVE Low-Value TO TBLPA-CODICE
           END-IF
           .

      * tcodpag
       DataSet1-tcodpag-START.
           IF DataSet1-tcodpag-KEY-Asc
              START tcodpag KEY >= TBLPA-CODICE
           ELSE
              START tcodpag KEY <= TBLPA-CODICE
           END-IF
           .

       DataSet1-tcodpag-START-NOTGREATER.
           IF DataSet1-tcodpag-KEY-Asc
              START tcodpag KEY <= TBLPA-CODICE
           ELSE
              START tcodpag KEY >= TBLPA-CODICE
           END-IF
           .

       DataSet1-tcodpag-START-GREATER.
           IF DataSet1-tcodpag-KEY-Asc
              START tcodpag KEY > TBLPA-CODICE
           ELSE
              START tcodpag KEY < TBLPA-CODICE
           END-IF
           .

       DataSet1-tcodpag-START-LESS.
           IF DataSet1-tcodpag-KEY-Asc
              START tcodpag KEY < TBLPA-CODICE
           ELSE
              START tcodpag KEY > TBLPA-CODICE
           END-IF
           .

       DataSet1-tcodpag-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tcodpag-LOCK
              READ tcodpag WITH LOCK 
              KEY TBLPA-CODICE
           ELSE
              READ tcodpag WITH NO LOCK 
              KEY TBLPA-CODICE
           END-IF
           PERFORM tcodpag-TBL-CODICE-01-MERGE-SPLITBUF
           MOVE status-tcodpag TO TOTEM-ERR-STAT 
           MOVE "tcodpag" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tcodpag-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tcodpag-KEY-Asc
              IF DataSet1-tcodpag-LOCK
                 READ tcodpag NEXT WITH LOCK
              ELSE
                 READ tcodpag NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tcodpag-LOCK
                 READ tcodpag PREVIOUS WITH LOCK
              ELSE
                 READ tcodpag PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tcodpag-TBL-CODICE-01-MERGE-SPLITBUF
           MOVE status-tcodpag TO TOTEM-ERR-STAT
           MOVE "tcodpag" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tcodpag-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tcodpag-KEY-Asc
              IF DataSet1-tcodpag-LOCK
                 READ tcodpag PREVIOUS WITH LOCK
              ELSE
                 READ tcodpag PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tcodpag-LOCK
                 READ tcodpag NEXT WITH LOCK
              ELSE
                 READ tcodpag NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tcodpag-TBL-CODICE-01-MERGE-SPLITBUF
           MOVE status-tcodpag TO TOTEM-ERR-STAT
           MOVE "tcodpag" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tcodpag-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeWrite>
      * <TOTEM:END>
           MOVE status-tcodpag TO TOTEM-ERR-STAT
           MOVE "tcodpag" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tcodpag-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeRewrite>
      * <TOTEM:END>
           MOVE status-tcodpag TO TOTEM-ERR-STAT
           MOVE "tcodpag" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tcodpag-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeDelete>
      * <TOTEM:END>
           MOVE status-tcodpag TO TOTEM-ERR-STAT
           MOVE "tcodpag" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterDelete>
      * <TOTEM:END>
           .

       clienti-cli-K1-MERGE-SPLITBUF.
           INITIALIZE clienti-cli-K1-SPLITBUF
           MOVE cli-tipo-CF OF clienti(1:1) TO 
           clienti-cli-K1-SPLITBUF(1:1)
           MOVE cli-ragsoc-1 OF clienti(1:40) TO 
           clienti-cli-K1-SPLITBUF(2:40)
           MOVE cli-codice OF clienti(1:5) TO 
           clienti-cli-K1-SPLITBUF(42:5)
           .

       clienti-cli-K3-MERGE-SPLITBUF.
           INITIALIZE clienti-cli-K3-SPLITBUF
           MOVE cli-gdo OF clienti(1:5) TO clienti-cli-K3-SPLITBUF(1:5)
           MOVE cli-chiave OF clienti(1:6) TO 
           clienti-cli-K3-SPLITBUF(6:6)
           .

       clienti-cli-K4-MERGE-SPLITBUF.
           INITIALIZE clienti-cli-K4-SPLITBUF
           MOVE cli-utf OF clienti(1:1) TO clienti-cli-K4-SPLITBUF(1:1)
           MOVE cli-chiave OF clienti(1:6) TO 
           clienti-cli-K4-SPLITBUF(2:6)
           .

       DataSet1-clienti-INITSTART.
           IF DataSet1-clienti-KEY-Asc
              MOVE Low-Value TO cli-chiave OF clienti
           ELSE
              MOVE High-Value TO cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-INITEND.
           IF DataSet1-clienti-KEY-Asc
              MOVE High-Value TO cli-chiave OF clienti
           ELSE
              MOVE Low-Value TO cli-chiave OF clienti
           END-IF
           .

      * clienti
       DataSet1-clienti-START.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY >= cli-chiave OF clienti
           ELSE
              START clienti KEY <= cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-START-NOTGREATER.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY <= cli-chiave OF clienti
           ELSE
              START clienti KEY >= cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-START-GREATER.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY > cli-chiave OF clienti
           ELSE
              START clienti KEY < cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-START-LESS.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY < cli-chiave OF clienti
           ELSE
              START clienti KEY > cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-clienti-LOCK
              READ clienti WITH LOCK 
              KEY cli-chiave OF clienti
           ELSE
              READ clienti WITH NO LOCK 
              KEY cli-chiave OF clienti
           END-IF
           PERFORM clienti-cli-K1-MERGE-SPLITBUF
           PERFORM clienti-cli-K3-MERGE-SPLITBUF
           PERFORM clienti-cli-K4-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT 
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-clienti-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-clienti-KEY-Asc
              IF DataSet1-clienti-LOCK
                 READ clienti NEXT WITH LOCK
              ELSE
                 READ clienti NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-clienti-LOCK
                 READ clienti PREVIOUS WITH LOCK
              ELSE
                 READ clienti PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM clienti-cli-K1-MERGE-SPLITBUF
           PERFORM clienti-cli-K3-MERGE-SPLITBUF
           PERFORM clienti-cli-K4-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-clienti-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-clienti-KEY-Asc
              IF DataSet1-clienti-LOCK
                 READ clienti PREVIOUS WITH LOCK
              ELSE
                 READ clienti PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-clienti-LOCK
                 READ clienti NEXT WITH LOCK
              ELSE
                 READ clienti NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM clienti-cli-K1-MERGE-SPLITBUF
           PERFORM clienti-cli-K3-MERGE-SPLITBUF
           PERFORM clienti-cli-K4-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterDelete>
      * <TOTEM:END>
           .

       articoli-art-k1-MERGE-SPLITBUF.
           INITIALIZE articoli-art-k1-SPLITBUF
           MOVE art-descrizione OF articoli(1:50) TO 
           articoli-art-k1-SPLITBUF(1:50)
           .

       articoli-art-k-frn-MERGE-SPLITBUF.
           INITIALIZE articoli-art-k-frn-SPLITBUF
           MOVE art-cod-art-frn OF articoli(1:15) TO 
           articoli-art-k-frn-SPLITBUF(1:15)
           .

       DataSet1-articoli-INITSTART.
           IF DataSet1-articoli-KEY-Asc
              MOVE Low-Value TO art-chiave OF articoli
           ELSE
              MOVE High-Value TO art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-INITEND.
           IF DataSet1-articoli-KEY-Asc
              MOVE High-Value TO art-chiave OF articoli
           ELSE
              MOVE Low-Value TO art-chiave OF articoli
           END-IF
           .

      * articoli
       DataSet1-articoli-START.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY >= art-chiave OF articoli
           ELSE
              START articoli KEY <= art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-START-NOTGREATER.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY <= art-chiave OF articoli
           ELSE
              START articoli KEY >= art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-START-GREATER.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY > art-chiave OF articoli
           ELSE
              START articoli KEY < art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-START-LESS.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY < art-chiave OF articoli
           ELSE
              START articoli KEY > art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-articoli-LOCK
              READ articoli WITH LOCK 
              KEY art-chiave OF articoli
           ELSE
              READ articoli WITH NO LOCK 
              KEY art-chiave OF articoli
           END-IF
           PERFORM articoli-art-k1-MERGE-SPLITBUF
           PERFORM articoli-art-k-frn-MERGE-SPLITBUF
           MOVE STATUS-articoli TO TOTEM-ERR-STAT 
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-articoli-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-articoli-KEY-Asc
              IF DataSet1-articoli-LOCK
                 READ articoli NEXT WITH LOCK
              ELSE
                 READ articoli NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-articoli-LOCK
                 READ articoli PREVIOUS WITH LOCK
              ELSE
                 READ articoli PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM articoli-art-k1-MERGE-SPLITBUF
           PERFORM articoli-art-k-frn-MERGE-SPLITBUF
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-articoli-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-articoli-KEY-Asc
              IF DataSet1-articoli-LOCK
                 READ articoli PREVIOUS WITH LOCK
              ELSE
                 READ articoli PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-articoli-LOCK
                 READ articoli NEXT WITH LOCK
              ELSE
                 READ articoli NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM articoli-art-k1-MERGE-SPLITBUF
           PERFORM articoli-art-k-frn-MERGE-SPLITBUF
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-articoli-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-articoli-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-articoli-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterDelete>
      * <TOTEM:END>
           .

       tordini-k-causale-MERGE-SPLITBUF.
           INITIALIZE tordini-k-causale-SPLITBUF
           MOVE tor-causale(1:4) TO tordini-k-causale-SPLITBUF(1:4)
           MOVE tor-anno(1:4) TO tordini-k-causale-SPLITBUF(5:4)
           MOVE tor-numero(1:8) TO tordini-k-causale-SPLITBUF(9:8)
           .

       tordini-k1-MERGE-SPLITBUF.
           INITIALIZE tordini-k1-SPLITBUF
           MOVE tor-cod-cli(1:5) TO tordini-k1-SPLITBUF(1:5)
           MOVE tor-prg-destino(1:5) TO tordini-k1-SPLITBUF(6:5)
           MOVE tor-anno(1:4) TO tordini-k1-SPLITBUF(11:4)
           MOVE tor-numero(1:8) TO tordini-k1-SPLITBUF(15:8)
           .

       tordini-k2-MERGE-SPLITBUF.
           INITIALIZE tordini-k2-SPLITBUF
           MOVE tor-data-passaggio-ordine(1:8) TO 
           tordini-k2-SPLITBUF(1:8)
           MOVE tor-anno(1:4) TO tordini-k2-SPLITBUF(9:4)
           MOVE tor-numero(1:8) TO tordini-k2-SPLITBUF(13:8)
           .

       tordini-k-bolla-MERGE-SPLITBUF.
           INITIALIZE tordini-k-bolla-SPLITBUF
           MOVE tor-anno-bolla(1:4) TO tordini-k-bolla-SPLITBUF(1:4)
           MOVE tor-num-bolla(1:8) TO tordini-k-bolla-SPLITBUF(5:8)
           .

       tordini-k3-MERGE-SPLITBUF.
           INITIALIZE tordini-k3-SPLITBUF
           MOVE tor-anno-bolla(1:4) TO tordini-k3-SPLITBUF(1:4)
           MOVE tor-data-bolla(1:8) TO tordini-k3-SPLITBUF(5:8)
           MOVE tor-num-bolla(1:8) TO tordini-k3-SPLITBUF(13:8)
           MOVE tor-bolla-prenotata(1:1) TO tordini-k3-SPLITBUF(21:1)
           .

       tordini-k-fattura-MERGE-SPLITBUF.
           INITIALIZE tordini-k-fattura-SPLITBUF
           MOVE tor-anno-fattura(1:4) TO tordini-k-fattura-SPLITBUF(1:4)
           MOVE tor-num-fattura(1:8) TO tordini-k-fattura-SPLITBUF(5:8)
           .

       tordini-k4-MERGE-SPLITBUF.
           INITIALIZE tordini-k4-SPLITBUF
           MOVE tor-anno-fattura(1:4) TO tordini-k4-SPLITBUF(1:4)
           MOVE tor-data-fattura(1:8) TO tordini-k4-SPLITBUF(5:8)
           MOVE tor-num-fattura(1:8) TO tordini-k4-SPLITBUF(13:8)
           MOVE tor-num-prenot(1:8) TO tordini-k4-SPLITBUF(21:8)
           MOVE tor-fatt-prenotata(1:1) TO tordini-k4-SPLITBUF(29:1)
           .

       tordini-k-contab-MERGE-SPLITBUF.
           INITIALIZE tordini-k-contab-SPLITBUF
           MOVE tor-agg-contab(1:1) TO tordini-k-contab-SPLITBUF(1:1)
           MOVE tor-anno-fattura(1:4) TO tordini-k-contab-SPLITBUF(2:4)
           MOVE tor-num-fattura(1:8) TO tordini-k-contab-SPLITBUF(6:8)
           .

       tordini-k-tipo-MERGE-SPLITBUF.
           INITIALIZE tordini-k-tipo-SPLITBUF
           MOVE tor-tipo(1:1) TO tordini-k-tipo-SPLITBUF(1:1)
           MOVE tor-chiave(1:12) TO tordini-k-tipo-SPLITBUF(2:12)
           .

       tordini-k-data-MERGE-SPLITBUF.
           INITIALIZE tordini-k-data-SPLITBUF
           MOVE tor-data-creazione(1:8) TO tordini-k-data-SPLITBUF(1:8)
           MOVE tor-numero(1:8) TO tordini-k-data-SPLITBUF(9:8)
           .

       tordini-k-agfatt-MERGE-SPLITBUF.
           INITIALIZE tordini-k-agfatt-SPLITBUF
           MOVE tor-anno-fattura(1:4) TO tordini-k-agfatt-SPLITBUF(1:4)
           MOVE tor-data-fattura(1:8) TO tordini-k-agfatt-SPLITBUF(5:8)
           MOVE tor-num-fattura(1:8) TO tordini-k-agfatt-SPLITBUF(13:8)
           MOVE tor-num-prenot(1:8) TO tordini-k-agfatt-SPLITBUF(21:8)
           MOVE tor-fatt-prenotata(1:1) TO 
           tordini-k-agfatt-SPLITBUF(29:1)
           MOVE tor-chiave(1:12) TO tordini-k-agfatt-SPLITBUF(30:12)
           .

       tordini-k-stbolle-MERGE-SPLITBUF.
           INITIALIZE tordini-k-stbolle-SPLITBUF
           MOVE tor-anno-bolla(1:4) TO tordini-k-stbolle-SPLITBUF(1:4)
           MOVE tor-data-bolla(1:8) TO tordini-k-stbolle-SPLITBUF(5:8)
           MOVE tor-num-bolla(1:8) TO tordini-k-stbolle-SPLITBUF(13:8)
           MOVE tor-bolla-prenotata(1:1) TO 
           tordini-k-stbolle-SPLITBUF(21:1)
           MOVE tor-chiave(1:12) TO tordini-k-stbolle-SPLITBUF(22:12)
           .

       tordini-k-andamento-data-MERGE-SPLITBUF.
           INITIALIZE tordini-k-andamento-data-SPLITBUF
           MOVE tor-agg-contab(1:1) TO 
           tordini-k-andamento-data-SPLITBUF(1:1)
           MOVE tor-data-fattura(1:8) TO 
           tordini-k-andamento-data-SPLITBUF(2:8)
           .

       tordini-k-andamento-cliente-MERGE-SPLITBUF.
           INITIALIZE tordini-k-andamento-cliente-SPLITBUF
           MOVE tor-cod-cli(1:5) TO 
           tordini-k-andamento-cliente-SPLITBUF(1:5)
           MOVE tor-agg-contab(1:1) TO 
           tordini-k-andamento-cliente-SPLITBUF(6:1)
           MOVE tor-data-fattura(1:8) TO 
           tordini-k-andamento-cliente-SPLITBUF(7:8)
           .

       tordini-k-andamento-clides-MERGE-SPLITBUF.
           INITIALIZE tordini-k-andamento-clides-SPLITBUF
           MOVE tor-cod-cli(1:5) TO 
           tordini-k-andamento-clides-SPLITBUF(1:5)
           MOVE tor-prg-destino(1:5) TO 
           tordini-k-andamento-clides-SPLITBUF(6:5)
           MOVE tor-agg-contab(1:1) TO 
           tordini-k-andamento-clides-SPLITBUF(11:1)
           MOVE tor-data-fattura(1:8) TO 
           tordini-k-andamento-clides-SPLITBUF(12:8)
           .

       tordini-k-promo-MERGE-SPLITBUF.
           INITIALIZE tordini-k-promo-SPLITBUF
           MOVE tor-stato(1:1) TO tordini-k-promo-SPLITBUF(1:1)
           MOVE tor-promo(1:1) TO tordini-k-promo-SPLITBUF(2:1)
           MOVE tor-data-ordine(1:8) TO tordini-k-promo-SPLITBUF(3:8)
           MOVE tor-numero(1:8) TO tordini-k-promo-SPLITBUF(11:8)
           MOVE tor-cod-cli(1:5) TO tordini-k-promo-SPLITBUF(19:5)
           MOVE tor-prg-destino(1:5) TO tordini-k-promo-SPLITBUF(24:5)
           .

       tordini-k-or-MERGE-SPLITBUF.
           INITIALIZE tordini-k-or-SPLITBUF
           MOVE tor-cod-cli(1:5) TO tordini-k-or-SPLITBUF(1:5)
           MOVE tor-prg-destino(1:5) TO tordini-k-or-SPLITBUF(6:5)
           MOVE tor-num-ord-cli(1:10) TO tordini-k-or-SPLITBUF(11:10)
           .

       tordini-k-tor-inviare-MERGE-SPLITBUF.
           INITIALIZE tordini-k-tor-inviare-SPLITBUF
           MOVE tor-da-inviare OF tordini(1:1) TO 
           tordini-k-tor-inviare-SPLITBUF(1:1)
           MOVE tor-chiave OF tordini(1:12) TO 
           tordini-k-tor-inviare-SPLITBUF(2:12)
           .

       tordini-k-tor-tipocli-MERGE-SPLITBUF.
           INITIALIZE tordini-k-tor-tipocli-SPLITBUF
           MOVE tor-tipocli OF tordini(1:2) TO 
           tordini-k-tor-tipocli-SPLITBUF(1:2)
           MOVE tor-cod-cli OF tordini(1:5) TO 
           tordini-k-tor-tipocli-SPLITBUF(3:5)
           MOVE tor-prg-destino OF tordini(1:5) TO 
           tordini-k-tor-tipocli-SPLITBUF(8:5)
           MOVE tor-chiave OF tordini(1:12) TO 
           tordini-k-tor-tipocli-SPLITBUF(13:12)
           .

       tordini-k-tor-gdo-MERGE-SPLITBUF.
           INITIALIZE tordini-k-tor-gdo-SPLITBUF
           MOVE tor-gdo OF tordini(1:5) TO 
           tordini-k-tor-gdo-SPLITBUF(1:5)
           MOVE tor-cod-cli OF tordini(1:5) TO 
           tordini-k-tor-gdo-SPLITBUF(6:5)
           MOVE tor-prg-destino OF tordini(1:5) TO 
           tordini-k-tor-gdo-SPLITBUF(11:5)
           MOVE tor-chiave OF tordini(1:12) TO 
           tordini-k-tor-gdo-SPLITBUF(16:12)
           .

       DataSet1-tordini-INITSTART.
           IF DataSet1-tordini-KEY-Asc
              MOVE Low-Value TO tor-chiave
           ELSE
              MOVE High-Value TO tor-chiave
           END-IF
           .

       DataSet1-tordini-INITEND.
           IF DataSet1-tordini-KEY-Asc
              MOVE High-Value TO tor-chiave
           ELSE
              MOVE Low-Value TO tor-chiave
           END-IF
           .

      * tordini
       DataSet1-tordini-START.
           IF DataSet1-tordini-KEY-Asc
              START tordini KEY >= tor-chiave
           ELSE
              START tordini KEY <= tor-chiave
           END-IF
           .

       DataSet1-tordini-START-NOTGREATER.
           IF DataSet1-tordini-KEY-Asc
              START tordini KEY <= tor-chiave
           ELSE
              START tordini KEY >= tor-chiave
           END-IF
           .

       DataSet1-tordini-START-GREATER.
           IF DataSet1-tordini-KEY-Asc
              START tordini KEY > tor-chiave
           ELSE
              START tordini KEY < tor-chiave
           END-IF
           .

       DataSet1-tordini-START-LESS.
           IF DataSet1-tordini-KEY-Asc
              START tordini KEY < tor-chiave
           ELSE
              START tordini KEY > tor-chiave
           END-IF
           .

       DataSet1-tordini-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tordini-LOCK
              READ tordini WITH LOCK 
              KEY tor-chiave
           ELSE
              READ tordini WITH NO LOCK 
              KEY tor-chiave
           END-IF
           PERFORM tordini-k-causale-MERGE-SPLITBUF
           PERFORM tordini-k1-MERGE-SPLITBUF
           PERFORM tordini-k2-MERGE-SPLITBUF
           PERFORM tordini-k-bolla-MERGE-SPLITBUF
           PERFORM tordini-k3-MERGE-SPLITBUF
           PERFORM tordini-k-fattura-MERGE-SPLITBUF
           PERFORM tordini-k4-MERGE-SPLITBUF
           PERFORM tordini-k-contab-MERGE-SPLITBUF
           PERFORM tordini-k-tipo-MERGE-SPLITBUF
           PERFORM tordini-k-data-MERGE-SPLITBUF
           PERFORM tordini-k-agfatt-MERGE-SPLITBUF
           PERFORM tordini-k-stbolle-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-data-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-cliente-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-clides-MERGE-SPLITBUF
           PERFORM tordini-k-promo-MERGE-SPLITBUF
           PERFORM tordini-k-or-MERGE-SPLITBUF
           PERFORM tordini-k-tor-inviare-MERGE-SPLITBUF
           PERFORM tordini-k-tor-tipocli-MERGE-SPLITBUF
           PERFORM tordini-k-tor-gdo-MERGE-SPLITBUF
           MOVE STATUS-tordini TO TOTEM-ERR-STAT 
           MOVE "tordini" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tordini-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tordini-KEY-Asc
              IF DataSet1-tordini-LOCK
                 READ tordini NEXT WITH LOCK
              ELSE
                 READ tordini NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tordini-LOCK
                 READ tordini PREVIOUS WITH LOCK
              ELSE
                 READ tordini PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tordini-k-causale-MERGE-SPLITBUF
           PERFORM tordini-k1-MERGE-SPLITBUF
           PERFORM tordini-k2-MERGE-SPLITBUF
           PERFORM tordini-k-bolla-MERGE-SPLITBUF
           PERFORM tordini-k3-MERGE-SPLITBUF
           PERFORM tordini-k-fattura-MERGE-SPLITBUF
           PERFORM tordini-k4-MERGE-SPLITBUF
           PERFORM tordini-k-contab-MERGE-SPLITBUF
           PERFORM tordini-k-tipo-MERGE-SPLITBUF
           PERFORM tordini-k-data-MERGE-SPLITBUF
           PERFORM tordini-k-agfatt-MERGE-SPLITBUF
           PERFORM tordini-k-stbolle-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-data-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-cliente-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-clides-MERGE-SPLITBUF
           PERFORM tordini-k-promo-MERGE-SPLITBUF
           PERFORM tordini-k-or-MERGE-SPLITBUF
           PERFORM tordini-k-tor-inviare-MERGE-SPLITBUF
           PERFORM tordini-k-tor-tipocli-MERGE-SPLITBUF
           PERFORM tordini-k-tor-gdo-MERGE-SPLITBUF
           MOVE STATUS-tordini TO TOTEM-ERR-STAT
           MOVE "tordini" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tordini-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tordini-KEY-Asc
              IF DataSet1-tordini-LOCK
                 READ tordini PREVIOUS WITH LOCK
              ELSE
                 READ tordini PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tordini-LOCK
                 READ tordini NEXT WITH LOCK
              ELSE
                 READ tordini NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tordini-k-causale-MERGE-SPLITBUF
           PERFORM tordini-k1-MERGE-SPLITBUF
           PERFORM tordini-k2-MERGE-SPLITBUF
           PERFORM tordini-k-bolla-MERGE-SPLITBUF
           PERFORM tordini-k3-MERGE-SPLITBUF
           PERFORM tordini-k-fattura-MERGE-SPLITBUF
           PERFORM tordini-k4-MERGE-SPLITBUF
           PERFORM tordini-k-contab-MERGE-SPLITBUF
           PERFORM tordini-k-tipo-MERGE-SPLITBUF
           PERFORM tordini-k-data-MERGE-SPLITBUF
           PERFORM tordini-k-agfatt-MERGE-SPLITBUF
           PERFORM tordini-k-stbolle-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-data-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-cliente-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-clides-MERGE-SPLITBUF
           PERFORM tordini-k-promo-MERGE-SPLITBUF
           PERFORM tordini-k-or-MERGE-SPLITBUF
           PERFORM tordini-k-tor-inviare-MERGE-SPLITBUF
           PERFORM tordini-k-tor-tipocli-MERGE-SPLITBUF
           PERFORM tordini-k-tor-gdo-MERGE-SPLITBUF
           MOVE STATUS-tordini TO TOTEM-ERR-STAT
           MOVE "tordini" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tordini-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tordini TO TOTEM-ERR-STAT
           MOVE "tordini" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tordini-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tordini TO TOTEM-ERR-STAT
           MOVE "tordini" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tordini-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tordini TO TOTEM-ERR-STAT
           MOVE "tordini" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterDelete>
      * <TOTEM:END>
           .

       rordini-ror-k-promo-MERGE-SPLITBUF.
           INITIALIZE rordini-ror-k-promo-SPLITBUF
           MOVE ror-promo OF rordini(1:15) TO 
           rordini-ror-k-promo-SPLITBUF(1:15)
           .

       rordini-ror-k-articolo-MERGE-SPLITBUF.
           INITIALIZE rordini-ror-k-articolo-SPLITBUF
           MOVE ror-cod-articolo OF rordini(1:6) TO 
           rordini-ror-k-articolo-SPLITBUF(1:6)
           MOVE ror-chiave OF rordini(1:17) TO 
           rordini-ror-k-articolo-SPLITBUF(7:17)
           .

       rordini-ror-k-master-MERGE-SPLITBUF.
           INITIALIZE rordini-ror-k-master-SPLITBUF
           MOVE ror-chiave-ordine OF rordini(1:17) TO 
           rordini-ror-k-master-SPLITBUF(1:17)
           MOVE ror-chiave OF rordini(1:17) TO 
           rordini-ror-k-master-SPLITBUF(18:17)
           .

       rordini-ror-k-stbolle-MERGE-SPLITBUF.
           INITIALIZE rordini-ror-k-stbolle-SPLITBUF
           MOVE ror-anno OF rordini(1:4) TO 
           rordini-ror-k-stbolle-SPLITBUF(1:4)
           MOVE ror-num-ordine OF rordini(1:8) TO 
           rordini-ror-k-stbolle-SPLITBUF(5:8)
           MOVE ror-chiave-ordine OF rordini(1:17) TO 
           rordini-ror-k-stbolle-SPLITBUF(13:17)
           .

       DataSet1-rordini-INITSTART.
           IF DataSet1-rordini-KEY-Asc
              MOVE Low-Value TO ror-chiave of rordini
           ELSE
              MOVE High-Value TO ror-chiave of rordini
           END-IF
           .

       DataSet1-rordini-INITEND.
           IF DataSet1-rordini-KEY-Asc
              MOVE High-Value TO ror-chiave of rordini
           ELSE
              MOVE Low-Value TO ror-chiave of rordini
           END-IF
           .

      * rordini
       DataSet1-rordini-START.
           IF DataSet1-rordini-KEY-Asc
              START rordini KEY >= ror-chiave of rordini
           ELSE
              START rordini KEY <= ror-chiave of rordini
           END-IF
           .

       DataSet1-rordini-START-NOTGREATER.
           IF DataSet1-rordini-KEY-Asc
              START rordini KEY <= ror-chiave of rordini
           ELSE
              START rordini KEY >= ror-chiave of rordini
           END-IF
           .

       DataSet1-rordini-START-GREATER.
           IF DataSet1-rordini-KEY-Asc
              START rordini KEY > ror-chiave of rordini
           ELSE
              START rordini KEY < ror-chiave of rordini
           END-IF
           .

       DataSet1-rordini-START-LESS.
           IF DataSet1-rordini-KEY-Asc
              START rordini KEY < ror-chiave of rordini
           ELSE
              START rordini KEY > ror-chiave of rordini
           END-IF
           .

       DataSet1-rordini-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-rordini-LOCK
              READ rordini WITH LOCK 
              KEY ror-chiave of rordini
           ELSE
              READ rordini WITH NO LOCK 
              KEY ror-chiave of rordini
           END-IF
           PERFORM rordini-ror-k-promo-MERGE-SPLITBUF
           PERFORM rordini-ror-k-articolo-MERGE-SPLITBUF
           PERFORM rordini-ror-k-master-MERGE-SPLITBUF
           PERFORM rordini-ror-k-stbolle-MERGE-SPLITBUF
           MOVE STATUS-rordini TO TOTEM-ERR-STAT 
           MOVE "rordini" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-rordini-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-rordini-KEY-Asc
              IF DataSet1-rordini-LOCK
                 READ rordini NEXT WITH LOCK
              ELSE
                 READ rordini NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-rordini-LOCK
                 READ rordini PREVIOUS WITH LOCK
              ELSE
                 READ rordini PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM rordini-ror-k-promo-MERGE-SPLITBUF
           PERFORM rordini-ror-k-articolo-MERGE-SPLITBUF
           PERFORM rordini-ror-k-master-MERGE-SPLITBUF
           PERFORM rordini-ror-k-stbolle-MERGE-SPLITBUF
           MOVE STATUS-rordini TO TOTEM-ERR-STAT
           MOVE "rordini" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-rordini-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-rordini-KEY-Asc
              IF DataSet1-rordini-LOCK
                 READ rordini PREVIOUS WITH LOCK
              ELSE
                 READ rordini PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-rordini-LOCK
                 READ rordini NEXT WITH LOCK
              ELSE
                 READ rordini NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM rordini-ror-k-promo-MERGE-SPLITBUF
           PERFORM rordini-ror-k-articolo-MERGE-SPLITBUF
           PERFORM rordini-ror-k-master-MERGE-SPLITBUF
           PERFORM rordini-ror-k-stbolle-MERGE-SPLITBUF
           MOVE STATUS-rordini TO TOTEM-ERR-STAT
           MOVE "rordini" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-rordini-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-rordini TO TOTEM-ERR-STAT
           MOVE "rordini" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-rordini-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-rordini TO TOTEM-ERR-STAT
           MOVE "rordini" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-rordini-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-rordini TO TOTEM-ERR-STAT
           MOVE "rordini" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, AfterDelete>
      * <TOTEM:END>
           .

       tcaumag-k-mag-MERGE-SPLITBUF.
           INITIALIZE tcaumag-k-mag-SPLITBUF
           MOVE tca-cod-magaz(1:3) TO tcaumag-k-mag-SPLITBUF(1:3)
           MOVE tca-ord-forn(1:1) TO tcaumag-k-mag-SPLITBUF(4:1)
           .

       DataSet1-tcaumag-INITSTART.
           IF DataSet1-tcaumag-KEY-Asc
              MOVE Low-Value TO tca-chiave
           ELSE
              MOVE High-Value TO tca-chiave
           END-IF
           .

       DataSet1-tcaumag-INITEND.
           IF DataSet1-tcaumag-KEY-Asc
              MOVE High-Value TO tca-chiave
           ELSE
              MOVE Low-Value TO tca-chiave
           END-IF
           .

      * tcaumag
       DataSet1-tcaumag-START.
           IF DataSet1-tcaumag-KEY-Asc
              START tcaumag KEY >= tca-chiave
           ELSE
              START tcaumag KEY <= tca-chiave
           END-IF
           .

       DataSet1-tcaumag-START-NOTGREATER.
           IF DataSet1-tcaumag-KEY-Asc
              START tcaumag KEY <= tca-chiave
           ELSE
              START tcaumag KEY >= tca-chiave
           END-IF
           .

       DataSet1-tcaumag-START-GREATER.
           IF DataSet1-tcaumag-KEY-Asc
              START tcaumag KEY > tca-chiave
           ELSE
              START tcaumag KEY < tca-chiave
           END-IF
           .

       DataSet1-tcaumag-START-LESS.
           IF DataSet1-tcaumag-KEY-Asc
              START tcaumag KEY < tca-chiave
           ELSE
              START tcaumag KEY > tca-chiave
           END-IF
           .

       DataSet1-tcaumag-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tcaumag-LOCK
              READ tcaumag WITH LOCK 
              KEY tca-chiave
           ELSE
              READ tcaumag WITH NO LOCK 
              KEY tca-chiave
           END-IF
           PERFORM tcaumag-k-mag-MERGE-SPLITBUF
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT 
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tcaumag-KEY-Asc
              IF DataSet1-tcaumag-LOCK
                 READ tcaumag NEXT WITH LOCK
              ELSE
                 READ tcaumag NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tcaumag-LOCK
                 READ tcaumag PREVIOUS WITH LOCK
              ELSE
                 READ tcaumag PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tcaumag-k-mag-MERGE-SPLITBUF
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tcaumag-KEY-Asc
              IF DataSet1-tcaumag-LOCK
                 READ tcaumag PREVIOUS WITH LOCK
              ELSE
                 READ tcaumag PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tcaumag-LOCK
                 READ tcaumag NEXT WITH LOCK
              ELSE
                 READ tcaumag NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tcaumag-k-mag-MERGE-SPLITBUF
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterDelete>
      * <TOTEM:END>
           .

       progmag-key01-MERGE-SPLITBUF.
           INITIALIZE progmag-key01-SPLITBUF
           MOVE prg-cod-magazzino OF progmag(1:3) TO 
           progmag-key01-SPLITBUF(1:3)
           MOVE prg-cod-articolo OF progmag(1:6) TO 
           progmag-key01-SPLITBUF(4:6)
           MOVE prg-tipo-imballo OF progmag(1:3) TO 
           progmag-key01-SPLITBUF(10:3)
           MOVE prg-peso OF progmag(1:8) TO progmag-key01-SPLITBUF(13:8)
           .

       DataSet1-progmag-INITSTART.
           IF DataSet1-progmag-KEY-Asc
              MOVE Low-Value TO prg-chiave OF progmag
           ELSE
              MOVE High-Value TO prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-INITEND.
           IF DataSet1-progmag-KEY-Asc
              MOVE High-Value TO prg-chiave OF progmag
           ELSE
              MOVE Low-Value TO prg-chiave OF progmag
           END-IF
           .

      * progmag
       DataSet1-progmag-START.
           IF DataSet1-progmag-KEY-Asc
              START progmag KEY >= prg-chiave OF progmag
           ELSE
              START progmag KEY <= prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-START-NOTGREATER.
           IF DataSet1-progmag-KEY-Asc
              START progmag KEY <= prg-chiave OF progmag
           ELSE
              START progmag KEY >= prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-START-GREATER.
           IF DataSet1-progmag-KEY-Asc
              START progmag KEY > prg-chiave OF progmag
           ELSE
              START progmag KEY < prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-START-LESS.
           IF DataSet1-progmag-KEY-Asc
              START progmag KEY < prg-chiave OF progmag
           ELSE
              START progmag KEY > prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-progmag-LOCK
              READ progmag WITH LOCK 
              KEY prg-chiave OF progmag
           ELSE
              READ progmag WITH NO LOCK 
              KEY prg-chiave OF progmag
           END-IF
           PERFORM progmag-key01-MERGE-SPLITBUF
           MOVE STATUS-progmag TO TOTEM-ERR-STAT 
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-progmag-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-progmag-KEY-Asc
              IF DataSet1-progmag-LOCK
                 READ progmag NEXT WITH LOCK
              ELSE
                 READ progmag NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-progmag-LOCK
                 READ progmag PREVIOUS WITH LOCK
              ELSE
                 READ progmag PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM progmag-key01-MERGE-SPLITBUF
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-progmag-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-progmag-KEY-Asc
              IF DataSet1-progmag-LOCK
                 READ progmag PREVIOUS WITH LOCK
              ELSE
                 READ progmag PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-progmag-LOCK
                 READ progmag NEXT WITH LOCK
              ELSE
                 READ progmag NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM progmag-key01-MERGE-SPLITBUF
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-progmag-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-progmag-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-progmag-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterDelete>
      * <TOTEM:END>
           .

       MAS-MAS-CODICE1-MERGE-SPLITBUF.
           INITIALIZE MAS-MAS-CODICE1-SPLITBUF
           MOVE MAS-CODICE-ALTERNATIVO(1:30) TO 
           MAS-MAS-CODICE1-SPLITBUF(1:30)
           MOVE MAS-CODICE(1:8) TO MAS-MAS-CODICE1-SPLITBUF(31:8)
           .

       MAS-MAS-CODICE2-MERGE-SPLITBUF.
           INITIALIZE MAS-MAS-CODICE2-SPLITBUF
           MOVE MAS-DESCRIZIONE1(1:30) TO MAS-MAS-CODICE2-SPLITBUF(1:30)
           MOVE MAS-CODICE(1:8) TO MAS-MAS-CODICE2-SPLITBUF(31:8)
           .

       DataSet1-MAS-INITSTART.
           IF DataSet1-MAS-KEY-Asc
              MOVE Low-Value TO MAS-CODICE
           ELSE
              MOVE High-Value TO MAS-CODICE
           END-IF
           .

       DataSet1-MAS-INITEND.
           IF DataSet1-MAS-KEY-Asc
              MOVE High-Value TO MAS-CODICE
           ELSE
              MOVE Low-Value TO MAS-CODICE
           END-IF
           .

      * MAS
       DataSet1-MAS-START.
           IF DataSet1-MAS-KEY-Asc
              START MAS KEY >= MAS-CODICE
           ELSE
              START MAS KEY <= MAS-CODICE
           END-IF
           .

       DataSet1-MAS-START-NOTGREATER.
           IF DataSet1-MAS-KEY-Asc
              START MAS KEY <= MAS-CODICE
           ELSE
              START MAS KEY >= MAS-CODICE
           END-IF
           .

       DataSet1-MAS-START-GREATER.
           IF DataSet1-MAS-KEY-Asc
              START MAS KEY > MAS-CODICE
           ELSE
              START MAS KEY < MAS-CODICE
           END-IF
           .

       DataSet1-MAS-START-LESS.
           IF DataSet1-MAS-KEY-Asc
              START MAS KEY < MAS-CODICE
           ELSE
              START MAS KEY > MAS-CODICE
           END-IF
           .

       DataSet1-MAS-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:MAS, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:MAS, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-MAS-LOCK
              READ MAS WITH LOCK 
              KEY MAS-CODICE
           ELSE
              READ MAS WITH NO LOCK 
              KEY MAS-CODICE
           END-IF
           PERFORM MAS-MAS-CODICE1-MERGE-SPLITBUF
           PERFORM MAS-MAS-CODICE2-MERGE-SPLITBUF
           MOVE STATUS-MAS TO TOTEM-ERR-STAT 
           MOVE "MAS" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:MAS, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:MAS, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-MAS-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:MAS, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:MAS, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-MAS-KEY-Asc
              IF DataSet1-MAS-LOCK
                 READ MAS NEXT WITH LOCK
              ELSE
                 READ MAS NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-MAS-LOCK
                 READ MAS PREVIOUS WITH LOCK
              ELSE
                 READ MAS PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM MAS-MAS-CODICE1-MERGE-SPLITBUF
           PERFORM MAS-MAS-CODICE2-MERGE-SPLITBUF
           MOVE STATUS-MAS TO TOTEM-ERR-STAT
           MOVE "MAS" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:MAS, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:MAS, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-MAS-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:MAS, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:MAS, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-MAS-KEY-Asc
              IF DataSet1-MAS-LOCK
                 READ MAS PREVIOUS WITH LOCK
              ELSE
                 READ MAS PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-MAS-LOCK
                 READ MAS NEXT WITH LOCK
              ELSE
                 READ MAS NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM MAS-MAS-CODICE1-MERGE-SPLITBUF
           PERFORM MAS-MAS-CODICE2-MERGE-SPLITBUF
           MOVE STATUS-MAS TO TOTEM-ERR-STAT
           MOVE "MAS" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:MAS, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:MAS, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-MAS-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:MAS, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-MAS TO TOTEM-ERR-STAT
           MOVE "MAS" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:MAS, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-MAS-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:MAS, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-MAS TO TOTEM-ERR-STAT
           MOVE "MAS" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:MAS, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-MAS-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:MAS, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-MAS TO TOTEM-ERR-STAT
           MOVE "MAS" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:MAS, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-timballi-INITSTART.
           IF DataSet1-timballi-KEY-Asc
              MOVE Low-Value TO imb-chiave
           ELSE
              MOVE High-Value TO imb-chiave
           END-IF
           .

       DataSet1-timballi-INITEND.
           IF DataSet1-timballi-KEY-Asc
              MOVE High-Value TO imb-chiave
           ELSE
              MOVE Low-Value TO imb-chiave
           END-IF
           .

      * timballi
       DataSet1-timballi-START.
           IF DataSet1-timballi-KEY-Asc
              START timballi KEY >= imb-chiave
           ELSE
              START timballi KEY <= imb-chiave
           END-IF
           .

       DataSet1-timballi-START-NOTGREATER.
           IF DataSet1-timballi-KEY-Asc
              START timballi KEY <= imb-chiave
           ELSE
              START timballi KEY >= imb-chiave
           END-IF
           .

       DataSet1-timballi-START-GREATER.
           IF DataSet1-timballi-KEY-Asc
              START timballi KEY > imb-chiave
           ELSE
              START timballi KEY < imb-chiave
           END-IF
           .

       DataSet1-timballi-START-LESS.
           IF DataSet1-timballi-KEY-Asc
              START timballi KEY < imb-chiave
           ELSE
              START timballi KEY > imb-chiave
           END-IF
           .

       DataSet1-timballi-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-timballi-LOCK
              READ timballi WITH LOCK 
              KEY imb-chiave
           ELSE
              READ timballi WITH NO LOCK 
              KEY imb-chiave
           END-IF
           MOVE STATUS-timballi TO TOTEM-ERR-STAT 
           MOVE "timballi" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-timballi-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-timballi-KEY-Asc
              IF DataSet1-timballi-LOCK
                 READ timballi NEXT WITH LOCK
              ELSE
                 READ timballi NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-timballi-LOCK
                 READ timballi PREVIOUS WITH LOCK
              ELSE
                 READ timballi PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-timballi TO TOTEM-ERR-STAT
           MOVE "timballi" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-timballi-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-timballi-KEY-Asc
              IF DataSet1-timballi-LOCK
                 READ timballi PREVIOUS WITH LOCK
              ELSE
                 READ timballi PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-timballi-LOCK
                 READ timballi NEXT WITH LOCK
              ELSE
                 READ timballi NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-timballi TO TOTEM-ERR-STAT
           MOVE "timballi" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-timballi-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-timballi TO TOTEM-ERR-STAT
           MOVE "timballi" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-timballi-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-timballi TO TOTEM-ERR-STAT
           MOVE "timballi" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-timballi-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-timballi TO TOTEM-ERR-STAT
           MOVE "timballi" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-timbalqta-INITSTART.
           IF DataSet1-timbalqta-KEY-Asc
              MOVE Low-Value TO imq-chiave
           ELSE
              MOVE High-Value TO imq-chiave
           END-IF
           .

       DataSet1-timbalqta-INITEND.
           IF DataSet1-timbalqta-KEY-Asc
              MOVE High-Value TO imq-chiave
           ELSE
              MOVE Low-Value TO imq-chiave
           END-IF
           .

      * timbalqta
       DataSet1-timbalqta-START.
           IF DataSet1-timbalqta-KEY-Asc
              START timbalqta KEY >= imq-chiave
           ELSE
              START timbalqta KEY <= imq-chiave
           END-IF
           .

       DataSet1-timbalqta-START-NOTGREATER.
           IF DataSet1-timbalqta-KEY-Asc
              START timbalqta KEY <= imq-chiave
           ELSE
              START timbalqta KEY >= imq-chiave
           END-IF
           .

       DataSet1-timbalqta-START-GREATER.
           IF DataSet1-timbalqta-KEY-Asc
              START timbalqta KEY > imq-chiave
           ELSE
              START timbalqta KEY < imq-chiave
           END-IF
           .

       DataSet1-timbalqta-START-LESS.
           IF DataSet1-timbalqta-KEY-Asc
              START timbalqta KEY < imq-chiave
           ELSE
              START timbalqta KEY > imq-chiave
           END-IF
           .

       DataSet1-timbalqta-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-timbalqta-LOCK
              READ timbalqta WITH LOCK 
              KEY imq-chiave
           ELSE
              READ timbalqta WITH NO LOCK 
              KEY imq-chiave
           END-IF
           MOVE STATUS-timbalqta TO TOTEM-ERR-STAT 
           MOVE "timbalqta" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-timbalqta-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-timbalqta-KEY-Asc
              IF DataSet1-timbalqta-LOCK
                 READ timbalqta NEXT WITH LOCK
              ELSE
                 READ timbalqta NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-timbalqta-LOCK
                 READ timbalqta PREVIOUS WITH LOCK
              ELSE
                 READ timbalqta PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-timbalqta TO TOTEM-ERR-STAT
           MOVE "timbalqta" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-timbalqta-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-timbalqta-KEY-Asc
              IF DataSet1-timbalqta-LOCK
                 READ timbalqta PREVIOUS WITH LOCK
              ELSE
                 READ timbalqta PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-timbalqta-LOCK
                 READ timbalqta NEXT WITH LOCK
              ELSE
                 READ timbalqta NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-timbalqta TO TOTEM-ERR-STAT
           MOVE "timbalqta" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-timbalqta-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-timbalqta TO TOTEM-ERR-STAT
           MOVE "timbalqta" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-timbalqta-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-timbalqta TO TOTEM-ERR-STAT
           MOVE "timbalqta" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-timbalqta-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-timbalqta TO TOTEM-ERR-STAT
           MOVE "timbalqta" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tmagaz-INITSTART.
           IF DataSet1-tmagaz-KEY-Asc
              MOVE Low-Value TO mag-chiave
           ELSE
              MOVE High-Value TO mag-chiave
           END-IF
           .

       DataSet1-tmagaz-INITEND.
           IF DataSet1-tmagaz-KEY-Asc
              MOVE High-Value TO mag-chiave
           ELSE
              MOVE Low-Value TO mag-chiave
           END-IF
           .

      * tmagaz
       DataSet1-tmagaz-START.
           IF DataSet1-tmagaz-KEY-Asc
              START tmagaz KEY >= mag-chiave
           ELSE
              START tmagaz KEY <= mag-chiave
           END-IF
           .

       DataSet1-tmagaz-START-NOTGREATER.
           IF DataSet1-tmagaz-KEY-Asc
              START tmagaz KEY <= mag-chiave
           ELSE
              START tmagaz KEY >= mag-chiave
           END-IF
           .

       DataSet1-tmagaz-START-GREATER.
           IF DataSet1-tmagaz-KEY-Asc
              START tmagaz KEY > mag-chiave
           ELSE
              START tmagaz KEY < mag-chiave
           END-IF
           .

       DataSet1-tmagaz-START-LESS.
           IF DataSet1-tmagaz-KEY-Asc
              START tmagaz KEY < mag-chiave
           ELSE
              START tmagaz KEY > mag-chiave
           END-IF
           .

       DataSet1-tmagaz-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tmagaz-LOCK
              READ tmagaz WITH LOCK 
              KEY mag-chiave
           ELSE
              READ tmagaz WITH NO LOCK 
              KEY mag-chiave
           END-IF
           MOVE STATUS-tmagaz TO TOTEM-ERR-STAT 
           MOVE "tmagaz" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tmagaz-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tmagaz-KEY-Asc
              IF DataSet1-tmagaz-LOCK
                 READ tmagaz NEXT WITH LOCK
              ELSE
                 READ tmagaz NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tmagaz-LOCK
                 READ tmagaz PREVIOUS WITH LOCK
              ELSE
                 READ tmagaz PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tmagaz TO TOTEM-ERR-STAT
           MOVE "tmagaz" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tmagaz-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tmagaz-KEY-Asc
              IF DataSet1-tmagaz-LOCK
                 READ tmagaz PREVIOUS WITH LOCK
              ELSE
                 READ tmagaz PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tmagaz-LOCK
                 READ tmagaz NEXT WITH LOCK
              ELSE
                 READ tmagaz NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tmagaz TO TOTEM-ERR-STAT
           MOVE "tmagaz" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tmagaz-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tmagaz TO TOTEM-ERR-STAT
           MOVE "tmagaz" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tmagaz-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tmagaz TO TOTEM-ERR-STAT
           MOVE "tmagaz" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tmagaz-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tmagaz TO TOTEM-ERR-STAT
           MOVE "tmagaz" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-recapiti-INITSTART.
           IF DataSet1-recapiti-KEY-Asc
              MOVE Low-Value TO rec-chiave
           ELSE
              MOVE High-Value TO rec-chiave
           END-IF
           .

       DataSet1-recapiti-INITEND.
           IF DataSet1-recapiti-KEY-Asc
              MOVE High-Value TO rec-chiave
           ELSE
              MOVE Low-Value TO rec-chiave
           END-IF
           .

      * recapiti
       DataSet1-recapiti-START.
           IF DataSet1-recapiti-KEY-Asc
              START recapiti KEY >= rec-chiave
           ELSE
              START recapiti KEY <= rec-chiave
           END-IF
           .

       DataSet1-recapiti-START-NOTGREATER.
           IF DataSet1-recapiti-KEY-Asc
              START recapiti KEY <= rec-chiave
           ELSE
              START recapiti KEY >= rec-chiave
           END-IF
           .

       DataSet1-recapiti-START-GREATER.
           IF DataSet1-recapiti-KEY-Asc
              START recapiti KEY > rec-chiave
           ELSE
              START recapiti KEY < rec-chiave
           END-IF
           .

       DataSet1-recapiti-START-LESS.
           IF DataSet1-recapiti-KEY-Asc
              START recapiti KEY < rec-chiave
           ELSE
              START recapiti KEY > rec-chiave
           END-IF
           .

       DataSet1-recapiti-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-recapiti-LOCK
              READ recapiti WITH LOCK 
              KEY rec-chiave
           ELSE
              READ recapiti WITH NO LOCK 
              KEY rec-chiave
           END-IF
           MOVE STATUS-recapiti TO TOTEM-ERR-STAT 
           MOVE "recapiti" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-recapiti-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-recapiti-KEY-Asc
              IF DataSet1-recapiti-LOCK
                 READ recapiti NEXT WITH LOCK
              ELSE
                 READ recapiti NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-recapiti-LOCK
                 READ recapiti PREVIOUS WITH LOCK
              ELSE
                 READ recapiti PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-recapiti TO TOTEM-ERR-STAT
           MOVE "recapiti" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-recapiti-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-recapiti-KEY-Asc
              IF DataSet1-recapiti-LOCK
                 READ recapiti PREVIOUS WITH LOCK
              ELSE
                 READ recapiti PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-recapiti-LOCK
                 READ recapiti NEXT WITH LOCK
              ELSE
                 READ recapiti NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-recapiti TO TOTEM-ERR-STAT
           MOVE "recapiti" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-recapiti-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-recapiti TO TOTEM-ERR-STAT
           MOVE "recapiti" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-recapiti-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-recapiti TO TOTEM-ERR-STAT
           MOVE "recapiti" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-recapiti-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-recapiti TO TOTEM-ERR-STAT
           MOVE "recapiti" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, AfterDelete>
      * <TOTEM:END>
           .

       tmp-progmag-zoom-key-des-MERGE-SPLITBUF.
           INITIALIZE tmp-progmag-zoom-key-des-SPLITBUF
           MOVE tmp-prg-z-art-des(1:40) TO 
           tmp-progmag-zoom-key-des-SPLITBUF(1:40)
           MOVE tmp-prg-z-chiave(1:23) TO 
           tmp-progmag-zoom-key-des-SPLITBUF(41:23)
           .

       tmp-progmag-zoom-key-des-SPLITBUF-TOFLD.
           MOVE tmp-progmag-zoom-key-des-SPLITBUF(1:40) TO 
           tmp-prg-z-art-des(1:40)
           MOVE tmp-progmag-zoom-key-des-SPLITBUF(41:23) TO 
           tmp-prg-z-chiave(1:23)
           .

       tmp-progmag-zoom-key-art-MERGE-SPLITBUF.
           INITIALIZE tmp-progmag-zoom-key-art-SPLITBUF
           MOVE tmp-prg-z-cod-articolo(1:6) TO 
           tmp-progmag-zoom-key-art-SPLITBUF(1:6)
           .

       DataSet1-tmp-progmag-zoom-INITSTART.
           IF DataSet1-tmp-progmag-zoom-KEY-Asc
              MOVE Low-Value TO tmp-prg-z-art-des
           ELSE
              MOVE High-Value TO tmp-prg-z-art-des
           END-IF
           IF DataSet1-tmp-progmag-zoom-KEY-Asc
              MOVE Low-Value TO tmp-prg-z-chiave
           ELSE
              MOVE High-Value TO tmp-prg-z-chiave
           END-IF
           .

       DataSet1-tmp-progmag-zoom-INITEND.
           IF DataSet1-tmp-progmag-zoom-KEY-Asc
              MOVE High-Value to tmp-prg-z-art-des
           ELSE
              MOVE Low-Value to tmp-prg-z-art-des
           END-IF
           IF DataSet1-tmp-progmag-zoom-KEY-Asc
              MOVE High-Value to tmp-prg-z-chiave
           ELSE
              MOVE Low-Value to tmp-prg-z-chiave
           END-IF
           .

       DataSet1-tmp-progmag-zoom-TMPBUF-TO-FLD.
           MOVE DataSet1-tmp-progmag-zoom-SPLIT-BUF1(1:40) TO
                tmp-prg-z-art-des(1:40)
           MOVE DataSet1-tmp-progmag-zoom-SPLIT-BUF1(41:23) TO
                tmp-prg-z-chiave(1:23)
           .

       DataSet1-tmp-progmag-zoom-FLD-TO-TMPBUF.
           MOVE tmp-prg-z-art-des(1:40) TO
                DataSet1-tmp-progmag-zoom-SPLIT-BUF1(1:40)
           MOVE tmp-prg-z-chiave(1:23) TO
                DataSet1-tmp-progmag-zoom-SPLIT-BUF1(41:23)
           .

      * tmp-progmag-zoom
       DataSet1-tmp-progmag-zoom-START.
           IF DataSet1-tmp-progmag-zoom-KEY-Asc
              START tmp-progmag-zoom KEY >= key-des
           ELSE
              START tmp-progmag-zoom KEY <= key-des
           END-IF
           .

       DataSet1-tmp-progmag-zoom-START-NOTGREATER.
           IF DataSet1-tmp-progmag-zoom-KEY-Asc
              START tmp-progmag-zoom KEY <= key-des
           ELSE
              START tmp-progmag-zoom KEY >= key-des
           END-IF
           .

       DataSet1-tmp-progmag-zoom-START-GREATER.
           IF DataSet1-tmp-progmag-zoom-KEY-Asc
              START tmp-progmag-zoom KEY > key-des
           ELSE
              START tmp-progmag-zoom KEY < key-des
           END-IF
           .

       DataSet1-tmp-progmag-zoom-START-LESS.
           IF DataSet1-tmp-progmag-zoom-KEY-Asc
              START tmp-progmag-zoom KEY < key-des
           ELSE
              START tmp-progmag-zoom KEY > key-des
           END-IF
           .

       DataSet1-tmp-progmag-zoom-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, BeforeReadRecord>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tmp-progmag-zoom-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, BeforeReadNext>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tmp-progmag-zoom-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, BeforeReadPrev>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tmp-progmag-zoom-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, BeforeWrite>
      * <TOTEM:END>
           WRITE tmp-prg-z-rec OF tmp-progmag-zoom.
           MOVE STATUS-tmp-progmag-zoom TO TOTEM-ERR-STAT
           MOVE "tmp-progmag-zoom" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tmp-progmag-zoom-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tmp-progmag-zoom TO TOTEM-ERR-STAT
           MOVE "tmp-progmag-zoom" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tmp-progmag-zoom-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tmp-progmag-zoom TO TOTEM-ERR-STAT
           MOVE "tmp-progmag-zoom" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, AfterDelete>
      * <TOTEM:END>
           .

       btnotacr-k1-MERGE-SPLITBUF.
           INITIALIZE btnotacr-k1-SPLITBUF
           MOVE btno-cod-cli(1:5) TO btnotacr-k1-SPLITBUF(1:5)
           MOVE btno-prg-destino(1:5) TO btnotacr-k1-SPLITBUF(6:5)
           MOVE btno-anno(1:4) TO btnotacr-k1-SPLITBUF(11:4)
           MOVE btno-numero(1:8) TO btnotacr-k1-SPLITBUF(15:8)
           .

       btnotacr-k-data-MERGE-SPLITBUF.
           INITIALIZE btnotacr-k-data-SPLITBUF
           MOVE btno-data(1:8) TO btnotacr-k-data-SPLITBUF(1:8)
           MOVE btno-numero(1:8) TO btnotacr-k-data-SPLITBUF(9:8)
           .

       btnotacr-k-fattura-MERGE-SPLITBUF.
           INITIALIZE btnotacr-k-fattura-SPLITBUF
           MOVE btno-anno-fatt(1:4) TO btnotacr-k-fattura-SPLITBUF(1:4)
           MOVE btno-num-fatt(1:8) TO btnotacr-k-fattura-SPLITBUF(5:8)
           .

       btnotacr-k-reso-MERGE-SPLITBUF.
           INITIALIZE btnotacr-k-reso-SPLITBUF
           MOVE btno-anno(1:4) TO btnotacr-k-reso-SPLITBUF(1:4)
           MOVE btno-num-reso(1:8) TO btnotacr-k-reso-SPLITBUF(5:8)
           .

       btnotacr-k-bolla-MERGE-SPLITBUF.
           INITIALIZE btnotacr-k-bolla-SPLITBUF
           MOVE btno-anno-bolla(1:4) TO btnotacr-k-bolla-SPLITBUF(1:4)
           MOVE btno-num-bolla(1:20) TO btnotacr-k-bolla-SPLITBUF(5:20)
           .

       btnotacr-k-vettore-MERGE-SPLITBUF.
           INITIALIZE btnotacr-k-vettore-SPLITBUF
           MOVE btno-vettore(1:5) TO btnotacr-k-vettore-SPLITBUF(1:5)
           MOVE btno-anno(1:4) TO btnotacr-k-vettore-SPLITBUF(6:4)
           MOVE btno-numero(1:8) TO btnotacr-k-vettore-SPLITBUF(10:8)
           .

       btnotacr-k-nota-MERGE-SPLITBUF.
           INITIALIZE btnotacr-k-nota-SPLITBUF
           MOVE btno-anno-nc(1:4) TO btnotacr-k-nota-SPLITBUF(1:4)
           MOVE btno-num-nc(1:8) TO btnotacr-k-nota-SPLITBUF(5:8)
           .

       btnotacr-k-fatman-MERGE-SPLITBUF.
           INITIALIZE btnotacr-k-fatman-SPLITBUF
           MOVE btno-anno-fm(1:4) TO btnotacr-k-fatman-SPLITBUF(1:4)
           MOVE btno-num-fm(1:8) TO btnotacr-k-fatman-SPLITBUF(5:8)
           .

       DataSet1-btnotacr-INITSTART.
           IF DataSet1-btnotacr-KEY-Asc
              MOVE Low-Value TO btno-chiave
           ELSE
              MOVE High-Value TO btno-chiave
           END-IF
           .

       DataSet1-btnotacr-INITEND.
           IF DataSet1-btnotacr-KEY-Asc
              MOVE High-Value TO btno-chiave
           ELSE
              MOVE Low-Value TO btno-chiave
           END-IF
           .

      * btnotacr
       DataSet1-btnotacr-START.
           IF DataSet1-btnotacr-KEY-Asc
              START btnotacr KEY >= btno-chiave
           ELSE
              START btnotacr KEY <= btno-chiave
           END-IF
           .

       DataSet1-btnotacr-START-NOTGREATER.
           IF DataSet1-btnotacr-KEY-Asc
              START btnotacr KEY <= btno-chiave
           ELSE
              START btnotacr KEY >= btno-chiave
           END-IF
           .

       DataSet1-btnotacr-START-GREATER.
           IF DataSet1-btnotacr-KEY-Asc
              START btnotacr KEY > btno-chiave
           ELSE
              START btnotacr KEY < btno-chiave
           END-IF
           .

       DataSet1-btnotacr-START-LESS.
           IF DataSet1-btnotacr-KEY-Asc
              START btnotacr KEY < btno-chiave
           ELSE
              START btnotacr KEY > btno-chiave
           END-IF
           .

       DataSet1-btnotacr-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-btnotacr-LOCK
              READ btnotacr WITH LOCK 
              KEY btno-chiave
           ELSE
              READ btnotacr WITH NO LOCK 
              KEY btno-chiave
           END-IF
           PERFORM btnotacr-k1-MERGE-SPLITBUF
           PERFORM btnotacr-k-data-MERGE-SPLITBUF
           PERFORM btnotacr-k-fattura-MERGE-SPLITBUF
           PERFORM btnotacr-k-reso-MERGE-SPLITBUF
           PERFORM btnotacr-k-bolla-MERGE-SPLITBUF
           PERFORM btnotacr-k-vettore-MERGE-SPLITBUF
           PERFORM btnotacr-k-nota-MERGE-SPLITBUF
           PERFORM btnotacr-k-fatman-MERGE-SPLITBUF
           MOVE STATUS-btnotacr TO TOTEM-ERR-STAT 
           MOVE "btnotacr" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-btnotacr-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-btnotacr-KEY-Asc
              IF DataSet1-btnotacr-LOCK
                 READ btnotacr NEXT WITH LOCK
              ELSE
                 READ btnotacr NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-btnotacr-LOCK
                 READ btnotacr PREVIOUS WITH LOCK
              ELSE
                 READ btnotacr PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM btnotacr-k1-MERGE-SPLITBUF
           PERFORM btnotacr-k-data-MERGE-SPLITBUF
           PERFORM btnotacr-k-fattura-MERGE-SPLITBUF
           PERFORM btnotacr-k-reso-MERGE-SPLITBUF
           PERFORM btnotacr-k-bolla-MERGE-SPLITBUF
           PERFORM btnotacr-k-vettore-MERGE-SPLITBUF
           PERFORM btnotacr-k-nota-MERGE-SPLITBUF
           PERFORM btnotacr-k-fatman-MERGE-SPLITBUF
           MOVE STATUS-btnotacr TO TOTEM-ERR-STAT
           MOVE "btnotacr" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-btnotacr-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-btnotacr-KEY-Asc
              IF DataSet1-btnotacr-LOCK
                 READ btnotacr PREVIOUS WITH LOCK
              ELSE
                 READ btnotacr PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-btnotacr-LOCK
                 READ btnotacr NEXT WITH LOCK
              ELSE
                 READ btnotacr NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM btnotacr-k1-MERGE-SPLITBUF
           PERFORM btnotacr-k-data-MERGE-SPLITBUF
           PERFORM btnotacr-k-fattura-MERGE-SPLITBUF
           PERFORM btnotacr-k-reso-MERGE-SPLITBUF
           PERFORM btnotacr-k-bolla-MERGE-SPLITBUF
           PERFORM btnotacr-k-vettore-MERGE-SPLITBUF
           PERFORM btnotacr-k-nota-MERGE-SPLITBUF
           PERFORM btnotacr-k-fatman-MERGE-SPLITBUF
           MOVE STATUS-btnotacr TO TOTEM-ERR-STAT
           MOVE "btnotacr" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-btnotacr-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-btnotacr TO TOTEM-ERR-STAT
           MOVE "btnotacr" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-btnotacr-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-btnotacr TO TOTEM-ERR-STAT
           MOVE "btnotacr" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-btnotacr-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-btnotacr TO TOTEM-ERR-STAT
           MOVE "btnotacr" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, AfterDelete>
      * <TOTEM:END>
           .

       brnotacr-brno-k-articolo-MERGE-SPLITBUF.
           INITIALIZE brnotacr-brno-k-articolo-SPLITBUF
           MOVE brno-cod-articolo(1:6) TO 
           brnotacr-brno-k-articolo-SPLITBUF(1:6)
           MOVE brno-chiave(1:18) TO 
           brnotacr-brno-k-articolo-SPLITBUF(7:18)
           .

       DataSet1-brnotacr-INITSTART.
           IF DataSet1-brnotacr-KEY-Asc
              MOVE Low-Value TO brno-chiave
           ELSE
              MOVE High-Value TO brno-chiave
           END-IF
           .

       DataSet1-brnotacr-INITEND.
           IF DataSet1-brnotacr-KEY-Asc
              MOVE High-Value TO brno-chiave
           ELSE
              MOVE Low-Value TO brno-chiave
           END-IF
           .

      * brnotacr
       DataSet1-brnotacr-START.
           IF DataSet1-brnotacr-KEY-Asc
              START brnotacr KEY >= brno-chiave
           ELSE
              START brnotacr KEY <= brno-chiave
           END-IF
           .

       DataSet1-brnotacr-START-NOTGREATER.
           IF DataSet1-brnotacr-KEY-Asc
              START brnotacr KEY <= brno-chiave
           ELSE
              START brnotacr KEY >= brno-chiave
           END-IF
           .

       DataSet1-brnotacr-START-GREATER.
           IF DataSet1-brnotacr-KEY-Asc
              START brnotacr KEY > brno-chiave
           ELSE
              START brnotacr KEY < brno-chiave
           END-IF
           .

       DataSet1-brnotacr-START-LESS.
           IF DataSet1-brnotacr-KEY-Asc
              START brnotacr KEY < brno-chiave
           ELSE
              START brnotacr KEY > brno-chiave
           END-IF
           .

       DataSet1-brnotacr-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-brnotacr-LOCK
              READ brnotacr WITH LOCK 
              KEY brno-chiave
           ELSE
              READ brnotacr WITH NO LOCK 
              KEY brno-chiave
           END-IF
           PERFORM brnotacr-brno-k-articolo-MERGE-SPLITBUF
           MOVE STATUS-brnotacr TO TOTEM-ERR-STAT 
           MOVE "brnotacr" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-brnotacr-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-brnotacr-KEY-Asc
              IF DataSet1-brnotacr-LOCK
                 READ brnotacr NEXT WITH LOCK
              ELSE
                 READ brnotacr NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-brnotacr-LOCK
                 READ brnotacr PREVIOUS WITH LOCK
              ELSE
                 READ brnotacr PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM brnotacr-brno-k-articolo-MERGE-SPLITBUF
           MOVE STATUS-brnotacr TO TOTEM-ERR-STAT
           MOVE "brnotacr" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-brnotacr-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-brnotacr-KEY-Asc
              IF DataSet1-brnotacr-LOCK
                 READ brnotacr PREVIOUS WITH LOCK
              ELSE
                 READ brnotacr PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-brnotacr-LOCK
                 READ brnotacr NEXT WITH LOCK
              ELSE
                 READ brnotacr NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM brnotacr-brno-k-articolo-MERGE-SPLITBUF
           MOVE STATUS-brnotacr TO TOTEM-ERR-STAT
           MOVE "brnotacr" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-brnotacr-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-brnotacr TO TOTEM-ERR-STAT
           MOVE "brnotacr" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-brnotacr-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-brnotacr TO TOTEM-ERR-STAT
           MOVE "brnotacr" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-brnotacr-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-brnotacr TO TOTEM-ERR-STAT
           MOVE "brnotacr" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, AfterDelete>
      * <TOTEM:END>
           .

       tvettori-k-des-MERGE-SPLITBUF.
           INITIALIZE tvettori-k-des-SPLITBUF
           MOVE vet-descrizione(1:40) TO tvettori-k-des-SPLITBUF(1:40)
           .

       DataSet1-tvettori-INITSTART.
           IF DataSet1-tvettori-KEY-Asc
              MOVE Low-Value TO vet-chiave
           ELSE
              MOVE High-Value TO vet-chiave
           END-IF
           .

       DataSet1-tvettori-INITEND.
           IF DataSet1-tvettori-KEY-Asc
              MOVE High-Value TO vet-chiave
           ELSE
              MOVE Low-Value TO vet-chiave
           END-IF
           .

      * tvettori
       DataSet1-tvettori-START.
           IF DataSet1-tvettori-KEY-Asc
              START tvettori KEY >= vet-chiave
           ELSE
              START tvettori KEY <= vet-chiave
           END-IF
           .

       DataSet1-tvettori-START-NOTGREATER.
           IF DataSet1-tvettori-KEY-Asc
              START tvettori KEY <= vet-chiave
           ELSE
              START tvettori KEY >= vet-chiave
           END-IF
           .

       DataSet1-tvettori-START-GREATER.
           IF DataSet1-tvettori-KEY-Asc
              START tvettori KEY > vet-chiave
           ELSE
              START tvettori KEY < vet-chiave
           END-IF
           .

       DataSet1-tvettori-START-LESS.
           IF DataSet1-tvettori-KEY-Asc
              START tvettori KEY < vet-chiave
           ELSE
              START tvettori KEY > vet-chiave
           END-IF
           .

       DataSet1-tvettori-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tvettori-LOCK
              READ tvettori WITH LOCK 
              KEY vet-chiave
           ELSE
              READ tvettori WITH NO LOCK 
              KEY vet-chiave
           END-IF
           PERFORM tvettori-k-des-MERGE-SPLITBUF
           MOVE STATUS-tvettori TO TOTEM-ERR-STAT 
           MOVE "tvettori" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tvettori-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tvettori-KEY-Asc
              IF DataSet1-tvettori-LOCK
                 READ tvettori NEXT WITH LOCK
              ELSE
                 READ tvettori NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tvettori-LOCK
                 READ tvettori PREVIOUS WITH LOCK
              ELSE
                 READ tvettori PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tvettori-k-des-MERGE-SPLITBUF
           MOVE STATUS-tvettori TO TOTEM-ERR-STAT
           MOVE "tvettori" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tvettori-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tvettori-KEY-Asc
              IF DataSet1-tvettori-LOCK
                 READ tvettori PREVIOUS WITH LOCK
              ELSE
                 READ tvettori PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tvettori-LOCK
                 READ tvettori NEXT WITH LOCK
              ELSE
                 READ tvettori NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tvettori-k-des-MERGE-SPLITBUF
           MOVE STATUS-tvettori TO TOTEM-ERR-STAT
           MOVE "tvettori" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tvettori-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tvettori TO TOTEM-ERR-STAT
           MOVE "tvettori" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tvettori-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tvettori TO TOTEM-ERR-STAT
           MOVE "tvettori" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tvettori-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tvettori TO TOTEM-ERR-STAT
           MOVE "tvettori" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterDelete>
      * <TOTEM:END>
           .

       tivaese-key01-MERGE-SPLITBUF.
           INITIALIZE tivaese-key01-SPLITBUF
           MOVE TBLIV-CODICE1(1:2) TO tivaese-key01-SPLITBUF(1:2)
           MOVE TBLIV-DESCRIZIONE1(1:30) TO tivaese-key01-SPLITBUF(3:30)
           MOVE TBLIV-CODICE2(1:20) TO tivaese-key01-SPLITBUF(33:20)
           .

       DataSet1-tivaese-INITSTART.
           IF DataSet1-tivaese-KEY-Asc
              MOVE Low-Value TO TBLIV-CODICE
           ELSE
              MOVE High-Value TO TBLIV-CODICE
           END-IF
           .

       DataSet1-tivaese-INITEND.
           IF DataSet1-tivaese-KEY-Asc
              MOVE High-Value TO TBLIV-CODICE
           ELSE
              MOVE Low-Value TO TBLIV-CODICE
           END-IF
           .

      * tivaese
       DataSet1-tivaese-START.
           IF DataSet1-tivaese-KEY-Asc
              START tivaese KEY >= TBLIV-CODICE
           ELSE
              START tivaese KEY <= TBLIV-CODICE
           END-IF
           .

       DataSet1-tivaese-START-NOTGREATER.
           IF DataSet1-tivaese-KEY-Asc
              START tivaese KEY <= TBLIV-CODICE
           ELSE
              START tivaese KEY >= TBLIV-CODICE
           END-IF
           .

       DataSet1-tivaese-START-GREATER.
           IF DataSet1-tivaese-KEY-Asc
              START tivaese KEY > TBLIV-CODICE
           ELSE
              START tivaese KEY < TBLIV-CODICE
           END-IF
           .

       DataSet1-tivaese-START-LESS.
           IF DataSet1-tivaese-KEY-Asc
              START tivaese KEY < TBLIV-CODICE
           ELSE
              START tivaese KEY > TBLIV-CODICE
           END-IF
           .

       DataSet1-tivaese-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tivaese-LOCK
              READ tivaese WITH LOCK 
              KEY TBLIV-CODICE
           ELSE
              READ tivaese WITH NO LOCK 
              KEY TBLIV-CODICE
           END-IF
           PERFORM tivaese-key01-MERGE-SPLITBUF
           MOVE STATUS-tivaese TO TOTEM-ERR-STAT 
           MOVE "tivaese" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tivaese-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tivaese-KEY-Asc
              IF DataSet1-tivaese-LOCK
                 READ tivaese NEXT WITH LOCK
              ELSE
                 READ tivaese NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tivaese-LOCK
                 READ tivaese PREVIOUS WITH LOCK
              ELSE
                 READ tivaese PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tivaese-key01-MERGE-SPLITBUF
           MOVE STATUS-tivaese TO TOTEM-ERR-STAT
           MOVE "tivaese" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tivaese-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tivaese-KEY-Asc
              IF DataSet1-tivaese-LOCK
                 READ tivaese PREVIOUS WITH LOCK
              ELSE
                 READ tivaese PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tivaese-LOCK
                 READ tivaese NEXT WITH LOCK
              ELSE
                 READ tivaese NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tivaese-key01-MERGE-SPLITBUF
           MOVE STATUS-tivaese TO TOTEM-ERR-STAT
           MOVE "tivaese" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tivaese-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tivaese TO TOTEM-ERR-STAT
           MOVE "tivaese" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tivaese-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tivaese TO TOTEM-ERR-STAT
           MOVE "tivaese" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tivaese-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tivaese TO TOTEM-ERR-STAT
           MOVE "tivaese" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-INIT-RECORD.
           INITIALIZE tno-rec OF tnotacr
           INITIALIZE age-rec OF agenti
           INITIALIZE tge-rec OF tparamge
           INITIALIZE rno-rec OF rnotacr
           INITIALIZE des-rec OF destini
           INITIALIZE record-tblpa OF tcodpag
           INITIALIZE cli-rec OF clienti
           INITIALIZE art-rec OF articoli
           INITIALIZE tor-rec OF tordini
           INITIALIZE ror-rec OF rordini
           INITIALIZE tca-rec OF tcaumag
           INITIALIZE prg-rec OF progmag
           INITIALIZE RECORD-MAS OF MAS
           INITIALIZE imb-rec OF timballi
           INITIALIZE imq-rec OF timbalqta
           INITIALIZE mag-rec OF tmagaz
           INITIALIZE rec-rec OF recapiti
           INITIALIZE tmp-prg-z-rec OF tmp-progmag-zoom
           INITIALIZE btno-rec OF btnotacr
           INITIALIZE brno-rec OF brnotacr
           INITIALIZE vet-rec OF tvettori
           INITIALIZE record-tbliv OF tivaese
           .


      * COMBO-BOX
       cbo-stato-Content.
           .

      * GRID
       form1-gd-1-Content.
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 2, Y = 1,
                CELL-DATA = "Articolo",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 3, Y = 1,
                CELL-DATA = "Descrizione",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 4, Y = 1,
                CELL-DATA = "Q.tà",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 5, Y = 1,
                CELL-DATA = "Prezzo",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 6, Y = 1,
                CELL-DATA = "Consumo",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 7, Y = 1,
                CELL-DATA = "Cou/Cobat",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 8, Y = 1,
                CELL-DATA = "Add. Piombo",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 9, Y = 1,
                CELL-DATA = "Cod. IVA",
           .

      * GRID
       gd-fatt-Content.
      * CELLS' SETTING
              MODIFY gd-fatt, X = 2, Y = 1,
                CELL-DATA = "Articolo",
      * CELLS' SETTING
              MODIFY gd-fatt, X = 3, Y = 1,
                CELL-DATA = "Descrizione",
      * CELLS' SETTING
              MODIFY gd-fatt, X = 4, Y = 1,
                CELL-DATA = "Q.tà",
      * CELLS' SETTING
              MODIFY gd-fatt, X = 5, Y = 1,
                CELL-DATA = "Prz. unitario",
      * CELLS' SETTING
              MODIFY gd-fatt, X = 6, Y = 1,
                CELL-DATA = "% Sconto",
      * CELLS' SETTING
              MODIFY gd-fatt, X = 7, Y = 1,
                CELL-DATA = "Consumo",
      * CELLS' SETTING
              MODIFY gd-fatt, X = 8, Y = 1,
                CELL-DATA = "Cou/Cobat",
      * CELLS' SETTING
              MODIFY gd-fatt, X = 9, Y = 1,
                CELL-DATA = "Add. Piombo",
      * CELLS' SETTING
              MODIFY gd-fatt, X = 10, Y = 1,
                CELL-DATA = "Imp. merce",
      * CELLS' SETTING
              MODIFY gd-fatt, X = 11, Y = 1,
                CELL-DATA = "Cod. IVA",
      * CELLS' SETTING
              MODIFY gd-fatt, X = 12, Y = 1,
                CELL-DATA = "Omaggio",
           .

      * FD's Initialize Paragraph
       DataSet1-tnotacr-INITREC.
           INITIALIZE tno-rec OF tnotacr
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-agenti-INITREC.
           INITIALIZE age-rec OF agenti
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tparamge-INITREC.
           INITIALIZE tge-rec OF tparamge
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-rnotacr-INITREC.
           INITIALIZE rno-rec OF rnotacr
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-destini-INITREC.
           INITIALIZE des-rec OF destini
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tcodpag-INITREC.
           INITIALIZE record-tblpa OF tcodpag
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-clienti-INITREC.
           INITIALIZE cli-rec OF clienti
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-articoli-INITREC.
           INITIALIZE art-rec OF articoli
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tordini-INITREC.
           INITIALIZE tor-rec OF tordini
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-rordini-INITREC.
           INITIALIZE ror-rec OF rordini
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tcaumag-INITREC.
           INITIALIZE tca-rec OF tcaumag
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-progmag-INITREC.
           INITIALIZE prg-rec OF progmag
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-MAS-INITREC.
           INITIALIZE RECORD-MAS OF MAS
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-timballi-INITREC.
           INITIALIZE imb-rec OF timballi
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-timbalqta-INITREC.
           INITIALIZE imq-rec OF timbalqta
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tmagaz-INITREC.
           INITIALIZE mag-rec OF tmagaz
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-recapiti-INITREC.
           INITIALIZE rec-rec OF recapiti
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tmp-progmag-zoom-INITREC.
           INITIALIZE tmp-prg-z-rec OF tmp-progmag-zoom
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-btnotacr-INITREC.
           INITIALIZE btno-rec OF btnotacr
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-brnotacr-INITREC.
           INITIALIZE brno-rec OF brnotacr
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tvettori-INITREC.
           INITIALIZE vet-rec OF tvettori
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tivaese-INITREC.
           INITIALIZE record-tbliv OF tivaese
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      *
       DataSet1-DISPATCH-BUFTOFLD.
           .

       Form1-DISPLAY-STATUS-MSG.
            MODIFY Form1-St-1-Handle PANEL-INDEX = 1
                PANEL-TEXT = TOTEM-HINT-TEXT
           .

       Form1-CLEAR-STATUS-MSG.
           MOVE SPACES TO TOTEM-MSG-1, TOTEM-MSG-2, TOTEM-MSG-3, 
           TOTEM-MSG-TEXT
           PERFORM Form1-DISPLAY-STATUS-MSG
           .

       Form1-Open-Routine.
           PERFORM Form1-Scrn
           PERFORM Form1-Proc
           .

       Form1-Scrn.
           PERFORM Form1-Create-Win
           PERFORM Form1-Init-Value
           PERFORM Form1-Init-Data
      * Tab keystrok settings
      * Tool Bar
           DISPLAY Form1-Tb-1
           PERFORM Form1-DISPLAY
           .

       Form1-Create-Win.
           Display Independent GRAPHICAL WINDOW
              LINES 47,00,
              SIZE 158,00,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 65793,
              CONTROL FONT Small-Font,
              LINK TO THREAD,
              MODELESS,
              NO SCROLL,
              TITLE-BAR,
              TITLE tit-screen,
              AUTO-MINIMIZE,
              WITH SYSTEM MENU,
              USER-GRAY,
           VISIBLE v-screen,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE Screen1-Event-Proc,
              HANDLE IS Form1-handle,
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
           DISPLAY TOOL-BAR 
              LINES 2,69,   
              HANDLE IN Form1-Tb-1-Handle
           DISPLAY Form1-Tb-1 UPON Form1-Tb-1-Handle

      * Status-bar
           DISPLAY STATUS-BAR
              GRIP,
              PANEL-WIDTHS (100, 35, 999),
              PANEL-STYLE  (1, 1, 1),
              PANEL-TEXT   (SPACE, SPACE, SPACE),
              HANDLE IS Form1-St-1-Handle
           DISPLAY Form1 UPON Form1-handle
      * DISPLAY-COLUMNS settings
              MODIFY form1-gd-1, DISPLAY-COLUMNS (1, 8, 17, 82, 91, 
           103, 115, 127, 139)
              MODIFY gd-fatt, DISPLAY-COLUMNS (1, 8, 16, 51, 60, 73, 
           82, 94, 106, 118, 130, 139)
           .

       Form1-PROC.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeAccept>
           move Link-TipoNota to tca-codice.
           read tcaumag no lock 
                invalid 
                display message "Causale ", tca-codice " non registrata"
                         x"0d0a""Impossibile utilizzare il programma."
                        title = titolo
                        icon mb-error-icon
            not invalid 
                evaluate true
                when tca-tipo-nota-reso    move "Reso di Merce"        
           to tipo-nota
                when tca-tipo-nota-prz     move "Differenza di Prezzo" 
           to tipo-nota
                when tca-tipo-nota-abbuono move "Abbuono Generico"     
           to tipo-nota
                end-evaluate
                move spaces to tit-screen
                string "Creazione Nota Credito per " delimited by size
                       tipo-nota                     delimited by size
                       into tit-screen
                end-string
                move tit-screen to titolo
                modify form1-handle, title = tit-screen

                move 1 to v-screen
                modify form1-handle, visible = v-screen
                if tca-no-movim-giac and
                   tca-no-movim-imp  and
                   tca-no-movim-ord  and
                   tca-no-giac-bloc
                   set CallWProgmag to false
                else
                   set CallWProgmag to true
                end-if
                if tca-si-zero set TotaleSiZero to true
                else           set TotaleNoZero to true
                end-if
           end-read.

           if v-screen = 1
              move tca-cod-magaz to mag-codice
              read tmagaz no lock invalid continue end-read
              move mag-descrizione to StoreDesMagazzino
              accept data-oggi from century-date
              perform INIT
              move 129,14    to pb-nuovo-0-column
              move 142,14    to pb-elimina-0-column
              move  43,50    to EF-LinesWithout
              perform RIEMPI-COMBO-STATO
              move "Attivo"         to cbo-stato-buf
              Modify  cbo-stato, value cbo-stato-buf
              perform ABILITAZIONI
              move spaces        to tge-chiave
              read tparamge invalid continue end-read
              move tge-cod-pag   to ef-pag-buf
              move 0  to v-fatt v-bozza
              initialize tor-rec btno-rec
                         replacing numeric data by zeroes
                              alphanumeric data by spaces
              if LinkNumero not = 0 and LinkAnno not = 0
                 if LinkFatt
                    move LinkAnno   to tor-anno-fattura
                    move LinkNumero to tor-num-fattura
                    read tordini no lock key k-fattura
                         invalid continue 
                    end-read
                    move 1 to v-fatt
                 else
                    if LinkAnno   not = 0 and
                       LinkNumero not = 0
                       move LinkAnno   to btno-anno
                       move LinkNumero to btno-numero
                       read btnotacr no lock
                            invalid continue 
                       end-read
                       move 1 to v-bozza
                    end-if
                 end-if
              end-if                    
              perform CURRENT-RECORD                      
                                         
              move lab-num-bolla-buf  to ef-bolla-num-buf
              move lab-data-bolla-buf to ef-bolla-data-buf
                                                    
              if v-bozza = 1                          
                 move lab-num-f-buf  to ef-fatt-num-buf
                 move lab-data-f-buf to ef-fatt-data-buf
              end-if

              if v-fatt = 1                                             
             
                 move lab-num-buf  to ef-fatt-num-buf
                 move lab-data-buf to ef-fatt-data-buf
              end-if

              perform DISPLAY-SCREEN

              move 78-ID-ef-cli to control-id
              move 4            to accept-control
           else
              move 27 to key-status
           end-if.

           string "Esercizio " delimited size
                  esercizio    delimited size
                  " ("         delimited size
                  esercizio-G2 delimited size
                  ")"          delimited size
                  into lab-anno-buf
           end-string.

           display lab-anno.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT Form1
                 ON EXCEPTION
                    PERFORM Form1-Evaluate-Func
                 MOVE 1 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterEndAccept>
           if NonCambiareTab
              set NonCambiareTab to false
              move 1 to screen1-ta-1-tab-value event-data-1      
              perform SCREEN1-TA-1-TABCHANGE
              move store-id to control-id
              move 4 to accept-control
      *****        set ControllaCampi to true
           end-if      

           if ArticoloSetFocus
              evaluate true
              when v-NCPZ = 1 
                   move 78-ID-ef-qta-NCPZ to control-id
              when v-NCRE = 1 
                   move 78-ID-ef-qta-NCRE to control-id
              when v-NCNC = 1 
                   move 78-ID-ef-descr    to control-id
              when v-0    = 1 
                   move 78-ID-ef-art      to control-id
              end-evaluate
              move 4                 to accept-control
      *****        set ControllaCampi   to true
              set ArticoloSetFocus   to false
           end-if

           if InsertRow
              move 0         to LastPrg
              set  InsertRow to false
              |aggiungo una riga simulando
              |pressione del tasto "nuovo"
              move Link-TipoNota to tca-codice
              read tcaumag no lock invalid continue end-read
              if tca-tipo-nota-abbuono
                 perform pb-nuovo-NCNC-LinkTo
              else
                 perform pb-nuovo-0-LinkTo
              end-if
           end-if

      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY Form1-handle
           INITIALIZE Key-Status
           .

       Form1-Evaluate-Func.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM Form1-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM Form1-Exit
                 END-IF
                 IF Event-Type = Cmd-Tabchanged AND 
                                 Event-Control-Id = 1
                    MOVE EVENT-DATA-1 TO Screen1-Ta-1-TAB-VALUE
                    PERFORM Screen1-Ta-1-TABCHANGE
                 END-IF

              WHEN Key-Status = 5000
                 PERFORM pb-nuovo-0-LinkTo
              WHEN Key-Status = 5001
                 PERFORM pb-elimina-0-LinkTo
              WHEN Key-Status = 5002
                 PERFORM pb-nuovo-ncnc-LinkTo
              WHEN Key-Status = 5003
                 PERFORM pb-elimina-ncnc-LinkTo
              WHEN Key-Status = 2345
                 PERFORM pb-art-ncnc-LinkTo
              WHEN Key-Status = 1003
                 PERFORM pb-sel-tutto-LinkTo
              WHEN Key-Status = 1000
                 PERFORM pb-genera-LinkTo
              WHEN Key-Status = 3
                 PERFORM TOOL-SALVA-LinkTo
              WHEN Key-Status = 6
                 PERFORM ANTEPRIMA-LinkTo
              WHEN Key-Status = 150
                 PERFORM TOOL-MODIFICA-LinkTo
              WHEN Key-Status = 7
                 PERFORM STAMPA-LinkTo
              WHEN Key-Status = 8
                 PERFORM TOOL-CERCA-LinkTo
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       Form1-CLEAR.
           PERFORM Form1-INIT-VALUE
           PERFORM Form1-DISPLAY
           .

       Form1-DISPLAY.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY Form1-Tb-1
           DISPLAY Form1 UPON Form1-handle
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterDisplay>
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       Form1-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeExit>
           display message "Abbandonare la nota in gestione?"
                   title = titolo
                   type mb-yes-no
                   giving scelta
                   default mb-no
           if scelta = mb-no
              move 26 to key-status
              exit paragraph
           end-if.

           set environment "KEYSTROKE" to "DATA=44   44".
           set environment "KEYSTROKE" to "DATA=46   46".

           .
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       Form1-Init-Data.
           MOVE 1 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
      * TAB
              MODIFY Screen1-Ta-1, RESET-TABS = 1
              MODIFY Screen1-Ta-1, 
           TAB-TO-ADD = (
                 " - Sezione dati di &Testata - ",
                 " - Sezione &Righe - ",
                        )
           MOVE 0 TO 
                   Screen1-Pg-1-Visible,
                   Screen1-Pg-2-Visible,
           MOVE 1 TO Screen1-Pg-1-Visible
           PERFORM Screen1-Ta-1-TABCHANGE
      * COMBO-BOX
           PERFORM cbo-stato-Content
      * GRID
           PERFORM form1-gd-1-Content
      * GRID
           PERFORM gd-fatt-Content
           .

       Form1-Init-Value.
           MOVE tit-screen TO TOTEM-MSG-TITLE
           INITIALIZE Form1-BUF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, SetDefault>
      * <TOTEM:END>
           PERFORM Form1-FLD-TO-BUF
           .


       Form1-ALLGRID-RESET.
           .

      * for Form's Validation
       Form1-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
      * ef-cli's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-cli-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 1 TO Screen1-Ta-1-TAB-VALUE
               PERFORM Screen1-Ta-1-TABCHANGE
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5001 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-des's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-des-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 1 TO Screen1-Ta-1-TAB-VALUE
               PERFORM Screen1-Ta-1-TABCHANGE
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5002 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-age's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-age-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 1 TO Screen1-Ta-1-TAB-VALUE
               PERFORM Screen1-Ta-1-TABCHANGE
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5003 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-pag's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-pag-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 1 TO Screen1-Ta-1-TAB-VALUE
               PERFORM Screen1-Ta-1-TABCHANGE
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5004 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-iva-ese's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-iva-ese-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 1 TO Screen1-Ta-1-TAB-VALUE
               PERFORM Screen1-Ta-1-TABCHANGE
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5005 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-piano's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-piano-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 1 TO Screen1-Ta-1-TAB-VALUE
               PERFORM Screen1-Ta-1-TABCHANGE
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5006 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-data-ingresso's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-data-ingresso-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 1 TO Screen1-Ta-1-TAB-VALUE
               PERFORM Screen1-Ta-1-TABCHANGE
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5007 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-note's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-note-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 1 TO Screen1-Ta-1-TAB-VALUE
               PERFORM Screen1-Ta-1-TABCHANGE
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5008 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-bolla-num's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-bolla-num-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 1 TO Screen1-Ta-1-TAB-VALUE
               PERFORM Screen1-Ta-1-TABCHANGE
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5010 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-bolla-data's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-bolla-data-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 1 TO Screen1-Ta-1-TAB-VALUE
               PERFORM Screen1-Ta-1-TABCHANGE
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5011 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-fatt-num's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-fatt-num-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 1 TO Screen1-Ta-1-TAB-VALUE
               PERFORM Screen1-Ta-1-TABCHANGE
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5012 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-fatt-data's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-fatt-data-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 1 TO Screen1-Ta-1-TAB-VALUE
               PERFORM Screen1-Ta-1-TABCHANGE
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5013 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
           .

       ef-cli-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-cli, BeforeValidation>
      * <TOTEM:END>
           .

       ef-cli-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-cli, AfterValidation>
      * <TOTEM:END>
           .

      * ef-cli's Validation
       ef-cli-VALIDATION.
           PERFORM ef-cli-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-cli-AFTER-VALIDATION
           .

       ef-des-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-des, BeforeValidation>
      * <TOTEM:END>
           .

       ef-des-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-des, AfterValidation>
      * <TOTEM:END>
           .

      * ef-des's Validation
       ef-des-VALIDATION.
           PERFORM ef-des-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-des-AFTER-VALIDATION
           .

       ef-age-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-age, BeforeValidation>
      * <TOTEM:END>
           .

       ef-age-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-age, AfterValidation>
      * <TOTEM:END>
           .

      * ef-age's Validation
       ef-age-VALIDATION.
           PERFORM ef-age-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-age-AFTER-VALIDATION
           .

       ef-pag-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-pag, BeforeValidation>
      * <TOTEM:END>
           .

       ef-pag-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-pag, AfterValidation>
      * <TOTEM:END>
           .

      * ef-pag's Validation
       ef-pag-VALIDATION.
           PERFORM ef-pag-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-pag-AFTER-VALIDATION
           .

       ef-iva-ese-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-iva-ese, BeforeValidation>
      * <TOTEM:END>
           .

       ef-iva-ese-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-iva-ese, AfterValidation>
      * <TOTEM:END>
           .

      * ef-iva-ese's Validation
       ef-iva-ese-VALIDATION.
           PERFORM ef-iva-ese-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-iva-ese-AFTER-VALIDATION
           .

       ef-piano-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-piano, BeforeValidation>
      * <TOTEM:END>
           .

       ef-piano-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-piano, AfterValidation>
      * <TOTEM:END>
           .

      * ef-piano's Validation
       ef-piano-VALIDATION.
           PERFORM ef-piano-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-piano-AFTER-VALIDATION
           .

       ef-data-ingresso-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-data-ingresso, BeforeValidation>
      * <TOTEM:END>
           .

       ef-data-ingresso-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-data-ingresso, AfterValidation>
      * <TOTEM:END>
           .

      * ef-data-ingresso's Validation
       ef-data-ingresso-VALIDATION.
           PERFORM ef-data-ingresso-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-data-ingresso-AFTER-VALIDATION
           .

       ef-note-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-note, BeforeValidation>
      * <TOTEM:END>
           .

       ef-note-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-note, AfterValidation>
      * <TOTEM:END>
           .

      * ef-note's Validation
       ef-note-VALIDATION.
           PERFORM ef-note-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-note-AFTER-VALIDATION
           .

       ef-bolla-num-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-bolla-num, BeforeValidation>
      * <TOTEM:END>
           .

       ef-bolla-num-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-bolla-num, AfterValidation>
      * <TOTEM:END>
           .

      * ef-bolla-num's Validation
       ef-bolla-num-VALIDATION.
           PERFORM ef-bolla-num-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-bolla-num-AFTER-VALIDATION
           .

       ef-bolla-data-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-bolla-data, BeforeValidation>
      * <TOTEM:END>
           .

       ef-bolla-data-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-bolla-data, AfterValidation>
      * <TOTEM:END>
           .

      * ef-bolla-data's Validation
       ef-bolla-data-VALIDATION.
           PERFORM ef-bolla-data-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-bolla-data-AFTER-VALIDATION
           .

       ef-fatt-num-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-fatt-num, BeforeValidation>
      * <TOTEM:END>
           .

       ef-fatt-num-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-fatt-num, AfterValidation>
      * <TOTEM:END>
           .

      * ef-fatt-num's Validation
       ef-fatt-num-VALIDATION.
           PERFORM ef-fatt-num-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-fatt-num-AFTER-VALIDATION
           .

       ef-fatt-data-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-fatt-data, BeforeValidation>
      * <TOTEM:END>
           .

       ef-fatt-data-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-fatt-data, AfterValidation>
      * <TOTEM:END>
           .

      * ef-fatt-data's Validation
       ef-fatt-data-VALIDATION.
           PERFORM ef-fatt-data-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-fatt-data-AFTER-VALIDATION
           .


       Form1-Buf-To-Fld.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeBufToFld>
      * <TOTEM:END>
      * DB_Entry-Field : ef-cli
           MOVE ef-cli-BUF TO tno-cod-cli
      * DB_Entry-Field : ef-des
           MOVE ef-des-BUF TO tno-prg-destino
      * DB_Entry-Field : ef-age
           MOVE ef-age-BUF TO tno-cod-agente
      * DB_Entry-Field : ef-pag
           MOVE ef-pag-BUF TO tno-cod-pagamento
      * DB_Entry-Field : ef-iva-ese
           MOVE ef-iva-ese-BUF TO tno-cod-ese-iva
      * DB_Entry-Field : ef-piano
           MOVE ef-piano-BUF TO tno-contropartita
      * DB_Entry-Field : ef-data-ingresso
           MOVE ef-data-ingresso-BUF TO tno-data-ingresso
      * DB_Entry-Field : ef-note
           MOVE ef-note-BUF TO tno-note
      * DB_Entry-Field : ef-bolla-num
           MOVE ef-bolla-num-BUF TO tno-bolla-from-numero
      * DB_Entry-Field : ef-bolla-data
           MOVE ef-bolla-data-BUF TO tno-bolla-from-data
      * DB_Entry-Field : ef-fatt-num
           MOVE ef-fatt-num-BUF TO tno-fattura-from-numero
      * DB_Entry-Field : ef-fatt-data
           MOVE ef-fatt-data-BUF TO tno-fattura-from-data
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterBufToFld>
           move lab-anno-nc-buf to tno-anno.

           move data-oggi     to tno-data tno-data-passaggio-ordine.
           move Link-TipoNota to tno-causale.
           
           accept tno-ora-creazione  from time.
           accept tno-data-creazione from century-date.
           move user-codi            to tno-utente-creazione.
                                    
           initialize tno-fattura
                      tno-vuoti replacing numeric data by zeroes
                                     alphanumeric data by spaces.

           set tno-fatt-si-prenotata to true.
           set tno-no-agg-contab     to true.

           
           perform SCARICA-COMBO-STATO.
           move stato                 to tno-stato.

           move ef-cli-buf to tno-cod-cli     convert.  
           move ef-des-buf to tno-prg-destino convert.   

LUBEXX     move spaces     to rec-invio.
LUBEXX     move cli-codice to rec-codice.
LUBEXX     read recapiti no lock invalid continue end-read.
LUBEXX     if rec-invio = spaces set tno-invio-manuale to true
LUBEXX     else                  move rec-invio to tno-invio
LUBEXX     end-if.

                                                 
           move ef-bolla-data-buf to como-data
           perform DATE-TO-FILE.
           move como-data to tno-bolla-from-data.
                                                     
           move ef-fatt-data-buf to como-data
           perform DATE-TO-FILE.
           move como-data to tno-fattura-from-data.

           move ef-data-ingresso-buf to como-data
           perform DATE-TO-FILE.
           move como-data to tno-data-ingresso.
                                                          
           move ef-bolla-num-buf to tno-bolla-from-numero.
           move ef-fatt-num-buf  to tno-fattura-from-numero.

           .
      * <TOTEM:END>
           .

       Form1-Fld-To-Buf.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeFldToBuf>
      * <TOTEM:END>
      * DB_Entry-Field : ef-cli
           MOVE tno-cod-cli TO ef-cli-BUF
      * DB_Entry-Field : ef-des
           MOVE tno-prg-destino TO ef-des-BUF
      * DB_Entry-Field : ef-age
           MOVE tno-cod-agente TO ef-age-BUF
      * DB_Entry-Field : ef-pag
           MOVE tno-cod-pagamento TO ef-pag-BUF
      * DB_Entry-Field : ef-iva-ese
           MOVE tno-cod-ese-iva TO ef-iva-ese-BUF
      * DB_Entry-Field : ef-piano
           MOVE tno-contropartita TO ef-piano-BUF
      * DB_Entry-Field : ef-data-ingresso
           MOVE tno-data-ingresso TO ef-data-ingresso-BUF
      * DB_Entry-Field : ef-note
           MOVE tno-note TO ef-note-BUF
      * DB_Entry-Field : ef-bolla-num
           MOVE tno-bolla-from-numero TO ef-bolla-num-BUF
      * DB_Entry-Field : ef-bolla-data
           MOVE tno-bolla-from-data TO ef-bolla-data-BUF
      * DB_Entry-Field : ef-fatt-num
           MOVE tno-fattura-from-numero TO ef-fatt-num-BUF
      * DB_Entry-Field : ef-fatt-data
           MOVE tno-fattura-from-data TO ef-fatt-data-BUF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterFldToBuf>
           inspect ef-cli-buf replacing leading x"30" by x"20".
           inspect ef-des-buf replacing leading x"30" by x"20".

           move data-oggi to como-data.
           perform DATE-TO-SCREEN.
           move como-data     to lab-data-nc-buf.

           move tno-stato to stato.
           perform CARICA-COMBO-STATO.   

           move ef-data-ingresso-buf to como-data
           perform DATE-TO-SCREEN.
           move como-data to tno-data-ingresso.

           set  cli-tipo-C  to true.
           move tno-cod-cli to cli-codice.
           read clienti no lock 
                invalid continue
            not invalid move cli-ragsoc-1  to lab-cli-buf
                        move cli-indirizzo to lab-ind-buf
                        move cli-localita  to lab-loca-buf
           end-read.

           if tno-prg-destino not = 0
              move tno-cod-cli     to des-codice
              move tno-prg-destino to des-prog
              read destini no lock 
                   invalid continue
               not invalid move des-ragsoc-1  to lab-des-buf
                           move des-indirizzo to lab-ind-d-buf
                           move des-localita  to lab-loca-d-buf
              end-read
           end-if.

           if tno-cod-agente not = 0
              move tno-cod-agente to age-codice
              read agenti no lock
                   invalid continue
               not invalid move age-ragsoc-1 to lab-age-buf
              end-read
           end-if.  

           if tno-cod-pagamento not = spaces
              move "PA"              to tblpa-codice1
              move tno-cod-pagamento to tblpa-codice2
              read tcodpag no lock
                   invalid continue
               not invalid perform MOVE-DESCR-PAG
              end-read
           end-if.

           if tno-cod-ese-iva not = spaces
              move "IV"            to tbliv-codice1
              move tno-cod-ese-iva to tbliv-codice2
              read tivaese no lock
                   invalid continue
               not invalid perform MOVE-DESCR-IVA
              end-read
           end-if.

           .
      * <TOTEM:END>
           .

       Form1-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform Form1-BUF-TO-FLD.
           move 0 to scelta.
           if tno-contropartita not = old-tno-contropartita
              and SiSalvato
              set NoSalvato to true
              |78-ID-ef-piano è l'ID del campo ef-piano
              move 78-ID-ef-piano to store-id 
           end-if

           if tno-data-ingresso not = old-tno-data-ingresso
              and SiSalvato
              set NoSalvato to true
              |78-ID-ef-data-ingresso è l'ID del campo ef-data-ingresso
              move 78-ID-ef-data-ingresso to store-id 
           end-if

           .
       Form1-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM Form1-SHOW-MSG-ROUTINE
           .

       Form1-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM Form1-DISPLAY-MESSAGE
           .

       Form1-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       Form1-Save-Status.
           .             

       Form1-Restore-Status.
           .


      * Paragrafo per la struttura del codice in BEFORE sulla screen Form1
      ***---
       Form1-BEFORE-SCREEN.
           evaluate control-id
           |78-ID-ef-cli è l'ID del campo ef-cli
           when 78-ID-ef-cli
                move 1 to StatusHelp
                perform STATUS-HELP
           |78-ID-ef-des è l'ID del campo ef-des
           when 78-ID-ef-des
                move 1 to StatusHelp
                perform STATUS-HELP
           |78-ID-ef-age è l'ID del campo ef-age
           when 78-ID-ef-age
                move 1 to StatusHelp
                perform STATUS-HELP
           |78-ID-ef-pag è l'ID del campo ef-pag
           when 78-ID-ef-pag
                move 1 to StatusHelp
                perform STATUS-HELP
           |78-ID-ef-iva-ese è l'ID del campo ef-iva-ese
           when 78-ID-ef-iva-ese
                move 1 to StatusHelp
                perform STATUS-HELP
           |78-ID-ef-piano è l'ID del campo ef-piano
           when 78-ID-ef-piano
                move 1 to StatusHelp
                perform STATUS-HELP
           |45 è l'ID del campo ef-art-ncnc
           when 45
                move 1 to StatusHelp
                perform STATUS-HELP
           |78-ID-ef-art è l'ID del campo ef-art
           when 78-ID-ef-art
                move 1 to StatusHelp
                perform STATUS-HELP
           |78-ID-ef-iva è l'ID del campo ef-iva
           when 78-ID-ef-iva
                move 1 to StatusHelp
                perform STATUS-HELP
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella BEFORE della screen
           when 99999 continue
           when other continue
           end-evaluate.

      * Generazione settaggio keyboard "." ---> ","

      * Paragrafo per la struttura del codice in AFTER sulla screen Form1
      ***---
       Form1-AFTER-SCREEN.
           evaluate control-id
           |78-ID-ef-cli è l'ID del campo ef-cli
           when 78-ID-ef-cli
                move 0 to StatusHelp
                perform STATUS-HELP

           |78-ID-ef-des è l'ID del campo ef-des
           when 78-ID-ef-des
                move 0 to StatusHelp
                perform STATUS-HELP

           |78-ID-ef-age è l'ID del campo ef-age
           when 78-ID-ef-age
                move 0 to StatusHelp
                perform STATUS-HELP

           |78-ID-ef-pag è l'ID del campo ef-pag
           when 78-ID-ef-pag
                move 0 to StatusHelp
                perform STATUS-HELP

           |78-ID-ef-iva-ese è l'ID del campo ef-iva-ese
           when 78-ID-ef-iva-ese
                move 0 to StatusHelp
                perform STATUS-HELP

           |78-ID-ef-piano è l'ID del campo ef-piano
           when 78-ID-ef-piano
                move 0 to StatusHelp
                perform STATUS-HELP

           |45 è l'ID del campo ef-art-ncnc
           when 45
                move 0 to StatusHelp
                perform STATUS-HELP

           |78-ID-ef-art è l'ID del campo ef-art
           when 78-ID-ef-art
                move 0 to StatusHelp
                perform STATUS-HELP

           |78-ID-ef-iva è l'ID del campo ef-iva
           when 78-ID-ef-iva
                move 0 to StatusHelp
                perform STATUS-HELP

           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER della screen
           when 99999 continue
           when other continue
           end-evaluate.

      * Generazione risettaggio keyboard "." ---> "."

      * Generazione stringa perform CONTROLLO
           evaluate control-id
           |78-ID-ef-cli è l'ID del campo ef-cli
           when 78-ID-ef-cli
                perform CONTROLLO
           |78-ID-ef-des è l'ID del campo ef-des
           when 78-ID-ef-des
                perform CONTROLLO
           |78-ID-ef-age è l'ID del campo ef-age
           when 78-ID-ef-age
                perform CONTROLLO
           |78-ID-ef-pag è l'ID del campo ef-pag
           when 78-ID-ef-pag
                perform CONTROLLO
           |78-ID-ef-iva-ese è l'ID del campo ef-iva-ese
           when 78-ID-ef-iva-ese
                perform CONTROLLO
           |78-ID-ef-piano è l'ID del campo ef-piano
           when 78-ID-ef-piano
                perform CONTROLLO
           |78-ID-ef-data-ingresso è l'ID del campo ef-data-ingresso
           when 78-ID-ef-data-ingresso
                perform CONTROLLO
           |78-ID-ef-note è l'ID del campo ef-note
           when 78-ID-ef-note
                perform CONTROLLO
           |78-ID-cbo-stato è l'ID del campo cbo-stato
           when 78-ID-cbo-stato
                perform CONTROLLO
           |78-ID-ef-bolla-data è l'ID del campo ef-bolla-data
           when 78-ID-ef-bolla-data
                perform CONTROLLO
           |78-ID-ef-fatt-data è l'ID del campo ef-fatt-data
           when 78-ID-ef-fatt-data
                perform CONTROLLO
           |78-ID-ef-qta-NCPZ è l'ID del campo ef-qta-NCPZ
           when 78-ID-ef-qta-NCPZ
                perform CONTROLLO
           |78-ID-ef-prz-NCPZ è l'ID del campo ef-prz-NCPZ
           when 78-ID-ef-prz-NCPZ
                perform CONTROLLO
           |78-ID-ef-consumo-NCPZ è l'ID del campo ef-consumo-NCPZ
           when 78-ID-ef-consumo-NCPZ
                perform CONTROLLO
           |78-ID-ef-coubat-NCPZ è l'ID del campo ef-coubat-NCPZ
           when 78-ID-ef-coubat-NCPZ
                perform CONTROLLO
           |78-ID-ef-add-NCPZ è l'ID del campo ef-add-NCPZ
           when 78-ID-ef-add-NCPZ
                perform CONTROLLO
           |45 è l'ID del campo ef-art-ncnc
           when 45
                perform CONTROLLO
           |78-ID-ef-consumo-NCNC è l'ID del campo ef-consumo-NCNC
           when 78-ID-ef-consumo-NCNC
                perform CONTROLLO
           |78-ID-ef-coubat-NCNC è l'ID del campo ef-coubat-NCNC
           when 78-ID-ef-coubat-NCNC
                perform CONTROLLO
           |78-ID-ef-add-NCNC è l'ID del campo ef-add-NCNC
           when 78-ID-ef-add-NCNC
                perform CONTROLLO
           |78-ID-ef-art è l'ID del campo ef-art
           when 78-ID-ef-art
                perform CONTROLLO
           |78-ID-ef-qta è l'ID del campo ef-qta
           when 78-ID-ef-qta
                perform CONTROLLO
           |78-ID-ef-prz è l'ID del campo ef-prz
           when 78-ID-ef-prz
                perform CONTROLLO
           |78-ID-ef-consumo è l'ID del campo ef-consumo
           when 78-ID-ef-consumo
                perform CONTROLLO
           |78-ID-ef-coubat è l'ID del campo ef-coubat
           when 78-ID-ef-coubat
                perform CONTROLLO
           |78-ID-ef-add è l'ID del campo ef-add
           when 78-ID-ef-add
                perform CONTROLLO
           |78-ID-ef-iva è l'ID del campo ef-iva
           when 78-ID-ef-iva
                perform CONTROLLO
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER CONTROLLO della screen
           when 99999 continue
           when other continue
           end-evaluate.



       Screen1-Ta-1-TABCHANGE.
           MOVE 0 TO 
                   Screen1-Pg-1-Visible,
                   Screen1-Pg-2-Visible,
           EVALUATE Screen1-Ta-1-TAB-VALUE
           WHEN 1
                  MOVE 1 TO Screen1-Pg-1-Visible
                  MODIFY Screen1-Ta-1, VALUE = 1
           WHEN 2
                  MOVE 1 TO Screen1-Pg-2-Visible
                  MODIFY Screen1-Ta-1, VALUE = 2
           END-EVALUATE
           MOVE 1 TO CONTROL-ID
           DISPLAY Form1
           .

       Form1-BeforeProcedure.
           EVALUATE Control-Id
           WHEN 5001 MOVE "Digitare il codice cliente" to 
           TOTEM-HINT-TEXT
           WHEN 5002 MOVE "Digitare il progressivo per il destino" to 
           TOTEM-HINT-TEXT
           WHEN 5003 MOVE "Digitare il codice agente" to TOTEM-HINT-TEXT
           WHEN 5004 MOVE "Digitare il Codice Pagamento" to 
           TOTEM-HINT-TEXT
           WHEN 5005 MOVE "Digitare il Codice IVA" to TOTEM-HINT-TEXT
           WHEN 5006 MOVE "Digitare la contropartita contabile del docum
      -    "ento" to TOTEM-HINT-TEXT
           WHEN 5007 MOVE "Digitare la data di ingresso merce" to 
           TOTEM-HINT-TEXT
           WHEN 5008 MOVE "Digitare le note" to TOTEM-HINT-TEXT
           WHEN 5009 MOVE "Selezionare uno stato" to TOTEM-HINT-TEXT
           WHEN 5015 MOVE "Digitare la quantit" to TOTEM-HINT-TEXT
           WHEN 5016 MOVE "Digitare il prezzo" to TOTEM-HINT-TEXT
           WHEN 5017 MOVE "Digitare l'imposta di consumo" to 
           TOTEM-HINT-TEXT
           WHEN 5018 MOVE "Digitare l'imposta cou/cobat" to 
           TOTEM-HINT-TEXT
           WHEN 5019 MOVE "Digitare addizionale piombo" to 
           TOTEM-HINT-TEXT
           WHEN 5020 MOVE "Digitare il codice IVA" to TOTEM-HINT-TEXT
           WHEN 5021 MOVE "Digitare la quantit" to TOTEM-HINT-TEXT
           WHEN 45 MOVE "Digitare il codice dell'articolo" to 
           TOTEM-HINT-TEXT
           WHEN 5022 MOVE "Digitare la descrizione della voce" to 
           TOTEM-HINT-TEXT
           WHEN 5023 MOVE "Digitare l'importo" to TOTEM-HINT-TEXT
           WHEN 5024 MOVE "Digitare imposta di consumo" to 
           TOTEM-HINT-TEXT
           WHEN 5025 MOVE "Digitare imposta cou/cobat" to 
           TOTEM-HINT-TEXT
           WHEN 5026 MOVE "Digitare addizionale piombo" to 
           TOTEM-HINT-TEXT
           WHEN 5027 MOVE "Digitare il codice IVA" to TOTEM-HINT-TEXT
           WHEN 5028 MOVE "Digitare il codice dell'articolo" to 
           TOTEM-HINT-TEXT
           WHEN 5029 MOVE "Digitare la quantit" to TOTEM-HINT-TEXT
           WHEN 5030 MOVE "Digitare il prezzo" to TOTEM-HINT-TEXT
           WHEN 5031 MOVE "Digitare l'imposta di consumo" to 
           TOTEM-HINT-TEXT
           WHEN 5032 MOVE "Digitare imposta cou/cobat" to 
           TOTEM-HINT-TEXT
           WHEN 5033 MOVE "Digitare addizionale piombo" to 
           TOTEM-HINT-TEXT
           WHEN 5034 MOVE "Digitare il codice IVA" to TOTEM-HINT-TEXT
           WHEN OTHER MOVE SPACES TO TOTEM-HINT-TEXT
           END-EVALUATE
           EVALUATE Control-Id
           When 5001 PERFORM ef-cli-BeforeProcedure
           When 5002 PERFORM ef-des-BeforeProcedure
           When 5003 PERFORM ef-age-BeforeProcedure
           When 5004 PERFORM ef-pag-BeforeProcedure
           When 5005 PERFORM ef-iva-ese-BeforeProcedure
           When 5006 PERFORM Screen1-DaEf-1-BeforeProcedure
           When 5007 PERFORM Screen1-DaEf-1-BeforeProcedure
           When 5008 PERFORM ef-note-BeforeProcedure
           When 5009 PERFORM cbo-stato-BeforeProcedure
           When 5015 PERFORM ef-qta-NCPZ-BeforeProcedure
           When 5016 PERFORM ef-prz-NCPZ-BeforeProcedure
           When 5017 PERFORM ef-consumo-NCPZ-BeforeProcedure
           When 5018 PERFORM ef-coubat-NCPZ-BeforeProcedure
           When 5019 PERFORM ef-add-NCPZ-BeforeProcedure
           When 5020 PERFORM ef-iva-NCPZ-BeforeProcedure
           When 5021 PERFORM ef-qta-NCRE-BeforeProcedure
           When 45 PERFORM ef-art-ncnc-BeforeProcedure
           When 5022 PERFORM ef-descr-BeforeProcedure
           When 5023 PERFORM ef-prz-NCNC-BeforeProcedure
           When 5024 PERFORM ef-consumo-NCNC-BeforeProcedure
           When 5025 PERFORM ef-coubat-NCNC-BeforeProcedure
           When 5026 PERFORM ef-add-NCNC-BeforeProcedure
           When 5027 PERFORM ef-iva-NCNC-BeforeProcedure
           When 5028 PERFORM ef-art-BeforeProcedure
           When 5029 PERFORM ef-qta-BeforeProcedure
           When 5030 PERFORM ef-prz-BeforeProcedure
           When 5031 PERFORM ef-consumo-BeforeProcedure
           When 5032 PERFORM ef-coubat-BeforeProcedure
           When 5033 PERFORM ef-add-BeforeProcedure
           When 5034 PERFORM ef-iva-BeforeProcedure
           END-EVALUATE
           PERFORM Form1-DISPLAY-STATUS-MSG
           perform Form1-BEFORE-SCREEN
           .

       Form1-AfterProcedure.
           EVALUATE Control-Id
           When 5001 PERFORM ef-cli-AfterProcedure
           When 5002 PERFORM ef-des-AfterProcedure
           When 5003 PERFORM ef-age-AfterProcedure
           When 5004 PERFORM ef-pag-AfterProcedure
           When 5005 PERFORM ef-iva-ese-AfterProcedure
           When 5006 PERFORM Screen1-DaEf-1-AfterProcedure
           When 5007 PERFORM Screen1-DaEf-1-AfterProcedure
           When 5008 PERFORM ef-note-AfterProcedure
           When 5010 PERFORM Screen1-DaEf-1-AfterProcedure
           When 5011 PERFORM Screen1-DaEf-2-AfterProcedure
           When 5012 PERFORM Screen1-DaEf-3-AfterProcedure
           When 5013 PERFORM Screen1-DaEf-4-AfterProcedure
           END-EVALUATE
           perform Form1-AFTER-SCREEN
           .

       Screen1-Event-Proc.
           .

       Screen1-Ta-1-Event-Proc.
           EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
           WHEN Cmd-Tabchanged ALSO 1 ALSO
                    Form1-handle
              PERFORM Screen1-Ta-1-Ev-Cmd-Tabchanged
           END-EVALUATE
           .

       form1-gd-1-Event-Proc.
           EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
           WHEN Msg-Begin-Drag ALSO 5014 ALSO
                    Form1-handle 
              PERFORM form1-gd-1-Ev-Msg-Begin-Drag
           WHEN Msg-Begin-Entry ALSO 5014 ALSO
                    Form1-handle 
              PERFORM form1-gd-1-Ev-Msg-Begin-Entry
           WHEN Msg-End-Drag ALSO 5014 ALSO
                    Form1-handle 
              PERFORM form1-gd-1-Ev-Msg-End-Drag
           WHEN Msg-Goto-Cell ALSO 5014 ALSO
                    Form1-handle 
              PERFORM form1-gd-1-Ev-Msg-Goto-Cell
           WHEN Msg-Goto-Cell-Drag ALSO 5014 ALSO
                    Form1-handle 
              PERFORM form1-gd-1-Ev-Msg-Goto-Cell-Drag
           WHEN Msg-Goto-Cell-Mouse ALSO 5014 ALSO
                    Form1-handle 
              PERFORM form1-gd-1-Ev-Msg-Goto-Cell-Mouse
           END-EVALUATE
           .

       gd-fatt-Event-Proc.
           EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
           WHEN Msg-Begin-Drag ALSO 5035 ALSO
                    Form1-handle 
              PERFORM gd-fatt-Ev-Msg-Begin-Drag
           WHEN Msg-Begin-Entry ALSO 5035 ALSO
                    Form1-handle 
              PERFORM gd-fatt-Ev-Msg-Begin-Entry
           WHEN Msg-End-Drag ALSO 5035 ALSO
                    Form1-handle 
              PERFORM gd-fatt-Ev-Msg-End-Drag
           WHEN Msg-Goto-Cell ALSO 5035 ALSO
                    Form1-handle 
              PERFORM gd-fatt-Ev-Msg-Goto-Cell
           WHEN Msg-Goto-Cell-Drag ALSO 5035 ALSO
                    Form1-handle 
              PERFORM gd-fatt-Ev-Msg-Goto-Cell-Drag
           WHEN Msg-Goto-Cell-Mouse ALSO 5035 ALSO
                    Form1-handle 
              PERFORM gd-fatt-Ev-Msg-Goto-Cell-Mouse
           END-EVALUATE
           .

      * USER DEFINE PARAGRAPH
       ABILITAZIONI.
      * <TOTEM:PARA. ABILITAZIONI>
           modify tool-modifica,   value 1.
           move BitmapNewDisabled     to BitmapNumNew.
           move BitmapDeleteDisabled  to BitmapNumDelete.
           move BitmapEditDisabled    to BitmapNumEdit.
           move BitmapPrintDisabled   to BitmapNumPrint.
           move BitmapPreviewDisabled to BitmapNumPreview.
           move BitmapSelectDisabled  to BitmapNumSelect.

           if livello-abil > 1 move BitmapSaveEnabled  to BitmapNumSave
                               move 1                  to e-salva
           else                move BitmapSaveDisabled to BitmapNumSave
                               move 0                  to e-salva
           end-if.

           move 0 to e-cancella 
                     e-anteprima 
                     e-stampa 
                     e-nuovo
                     e-seleziona
                     e-modifica.

           if e-cerca = 0 move BitmapZoomDisabled to BitmapNumZoom
           else           move BitmapZoomEnabled  to BitmapNumZoom
           end-if.

           inquire cbo-stato,   value cbo-stato-buf
           if cbo-stato-buf not = "Disattivo" move 1 to mod
           else                               move 0 to mod
           end-if.

           perform DISPLAY-SCREEN.
                                                      
           modify tool-nuovo,     enabled = e-nuovo,
                                  bitmap-number = BitmapNumNew.
           modify tool-cancella,  enabled = e-cancella,
                                  bitmap-number = BitmapNumDelete.
           modify tool-modifica,  enabled = e-modifica,
                                  bitmap-number = BitmapNumEdit.
           modify tool-anteprima, enabled = e-anteprima,
                                  bitmap-number = BitmapNumPreview.
           modify tool-stampa,    enabled = e-stampa,
                                  bitmap-number = BitmapNumPrint.
           modify tool-seleziona, enabled = e-seleziona,
                                  bitmap-number = BitmapNumSelect.
           modify tool-salva,     enabled = e-salva,
                                  bitmap-number = BitmapNumSave.  
           modify tool-cerca,     enabled = e-cerca,
                                  bitmap-number = BitmapNumZoom 
           .
      * <TOTEM:END>

       AGGIORNA-BOZZA.
      * <TOTEM:PARA. AGGIORNA-BOZZA>
           string   "La Bozza di partenza risulta"
             x"0d0a""in uso su altro terminale."
             x"0d0a""Questo comporta l'impossibilità"
             x"0d0a""ad aggiornarne lo stato." delimited size
                 into geslock-messaggio
           end-string.
           set RecLocked to false.

           move LinkChiave to btno-chiave.
           perform until 1 = 2
              set RecLocked to false
              close    btnotacr
              open i-o btnotacr
              read btnotacr lock invalid continue end-read
              if RecLocked
                 move "BTNOTACR" to geslock-nome-file
                 move 1 to geslock-v-riprova
                 move 0 to geslock-v-ignora
                 move 0 to geslock-v-termina
                 call   "geslock" using geslock-linkage
                 cancel "geslock"
              else
                 move tno-anno   to btno-anno-nc
                 move tno-data   to btno-data-nc
                 move tno-numero to btno-num-nc
                 rewrite btno-rec invalid continue end-rewrite
                 unlock  btnotacr all records
                 close   btnotacr
                 open input btnotacr
                 exit perform
              end-if
           end-perform 
           .
      * <TOTEM:END>

       BEFORE-CAMPI.
      * <TOTEM:PARA. BEFORE-CAMPI>
           evaluate control-id
           when 78-ID-ef-qta
           when 78-ID-ef-prz
           when 78-ID-ef-consumo
           when 78-ID-ef-coubat
           when 78-ID-ef-add
           when 78-ID-ef-iva
                inquire ef-art, value in art-codice
                if art-codice = 0
                   perform CANCELLA-COLORE
                   move 78-ID-ef-art to control-id
                   move 4            to accept-control
                end-if
                inquire ef-iva-ese, value in ef-iva-ese-buf
                if ef-iva-ese-buf not = spaces
                   modify ef-iva, read-only
                else
                   modify ef-iva, not read-only
                end-if

           when 78-ID-ef-qta-NCPZ
           when 78-ID-ef-prz-NCPZ
           when 78-ID-ef-consumo-NCPZ
           when 78-ID-ef-coubat-NCPZ
           when 78-ID-ef-add-NCPZ
           when 78-ID-ef-iva-NCPZ
           when 78-ID-ef-qta-NCRE
                inquire form1-gd-1, last-row in tot-righe

                if tot-righe = 1
                   perform CANCELLA-COLORE
                   move 78-ID-form1-gd-1 to control-id
                   move 4 to accept-control
                end-if

                inquire ef-iva-ese, value in ef-iva-ese-buf
                if ef-iva-ese-buf not = spaces
                   modify ef-iva-NCPZ, read-only
                else
                   modify ef-iva-NCPZ, not read-only
                end-if  

           when 78-ID-ef-iva-NCNC
                inquire ef-iva-ese, value in ef-iva-ese-buf
                if ef-iva-ese-buf not = spaces
                   modify ef-iva-NCNC, read-only
                else
                   modify ef-iva-NCNC, not read-only
                end-if

           end-evaluate 
           .
      * <TOTEM:END>

       CANCELLA-RIGA.
      * <TOTEM:PARA. CANCELLA-RIGA>
           set InsertRow to false.
           inquire form1-gd-1, last-row in tot-righe, cursor-y in riga.
           if riga-nuova = 1 move riga to tot-righe end-if.
           
           if tot-righe > 1 and riga <= tot-righe
              inquire form1-gd-1(riga, 1), cell-data in store-riga
              move store-riga to riga-edit
              display message "Cancellare la riga n. " riga-edit " ?"
                        title titolo
                      default mb-no
                         type mb-yes-no
                       giving scelta
                         icon 2
              if scelta = mb-yes
                 modify form1-gd-1, record-to-delete = riga
                 inquire form1-gd-1, last-row in tot-righe
                 if riga > tot-righe
                    move tot-righe to riga
                 end-if
                 move 0 to riga-nuova
                 if tot-righe > 1  perform SPOSTAMENTO
                 else              perform INITIALIZE-ENTRY
                                   set InsertRow to true
                 end-if
              end-if
           end-if 
           .
      * <TOTEM:END>

       CARICA-GRID.
      * <TOTEM:PARA. CARICA-GRID>
           perform RESET-GRIGLIA.

           modify gd-fatt, mass-update = 1.
           move low-value  to ror-rec.
           move tor-chiave to ror-chiave.
           start rordini key is >= ror-chiave
                 invalid continue
             not invalid
                 move 2 to riga
                 perform until 1 = 2
                    read rordini next at end exit perform end-read
                    if ror-anno       not = tor-anno or
                       ror-num-ordine not = tor-numero
                       exit perform
                    end-if
                    if tca-tipo-nota-abbuono
                       perform AGGIUNGI-RIGA-ABBUONO
                    else
                       perform AGGIUNGI-RIGA
OMAGGI                 if ror-qta-omaggi not = 0
OMAGGI                    move ror-qta-omaggi   to ror-qta
OMAGGI                    move 0                to ror-prz-unitario
OMAGGI                    move 0                to ror-perce-sconto
OMAGGI                    move 0                to ror-imp-consumo
OMAGGI                    move 0                to ror-imp-cou-cobat
OMAGGI                    move 0                to ror-imponib-merce
OMAGGI                    move tge-cod-iva-omag to ror-cod-iva
OMAGGI                    set  ror-si-omaggio   to true
OMAGGI                    perform AGGIUNGI-RIGA
OMAGGI                 end-if
                    end-if
                 end-perform
           end-start.
           modify gd-fatt, mass-update = 0.

      ***---
       AGGIUNGI-RIGA.
           move ror-num-riga     to col-num.
           move ror-cod-articolo to col-art art-codice.
           read articoli no lock invalid continue end-read.

           initialize col-des.
           inspect art-descrizione replacing trailing spaces 
                                   by low-value.
           inspect ror-des-imballo replacing trailing spaces 
                                   by low-value.
           move  ror-qta-imballi to imballi-ed.
           call "C$JUSTIFY"   using imballi-ed, "L".
           string  art-descrizione delimited by low-value
                   " - "           delimited by size
                   ror-des-imballo delimited by low-value
                   " da "          delimited by size
                   imballi-ed      delimited by spaces
                   " x "           delimited by size
                   art-udm-imballo delimited by size
                   into col-des
           end-string.
           inspect ror-des-imballo replacing trailing low-value
                                   by spaces.
           inspect art-descrizione replacing trailing low-value
                                   by spaces.
                           
           move ror-qta           to col-qta.
           move ror-prz-unitario  to col-uni.
           move ror-perce-sconto  to col-sconto.
           move ror-imp-consumo   to col-cons.
           move ror-imp-cou-cobat to col-cou.
           move ror-add-piombo    to col-add-pb.
           move ror-imponib-merce to col-imp.
           move ror-cod-iva       to col-iva.

           modify gd-fatt(riga, 1),  cell-data = col-num.
           modify gd-fatt(riga, 2),  cell-data = col-art.
           modify gd-fatt(riga, 3),  cell-data = col-des.
           modify gd-fatt(riga, 4),  cell-data = col-qta.
           modify gd-fatt(riga, 5),  cell-data = col-uni.
           modify gd-fatt(riga, 6),  cell-data = col-sconto.
           modify gd-fatt(riga, 7),  cell-data = col-cons.
           modify gd-fatt(riga, 8),  cell-data = col-cou.
           modify gd-fatt(riga, 9),  cell-data = col-add-pb.
           modify gd-fatt(riga, 10), cell-data = col-imp.
           modify gd-fatt(riga, 11), cell-data = col-iva.

           if ror-si-omaggio
              modify gd-fatt(riga, 12),  
                     bitmap = conferma-bmp
                     bitmap-number = 1
                     bitmap-width  = 19
           else
              modify gd-fatt(riga, 12),  
                     bitmap = conferma-bmp
                     bitmap-number = 2
                     bitmap-width  = 19
           end-if.
           move 0 to hidden-sel.
           move ror-prg-chiave      to HiddenKey.
           move ror-peso-utf        to HiddenUtf.
           move ror-peso-non-utf    to HiddenNonUtf.
           modify gd-fatt(riga, 1), hidden-data = hidden-sel.
           modify gd-fatt(riga, 2), hidden-data = HiddenKey.
           modify gd-fatt(riga, 3), hidden-data = HiddenPeso.
           add 1 to riga.

      ***---
       AGGIUNGI-RIGA-ABBUONO.
           move ror-num-riga      to col-riga LastPrg.
           move ror-cod-articolo  to art-codice.
           read articoli no lock  invalid continue end-read.
           initialize col-descr.
           move art-codice        to art-codice-x.
           call "C$JUSTIFY" using art-codice-x, "R".
           inspect art-codice-x replacing leading x"30" by x"20".
           call "C$JUSTIFY" using art-codice-x, "L".
           inspect art-codice-x replacing trailing spaces by low-value.
           string  art-codice-x    delimited low-value
                   " "             delimited size
                   art-descrizione delimited size
                   into col-descr
           end-string.
           move 0                  to col-quantita col-codice.
           compute Sum = ror-prz-unitario * ror-qta.
           move Sum         to col-prezzo.           
           move 0           to col-consumo.           
           move 0           to col-coubat.           
           move 0           to col-add.
           move ror-cod-iva to col-cod-iva.

           modify form1-gd-1(riga, 1),  cell-data = col-riga.
           modify form1-gd-1(riga, 3),  cell-data = col-descr.
           modify form1-gd-1(riga, 5),  cell-data = col-prezzo.
           modify form1-gd-1(riga, 6),  cell-data = col-consumo.
           modify form1-gd-1(riga, 7),  cell-data = col-coubat.
           modify form1-gd-1(riga, 8),  cell-data = col-add.
           modify form1-gd-1(riga, 9),  cell-data = col-cod-iva.
           add 1 to riga 
           .
      * <TOTEM:END>

       CARICA-GRID-BOZZA.
      * <TOTEM:PARA. CARICA-GRID-BOZZA>
           perform RESET-GRIGLIA.

           modify gd-fatt, mass-update = 1.
           move low-value   to brno-rec.
           move btno-chiave to brno-chiave.
           set  brno-nota   to true.
           start brnotacr key is >= brno-chiave
                 invalid continue
             not invalid
                 move 2 to riga
                 perform until 1 = 2
                    read brnotacr  next at end exit  perform end-read
                    if brno-anno   not = btno-anno   or
                       brno-numero not = btno-numero or
                       brno-addebito                 or
                       brno-merce-rotta
                       exit perform
                    end-if
                    if tca-tipo-nota-abbuono
                       perform AGGIUNGI-RIGA-BOZZA-ABBUONO
                    else
                       perform AGGIUNGI-RIGA-BOZZA
                    end-if
                 end-perform
           end-start.
           modify gd-fatt, mass-update = 0.

      ***---
       AGGIUNGI-RIGA-BOZZA.
           move brno-num-riga     to col-num.
           move brno-cod-articolo to col-art art-codice.
           read articoli no lock invalid continue end-read.

           move art-descrizione    to col-des.
                           
           move brno-qta           to col-qta.
           move brno-prz-unitario  to col-uni.
           move brno-perce-sconto  to col-sconto.
           move brno-imp-consumo   to col-cons.
           move brno-imp-cou-cobat to col-cou.
           move brno-add-piombo    to col-add-pb.
           move brno-imponib-merce to col-imp.
           move brno-cod-iva       to col-iva.

           modify gd-fatt(riga, 1),  cell-data = col-num.
           modify gd-fatt(riga, 2),  cell-data = col-art.
           modify gd-fatt(riga, 3),  cell-data = col-des.
           modify gd-fatt(riga, 4),  cell-data = col-qta.
           modify gd-fatt(riga, 5),  cell-data = col-uni.
           modify gd-fatt(riga, 6),  cell-data = col-sconto.
           modify gd-fatt(riga, 7),  cell-data = col-cons.
           modify gd-fatt(riga, 8),  cell-data = col-cou.
           modify gd-fatt(riga, 9),  cell-data = col-add-pb.
           modify gd-fatt(riga, 10), cell-data = col-imp.
           modify gd-fatt(riga, 11), cell-data = col-iva.

           if brno-prz-unitario = 0
              modify gd-fatt(riga, 12),  
                     bitmap = conferma-bmp
                     bitmap-number = 1
                     bitmap-width  = 19
           else
              modify gd-fatt(riga, 12),  
                     bitmap = conferma-bmp
                     bitmap-number = 2
                     bitmap-width  = 19
           end-if.
           move 0 to hidden-sel.
           move brno-prg-chiave      to HiddenKey.
           move brno-peso-utf        to HiddenUtf.
           move brno-peso-non-utf    to HiddenNonUtf.
           modify gd-fatt(riga, 1), hidden-data = hidden-sel.
           modify gd-fatt(riga, 2), hidden-data = HiddenKey.
           modify gd-fatt(riga, 3), hidden-data = HiddenPeso.
           add 1 to riga.

      ***---
       AGGIUNGI-RIGA-BOZZA-ABBUONO.
           move brno-num-riga     to col-riga LastPrg.
           move brno-cod-articolo to art-codice.
           read articoli no lock  invalid continue end-read.
           initialize col-descr.
           move art-codice        to art-codice-x.
           call "C$JUSTIFY" using art-codice-x, "R".
           inspect art-codice-x replacing leading x"30" by x"20".
           call "C$JUSTIFY" using art-codice-x, "L".
           inspect art-codice-x replacing trailing spaces by low-value.
           string  art-codice-x    delimited low-value
                   " "             delimited size
                   art-descrizione delimited size
                   into col-descr
           end-string.
           move 0                  to col-quantita col-codice.
           compute Sum = brno-prz-unitario * brno-qta.
           move Sum          to col-prezzo.           
           move 0            to col-consumo.           
           move 0            to col-coubat.           
           move 0            to col-add.
           move brno-cod-iva to col-cod-iva.

           modify form1-gd-1(riga, 1),  cell-data = col-riga.
           modify form1-gd-1(riga, 3),  cell-data = col-descr.
           modify form1-gd-1(riga, 5),  cell-data = col-prezzo.
           modify form1-gd-1(riga, 6),  cell-data = col-consumo.
           modify form1-gd-1(riga, 7),  cell-data = col-coubat.
           modify form1-gd-1(riga, 8),  cell-data = col-add.
           modify form1-gd-1(riga, 9),  cell-data = col-cod-iva.
           add 1 to riga 
           .
      * <TOTEM:END>

       CERCA.
      * <TOTEM:PARA. CERCA>
           evaluate control-id

           when 78-ID-ef-cli
                set cli-tipo-c        to true
                move "clienti-all"    to como-file         
                inquire ef-cli, value in cli-codice
                call "zoom-gt"  using como-file, cli-rec
                               giving stato-zoom
                end-call
                cancel "zoom-gt"

                if stato-zoom = 0
                   move cli-codice     to ef-cli-buf
                   inspect ef-cli-buf replacing leading x"30" by x"20"
                   call "C$JUSTIFY" using ef-cli-buf, "L"
                   move cli-ragsoc-1   to lab-cli-buf
                   move cli-indirizzo  to lab-ind-buf
                   move cli-localita   to lab-loca-buf
                   display ef-cli lab-cli lab-ind lab-loca
                end-if                  
      
           when 78-ID-ef-des
                inquire ef-cli, value in des-codice
                inquire ef-des, value in des-prog
                set cli-tipo-c        to true
                move "clienti-des"    to como-file
                call "zoom-gt"  using como-file, des-rec
                               giving stato-zoom
                end-call
                cancel "zoom-gt"
                if stato-zoom = 0                  
                   move des-prog     to ef-des-buf      
                   inspect ef-des-buf replacing leading x"30" by x"20"
                   call "C$JUSTIFY" using ef-des-buf, "L"
                   move des-ragsoc-1   to lab-des-buf
                   move des-indirizzo  to lab-ind-d-buf
                   move des-localita   to lab-loca-d-buf
                   display ef-des lab-des lab-ind-d lab-loca-d
                end-if
      
           when 78-ID-ef-age
                move "agenti"    to como-file         
                inquire ef-age,  value in age-codice
                call "zoom-gt"   using como-file, age-rec
                                giving stato-zoom
                end-call
                cancel "zoom-gt"
                if stato-zoom = 0
                   move age-codice   to ef-age-buf
                   move age-ragsoc-1 to lab-age-buf
                   display ef-age lab-age
                end-if

           when 78-ID-ef-iva-ese
                move "tivaese-ese" to como-file
                move "IV"          to tbliv-codice1
                inquire ef-iva-ese,value in tbliv-codice2
                call "zoom-gt"   using como-file, record-tbliv
                                giving stato-zoom
                end-call
                cancel "zoom-gt"
                if stato-zoom = 0
                   move tbliv-codice2   to ef-iva-ese-buf
                   perform MOVE-DESCR-IVA
                   display ef-iva-ese lab-iva
                end-if

           when 78-ID-ef-pag
                move "tcodpag"   to como-file         
                move "PA"        to tblpa-codice1
                inquire ef-pag,  value in tblpa-codice2
                call "zoom-gt"   using como-file, record-tblpa
                                giving stato-zoom
                end-call
                cancel "zoom-gt"
                if stato-zoom = 0
                   move tblpa-codice2   to ef-pag-buf
                   perform MOVE-DESCR-PAG
                   display ef-pag lab-pag
                end-if

           when 78-ID-ef-piano
                move "MAS"       to como-file
                inquire ef-piano value in mas-codice
                call "zoom-gt"   using como-file, record-mas
                                giving stato-zoom
                end-call
                cancel "zoom-gt"
                if stato-zoom = 0
                   move mas-codice to ef-piano-buf
                   perform MOVE-DESCR-PIANO
                   display ef-piano lab-piano
                end-if
      
           when 78-ID-ef-art
                perform ZOOM-SU-PROGMAG
                move 4 to accept-control

           when 78-ID-ef-iva-NCNC
                inquire ef-iva-NCNC, value in tbliv-codice2
                perform ZOOM-IVA
                if stato-zoom = 0
                   move tbliv-codice2   to ef-iva-NCNC-buf
                   display ef-iva-NCNC
                end-if

           when 78-ID-ef-iva-NCPZ
                inquire ef-iva-NCPZ, value in tbliv-codice2
                perform ZOOM-IVA
                if stato-zoom = 0
                   move tbliv-codice2   to ef-iva-NCPZ-buf
                   display ef-iva-NCPZ
                end-if

           when 78-ID-ef-iva
                inquire ef-iva,      value in tbliv-codice2
                perform ZOOM-IVA
                if stato-zoom = 0
                   move tbliv-codice2   to ef-iva-buf
                   display ef-iva
                end-if
           end-evaluate.

      ***---
       ZOOM-IVA.
           move "tivaese"   to como-file.
           move "IV"        to tbliv-codice1.
           call "zoom-gt"   using como-file, record-tbliv
                           giving stato-zoom
           end-call.
           cancel "zoom-gt" 
           .
      * <TOTEM:END>

       CHANGE-STATUS.
      * <TOTEM:PARA. CHANGE-STATUS>
           evaluate nome-file
           when "clienti"
                set disattivo to true
                perform CARICA-COMBO-STATO
                |specifico per i pgm. aventi Tab-Control
                move 1 to Screen1-Ta-1-TAB-VALUE
                perform SCREEN1-TA-1-TABCHANGE
                |******
                move 0 to mod
                perform DISPLAY-SCREEN
           end-evaluate 
           .
      * <TOTEM:END>

       CHANGE-TAB.
      * <TOTEM:PARA. CHANGE-TAB>
           set NonCambiareTab   to false.
           set ArticoloSetFocus to false.
           set ControllaCampi   to true.
           set CheckDestini     to true.

      *****     if mod-k = 1
      *****        continue
      *****        set NonCambiareTab to true
      *****     else
           evaluate event-data-1
           when 1
                move 0 to v-grid
                move 0 to v-ncpz
                move 0 to v-ncre
                move 0 to v-ncnc
                move 0 to v-sel-tutto
                move 0 to v-0
                move 0 to v-fatt v-bozza
                if LinkNumero not = 0 
                   if LinkFatt 
                      move 1 to v-fatt 
                   else        
                      if LinkAnno   not = 0 and
                         LinkNumero not = 0
                         move 1 to v-bozza
                      end-if
                   end-if
                end-if
                if v-bozza = 0
                   move 1 to v-fatt
                end-if
                set ControllaCampi to false
                set environment "KEYSTROKE" to "DATA=44 44"
                set environment "KEYSTROKE" to "DATA=46 46"

           when 2
                set CheckDestini to false
                perform CHECK-PAGE-1
                if tutto-ok
                   move 0 to v-fatt v-bozza
                   if LinkNumero not = 0
                      if tca-tipo-nota-abbuono
                         move 0 to v-grid
                      else
                         move 1 to v-grid
                      end-if
                   else
                      move 0 to v-grid
                      if PrimaVolta
                         move 2 to event-data-2
                         perform SPOSTAMENTO
                         set PrimaVolta to false
                      end-if
                   end-if
                   move 0 to v-ncpz
                   move 0 to v-ncre
                   move 0 to v-ncnc
                   move 0 to v-0
                   move Link-TipoNota to tca-codice
                   read tcaumag no lock invalid continue end-read
                   evaluate true
                   when tca-tipo-nota-prz
                        if LinkNumero = 0 
                           move 1 to v-0
                        else
                           move 1 to v-ncpz
                           move 1 to v-sel-tutto
                        end-if
                   when tca-tipo-nota-reso
                        if LinkNumero = 0 
                           move 1 to v-0
                        else
                           move 1 to v-ncre     
                           move 1 to v-sel-tutto
                        end-if
                   when tca-tipo-nota-abbuono
                        move 1 to v-ncnc
                   end-evaluate
                   perform CANCELLA-COLORE
                   modify pb-genera,       bitmap-number = 1
                   modify pb-nuovo-ncnc,   bitmap-number = 5
                   modify pb-elimina-ncnc, bitmap-number = 4
                   modify pb-nuovo-0,      bitmap-number = 5
                   modify pb-elimina-0,    bitmap-number = 4
                   set ArticoloSetFocus    to true
                else        
                   set ControllaCampi to false
                   move store-id to CONTROL-ID    
                   move 4        to ACCEPT-CONTROL
                   set NonCambiareTab to true
                end-if
           end-evaluate.
      *****     end-if.

           display Screen1-Ta-1 
           .
      * <TOTEM:END>

       CHECK-PAGE-1.
      * <TOTEM:PARA. CHECK-PAGE-1>
           perform  varying control-id from 78-ID-ef-cli by 1
                      until control-id    > 78-ID-ef-fatt-data
              if control-id = 78-ID-cbo-stato
                 continue |LO FA DOPO 
              else
                 perform CONTROLLO
                 if errori 
                    exit perform 
                 end-if
              end-if
           end-perform            
           .
      * <TOTEM:END>

       CONTA-CODICI-IVA.
      * <TOTEM:PARA. CONTA-CODICI-IVA>
           inquire form1-gd-1, last-row in tot-righe.
           move 0 to num-codici-iva.
           move 1 to idx.
           move spaces to cod-iva(1).
           move spaces to cod-iva(2).
           move spaces to cod-iva(3).
           perform varying riga from 2 by 1
                     until riga > tot-righe
              set trovato to false
              inquire form1-gd-1(riga, 9), cell-data in col-cod-iva
              perform varying idx from 1 by 1
                        until idx > 3
                 if col-cod-iva = cod-iva(idx)
                    set trovato to true
                    exit perform
                 end-if
              end-perform
              if not trovato
                 add 1 to num-codici-iva
                 perform varying idx from 1 by 1
                           until idx > 3
                    if cod-iva(idx) = spaces
                       move col-cod-iva to cod-iva(idx)
                       exit perform
                    end-if
                 end-perform
              end-if
              if num-codici-iva > 3 
                 set errori to true
                 exit perform 
              end-if
           end-perform 
           .
      * <TOTEM:END>

       CONTA-RIGHE.
      * <TOTEM:PARA. CONTA-RIGHE>
           set trovato to false.

           inquire form1-gd-1, last-row in tot-righe.
           if tot-righe > 1 set trovato to true end-if 
           .
      * <TOTEM:END>

       CONTA-RIGHE-NCNC.
      * <TOTEM:PARA. CONTA-RIGHE-NCNC>
           set trovato to false.

           inquire form1-gd-1, last-row in tot-righe.
           if tot-righe > 1 set trovato to true end-if 
           .
      * <TOTEM:END>

       CONTA-ZERI-NCPZ.
      * <TOTEM:PARA. CONTA-ZERI-NCPZ>
           set trovato to false.

           inquire form1-gd-1, last-row in tot-righe.
           perform varying riga from 2 by 1 
                     until riga > tot-righe
              inquire form1-gd-1(riga, 4), cell-data in rno-qta
              if rno-qta > 0
                 set trovato to true
                 exit perform
              end-if
           end-perform 
           .
      * <TOTEM:END>

       CONTA-ZERI-NCRE.
      * <TOTEM:PARA. CONTA-ZERI-NCRE>
           set trovato to false.

           inquire form1-gd-1, last-row in tot-righe.
           perform varying riga from 2 by 1 
                     until riga > tot-righe
              inquire form1-gd-1(riga, 4), cell-data in rno-qta
              if rno-qta > 0
                 set trovato to true
                 exit perform
              end-if
           end-perform 
           .
      * <TOTEM:END>

       CONTROLLA-PERCENTUALE-IVA.
      * <TOTEM:PARA. CONTROLLA-PERCENTUALE-IVA>
           move "IV"        to tbliv-codice1.
           move rno-cod-iva to tbliv-codice2.
           read tivaese no lock 
                invalid continue
            not invalid
                if tbliv-percentuale not = 0
                   set EsisteIVA to true
                end-if
           end-read 
           .
      * <TOTEM:END>

       CONTROLLA-TOTALE.
      * <TOTEM:PARA. CONTROLLA-TOTALE>
           move 0 to Sum.
           inquire form1-gd-1, last-row in tot-righe.
           perform varying store-riga from 2 by 1 
                     until store-riga > tot-righe
              inquire form1-gd-1(store-riga, 5), cell-data in SavePrezzo
              add SavePrezzo to Sum
           end-perform.
           if Sum = 0
              if TotaleNoZero set errori to true end-if
           else
              if TotaleSiZero set errori to true end-if
           end-if 
           .
      * <TOTEM:END>

       CONTROLLO.
      * <TOTEM:PARA. CONTROLLO>
           set tutto-ok to true. 
           if not ControllaCampi
              set ControllaCampi to true
              exit paragraph
           end-if.
           inquire form1-gd-1, last-row in tot-righe.
           if tot-righe = 1 and riga-nuova = 1
              move 2 to tot-righe
           end-if.

      * Paragrafo per la struttura dei controlli sulla screen Screen1
           evaluate control-id
           |78-ID-ef-cli è l'ID del control ef-cli
           when 78-ID-ef-cli
                inquire ef-cli, value in ef-cli-buf 
                if ef-cli-buf not = spaces
                   inspect ef-cli-buf replacing trailing spaces 
                                                         by low-values
                   initialize CountChar
                   inspect ef-cli-buf tallying CountChar for characters 
                                                      before low-value
                   inspect ef-cli-buf replacing trailing low-values 
                                                         by spaces
                   | SE E' NUMERICO LEGGO IL RECORD NORMALMENTE
                   if ef-cli-buf(1:CountChar) is numeric
                      perform SELEZIONA-NUMERICO
                   else                     
                      | HO DIGITATO UNA SIGLA ALFANUMERICA QUINDI 
                      | APRO LO ZOOM (CASE SENSITIVE)
                      perform SELEZIONA-ALFA
                   end-if
                else
                   set errori to true  
                   move 78-ID-ef-cli to control-id
                   display message "Inserimento codice cliente mancante"
                           title = tit-err
                           icon mb-warning-icon
                end-if
                move cli-ragsoc-1    to lab-cli-buf
                move cli-indirizzo   to lab-ind-buf
                move cli-localita    to lab-loca-buf
                display lab-cli lab-ind lab-loca

                if tutto-ok
                   if cli-disattivo or cli-bloccato
                      set errori to true
                      display message "Cliente non attivo"
                                title tit-err
                                 icon 2
                   else
                      inquire ef-iva-ese, value in ef-iva-ese-buf
                      if ef-iva-ese-buf = spaces
                         initialize record-tbliv
                         move "IV"        to tbliv-codice1
                         move cli-iva-ese to tbliv-codice2 
           ef-iva-ese-buf
                         read tivaese invalid continue end-read
                         perform MOVE-DESCR-IVA
                         display lab-iva ef-iva-ese
                      end-if
                   end-if
                end-if

           |78-ID-ef-des è l'ID del control ef-des
           when 78-ID-ef-des
                inquire ef-des, value in ef-des-buf
                inquire ef-cli, value in ef-cli-buf
                if ef-des-buf not = spaces
                   inspect ef-des-buf replacing trailing spaces 
                                                         by low-values
                   initialize CountChar
                   inspect ef-des-buf tallying CountChar for characters 
                                                       before low-value
                   inspect ef-des-buf replacing trailing low-values 
                                                         by spaces

                   | SE E' NUMERICO LEGGO IL RECORD NORMALMENTE
                   if ef-des-buf(1:CountChar) is numeric
                      perform SELEZIONA-DESTINO-NUMERICO
                   else                     
                      | HO DIGITATO UNA SIGLA ALFANUMERICA QUINDI 
                      | APRO LO ZOOM (CASE SENSITIVE)
                      perform SELEZIONA-DESTINO-ALFA
                   end-if  
                   display lab-des
                   display lab-ind-d
                   display lab-loca-d
                else
                   if CheckDestini
                      perform TROVA-DESTINO
                      if trovato
                         display message "Esiste uno o più destini per"
                                          " il cliente specificato."
                                  x"0d0a""Procedere comunque con "
                                          "progressivo non valorizzato?"
                                 title = titolo
                                  type mb-yes-no
                                giving scelta 
                         initialize des-rec
                         if scelta = mb-no
                            set errori to true
                            move 78-ID-ef-des to control-id
                         end-if
                      end-if
                   else
                      set CheckDestini to true
                   end-if
                end-if
                move des-ragsoc-1    to lab-des-buf
                move des-indirizzo   to lab-ind-d-buf
                move des-localita    to lab-loca-d-buf
                display lab-des lab-ind-d lab-loca-d
                if des-bloccato or des-disattivo
                   set errori to true
                   display message "Destino non attivo"
                             title tit-err
                              icon 2
                end-if   

           |78-ID-ef-age è l'ID del control ef-age
           when 78-ID-ef-age
                inquire ef-age, value in ef-age-buf
                move ef-age-buf to age-codice
                read agenti no lock
                     invalid
                     move spaces to age-ragsoc-1
                     display message "Codice Agente NON valido!"
                             title = tit-err
                             icon  2
                     set errori to true
                end-read
                move age-ragsoc-1 to lab-age-buf
                display lab-age

           |78-ID-ef-pag è l'ID del control ef-pag
           when 78-ID-ef-pag
                inquire ef-pag, value in ef-pag-buf
                move "PA"       to tblpa-codice1
                move ef-pag-buf to tblpa-codice2
                read tcodpag no lock
                     invalid
                     move spaces to tblpa-descrizione2 
                                    tblpa-descrizione2
                     display message box "Codice Pagamento NON valido"
                             title = tit-err
                             icon  2
                     set errori to true
                end-read
                perform MOVE-DESCR-PAG
                display lab-pag     

           |78-ID-ef-iva-ese è l'ID del control ef-iva-ese
           when 78-ID-ef-iva-ese
                move spaces  to tbliv-descrizione2 
                                tbliv-descrizione2
                inquire ef-iva-ese, value in ef-iva-ese-buf
                if ef-iva-ese-buf      not = spaces
                   move "IV"           to tbliv-codice1
                   move ef-iva-ese-buf to tbliv-codice2
                   read tivaese no lock
                        invalid
                        set errori  to true
                        display message box "Codice IVA NON valido"
                                title = tit-err
                                icon  2
                    not invalid
                        if tbliv-percentuale not = 0
                           set errori to true        
                           display message box "Codice IVA NON valido "
                                               "in quanto non esente"
                                   title = tit-err
                                   icon mb-warning-icon
                        end-if
                   end-read
                   perform MOVE-DESCR-IVA
                else
                   move spaces to lab-iva-buf
                end-if
                display lab-iva

           |78-ID-ef-piano è l'ID del control ef-piano
           when 78-ID-ef-piano
                initialize mas-descrizione1 mas-descrizione2
                inquire ef-piano, value in ef-piano-buf
                if ef-piano-buf = spaces
                   move spaces            to lab-piano-buf
                   move tca-contropartita to ef-piano-buf
                   display ef-piano lab-piano
                end-if
                move ef-piano-buf to mas-codice
                read mas no lock
                     invalid
                     set errori   to true
                     display message box "Contropartita NON valida"
                             title = tit-err
                             icon  2
                end-read
                perform MOVE-DESCR-PIANO
                display lab-piano ef-piano

           when 78-ID-ef-data-ingresso
                inquire ef-data-ingresso, value in ef-data-ingresso-buf
                move ef-data-ingresso-buf to como-data
                if como-data not = 0
                   perform DATE-FORMAT
                   move como-data to ef-data-ingresso-buf
                   display ef-data-ingresso
                   perform DATE-TO-FILE
                   if como-data <= tge-data-consolid-progmag          
                      set errori to true
                      display message 
                      "La data di ingresso dev'essere > "
                      "alla data di consolidamento magazzino ("
                      tge-data-consolid-progmag(7:2)"/" 
                      tge-data-consolid-progmag(5:2)"/"
                      tge-data-consolid-progmag(1:4)")"
                                title tit-err
                                 icon 2
                      move 78-ID-ef-data-ingresso to control-id store-id
                   end-if                                              
                end-if

           |78-ID-ef-note è l'ID del control ef-note
           when 78-ID-ef-note
                inquire ef-note, value in ef-note-buf
                if ef-note-buf = spaces
                   display message box "Intestazione obbligatoria"
                           title = tit-err
                           icon  2
                   set errori to true
                end-if

           |78-ID-cbo-stato è l'ID del control cbo-stato
           when 78-ID-cbo-stato
                inquire cbo-stato, value in cbo-stato-buf
                perform SCARICA-COMBO-STATO
                move stato   to  tno-stato
                if tno-stato not = old-tno-stato
                   move 1 to Passwd-password
                   call   "passwd" using Passwd-linkage
                   cancel "passwd"

                   if not Passwd-StatusOk
                      move old-tno-stato to stato
                      perform CARICA-COMBO-STATO
                      set errori         to true
                   else
                      if disattivo
                         move control-id to store-id
                         move "clienti" to nome-file
                         perform CHANGE-STATUS
                         move store-id to control-id
                      end-if
                   end-if
                end-if

           |78-ID-ef-qta-NCPZ è l'ID del control ef-qta-NCPZ
           when 78-ID-ef-qta-NCPZ
                if v-NCPZ = 1 and tot-righe > 1
                   inquire ef-qta-NCPZ, value in ef-qta-NCPZ-buf
                   move ef-qta-NCPZ-buf to rno-qta
                   if rno-qta not = 0
                      move rno-qta to col-quantita
                      inquire form1-gd-1, cursor-y in riga
                      if hid-old-qta < rno-qta
                         move hid-old-qta to col-qta
                         display message "Quantità inserita superiore"
                                         " della quantità fatturata."
                                  x"0d0a""Quantità fatturata: ", col-qta
                                 title = tit-err
                                 icon  2
                         set errori to true
      *****                else
      *****                   perform CANCELLA-COLORE
      *****                   move 78-ID-ef-prz-NCPZ to control-id
      *****                   move 4                 to accept-control
                      end-if
                   end-if
                end-if

           |78-ID-ef-prz-NCPZ è l'ID del control ef-prz-NCPZ
           when 78-ID-ef-prz-NCPZ
                if v-NCPZ = 1 and tot-righe > 1
                   inquire ef-prz-NCPZ, value in ef-prz-NCPZ-buf
                   move ef-prz-NCPZ-buf to rno-prz-unitario
                   if rno-prz-unitario not = 0
                      move rno-prz-unitario to col-prezzo
                      inquire form1-gd-1, cursor-y in riga
                      if hid-old-prz < rno-prz-unitario
                         move hid-old-prz to col-imp
                         display message "Prezzo inserito superiore"
                                         " del prezzo fatturato."
                                  x"0d0a""Prezzo fatturato: ", col-imp
                                 title = tit-err
                                 icon  2
                         set errori to true
      *****                else
      *****                   perform CANCELLA-COLORE
      *****                   move 78-ID-ef-iva-NCPZ to control-id
      *****                   move 4                 to accept-control
LUBEXX                else
LUBEXX                   move tge-cod-iva-omag to ef-iva-buf
LUBEXX                   display ef-iva
                      end-if
                   end-if
                end-if

           |78-ID-ef-consumo-NCPZ è l'ID del control ef-consumo-NCPZ
           when 78-ID-ef-consumo-NCPZ
                if v-NCPZ = 1 and tot-righe > 1
                   inquire ef-consumo-NCPZ, value in rno-imp-consumo
                   if rno-imp-consumo not = 0
                      move rno-imp-consumo to col-consumo
                      inquire form1-gd-1, cursor-y in riga
                      if hid-old-consumo < rno-imp-consumo
                         move hid-old-consumo to col-consumo
                         display message "Imposta di consumo inserita su
      -    "periore"
                                         " dell'imposta originale."
                                  x"0d0a""Imposta originale: ", 
           col-consumo
                                 title = tit-err
                                 icon  2
                         set errori to true
                      end-if
                   end-if
                end-if

           |78-ID-ef-coubat-NCPZ è l'ID del control ef-coubat-NCPZ
           when 78-ID-ef-coubat-NCPZ
                if v-NCPZ = 1 and tot-righe > 1
                   inquire ef-coubat-NCPZ, value in rno-imp-cou-cobat
                   if rno-imp-cou-cobat not = 0
                      move rno-imp-cou-cobat to col-coubat
                      inquire form1-gd-1, cursor-y in riga
                      if hid-old-coubat < rno-imp-cou-cobat
                         move hid-old-coubat to col-coubat
                         display message "Imposta Cou/Cobat inserita sup
      -    "eriore"
                                         " dell'imposta originale."
                                  x"0d0a""Imposta originale: ", 
           col-coubat
                                 title = tit-err
                                 icon  2
                         set errori to true
                      end-if
                   end-if
                end-if

           |78-ID-ef-add-NCPZ è l'ID del control ef-add-NCPZ
           when 78-ID-ef-add-NCPZ
                if v-NCPZ = 1 and tot-righe > 1
                   inquire ef-add-NCPZ, value in rno-add-piombo
                   if rno-add-piombo not = 0
                      move rno-add-piombo to col-add
                      inquire form1-gd-1, cursor-y in riga
                      if hid-old-piombo < rno-add-piombo
                         move hid-old-piombo to col-add
                         display message "Add. piombo inserita superiore
      -    ""
                                         " di quella originale."
                                  x"0d0a""Valore originale: ", col-add
                                   title tit-err
                                    icon 2
                         set errori to true
                      end-if
                   end-if
                end-if

           |78-ID-ef-iva-NCPZ è l'ID del control ef-iva-NCPZ
           when 78-ID-ef-iva-NCPZ
                if v-NCPZ = 1 and tot-righe > 1
                   inquire ef-iva-NCPZ,     value in ef-iva-NCPZ-buf
                   inquire ef-qta-NCPZ,     value in ef-qta-NCPZ-buf
                   inquire ef-prz-NCPZ,     value in ef-prz-NCPZ-buf
                   inquire ef-consumo-NCPZ, value in ef-consumo-NCPZ-buf
                   inquire ef-coubat-NCPZ,  value in ef-coubat-NCPZ-buf
                   move ef-qta-NCPZ-buf to rno-qta         
                   move ef-prz-NCPZ-buf to rno-prz-unitario
                   move ef-iva-NCPZ-buf to tbliv-codice2
                   move "IV"            to tbliv-codice1
                   read tivaese no lock 
                        invalid
                        set errori to true
                        display message "Codice IVA NON valido"
                                title = tit-err
                                icon  2
                    not invalid
LUBEXX                  if rno-qta = 0
LUBEXX                     set errori to true
LUBEXX                     move 78-ID-ef-qta-NCPZ to control-id
LUBEXX                  end-if
LUBEXX*****                        evaluate true
LUBEXX*****                        when rno-qta = 0 also rno-prz-unitario = 0
LUBEXX*****                             continue
LUBEXX*****                        when rno-qta = 0 also rno-prz-unitario > 0
LUBEXX*****                             set errori to true
LUBEXX*****                             move 78-ID-ef-qta-NCPZ to control-id
LUBEXX*****                        when rno-qta > 0 also rno-prz-unitario = 0
LUBEXX*****                             set errori to true
LUBEXX*****                             move 78-ID-ef-prz-NCPZ to control-id
LUBEXX*****                        end-evaluate
                   end-read
                   if tutto-ok and key-status = 13
LUBEXX                if rno-prz-unitario = 0
LUBEXX                   move tge-cod-iva-omag to ef-iva-buf
LUBEXX                   display ef-iva
LUBEXX                end-if
                      move rno-qta             to col-quantita
                      move rno-prz-unitario    to col-prezzo
                      move ef-consumo-NCPZ-buf to col-consumo
                      move ef-coubat-NCPZ-buf  to col-coubat
                      move ef-add-NCPZ-buf     to col-add
                      move ef-iva-NCPZ-buf     to col-cod-iva
                      modify form1-gd-1(riga, 4), cell-data =  
           col-quantita
                      modify form1-gd-1(riga, 5), cell-data =  
           col-prezzo  
                      modify form1-gd-1(riga, 6), cell-data =  
           col-consumo
                      modify form1-gd-1(riga, 7), cell-data =  
           col-coubat
                      modify form1-gd-1(riga, 8), cell-data =  col-add
                      modify form1-gd-1(riga, 9), cell-data =  
           col-cod-iva
                   end-if
                end-if

           |78-ID-ef-qta-NCRE è l'ID del control ef-qta-NCRE
           when 78-ID-ef-qta-NCRE
                if v-NCRE = 1 and tot-righe > 1
                   inquire ef-qta-NCRE, value in ef-qta-NCRE-buf
                   move ef-qta-NCRE-buf to rno-qta
                   move rno-qta to col-quantita
                   inquire form1-gd-1, cursor-y in riga
                   if hid-old-qta < rno-qta
                      move hid-old-qta to col-qta
                      display message "Quantità inserita superiore"
                                      " della quantità fatturata."
                               x"0d0a""Quantità fatturata: ", col-qta
                              title = tit-err
                              icon  2
                      set errori to true
                   end-if
                   if tutto-ok and key-status = 13
                      move rno-qta to col-quantita
                      modify form1-gd-1(riga, 4), cell-data =  
           col-quantita
                   end-if
                end-if

           |78-ID-ef-descr è l'ID del control ef-descr
           when 78-ID-ef-descr
                if v-NCNC = 1 and tot-righe > 1
                   inquire ef-descr, value in ef-descr-buf
LUBEXX             if ef-descr-buf not = spaces
LUBEXX                if ef-iva-ese-buf not = spaces
LUBEXX                   move ef-iva-ese-buf to ef-iva-NCNC-buf
LUBEXX                   display ef-iva-NCNC
LUBEXX                end-if
LUBEXX             end-if
      *****             perform CANCELLA-COLORE
      *****             move 78-ID-ef-prz-NCNC  to control-id
      *****             move 4                  to accept-control
                end-if
   
           |78-ID-ef-prz-NCNC è l'ID del control ef-prz-NCNC
           when 78-ID-ef-prz-NCNC
                if v-NCNC = 1 and tot-righe > 1
                   inquire ef-prz-NCNC, value in ef-prz-NCNC-buf
      *****             perform CANCELLA-COLORE
      *****             move 78-ID-ef-iva-NCNC  to control-id
      *****             move 4                  to accept-control
                end-if

           |78-ID-ef-iva-NCNC è l'ID del control ef-iva-NCNC
           when 78-ID-ef-iva-NCNC
                if v-NCNC = 1 and tot-righe > 1
                   inquire ef-iva-NCNC, value in ef-iva-NCNC-buf
                   if ef-iva-NCNC-buf not = spaces
                      move ef-iva-NCNC-buf to tbliv-codice2
                      move "IV"            to tbliv-codice1
                      read tivaese no lock 
                           invalid
                           set errori to true
                           display message "Codice IVA NON valido"
                                   title = tit-err
                                   icon  2
                       not invalid
                           inquire ef-descr,    value in ef-descr-buf
                           inquire ef-prz-NCNC, value in ef-prz-NCNC-buf
                           move ef-prz-NCNC-buf to rno-prz-unitario
                           if ef-descr-buf = spaces
                              set errori to true
                              move 78-ID-ef-descr to control-id
                           else
                              if rno-prz-unitario = 0
                                 set errori to true
                                 move 78-ID-ef-prz-NCNC to control-id
                              end-if
                           end-if
                      end-read
                   else
                      set errori           to true
                      inquire ef-descr,    value in ef-descr-buf
                      inquire ef-prz-NCNC, value in rno-prz-unitario
                      if ef-descr-buf = spaces
                         move 78-ID-ef-descr to control-id
                      else
                         if rno-prz-unitario = 0
                            move 78-ID-ef-prz-NCNC to control-id
                         else
                            move 78-ID-ef-iva-NCNC to control-id
                         end-if
                      end-if
                   end-if    
                   if tutto-ok and key-status = 13
                      inquire ef-consumo-NCNC,value in rno-imp-consumo
                      inquire ef-coubat-NCNC, value in rno-imp-cou-cobat
                      inquire ef-add-NCNC,    value in rno-add-piombo
                      move ef-descr-buf       to col-descr
                      move rno-prz-unitario   to col-prezzo
                      move rno-imp-consumo    to col-consumo
                      move rno-imp-cou-cobat  to col-coubat
                      move rno-add-piombo     to col-add
                      move ef-iva-NCNC-buf    to col-cod-iva
                      modify form1-gd-1(riga, 3),
                             cell-data =  col-descr
                      modify form1-gd-1(riga, 5),
                             cell-data =  col-prezzo
                      modify form1-gd-1(riga, 6),
                             cell-data =  col-consumo
                      modify form1-gd-1(riga, 7),
                             cell-data =  col-coubat
                      modify form1-gd-1(riga, 8),
                             cell-data =  col-add
                      modify form1-gd-1(riga, 9),
                             cell-data =  col-cod-iva
                      move 0 to riga-nuova
                   end-if
                end-if

           |78-ID-ef-art è l'ID del control ef-art
           when 78-ID-ef-art
                if v-0 = 1 and tot-righe > 1
                   inquire ef-art, value in ef-art-buf
                   move ef-art-buf to art-codice
                   move spaces to lab-art-buf
                   if art-codice not = hid-cod-articolo
                      move spaces to HiddenKey
                   end-if 
                   read articoli no lock
                        invalid  set errori to true
                    not invalid
                        if art-attivo
                           if HiddenKey = spaces
                              perform FIND-MORE-ARTICOLI-ON-PROGMAG
                              evaluate num-articoli
                              when 0
                                   set errori to true
                              when 1
                                   move GiacenzaKey      to prg-chiave 
           HiddenKey
                                   read progmag no lock invalid 
           continue end-read
                                   move prg-peso-utf     to hid-peso-utf
                                   move prg-peso-non-utf to 
           hid-peso-non-utf
                              when other             
                                   perform ZOOM-SU-PROGMAG-ARTICOLO
                                   move 4 to accept-control
                              end-evaluate
                           end-if
LUBEXX                     if ef-iva-ese-buf not = spaces
                              move ef-iva-ese-buf to ef-iva-buf
                           else
                              if ef-iva-buf = spaces
                                 move art-codice-iva  to ef-iva-buf
                              end-if
                           end-if
                           move art-descrizione to lab-art-buf
                        else
                           set errori to true
                        end-if
                   end-read
                   display lab-art ef-qta ef-prz ef-iva
                   if errori
                      initialize art-stato
                      display message "Codice articolo NON valido"
                              title = tit-err
                              icon  2        
      *****             else
      *****                perform CANCELLA-COLORE
      *****                move 78-ID-ef-qta to control-id
      *****                move 4            to accept-control
                   end-if
                end-if

           |78-ID-ef-qta è l'ID del control ef-qta
           when 78-ID-ef-qta
                if v-0 = 1 and tot-righe > 1
                   inquire ef-qta, value in ef-qta-buf
      *****             perform CANCELLA-COLORE
      *****             move 78-ID-ef-prz to control-id
      *****             move 4            to accept-control
                end-if

           |78-ID-ef-prz è l'ID del control ef-prz
           when 78-ID-ef-prz
                if v-0 = 1 and tot-righe > 1
                   inquire ef-prz, value in ef-prz-buf
LUBEXX             move ef-prz-buf to rno-prz-unitario
LUBEXX             if rno-prz-unitario = 0
                      move Link-TipoNota to tca-codice
                      read tcaumag no lock invalid continue end-read
                      if tca-tipo-nota-reso or tca-tipo-nota-prz
                         if ef-iva-ese-buf = spaces
LUBEXX                      move tge-cod-iva-omag to ef-iva-buf
LUBEXX                   end-if
LUBEXX                   display ef-iva
LUBEXX                end-if
LUBEXX             end-if
      *****             perform CANCELLA-COLORE
      *****             move 78-ID-ef-iva to control-id
      *****             move 4            to accept-control
                end-if

           |78-ID-ef-iva è l'ID del control ef-iva
           when 78-ID-ef-iva
                if v-0 = 1 and tot-righe > 1
                   inquire ef-art,     value in rno-cod-articolo
                   inquire ef-consumo, value in rno-imp-consumo
                   inquire ef-coubat,  value in rno-imp-cou-cobat
                   inquire ef-add,     value in rno-add-piombo
                   inquire ef-prz,     value in rno-prz-unitario
                   inquire ef-qta,     value in rno-qta
                   inquire ef-iva,     value in ef-iva-buf
LUBEXX             if rno-prz-unitario = 0
                      move Link-TipoNota to tca-codice
                      read tcaumag no lock invalid continue end-read
                      if tca-tipo-nota-reso or tca-tipo-nota-prz
LUBEXX                   if ef-iva-ese-buf = spaces
LUBEXX                      move tge-cod-iva-omag to ef-iva-buf
LUBEXX                   end-if
LUBEXX                   display ef-iva
LUBEXX                end-if
LUBEXX             end-if
                   if ef-iva-buf not = spaces
                      move ef-iva-buf to tbliv-codice2
                      move "IV"       to tbliv-codice1
                      read tivaese no lock
                           invalid
                           set errori to true
                           display message "Codice IVA NON valido"
                                   title = tit-err
                                   icon  2
                       not invalid
                           if rno-qta = 0
                              set errori        to true
                              move 78-ID-ef-qta to control-id
                           else
                              if rno-prz-unitario = 0
                                 move Link-TipoNota to tca-codice
                                 read tcaumag no lock invalid continue 
           end-read
                                 if tca-tipo-nota-reso or 
           tca-tipo-nota-prz
                                    continue
LUBEXX                           else
LUBEXX                              set errori        to true
LUBEXX                              move 78-ID-ef-prz to control-id
LUBEXX                           end-if
                              end-if
                           end-if
                      end-read
                   else
                      set errori           to true
                      if rno-qta = 0
                         move 78-ID-ef-qta to control-id
                      else
                         if rno-prz-unitario = 0
                            move Link-TipoNota to tca-codice
                            read tcaumag no lock invalid continue 
           end-read
                            if tca-tipo-nota-reso or tca-tipo-nota-prz
LUBEXX                         move 78-ID-ef-iva to control-id
LUBEXX                      else
                               move 78-ID-ef-prz to control-id
LUBEXX                      end-if
                         else
                            move 78-ID-ef-iva to control-id
LUBEXX                   end-if
                      end-if
                   end-if    
                   if tutto-ok and key-status = 13
                      move ef-art-buf        to col-codice
                      move lab-art-buf       to col-descr
                      move rno-imp-consumo   to col-consumo
                      move rno-imp-cou-cobat to col-coubat
                      move rno-add-piombo    to col-add
                      move rno-prz-unitario  to col-prezzo
                      move rno-qta           to col-quantita
                      move ef-iva-buf        to col-cod-iva
                      modify form1-gd-1(riga, 2), 
                             cell-data =  col-codice
                      modify form1-gd-1(riga, 3), 
                             cell-data =  col-descr
                      modify form1-gd-1(riga, 4), 
                             cell-data =  col-quantita
                      modify form1-gd-1(riga, 5), 
                             cell-data =  col-prezzo  
                      modify form1-gd-1(riga, 6), 
                             cell-data =  col-consumo
                      modify form1-gd-1(riga, 7),
                             cell-data =  col-coubat
                      modify form1-gd-1(riga, 8),
                             cell-data =  col-add
                      modify form1-gd-1(riga, 9), 
                             cell-data =  col-cod-iva
                      modify form1-gd-1(riga, 2), 
                             hidden-data = HiddenKey

                      modify form1-gd-1(riga, 1),
                             hidden-data = HiddenValori
                      move 0 to riga-nuova
                   end-if
                end-if 
                               
           when 78-ID-ef-fatt-data
                move ef-fatt-data-buf to como-data
                if como-data not = 0
                   perform DATE-FORMAT
                   move como-data to ef-fatt-data-buf
                   display ef-fatt-data
                end-if
                               
           when 78-ID-ef-bolla-data
                move ef-bolla-data-buf to como-data
                if como-data not = 0
                   perform DATE-FORMAT
                   move como-data to ef-bolla-data-buf
                   display ef-bolla-data
                end-if

           end-evaluate.
           
           if errori
              perform CANCELLA-COLORE
              move control-id to store-id
              move 4          to accept-control
           end-if 
           .
      * <TOTEM:END>

       CONTROLLO-DATI-EDI.
      * <TOTEM:PARA. CONTROLLO-DATI-EDI>
           if tca-causale-EDI  not = spaces
              move ef-cli-buf to tno-cod-cli     convert

LUBEXX        move spaces     to rec-invio
LUBEXX        move cli-codice to rec-codice
LUBEXX        read recapiti no lock invalid continue end-read
LUBEXX        if rec-invio = spaces set tno-invio-manuale to true
LUBEXX        else                  move rec-invio to tno-invio
LUBEXX        end-if

              if tno-invio-edi
      *****           evaluate tca-causale-edi
      *****           when "L02" 
      *****           when "L08"
      *****                move ef-fatt-num-buf  to tno-fattura-from-numero
      *****                move ef-fatt-data-buf to tno-fattura-from-data
      *****                if tno-fattura-from-numero = 0 or
      *****                   tno-fattura-from-data   = 0  
      *****                   set errori to true
      *****                   display message 
      *****                 "Fattura di riferimento obbligatoria"
      *****          x"0d0a""per nota credito differenza prezzo EDI"
      *****                            title tit-err
      *****                             icon 2
      *****                   move 78-ID-ef-fatt-num to control-id 
      *****                   perform CANCELLA-COLORE
      *****                else
      *****                   move tno-fattura-from-data to como-data
      *****                   perform DATE-FORMAT
      *****                   move como-data to ef-fatt-data-buf
      *****                   display ef-fatt-data
      *****                end-if
      *****           when "L07"                                       
                      move ef-fatt-num-buf   to tno-fattura-from-numero
                      move ef-fatt-data-buf  to tno-fattura-from-data

                      move ef-bolla-num-buf  to tno-bolla-from-numero
                      move ef-bolla-data-buf to tno-bolla-from-data

                      set errori to true
                      if tno-bolla-from-numero   not = spaces and
                         tno-bolla-from-data     not = 0      and
                         tno-fattura-from-numero = 0          and
                         tno-fattura-from-data   = 0
                         set tutto-ok to true
                      end-if

                      if tno-bolla-from-numero   = spaces and
                         tno-bolla-from-data     = 0      and
                         tno-fattura-from-numero not = 0  and
                         tno-fattura-from-data   not = 0
                         set tutto-ok to true
                      end-if

                      if errori
                         set errori to true
                         display message 
                       "Bolla di reso O fattura di riferimento obbligato
      -    "ria"
                x"0d0a""per nota credito EDI"
                                  title tit-err
                                   icon 2       
                         move 78-ID-ef-bolla-num to control-id
                         perform CANCELLA-COLORE
                      else
                         move tno-bolla-from-data to como-data
                         if como-data not = 0
                            perform DATE-FORMAT
                            move como-data to ef-bolla-data-buf
                            display ef-bolla-data
                         end-if
                         move tno-fattura-from-data to como-data
                         if como-data not = 0
                            perform DATE-FORMAT
                            move como-data to ef-fatt-data-buf
                            display ef-fatt-data
                         end-if
                      end-if
      *****           end-evaluate
              end-if
           end-if 
           .
      * <TOTEM:END>

       CURRENT-RECORD.
      * <TOTEM:PARA. CURRENT-RECORD>
           if LinkFatt
              read tordini
                 invalid 
                    |Valorizzo per lo meno la data di sistema...
                    accept como-data from century-date
                    perform DATE-TO-SCREEN
                    move como-data   to lab-data-nc-buf
                    |... l'anno di esercizio, ...
                    move esercizio   to lab-anno-nc-buf
                    |... il codice pagamento standard ...
                    move "PA"        to tblpa-codice1
                    move tge-cod-pag to tblpa-codice2
                    read tcodpag no lock invalid continue end-read
                    perform MOVE-DESCR-PAG
                    |... e muovo a blank codice e destino.
                    move spaces to ef-cli-buf ef-des-buf
                    perform INTESTAZIONE
                 not invalid 
                    perform LEGGI-TESTATA
                    perform VALORIZZA-SCREEN
                    perform CARICA-GRID
              end-read
           else
              read btnotacr
                 invalid 
                    |Valorizzo per lo meno la data di sistema...
                    accept como-data from century-date
                    perform DATE-TO-SCREEN
                    move como-data   to lab-data-nc-buf
                    |... l'anno di esercizio, ...
                    move esercizio   to lab-anno-nc-buf
                    |... il codice pagamento standard ...
                    move "PA"        to tblpa-codice1
                    move tge-cod-pag to tblpa-codice2
                    read tcodpag no lock invalid continue end-read
                    perform MOVE-DESCR-PAG
                    |... e muovo a blank codice e destino.
                    move spaces to ef-cli-buf ef-des-buf
                    perform INTESTAZIONE
                 not invalid 
                    perform LEGGI-TESTATA
                    perform VALORIZZA-SCREEN
                    perform CARICA-GRID-BOZZA
               end-read
           end-if.
           perform FORM1-BUF-TO-FLD.
           perform VALORIZZA-OLD.
           
           if tca-tipo-nota-abbuono
              perform INSERISCI-RIGA
           end-if 
           .
      * <TOTEM:END>

       DISPLAY-SCREEN.
      * <TOTEM:PARA. DISPLAY-SCREEN>
           display form1 
           .
      * <TOTEM:END>

       FIND-MORE-ARTICOLI-ON-PROGMAG.
      * <TOTEM:PARA. FIND-MORE-ARTICOLI-ON-PROGMAG>
           move 0 to num-articoli.
           move low-value     to prg-rec.
           move art-codice    to prg-cod-articolo.
           move tca-cod-magaz to prg-cod-magazzino.
           start progmag key  is >= prg-chiave
                 invalid continue
             not invalid
                 perform until 1 = 2
                    read progmag next at end exit perform    end-read
                    if prg-cod-articolo      = art-codice    and
                       prg-cod-magazzino     = tca-cod-magaz
                       if prg-tipo-imballo  not = spaces     and
                          prg-peso          not = 0          and
                          prg-attivo
                          add 1 to num-articoli
                          evaluate true
                          when num-articoli = 1 
                               move prg-chiave to GiacenzaKey
                          when num-articoli > 1 
                               exit perform
                          end-evaluate
                       end-if
                    else
                       exit perform
                    end-if
                 end-perform
           end-start 
           .
      * <TOTEM:END>

       INIT.
      * <TOTEM:PARA. INIT>
           set ArticoloSetFocus to false.
           set InsertRow        to false.
           set PrimaVolta       to true.
           set ControllaCampi   to true.
           set CheckDestini     to true.
           move 0 to v-grid.
           move 0 to v-ncpz.
           move 0 to v-ncre.
           move 0 to v-ncnc.
           move 0 to LastPrg
           move 0 to v-sel-tutto.
           if LinkNumero = 0 or tca-tipo-nota-abbuono
              move 78-GridLinesWithout to grid-lines
              move 78-GridLineWithout  to grid-line
           else
              move 78-GridLineWith  to grid-line
              move 78-GridLinesWith to grid-lines
           end-if.
           move spaces to HiddenKey.
           modify form1-gd-1 line  grid-line.
           modify form1-gd-1 lines grid-lines.
           move 78-ID-ef-cli to control-id.
           move 4            to accept-control.
           move 1 to event-data-1 screen1-ta-1-tab-value.
           perform SCREEN1-TA-1-TABCHANGE.

           move tca-contropartita to mas-codice ef-piano-buf 
                                     tno-contropartita.
           initialize mas-descrizione1, mas-descrizione2.
           read mas no lock invalid continue end-read.
           perform MOVE-DESCR-PIANO.
           
           if KeyboardSaved
              set KeyboardReleased to true
              set environment "KEYSTROKE" to "DATA=44 44"
              set environment "KEYSTROKE" to "DATA=46 46"
           end-if 
           .
      * <TOTEM:END>

       INITIALIZE-ENTRY.
      * <TOTEM:PARA. INITIALIZE-ENTRY>
           move 0 to ef-qta-NCPZ-buf 
                     ef-prz-NCPZ-buf 
                     ef-consumo-NCPZ-buf 
                     ef-coubat-NCPZ-buf 
                     ef-add-NCPZ-buf
                     
                     ef-qta-NCRE-buf

                     ef-prz-NCNC-buf
                     ef-consumo-NCNC-buf
                     ef-coubat-NCNC-buf
                     ef-add-NCNC-buf
                     
                     ef-art-buf
                     ef-qta-buf
                     ef-prz-buf
                     ef-consumo-buf
                     ef-coubat-buf
                     ef-add-buf.

           move spaces to ef-descr-buf lab-art-buf
                          ef-iva-NCPZ-buf
                          ef-iva-buf
                          ef-iva-NCNC-buf.

           perform DISPLAY-SCREEN 
           .
      * <TOTEM:END>

       INSERISCI-RIGA.
      * <TOTEM:PARA. INSERISCI-RIGA>
           add 1 to LastPrg.
           move LastPrg to col-riga.
           inquire form1-gd-1, last-row in tot-righe.
           modify  form1-gd-1, insert-rows = 1.
           add 1 to tot-righe giving riga.
           modify form1-gd-1(riga, 1), cell-data = col-riga.
           move 1 to riga-nuova 
           .
      * <TOTEM:END>

       INTESTAZIONE.
      * <TOTEM:PARA. INTESTAZIONE>
           move Link-TipoNota to tca-codice.
           read tcaumag no lock invalid continue end-read.
           if tca-tipo-nota-reso or tca-tipo-nota-prz
              perform FORM1-GD-1-CONTENT
              perform GD-FATT-CONTENT
           else
              modify form1-gd-1(1, 2), cell-data = spaces
              modify form1-gd-1(1, 3), cell-data = "Descrizione Voce"
              modify form1-gd-1(1, 4), cell-data = spaces
              modify form1-gd-1(1, 5), cell-data = "Importo"
              modify form1-gd-1(1, 6), cell-data = "Consumo"
              modify form1-gd-1(1, 7), cell-data = "Cou/Cobat"
              modify form1-gd-1(1, 8), cell-data = "Add. Piombo"
              modify form1-gd-1(1, 9), cell-data = "Cod. IVA"
           end-if 
           .
      * <TOTEM:END>

       LEGGI-TESTATA.
      * <TOTEM:PARA. LEGGI-TESTATA>
           if LinkBozza
              move btno-cod-cli     to tor-cod-cli
              move btno-prg-destino to tor-prg-destino
              move btno-cod-pag     to tge-cod-pag 
                                       tor-cod-pagamento 
                                       ef-pag-buf
              move btno-data-bolla  to como-data
              perform DATE-TO-SCREEN
              move como-data        to lab-data-bolla-buf
              move btno-num-bolla   to lab-num-bolla-buf
              move btno-motivo-cont to lab-motivo-buf
              evaluate true
              when btno-corriere   move "Corriere"  to lab-colpa-buf
              when btno-magazzino  move "Magazzino" to lab-colpa-buf
              when btno-fornitore  move "fornitore" to lab-colpa-buf
              when btno-cliente    move "Cliente"   to lab-colpa-buf
              when btno-ufficio    move "Ufficio"   to lab-colpa-buf
              end-evaluate
              move btno-note to lab-altre-buf
              move btno-data to tor-data-fattura
              if btno-vettore not = 0
                 move btno-vettore to lab-corriere-buf vet-codice
                 read tvettori no lock invalid continue end-read
                 move vet-descrizione to lab-corriere-des-buf
              end-if
           else
              move tor-data-bolla  to como-data
              perform DATE-TO-SCREEN
              move como-data        to lab-data-bolla-buf
              move tor-num-bolla    to lab-num-bolla-buf
              inspect lab-num-bolla-buf replacing leading x"30" by x"20"
              call "C$JUSTIFY" using lab-num-bolla-buf, "L"
           end-if.

           move tor-cod-cli  to cli-codice.
           set cli-tipo-C    to true.
           read clienti  invalid continue end-read.

           if LinkBozza
              move cli-iva-ese to tor-cod-ese-iva
              move cli-agente  to tor-cod-agente
           end-if.

           if tor-prg-destino not = 0
              move tor-cod-cli     to des-codice
              move tor-prg-destino to des-prog
              read destini invalid continue end-read
           end-if.

           move "PA"        to tblpa-codice1.
           move tge-cod-pag to tblpa-codice2.
           read tcodpag invalid continue end-read.  

           move tor-cod-agente to age-codice.
           read agenti invalid continue end-read.

           move "IV"            to tbliv-codice1.
           move tor-cod-ese-iva to tbliv-codice2.
           read tivaese invalid continue end-read 
           .
      * <TOTEM:END>

       MOVE-DESCR-IVA.
      * <TOTEM:PARA. MOVE-DESCR-IVA>
           initialize lab-iva-buf.
           inspect tbliv-descrizione1 replacing trailing 
                                         spaces by low-value.
           string  tbliv-descrizione1 delimited by low-value
                   " "                delimited by size
                   tbliv-descrizione2 delimited by size
                   into lab-iva-buf
           end-string 
           .
      * <TOTEM:END>

       MOVE-DESCR-PAG.
      * <TOTEM:PARA. MOVE-DESCR-PAG>
           initialize lab-pag-buf.
           inspect tblpa-descrizione1 replacing trailing 
                                         spaces by low-value.
           string  tblpa-descrizione1 delimited by low-value
                   " "                delimited by size
                   tblpa-descrizione2 delimited by size
                   into lab-pag-buf
           end-string 
           .
      * <TOTEM:END>

       MOVE-DESCR-PIANO.
      * <TOTEM:PARA. MOVE-DESCR-PIANO>
           initialize lab-piano-buf.
           inspect mas-descrizione1 replacing trailing 
                                       spaces by low-value.
           string  mas-descrizione1 delimited by low-value
                   " "              delimited by size
                   mas-descrizione2 delimited by size
                   into lab-piano-buf
           end-string 
           .
      * <TOTEM:END>

       PARAGRAFO-COPY.
      * <TOTEM:PARA. PARAGRAFO-COPY>
           copy "utydata.cpy".
           copy "abilita-toolbar.cpy".
           copy "color-custom.cpy".
           copy "riempi-combo-stato.cpy".
           copy "zoom-su-tmp-progmag.cpy" 
           .
      * <TOTEM:END>

       RESET-GRIGLIA.
      * <TOTEM:PARA. RESET-GRIGLIA>
           modify gd-fatt, reset-grid = 1.
           perform INTESTAZIONE 
           .
      * <TOTEM:END>

       RESETTA-VIRGOLA.
      * <TOTEM:PARA. RESETTA-VIRGOLA>
           if KeyboardSaved
              set KeyboardReleased to true
      *       setto la tastiera originale
              set environment "KEYSTROKE" to "DATA=44 44"
              set environment "KEYSTROKE" to "DATA=46 46"
           end-if 
           .
      * <TOTEM:END>

       ROW-TO-ENTRY.
      * <TOTEM:PARA. ROW-TO-ENTRY>
           move Link-TipoNota to tca-codice.
           read tcaumag no lock invalid continue end-read.
           evaluate true
           when tca-tipo-nota-prz
                inquire form1-gd-1(riga, 4), cell-data in col-quantita
                inquire form1-gd-1(riga, 5), cell-data in col-prezzo  
                inquire form1-gd-1(riga, 6), cell-data in col-consumo
                inquire form1-gd-1(riga, 7), cell-data in col-coubat
                inquire form1-gd-1(riga, 8), cell-data in col-add
                inquire form1-gd-1(riga, 9), cell-data in col-cod-iva
                if LinkNumero = 0
                   inquire form1-gd-1(riga, 2),cell-data in col-codice
                   inquire form1-gd-1(riga, 3),cell-data in col-descr
                   move col-codice   to ef-art-buf
                   move col-descr    to lab-art-buf
                   move col-quantita to ef-qta-buf
                   move col-prezzo   to ef-prz-buf
                   move col-consumo  to ef-consumo-buf
                   move col-coubat   to ef-coubat-buf
                   move col-add      to ef-add-buf
                   move col-cod-iva  to ef-iva-buf
                   display ef-art lab-art ef-qta ef-prz ef-iva 
                           ef-consumo ef-coubat  ef-add
                else
                   move col-quantita to ef-qta-NCPZ-buf                 
            
                   move col-prezzo   to ef-prz-NCPZ-buf
                   move col-consumo  to ef-consumo-NCPZ-buf
                   move col-coubat   to ef-coubat-NCPZ-buf
                   move col-add      to ef-add-NCPZ-buf
                   move col-cod-iva  to ef-iva-NCPZ-buf
                   display ef-qta-NCPZ ef-prz-NCPZ ef-iva-NCPZ
                           ef-consumo-NCPZ ef-coubat-NCPZ ef-add-NCPZ
                end-if

           when tca-tipo-nota-reso
                inquire form1-gd-1(riga, 4), cell-data in col-quantita
                if LinkNumero = 0
                   inquire form1-gd-1(riga, 2),cell-data in col-codice
                   inquire form1-gd-1(riga, 3),cell-data in col-descr
                   inquire form1-gd-1(riga, 5),cell-data in col-prezzo
                   inquire form1-gd-1(riga, 6),cell-data in col-consumo
                   inquire form1-gd-1(riga, 7),cell-data in col-coubat
                   inquire form1-gd-1(riga, 8),cell-data in col-add
                   inquire form1-gd-1(riga, 9),cell-data in col-cod-iva
                   move col-codice   to ef-art-buf
                   move col-descr    to lab-art-buf
                   move col-quantita to ef-qta-buf
                   move col-prezzo   to ef-prz-buf
                   move col-consumo  to ef-consumo-buf
                   move col-coubat   to ef-coubat-buf
                   move col-add      to ef-add-buf
                   move col-cod-iva  to ef-iva-buf
                   display ef-art lab-art ef-qta ef-prz ef-iva
                           ef-consumo ef-coubat ef-add
                else
                   move col-quantita to ef-qta-NCRE-buf
                   display ef-qta-NCRE
                end-if
                    
           when tca-tipo-nota-abbuono
                inquire form1-gd-1(riga, 3), cell-data in col-descr
                inquire form1-gd-1(riga, 5), cell-data in col-prezzo
                inquire form1-gd-1(riga, 6), cell-data in col-consumo
                inquire form1-gd-1(riga, 7), cell-data in col-coubat
                inquire form1-gd-1(riga, 8), cell-data in col-add
                inquire form1-gd-1(riga, 9), cell-data in col-cod-iva
                move col-descr    to ef-descr-buf
                move col-prezzo   to ef-prz-NCNC-buf
                move col-consumo  to ef-consumo-NCNC-buf
                move col-coubat   to ef-coubat-NCNC-buf 
                move col-add      to ef-add-NCNC-buf
                move col-cod-iva  to ef-iva-NCNC-buf
                display ef-prz-NCNC ef-iva-NCNC ef-descr
                        ef-consumo-NCNC ef-coubat-NCNC ef-add-NCNC
           end-evaluate.
           
           inquire form1-gd-1(riga, 1), hidden-data in HiddenValori.
           inquire form1-gd-1(riga, 2), hidden-data in HiddenKey 
           .
      * <TOTEM:END>

       SALVA.
      * <TOTEM:PARA. SALVA>
           set tutto-ok to true.
      
           perform CHECK-PAGE-1.
      
           if tutto-ok
              move Link-TipoNota to tca-codice
              read tcaumag no lock invalid continue end-read
              evaluate true
              when tca-tipo-nota-prz
                   perform CONTA-ZERI-NCPZ
              when tca-tipo-nota-reso
                   perform CONTA-ZERI-NCRE
              when tca-tipo-nota-abbuono
                   perform CONTA-RIGHE-NCNC
              end-evaluate
              if not trovato
                 display message "Impossibile registrare la nota "
                                 "in quanto non sono presenti righe."
                         title = tit-err
                         icon mb-warning-icon
                 set errori to true
                 perform CANCELLA-COLORE
              else
                 move 78-ID-cbo-stato to CONTROL-ID
                 perform CONTROLLO
              end-if
           end-if.

           if tutto-ok                     
              perform CONTROLLO-DATI-EDI
           end-if.
      
           if errori
              inquire Screen1-Ta-1, value in pagina
              |******
              if store-id >= min-id(pagina) and
                 store-id <= max-id(pagina)
                 move store-id to control-id
              end-if
              |******
              move 4 to accept-control
           else
              perform CONTROLLA-TOTALE
              if errori
                 display message 
                  "Salvataggio NON effettuato: Il totale del documento "
            x"0d0a""non rispetta l'indicazione della causale utilizzata"
                           title tit-err
                            icon 2
              else
                 perform CONTA-CODICI-IVA
                 if errori
                    display message 
                    "Impossibile registrare il documento in quanto"
                    " sono presenti più di tre codici IVA"
                              title tit-err
                               icon mb-warning-icon
                    set errori to true
                    perform CANCELLA-COLORE
                 else
                    perform VALORIZZA-NUMERO
                    if tutto-ok
                       perform FORM1-BUF-TO-FLD
                       perform SCRIVI-RIGHE
                                  
                       unlock tnotacr all record
      
LUBEXX                 if not EsisteIVA
LUBEXX                    set tno-invio-manuale to true
LUBEXX                 end-if

                       write tno-rec 
                             invalid rewrite tno-rec 
                       end-write

                       if LinkBozza
                          perform AGGIORNA-BOZZA
                       end-if    

                    end-if                  
                    move 27 to key-status
                 end-if
              end-if
           end-if.
                    
           perform DISPLAY-SCREEN 
           .
      * <TOTEM:END>

       SCRIVI-RIGHE.
      * <TOTEM:PARA. SCRIVI-RIGHE>
LUBEXX     set EsisteIVA to false.
           inquire form1-gd-1, last-row in tot-righe.
           move Link-TipoNota to tca-codice.
           read tcaumag no lock invalid continue end-read.
           perform varying riga from 2 by 1 
                     until riga > tot-righe
              initialize rno-rec replacing numeric data by zeroes
                                      alphanumeric data by spaces
              move    tno-chiave      to rno-chiave
              move    tno-stato       to rno-stato
              move    tno-dati-comuni to rno-dati-comuni
              inquire form1-gd-1(riga, 1), cell-data in col-riga
              inquire form1-gd-1(riga, 2), cell-data in col-codice
              inquire form1-gd-1(riga, 3), cell-data in col-descr
              inquire form1-gd-1(riga, 4), cell-data in col-quantita
              inquire form1-gd-1(riga, 5), cell-data in col-prezzo  
              inquire form1-gd-1(riga, 6), cell-data in col-consumo
              inquire form1-gd-1(riga, 7), cell-data in col-coubat
              inquire form1-gd-1(riga, 8), cell-data in col-add
              inquire form1-gd-1(riga, 9), cell-data in col-cod-iva

              inquire form1-gd-1(riga, 1), hidden-data in HiddenValori
              inquire form1-gd-1(riga, 2), hidden-data in HiddenKey
              move col-riga     to rno-num-riga
              move col-quantita to rno-qta
              move col-prezzo   to rno-prz-unitario
              move col-consumo  to rno-imp-consumo
              move col-coubat   to rno-imp-cou-cobat
              move col-add      to rno-add-piombo
              move col-cod-iva  to rno-cod-iva

LUBEXX        if not EsisteIVA
LUBEXX           perform CONTROLLA-PERCENTUALE-IVA
LUBEXX        end-if
                        
              evaluate true
              when tca-tipo-nota-prz
              when tca-tipo-nota-reso
                   move col-codice to rno-cod-articolo
              when other
                   move col-descr  to rno-des-libera
              end-evaluate
              
              if CallWProgmag
                 initialize link-wprogmag
                 set link-update        to true
                 set link-update-um     to true
                 set link-update-peso   to false
                 set link-update-valore to false
                 move HiddenKey         to link-key
                 move Link-TipoNota     to link-causale
                 move rno-qta           to link-valore
                 move user-codi         to link-user 
                                        of link-wprogmag
                 perform VALORIZZA-ARRAY-CAUSALI

                 call   "wprogmag" using link-wprogmag
                 cancel "wprogmag"
              end-if

              |Quelle di ABBUONO GENERICO hanno la descrizione della 
              |voce manuale per cui nessun riferimento ai progressivi
              evaluate true
              when tca-tipo-nota-reso
              when tca-tipo-nota-prz
                   move HiddenKey        to rno-prg-chiave prg-chiave

                   read progmag no lock 
                      invalid 
                         perform 5 times
                            display message "ARTICOLO " prg-cod-articolo
                                  x"0d0a""RIGA " rno-num-riga
                                  x"0d0a""DATI INCOERENTI!!!"
                                  x"0d0a""CANCELLARE E REINSERIRE LA RIG
      -    "A"
                                   title tit-err
                                    icon 2
                         end-perform
                      not invalid
                         move prg-peso-utf     to rno-peso-utf
                         move prg-peso-non-utf to rno-peso-non-utf
                   end-read

              end-evaluate
              
              accept como-ora from time
              move data-oggi  to rno-data-ultima-modifica
              move como-ora   to rno-ora-ultima-modifica
              move user-codi  to rno-utente-ultima-modifica

              write rno-rec invalid rewrite rno-rec end-write

           end-perform 
           .
      * <TOTEM:END>

       SELEZIONA-ALFA.
      * <TOTEM:PARA. SELEZIONA-ALFA>
           set tutto-ok to true.  
           move spaces to lab-cli-buf.
           move spaces to lab-ind-buf.
           move spaces to lab-loca-buf.
      * LA SECONDA CHIAVE E' ALFANUMERICA E LA VALUE VARIABLE CONTIENE
      * ANCORA GLI ZERI DAVANTI CHE ELIMINO
           inspect ef-cli-buf replacing leading zero by spaces.
           move    ef-cli-buf to cli-ragsoc-1.
      
      * POI GIUSTIFICO A SINISTRA E MI POSIZIONO SULLO ZOOM PER CHIAVE
      * ALTERNATA
           set cli-tipo-c to true.
           call "C$JUSTIFY" using cli-ragsoc-1, "L".
      
           start clienti key >= cli-k1
                 invalid continue
             not invalid read clienti next 
           end-start.
      
           move "clienti-alfa"    to como-file.

           call "zoom-gt" using   como-file, cli-rec
                          giving  stato-zoom.
           cancel "zoom-gt".

           if stato-zoom = 0
              move cli-codice    to codice-ed
              move codice-ed     to ef-cli-buf   
              call "C$JUSTIFY" using ef-cli-buf, "L"
              display ef-cli
           end-if .

           move 78-ID-ef-cli to control-id.
           move 4            to accept-control 
           .
      * <TOTEM:END>

       SELEZIONA-DESTINO-NUMERICO.
      * <TOTEM:PARA. SELEZIONA-DESTINO-NUMERICO>
           move spaces to lab-des-buf.
           move spaces to lab-ind-d-buf.
           move spaces to lab-loca-d-buf.
           inquire ef-cli, value in des-codice.
           inquire ef-des, value in des-prog.
           if des-codice not > 0
              set errori to true
              display message box msg-codice-obbligatorio
                      title tit-err
                      icon  mb-warning-icon
           else          
              inquire ef-cli, value in des-codice
              read destini no lock
                   invalid
                       display message "Progressivo destino NON valido"
                               title = tit-err
                               icon mb-warning-icon
                       set errori to true
              end-read
           end-if 
           .
      * <TOTEM:END>

       SELEZIONA-DESTINO-ALFA.
      * <TOTEM:PARA. SELEZIONA-DESTINO-ALFA>
      * LA SECONDA CHIAVE E' ALFANUMERICA E LA VALUE VARIABLE CONTIENE
      * ANCORA GLI ZERI DAVANTI CHE ELIMINO
           inspect ef-des-buf replacing leading zero by spaces.
           move    ef-des-buf to des-ragsoc-1.
      
      * POI GIUSTIFICO A SINISTRA E MI POSIZIONO SULLO ZOOM PER CHIAVE
      * ALTERNATA
           call "C$JUSTIFY" using des-ragsoc-1, "L".
      
           start destini     key >= K1
                 invalid     continue
                 not invalid read destini next 
           end-start.   
           set cli-tipo-c to true.
      
           move "clienti-des-alf" to como-file.
           call "zoom-gt" using   como-file, des-rec
                          giving  stato-zoom.
           cancel "zoom-gt".
           if stato-zoom = 0
              move des-prog       to codice-ed
              move codice-ed      to ef-des-buf   
              call "C$JUSTIFY" using ef-des-buf, "L"
              display ef-des
           end-if.

           set errori         to true.
           move 78-ID-ef-des  to control-id 
           .
      * <TOTEM:END>

       SELEZIONA-NUMERICO.
      * <TOTEM:PARA. SELEZIONA-NUMERICO>
           set tutto-ok to true.
           move spaces to lab-cli-buf.
           move spaces to lab-ind-buf.
           move spaces to lab-loca-buf.

           inquire ef-cli, value in cli-codice.
           if cli-codice not > 0
              set errori to true
              display message box msg-codice-obbligatorio
                      title tit-err
                      icon  MB-WARNING-ICON
           else          
              set cli-tipo-c to true
              read clienti no lock
                   invalid
                   display message box "Codice cliente NON valido"
                           title = tit-err
                           icon 2
                   set errori to true
              end-read
           end-if  
           .
      * <TOTEM:END>

       SELEZIONA-RIGA.
      * <TOTEM:PARA. SELEZIONA-RIGA>
           inquire gd-fatt, last-row in tot-righe.
           move event-data-2 to riga.

           if riga >= 2        and 
              riga <= tot-righe                                  
              inquire gd-fatt(riga, 1), hidden-data in hidden-sel
              inquire gd-fatt(riga, 5),   cell-data in rno-prz-unitario
              if hidden-sel = 1
                 move 0 to hidden-sel
                 modify gd-fatt(riga), row-color = 516
              else                   
                 move 1 to hidden-sel
                 modify gd-fatt(riga), row-color = 176
              end-if
              modify gd-fatt(riga, 1), hidden-data = hidden-sel
           end-if 
           .
      * <TOTEM:END>

       SETTA-VIRGOLA.
      * <TOTEM:PARA. SETTA-VIRGOLA>
           if KeyboardReleased
              set KeyboardSaved to true
      *       sostituisco il punto come virgola
              set environment "KEYSTROKE" to "DATA=44 46"
           end-if 
           .
      * <TOTEM:END>

       SPOSTAMENTO.
      * <TOTEM:PARA. SPOSTAMENTO>
           set tutto-ok to true.
           inquire form1-gd-1, last-row in tot-righe.
           move event-data-2 to riga.

           if riga < 2 move 2 to riga end-if.

           if riga > tot-righe
              if riga-nuova = 0
                 move tot-righe to riga
              else
                 move Link-TipoNota to tca-codice
                 read tcaumag no lock invalid continue end-read
                 evaluate true
                 when tca-tipo-nota-abbuono
                      move 78-ID-ef-descr to control-id
                 when other
                      move 78-ID-ef-art   to control-id
                 end-evaluate
                 move 4            to accept-control
                 set errori to true
              end-if
           else
              if riga-nuova = 1
                 move 0 to riga-nuova
                 modify form1-gd-1,  record-to-delete = tot-righe + 1
                 subtract 1 from LastPrg
              end-if
           end-if.

           modify form1-gd-1, start-y = riga, start-x =  2,
                                    y = riga,       x = 12,
                         region-color = 144.

           if tutto-ok
              perform ROW-TO-ENTRY
           end-if.
           set event-action   to event-action-terminate.
           modify form1-gd-1, cursor-y = riga 
           .
      * <TOTEM:END>

       SPOSTAMENTO-GD-FATT.
      * <TOTEM:PARA. SPOSTAMENTO-GD-FATT>
           inquire gd-fatt, last-row in tot-righe.
           move event-data-2 to riga 
           .
      * <TOTEM:END>

       STATUS-HELP.
      * <TOTEM:PARA. STATUS-HELP>
           if StatusHelp = 1
              modify Form1-St-1-Handle, 
                     panel-index = 2, 
                     panel-text "F8 HELP record presenti"
              move BitmapZoomEnabled to BitmapNumZoom
           else
              modify Form1-St-1-Handle, 
                     panel-index = 2, 
                     panel-text spaces
              move BitmapZoomDisabled to BitmapNumZoom
           end-if.

           move StatusHelp    to e-cerca.
           modify tool-cerca, enabled = e-cerca.
           modify tool-cerca, bitmap-number = BitmapNumZoom 
           .
      * <TOTEM:END>

       TROVA-DESTINO.
      * <TOTEM:PARA. TROVA-DESTINO>
           set trovato to false.
           inquire ef-cli, value in ef-cli-buf.
           move ef-cli-buf to des-codice convert.
           move ef-cli-buf to cli-codice convert.

           move low-value  to des-prog.
           start destini  key is >= des-chiave
                 invalid  continue
             not invalid  read destini next
                 if des-codice = cli-codice 
                    set trovato to true 
                 else 
                    move ef-cli-buf to des-codice convert
                    move ef-des-buf to des-prog   convert
                 end-if
           end-start.

           if not trovato initialize des-rec end-if 
           .
      * <TOTEM:END>

       VALORIZZA-ARRAY-CAUSALI.
      * <TOTEM:PARA. VALORIZZA-ARRAY-CAUSALI>
           move Link-TipoNota to tca-codice.
           read tcaumag no lock invalid continue end-read.
           evaluate true
           when tca-tipo-nota-reso
                |direttamente sulla giacenza x' rappresenta
                |un rientro delle merci in magazzino
                move "1000000000000010" to link-array
           end-evaluate 
           .
      * <TOTEM:END>

       VALORIZZA-NUMERO.
      * <TOTEM:PARA. VALORIZZA-NUMERO>
           initialize link-nambar.
           move lab-anno-NC-buf to link-anno.

           set  link-notacr   to true.
           set  link-crea     to true.
           move Link-TipoNota to link-nambar-causale.

           call   "nambar" using link-nambar.
           cancel "nambar".
           
           if link-status-nambar = -1 set errori       to true
           else                       move link-numero to tno-numero
           end-if 
           .
      * <TOTEM:END>

       VALORIZZA-OLD.
      * <TOTEM:PARA. VALORIZZA-OLD>
           move tno-rec to old-tno-rec 
           .
      * <TOTEM:END>

       VALORIZZA-SCREEN.
      * <TOTEM:PARA. VALORIZZA-SCREEN>
           |I dati btno da tor sono già stati valorizzati in LEGGI-TESTATA
           move tor-data-fattura to como-data.
           perform DATE-TO-SCREEN.

           if LinkNumero not = 0 
              move LinkNumero to lab-num-buf
              move como-data  to lab-data-buf

              move btno-data-fatt to como-data
              perform DATE-TO-SCREEN
              move como-data      to lab-data-f-buf

              move btno-num-fatt  to lab-num-f-buf

              move btno-data-ingresso  to como-data
              perform DATE-TO-SCREEN
              move como-data to ef-data-ingresso-buf

           end-if.        

           move esercizio       to lab-anno-nc-buf.

           move data-oggi       to como-data.
           perform DATE-TO-SCREEN.
           move como-data       to lab-data-nc-buf. 

           move tor-cod-cli     to codice-ed.
           move codice-ed       to ef-cli-buf.
           call "C$JUSTIFY"  using ef-cli-buf, "L".

           move tor-prg-destino to codice-ed.
           move codice-ed       to ef-des-buf.
           call "C$JUSTIFY"  using ef-des-buf, "L".

           move tor-cod-agente  to ef-age-buf.
           move tor-cod-ese-iva to ef-iva-ese-buf.

           move cli-ragsoc-1    to lab-cli-buf.
           move cli-indirizzo   to lab-ind-buf.
           move cli-localita    to lab-loca-buf.

           move des-ragsoc-1    to lab-des-buf.
           move des-indirizzo   to lab-ind-d-buf.
           move des-localita    to lab-loca-d-buf.

           move age-ragsoc-1    to lab-age-buf.

           perform MOVE-DESCR-PAG.

           perform MOVE-DESCR-IVA.

           perform MOVE-DESCR-PIANO 
           .
      * <TOTEM:END>

      * EVENT PARAGRAPH
       TOOL-SALVA-LinkTo.
      * <TOTEM:PARA. TOOL-SALVA-LinkTo>
           perform SALVA 
           .
      * <TOTEM:END>
       ANTEPRIMA-LinkTo.
      * <TOTEM:PARA. ANTEPRIMA-LinkTo>
           .
      * <TOTEM:END>
       TOOL-MODIFICA-BeforeProcedure.
      * <TOTEM:PARA. TOOL-MODIFICA-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       TOOL-MODIFICA-AfterProcedure.
      * <TOTEM:PARA. TOOL-MODIFICA-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       TOOL-MODIFICA-LinkTo.
      * <TOTEM:PARA. TOOL-MODIFICA-LinkTo>
           .
      * <TOTEM:END>
       STAMPA-LinkTo.
      * <TOTEM:PARA. STAMPA-LinkTo>
           .
      * <TOTEM:END>
       TOOL-CERCA-LinkTo.
      * <TOTEM:PARA. TOOL-CERCA-LinkTo>
           inquire tool-cerca, enabled in e-cerca.
           if e-cerca = 1      perform CERCA end-if 
           .
      * <TOTEM:END>
       Screen1-Ta-1-Ev-Cmd-Tabchanged.
      * <TOTEM:PARA. Screen1-Ta-1-Ev-Cmd-Tabchanged>
           perform CHANGE-TAB 
           .
      * <TOTEM:END>
       ef-cli-BeforeProcedure.
      * <TOTEM:PARA. ef-cli-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           if LinkNumero not = 0
              perform CANCELLA-COLORE
              move 78-ID-ef-des to control-id
              move 4            to accept-control
           end-if 
           .
      * <TOTEM:END>
       ef-des-BeforeProcedure.
      * <TOTEM:PARA. ef-des-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           if LinkNumero not = 0
              perform CANCELLA-COLORE
              move 78-ID-ef-age to control-id
              move 4            to accept-control
           end-if 
           .
      * <TOTEM:END>
       cbo-stato-BeforeProcedure.
      * <TOTEM:PARA. cbo-stato-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       cbo-stato-AfterProcedure.
      * <TOTEM:PARA. cbo-stato-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       notacr-Ev-Before-Program.
      * <TOTEM:PARA. notacr-Ev-Before-Program>
           move LK-BL-PROG-ID    TO COMO-PROG-ID.
           copy resource "conferma.bmp".
           call "W$BITMAP" using wbitmap-load "conferma.bmp",
                          giving conferma-bmp.

           initialize tab-id.
           move 78-ID-ef-cli     to min-id(1).
           move 78-ID-cbo-stato  to max-id(1).
           move 78-ID-form1-gd-1 to min-id(2).
           move 78-ID-ef-iva     to max-id(2).

           move NotaChiave       to LinkChiave.

           accept esercizio-g2 from environment "ESERCIZIO_G2".
           accept esercizio-x  from environment "ESERCIZIO".
           move   esercizio-x  to esercizio 
           .
      * <TOTEM:END>
       notacr-Ev-After-Program.
      * <TOTEM:PARA. notacr-Ev-After-Program>
           SET LK-BL-CANCELLAZIONE TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           call "W$BITMAP" using wbitmap-destroy, conferma-bmp.
           if KeyboardSaved
              set KeyboardReleased to true
              set environment "KEYSTROKE" to "DATA=44 44"
              set environment "KEYSTROKE" to "DATA=46 46"
           end-if 
           .
      * <TOTEM:END>
       ef-age-BeforeProcedure.
      * <TOTEM:PARA. ef-age-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-pag-BeforeProcedure.
      * <TOTEM:PARA. ef-pag-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-iva-BeforeProcedure.
      * <TOTEM:PARA. ef-iva-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           perform BEFORE-CAMPI.
           move 1 to StatusHelp.
           perform STATUS-HELP 
           .
      * <TOTEM:END>
       ef-note-BeforeProcedure.
      * <TOTEM:PARA. ef-note-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           set KeyboardReleased to true.
      *    setto la tastiera originale
           set environment "KEYSTROKE" to "DATA=44 44".
           set environment "KEYSTROKE" to "DATA=46 46" 
           .
      * <TOTEM:END>
       ef-cli-AfterProcedure.
      * <TOTEM:PARA. ef-cli-AfterProcedure>
              INQUIRE ef-cli, VALUE IN tno-cod-cli
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-cli-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-des-AfterProcedure.
      * <TOTEM:PARA. ef-des-AfterProcedure>
              INQUIRE ef-des, VALUE IN tno-prg-destino
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-des-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-age-AfterProcedure.
      * <TOTEM:PARA. ef-age-AfterProcedure>
              INQUIRE ef-age, VALUE IN tno-cod-agente
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-age-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-pag-AfterProcedure.
      * <TOTEM:PARA. ef-pag-AfterProcedure>
              INQUIRE ef-pag, VALUE IN tno-cod-pagamento
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-pag-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-iva-AfterProcedure.
      * <TOTEM:PARA. ef-iva-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO.
           move 0 to StatusHelp.
           perform STATUS-HELP.
           .
      * <TOTEM:END>

       ef-note-AfterProcedure.
      * <TOTEM:PARA. ef-note-AfterProcedure>
              INQUIRE ef-note, VALUE IN tno-note
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-note-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       pb-genera-BeforeProcedure.
      * <TOTEM:PARA. pb-genera-BeforeProcedure>
           modify pb-genera, bitmap-number = 2 
           .
      * <TOTEM:END>
       pb-genera-AfterProcedure.
      * <TOTEM:PARA. pb-genera-AfterProcedure>
           modify pb-genera, bitmap-number = 1 
           .
      * <TOTEM:END>
       pb-genera-LinkTo.
      * <TOTEM:PARA. pb-genera-LinkTo>
           set trovato        to false.
           modify form1-gd-1, reset-grid = 1.
           perform FORM1-GD-1-CONTENT.
           
           modify form1-gd-1, mass-update = 1.
           inquire gd-fatt, last-row in tot-righe.
           move 1 to store-riga.
           move 0 to hid-old-prz.
           move 0 to LastPrg.
           move Link-TipoNota to tca-codice.
           read tcaumag no lock invalid continue end-read.
           perform varying riga from 2 by 1 until riga > tot-righe
              inquire gd-fatt(riga, 1), hidden-data in hidden-sel 
              inquire gd-fatt(riga, 2), hidden-data in HiddenKey  
              inquire gd-fatt(riga, 3), hidden-data in HiddenPeso
              if hidden-sel = 1
                 add 1 to LastPrg
                 move LastPrg to col-riga
                 inquire gd-fatt(riga,  2), cell-data in col-art
                 inquire gd-fatt(riga,  3), cell-data in col-des
                 inquire gd-fatt(riga,  4), cell-data in col-qta
                 inquire gd-fatt(riga,  7), cell-data in col-cons
                 inquire gd-fatt(riga,  8), cell-data in col-cou
                 inquire gd-fatt(riga,  9), cell-data in col-add-pb
                 inquire gd-fatt(riga, 10), cell-data in col-imp
                 inquire gd-fatt(riga, 11), cell-data in col-iva
                 move col-art     to  col-codice
                 move col-des     to  col-descr

                 evaluate true
                 when tca-tipo-nota-reso
                      move col-qta    to  col-quantita
                      move col-imp    to  col-prezzo
                      move col-cons   to  col-consumo
                      move col-cou    to  col-coubat
                      move col-add-pb to col-add
                 when other
LUBEXX                move col-qta  to  col-quantita
                      if LinkBozza
                         move col-imp    to  col-prezzo
                         move col-cons   to  col-consumo
                         move col-cou    to  col-coubat
                         move col-add-pb to col-add
                      else
                         move 0        to  col-prezzo  
                         move 0        to  col-consumo
                         move 0        to  col-coubat
                         move 0        to  col-add
                      end-if
                 end-evaluate

LUBEXX           if ef-iva-ese-buf = spaces
LUBEXX              move col-iva        to col-cod-iva
LUBEXX           else
LUBEXX              move ef-iva-ese-buf to col-cod-iva
LUBEXX           end-if                     

                 modify form1-gd-1(store-riga + 1, 1),
                        cell-data col-riga
                 modify form1-gd-1(store-riga + 1, 2),
                        cell-data col-codice
                 modify form1-gd-1(store-riga + 1, 3),
                        cell-data col-descr
                 modify form1-gd-1(store-riga + 1, 4),
                        cell-data col-quantita
                 modify form1-gd-1(store-riga + 1, 5),
                        cell-data col-prezzo
                 modify form1-gd-1(store-riga + 1, 6),
                        cell-data col-consumo
                 modify form1-gd-1(store-riga + 1, 7),
                        cell-data col-coubat 
                 modify form1-gd-1(store-riga + 1, 8),
                        cell-data col-add
                 modify form1-gd-1(store-riga + 1, 9),
                        cell-data col-cod-iva

                 move col-qta       to  hid-old-qta
                 move col-imp       to  hid-old-prz
                 move col-cons      to  hid-old-consumo
                 move col-cou       to  hid-old-coubat
                 move col-add-pb    to  hid-old-piombo
                 move col-iva       to  hid-old-iva
                 move HiddenUtf     to  hid-peso-utf
                 move HiddenNonUtf  to  hid-peso-non-utf
                 modify form1-gd-1(store-riga + 1, 1),
                        hidden-data = HiddenValori
                 modify form1-gd-1(store-riga + 1, 2),
                        hidden-data = HiddenKey
                  
                 add 1 to store-riga
                 set trovato to true
              end-if
           end-perform.
           modify form1-gd-1, mass-update = 0.

           if trovato
              move 2 to event-data-2
              perform SPOSTAMENTO
           else
              perform INITIALIZE-ENTRY
           end-if 
           .
      * <TOTEM:END>
       gd-fatt-Ev-Msg-Begin-Drag.
      * <TOTEM:PARA. gd-fatt-Ev-Msg-Begin-Drag>
           perform SPOSTAMENTO-GD-FATT 
           .
      * <TOTEM:END>
       gd-fatt-Ev-Msg-Begin-Entry.
      * <TOTEM:PARA. gd-fatt-Ev-Msg-Begin-Entry>
           set event-action to event-action-fail 
           .
      * <TOTEM:END>
       gd-fatt-Ev-Msg-End-Drag.
      * <TOTEM:PARA. gd-fatt-Ev-Msg-End-Drag>
           perform SPOSTAMENTO-GD-FATT 
           .
      * <TOTEM:END>
       gd-fatt-Ev-Msg-Goto-Cell.
      * <TOTEM:PARA. gd-fatt-Ev-Msg-Goto-Cell>
           perform SPOSTAMENTO-GD-FATT 
           .
      * <TOTEM:END>
       gd-fatt-Ev-Msg-Goto-Cell-Drag.
      * <TOTEM:PARA. gd-fatt-Ev-Msg-Goto-Cell-Drag>
           perform SPOSTAMENTO-GD-FATT 
           .
      * <TOTEM:END>
       gd-fatt-Ev-Msg-Goto-Cell-Mouse.
      * <TOTEM:PARA. gd-fatt-Ev-Msg-Goto-Cell-Mouse>
           perform SELEZIONA-RIGA 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-Begin-Drag.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-Begin-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-Begin-Entry.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-Begin-Entry>
           set event-action to event-action-fail 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-Goto-Cell.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-Goto-Cell>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-Goto-Cell-Drag.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-Goto-Cell-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-End-Drag.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-End-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-Goto-Cell-Mouse.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-Goto-Cell-Mouse>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       ef-qta-NCPZ-BeforeProcedure.
      * <TOTEM:PARA. ef-qta-NCPZ-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           perform BEFORE-CAMPI 
           .
      * <TOTEM:END>
       ef-prz-NCPZ-BeforeProcedure.
      * <TOTEM:PARA. ef-prz-NCPZ-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           perform BEFORE-CAMPI.
           perform SETTA-VIRGOLA 
           .
      * <TOTEM:END>
       ef-iva-NCPZ-BeforeProcedure.
      * <TOTEM:PARA. ef-iva-NCPZ-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           perform BEFORE-CAMPI.
           move 1 to StatusHelp.
           perform STATUS-HELP 
           .
      * <TOTEM:END>
       ef-qta-NCRE-BeforeProcedure.
      * <TOTEM:PARA. ef-qta-NCRE-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           perform BEFORE-CAMPI 
           .
      * <TOTEM:END>
       ef-descr-BeforeProcedure.
      * <TOTEM:PARA. ef-descr-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-prz-NCNC-BeforeProcedure.
      * <TOTEM:PARA. ef-prz-NCNC-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           perform SETTA-VIRGOLA 
           .
      * <TOTEM:END>
       ef-iva-NCNC-BeforeProcedure.
      * <TOTEM:PARA. ef-iva-NCNC-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           move 1 to StatusHelp.
           perform STATUS-HELP.
           perform BEFORE-CAMPI 
           .
      * <TOTEM:END>
       ef-qta-NCPZ-AfterProcedure.
      * <TOTEM:PARA. ef-qta-NCPZ-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO 
           .
      * <TOTEM:END>
       ef-prz-NCPZ-AfterProcedure.
      * <TOTEM:PARA. ef-prz-NCPZ-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO.
           perform RESETTA-VIRGOLA 
           .
      * <TOTEM:END>
       ef-iva-NCPZ-AfterProcedure.
      * <TOTEM:PARA. ef-iva-NCPZ-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO.                               
           move 0 to StatusHelp.
           perform STATUS-HELP 
           .
      * <TOTEM:END>
       ef-qta-NCRE-AfterProcedure.
      * <TOTEM:PARA. ef-qta-NCRE-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO 
           .
      * <TOTEM:END>
       ef-descr-AfterProcedure.
      * <TOTEM:PARA. ef-descr-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO 
           .
      * <TOTEM:END>
       ef-prz-NCNC-AfterProcedure.
      * <TOTEM:PARA. ef-prz-NCNC-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO.
           perform RESETTA-VIRGOLA 
           .
      * <TOTEM:END>
       ef-iva-NCNC-AfterProcedure.
      * <TOTEM:PARA. ef-iva-NCNC-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO.
           move 0 to StatusHelp.
           perform STATUS-HELP 
           .
      * <TOTEM:END>
       pb-sel-tutto-LinkTo.
      * <TOTEM:PARA. pb-sel-tutto-LinkTo>
           inquire gd-fatt, last-row in tot-righe.
           perform varying riga from 2 by 1 
                     until riga > tot-righe
              move riga to event-data-2
              move 0 to hidden-sel
              modify gd-fatt(riga, 1), hidden-data = hidden-sel 
              perform SELEZIONA-RIGA
           end-perform 
              
           .
      * <TOTEM:END>
       pb-sel-tutto-BeforeProcedure.
      * <TOTEM:PARA. pb-sel-tutto-BeforeProcedure>
           modify pb-sel-tutto, bitmap-number = 2 
           .
      * <TOTEM:END>
       pb-sel-tutto-AfterProcedure.
      * <TOTEM:PARA. pb-sel-tutto-AfterProcedure>
           modify pb-sel-tutto, bitmap-number = 1 
           .
      * <TOTEM:END>
       pb-nuovo-0-BeforeProcedure.
      * <TOTEM:PARA. pb-nuovo-0-BeforeProcedure>
           modify pb-nuovo-0, bitmap-number = 2 
           .
      * <TOTEM:END>
       pb-nuovo-0-AfterProcedure.
      * <TOTEM:PARA. pb-nuovo-0-AfterProcedure>
           modify pb-nuovo-0, bitmap-number = 5 
           .
      * <TOTEM:END>
       pb-nuovo-0-LinkTo.
      * <TOTEM:PARA. pb-nuovo-0-LinkTo>
           if riga-nuova = 0
              perform INSERISCI-RIGA
              initialize HiddenKey
                         HiddenValori replacing numeric data by zeroes
                                           alphanumeric data by spaces
              move spaces to ef-art-buf
              move spaces to lab-art-buf
              move 0      to ef-prz-buf
              move 0      to ef-consumo-buf
              move 0      to ef-coubat-buf
              move 0      to ef-add-buf
              move 0      to ef-qta-buf
              move spaces to ef-iva-buf
              display ef-art ef-prz ef-iva ef-consumo 
                      ef-coubat lab-art ef-qta ef-add 
              move riga to event-data-2
              perform SPOSTAMENTO
              perform CANCELLA-COLORE

              move 78-ID-ef-art to control-id
              move 4            to accept-control
              modify pb-nuovo-0, bitmap-number = 5
           end-if 
           .
      * <TOTEM:END>
       pb-elimina-0-BeforeProcedure.
      * <TOTEM:PARA. pb-elimina-0-BeforeProcedure>
           modify pb-elimina-0, bitmap-number = 1 
           .
      * <TOTEM:END>
       pb-elimina-0-AfterProcedure.
      * <TOTEM:PARA. pb-elimina-0-AfterProcedure>
           modify pb-elimina-0, bitmap-number = 4 
           .
      * <TOTEM:END>
       pb-elimina-0-LinkTo.
      * <TOTEM:PARA. pb-elimina-0-LinkTo>
           perform CANCELLA-RIGA 
           .
      * <TOTEM:END>
       ef-art-BeforeProcedure.
      * <TOTEM:PARA. ef-art-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           move 1 to StatusHelp.
           perform STATUS-HELP 
           .
      * <TOTEM:END>
       ef-qta-BeforeProcedure.
      * <TOTEM:PARA. ef-qta-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           perform BEFORE-CAMPI 
           .
      * <TOTEM:END>
       ef-prz-BeforeProcedure.
      * <TOTEM:PARA. ef-prz-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           perform BEFORE-CAMPI.
           perform SETTA-VIRGOLA 
           .
      * <TOTEM:END>
       ef-art-AfterProcedure.
      * <TOTEM:PARA. ef-art-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO.
           move 0 to StatusHelp.
           perform STATUS-HELP 
           .
      * <TOTEM:END>
       ef-qta-AfterProcedure.
      * <TOTEM:PARA. ef-qta-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO 
           .
      * <TOTEM:END>
       ef-prz-AfterProcedure.
      * <TOTEM:PARA. ef-prz-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO.
           perform RESETTA-VIRGOLA 
           .
      * <TOTEM:END>
       pb-nuovo-ncnc-BeforeProcedure.
      * <TOTEM:PARA. pb-nuovo-ncnc-BeforeProcedure>
           modify pb-nuovo-ncnc, bitmap-number = 2 
           .
      * <TOTEM:END>
       pb-nuovo-ncnc-AfterProcedure.
      * <TOTEM:PARA. pb-nuovo-ncnc-AfterProcedure>
           modify pb-nuovo-ncnc, bitmap-number = 5 
           .
      * <TOTEM:END>
       pb-nuovo-ncnc-LinkTo.
      * <TOTEM:PARA. pb-nuovo-ncnc-LinkTo>
           if riga-nuova = 0
              perform INSERISCI-RIGA
              initialize HiddenKey
                         HiddenValori replacing numeric data by zeroes
                                           alphanumeric data by spaces
              move spaces to ef-descr-buf
              move 0      to ef-prz-NCNC-buf ef-art-buf
              move 0      to ef-consumo-NCNC-buf
              move 0      to ef-coubat-NCNC-buf
              move 0      to ef-add-NCNC-buf
              move spaces to ef-iva-NCNC-buf
              display     ef-descr 
                          ef-prz-NCNC 
                          ef-iva-NCNC ef-art-NCNC
                      ef-consumo-NCNC 
                       ef-coubat-NCNC
                       ef-add-NCNC
              move riga to event-data-2
              perform SPOSTAMENTO
              perform CANCELLA-COLORE
              move 78-ID-ef-descr to control-id
              move 4              to accept-control
              modify pb-nuovo-ncnc, bitmap-number = 5
           end-if 
           .
      * <TOTEM:END>
       pb-elimina-ncnc-BeforeProcedure.
      * <TOTEM:PARA. pb-elimina-ncnc-BeforeProcedure>
           modify pb-elimina-ncnc, bitmap-number = 1 
           .
      * <TOTEM:END>
       pb-elimina-ncnc-AfterProcedure.
      * <TOTEM:PARA. pb-elimina-ncnc-AfterProcedure>
           modify pb-elimina-ncnc, bitmap-number = 4 
           .
      * <TOTEM:END>
       pb-elimina-ncnc-LinkTo.
      * <TOTEM:PARA. pb-elimina-ncnc-LinkTo>
           perform CANCELLA-RIGA 
           .
      * <TOTEM:END>
       ef-iva-ese-BeforeProcedure.
      * <TOTEM:PARA. ef-iva-ese-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-iva-ese-AfterProcedure.
      * <TOTEM:PARA. ef-iva-ese-AfterProcedure>
              INQUIRE ef-iva-ese, VALUE IN tno-cod-ese-iva
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-iva-ese-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-coubat-BeforeProcedure.
      * <TOTEM:PARA. ef-coubat-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           perform BEFORE-CAMPI.             
           perform SETTA-VIRGOLA 
           .
      * <TOTEM:END>
       ef-coubat-AfterProcedure.
      * <TOTEM:PARA. ef-coubat-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO.
           perform RESETTA-VIRGOLA 
           .
      * <TOTEM:END>
       ef-consumo-BeforeProcedure.
      * <TOTEM:PARA. ef-consumo-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           perform SETTA-VIRGOLA 
           .
      * <TOTEM:END>
       ef-consumo-AfterProcedure.
      * <TOTEM:PARA. ef-consumo-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO.
           perform RESETTA-VIRGOLA 
           .
      * <TOTEM:END>
       ef-coubat-NCNC-BeforeProcedure.
      * <TOTEM:PARA. ef-coubat-NCNC-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           perform SETTA-VIRGOLA 
           .
      * <TOTEM:END>
       ef-coubat-NCNC-AfterProcedure.
      * <TOTEM:PARA. ef-coubat-NCNC-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform RESETTA-VIRGOLA 
           .
      * <TOTEM:END>
       ef-consumo-NCNC-BeforeProcedure.
      * <TOTEM:PARA. ef-consumo-NCNC-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           perform SETTA-VIRGOLA 
           .
      * <TOTEM:END>
       ef-consumo-NCNC-AfterProcedure.
      * <TOTEM:PARA. ef-consumo-NCNC-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform RESETTA-VIRGOLA 
           .
      * <TOTEM:END>
       ef-coubat-NCPZ-BeforeProcedure.
      * <TOTEM:PARA. ef-coubat-NCPZ-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           perform BEFORE-CAMPI.
           perform SETTA-VIRGOLA 
           .
      * <TOTEM:END>
       ef-coubat-NCPZ-AfterProcedure.
      * <TOTEM:PARA. ef-coubat-NCPZ-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO.
           perform RESETTA-VIRGOLA 
           .
      * <TOTEM:END>
       ef-consumo-NCPZ-AfterProcedure.
      * <TOTEM:PARA. ef-consumo-NCPZ-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO.
           perform RESETTA-VIRGOLA 
           .
      * <TOTEM:END>
       ef-consumo-NCPZ-BeforeProcedure.
      * <TOTEM:PARA. ef-consumo-NCPZ-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           perform BEFORE-CAMPI.
           perform SETTA-VIRGOLA 
           .
      * <TOTEM:END>
       Screen1-DaEf-1-BeforeProcedure.
      * <TOTEM:PARA. Screen1-DaEf-1-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       Screen1-DaEf-1-AfterProcedure.
      * <TOTEM:PARA. Screen1-DaEf-1-AfterProcedure>
              INQUIRE ef-piano, VALUE IN tno-contropartita
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-piano-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
              INQUIRE ef-data-ingresso, VALUE IN tno-data-ingresso
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-data-ingresso-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
              INQUIRE ef-bolla-num, VALUE IN tno-bolla-from-numero
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-bolla-num-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       form1-gd-1-BeforeProcedure.
      * <TOTEM:PARA. form1-gd-1-BeforeProcedure>
           inquire form1-gd-1, last-row in tot-righe.
           if tot-righe = 1
              move 78-ID-gd-fatt to control-id
              move 4             to accept-control
           end-if 
           .
      * <TOTEM:END>
       ef-add-AfterProcedure.
      * <TOTEM:PARA. ef-add-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO.
           perform RESETTA-VIRGOLA 
           .
      * <TOTEM:END>
       ef-add-BeforeProcedure.
      * <TOTEM:PARA. ef-add-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           perform BEFORE-CAMPI.             
           perform SETTA-VIRGOLA 
           .
      * <TOTEM:END>
       ef-add-NCNC-BeforeProcedure.
      * <TOTEM:PARA. ef-add-NCNC-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           perform SETTA-VIRGOLA 
           .
      * <TOTEM:END>
       ef-add-NCNC-AfterProcedure.
      * <TOTEM:PARA. ef-add-NCNC-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform RESETTA-VIRGOLA 
           .
      * <TOTEM:END>
       ef-add-NCPZ-BeforeProcedure.
      * <TOTEM:PARA. ef-add-NCPZ-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           perform BEFORE-CAMPI.
           perform SETTA-VIRGOLA 
           .
      * <TOTEM:END>
       ef-add-NCPZ-AfterProcedure.
      * <TOTEM:PARA. ef-add-NCPZ-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO.
           perform RESETTA-VIRGOLA 
           .
      * <TOTEM:END>
       ef-art-ncnc-BeforeProcedure.
      * <TOTEM:PARA. ef-art-ncnc-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       pb-art-ncnc-LinkTo.
      * <TOTEM:PARA. pb-art-ncnc-LinkTo>
           move   "articoli-all" to     como-file.
           call   "zoom-gt"  using  como-file, art-rec of articoli
                             giving stato-zoom.
           cancel "zoom-gt".
      
           if stato-zoom = 0 
              initialize ef-descr-buf
              move art-codice        to art-codice-x
              call "C$JUSTIFY" using art-codice-x, "R"
              inspect art-codice-x replacing leading x"30" by x"20"
              call "C$JUSTIFY" using art-codice-x, "L"
              inspect art-codice-x replacing trailing spaces by 
           low-value
              string  art-codice-x    delimited low-value
                      " "             delimited size
                      art-descrizione delimited size
                      into ef-descr-buf
              end-string
              display ef-descr
           end-if 
           .
      * <TOTEM:END>
       ef-art-ncnc-AfterProcedure.
      * <TOTEM:PARA. ef-art-ncnc-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           inquire ef-art-ncnc, value in art-codice.
           if art-codice not = 0
              read articoli no lock
                   invalid 
                   move spaces to art-descrizione 
                   move 0 to art-codice
                   display message "Articolo non valido"
                             title tit-err
                              icon 2
                   move 4 to accept-control
              end-read
              initialize ef-descr-buf
              move art-codice        to art-codice-x
              call "C$JUSTIFY" using art-codice-x, "R"
              inspect art-codice-x replacing leading x"30" by x"20"
              call "C$JUSTIFY" using art-codice-x, "L"
              inspect art-codice-x replacing trailing spaces by 
           low-value
              string  art-codice-x    delimited low-value
                      " "             delimited size
                      art-descrizione delimited size
                      into ef-descr-buf
              end-string
              display ef-descr
           end-if 
           .
      * <TOTEM:END>
       Screen1-DaEf-2-BeforeProcedure.
      * <TOTEM:PARA. Screen1-DaEf-2-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       Screen1-DaEf-2-AfterProcedure.
      * <TOTEM:PARA. Screen1-DaEf-2-AfterProcedure>
              INQUIRE ef-bolla-data, VALUE IN tno-bolla-from-data
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-bolla-data-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       Screen1-DaEf-3-BeforeProcedure.
      * <TOTEM:PARA. Screen1-DaEf-3-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       Screen1-DaEf-3-AfterProcedure.
      * <TOTEM:PARA. Screen1-DaEf-3-AfterProcedure>
              INQUIRE ef-fatt-num, VALUE IN tno-fattura-from-numero
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-fatt-num-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       Screen1-DaEf-4-BeforeProcedure.
      * <TOTEM:PARA. Screen1-DaEf-4-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       Screen1-DaEf-4-AfterProcedure.
      * <TOTEM:PARA. Screen1-DaEf-4-AfterProcedure>
              INQUIRE ef-fatt-data, VALUE IN tno-fattura-from-data
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-fatt-data-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>


      *{TOTEM}END

      *{TOTEM}SHOW-MSG
       MESSAGE-FOR-FILEERROR.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
              MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           .

       SHOW-TRANSACTION-ROUTINE.
           IF TOTEM-TRANSACTION-FLAG = SPACES
              IF TRANSACTION-STATUS NOT = 0
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-1
              END-IF
           ELSE
              PERFORM SHOW-MSG-ROUTINE
              IF TRANSACTION-STATUS = 0
                 MOVE "Transazione terminata con Rollback." TO 
           TOTEM-MSG-3
              ELSE
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-3
              END-IF
           END-IF
           .

       SHOW-MSG-ROUTINE.
           MOVE SPACE TO TOTEM-MSG-1 TOTEM-MSG-2 TOTEM-MSG-3
           EVALUATE TOTEM-MSG-ID
               WHEN "10"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Nessun altro dato." TO TOTEM-MSG-2
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "22"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Chiave Duplicata." TO TOTEM-MSG-2
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "23"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Raggiunta fine file." TO TOTEM-MSG-2
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "101"
                    MOVE "Terminare l'applicazione?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "201"
                    MOVE "Aggiungere un nuovo record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "202"
                    MOVE "Aggiornare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "203"
                    MOVE "Cancellare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "204"
                    MOVE "Chiave duplicata." TO TOTEM-MSG-1
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "301"
                    MOVE "Inserimento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "302"
                    MOVE "Aggiornamento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "303"
                    MOVE "Cancellazione avvenuta con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "401"
                    MOVE "Shell non trovata." TO TOTEM-MSG-1
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN OTHER
                    MOVE TEXT-MESSAGE TO TOTEM-MSG-1
                    STRING "FILE:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-3
                    MOVE 0 TO TOTEM-IDX1
                    INSPECT TOTEM-MSG-3 TALLYING TOTEM-IDX1
                       FOR TRAILING SPACE
                    STRING TOTEM-MSG-3(1:TOTEM-MSG-LENGTH - 
           TOTEM-IDX1), 
                       ", FILE STATUS ", PRIMARY-ERROR "," 
                       SECONDARY-ERROR
                    DELIMITED BY SIZE INTO TOTEM-MSG-2
                    MOVE SPACES TO TOTEM-MSG-3
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
           END-EVALUATE
           PERFORM MESSAGE-BOX-ROUTINE
           .

       MESSAGE-BOX-ROUTINE.
           MOVE 1 TO TOTEM-MSG-TEXT-POINTER
           IF TOTEM-MSG-1 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-1 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              STRING TOTEM-MSG-1( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                 DELIMITED BY SIZE
                 INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-2 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-2 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-2( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-3 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-3 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-3( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-TEXT-POINTER = 1
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-TEXT TALLYING TOTEM-MSG-SIZE FOR 
           TRAILING SPACE
                  COMPUTE TOTEM-MSG-TEXT-POINTER = 
           TOTEM-MSG-FULL-LENGTH - TOTEM-MSG-SIZE + 1
           END-IF
           MOVE LOW-VALUES TO TOTEM-MSG-TEXT(TOTEM-MSG-TEXT-POINTER : 1 
           )
           .

       MESSAGE-BOX-DISPLAY.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

      *{TOTEM}END

