      *{TOTEM}PRG-COMMENT
      * ttipocli.Cbl
      * ttipocli.Cbl is generated by TOTEM
      * This is a generated file. DO NOT modify this file directly.
      *{TOTEM}END
       IDENTIFICATION       DIVISION.
      *{TOTEM}PRGID
       PROGRAM-ID.          ttipocli.
       AUTHOR.              Utente.
       DATE-WRITTEN.        giovedì 8 aprile 2021 10:16:56.
       REMARKS.
      *{TOTEM}END

       ENVIRONMENT          DIVISION.
       CONFIGURATION        SECTION.
       SPECIAL-NAMES.
      *{TOTEM}SPECIAL-NAME
      * <TOTEM:EPT. INIT:ttipocli, INIT:ttipocli, SpecialName>
      * <TOTEM:END>
      *{TOTEM}END
      *{TOTEM}ACTIVEX-DEF
      *{TOTEM}END
      *{TOTEM}DECIMAL-POINT
           DECIMAL-POINT IS COMMA.
      *{TOTEM}END

       INPUT-OUTPUT         SECTION.
       FILE-CONTROL.
      *{TOTEM}FILE-CONTROL
           COPY "ttipocli.sl".
      *{TOTEM}END
       DATA                 DIVISION.
       FILE                 SECTION.
      *{TOTEM}FILE
           COPY "ttipocli.fd".
      *{TOTEM}END

       WORKING-STORAGE      SECTION.
      *{TOTEM}ACU-DEF
               COPY "acugui.def".
               COPY "acucobol.def".
               COPY "crtvars.def".
               COPY "opensave.def".
               COPY "showmsg.def".
               COPY "totem.def".
               COPY "standard.def".
      *{TOTEM}END

      *{TOTEM}COPY-WORKING
      * Key Status
       77 Key-Status IS SPECIAL-NAMES CRT STATUS PIC 9(5) VALUE 0.
          88 Enter-Pushed VALUE 13.
          88 Exit-Pushed VALUE 27.
          88 Message-Received VALUE 95.
          88 Event-Occurred VALUE 96.
          88 Screen-No-Input-Field VALUE 97.
      * Properties & User defined Working Stoarge
           COPY  "LINK-G2AGG.DEF".
       77 Form1-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 TIPO-DATA        PIC  9(8)
                  VALUE IS 0.
       77 NOME-STAMPANTE   PIC  X(80).
       77 Form1-Tb-1-Handle
                  USAGE IS HANDLE OF WINDOW.
       78 titolo VALUE IS "Geslux - Tabella Tipologie Clienti". 
       77 E-ESCI           PIC  9
                  VALUE IS 1.
       77 E-NUOVO          PIC  9
                  VALUE IS 1.
       77 E-CANCELLA       PIC  9
                  VALUE IS 1.
       77 E-SALVA          PIC  9
                  VALUE IS 1.
       77 E-ANTEPRIMA      PIC  9
                  VALUE IS 0.
       77 E-MODIFICA       PIC  9
                  VALUE IS 1.
       77 E-STAMPA         PIC  9
                  VALUE IS 0.
       77 E-CERCA          PIC  9
                  VALUE IS 1.
       77 MESSAGGIO        PIC  X(300)
                  VALUE IS SPACE.
       77 SAV-LIVELLO-ABIL PIC  9(2).
       77 CONT PIC  9(2).
       77 NUMERO-STAMPANTI PIC  9(2).
       77 HintGrid         PIC  x(100).
       77 STATUS-USER      PIC  X(2).
           88 Valid-STATUS-USER VALUE IS "00" THRU "09". 
       77 Small-Font
                  USAGE IS HANDLE OF FONT SMALL-FONT.
       77 toolbar-bmp      PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       01 rec-grid.
           05 col-id           PIC  X(2).
           05 col-des          PIC  X(30).
           05 col-agente       PIC  x.
           05 col-gdo          PIC  x.
           05 col-tipo         PIC  x.
           05 col-fido         PIC  x.
           05 col-recupero     PIC  x.
           05 col-gest-plus    PIC  x.
           05 col-piombo       PIC  x.
           05 col-serie-bolle  PIC  9.
           05 col-imp          PIC  x.
           05 col-manuale      PIC  x.
           05 col-bloc         PIC  x.
           05 col-brogliaccio  PIC  x.
           05 col-evasione     PIC  x.
           05 col-st-brogm     PIC  x.
           05 col-fido-nuovo   PIC  x.
           05 col-edi-auto     PIC  x.
       77 Screen1-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 esegui-73x21-bmp PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 cod  PIC  x(2).
       77 des  PIC  x(30).
       77 e-cod            PIC  9
                  VALUE IS 1.
       77 e-des            PIC  9
                  VALUE IS 0.
       77 Default-Font
                  USAGE IS HANDLE OF FONT DEFAULT-FONT.
       77 lab-des2         PIC  x(50).
       01 FILLER           PIC  XX.
           88 ricarica VALUE IS "SI"    WHEN SET TO FALSE  "NO". 
       77 STATUS-ttipocli  PIC  X(2).
           88 Valid-STATUS-ttipocli VALUE IS "00" THRU "09". 
       01 OLD-tcl-rec.
           05 OLD-tcl-chiave.
               10 OLD-tcl-codice   PIC  X(2).
           05 OLD-tcl-dati.
               10 OLD-tcl-descrizione          PIC  X(30).
               10 OLD-tcl-agente   PIC  x.
                   88 OLD-tcl-agente-si VALUE IS "S". 
                   88 OLD-tcl-agente-no VALUE IS "N". 
                   88 OLD-tcl-agente-opz VALUE IS "O". 
               10 OLD-tcl-gdo      PIC  x.
                   88 OLD-tcl-gdo-si VALUE IS "S". 
                   88 OLD-tcl-gdo-no VALUE IS "N". 
                   88 OLD-tcl-gdo-opz VALUE IS "O". 
               10 OLD-tcl-tipologia-tratt-imposte          PIC  x.
                   88 OLD-ttipocli-standard VALUE IS "S". 
                   88 OLD-ttipocli-gdo VALUE IS "G". 
                   88 OLD-ttipocli-estero-EX VALUE IS "E". 
               10 OLD-tcl-gestione-fido        PIC  x.
                   88 OLD-tcl-si-gestione-fido VALUE IS "S". 
                   88 OLD-tcl-no-gestione-fido VALUE IS "N". 
               10 OLD-tcl-dati-comuni.
                   15 OLD-tcl-data-creazione       PIC  9(8).
                   15 OLD-tcl-ora-creazione        PIC  9(8).
                   15 OLD-tcl-utente-creazione     PIC  X(10).
                   15 OLD-tcl-data-ultima-modifica PIC  9(8).
                   15 OLD-tcl-ora-ultima-modifica  PIC  9(8).
                   15 OLD-tcl-utente-ultima-modifica           PIC  
           X(10).
               10 OLD-tcl-vuoti.
                   15 OLD-tcl-recupero-listino     PIC  x.
                       88 OLD-tcl-si-recupero VALUE IS "S". 
                       88 OLD-tcl-no-recupero VALUE IS "N". 
                   15 OLD-tcl-gest-plus            PIC  x.
                       88 OLD-tcl-si-gest-plus VALUE IS "S". 
                       88 OLD-tcl-no-gest-plus VALUE IS "N". 
                   15 OLD-tcl-piombo   PIC  x.
                       88 OLD-tcl-si-piombo VALUE IS "S". 
                       88 OLD-tcl-no-piombo VALUE IS "N". 
                   15 OLD-tcl-serire-bolle         PIC  9.
                   15 OLD-tcl-num-vuoto-1          PIC  9(11).
                   15 OLD-tcl-num-vuoto-2          PIC  9(15).
                   15 OLD-tcl-num-vuoto-3          PIC  9(15).
                   15 OLD-tcl-impegnato            PIC  x.
                       88 OLD-tcl-imp-GDO VALUE IS "G". 
                       88 OLD-tcl-imp-trad VALUE IS "T". 
                   15 OLD-tcl-manuale  PIC  x.
                       88 OLD-tcl-manuale-si VALUE IS "S". 
                       88 OLD-tcl-manuale-no VALUE IS "N". 
                   15 OLD-tcl-bloc-auto            PIC  x(1).
                       88 OLD-tcl-bloc-auto-si VALUE IS "S". 
                       88 OLD-tcl-bloc-auto-no VALUE IS "N". 
                   15 OLD-tcl-brogliaccio          PIC  X(1).
                       88 OLD-tcl-brogliaccio-GDO VALUE IS "G". 
                       88 OLD-tcl-brogliaccio-NORMALE VALUE IS "N". 
                   15 OLD-tcl-evasione PIC  X(1).
                       88 OLD-tcl-evasione-GDO VALUE IS "G". 
                       88 OLD-tcl-evasione-NORMALE VALUE IS "N". 
                       88 OLD-tcl-evasione-ESTERO VALUE IS "E". 
                   15 OLD-tcl-stampa-brogm         PIC  x.
                       88 OLD-tcl-stampa-brogm-si VALUE IS "S". 
                       88 OLD-tcl-stampa-brogm-no VALUE IS "N" " ". 
                   15 OLD-tcl-mail-comm            PIC  x(200).
       78 tipo-std-casa-madre VALUE IS "S". 
       78 tipo-gdo-scorporo VALUE IS "G". 
       78 tipo-estero-no-imp VALUE IS "E". 
       78 tipo-agente VALUE IS "A". 
       77 Form1-St-1-Handle
                  USAGE IS HANDLE OF STATUS-BAR.
       77 cbo-stampante-buf            PIC  x(50).
       77 cbo-stampante-m-buf          PIC  x(100).
       77 AUTO-ID          PIC  9(6)
                  VALUE IS 13.
       77 ef-mail-comm-buf PIC  X(200).
       77 ef-path-pdf-buf  PIC  X(150).
       77 ef-path-sfondo-bolle-buf     PIC  X(150).

      ***********************************************************
      *   Code Gen's Buffer                                     *
      ***********************************************************
       77 STATUS-Form1-FLAG-REFRESH PIC  9.
          88 Form1-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 TMP-Form1-KEY1-ORDER  PIC X VALUE "A".
       77 TMP-Form1-ttipocli-RESTOREBUF  PIC X(889).
       77 TMP-Form1-KEYIS  PIC 9(3) VALUE 1.
       77 Form1-MULKEY-TMPBUF   PIC X(889).
       77 STATUS-SCREEN-SEARCH-FLAG-REFRESH PIC  9.
          88 SCREEN-SEARCH-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 TMP-DataSet1-ttipocli-BUF     PIC X(889).
      * VARIABLES FOR RECORD LENGTH.
       77  TotemFdSlRecordClearOffset   PIC 9(5) COMP-4.
       77  TotemFdSlRecordLength        PIC 9(5) COMP-4.
      * FILE'S LOCK MODE FLAG
       77 DataSet1-ttipocli-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-ttipocli-LOCK  VALUE "Y".
       77 DataSet1-KEYIS   PIC 9(3) VALUE 1.
       77 DataSet1-ttipocli-KEY1-ORDER  PIC X VALUE "A".
          88 DataSet1-ttipocli-KEY1-Asc  VALUE "A".
          88 DataSet1-ttipocli-KEY1-Desc VALUE "D".


           copy "winprint.def".                  
       77 OPENSAVE-STATUS  PIC  S9(2)
                  VALUE IS 0.
      *{TOTEM}END

      *{TOTEM}ID-LOGICI
      ***** Elenco ID Logici *****
       78  78-ID-cbo-stampante VALUE 5001.
       78  78-ID-cbo-stampante-m VALUE 5002.
      ***** Fine ID Logici *****
      *{TOTEM}END

       LINKAGE          SECTION.
      *{TOTEM}LINKAGE
           COPY  "COMMON-LINKAGE.DEF".

      *{TOTEM}END

       SCREEN           SECTION.
      *{TOTEM}COPY-SCREEN
      * FORM
       01 
           Form1, 
           .

      * LABEL
       05
           CST-BLOCKPGM, 
           Label, 
           COL 49,57, 
           LINE 1,00,
           LINES 0,46 ,
           SIZE 14,43 ,
           ID IS 12,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "BlockPgm",
           VISIBLE v-custom,
           .

      * GRID
       05
           form1-gd-1, 
           Grid, 
           COL 2,17, 
           LINE 1,62,
           LINES 37,08 ,
           SIZE 188,17 ,
           ADJUSTABLE-COLUMNS,
           BOXED,
           DATA-COLUMNS (1, 3, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 
           43, 44, 45, 46, 47, 48),
           ALIGNMENT ("L", "L", "C", "C", "C", "C", "C", "C", "C", "C", 
           "C", "C", "C", "C", "C", "C", "C", "C"),
           SEPARATION (5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 
           5, 5),
           DATA-TYPES ("X(2)", "X(30)", "X(1)", "U(1)", "U(1)", "U(1)", 
           "U(1)", "U(1)", "U(1)", "9(1)", "U(1)", "U(1)", "U(1)", "U(1)
      -    "", "U(1)", "U(1)", "U(1)", "U(1)"),
           NUM-COL-HEADINGS 1,
           COLUMN-HEADINGS,
           CURSOR-FRAME-WIDTH 2,
           DIVIDER-COLOR 1,
           FONT IS Small-Font,
           HEADING-COLOR 257,
           HEADING-DIVIDER-COLOR 1,
           HSCROLL,
           ID IS 1,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RECORD-DATA rec-grid,
           TILED-HEADINGS,
           USE-TAB,
           VIRTUAL-WIDTH 185,
           VPADDING 50,
           VSCROLL,
           EVENT PROCEDURE Form1-Gd-1-Event-Proc,
           .

      * LABEL
       05
           Form1-La-1, 
           Label, 
           COL 3,00, 
           LINE 39,62,
           LINES 1,31 ,
           SIZE 22,00 ,
           FONT IS Small-Font,
           ID IS 4,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Stampante bozze associata",
           .

      * COMBO-BOX
       05
           cbo-stampante, 
           Combo-Box, 
           COL 26,67, 
           LINE 39,62,
           LINES 7,00 ,
           SIZE 60,00 ,
           3-D,
           COLOR IS 513,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 78-ID-cbo-stampante,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MASS-UPDATE 0,
           DROP-LIST,
           UNSORTED,
           AFTER PROCEDURE Form1-Cm-1-AfterProcedure, 
           BEFORE PROCEDURE Form1-Cm-1-BeforeProcedure, 
           .
      * COMBO-BOX
       05
           cbo-stampante-m, 
           Combo-Box, 
           COL 112,83, 
           LINE 39,62,
           LINES 7,00 ,
           SIZE 60,00 ,
           3-D,
           COLOR IS 513,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 78-ID-cbo-stampante-m,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MASS-UPDATE 0,
           DROP-LIST,
           UNSORTED,
           AFTER PROCEDURE Form1-Cm-1-AfterProcedure, 
           BEFORE PROCEDURE Form1-Cm-1-BeforeProcedure, 
           .
      * LABEL
       05
           Form1-La-1a, 
           Label, 
           COL 3,00, 
           LINE 42,69,
           LINES 2,08 ,
           SIZE 22,00 ,
           FONT IS Small-Font,
           ID IS 14,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Email commerciale per sostituzione articoli",
           .

      * ENTRY FIELD
       05
           ef-mail-comm, 
           Entry-Field, 
           COL 26,67, 
           LINE 42,69,
           LINES 3,46 ,
           SIZE 144,67 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod,
           ID IS 15,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           VSCROLL-BAR,
           VALUE ef-mail-comm-buf,
           AFTER PROCEDURE Form1-Ef-1-AfterProcedure, 
           BEFORE PROCEDURE Form1-Ef-1-BeforeProcedure, 
           .

      * ENTRY FIELD
       05
           ef-path-sfondo-bolle, 
           Entry-Field, 
           COL 26,67, 
           LINE 47,31,
           LINES 1,54 ,
           SIZE 141,50 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod,
           ID IS 16,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 150,
           VALUE ef-path-sfondo-bolle-buf,
           AFTER PROCEDURE Form1-Ef-1-AfterProcedure, 
           BEFORE PROCEDURE Form1-Ef-1-BeforeProcedure, 
           .

      * LABEL
       05
           Form1-La-1aa, 
           Label, 
           COL 3,00, 
           LINE 47,31,
           LINES 2,08 ,
           SIZE 22,00 ,
           FONT IS Small-Font,
           ID IS 17,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Path PDF bolla",
           .

      * PUSH BUTTON
       05
           pb-path-pdf, 
           Push-Button, 
           COL 169,00, 
           LINE 47,31,
           LINES 1,54 ,
           SIZE 4,50 ,
           ENABLED mod,
           EXCEPTION-VALUE 1000,
           FONT IS Small-Font,
           ID IS 18,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "...",
           .

      * LABEL
       05
           Form1-La-1b, 
           Label, 
           COL 89,17, 
           LINE 39,62,
           LINES 1,31 ,
           SIZE 22,00 ,
           FONT IS Small-Font,
           ID IS 4,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Stampante bozze associata",
           .

      * TOOLBAR
       01
           Form1-Tb-1,
           .    

      * PUSH BUTTON
       05
           TOOL-ESCI, 
           Push-Button, 
           COL 1,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           ENABLED E-ESCI,
           EXCEPTION-VALUE 27,
           FLAT,
           ID IS 2,
           SELF-ACT,
           ESCAPE-BUTTON,
           TITLE "&Esci",
           .

      * PUSH BUTTON
       05
           TOOL-NUOVO, 
           Push-Button, 
           COL 6,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 2,
           UNFRAMED,
           SQUARE,
           ENABLED E-NUOVO,
           EXCEPTION-VALUE 2,
           FLAT,
           ID IS 6,
           SELF-ACT,
           TITLE "Nuovo (F2)",
           .

      * PUSH BUTTON
       05
           TOOL-CANCELLA, 
           Push-Button, 
           COL 16,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           UNFRAMED,
           SQUARE,
           ENABLED E-CANCELLA,
           EXCEPTION-VALUE 4,
           FLAT,
           ID IS 5,
           SELF-ACT,
           TITLE "Cancella (F4)",
           BITMAP-NUMBER BitmapNumDelete
           .

      * PUSH BUTTON
       05
           TOOL-SALVA, 
           Push-Button, 
           COL 11,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           UNFRAMED,
           SQUARE,
           ENABLED E-SALVA,
           EXCEPTION-VALUE 3,
           FLAT,
           ID IS 8,
           SELF-ACT,
           TITLE "Salva (F3)",
           BITMAP-NUMBER BitmapNumSave
           .

      * PUSH BUTTON
       05
           TOOL-ANTEPRIMA, 
           Push-Button, 
           COL 26,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           UNFRAMED,
           SQUARE,
           ENABLED E-ANTEPRIMA,
           EXCEPTION-VALUE 6,
           FLAT,
           ID IS 9,
           SELF-ACT,
           TITLE "Anteprima (F6)",
           BITMAP-NUMBER BitmapNumPreview
           .

      * CHECK BOX
       05
           TOOL-MODIFICA, 
           Check-Box, 
           COL 21,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 5,
           UNFRAMED,
           SQUARE,
           ENABLED E-MODIFICA,
           EXCEPTION-VALUE 1005
           FLAT,
           ID IS 7,
           SELF-ACT,
           TITLE "Modifica (F5)",
           VALUE MOD,
           AFTER PROCEDURE TOOL-MODIFICA-AfterProcedure,
           BEFORE PROCEDURE TOOL-MODIFICA-BeforeProcedure, 
           .
      * PUSH BUTTON
       05
           TOOL-STAMPA, 
           Push-Button, 
           COL 31,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           UNFRAMED,
           SQUARE,
           ENABLED E-STAMPA,
           EXCEPTION-VALUE 7,
           FLAT,
           ID IS 10,
           SELF-ACT,
           TITLE "Stampa (F7)",
           BITMAP-NUMBER BitmapNumPrint
           .

      * PUSH BUTTON
       05
           TOOL-CERCA, 
           Push-Button, 
           COL 36,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           UNFRAMED,
           SQUARE,
           ENABLED E-CERCA,
           EXCEPTION-VALUE 8,
           FLAT,
           ID IS 11,
           SELF-ACT,
           TITLE "Cerca (F8)",
           BITMAP-NUMBER BitmapNumZoom
           .

      * PUSH BUTTON
       05
           tool-CercaTesto, 
           Push-Button, 
           COL 41,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           BITMAP-NUMBER 20,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 1234,
           FLAT,
           FONT IS Small-Font,
           ID IS 3,
           SELF-ACT,
           TITLE "&Ricerca testo (Ctrl + F)",
           .

      * FORM
       01 
           SCREEN-SEARCH, 
           .

      * ENTRY FIELD
       05
           ef-cod, 
           Entry-Field, 
           COL 12,00, 
           LINE 2,00,
           LINES 1,31 ,
           SIZE 3,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED e-cod,
           FONT IS Small-Font,
           ID IS 1,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           LEFT,
           MAX-TEXT 2,
           VALUE cod,
           AFTER PROCEDURE ef-cod-AfterProcedure, 
           BEFORE PROCEDURE ef-cod-BeforeProcedure, 
           .

      * RADIO BUTTON
       05
           rb-cod, 
           Radio-Button, 
           COL 47,00, 
           LINE 2,00,
           LINES 1,31 ,
           SIZE 2,14 ,
           EXCEPTION-VALUE 1000
           FLAT,
           FONT IS Small-Font,
           GROUP 1,
           GROUP-VALUE 1,
           ID IS 5,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Radio Button",
           VALUE tipo-ricerca,
           AFTER PROCEDURE rb-cod-AfterProcedure, 
           BEFORE PROCEDURE rb-cod-BeforeProcedure, 
           .
      * RADIO BUTTON
       05
           rb-des, 
           Radio-Button, 
           COL 47,00, 
           LINE 4,00,
           LINES 1,31 ,
           SIZE 2,14 ,
           EXCEPTION-VALUE 1001
           FLAT,
           FONT IS Small-Font,
           GROUP 1,
           GROUP-VALUE 2,
           ID IS 6,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Radio Button",
           VALUE tipo-ricerca,
           AFTER PROCEDURE rb-des-AfterProcedure, 
           BEFORE PROCEDURE rb-des-BeforeProcedure, 
           .
      * ENTRY FIELD
       05
           ef-des, 
           Entry-Field, 
           COL 12,00, 
           LINE 4,00,
           LINES 1,31 ,
           SIZE 34,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED e-des,
           FONT IS Small-Font,
           ID IS 2,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 30,
           VALUE des,
           AFTER PROCEDURE ef-des-AfterProcedure, 
           BEFORE PROCEDURE ef-des-BeforeProcedure, 
           .

      * PUSH BUTTON
       05
           pb-esegui, 
           Push-Button, 
           COL 34,43, 
           LINE 5,92,
           LINES 21,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE ESEGUI_73X21-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 13,
           FLAT,
           FONT IS Small-Font,
           ID IS 8,
           OK-BUTTON,
           TITLE "E&segue la ricerca del testo imputato",
           .

      * LABEL
       05
           Form2-La-1, 
           Label, 
           COL 1,86, 
           LINE 2,00,
           LINES 1,31 ,
           SIZE 6,14 ,
           FONT IS Small-Font,
           ID IS 3,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Codice",
           .

      * LABEL
       05
           Form2-La-2, 
           Label, 
           COL 1,86, 
           LINE 4,00,
           LINES 1,31 ,
           SIZE 8,43 ,
           FONT IS Small-Font,
           ID IS 4,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Descrizione",
           .

      * LABEL
       05
           Form2-Custom1-1, 
           Label, 
           COL 44,00, 
           LINE 1,15,
           LINES 0,69 ,
           SIZE 5,57 ,
           FONT IS Default-Font,
           ID IS 101,
           TRANSPARENT,
           TITLE "CUSTOM CONTROL",
           VISIBLE v-custom,
           .

      * CHECK BOX
       05
           cb-match, 
           Check-Box, 
           COL 11,71, 
           LINE 5,85,
           LINES 1,31 ,
           SIZE 2,14 ,
           FLAT,
           FONT IS Small-Font,
           ID IS 7,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           LEFT-TEXT,
           TITLE "   &M   ",
           VALUE MatchCase,
           AFTER PROCEDURE cb-match-AfterProcedure,
           BEFORE PROCEDURE cb-match-BeforeProcedure, 
           .
      * LABEL
       05
           Form2-La-3, 
           Label, 
           COL 1,86, 
           LINE 5,92,
           LINES 1,08 ,
           SIZE 9,00 ,
           FONT IS Small-Font,
           ID IS 78,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "&Match case",
           .

      *{TOTEM}END

      *{TOTEM}LINKPARA
       PROCEDURE  DIVISION USING LK-BLOCKPGM, USER-CODI, LIVELLO-ABIL.
      *{TOTEM}END

      *{TOTEM}DECLARATIVE
       DECLARATIVES.
      * <TOTEM:EPT. INIT:ttipocli, INIT:ttipocli, BeforeDeclarative>
       TTIPOCLI-ERR SECTION.
           use after error procedure on ttipocli.
           evaluate status-ttipocli 
           when "35"
                display message "File [TTIPOCLI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TTIPOCLI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TTIPOCLI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           when "93"             
                move 0 to mod
                modify tool-modifica, value = mod  
                set StatusVisua to true
                open input ttipocli
                display message box MSG-Gia-in-uso-su-altro-terminale
                            x"0d0a" MSG-SOLA-VISUA
                        title = tit-err
                        icon is mb-error-icon      
           end-evaluate.

      * <TOTEM:END>
       INPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON INPUT.
       0100-DECL.
           EXIT.
       I-O-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON I-O.
       0200-DECL.
           EXIT.
       OUTPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON OUTPUT.
       0300-DECL.
           EXIT.
       TRANSACTION-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON TRANSACTION.
       0400-DECL.
           EXIT.
       END DECLARATIVES.
      *{TOTEM}END

       MAIN-LOGIC.
      *{TOTEM}ENTRY-BEFPRG
      *    Before-Program
           PERFORM PAS004P-Ev-Before-Program
      *{TOTEM}END
           PERFORM INITIALIZE-ROUTINE.
      * run main screen
      *{TOTEM}RUN-MAINSCR
           PERFORM Form1-OPEN-ROUTINE.
      *{TOTEM}END

      *{TOTEM}COPY-PROCEDURE
       EXIT-STOP-ROUTINE.
           PERFORM CLOSE-FILE-RTN
      * <TOTEM:EPT. INIT:ttipocli, INIT:ttipocli, BeforeDestroyResource>
      * <TOTEM:END>
           CALL "w$bitmap" USING WBITMAP-DESTROY, toolbar-bmp
           CALL "w$bitmap" USING WBITMAP-DESTROY, TOOLBAR-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, ESEGUI_73X21-BMP
      *    After-Program
           PERFORM I-O-BLOCCO
           EXIT PROGRAM TOTEM-PgmStatus
           STOP RUN.

       INITIALIZE-ROUTINE.
      *    Before Init
      * initialize program status variable
           Initialize TOTEM-PgmStatus.
      * get system information
           ACCEPT SYSTEM-INFORMATION FROM SYSTEM-INFO.
      * get terminal information
           ACCEPT TERMINAL-ABILITIES FROM TERMINAL-INFO.
      * set font
           PERFORM INIT-FONT.
      * load bitmap
           PERFORM INIT-BMP.
      * load resource
           PERFORM INIT-RES.
      * create pop-up menu
           PERFORM INIT-POPUP.
      * open files
           PERFORM OPEN-FILE-RTN.
      *    After Init
           .
    
       INIT-FONT.
           .

       INIT-BMP.
      * TOOL-ESCI
           COPY RESOURCE "toolbar.bmp".
           CALL "w$bitmap" USING WBITMAP-LOAD "toolbar.bmp", 
                   GIVING toolbar-bmp.
      * TOOL-ANTEPRIMA
           COPY RESOURCE "TOOLBAR.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "TOOLBAR.BMP", 
                   GIVING TOOLBAR-BMP.
      * pb-esegui
           COPY RESOURCE "ESEGUI_73X21.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "ESEGUI_73X21.BMP", 
                   GIVING ESEGUI_73X21-BMP.
           .

       INIT-RES.
           .

       INIT-POPUP.
           .

       OPEN-FILE-RTN.
      *    Before Open
           PERFORM OPEN-ttipocli
      *    After Open
           .

       OPEN-ttipocli.
      * <TOTEM:EPT. INIT:ttipocli, FD:ttipocli, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O ttipocli
           IF STATUS-ttipocli = "35"
              OPEN OUTPUT ttipocli
                IF Valid-STATUS-ttipocli
                   CLOSE ttipocli
                   OPEN I-O ttipocli
                END-IF
           END-IF
           IF NOT Valid-STATUS-ttipocli
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:ttipocli, FD:ttipocli, AfterOpen>
      * <TOTEM:END>
           .

       CLOSE-FILE-RTN.
      *    Before Close
           PERFORM CLOSE-ttipocli
      *    After Close
           .

       CLOSE-ttipocli.
      * <TOTEM:EPT. INIT:ttipocli, FD:ttipocli, BeforeClose>
      * <TOTEM:END>
           CLOSE ttipocli
           .

       DataSet1-ttipocli-INITSTART.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-ttipocli-KEY1-Asc
                 MOVE Low-Value TO tcl-chiave
              ELSE
                 MOVE High-Value TO tcl-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-ttipocli-INITEND.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-ttipocli-KEY1-Asc
                 MOVE High-Value TO tcl-chiave
              ELSE
                 MOVE Low-Value TO tcl-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           .   

       DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-ttipocli-KEY1-ORDER
           END-EVALUATE
           .

       DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-ttipocli-KEY1-ORDER
           END-EVALUATE
           .

      * ttipocli
       DataSet1-ttipocli-START.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-ttipocli-KEY1-Asc
                 START ttipocli KEY >= tcl-chiave
              ELSE
                 START ttipocli KEY <= tcl-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-ttipocli-START-NOTGREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-ttipocli-KEY1-Asc
                 START ttipocli KEY <= tcl-chiave
              ELSE
                 START ttipocli KEY >= tcl-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-ttipocli-START-GREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-ttipocli-KEY1-Asc
                 START ttipocli KEY > tcl-chiave
              ELSE
                 START ttipocli KEY < tcl-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-ttipocli-START-LESS.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-ttipocli-KEY1-Asc
                 START ttipocli KEY < tcl-chiave
              ELSE
                 START ttipocli KEY > tcl-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-ttipocli-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeReadRecord>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-ttipocli-LOCK
                 READ ttipocli WITH LOCK 
                 KEY tcl-chiave
              ELSE
                 READ ttipocli WITH NO LOCK 
                 KEY tcl-chiave
              END-IF
           END-EVALUATE
           MOVE STATUS-ttipocli TO TOTEM-ERR-STAT 
           MOVE "ttipocli" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-ttipocli-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeReadNext>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-ttipocli-KEY1-Asc
                 IF DataSet1-ttipocli-LOCK
                    READ ttipocli NEXT WITH LOCK
                 ELSE
                    READ ttipocli NEXT WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-ttipocli-LOCK
                    READ ttipocli PREVIOUS WITH LOCK
                 ELSE
                    READ ttipocli PREVIOUS WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           MOVE STATUS-ttipocli TO TOTEM-ERR-STAT
           MOVE "ttipocli" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-ttipocli-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeReadPrev>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-ttipocli-KEY1-Asc
                 IF DataSet1-ttipocli-LOCK
                    READ ttipocli PREVIOUS WITH LOCK
                 ELSE
                    READ ttipocli PREVIOUS WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-ttipocli-LOCK
                    READ ttipocli NEXT WITH LOCK
                 ELSE
                    READ ttipocli NEXT WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           MOVE STATUS-ttipocli TO TOTEM-ERR-STAT
           MOVE "ttipocli" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-ttipocli-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeWrite>
      * <TOTEM:END>
           WRITE tcl-rec OF ttipocli.
           MOVE STATUS-ttipocli TO TOTEM-ERR-STAT
           MOVE "ttipocli" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-ttipocli-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeRewrite>
      * <TOTEM:END>
           REWRITE tcl-rec OF ttipocli.
           MOVE STATUS-ttipocli TO TOTEM-ERR-STAT
           MOVE "ttipocli" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-ttipocli-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeDelete>
      * <TOTEM:END>
           DELETE ttipocli.
           MOVE STATUS-ttipocli TO TOTEM-ERR-STAT
           MOVE "ttipocli" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-INIT-RECORD.
           INITIALIZE tcl-rec OF ttipocli
           .


      * GRID
       form1-gd-1-Content.
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 1, Y = 1,
                CELL-DATA = "Codice",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 2, Y = 1,
                CELL-DATA = "Descrizione",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 3, Y = 1,
                CELL-DATA = "Agente",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 4, Y = 1,
                CELL-DATA = "GDO",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 5, Y = 1,
                CELL-DATA = "Imposta",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 6, Y = 1,
                CELL-DATA = "Gest Fido",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 7, Y = 1,
                CELL-DATA = "Prz. listino",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 8, Y = 1,
                CELL-DATA = "Gest Plus",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 9, Y = 1,
                CELL-DATA = "Add. Pb",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 10, Y = 1,
                CELL-DATA = "Serie Bolle",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 11, Y = 1,
                CELL-DATA = "Impegnato",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 12, Y = 1,
                CELL-DATA = "Manuale",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 13, Y = 1,
                CELL-DATA = "Bloccaggio",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 14, Y = 1,
                CELL-DATA = "Brogliaccio",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 15, Y = 1,
                CELL-DATA = "Evasione",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 16, Y = 1,
                CELL-DATA = "St. brog.",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 17, Y = 1,
                CELL-DATA = "Fido nuovo",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 18, Y = 1,
                CELL-DATA = "EDI auto",
      * COLUMNS' SETTING
              MODIFY form1-gd-1, X = 1  
                COLUMN-FONT = Small-Font,
      * COLUMNS' SETTING
              MODIFY form1-gd-1, X = 2  
                COLUMN-FONT = Small-Font,
           .

      * COMBO-BOX
       cbo-stampante-Content.
           .

      * COMBO-BOX
       cbo-stampante-m-Content.
           .

      * FD's Initialize Paragraph
       DataSet1-ttipocli-INITREC.
           INITIALIZE tcl-rec OF ttipocli
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      *
       DataSet1-DISPATCH-BUFTOFLD.
           EVALUATE TOTEM-Form-Index ALSO TOTEM-Frame-Index
              WHEN 1 ALSO 0
                  PERFORM Form1-Buf-To-Fld
           END-EVALUATE
           .

       Form1-DISPLAY-STATUS-MSG.
           .

       Form1-CLEAR-STATUS-MSG.
           MOVE SPACES TO TOTEM-MSG-1, TOTEM-MSG-2, TOTEM-MSG-3, 
           TOTEM-MSG-TEXT
           PERFORM Form1-DISPLAY-STATUS-MSG
           .

       Form1-Open-Routine.
           PERFORM Form1-Scrn
           PERFORM Form1-Proc
           .

       Form1-Scrn.
           PERFORM Form1-Create-Win
           PERFORM Form1-Init-Value
           PERFORM Form1-Init-Data
      * Tab keystrok settings
      * Tool Bar
           DISPLAY Form1-Tb-1
           PERFORM Form1-DISPLAY
           .

       Form1-Create-Win.
           Display Independent GRAPHICAL WINDOW
              LINES 53,08,
              SIZE 190,83,
              COLOR 65793,
              CONTROL FONT Small-Font,
              LINK TO THREAD,
              NO SCROLL,
              TITLE-BAR,
              TITLE titolo,
              AUTO-MINIMIZE,
              WITH SYSTEM MENU,
              USER-GRAY,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE Form1-Event-Proc,
              HANDLE IS Form1-Handle,
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
           DISPLAY TOOL-BAR 
              LINES 2,69,   
              HANDLE IN Form1-Tb-1-Handle
           DISPLAY Form1-Tb-1 UPON Form1-Tb-1-Handle

      * Status-bar
           DISPLAY STATUS-BAR
              GRIP,
              HANDLE IS Form1-St-1-Handle
           DISPLAY Form1 UPON Form1-Handle
      * DISPLAY-COLUMNS settings
              MODIFY form1-gd-1, DISPLAY-COLUMNS (1, 8, 43, 50, 55, 63, 
           73, 82, 92, 100, 110, 120, 129, 139, 149, 158, 166, 176)
           .

       Form1-PROC.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeAccept>
           perform ABILITA-TOOLBAR.

           perform FORM1-GD-1-CONTENT.
           perform LOAD-RECORD.            
           perform CARICA-STAMPANTI.

           inquire form1-gd-1(2, 1), cell-data in tcl-codice.
           read ttipocli no lock invalid continue end-read.
           move 2  to event-data-2.
           perform SPOSTAMENTO.

           perform INIT.

      * SPECIFICO DEI PGM. CON GRID-CONTROL
           perform ABILITAZIONI.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT Form1
                 ON EXCEPTION
                    PERFORM Form1-Evaluate-Func
                 MOVE 1 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY Form1-Handle
           INITIALIZE Key-Status
           .

       Form1-Evaluate-Func.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterAccept>
      * PER IL BOTTONE MODIFICA
           if key-status = 5
              inquire tool-modifica, enabled in e-modifica
              if e-modifica = 1
                 if mod = 0 move 1 to mod
                 else       move 0 to mod
                 end-if
                 modify tool-modifica, value = mod
                 perform MODIFICA
              end-if
           end-if.

           .
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM Form1-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM Form1-Exit
                 END-IF
              WHEN Key-Status = 1000
                 PERFORM pb-path-pdf-LinkTo
              WHEN Key-Status = 2
                 PERFORM NUOVO-LinkTo
              WHEN Key-Status = 4
                 PERFORM CANCELLA-LinkTo
              WHEN Key-Status = 3
                 PERFORM TOOL-SALVA-LinkTo
              WHEN Key-Status = 6
                 PERFORM ANTEPRIMA-LinkTo
              WHEN Key-Status = 1005
                 PERFORM TOOL-MODIFICA-LinkTo
              WHEN Key-Status = 7
                 PERFORM STAMPA-LinkTo
              WHEN Key-Status = 8
                 PERFORM TOOL-CERCA-LinkTo
              WHEN Key-Status = 1234
                 PERFORM tool-CercaTesto-LinkTo
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       Form1-CLEAR.
           PERFORM Form1-INIT-VALUE
           PERFORM Form1-DISPLAY
           .

       Form1-DISPLAY.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY Form1-Tb-1
           DISPLAY Form1 UPON Form1-Handle
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterDisplay>
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       Form1-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeExit>
           perform SALV-MOD.
           if errori
              move 28 to key-status
              exit paragraph
           end-if.

           .
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       Form1-Init-Data.
           MOVE 1 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
      * GRID
           PERFORM form1-gd-1-Content
      * COMBO-BOX
           PERFORM cbo-stampante-Content
      * COMBO-BOX
           PERFORM cbo-stampante-m-Content
           .

       Form1-DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-ttipocli-KEY1-ORDER
           END-EVALUATE
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-ttipocli-KEY1-ORDER
           END-EVALUATE
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Update-Key.
           MOVE tcl-rec OF ttipocli TO
                     Form1-MULKEY-TMPBUF
           PERFORM Form1-CLEAR
           PERFORM Form1-INIT-DATA
           MOVE Form1-MULKEY-TMPBUF TO
                     tcl-rec OF ttipocli
           PERFORM DataSet1-ttipocli-Read
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-CURR
           PERFORM Form1-IUD-Display
           .

       Form1-DUPLICATE-MOVEKEY.
           .

       Form1-First.
           PERFORM Form1-DUMMY-FIRST
           PERFORM DataSet1-ttipocli-INITSTART
           PERFORM DataSet1-ttipocli-START
           IF NOT Valid-STATUS-ttipocli
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeFirst>
      * <TOTEM:END>
           PERFORM DataSet1-ttipocli-Read-Next
           IF NOT Valid-STATUS-ttipocli
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterFirst>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY.
           PERFORM Form1-IUD-Display
           .

       Form1-Previous.
              PERFORM Form1-Buf-To-Fld
              PERFORM DataSet1-ttipocli-START-LESS
           IF NOT Valid-STATUS-ttipocli
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforePrevious>
      * <TOTEM:END>
           PERFORM DataSet1-ttipocli-Read-Prev
           IF NOT Valid-STATUS-ttipocli
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterPrevious>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-PREVIOUS
           PERFORM Form1-IUD-Display
           .

       Form1-Next.
              PERFORM Form1-Buf-To-Fld
              PERFORM DataSet1-ttipocli-START-GREATER
           IF NOT Valid-STATUS-ttipocli
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeNext>
      * <TOTEM:END>
           PERFORM DataSet1-ttipocli-Read-Next
           IF NOT Valid-STATUS-ttipocli
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterNext>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-NEXT
           PERFORM Form1-IUD-Display
           .
      
       Form1-Last.
           PERFORM Form1-DUMMY-LAST
           PERFORM DataSet1-ttipocli-INITEND
           PERFORM DataSet1-ttipocli-START-NOTGREATER
           IF NOT Valid-STATUS-ttipocli
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeLast>
      * <TOTEM:END>
           PERFORM DataSet1-ttipocli-Read-Prev
           IF NOT Valid-STATUS-ttipocli
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterLast>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY.
           PERFORM Form1-IUD-Display
           .

       Form1-Curr.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeCurrent>
      * <TOTEM:END>
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-ttipocli-Read
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-CURR
           PERFORM Form1-IUD-Display
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterCurrent>
      * <TOTEM:END>
           .

       Form1-IUD-Display.
           IF Valid-STATUS-ttipocli
              PERFORM Form1-ALLGRID-RESET
              PERFORM Form1-Fld-To-Buf
              PERFORM Form1-NAVI-FOR-MASTERGRID
              PERFORM Form1-DISPLAY
           ELSE
              IF Form1-FLAG-REFRESH
                 CONTINUE
              ELSE
                 PERFORM Form1-Extended-File-Status
              END-IF
           END-IF
           .

       Form1-Add.
           PERFORM Form1-Buf-To-Fld
           PERFORM Form1-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM Form1-DUMMY-ADD
           PERFORM DataSet1-ttipocli-INITREC
           PERFORM Form1-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeAdd>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-ttipocli-Rec-Write
           IF Valid-STATUS-ttipocli
              PERFORM Form1-RESUMMARY-INS
              PERFORM Form1-DUMMY-UPDATE-INIT
              MOVE "301" TO TOTEM-MSG-ID
              PERFORM Form1-IUD-Display
           END-IF
           PERFORM Form1-ERR-CHECKING
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterAdd>
      * <TOTEM:END>
           .
     
       Form1-Update.
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-ttipocli-START              
           IF NOT Valid-STATUS-ttipocli
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
           PERFORM DataSet1-ttipocli-Read
           PERFORM Form1-Buf-To-Fld
           PERFORM Form1-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM Form1-DUMMY-UPDATE
           PERFORM Form1-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeUpdate>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-ttipocli-Rec-Rewrite
           IF Valid-STATUS-ttipocli
              PERFORM Form1-RESUMMARY-DEL
              PERFORM Form1-DUMMY-UPDATE-INIT
              MOVE "302" TO TOTEM-MSG-ID
              PERFORM Form1-IUD-Display
           END-IF
           PERFORM Form1-ERR-CHECKING
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterUpdate>
      * <TOTEM:END>
           .

       Form1-Delete.
           MOVE "203" TO TOTEM-MSG-ID
           PERFORM MESSAGE-BOX-DISPLAY
           IF TOTEM-MSG-RETURN-VALUE NOT = 1
              INITIALIZE TOTEM-MSG-TEXT
              EXIT PARAGRAPH 
           END-IF
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDelete>
      * <TOTEM:END>
           PERFORM Form1-DUMMY-DELETE
      * delete
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-ttipocli-Rec-Delete
           IF Valid-STATUS-ttipocli
              PERFORM Form1-CLEAR
              PERFORM Form1-DUMMY-DELETE-INIT
              MOVE "303" TO TOTEM-MSG-ID
              MOVE "00" to STATUS-ttipocli
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterDelete>
      * <TOTEM:END>
           PERFORM Form1-ERR-CHECKING
           .

       Form1-NAVI-FOR-MASTERGRID.
           .

       Form1-ERR-CHECKING.
           IF Valid-STATUS-ttipocli
              PERFORM Form1-SHOW-MSG-ROUTINE
           ELSE
              PERFORM Form1-Extended-File-Status
           END-IF
           .

       Form1-RESUMMARY-INS.
           .

       Form1-RESUMMARY-DEL.
           .


       Form1-DUMMY-FIRST.
           .

       Form1-DUMMY-PREVIOUS.
           .

       Form1-DUMMY-NEXT.
           .

       Form1-DUMMY-LAST.
           .

       Form1-DUMMY-CURR.
           .

       Form1-DUMMY-ADD.
           .

       Form1-DUMMY-UPDATE.
           .

       Form1-DUMMY-UPDATE-INIT.
           .

       Form1-DUMMY-DELETE.
           .

       Form1-DUMMY-DELETE-INIT.
           .

       Form1-Init-Value.
           MOVE titolo TO TOTEM-MSG-TITLE
      * FORM : Form1
           PERFORM DataSet1-INIT-RECORD
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, SetDefault>
      * <TOTEM:END>
           PERFORM Form1-FLD-TO-BUF
           .


       Form1-ALLGRID-RESET.
           .

      * for Form's Validation
       Form1-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       Form1-Buf-To-Fld.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterBufToFld>
      * <TOTEM:END>
           .

       Form1-Fld-To-Buf.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeFldToBuf>
           set SiSalvato to true.

           .
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterFldToBuf>
      * <TOTEM:END>
           .

       Form1-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform Form1-BUF-TO-FLD.
           move 0 to scelta.
           .
       Form1-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM Form1-SHOW-MSG-ROUTINE
           .

       Form1-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM Form1-DISPLAY-MESSAGE
           .

       Form1-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       Form1-Save-Status.
           MOVE DataSet1-ttipocli-KEY1-ORDER TO TMP-Form1-KEY1-ORDER
           MOVE DataSet1-KEYIS TO TMP-Form1-KEYIS
           MOVE tcl-rec OF ttipocli TO 
              TMP-Form1-ttipocli-RESTOREBUF
           .             

       Form1-Restore-Status.
           MOVE TMP-Form1-KEY1-ORDER TO DataSet1-ttipocli-KEY1-ORDER
           MOVE TMP-Form1-KEYIS TO DataSet1-KEYIS
           MOVE TMP-Form1-ttipocli-RESTOREBUF TO
              tcl-rec OF ttipocli
           PERFORM DataSet1-ttipocli-START
           IF Valid-STATUS-ttipocli
              PERFORM DataSet1-ttipocli-Read-Next
           ELSE
              PERFORM DataSet1-ttipocli-INITREC
           END-IF
           PERFORM UNTIL NOT Valid-STATUS-ttipocli OR
              (Valid-STATUS-ttipocli AND
                 tcl-rec OF ttipocli = 
                   TMP-Form1-ttipocli-RESTOREBUF)
              PERFORM DataSet1-ttipocli-Read-Next
           END-PERFORM
           .

       SCREEN-SEARCH-Open-Routine.
           PERFORM SCREEN-SEARCH-Scrn
           PERFORM SCREEN-SEARCH-Proc
           .

       SCREEN-SEARCH-Scrn.
           PERFORM SCREEN-SEARCH-Create-Win
           PERFORM SCREEN-SEARCH-Init-Value
           PERFORM SCREEN-SEARCH-Init-Data
      * Tab keystrok settings
      * Tool Bar
           PERFORM SCREEN-SEARCH-DISPLAY
           .

       SCREEN-SEARCH-Create-Win.
           Display Floating GRAPHICAL WINDOW
              LINES 7,31,
              SIZE 50,00,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 65793,
              LINK TO THREAD,
              NO SCROLL,
              TITLE-BAR,
              TITLE "Ricerca del testo selezionato",
              WITH SYSTEM MENU,
              USER-GRAY,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE Screen1-Event-Proc,
              HANDLE IS Screen1-Handle,
      * <TOTEM:EPT. FORM:SCREEN-SEARCH, FORM:SCREEN-SEARCH, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
      * Status-bar
           DISPLAY SCREEN-SEARCH UPON Screen1-Handle
      * DISPLAY-COLUMNS settings
           .

       SCREEN-SEARCH-PROC.
      * <TOTEM:EPT. FORM:SCREEN-SEARCH, FORM:SCREEN-SEARCH, BeforeAccept>
           set Ricerca to false. 
           move 1 to control-id.
           move 4 to accept-control.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT SCREEN-SEARCH
                 ON EXCEPTION
                    PERFORM SCREEN-SEARCH-Evaluate-Func
                 MOVE 2 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:SCREEN-SEARCH, FORM:SCREEN-SEARCH, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:SCREEN-SEARCH, FORM:SCREEN-SEARCH, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY Screen1-Handle
           INITIALIZE Key-Status
           .

       SCREEN-SEARCH-Evaluate-Func.
      * <TOTEM:EPT. FORM:SCREEN-SEARCH, FORM:SCREEN-SEARCH, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM SCREEN-SEARCH-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM SCREEN-SEARCH-Exit
                 END-IF
              WHEN Key-Status = 1000
                 PERFORM rb-cod-LinkTo
              WHEN Key-Status = 1001
                 PERFORM rb-des-LinkTo
              WHEN Key-Status = 13
                 PERFORM pb-esegui-LinkTo
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       SCREEN-SEARCH-CLEAR.
           PERFORM SCREEN-SEARCH-INIT-VALUE
           PERFORM SCREEN-SEARCH-DISPLAY
           .

       SCREEN-SEARCH-DISPLAY.
      * <TOTEM:EPT. FORM:SCREEN-SEARCH, FORM:SCREEN-SEARCH, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY SCREEN-SEARCH UPON Screen1-Handle
      * <TOTEM:EPT. FORM:SCREEN-SEARCH, FORM:SCREEN-SEARCH, AfterDisplay>
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       SCREEN-SEARCH-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:SCREEN-SEARCH, FORM:SCREEN-SEARCH, BeforeExit>
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       SCREEN-SEARCH-Init-Data.
           MOVE 2 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
           .

       SCREEN-SEARCH-Init-Value.
      * <TOTEM:EPT. FORM:SCREEN-SEARCH, FORM:SCREEN-SEARCH, SetDefault>
      * <TOTEM:END>
           PERFORM SCREEN-SEARCH-FLD-TO-BUF
           .


       SCREEN-SEARCH-ALLGRID-RESET.
           .

      * for Form's Validation
       SCREEN-SEARCH-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       SCREEN-SEARCH-Buf-To-Fld.
      * <TOTEM:EPT. FORM:SCREEN-SEARCH, FORM:SCREEN-SEARCH, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:SCREEN-SEARCH, FORM:SCREEN-SEARCH, AfterBufToFld>
      * <TOTEM:END>
           .

       SCREEN-SEARCH-Fld-To-Buf.
      * <TOTEM:EPT. FORM:SCREEN-SEARCH, FORM:SCREEN-SEARCH, BeforeFldToBuf>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:SCREEN-SEARCH, FORM:SCREEN-SEARCH, AfterFldToBuf>
      * <TOTEM:END>
           .

       SCREEN-SEARCH-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform SCREEN-SEARCH-BUF-TO-FLD.
           move 0 to scelta.
           .
       SCREEN-SEARCH-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM SCREEN-SEARCH-SHOW-MSG-ROUTINE
           .

       SCREEN-SEARCH-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM SCREEN-SEARCH-DISPLAY-MESSAGE
           .

       SCREEN-SEARCH-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       SCREEN-SEARCH-Save-Status.
           .             

       SCREEN-SEARCH-Restore-Status.
           .



       Form1-Event-Proc.
           .

       Form1-Gd-1-Event-Proc.
           EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
           WHEN Msg-Begin-Drag ALSO 1 ALSO
                    Form1-Handle 
              PERFORM form1-gd-1-Ev-Msg-Begin-Drag
           WHEN Msg-Begin-Entry ALSO 1 ALSO
                    Form1-Handle 
              PERFORM form1-gd-1-Ev-Msg-Begin-Entry
           WHEN Msg-End-Drag ALSO 1 ALSO
                    Form1-Handle 
              PERFORM form1-gd-1-Ev-Msg-End-Drag
           WHEN Msg-Finish-Entry ALSO 1 ALSO
                    Form1-Handle 
              PERFORM form1-gd-1-Ev-Msg-Finish-Entry
           WHEN Msg-Goto-Cell ALSO 1 ALSO
                    Form1-Handle 
              PERFORM form1-gd-1-Ev-Msg-Goto-Cell
           WHEN Msg-Goto-Cell-Drag ALSO 1 ALSO
                    Form1-Handle 
              PERFORM form1-gd-1-Ev-Msg-Goto-Cell-Drag
           WHEN Msg-Goto-Cell-Mouse ALSO 1 ALSO
                    Form1-Handle 
              PERFORM form1-gd-1-Ev-Msg-Goto-Cell-Mouse
           END-EVALUATE
           .

       Screen1-Event-Proc.
           .

      * USER DEFINE PARAGRAPH
       ABILITAZIONI.
      * <TOTEM:PARA. ABILITAZIONI>
           if mod = 1
              move BitmapDeleteEnabled to BitmapNumDelete
              move BitmapSaveEnabled   to BitmapNumSave
              move 1 to e-salva e-cancella
           else
              |SE SONO IN VISUA           
              move BitmapDeleteDisabled to BitmapNumDelete
              move BitmapSaveDisabled   to BitmapNumSave
              move ZERO to e-salva e-cancella
           end-if.     

      * ISACCO (CORREZIONE SU LIVELLO ABILITAZIONE 2) - 10/11/2003
      * (CANCELLAZIONE NON PERMESSA)
           if livello-abil = 2 
              move ZERO to e-cancella
              move BitmapDeleteDisabled to BitmapNumDelete
           end-if.
      * FINE

           modify tool-cancella, enabled = e-cancella.
           modify tool-salva,    enabled = e-salva.
       
      * ISACCO (SERVE SEMPRE PER LA MODIFICA PRCEDENTE E PER RIPRISTINARE
      * LE BITMAP DISABILITATE. - 10/11/2003
      *     perform FORM1-DISPLAY.
           display tool-nuovo, tool-salva, tool-cancella, tool-modifica.
      * FINE.

           perform GRID-HELP 
           .
      * <TOTEM:END>

       ANTEPRIMA.
      * <TOTEM:PARA. ANTEPRIMA>
           set anteprima       to true.
      *     perform paragrafo-stampa 
           .
      * <TOTEM:END>

       CANCELLA.
      * <TOTEM:PARA. CANCELLA>
           if mod = 0 exit paragraph end-if.

           display message MSG-cancellare-il-record-corrente
                     title titolo
                      type mb-yes-no
                   default mb-no
                    giving scelta.

           if scelta = mb-yes

              inquire form1-gd-1, cursor-y  in riga
              perform VALORE-RIGA

              delete ttipocli record invalid continue end-delete

              initialize G2Agg-linkage
              move tcl-codice   to G2Agg-categoria
              set  G2Agg-cat    to true
              set  G2Agg-delete to true
              call   "G2Agg" using G2Agg-linkage
              cancel "G2Agg"

              modify  form1-gd-1, record-to-delete = riga 
              inquire form1-gd-1, last-row in tot-righe
              if riga > tot-righe 
                 move tot-righe to riga 
              end-if
              modify form1-gd-1, cursor-y = riga, cursor-x = 1
              move riga to event-data-2
              perform COLORE-RIGA
              display message MSG-cancellazione-avvenuta-con-successo
                        title titolo
              set vecchio to true
           end-if 
           .
      * <TOTEM:END>

       CARICA-STAMPANTI.
      * <TOTEM:PARA. CARICA-STAMPANTI>
           modify cbo-stampante, reset-list = 1.
           call "WIN$PRINTER" using  winprint-get-no-printers, 
                                     winprint-selection
                              giving numero-stampanti.

           move 1 to cont.
           perform numero-stampanti times
              move cont to winprint-no-of-printers 
              call "WIN$PRINTER" using  winprint-get-printer-info, 
                                        winprint-selection
              move winprint-name to nome-stampante

              modify cbo-stampante, item-to-add = nome-stampante
              if cont = 1
                 modify cbo-stampante, value = nome-stampante
              end-if
              add 1 to cont
           end-perform.    
           
           modify cbo-stampante-m, reset-list = 1.
           call "WIN$PRINTER" using  winprint-get-no-printers, 
                                     winprint-selection
                              giving numero-stampanti.

           move 1 to cont.
           perform numero-stampanti times
              move cont to winprint-no-of-printers 
              call "WIN$PRINTER" using  winprint-get-printer-info, 
                                        winprint-selection
              move winprint-name to nome-stampante

              modify cbo-stampante-m, item-to-add = nome-stampante
              if cont = 1
                 modify cbo-stampante-m, value = nome-stampante
              end-if
              add 1 to cont
           end-perform 
           .
      * <TOTEM:END>

       CERCA.
      * <TOTEM:PARA. CERCA>
           continue 
           .
      * <TOTEM:END>

       COLORE-RIGA.
      * <TOTEM:PARA. COLORE-RIGA>
           if riga < 2 
              move 2 to riga 
           end-if.

           modify form1-gd-1, start-x = 1, x     = 18,
                                  start-y = riga,
                                        y = riga,
                                  region-color 257,
                                  cursor-color 481 
           .
      * <TOTEM:END>

       CONTROLLO.
      * <TOTEM:PARA. CONTROLLO>
           set tutto-ok to true.

           inquire form1-gd-1, cursor-y in riga.

           perform VALORE-RIGA.

           evaluate colonna
           when 1
                if nuovo
                   if tcl-codice = 0 or spaces 
                      set errori to true
                      move 1     to colonna
                      display message MSG-Codice-obbligatorio
                                title tit-err
                                 icon MB-WARNING-ICON
                   else  
                      read ttipocli
                       not invalid
                           set errori to true
                           display message MGS-codice-gia-inserito|"Codice già inserito!"
                                     title tit-err
                                      icon MB-WARNING-ICON
                      end-read
                   end-if
                end-if
           when 2
                if tcl-descrizione = spaces
                   set errori to true
                   move 2 to colonna
                   display message MSG-Descrizione-mancante|"Descrizione mancante"
                             title tit-err
                              icon MB-WARNING-ICON
                end-if
           when 3
                if tcl-agente  = spaces
                   set errori to true
                   move 3 to colonna
                   display message "Tipologia Agente mancante"
                             title tit-err
                              icon MB-WARNING-ICON
                else
                   evaluate true
                   when tcl-agente-si
                   when tcl-agente-no
                   when tcl-agente-opz
                        continue
                   when other
                        set errori to true
                        display message "Tipo Agente NON valido!"
                                  title tit-err
                                   icon  MB-WARNING-ICON
                        move 3 to colonna
                   end-evaluate
                end-if        
           when 4
                if tcl-agente = spaces
                   set errori to true
                   move 4 to colonna
                   display message "Tipologia GDO mancante"
                             title tit-err
                              icon MB-WARNING-ICON
                else
                                                       
                   evaluate true
                   when tcl-gdo-si
                   when tcl-gdo-no
                   when tcl-gdo-opz
                        continue
                   when other
                        set errori to true
                        display message "Tipo GDO NON valido!"
                                  title tit-err
                                   icon MB-WARNING-ICON
                        move 4 to colonna
                   end-evaluate
                end-if
           when 5
                if tcl-tipologia-tratt-imposte  = spaces
                   set errori to true
                   move 5 to colonna
                   display message "Tipologia Trattamento mancante"
                             title tit-err
                              icon MB-WARNING-ICON
                else

      * QUESTO CONTROLLO E' DA RIVEDERE QUANDO AVREMO I VALORI PER TIPO
                   evaluate tcl-tipologia-tratt-imposte
                   when "G"
                   when "O"
                   when "S"
                        continue
                   when other
                        set errori to true
                        display message "Tipo Trattamento NON valido!"
                                  title tit-err
                                   icon MB-WARNING-ICON
                        move 5 to colonna
                   end-evaluate
                end-if
           when 6
                if tcl-gestione-fido = spaces
                   set errori to true
                   move 6 to colonna
                   display message "Gestione Fido mancante"
                             title tit-err
                              icon 2
                else
                   evaluate tcl-gestione-fido
                   when "S"
                   when "N"
                        continue
                   when other
                        set errori to true
                        display message "Gestione Fido NON valido!"
                                  title tit-err
                                   icon 2
                        move 6 to colonna
                   end-evaluate
                end-if
           when 7
                if tcl-recupero-listino = spaces
                   set errori to true
                   move 7 to colonna
                   display message "Gestione Recupero prezzo da listino 
      -    "mancante"
                             title tit-err
                              icon 2
                else
                   evaluate tcl-recupero-listino
                   when "S"
                   when "N"
                        continue
                   when other
                        set errori to true
                        display message "Gestione recupero NON valido!"
                                  title tit-err
                                   icon 2
                        move 7 to colonna
                   end-evaluate
                end-if
           when 8
                if tcl-gest-plus = spaces
                   set errori to true
                   move 8 to colonna
                   display message "Gest Plus mancante"
                             title tit-err
                              icon 2
                else
                   evaluate tcl-gest-plus
                   when "S"
                   when "N"
                        continue
                   when other
                        set errori to true
                        display message "Gest Plus NON valido!"
                                  title tit-err
                                   icon 2
                        move 8 to colonna
                   end-evaluate
                end-if
           when 9
                if tcl-piombo = spaces
                   set errori to true
                   move 9 to colonna
                   display message "Add. piombo mancante"
                             title tit-err
                              icon 2
                else
                   evaluate tcl-piombo
                   when "S"
                   when "N"
                        continue
                   when other
                        set errori to true
                        display message "Add. piombo NON valido!"
                                  title tit-err
                                   icon 2
                        move 9 to colonna
                   end-evaluate
                end-if
           when 10
                if tcl-serie-bolle = 0 or
                   tcl-serie-bolle > 3
                   set errori to true
                   move 10 to colonna
                   display message "Ammessi valori 1 - 2 - 3"
                             title tit-err
                              icon 2
                end-if
           when 11
                if tcl-impegnato = "G" or
                   tcl-impegnato = "T"
                   continue
                else
                   set errori to true
                   move 11 to colonna
                   display message "Ammessi valori T(radizionale) o G(DO
      -    ")"
                             title tit-err
                              icon 2
                end-if
           when 12
                if tcl-manuale = "S" or
                   tcl-manuale = "N"
                   continue
                else
                   set errori to true
                   move 12 to colonna
                   display message "Ammessi valori S o N"
                             title tit-err
                              icon 2
                end-if
           when 13
                if tcl-bloc-auto = "S" or
                   tcl-bloc-auto = "N"
                   continue
                else
                   set errori to true
                   move 13 to colonna
                   display message "Ammessi valori S o N"
                             title tit-err
                              icon 2
                end-if
           when 14
                if tcl-brogliaccio = "G" or
                   tcl-brogliaccio = "N"
                   continue
                else
                   set errori to true
                   move 14 to colonna
                   display message "Ammessi valori G o N"
                             title tit-err
                              icon 2
                end-if
           when 15
                if tcl-evasione = "G" or
                   tcl-evasione = "T" or
                   tcl-evasione = "E"
                   continue
                else
                   set errori to true
                   move 15 to colonna
                   display message "Ammessi valori G / T / E"
                             title tit-err
                              icon 2
                end-if   
           when 16
                if tcl-stampa-brogm = "S" or
                   tcl-stampa-brogm = "N"
                   continue
                else
                   set errori to true
                   move 16 to colonna
                   display message "Ammessi valori S o N"
                             title tit-err
                              icon 2
                end-if   
           when 17
                if tcl-fido-nuovo = "S" or
                   tcl-fido-nuovo = "N"
                   continue
                else
                   set errori to true
                   move 17 to colonna
                   display message "Ammessi valori S o N"
                             title tit-err
                              icon 2
                end-if  
           when 18
                if tcl-edi-auto = "S" or
                   tcl-edi-auto = "N"
                   continue
                else
                   set errori to true
                   move 18 to colonna
                   display message "Ammessi valori S o N"
                             title tit-err
                              icon 2
                end-if 
           end-evaluate.

           if errori
              modify form1-gd-1, cursor-y = riga, cursor-x = colonna
              move riga    to event-data-2
              move colonna to event-data-1
           end-if 
           .
      * <TOTEM:END>

       GRID-HELP.
      * <TOTEM:PARA. GRID-HELP>
      * NON CI SONO ZOOM SULLE COLONNE 
      * QUINDI NON SERVE L'EVALUATE DELLA COLONNA. MA IL BOTTONE CERCA
      * SARA' SEMPRE DISABILITATO
           move BitmapZoomDisabled to BitmapNumZoom.
           move 0 to e-cerca.

           modify tool-cerca, bitmap-number = BitmapNumZoom,
                              enabled       = e-cerca.
                                                                       
           evaluate event-data-1
           when 1  move "Inserire il codice"     to HintGrid
           when 2  move "Descrizione Tipologia"  to HintGrid
           when 3  move "Valori ammessi S = SI, N = NO, O = Opzionale"
                     to HintGrid
           when 4  move "Se impostato il Cliente dovrà avere un Gruppo G
      -    "DO di riferimento in anagrafica"
                     to HintGrid
           when 5  move "Valori ammessi S = tipo standard / tradizionale
      -    ", G = GDO Scorporo, E = Estero senza imposte"  
                     to HintGrid
           when 6  move "Effettua il controllo in inserimento ordine che
      -    " il cliente non sia fuori fido"
                     to HintGrid
           when 7  move "Valori ammessi S = SI / N = NO"  to HintGrid
           when 8  move "Visualizza il campo GEST PLUS nell'ordine"  to 
           HintGrid
           when 9  move "Valori ammessi S = SI / N = NO"  to HintGrid
           when 10 move "Valori ammessi 1 - 2 - 3"        to HintGrid
           when 11 move "Valori ammessi G(DO) / T(radizionale)"  to 
           HintGrid
           when 12 move "Per ordine MASTER: S = NO RECUPERO PREZZI, poss
      -    "ibile inserimento manuale prezzo, imposte trattamento tradiz
      -    "ionale (somma) come evasione. "
                     to HintGrid
           when 13 move "Blocca l'inserimento ordine se il cliente ha ge
      -    "stione fido attiva e la prima verifica non da esito positivo
      -    " (notturna)"
                     to HintGrid
           when 14 move "NON PIU' USATO!!!! Indirizzamento brogliaccio: 
      -    "G(DO) o N(ormale)"
                     to HintGrid
           when 15 move "Imposta il tipo di evasione automatica: G(DO) T
      -    "(radizionale) E(Estero)"
                     to HintGrid
           when 16 move "Imposta la tipologia del cliente da stampare ne
      -    "l brogliaccio master automatico"
                     to HintGrid
           end-evaluate.

           Modify Form1-St-1-Handle, panel-index 1
                                     panel-style 1
                                     panel-text HintGrid 
           .
      * <TOTEM:END>

       INIT.
      * <TOTEM:PARA. INIT>
           set vecchio  to true.
           set tutto-ok to true 
           .
      * <TOTEM:END>

       LOAD-RECORD.
      * <TOTEM:PARA. LOAD-RECORD>
           modify form1-gd-1, mass-update = 1.

           move low-value to tcl-codice.
           start ttipocli key is >= tcl-chiave
                  invalid continue
              not invalid
                  perform varying riga from 2 by 1
                          until 1 = 2
                     read ttipocli next
                          at end exit perform
                      not at end
                          move tcl-codice                  to col-id
                          move tcl-descrizione             to col-des
                          move tcl-agente                  to col-agente
                          move tcl-gdo                     to col-gdo
                          move tcl-tipologia-tratt-imposte to col-tipo
                          move tcl-gestione-fido           to col-fido
                          move tcl-recupero-listino        to 
           col-recupero
                          move tcl-gest-plus               to 
           col-gest-plus
                          move tcl-piombo                  to col-piombo
                          move tcl-serie-bolle             to 
           col-serie-bolle
                          move tcl-impegnato               to col-imp
                          move tcl-manuale                 to 
           col-manuale
                          move tcl-bloc-auto               to col-bloc
                          move tcl-brogliaccio             to 
           col-brogliaccio
                          move tcl-evasione                to 
           col-evasione
                          move tcl-stampa-brogm            to 
           col-st-brogm     
                          move tcl-fido-nuovo              to 
           col-fido-nuovo
                          move tcl-edi-auto                to 
           col-edi-auto
                          modify form1-gd-1, record-to-add = rec-grid
                          if riga = 2                              
                             move tcl-stampante       to 
           cbo-stampante-buf
                             modify cbo-stampante, value 
           cbo-stampante-buf
                             move tcl-stampante-m       to 
           cbo-stampante-m-buf
                             modify cbo-stampante-m, value 
           cbo-stampante-m-buf
                             move tcl-mail-comm to ef-mail-comm-buf
                             modify ef-mail-comm,  value 
           ef-mail-comm-buf
                             move tcl-path-sfondo-bolle to 
           ef-path-sfondo-bolle-buf
                             modify ef-path-sfondo-bolle,  value 
           ef-path-sfondo-bolle-buf
                          end-if
                     end-read                                           
                  end-perform
           end-start.

           modify form1-gd-1, mass-update = 0 
           .
      * <TOTEM:END>

       MODIFICA.
      * <TOTEM:PARA. MODIFICA>
           inquire tool-modifica, value in mod.

      *--->MODIFICA (ISACCO)
           if nuovo 
              move 1 to mod 
           else
              |SPECIFICO PER I PGM. CON GRID-CONTROL
              if mod = 1
                 close    ttipocli
                 open i-o ttipocli allowing readers
              else
                 set tutto-ok to true
                 if NoSalvato
                    move 1 to mod
                    perform SALV-MOD
                 end-if   
                 if tutto-ok
                    move zero  to mod
                    close      ttipocli
                    open input ttipocli

      *             | SPECIFICO X LE TABELLE.
                    | FA IN MODO CHE RESTO SULLA CELLA IN CUI ERO
                    if ricarica
                       set ricarica to false
                       modify form1-gd-1, reset-grid = 1
                       perform FORM1-GD-1-CONTENT
                       perform LOAD-RECORD
                    end-if

                 else
                    move 1 to mod
                 end-if
              end-if
           end-if.

           perform ABILITAZIONI.

           modify tool-modifica, value mod.
           modify cbo-stampante, enabled mod.
           modify cbo-stampante-m, enabled mod.
           modify ef-mail-comm,  enabled mod.
           modify ef-path-sfondo-bolle,  enabled mod.
           modify pb-path-pdf,   enabled mod 
           .
      * <TOTEM:END>

       NUOVO.
      * <TOTEM:PARA. NUOVO>
           set tutto-ok to true.

           if nuovo
              perform VALORE-RIGA
              if tcl-codice not = SPACES
                 perform SALVA
              else
                 set errori to true
              end-if
           end-if.

           if tutto-ok
              set nuovo to true
              inquire form1-gd-1,  last-row in tot-righe
              modify  form1-gd-1,  insert-rows = 1
              modify  form1-gd-1,  cursor-x    = 1 
                                   cursor-y    = tot-righe + 1
              move 1 to mod
              modify  tool-modifica,   value = mod

              add 1 to tot-righe giving riga

              perform ABILITAZIONI

              initialize old-tcl-rec replacing numeric data by zeroes
                                          alphanumeric data by spaces

              add 1 to tot-righe giving event-data-2
              perform COLORE-RIGA
           end-if 
           .
      * <TOTEM:END>

       PARAGRAFO-COPY.
      * <TOTEM:PARA. PARAGRAFO-COPY>
           copy "abilita-toolbar.cpy".
           copy "color-custom.cpy".   
           copy "cerca-testo.cpy" 
           .
      * <TOTEM:END>

       SALV-MOD.
      * <TOTEM:PARA. SALV-MOD>
           if nuovo
              perform VALORE-RIGA
              if tcl-rec not = old-tcl-rec
                 set NoSalvato to true
              else
                 set SiSalvato to true
              end-if
           end-if.

           set tutto-ok to true.
           if NoSalvato
              display message MSG-Salvare-le-modifiche, 
                        title titolo
                         type mb-yes-no-cancel
                       giving scelta

              evaluate scelta
              when mb-yes    perform SALVA
              when mb-cancel set errori    to true
              when mb-no     set tutto-ok  to true
                             set SiSalvato to true
                             set ricarica  to true
              end-evaluate

           end-if 
           .
      * <TOTEM:END>

       SALVA.
      * <TOTEM:PARA. SALVA>
           if mod = 0 exit paragraph end-if.
           inquire form1-gd-1, cursor-x in colonna, 
                               cursor-y in riga.


           perform varying colonna from 1 by 1 
                     until colonna > 18
              perform CONTROLLO

              if errori 
                 exit perform 
              end-if
           end-perform.         
           if tutto-ok
              inquire cbo-stampante, value in cbo-stampante-buf
              if cbo-stampante-buf = spaces
                 set errori to true
                 display message "Selezionare una stampante"
                           title tit-err
                            icon 2
                 move 78-ID-cbo-stampante to control-id
                 move 4 to accept-control
              end-if
           end-if.
           if tutto-ok
              inquire cbo-stampante-m, value in cbo-stampante-m-buf
              if cbo-stampante-m-buf = spaces
                 set errori to true
                 display message "Selezionare una stampante per master"
                           title tit-err
                            icon 2
                 move 78-ID-cbo-stampante-m to control-id
                 move 4 to accept-control
              end-if
           end-if.

           if tutto-ok                               
              move cbo-stampante-buf to tcl-stampante
              move cbo-stampante-m-buf to tcl-stampante-m
              move ef-mail-comm-buf  to tcl-mail-comm
              move ef-path-sfondo-bolle-buf   to tcl-path-sfondo-bolle
              perform VALORIZZA-DATI-COMUNI
              write tcl-rec invalid rewrite tcl-rec end-write

              initialize G2Agg-linkage
              set G2Agg-cat   to true
              move tcl-codice to G2Agg-categoria
              if nuovo set G2Agg-insert to true
              else     set G2Agg-update to true
              end-if
              call   "G2Agg" using G2Agg-linkage
              cancel "G2Agg"

              set sisalvato to true
              set vecchio   to true
           else                   
              perform ABILITAZIONI
           end-if                  
           .
      * <TOTEM:END>

       SPOSTAMENTO.
      * <TOTEM:PARA. SPOSTAMENTO>
           inquire form1-gd-1, cursor-x = colonna, cursor-y = riga.

           if event-data-2 not = riga
              perform VALORE-RIGA
              if tcl-codice = spaces or 0
                 modify form1-gd-1, record-to-delete riga
                 set vecchio to true
              else  
                 perform SALVA
                 if errori
                    move riga    to event-data-2
                    move colonna to event-data-1
                    set event-action to event-action-fail
                 end-if
              end-if
           else
              if colonna not = event-data-1
                 perform CONTROLLO
                 if errori
                    set event-action to event-action-fail
                 end-if
              end-if
           end-if.

      * VALORIZZO L'OLD DELLA RIGA SU CUI SONO ANDATO
           move event-data-2 to riga.
           move event-data-1 to colonna.
           perform VALORE-OLD-RIGA.

      * COLORAZIONE RIGA IN GRID
           perform COLORE-RIGA.

           perform GRID-HELP.

           move tcl-stampante       to cbo-stampante-buf.
           modify cbo-stampante, value cbo-stampante-buf.
           inquire cbo-stampante, value cbo-stampante-buf.
           if cbo-stampante-buf = spaces
              modify cbo-stampante, item-to-add = tcl-stampante
              modify cbo-stampante, value tcl-stampante
              move tcl-stampante to cbo-stampante-buf
           end-if.

           move tcl-stampante-m       to cbo-stampante-m-buf.
           modify cbo-stampante-m, value cbo-stampante-m-buf.
           inquire cbo-stampante-m, value cbo-stampante-m-buf.
           if cbo-stampante-m-buf = spaces
              modify cbo-stampante-m, item-to-add = tcl-stampante-m
              modify cbo-stampante-m, value tcl-stampante-m
              move tcl-stampante-m to cbo-stampante-m-buf
           end-if.

           move tcl-mail-comm       to ef-mail-comm-buf.
           modify ef-mail-comm, value ef-mail-comm-buf.

           move tcl-path-sfondo-bolle       to ef-path-sfondo-bolle-buf.
           modify ef-path-sfondo-bolle, value ef-path-sfondo-bolle-buf 
           .
      * <TOTEM:END>

       STAMPA.
      * <TOTEM:PARA. STAMPA>
           set stampa       to true.
      *     perform paragrafo-stampa 
           .
      * <TOTEM:END>

       VALORE-RIGA.
      * <TOTEM:PARA. VALORE-RIGA>
           inquire form1-gd-1(riga, 1), cell-data tcl-codice.
           inquire form1-gd-1(riga, 2), cell-data tcl-descrizione. 
           inquire form1-gd-1(riga, 3), cell-data tcl-agente. 
           inquire form1-gd-1(riga, 4), cell-data tcl-gdo. 
           inquire form1-gd-1(riga, 5), 
                   cell-data tcl-tipologia-tratt-imposte.  
           inquire form1-gd-1(riga, 6), cell-data tcl-gestione-fido.
           inquire form1-gd-1(riga, 7), cell-data tcl-recupero-listino.
           inquire form1-gd-1(riga, 8), cell-data tcl-gest-plus.
           inquire form1-gd-1(riga, 9), cell-data tcl-piombo.
           inquire form1-gd-1(riga, 10), cell-data tcl-serie-bolle.
           inquire form1-gd-1(riga, 11), cell-data tcl-impegnato.
           inquire form1-gd-1(riga, 12), cell-data tcl-manuale.
           inquire form1-gd-1(riga, 13), cell-data tcl-bloc-auto.
           inquire form1-gd-1(riga, 14), cell-data tcl-brogliaccio.
           inquire form1-gd-1(riga, 15), cell-data tcl-evasione.     
           inquire form1-gd-1(riga, 16), cell-data tcl-stampa-brogm.    
           inquire form1-gd-1(riga, 17), cell-data tcl-fido-nuovo.
           inquire form1-gd-1(riga, 18), cell-data tcl-edi-auto 
           .
      * <TOTEM:END>

       VALORE-OLD-RIGA.
      * <TOTEM:PARA. VALORE-OLD-RIGA>
           if vecchio
              inquire form1-gd-1(riga, 1) cell-data tcl-codice
              read ttipocli               no lock
              move tcl-rec                to old-tcl-rec
           else
              initialize old-tcl-rec replacing numeric data by zeroes
                                          alphanumeric data by spaces
           end-if 
           .
      * <TOTEM:END>

       VALORIZZA-DATI-COMUNI.
      * <TOTEM:PARA. VALORIZZA-DATI-COMUNI>
      * SE NON HO VALORIZZATO I CAMPI DI CREAZIONE LI VALORIZZO
           if tcl-data-creazione = zero
              accept tcl-data-creazione from century-date
           end-if.
           if tcl-ora-creazione = zero
              accept tcl-ora-creazione from time
           end-if.
           if tcl-utente-creazione = space
              move user-codi to tcl-utente-creazione
           end-if.

           accept tcl-data-ultima-modifica from century-date.
           accept tcl-ora-ultima-modifica from time.
           move user-codi to tcl-utente-ultima-modifica 
           .
      * <TOTEM:END>

      * EVENT PARAGRAPH
       NUOVO-LinkTo.
      * <TOTEM:PARA. NUOVO-LinkTo>
           inquire tool-nuovo, enabled in e-nuovo.
           if e-nuovo = 1
              perform NUOVO
           end-if 

           .
      * <TOTEM:END>
       CANCELLA-LinkTo.
      * <TOTEM:PARA. CANCELLA-LinkTo>
           inquire tool-cancella, enabled in e-cancella.
           if e-cancella = 1
              perform CANCELLA
           end-if 
           .
      * <TOTEM:END>
       TOOL-SALVA-LinkTo.
      * <TOTEM:PARA. TOOL-SALVA-LinkTo>
           inquire tool-salva, enabled in e-salva.
           if e-salva = 1
              perform SALVA
           end-if 
           .
      * <TOTEM:END>
       ANTEPRIMA-LinkTo.
      * <TOTEM:PARA. ANTEPRIMA-LinkTo>
           inquire tool-anteprima, enabled in e-anteprima.
           if e-anteprima = 1
              perform ANTEPRIMA
           end-if 
           .
      * <TOTEM:END>
       TOOL-MODIFICA-LinkTo.
      * <TOTEM:PARA. TOOL-MODIFICA-LinkTo>
           inquire tool-modifica, enabled in e-modifica
           if e-modifica = 1
              perform MODIFICA
           end-if 
           .
      * <TOTEM:END>
       STAMPA-LinkTo.
      * <TOTEM:PARA. STAMPA-LinkTo>
           inquire tool-stampa, enabled in e-stampa
           if e-stampa = 1
              perform STAMPA
           end-if 
           .
      * <TOTEM:END>
       I-O-BLOCCO.
      * <TOTEM:PARA. I-O-BLOCCO>
           SET LK-BL-CANCELLAZIONE TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM 
           .
      * <TOTEM:END>
       PAS004P-Ev-Before-Program.
      * <TOTEM:PARA. PAS004P-Ev-Before-Program>
           move LK-BL-PROG-ID    TO COMO-PROG-ID 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-Finish-Entry.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-Finish-Entry>
           inquire form1-gd-1, cursor-y in riga.
           perform VALORE-RIGA.

           perform  CONTROLLO.

           if errori 
              set event-action to event-action-fail 
              perform VALORE-RIGA
           end-if.

           if tcl-rec not = old-tcl-rec
              set NoSalvato to true                            
           else 
              set SiSalvato to true
           end-if 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-Begin-Entry.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-Begin-Entry>
           inquire form1-gd-1, cursor-x in colonna,
                               cursor-y in riga.
                         
           perform VALORE-RIGA.

           if colonna = 1
              if tcl-codice not = 0 and tcl-codice not = spaces
                 set event-action to event-action-fail
              end-if
           else 
              if mod = 0
                 set event-action to event-action-fail
              else
                 if tcl-codice = 0 or spaces
                    set event-action to event-action-fail
                    modify form1-gd-1, cursor-y = riga, cursor-x = 1
                 end-if   
              end-if
           end-if 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-End-Drag.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-End-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-Goto-Cell.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-Goto-Cell>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-Goto-Cell-Drag.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-Goto-Cell-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-Goto-Cell-Mouse.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-Goto-Cell-Mouse>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-Begin-Drag.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-Begin-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       TOOL-CERCA-LinkTo.
      * <TOTEM:PARA. TOOL-CERCA-LinkTo>
           inquire tool-cerca, enabled in e-cerca.
           if e-cerca = 1
              perform CERCA
           end-if 
           .
      * <TOTEM:END>
       ef-cod-BeforeProcedure.
      * <TOTEM:PARA. ef-cod-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-des-BeforeProcedure.
      * <TOTEM:PARA. ef-des-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-cod-AfterProcedure.
      * <TOTEM:PARA. ef-cod-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       ef-des-AfterProcedure.
      * <TOTEM:PARA. ef-des-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       rb-cod-BeforeProcedure.
      * <TOTEM:PARA. rb-cod-BeforeProcedure>
           modify control-handle, color = colore-nu
           .
      * <TOTEM:END>
       rb-des-BeforeProcedure.
      * <TOTEM:PARA. rb-des-BeforeProcedure>
           modify control-handle, color = colore-nu
           .
      * <TOTEM:END>
       rb-cod-AfterProcedure.
      * <TOTEM:PARA. rb-cod-AfterProcedure>
           modify control-handle, color = colore-or
           .
      * <TOTEM:END>
       rb-des-AfterProcedure.
      * <TOTEM:PARA. rb-des-AfterProcedure>
           modify control-handle, color = colore-or
           .
      * <TOTEM:END>
       pb-esegui-LinkTo.
      * <TOTEM:PARA. pb-esegui-LinkTo>
           set tutto-ok to true.

           if tipo-ricerca = 1
              inquire ef-cod, value in cod
              if cod not > spaces 
                 set errori  to true 
              else
                 move cod    to TextToSearch
                 move spaces to des
                 display ef-des
              end-if 
           else                           
              inquire ef-des, value in des
              if des = spaces 
                 set errori to true 
              else
                 move des to TextToSearch   
                 move space to cod
                 display ef-cod
              end-if
           end-if.

           if tutto-ok 
              move 27 to key-status 
              set Ricerca to true
           end-if. 

           Set tutto-ok to true 
           .
      * <TOTEM:END>
       tool-CercaTesto-LinkTo.
      * <TOTEM:PARA. tool-CercaTesto-LinkTo>
           perform CERCA-TESTO 
           .
      * <TOTEM:END>
       rb-cod-LinkTo.
      * <TOTEM:PARA. rb-cod-LinkTo>
           move 1 to tipo-ricerca.
           move 1 to e-cod.
           move 0 to e-des.
           display SCREEN-SEARCH.

           perform CANCELLA-COLORE.
           move 1 to control-id.
           move 4 to accept-control 
           .
      * <TOTEM:END>
       rb-des-LinkTo.
      * <TOTEM:PARA. rb-des-LinkTo>
           move 2 to tipo-ricerca.
           move 1 to e-des.
           move 0 to e-cod.
           display SCREEN-SEARCH.  

           perform CANCELLA-COLORE.
           move 2 to control-id.
           move 4 to accept-control 
           .
      * <TOTEM:END>
       TOOL-MODIFICA-BeforeProcedure.
      * <TOTEM:PARA. TOOL-MODIFICA-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       cb-match-BeforeProcedure.
      * <TOTEM:PARA. cb-match-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       TOOL-MODIFICA-AfterProcedure.
      * <TOTEM:PARA. TOOL-MODIFICA-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       cb-match-AfterProcedure.
      * <TOTEM:PARA. cb-match-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       Form1-Cm-1-BeforeProcedure.
      * <TOTEM:PARA. Form1-Cm-1-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       Form1-Cm-1-AfterProcedure.
      * <TOTEM:PARA. Form1-Cm-1-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       Form1-Ef-1-BeforeProcedure.
      * <TOTEM:PARA. Form1-Ef-1-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       Form1-Ef-1-AfterProcedure.
      * <TOTEM:PARA. Form1-Ef-1-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       pb-path-pdf-LinkTo.
      * <TOTEM:PARA. pb-path-pdf-LinkTo>
           initialize opensave-data.

           move spaces to opnsav-default-dir
           initialize opnsav-filters
           string "BMP files (*.bmp)|*.bmp"         delimited size
                  into  opnsav-filters
           end-string
           move 1 to opnsav-default-filter
           move "Geslux -  Selezione sfondo bolle" to opnsav-title
           call "C$OPENSAVEBOX" using opensave-save-box, 
                                      opensave-data,
                               giving opensave-status
      
           if opensave-status = 1
              move opnsav-filename to ef-path-sfondo-bolle-buf
              display ef-path-sfondo-bolle
           end-if 
           .
      * <TOTEM:END>

      *{TOTEM}END

      *{TOTEM}SHOW-MSG
       MESSAGE-FOR-FILEERROR.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
              MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           .

       SHOW-TRANSACTION-ROUTINE.
           IF TOTEM-TRANSACTION-FLAG = SPACES
              IF TRANSACTION-STATUS NOT = 0
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-1
              END-IF
           ELSE
              PERFORM SHOW-MSG-ROUTINE
              IF TRANSACTION-STATUS = 0
                 MOVE "Transazione terminata con Rollback." TO 
           TOTEM-MSG-3
              ELSE
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-3
              END-IF
           END-IF
           .

       SHOW-MSG-ROUTINE.
           MOVE SPACE TO TOTEM-MSG-1 TOTEM-MSG-2 TOTEM-MSG-3
           EVALUATE TOTEM-MSG-ID
               WHEN "10"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Nessun altro dato." TO TOTEM-MSG-2
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "22"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Chiave Duplicata." TO TOTEM-MSG-2
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "23"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Raggiunta fine file." TO TOTEM-MSG-2
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "101"
                    MOVE "Terminare l'applicazione?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "201"
                    MOVE "Aggiungere un nuovo record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "202"
                    MOVE "Aggiornare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "203"
                    MOVE "Cancellare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "204"
                    MOVE "Chiave duplicata." TO TOTEM-MSG-1
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "301"
                    MOVE "Inserimento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "302"
                    MOVE "Aggiornamento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "303"
                    MOVE "Cancellazione avvenuta con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "401"
                    MOVE "Shell non trovata." TO TOTEM-MSG-1
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN OTHER
                    MOVE TEXT-MESSAGE TO TOTEM-MSG-1
                    STRING "FILE:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-3
                    MOVE 0 TO TOTEM-IDX1
                    INSPECT TOTEM-MSG-3 TALLYING TOTEM-IDX1
                       FOR TRAILING SPACE
                    STRING TOTEM-MSG-3(1:TOTEM-MSG-LENGTH - 
           TOTEM-IDX1), 
                       ", FILE STATUS ", PRIMARY-ERROR "," 
                       SECONDARY-ERROR
                    DELIMITED BY SIZE INTO TOTEM-MSG-2
                    MOVE SPACES TO TOTEM-MSG-3
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
           END-EVALUATE
           PERFORM MESSAGE-BOX-ROUTINE
           .

       MESSAGE-BOX-ROUTINE.
           MOVE 1 TO TOTEM-MSG-TEXT-POINTER
           IF TOTEM-MSG-1 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-1 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              STRING TOTEM-MSG-1( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                 DELIMITED BY SIZE
                 INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-2 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-2 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-2( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-3 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-3 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-3( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-TEXT-POINTER = 1
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-TEXT TALLYING TOTEM-MSG-SIZE FOR 
           TRAILING SPACE
                  COMPUTE TOTEM-MSG-TEXT-POINTER = 
           TOTEM-MSG-FULL-LENGTH - TOTEM-MSG-SIZE + 1
           END-IF
           MOVE LOW-VALUES TO TOTEM-MSG-TEXT(TOTEM-MSG-TEXT-POINTER : 1 
           )
           .

       MESSAGE-BOX-DISPLAY.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

      *{TOTEM}END

