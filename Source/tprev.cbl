      *{TOTEM}PRG-COMMENT
      * tprev.Cbl
      * tprev.Cbl is generated by TOTEM
      * This is a generated file. DO NOT modify this file directly.
      *{TOTEM}END
       IDENTIFICATION       DIVISION.
      *{TOTEM}PRGID
       PROGRAM-ID.          tprev.
       AUTHOR.              andre.
       DATE-WRITTEN.        giovedì 1 ottobre 2020 14:56:07.
       REMARKS.
      *{TOTEM}END

       ENVIRONMENT          DIVISION.
       CONFIGURATION        SECTION.
       SPECIAL-NAMES.
      *{TOTEM}SPECIAL-NAME
      * <TOTEM:EPT. INIT:tprev, INIT:tprev, SpecialName>
      * <TOTEM:END>
      *{TOTEM}END
      *{TOTEM}ACTIVEX-DEF
      *{TOTEM}END
      *{TOTEM}DECIMAL-POINT
           DECIMAL-POINT IS COMMA.
      *{TOTEM}END

       INPUT-OUTPUT         SECTION.
       FILE-CONTROL.
      *{TOTEM}FILE-CONTROL
           COPY "tpromo.sl".
           COPY "rpromo.sl".
           COPY "articoli.sl".
           COPY "progmag.sl".
           COPY "promoeva.sl".
           COPY "tmagaz.sl".
           COPY "lineseq.sl".
           COPY "tmp-mtordini.sl".
           COPY "mrordini.sl".
           COPY "mtordini.sl".
           COPY "clienti.sl".
           COPY "destini.sl".
      *{TOTEM}END
       DATA                 DIVISION.
       FILE                 SECTION.
      *{TOTEM}FILE
           COPY "tpromo.fd".
           COPY "rpromo.fd".
           COPY "articoli.fd".
           COPY "progmag.fd".
           COPY "promoeva.fd".
           COPY "tmagaz.fd".
           COPY "lineseq.fd".
           COPY "tmp-mtordini.fd".
           COPY "mrordini.fd".
           COPY "mtordini.fd".
           COPY "clienti.fd".
           COPY "destini.fd".
      *{TOTEM}END

       WORKING-STORAGE      SECTION.
      *{TOTEM}ACU-DEF
               COPY "acugui.def".
               COPY "acucobol.def".
               COPY "fonts.def".
               COPY "crtvars.def".
               COPY "showmsg.def".
               COPY "totem.def".
               COPY "standard.def".
      *{TOTEM}END

      *{TOTEM}COPY-WORKING
      * Key Status
       77 Key-Status IS SPECIAL-NAMES CRT STATUS PIC 9(5) VALUE 0.
          88 Enter-Pushed VALUE 13.
          88 Exit-Pushed VALUE 27.
          88 Message-Received VALUE 95.
          88 Event-Occurred VALUE 96.
          88 Screen-No-Input-Field VALUE 97.
      * Properties & User defined Working Stoarge
       77 STATUS-tregioni  PIC  X(2).
           88 Valid-STATUS-tregioni VALUE IS "00" THRU "09". 
           COPY  "LINK-TPREV-P.DEF".
           COPY  "EXTERNALS.DEF".
           COPY  "COMMON-EXCEL.DEF".
           COPY  "LINK-GORDCVAR.DEF".
           COPY  "LINK-GESLOCK.DEF".
      *
      *
       77 TIPO-DATA        PIC  9(8)
                  VALUE IS 0.
       77 Form1-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 spunta2-nera-bmp
                  USAGE IS HANDLE OF BITMAP
                  VALUE IS 0.
       77 Form1-Tb-1-Handle
                  USAGE IS HANDLE OF WINDOW.
       78 titolo VALUE IS "Geslux - Quantità promo per evasione". 
       77 E-ESCI           PIC  9
                  VALUE IS 1.
       77 E-NUOVO          PIC  9
                  VALUE IS 1.
       77 save-articolo    PIC  9(6).
       77 colore           PIC  9(5).
       77 chiave           PIC  9(5).
       77 como-x           PIC  x.
       77 como-giacenza    PIC  s9(8).
       77 old-qta          PIC  s9(8).
       77 new-qta          PIC  s9(8).
       77 FILLER           PIC  9.
           88 PrenQta VALUE IS 1    WHEN SET TO FALSE  0. 
       77 FILLER           PIC  9.
           88 BeginEntry VALUE IS 1    WHEN SET TO FALSE  0. 
       01 corr-rec.
           05 corr-chiave.
               10 corr-articolo    PIC  9(6).
               10 corr-prog        PIC  9(8).
           05 corr-dati        PIC  x(5000).
       01 prec-rec.
           05 prec-chiave.
               10 prec-articolo    PIC  9(6).
               10 prec-prog        PIC  9(8).
           05 prec-dati        PIC  x(5000).
       01 succ-rec.
           05 succ-chiave.
               10 succ-articolo    PIC  9(6).
               10 succ-prog        PIC  9(8).
           05 succ-dati        PIC  x(5000).
       01 gruppo-hidden.
           05 hid-chiave.
               10 hid-articolo     PIC  9(6).
               10 hid-prog         PIC  9(8).
           05 hid-cambio       PIC  9.
       77 imp-master       PIC  s9(8).
       77 giac-utile       PIC  s9(8).
       01 FILLER           PIC  9.
           88 CambioQta VALUE IS 1    WHEN SET TO FALSE  0. 
       77 E-CANCELLA       PIC  9
                  VALUE IS 1.
       77 E-SALVA          PIC  9
                  VALUE IS 1.
       77 E-ANTEPRIMA      PIC  9
                  VALUE IS 0.
       77 E-MODIFICA       PIC  9
                  VALUE IS 1.
       77 E-STAMPA         PIC  9
                  VALUE IS 0.
       77 E-CERCA          PIC  9
                  VALUE IS 1.
       77 MESSAGGIO        PIC  X(300)
                  VALUE IS SPACE.
       77 Small-Font
                  USAGE IS HANDLE OF FONT SMALL-FONT.
       77 toolbar-bmp      PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       01 rec-grid.
           05 col-art-codice   PIC  9(6).
           05 col-art-descrizione          PIC  X(50).
           05 col-pev-data-ins PIC  99/99/9999.
           05 col-tpr-codice   PIC  9(15).
           05 col-tpr-descrizione          PIC  X(50).
           05 col-tpr-gdo      PIC  x(5).
           05 col-tpr-ini-vol  PIC  99/99/9999.
           05 col-tpr-fine-vol PIC  99/99/9999.
           05 col-rpr-qta      PIC  ---.---.--9.
           05 col-pev-prenotata            PIC  ---.---.--9.
           05 col-pev-evasa    PIC  ---.---.--9.
           05 col-pev-boll     PIC  ---.---.--9.
           05 col-pev-rimanenza            PIC  ---.---.--9.
           05 col-pev-impegnato            PIC  ---.---.--9.
           05 col-pev-giac-utile           PIC  ---.---.--9.
           05 col-pren         PIC  x.
       77 Screen1-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 esegui_73x21-bmp PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 cod  PIC  z(3).
       77 des  PIC  x(30).
       77 e-cod            PIC  9
                  VALUE IS 1.
       77 e-des            PIC  9
                  VALUE IS 0.
       77 Default-Font
                  USAGE IS HANDLE OF FONT DEFAULT-FONT.
       77 lab-des2         PIC  x(50).
       01 FILLER           PIC  XX.
           88 ricarica VALUE IS "SI"    WHEN SET TO FALSE  "NO". 
       77 STATUS-articoli  PIC  X(2).
           88 Valid-STATUS-articoli VALUE IS "00" THRU "09". 
       77 STATUS-progmag   PIC  X(2).
           88 Valid-STATUS-progmag VALUE IS "00" THRU "09". 
       77 STATUS-promo-eva PIC  X(2).
           88 Valid-STATUS-promo-eva VALUE IS "00" THRU "09". 
       77 STATUS-rpromo    PIC  X(2).
           88 Valid-STATUS-rpromo VALUE IS "00" THRU "09". 
       77 STATUS-tpromo    PIC  X(2).
           88 Valid-STATUS-tpromo VALUE IS "00" THRU "09". 
       77 scr-elab-SF-HANDLE
                  USAGE IS HANDLE OF WINDOW.
       77 BOTTONE-OK-BMP   PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 BOTTONE-CANCEL-BMP           PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 Verdana12B-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 scr-elab-HANDLE
                  USAGE IS HANDLE OF WINDOW.
       77 Verdana8-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 freccia_su-bmp   PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 freccia_giu-bmp  PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 STATUS-promoeva  PIC  X(2).
           88 Valid-STATUS-promoeva VALUE IS "00" THRU "09". 
       77 STATUS-tmagaz    PIC  X(2).
           88 Valid-STATUS-tmagaz VALUE IS "00" THRU "09". 
       77 Large-Font
                  USAGE IS HANDLE OF FONT LARGE-FONT.
       77 e-sposta-su      PIC  9
                  VALUE IS 1.
       77 e-sposta-giu     PIC  9
                  VALUE IS 1.
       77 REFRESH-BMP      PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 excel-bmp        PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 wstampa          PIC  X(256).
       77 STATUS-lineseq   PIC  X(2).
           88 Valid-STATUS-lineseq VALUE IS "00" THRU "09". 
       77 Medium-Font
                  USAGE IS HANDLE OF FONT MEDIUM-FONT.
       77 Verdana8B-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 path-tmp-mtordini            PIC  X(256).
       77 STATUS-tmp-mtordini          PIC  X(2).
           88 Valid-STATUS-tmp-mtordini VALUE IS "00" THRU "09". 
       77 STATUS-mrordini  PIC  X(2).
           88 Valid-STATUS-mrordini VALUE IS "00" THRU "09". 
       77 STATUS-mtordini  PIC  X(2).
           88 Valid-STATUS-mtordini VALUE IS "00" THRU "09". 
       77 STATUS-clienti   PIC  X(2).
           88 Valid-STATUS-clienti VALUE IS "00" THRU "09". 
       77 STATUS-destini   PIC  X(2).
           88 Valid-STATUS-destini VALUE IS "00" THRU "09". 
       77 lab-giac-buf     PIC  ---.---.--9.
       77 no-msg           PIC  9
                  VALUE IS 0.
       77 AUTO-ID          PIC  9(6)
                  VALUE IS 1.

      ***********************************************************
      *   Code Gen's Buffer                                     *
      ***********************************************************
       77 STATUS-Form1-FLAG-REFRESH PIC  9.
          88 Form1-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 TMP-Form1-KEY1-ORDER  PIC X VALUE "A".
       77 TMP-Form1-promoeva-RESTOREBUF  PIC X(817).
       77 TMP-Form1-KEYIS  PIC 9(3) VALUE 1.
       77 Form1-MULKEY-TMPBUF   PIC X(817).
       77 STATUS-scr-elab-FLAG-REFRESH PIC  9.
          88 scr-elab-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 TMP-DataSet1-tpromo-BUF     PIC X(263).
       77 TMP-DataSet1-rpromo-BUF     PIC X(209).
       77 TMP-DataSet1-articoli-BUF     PIC X(3669).
       77 TMP-DataSet1-progmag-BUF     PIC X(1090).
       77 TMP-DataSet1-promoeva-BUF     PIC X(817).
       77 TMP-DataSet1-tmagaz-BUF     PIC X(212).
       77 TMP-DataSet1-lineseq-BUF     PIC X(1000).
       77 TMP-DataSet1-tmp-mtordini-BUF     PIC X(157).
       77 TMP-DataSet1-mrordini-BUF     PIC X(891).
       77 TMP-DataSet1-mtordini-BUF     PIC X(2122).
       77 TMP-DataSet1-clienti-BUF     PIC X(1910).
       77 TMP-DataSet1-destini-BUF     PIC X(3676).
      * VARIABLES FOR RECORD LENGTH.
       77  TotemFdSlRecordClearOffset   PIC 9(5) COMP-4.
       77  TotemFdSlRecordLength        PIC 9(5) COMP-4.
      * FILE'S LOCK MODE FLAG
       77 DataSet1-tpromo-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tpromo-LOCK  VALUE "Y".
       77 DataSet1-tpromo-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tpromo-KEY-Asc  VALUE "A".
          88 DataSet1-tpromo-KEY-Desc VALUE "D".
       77 DataSet1-rpromo-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-rpromo-LOCK  VALUE "Y".
       77 DataSet1-rpromo-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-rpromo-KEY-Asc  VALUE "A".
          88 DataSet1-rpromo-KEY-Desc VALUE "D".
       77 DataSet1-articoli-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-articoli-LOCK  VALUE "Y".
       77 DataSet1-articoli-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-articoli-KEY-Asc  VALUE "A".
          88 DataSet1-articoli-KEY-Desc VALUE "D".
       77 DataSet1-progmag-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-progmag-LOCK  VALUE "Y".
       77 DataSet1-progmag-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-progmag-KEY-Asc  VALUE "A".
          88 DataSet1-progmag-KEY-Desc VALUE "D".
       77 DataSet1-promoeva-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-promoeva-LOCK  VALUE "Y".
       77 DataSet1-KEYIS   PIC 9(3) VALUE 1.
       77 DataSet1-promoeva-KEY1-ORDER  PIC X VALUE "A".
          88 DataSet1-promoeva-KEY1-Asc  VALUE "A".
          88 DataSet1-promoeva-KEY1-Desc VALUE "D".
       77 DataSet1-tmagaz-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tmagaz-LOCK  VALUE "Y".
       77 DataSet1-tmagaz-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tmagaz-KEY-Asc  VALUE "A".
          88 DataSet1-tmagaz-KEY-Desc VALUE "D".
       77 DataSet1-lineseq-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-lineseq-LOCK  VALUE "Y".
       77 DataSet1-lineseq-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-lineseq-KEY-Asc  VALUE "A".
          88 DataSet1-lineseq-KEY-Desc VALUE "D".
       77 DataSet1-tmp-mtordini-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tmp-mtordini-LOCK  VALUE "Y".
       77 DataSet1-tmp-mtordini-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tmp-mtordini-KEY-Asc  VALUE "A".
          88 DataSet1-tmp-mtordini-KEY-Desc VALUE "D".
       77 DataSet1-mrordini-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-mrordini-LOCK  VALUE "Y".
       77 DataSet1-mrordini-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-mrordini-KEY-Asc  VALUE "A".
          88 DataSet1-mrordini-KEY-Desc VALUE "D".
       77 DataSet1-mtordini-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-mtordini-LOCK  VALUE "Y".
       77 DataSet1-mtordini-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-mtordini-KEY-Asc  VALUE "A".
          88 DataSet1-mtordini-KEY-Desc VALUE "D".
       77 DataSet1-clienti-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-clienti-LOCK  VALUE "Y".
       77 DataSet1-clienti-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-clienti-KEY-Asc  VALUE "A".
          88 DataSet1-clienti-KEY-Desc VALUE "D".
       77 DataSet1-destini-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-destini-LOCK  VALUE "Y".
       77 DataSet1-destini-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-destini-KEY-Asc  VALUE "A".
          88 DataSet1-destini-KEY-Desc VALUE "D".

       77 tpromo-tpr-chiave-ricerca-SPLITBUF  PIC X(22).
       77 tpromo-tpr-chiave-gdo-fine-SPLITBUF  PIC X(22).
       77 tpromo-tpr-chiave-fine-SPLITBUF  PIC X(22).
       77 tpromo-tpr-chiave-ini-SPLITBUF  PIC X(22).
       77 tpromo-tpr-chiave-volantino-SPLITBUF  PIC X(22).
       77 tpromo-tpr-k-fine-vol-SPLITBUF  PIC X(22).
       77 tpromo-tpr-k-data-ins-SPLITBUF  PIC X(29).
       77 rpromo-k-stampa-SPLITBUF  PIC X(32).
       77 articoli-art-k1-SPLITBUF  PIC X(51).
       77 articoli-art-k-frn-SPLITBUF  PIC X(16).
       77 progmag-key01-SPLITBUF  PIC X(21).
       77 promoeva-pev-k-art-SPLITBUF  PIC X(22).
       77 promoeva-pev-k-descr-art-SPLITBUF  PIC X(65).
       77 promoeva-pev-k-gdo-SPLITBUF  PIC X(70).
       77 promoeva-pev-k-fittizia-SPLITBUF  PIC X(16).
       77 promoeva-pev-k-promo-SPLITBUF  PIC X(30).
       77 promoeva-pev-k-descr-promo-SPLITBUF  PIC X(65).
       77 tmp-mtordini-k-ord-SPLITBUF  PIC X(21).
       77 mrordini-mro-k-promo-SPLITBUF  PIC X(33).
       77 mrordini-mro-k-articolo-SPLITBUF  PIC X(24).
       77 mrordini-mro-k-progr-SPLITBUF  PIC X(18).
       77 mrordini-mro-k-tprev-SPLITBUF  PIC X(39).
       77 mrordini-mro-k-ord-art-SPLITBUF  PIC X(19).
       77 mtordini-mto-k-ord-cli-SPLITBUF  PIC X(55).
       77 mtordini-mto-k-data-SPLITBUF  PIC X(21).
       77 mtordini-mto-k-clides-SPLITBUF  PIC X(19).
       77 mtordini-mto-k-age-SPLITBUF  PIC X(14).
       77 mtordini-k-mto-stato-sel-SPLITBUF  PIC X(15).
       77 mtordini-k-mto-stato-SPLITBUF  PIC X(14).
       77 mtordini-mto-k-gdo-SPLITBUF  PIC X(26).
       77 mtordini-mto-k-bloc-SPLITBUF  PIC X(20).
       77 mtordini-k-giang-SPLITBUF  PIC X(21).
       77 mtordini-mto-k-promo-SPLITBUF  PIC X(25).
       77 clienti-cli-K1-SPLITBUF  PIC X(47).
       77 clienti-cli-K3-SPLITBUF  PIC X(12).
       77 clienti-cli-K4-SPLITBUF  PIC X(8).
       77 destini-K1-SPLITBUF  PIC X(111).
       77 destini-k-localita-SPLITBUF  PIC X(36).

      *{TOTEM}END

      *{TOTEM}ID-LOGICI
      ***** Elenco ID Logici *****
       78  78-ID-form1-gd-1 VALUE 5001.
      ***** Fine ID Logici *****
      *{TOTEM}END

       LINKAGE          SECTION.
      *{TOTEM}LINKAGE
           COPY  "COMMON-LINKAGE.DEF".

      *{TOTEM}END

       SCREEN           SECTION.
      *{TOTEM}COPY-SCREEN
      * FORM
       01 
           Form1, 
           .

      * LABEL
       05
           CST-BLOCKPGM, 
           Label, 
           COL 49,57, 
           LINE 1,00,
           LINES 0,46 ,
           SIZE 14,43 ,
           ID IS 12,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "BlockPgm",
           VISIBLE v-custom,
           .

      * GRID
       05
           form1-gd-1, 
           Grid, 
           COL 1,00, 
           LINE 1,85,
           LINES 37,08 ,
           SIZE 179,71 ,
           ADJUSTABLE-COLUMNS,
           BOXED,
           CENTERED-HEADINGS,
           DATA-COLUMNS (1, 7, 57, 67, 82, 132, 137, 147, 157, 168, 
           179, 190, 201, 212, 223, 234),
           ALIGNMENT ("R", "U", "C", "R", "U", "C", "C", "C", "R", "R", 
           "R", "R", "R", "R", "R", "C"),
           SEPARATION (5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5),
           DATA-TYPES ("9(6)", "X(50)", "X(10)", "9(15)", "X(50)", "X(5)
      -    "", "X(10)", "X(10)", "9(10)", "9(10)", "9(10)", "9(10)", "9(
      -    "10)", "9(10)", "9(10)", "U(1)"),
           NUM-COL-HEADINGS 1,
           COLUMN-HEADINGS,
           CURSOR-FRAME-WIDTH 2,
           DIVIDER-COLOR 1,
           HEADING-COLOR 257,
           HEADING-DIVIDER-COLOR 1,
           HSCROLL,
           ID IS 78-ID-form1-gd-1,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RECORD-DATA rec-grid,
           TILED-HEADINGS,
           VIRTUAL-WIDTH 177,
           VPADDING 50,
           VSCROLL,
           EVENT PROCEDURE Form1-Gd-1-Event-Proc,
           .

      * FRAME
       05
           Form1-Fr-1, 
           Frame, 
           COL 1,43, 
           LINE 39,46,
           LINES 5,31 ,
           SIZE 22,86 ,
           ID IS 3,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Priorità promo",
           TITLE-POSITION 2,
           VISIBLE 0,
           .

      * PUSH BUTTON
       05
           pb-su, 
           Push-Button, 
           COL 4,29, 
           LINE 40,69,
           LINES 40,00 ,
           SIZE 40,00 ,
           BITMAP-HANDLE FRECCIA_SU-BMP,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           ENABLED e-sposta-su,
           EXCEPTION-VALUE 1000,
           FLAT,
           FONT IS Small-Font,
           ID IS 2,
           TITLE "Aumenta priorità",
           VISIBLE 0,
           AFTER PROCEDURE pb-su-AfterProcedure, 
           BEFORE PROCEDURE pb-su-BeforeProcedure, 
           .

      * PUSH BUTTON
       05
           pb-giu, 
           Push-Button, 
           COL 14,43, 
           LINE 40,69,
           LINES 40,00 ,
           SIZE 40,00 ,
           BITMAP-HANDLE FRECCIA_GIU-BMP,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           ENABLED e-sposta-giu,
           EXCEPTION-VALUE 1001,
           FLAT,
           FONT IS Small-Font,
           ID IS 4,
           TITLE "Diminuisci priorità",
           VISIBLE 0,
           AFTER PROCEDURE pb-giu-AfterProcedure, 
           BEFORE PROCEDURE pb-giu-BeforeProcedure, 
           .

      * PUSH BUTTON
       05
           pb-reset, 
           Push-Button, 
           COL 174,71, 
           LINE 40,77,
           LINES 30,00 ,
           SIZE 30,00 ,
           BITMAP-HANDLE REFRESH-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 5,
           FLAT,
           ID IS 502,
           SELF-ACT,
           TERMINATION-VALUE 13,
           TITLE "&Aggiorna l'elenco delle sessioni",
           .

      * PUSH BUTTON
       05
           pb-stampa, 
           Push-Button, 
           COL 169,00, 
           LINE 40,77,
           LINES 30,00 ,
           SIZE 28,00 ,
           BITMAP-HANDLE EXCEL-BMP,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 1002,
           FLAT,
           FONT IS Small-Font,
           ID IS 5,
           TITLE "Push Button",
           .

      * LABEL
       05
           Form1-La-1, 
           Label, 
           COL 65,86, 
           LINE 41,38,
           LINES 1,54 ,
           SIZE 20,00 ,
           COLOR IS 2,
           FONT IS Verdana12B-Occidentale,
           ID IS 6,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "GIACENZA LBX",
           .

      * LABEL
       05
           lab-giac, 
           Label, 
           COL 86,57, 
           LINE 41,38,
           LINES 1,54 ,
           SIZE 20,00 ,
           COLOR IS 2,
           FONT IS Verdana12B-Occidentale,
           ID IS 7,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-giac-buf,
           .

      * FORM
       01 
           scr-elab, 
           HELP-ID 1,
           .

      * LABEL
       05
           scr-elab-La-2a, 
           Label, 
           COL 3,00, 
           LINE 2,50,
           LINES 1,90 CELLS,
           SIZE 45,90 CELLS,
           COLOR IS 1,
           FONT IS Verdana12B-Occidentale,
           ID IS 15,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Creazione base dati in corso. Attendere prego...",
           .

      *{TOTEM}END

      *{TOTEM}LINKPARA
       PROCEDURE  DIVISION USING LK-BLOCKPGM, USER-CODI, LIVELLO-ABIL.
      *{TOTEM}END

      *{TOTEM}DECLARATIVE
       DECLARATIVES.
      * <TOTEM:EPT. INIT:tprev, INIT:tprev, BeforeDeclarative>
       PROMOEVA-ERR SECTION.
           use after error procedure on promoeva.
           evaluate status-promoeva
           when "35"
                display message "File [PROMOEVA] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [PROMOEVA] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[PROMOEVA] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           when "93"             
           when "99"
                set RecLocked to true
                if no-msg = 0
                   move 0 to mod
                   open input promoeva
                   display message MSG-Gia-in-uso-su-altro-terminale
                           x"0d0a" MSG-SOLA-VISUA
                             title tit-err
                              icon 2
                end-if
           end-evaluate.

      * <TOTEM:END>
       INPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON INPUT.
       0100-DECL.
           EXIT.
       I-O-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON I-O.
       0200-DECL.
           EXIT.
       OUTPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON OUTPUT.
       0300-DECL.
           EXIT.
       TRANSACTION-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON TRANSACTION.
       0400-DECL.
           EXIT.
       END DECLARATIVES.
      *{TOTEM}END

       MAIN-LOGIC.
      *{TOTEM}ENTRY-BEFPRG
      *    Before-Program
           PERFORM PAS004P-Ev-Before-Program
      *{TOTEM}END
           PERFORM INITIALIZE-ROUTINE.
      * run main screen
      *{TOTEM}RUN-MAINSCR
           PERFORM Form1-OPEN-ROUTINE.
      *{TOTEM}END

      *{TOTEM}COPY-PROCEDURE
       EXIT-STOP-ROUTINE.
           PERFORM CLOSE-FILE-RTN
      * <TOTEM:EPT. INIT:tprev, INIT:tprev, BeforeDestroyResource>
      * <TOTEM:END>
           DESTROY Verdana8B-Occidentale
           DESTROY Verdana12B-Occidentale
           DESTROY Verdana8-Occidentale
           CALL "w$bitmap" USING WBITMAP-DESTROY, FRECCIA_SU-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, FRECCIA_GIU-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, REFRESH-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, EXCEL-BMP
      *    After-Program
           PERFORM I-O-BLOCCO
           EXIT PROGRAM TOTEM-PgmStatus
           STOP RUN.

       INITIALIZE-ROUTINE.
      *    Before Init
      * initialize program status variable
           Initialize TOTEM-PgmStatus.
      * get system information
           ACCEPT SYSTEM-INFORMATION FROM SYSTEM-INFO.
      * get terminal information
           ACCEPT TERMINAL-ABILITIES FROM TERMINAL-INFO.
      * set font
           PERFORM INIT-FONT.
      * load bitmap
           PERFORM INIT-BMP.
      * load resource
           PERFORM INIT-RES.
      * create pop-up menu
           PERFORM INIT-POPUP.
      * open files
           PERFORM OPEN-FILE-RTN.
      *    After Init
           .
    
       INIT-FONT.
      * Verdana8B-Occidentale
           INITIALIZE WFONT-DATA Verdana8B-Occidentale
           MOVE 8 TO WFONT-SIZE
           MOVE "Verdana" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO TRUE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Verdana8B-Occidentale, WFONT-DATA
      * Verdana12B-Occidentale
           INITIALIZE WFONT-DATA Verdana12B-Occidentale
           MOVE 12 TO WFONT-SIZE
           MOVE "Verdana" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO TRUE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Verdana12B-Occidentale, WFONT-DATA
      * Verdana8-Occidentale
           INITIALIZE WFONT-DATA Verdana8-Occidentale
           MOVE 8 TO WFONT-SIZE
           MOVE "Verdana" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO FALSE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Verdana8-Occidentale, WFONT-DATA
           .

       INIT-BMP.
      * pb-su
           COPY RESOURCE "FRECCIA_SU.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "FRECCIA_SU.BMP", 
                   GIVING FRECCIA_SU-BMP.
      * pb-giu
           COPY RESOURCE "FRECCIA_GIU.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "FRECCIA_GIU.BMP", 
                   GIVING FRECCIA_GIU-BMP.
      * pb-reset
           COPY RESOURCE "REFRESH.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "REFRESH.BMP", 
                   GIVING REFRESH-BMP.
      * pb-stampa
           COPY RESOURCE "EXCEL.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "EXCEL.BMP", 
                   GIVING EXCEL-BMP.
           .

       INIT-RES.
           .

       INIT-POPUP.
           .

       OPEN-FILE-RTN.
      *    Before Open
           PERFORM OPEN-tpromo
           PERFORM OPEN-rpromo
           PERFORM OPEN-articoli
           PERFORM OPEN-progmag
           PERFORM OPEN-promoeva
           PERFORM OPEN-tmagaz
      *    lineseq OPEN MODE IS FALSE
      *    PERFORM OPEN-lineseq
      *    tmp-mtordini OPEN MODE IS FALSE
      *    PERFORM OPEN-tmp-mtordini
           PERFORM OPEN-mrordini
           PERFORM OPEN-mtordini
           PERFORM OPEN-clienti
           PERFORM OPEN-destini
      *    After Open
           .

       OPEN-tpromo.
      * <TOTEM:EPT. INIT:tprev, FD:tpromo, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tpromo
           IF NOT Valid-STATUS-tpromo
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:tprev, FD:tpromo, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-rpromo.
      * <TOTEM:EPT. INIT:tprev, FD:rpromo, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O rpromo
           IF STATUS-rpromo = "35"
              OPEN OUTPUT rpromo
                IF Valid-STATUS-rpromo
                   CLOSE rpromo
                   OPEN I-O rpromo
                END-IF
           END-IF
           IF NOT Valid-STATUS-rpromo
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:tprev, FD:rpromo, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-articoli.
      * <TOTEM:EPT. INIT:tprev, FD:articoli, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT articoli
           IF NOT Valid-STATUS-articoli
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:tprev, FD:articoli, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-progmag.
      * <TOTEM:EPT. INIT:tprev, FD:progmag, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT progmag
           IF NOT Valid-STATUS-progmag
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:tprev, FD:progmag, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-promoeva.
      * <TOTEM:EPT. INIT:tprev, FD:promoeva, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT promoeva
           IF NOT Valid-STATUS-promoeva
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:tprev, FD:promoeva, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tmagaz.
      * <TOTEM:EPT. INIT:tprev, FD:tmagaz, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tmagaz
           IF NOT Valid-STATUS-tmagaz
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:tprev, FD:tmagaz, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-lineseq.
      * <TOTEM:EPT. INIT:tprev, FD:lineseq, BeforeOpen>
      * <TOTEM:END>
           OPEN  OUTPUT lineseq
           IF NOT Valid-STATUS-lineseq
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:tprev, FD:lineseq, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tmp-mtordini.
      * <TOTEM:EPT. INIT:tprev, FD:tmp-mtordini, BeforeOpen>
      * <TOTEM:END>
           OPEN  OUTPUT tmp-mtordini
           IF NOT Valid-STATUS-tmp-mtordini
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:tprev, FD:tmp-mtordini, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-mrordini.
      * <TOTEM:EPT. INIT:tprev, FD:mrordini, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT mrordini
           IF NOT Valid-STATUS-mrordini
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:tprev, FD:mrordini, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-mtordini.
      * <TOTEM:EPT. INIT:tprev, FD:mtordini, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT mtordini
           IF NOT Valid-STATUS-mtordini
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:tprev, FD:mtordini, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-clienti.
      * <TOTEM:EPT. INIT:tprev, FD:clienti, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT clienti
           IF NOT Valid-STATUS-clienti
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:tprev, FD:clienti, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-destini.
      * <TOTEM:EPT. INIT:tprev, FD:destini, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT destini
           IF NOT Valid-STATUS-destini
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:tprev, FD:destini, AfterOpen>
      * <TOTEM:END>
           .

       CLOSE-FILE-RTN.
      *    Before Close
           PERFORM CLOSE-tpromo
           PERFORM CLOSE-rpromo
           PERFORM CLOSE-articoli
           PERFORM CLOSE-progmag
           PERFORM CLOSE-promoeva
           PERFORM CLOSE-tmagaz
      *    lineseq CLOSE MODE IS FALSE
      *    PERFORM CLOSE-lineseq
      *    tmp-mtordini CLOSE MODE IS FALSE
      *    PERFORM CLOSE-tmp-mtordini
           PERFORM CLOSE-mrordini
           PERFORM CLOSE-mtordini
           PERFORM CLOSE-clienti
           PERFORM CLOSE-destini
      *    After Close
           .

       CLOSE-tpromo.
      * <TOTEM:EPT. INIT:tprev, FD:tpromo, BeforeClose>
      * <TOTEM:END>
           CLOSE tpromo
           .

       CLOSE-rpromo.
      * <TOTEM:EPT. INIT:tprev, FD:rpromo, BeforeClose>
      * <TOTEM:END>
           CLOSE rpromo
           .

       CLOSE-articoli.
      * <TOTEM:EPT. INIT:tprev, FD:articoli, BeforeClose>
      * <TOTEM:END>
           CLOSE articoli
           .

       CLOSE-progmag.
      * <TOTEM:EPT. INIT:tprev, FD:progmag, BeforeClose>
      * <TOTEM:END>
           CLOSE progmag
           .

       CLOSE-promoeva.
      * <TOTEM:EPT. INIT:tprev, FD:promoeva, BeforeClose>
      * <TOTEM:END>
           CLOSE promoeva
           .

       CLOSE-tmagaz.
      * <TOTEM:EPT. INIT:tprev, FD:tmagaz, BeforeClose>
      * <TOTEM:END>
           CLOSE tmagaz
           .

       CLOSE-lineseq.
      * <TOTEM:EPT. INIT:tprev, FD:lineseq, BeforeClose>
      * <TOTEM:END>
           .

       CLOSE-tmp-mtordini.
      * <TOTEM:EPT. INIT:tprev, FD:tmp-mtordini, BeforeClose>
      * <TOTEM:END>
           .

       CLOSE-mrordini.
      * <TOTEM:EPT. INIT:tprev, FD:mrordini, BeforeClose>
      * <TOTEM:END>
           CLOSE mrordini
           .

       CLOSE-mtordini.
      * <TOTEM:EPT. INIT:tprev, FD:mtordini, BeforeClose>
      * <TOTEM:END>
           CLOSE mtordini
           .

       CLOSE-clienti.
      * <TOTEM:EPT. INIT:tprev, FD:clienti, BeforeClose>
      * <TOTEM:END>
           CLOSE clienti
           .

       CLOSE-destini.
      * <TOTEM:EPT. INIT:tprev, FD:destini, BeforeClose>
      * <TOTEM:END>
           CLOSE destini
           .

       tpromo-tpr-chiave-ricerca-MERGE-SPLITBUF.
           INITIALIZE tpromo-tpr-chiave-ricerca-SPLITBUF
           MOVE tpr-chiave-ricerca OF tpromo(1:21) TO 
           tpromo-tpr-chiave-ricerca-SPLITBUF(1:21)
           .

       tpromo-tpr-chiave-gdo-fine-MERGE-SPLITBUF.
           INITIALIZE tpromo-tpr-chiave-gdo-fine-SPLITBUF
           MOVE tpr-gdo OF tpromo(1:5) TO 
           tpromo-tpr-chiave-gdo-fine-SPLITBUF(1:5)
           MOVE tpr-fine-dpo OF tpromo(1:8) TO 
           tpromo-tpr-chiave-gdo-fine-SPLITBUF(6:8)
           MOVE tpr-ini-dpo OF tpromo(1:8) TO 
           tpromo-tpr-chiave-gdo-fine-SPLITBUF(14:8)
           .

       tpromo-tpr-chiave-fine-MERGE-SPLITBUF.
           INITIALIZE tpromo-tpr-chiave-fine-SPLITBUF
           MOVE tpr-fine-dpo OF tpromo(1:8) TO 
           tpromo-tpr-chiave-fine-SPLITBUF(1:8)
           MOVE tpr-ini-dpo OF tpromo(1:8) TO 
           tpromo-tpr-chiave-fine-SPLITBUF(9:8)
           MOVE tpr-gdo OF tpromo(1:5) TO 
           tpromo-tpr-chiave-fine-SPLITBUF(17:5)
           .

       tpromo-tpr-chiave-ini-MERGE-SPLITBUF.
           INITIALIZE tpromo-tpr-chiave-ini-SPLITBUF
           MOVE tpr-ini-dpo OF tpromo(1:8) TO 
           tpromo-tpr-chiave-ini-SPLITBUF(1:8)
           MOVE tpr-fine-dpo OF tpromo(1:8) TO 
           tpromo-tpr-chiave-ini-SPLITBUF(9:8)
           MOVE tpr-gdo OF tpromo(1:5) TO 
           tpromo-tpr-chiave-ini-SPLITBUF(17:5)
           .

       tpromo-tpr-chiave-volantino-MERGE-SPLITBUF.
           INITIALIZE tpromo-tpr-chiave-volantino-SPLITBUF
           MOVE tpr-ini-volantino OF tpromo(1:8) TO 
           tpromo-tpr-chiave-volantino-SPLITBUF(1:8)
           MOVE tpr-fine-volantino OF tpromo(1:8) TO 
           tpromo-tpr-chiave-volantino-SPLITBUF(9:8)
           MOVE tpr-gdo OF tpromo(1:5) TO 
           tpromo-tpr-chiave-volantino-SPLITBUF(17:5)
           .

       tpromo-tpr-k-fine-vol-MERGE-SPLITBUF.
           INITIALIZE tpromo-tpr-k-fine-vol-SPLITBUF
           MOVE tpr-fine-volantino OF tpromo(1:8) TO 
           tpromo-tpr-k-fine-vol-SPLITBUF(1:8)
           MOVE tpr-ini-volantino OF tpromo(1:8) TO 
           tpromo-tpr-k-fine-vol-SPLITBUF(9:8)
           MOVE tpr-gdo OF tpromo(1:5) TO 
           tpromo-tpr-k-fine-vol-SPLITBUF(17:5)
           .

       tpromo-tpr-k-data-ins-MERGE-SPLITBUF.
           INITIALIZE tpromo-tpr-k-data-ins-SPLITBUF
           MOVE tpr-data-creazione OF tpromo(1:8) TO 
           tpromo-tpr-k-data-ins-SPLITBUF(1:8)
           MOVE tpr-codice OF tpromo(1:15) TO 
           tpromo-tpr-k-data-ins-SPLITBUF(9:15)
           MOVE tpr-gdo OF tpromo(1:5) TO 
           tpromo-tpr-k-data-ins-SPLITBUF(24:5)
           .

       DataSet1-tpromo-INITSTART.
           IF DataSet1-tpromo-KEY-Asc
              MOVE Low-Value TO tpr-chiave OF tpromo
           ELSE
              MOVE High-Value TO tpr-chiave OF tpromo
           END-IF
           .

       DataSet1-tpromo-INITEND.
           IF DataSet1-tpromo-KEY-Asc
              MOVE High-Value TO tpr-chiave OF tpromo
           ELSE
              MOVE Low-Value TO tpr-chiave OF tpromo
           END-IF
           .

      * tpromo
       DataSet1-tpromo-START.
           IF DataSet1-tpromo-KEY-Asc
              START tpromo KEY >= tpr-chiave OF tpromo
           ELSE
              START tpromo KEY <= tpr-chiave OF tpromo
           END-IF
           .

       DataSet1-tpromo-START-NOTGREATER.
           IF DataSet1-tpromo-KEY-Asc
              START tpromo KEY <= tpr-chiave OF tpromo
           ELSE
              START tpromo KEY >= tpr-chiave OF tpromo
           END-IF
           .

       DataSet1-tpromo-START-GREATER.
           IF DataSet1-tpromo-KEY-Asc
              START tpromo KEY > tpr-chiave OF tpromo
           ELSE
              START tpromo KEY < tpr-chiave OF tpromo
           END-IF
           .

       DataSet1-tpromo-START-LESS.
           IF DataSet1-tpromo-KEY-Asc
              START tpromo KEY < tpr-chiave OF tpromo
           ELSE
              START tpromo KEY > tpr-chiave OF tpromo
           END-IF
           .

       DataSet1-tpromo-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tpromo-LOCK
              READ tpromo WITH LOCK 
              KEY tpr-chiave OF tpromo
           ELSE
              READ tpromo WITH NO LOCK 
              KEY tpr-chiave OF tpromo
           END-IF
           PERFORM tpromo-tpr-chiave-ricerca-MERGE-SPLITBUF
           PERFORM tpromo-tpr-chiave-gdo-fine-MERGE-SPLITBUF
           PERFORM tpromo-tpr-chiave-fine-MERGE-SPLITBUF
           PERFORM tpromo-tpr-chiave-ini-MERGE-SPLITBUF
           PERFORM tpromo-tpr-chiave-volantino-MERGE-SPLITBUF
           PERFORM tpromo-tpr-k-fine-vol-MERGE-SPLITBUF
           PERFORM tpromo-tpr-k-data-ins-MERGE-SPLITBUF
           MOVE STATUS-tpromo TO TOTEM-ERR-STAT 
           MOVE "tpromo" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tpromo-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tpromo-KEY-Asc
              IF DataSet1-tpromo-LOCK
                 READ tpromo NEXT WITH LOCK
              ELSE
                 READ tpromo NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tpromo-LOCK
                 READ tpromo PREVIOUS WITH LOCK
              ELSE
                 READ tpromo PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tpromo-tpr-chiave-ricerca-MERGE-SPLITBUF
           PERFORM tpromo-tpr-chiave-gdo-fine-MERGE-SPLITBUF
           PERFORM tpromo-tpr-chiave-fine-MERGE-SPLITBUF
           PERFORM tpromo-tpr-chiave-ini-MERGE-SPLITBUF
           PERFORM tpromo-tpr-chiave-volantino-MERGE-SPLITBUF
           PERFORM tpromo-tpr-k-fine-vol-MERGE-SPLITBUF
           PERFORM tpromo-tpr-k-data-ins-MERGE-SPLITBUF
           MOVE STATUS-tpromo TO TOTEM-ERR-STAT
           MOVE "tpromo" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tpromo-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tpromo-KEY-Asc
              IF DataSet1-tpromo-LOCK
                 READ tpromo PREVIOUS WITH LOCK
              ELSE
                 READ tpromo PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tpromo-LOCK
                 READ tpromo NEXT WITH LOCK
              ELSE
                 READ tpromo NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tpromo-tpr-chiave-ricerca-MERGE-SPLITBUF
           PERFORM tpromo-tpr-chiave-gdo-fine-MERGE-SPLITBUF
           PERFORM tpromo-tpr-chiave-fine-MERGE-SPLITBUF
           PERFORM tpromo-tpr-chiave-ini-MERGE-SPLITBUF
           PERFORM tpromo-tpr-chiave-volantino-MERGE-SPLITBUF
           PERFORM tpromo-tpr-k-fine-vol-MERGE-SPLITBUF
           PERFORM tpromo-tpr-k-data-ins-MERGE-SPLITBUF
           MOVE STATUS-tpromo TO TOTEM-ERR-STAT
           MOVE "tpromo" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tpromo-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tpromo TO TOTEM-ERR-STAT
           MOVE "tpromo" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tpromo-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tpromo TO TOTEM-ERR-STAT
           MOVE "tpromo" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tpromo-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tpromo TO TOTEM-ERR-STAT
           MOVE "tpromo" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tpromo, AfterDelete>
      * <TOTEM:END>
           .

       rpromo-k-stampa-MERGE-SPLITBUF.
           INITIALIZE rpromo-k-stampa-SPLITBUF
           MOVE rpr-codice(1:15) TO rpromo-k-stampa-SPLITBUF(1:15)
           MOVE rpr-data-creazione(1:8) TO 
           rpromo-k-stampa-SPLITBUF(16:8)
           MOVE rpr-ora-creazione(1:8) TO rpromo-k-stampa-SPLITBUF(24:8)
           .

       DataSet1-rpromo-INITSTART.
           IF DataSet1-rpromo-KEY-Asc
              MOVE Low-Value TO rpr-chiave
           ELSE
              MOVE High-Value TO rpr-chiave
           END-IF
           .

       DataSet1-rpromo-INITEND.
           IF DataSet1-rpromo-KEY-Asc
              MOVE High-Value TO rpr-chiave
           ELSE
              MOVE Low-Value TO rpr-chiave
           END-IF
           .

      * rpromo
       DataSet1-rpromo-START.
           IF DataSet1-rpromo-KEY-Asc
              START rpromo KEY >= rpr-chiave
           ELSE
              START rpromo KEY <= rpr-chiave
           END-IF
           .

       DataSet1-rpromo-START-NOTGREATER.
           IF DataSet1-rpromo-KEY-Asc
              START rpromo KEY <= rpr-chiave
           ELSE
              START rpromo KEY >= rpr-chiave
           END-IF
           .

       DataSet1-rpromo-START-GREATER.
           IF DataSet1-rpromo-KEY-Asc
              START rpromo KEY > rpr-chiave
           ELSE
              START rpromo KEY < rpr-chiave
           END-IF
           .

       DataSet1-rpromo-START-LESS.
           IF DataSet1-rpromo-KEY-Asc
              START rpromo KEY < rpr-chiave
           ELSE
              START rpromo KEY > rpr-chiave
           END-IF
           .

       DataSet1-rpromo-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:rpromo, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rpromo, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-rpromo-LOCK
              READ rpromo WITH LOCK 
              KEY rpr-chiave
           ELSE
              READ rpromo WITH NO LOCK 
              KEY rpr-chiave
           END-IF
           PERFORM rpromo-k-stampa-MERGE-SPLITBUF
           MOVE STATUS-rpromo TO TOTEM-ERR-STAT 
           MOVE "rpromo" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rpromo, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rpromo, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-rpromo-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:rpromo, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rpromo, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-rpromo-KEY-Asc
              IF DataSet1-rpromo-LOCK
                 READ rpromo NEXT WITH LOCK
              ELSE
                 READ rpromo NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-rpromo-LOCK
                 READ rpromo PREVIOUS WITH LOCK
              ELSE
                 READ rpromo PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM rpromo-k-stampa-MERGE-SPLITBUF
           MOVE STATUS-rpromo TO TOTEM-ERR-STAT
           MOVE "rpromo" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rpromo, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rpromo, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-rpromo-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:rpromo, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rpromo, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-rpromo-KEY-Asc
              IF DataSet1-rpromo-LOCK
                 READ rpromo PREVIOUS WITH LOCK
              ELSE
                 READ rpromo PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-rpromo-LOCK
                 READ rpromo NEXT WITH LOCK
              ELSE
                 READ rpromo NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM rpromo-k-stampa-MERGE-SPLITBUF
           MOVE STATUS-rpromo TO TOTEM-ERR-STAT
           MOVE "rpromo" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rpromo, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rpromo, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-rpromo-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:rpromo, BeforeWrite>
      * <TOTEM:END>
           WRITE rpr-rec OF rpromo.
           MOVE STATUS-rpromo TO TOTEM-ERR-STAT
           MOVE "rpromo" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rpromo, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-rpromo-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:rpromo, BeforeRewrite>
      * <TOTEM:END>
           REWRITE rpr-rec OF rpromo.
           MOVE STATUS-rpromo TO TOTEM-ERR-STAT
           MOVE "rpromo" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rpromo, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-rpromo-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:rpromo, BeforeDelete>
      * <TOTEM:END>
           DELETE rpromo.
           MOVE STATUS-rpromo TO TOTEM-ERR-STAT
           MOVE "rpromo" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rpromo, AfterDelete>
      * <TOTEM:END>
           .

       articoli-art-k1-MERGE-SPLITBUF.
           INITIALIZE articoli-art-k1-SPLITBUF
           MOVE art-descrizione OF articoli(1:50) TO 
           articoli-art-k1-SPLITBUF(1:50)
           .

       articoli-art-k-frn-MERGE-SPLITBUF.
           INITIALIZE articoli-art-k-frn-SPLITBUF
           MOVE art-cod-art-frn OF articoli(1:15) TO 
           articoli-art-k-frn-SPLITBUF(1:15)
           .

       DataSet1-articoli-INITSTART.
           IF DataSet1-articoli-KEY-Asc
              MOVE Low-Value TO art-chiave OF articoli
           ELSE
              MOVE High-Value TO art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-INITEND.
           IF DataSet1-articoli-KEY-Asc
              MOVE High-Value TO art-chiave OF articoli
           ELSE
              MOVE Low-Value TO art-chiave OF articoli
           END-IF
           .

      * articoli
       DataSet1-articoli-START.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY >= art-chiave OF articoli
           ELSE
              START articoli KEY <= art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-START-NOTGREATER.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY <= art-chiave OF articoli
           ELSE
              START articoli KEY >= art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-START-GREATER.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY > art-chiave OF articoli
           ELSE
              START articoli KEY < art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-START-LESS.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY < art-chiave OF articoli
           ELSE
              START articoli KEY > art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-articoli-LOCK
              READ articoli WITH LOCK 
              KEY art-chiave OF articoli
           ELSE
              READ articoli WITH NO LOCK 
              KEY art-chiave OF articoli
           END-IF
           PERFORM articoli-art-k1-MERGE-SPLITBUF
           PERFORM articoli-art-k-frn-MERGE-SPLITBUF
           MOVE STATUS-articoli TO TOTEM-ERR-STAT 
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-articoli-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-articoli-KEY-Asc
              IF DataSet1-articoli-LOCK
                 READ articoli NEXT WITH LOCK
              ELSE
                 READ articoli NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-articoli-LOCK
                 READ articoli PREVIOUS WITH LOCK
              ELSE
                 READ articoli PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM articoli-art-k1-MERGE-SPLITBUF
           PERFORM articoli-art-k-frn-MERGE-SPLITBUF
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-articoli-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-articoli-KEY-Asc
              IF DataSet1-articoli-LOCK
                 READ articoli PREVIOUS WITH LOCK
              ELSE
                 READ articoli PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-articoli-LOCK
                 READ articoli NEXT WITH LOCK
              ELSE
                 READ articoli NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM articoli-art-k1-MERGE-SPLITBUF
           PERFORM articoli-art-k-frn-MERGE-SPLITBUF
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-articoli-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-articoli-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-articoli-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterDelete>
      * <TOTEM:END>
           .

       progmag-key01-MERGE-SPLITBUF.
           INITIALIZE progmag-key01-SPLITBUF
           MOVE prg-cod-magazzino OF progmag(1:3) TO 
           progmag-key01-SPLITBUF(1:3)
           MOVE prg-cod-articolo OF progmag(1:6) TO 
           progmag-key01-SPLITBUF(4:6)
           MOVE prg-tipo-imballo OF progmag(1:3) TO 
           progmag-key01-SPLITBUF(10:3)
           MOVE prg-peso OF progmag(1:8) TO progmag-key01-SPLITBUF(13:8)
           .

       DataSet1-progmag-INITSTART.
           IF DataSet1-progmag-KEY-Asc
              MOVE Low-Value TO prg-chiave OF progmag
           ELSE
              MOVE High-Value TO prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-INITEND.
           IF DataSet1-progmag-KEY-Asc
              MOVE High-Value TO prg-chiave OF progmag
           ELSE
              MOVE Low-Value TO prg-chiave OF progmag
           END-IF
           .

      * progmag
       DataSet1-progmag-START.
           IF DataSet1-progmag-KEY-Asc
              START progmag KEY >= prg-chiave OF progmag
           ELSE
              START progmag KEY <= prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-START-NOTGREATER.
           IF DataSet1-progmag-KEY-Asc
              START progmag KEY <= prg-chiave OF progmag
           ELSE
              START progmag KEY >= prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-START-GREATER.
           IF DataSet1-progmag-KEY-Asc
              START progmag KEY > prg-chiave OF progmag
           ELSE
              START progmag KEY < prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-START-LESS.
           IF DataSet1-progmag-KEY-Asc
              START progmag KEY < prg-chiave OF progmag
           ELSE
              START progmag KEY > prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-progmag-LOCK
              READ progmag WITH LOCK 
              KEY prg-chiave OF progmag
           ELSE
              READ progmag WITH NO LOCK 
              KEY prg-chiave OF progmag
           END-IF
           PERFORM progmag-key01-MERGE-SPLITBUF
           MOVE STATUS-progmag TO TOTEM-ERR-STAT 
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-progmag-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-progmag-KEY-Asc
              IF DataSet1-progmag-LOCK
                 READ progmag NEXT WITH LOCK
              ELSE
                 READ progmag NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-progmag-LOCK
                 READ progmag PREVIOUS WITH LOCK
              ELSE
                 READ progmag PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM progmag-key01-MERGE-SPLITBUF
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-progmag-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-progmag-KEY-Asc
              IF DataSet1-progmag-LOCK
                 READ progmag PREVIOUS WITH LOCK
              ELSE
                 READ progmag PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-progmag-LOCK
                 READ progmag NEXT WITH LOCK
              ELSE
                 READ progmag NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM progmag-key01-MERGE-SPLITBUF
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-progmag-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-progmag-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-progmag-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterDelete>
      * <TOTEM:END>
           .

       promoeva-pev-k-art-MERGE-SPLITBUF.
           INITIALIZE promoeva-pev-k-art-SPLITBUF
           MOVE pev-articolo OF promoeva(1:6) TO 
           promoeva-pev-k-art-SPLITBUF(1:6)
           MOVE pev-tpr-codice OF promoeva(1:15) TO 
           promoeva-pev-k-art-SPLITBUF(7:15)
           .

       promoeva-pev-k-descr-art-MERGE-SPLITBUF.
           INITIALIZE promoeva-pev-k-descr-art-SPLITBUF
           MOVE pev-descr-art OF promoeva(1:50) TO 
           promoeva-pev-k-descr-art-SPLITBUF(1:50)
           MOVE pev-chiave OF promoeva(1:14) TO 
           promoeva-pev-k-descr-art-SPLITBUF(51:14)
           .

       promoeva-pev-k-gdo-MERGE-SPLITBUF.
           INITIALIZE promoeva-pev-k-gdo-SPLITBUF
           MOVE pev-gdo OF promoeva(1:5) TO 
           promoeva-pev-k-gdo-SPLITBUF(1:5)
           MOVE pev-descr-art OF promoeva(1:50) TO 
           promoeva-pev-k-gdo-SPLITBUF(6:50)
           MOVE pev-chiave OF promoeva(1:14) TO 
           promoeva-pev-k-gdo-SPLITBUF(56:14)
           .

       promoeva-pev-k-fittizia-MERGE-SPLITBUF.
           INITIALIZE promoeva-pev-k-fittizia-SPLITBUF
           MOVE pev-fittizia OF promoeva(1:1) TO 
           promoeva-pev-k-fittizia-SPLITBUF(1:1)
           MOVE pev-chiave OF promoeva(1:14) TO 
           promoeva-pev-k-fittizia-SPLITBUF(2:14)
           .

       promoeva-pev-k-promo-MERGE-SPLITBUF.
           INITIALIZE promoeva-pev-k-promo-SPLITBUF
           MOVE pev-tpr-codice OF promoeva(1:15) TO 
           promoeva-pev-k-promo-SPLITBUF(1:15)
           MOVE pev-chiave OF promoeva(1:14) TO 
           promoeva-pev-k-promo-SPLITBUF(16:14)
           .

       promoeva-pev-k-descr-promo-MERGE-SPLITBUF.
           INITIALIZE promoeva-pev-k-descr-promo-SPLITBUF
           MOVE pev-tpr-descrizione OF promoeva(1:50) TO 
           promoeva-pev-k-descr-promo-SPLITBUF(1:50)
           MOVE pev-chiave OF promoeva(1:14) TO 
           promoeva-pev-k-descr-promo-SPLITBUF(51:14)
           .

       DataSet1-promoeva-INITSTART.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-promoeva-KEY1-Asc
                 MOVE Low-Value TO pev-chiave OF promoeva
              ELSE
                 MOVE High-Value TO pev-chiave OF promoeva
              END-IF
           END-EVALUATE
           .

       DataSet1-promoeva-INITEND.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-promoeva-KEY1-Asc
                 MOVE High-Value TO pev-chiave OF promoeva
              ELSE
                 MOVE Low-Value TO pev-chiave OF promoeva
              END-IF
           END-EVALUATE
           .

       DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           .   

       DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-promoeva-KEY1-ORDER
           END-EVALUATE
           .

       DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-promoeva-KEY1-ORDER
           END-EVALUATE
           .

      * promoeva
       DataSet1-promoeva-START.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-promoeva-KEY1-Asc
                 START promoeva KEY >= pev-chiave OF promoeva
              ELSE
                 START promoeva KEY <= pev-chiave OF promoeva
              END-IF
           END-EVALUATE
           .

       DataSet1-promoeva-START-NOTGREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-promoeva-KEY1-Asc
                 START promoeva KEY <= pev-chiave OF promoeva
              ELSE
                 START promoeva KEY >= pev-chiave OF promoeva
              END-IF
           END-EVALUATE
           .

       DataSet1-promoeva-START-GREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-promoeva-KEY1-Asc
                 START promoeva KEY > pev-chiave OF promoeva
              ELSE
                 START promoeva KEY < pev-chiave OF promoeva
              END-IF
           END-EVALUATE
           .

       DataSet1-promoeva-START-LESS.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-promoeva-KEY1-Asc
                 START promoeva KEY < pev-chiave OF promoeva
              ELSE
                 START promoeva KEY > pev-chiave OF promoeva
              END-IF
           END-EVALUATE
           .

       DataSet1-promoeva-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:promoeva, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:promoeva, BeforeReadRecord>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-promoeva-LOCK
                 READ promoeva WITH LOCK 
                 KEY pev-chiave OF promoeva
              ELSE
                 READ promoeva WITH NO LOCK 
                 KEY pev-chiave OF promoeva
              END-IF
           END-EVALUATE
           PERFORM promoeva-pev-k-art-MERGE-SPLITBUF
           PERFORM promoeva-pev-k-descr-art-MERGE-SPLITBUF
           PERFORM promoeva-pev-k-gdo-MERGE-SPLITBUF
           PERFORM promoeva-pev-k-fittizia-MERGE-SPLITBUF
           PERFORM promoeva-pev-k-promo-MERGE-SPLITBUF
           PERFORM promoeva-pev-k-descr-promo-MERGE-SPLITBUF
           MOVE STATUS-promoeva TO TOTEM-ERR-STAT 
           MOVE "promoeva" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:promoeva, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:promoeva, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-promoeva-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:promoeva, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:promoeva, BeforeReadNext>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-promoeva-KEY1-Asc
                 IF DataSet1-promoeva-LOCK
                    READ promoeva NEXT WITH LOCK
                 ELSE
                    READ promoeva NEXT WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-promoeva-LOCK
                    READ promoeva PREVIOUS WITH LOCK
                 ELSE
                    READ promoeva PREVIOUS WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           PERFORM promoeva-pev-k-art-MERGE-SPLITBUF
           PERFORM promoeva-pev-k-descr-art-MERGE-SPLITBUF
           PERFORM promoeva-pev-k-gdo-MERGE-SPLITBUF
           PERFORM promoeva-pev-k-fittizia-MERGE-SPLITBUF
           PERFORM promoeva-pev-k-promo-MERGE-SPLITBUF
           PERFORM promoeva-pev-k-descr-promo-MERGE-SPLITBUF
           MOVE STATUS-promoeva TO TOTEM-ERR-STAT
           MOVE "promoeva" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:promoeva, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:promoeva, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-promoeva-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:promoeva, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:promoeva, BeforeReadPrev>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-promoeva-KEY1-Asc
                 IF DataSet1-promoeva-LOCK
                    READ promoeva PREVIOUS WITH LOCK
                 ELSE
                    READ promoeva PREVIOUS WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-promoeva-LOCK
                    READ promoeva NEXT WITH LOCK
                 ELSE
                    READ promoeva NEXT WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           PERFORM promoeva-pev-k-art-MERGE-SPLITBUF
           PERFORM promoeva-pev-k-descr-art-MERGE-SPLITBUF
           PERFORM promoeva-pev-k-gdo-MERGE-SPLITBUF
           PERFORM promoeva-pev-k-fittizia-MERGE-SPLITBUF
           PERFORM promoeva-pev-k-promo-MERGE-SPLITBUF
           PERFORM promoeva-pev-k-descr-promo-MERGE-SPLITBUF
           MOVE STATUS-promoeva TO TOTEM-ERR-STAT
           MOVE "promoeva" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:promoeva, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:promoeva, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-promoeva-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:promoeva, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-promoeva TO TOTEM-ERR-STAT
           MOVE "promoeva" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:promoeva, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-promoeva-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:promoeva, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-promoeva TO TOTEM-ERR-STAT
           MOVE "promoeva" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:promoeva, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-promoeva-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:promoeva, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-promoeva TO TOTEM-ERR-STAT
           MOVE "promoeva" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:promoeva, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tmagaz-INITSTART.
           IF DataSet1-tmagaz-KEY-Asc
              MOVE Low-Value TO mag-chiave
           ELSE
              MOVE High-Value TO mag-chiave
           END-IF
           .

       DataSet1-tmagaz-INITEND.
           IF DataSet1-tmagaz-KEY-Asc
              MOVE High-Value TO mag-chiave
           ELSE
              MOVE Low-Value TO mag-chiave
           END-IF
           .

      * tmagaz
       DataSet1-tmagaz-START.
           IF DataSet1-tmagaz-KEY-Asc
              START tmagaz KEY >= mag-chiave
           ELSE
              START tmagaz KEY <= mag-chiave
           END-IF
           .

       DataSet1-tmagaz-START-NOTGREATER.
           IF DataSet1-tmagaz-KEY-Asc
              START tmagaz KEY <= mag-chiave
           ELSE
              START tmagaz KEY >= mag-chiave
           END-IF
           .

       DataSet1-tmagaz-START-GREATER.
           IF DataSet1-tmagaz-KEY-Asc
              START tmagaz KEY > mag-chiave
           ELSE
              START tmagaz KEY < mag-chiave
           END-IF
           .

       DataSet1-tmagaz-START-LESS.
           IF DataSet1-tmagaz-KEY-Asc
              START tmagaz KEY < mag-chiave
           ELSE
              START tmagaz KEY > mag-chiave
           END-IF
           .

       DataSet1-tmagaz-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tmagaz-LOCK
              READ tmagaz WITH LOCK 
              KEY mag-chiave
           ELSE
              READ tmagaz WITH NO LOCK 
              KEY mag-chiave
           END-IF
           MOVE STATUS-tmagaz TO TOTEM-ERR-STAT 
           MOVE "tmagaz" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tmagaz-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tmagaz-KEY-Asc
              IF DataSet1-tmagaz-LOCK
                 READ tmagaz NEXT WITH LOCK
              ELSE
                 READ tmagaz NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tmagaz-LOCK
                 READ tmagaz PREVIOUS WITH LOCK
              ELSE
                 READ tmagaz PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tmagaz TO TOTEM-ERR-STAT
           MOVE "tmagaz" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tmagaz-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tmagaz-KEY-Asc
              IF DataSet1-tmagaz-LOCK
                 READ tmagaz PREVIOUS WITH LOCK
              ELSE
                 READ tmagaz PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tmagaz-LOCK
                 READ tmagaz NEXT WITH LOCK
              ELSE
                 READ tmagaz NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tmagaz TO TOTEM-ERR-STAT
           MOVE "tmagaz" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tmagaz-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tmagaz TO TOTEM-ERR-STAT
           MOVE "tmagaz" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tmagaz-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tmagaz TO TOTEM-ERR-STAT
           MOVE "tmagaz" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tmagaz-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tmagaz TO TOTEM-ERR-STAT
           MOVE "tmagaz" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-lineseq-INITSTART.
           .

       DataSet1-lineseq-INITEND.
           .

       DataSet1-lineseq-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeReadRecord>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-lineseq-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeReadNext>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-lineseq-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeReadPrev>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-lineseq-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeWrite>
      * <TOTEM:END>
           WRITE line-riga OF lineseq.
           MOVE STATUS-lineseq TO TOTEM-ERR-STAT
           MOVE "lineseq" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-lineseq-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-lineseq TO TOTEM-ERR-STAT
           MOVE "lineseq" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-lineseq-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-lineseq TO TOTEM-ERR-STAT
           MOVE "lineseq" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq, AfterDelete>
      * <TOTEM:END>
           .

       tmp-mtordini-k-ord-MERGE-SPLITBUF.
           INITIALIZE tmp-mtordini-k-ord-SPLITBUF
           MOVE tmto-data-cons(1:8) TO tmp-mtordini-k-ord-SPLITBUF(1:8)
           MOVE tmto-chiave(1:12) TO tmp-mtordini-k-ord-SPLITBUF(9:12)
           .

       DataSet1-tmp-mtordini-INITSTART.
           IF DataSet1-tmp-mtordini-KEY-Asc
              MOVE Low-Value TO tmto-chiave
           ELSE
              MOVE High-Value TO tmto-chiave
           END-IF
           .

       DataSet1-tmp-mtordini-INITEND.
           IF DataSet1-tmp-mtordini-KEY-Asc
              MOVE High-Value TO tmto-chiave
           ELSE
              MOVE Low-Value TO tmto-chiave
           END-IF
           .

      * tmp-mtordini
       DataSet1-tmp-mtordini-START.
           IF DataSet1-tmp-mtordini-KEY-Asc
              START tmp-mtordini KEY >= tmto-chiave
           ELSE
              START tmp-mtordini KEY <= tmto-chiave
           END-IF
           .

       DataSet1-tmp-mtordini-START-NOTGREATER.
           IF DataSet1-tmp-mtordini-KEY-Asc
              START tmp-mtordini KEY <= tmto-chiave
           ELSE
              START tmp-mtordini KEY >= tmto-chiave
           END-IF
           .

       DataSet1-tmp-mtordini-START-GREATER.
           IF DataSet1-tmp-mtordini-KEY-Asc
              START tmp-mtordini KEY > tmto-chiave
           ELSE
              START tmp-mtordini KEY < tmto-chiave
           END-IF
           .

       DataSet1-tmp-mtordini-START-LESS.
           IF DataSet1-tmp-mtordini-KEY-Asc
              START tmp-mtordini KEY < tmto-chiave
           ELSE
              START tmp-mtordini KEY > tmto-chiave
           END-IF
           .

       DataSet1-tmp-mtordini-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-mtordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-mtordini, BeforeReadRecord>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-mtordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-mtordini, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tmp-mtordini-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-mtordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-mtordini, BeforeReadNext>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-mtordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-mtordini, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tmp-mtordini-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-mtordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-mtordini, BeforeReadPrev>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-mtordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-mtordini, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tmp-mtordini-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-mtordini, BeforeWrite>
      * <TOTEM:END>
           WRITE tmto-rec OF tmp-mtordini.
           MOVE STATUS-tmp-mtordini TO TOTEM-ERR-STAT
           MOVE "tmp-mtordini" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-mtordini, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tmp-mtordini-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-mtordini, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tmp-mtordini TO TOTEM-ERR-STAT
           MOVE "tmp-mtordini" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-mtordini, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tmp-mtordini-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-mtordini, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tmp-mtordini TO TOTEM-ERR-STAT
           MOVE "tmp-mtordini" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-mtordini, AfterDelete>
      * <TOTEM:END>
           .

       mrordini-mro-k-promo-MERGE-SPLITBUF.
           INITIALIZE mrordini-mro-k-promo-SPLITBUF
           MOVE mro-promo(1:15) TO mrordini-mro-k-promo-SPLITBUF(1:15)
           MOVE mro-chiave(1:17) TO mrordini-mro-k-promo-SPLITBUF(16:17)
           .

       mrordini-mro-k-articolo-MERGE-SPLITBUF.
           INITIALIZE mrordini-mro-k-articolo-SPLITBUF
           MOVE mro-cod-articolo(1:6) TO 
           mrordini-mro-k-articolo-SPLITBUF(1:6)
           MOVE mro-chiave(1:17) TO 
           mrordini-mro-k-articolo-SPLITBUF(7:17)
           .

       mrordini-mro-k-progr-MERGE-SPLITBUF.
           INITIALIZE mrordini-mro-k-progr-SPLITBUF
           MOVE mro-chiave-testa(1:12) TO 
           mrordini-mro-k-progr-SPLITBUF(1:12)
           MOVE mro-progr(1:5) TO mrordini-mro-k-progr-SPLITBUF(13:5)
           .

       mrordini-mro-k-tprev-MERGE-SPLITBUF.
           INITIALIZE mrordini-mro-k-tprev-SPLITBUF
           MOVE mro-promo(1:15) TO mrordini-mro-k-tprev-SPLITBUF(1:15)
           MOVE mro-prg-cod-articolo(1:6) TO 
           mrordini-mro-k-tprev-SPLITBUF(16:6)
           MOVE mro-chiave(1:17) TO mrordini-mro-k-tprev-SPLITBUF(22:17)
           .

       mrordini-mro-k-ord-art-MERGE-SPLITBUF.
           INITIALIZE mrordini-mro-k-ord-art-SPLITBUF
           MOVE mro-chiave-testa(1:12) TO 
           mrordini-mro-k-ord-art-SPLITBUF(1:12)
           MOVE mro-cod-articolo(1:6) TO 
           mrordini-mro-k-ord-art-SPLITBUF(13:6)
           .

       DataSet1-mrordini-INITSTART.
           IF DataSet1-mrordini-KEY-Asc
              MOVE Low-Value TO mro-chiave
           ELSE
              MOVE High-Value TO mro-chiave
           END-IF
           .

       DataSet1-mrordini-INITEND.
           IF DataSet1-mrordini-KEY-Asc
              MOVE High-Value TO mro-chiave
           ELSE
              MOVE Low-Value TO mro-chiave
           END-IF
           .

      * mrordini
       DataSet1-mrordini-START.
           IF DataSet1-mrordini-KEY-Asc
              START mrordini KEY >= mro-chiave
           ELSE
              START mrordini KEY <= mro-chiave
           END-IF
           .

       DataSet1-mrordini-START-NOTGREATER.
           IF DataSet1-mrordini-KEY-Asc
              START mrordini KEY <= mro-chiave
           ELSE
              START mrordini KEY >= mro-chiave
           END-IF
           .

       DataSet1-mrordini-START-GREATER.
           IF DataSet1-mrordini-KEY-Asc
              START mrordini KEY > mro-chiave
           ELSE
              START mrordini KEY < mro-chiave
           END-IF
           .

       DataSet1-mrordini-START-LESS.
           IF DataSet1-mrordini-KEY-Asc
              START mrordini KEY < mro-chiave
           ELSE
              START mrordini KEY > mro-chiave
           END-IF
           .

       DataSet1-mrordini-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-mrordini-LOCK
              READ mrordini WITH LOCK 
              KEY mro-chiave
           ELSE
              READ mrordini WITH NO LOCK 
              KEY mro-chiave
           END-IF
           PERFORM mrordini-mro-k-promo-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-articolo-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-progr-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-tprev-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-ord-art-MERGE-SPLITBUF
           MOVE STATUS-mrordini TO TOTEM-ERR-STAT 
           MOVE "mrordini" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-mrordini-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-mrordini-KEY-Asc
              IF DataSet1-mrordini-LOCK
                 READ mrordini NEXT WITH LOCK
              ELSE
                 READ mrordini NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-mrordini-LOCK
                 READ mrordini PREVIOUS WITH LOCK
              ELSE
                 READ mrordini PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM mrordini-mro-k-promo-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-articolo-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-progr-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-tprev-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-ord-art-MERGE-SPLITBUF
           MOVE STATUS-mrordini TO TOTEM-ERR-STAT
           MOVE "mrordini" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-mrordini-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-mrordini-KEY-Asc
              IF DataSet1-mrordini-LOCK
                 READ mrordini PREVIOUS WITH LOCK
              ELSE
                 READ mrordini PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-mrordini-LOCK
                 READ mrordini NEXT WITH LOCK
              ELSE
                 READ mrordini NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM mrordini-mro-k-promo-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-articolo-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-progr-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-tprev-MERGE-SPLITBUF
           PERFORM mrordini-mro-k-ord-art-MERGE-SPLITBUF
           MOVE STATUS-mrordini TO TOTEM-ERR-STAT
           MOVE "mrordini" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-mrordini-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-mrordini TO TOTEM-ERR-STAT
           MOVE "mrordini" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-mrordini-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-mrordini TO TOTEM-ERR-STAT
           MOVE "mrordini" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-mrordini-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-mrordini TO TOTEM-ERR-STAT
           MOVE "mrordini" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mrordini, AfterDelete>
      * <TOTEM:END>
           .

       mtordini-mto-k-ord-cli-MERGE-SPLITBUF.
           INITIALIZE mtordini-mto-k-ord-cli-SPLITBUF
           MOVE mto-anno(1:4) TO mtordini-mto-k-ord-cli-SPLITBUF(1:4)
           MOVE mto-num-ord-cli(1:50) TO 
           mtordini-mto-k-ord-cli-SPLITBUF(5:50)
           .

       mtordini-mto-k-data-MERGE-SPLITBUF.
           INITIALIZE mtordini-mto-k-data-SPLITBUF
           MOVE mto-data-ordine(1:8) TO 
           mtordini-mto-k-data-SPLITBUF(1:8)
           MOVE mto-chiave(1:12) TO mtordini-mto-k-data-SPLITBUF(9:12)
           .

       mtordini-mto-k-clides-MERGE-SPLITBUF.
           INITIALIZE mtordini-mto-k-clides-SPLITBUF
           MOVE mto-cod-cli(1:5) TO mtordini-mto-k-clides-SPLITBUF(1:5)
           MOVE mto-prg-destino(1:5) TO 
           mtordini-mto-k-clides-SPLITBUF(6:5)
           MOVE mto-data-ordine(1:8) TO 
           mtordini-mto-k-clides-SPLITBUF(11:8)
           .

       mtordini-mto-k-age-MERGE-SPLITBUF.
           INITIALIZE mtordini-mto-k-age-SPLITBUF
           MOVE mto-cod-agente(1:5) TO mtordini-mto-k-age-SPLITBUF(1:5)
           MOVE mto-data-ordine(1:8) TO mtordini-mto-k-age-SPLITBUF(6:8)
           .

       mtordini-k-mto-stato-sel-MERGE-SPLITBUF.
           INITIALIZE mtordini-k-mto-stato-sel-SPLITBUF
           MOVE mto-stato-ordine(1:1) TO 
           mtordini-k-mto-stato-sel-SPLITBUF(1:1)
           MOVE mto-cod-cli(1:5) TO 
           mtordini-k-mto-stato-sel-SPLITBUF(2:5)
           MOVE mto-data-ordine(1:8) TO 
           mtordini-k-mto-stato-sel-SPLITBUF(7:8)
           .

       mtordini-k-mto-stato-MERGE-SPLITBUF.
           INITIALIZE mtordini-k-mto-stato-SPLITBUF
           MOVE mto-stato-ordine(1:1) TO 
           mtordini-k-mto-stato-SPLITBUF(1:1)
           MOVE mto-chiave(1:12) TO mtordini-k-mto-stato-SPLITBUF(2:12)
           .

       mtordini-mto-k-gdo-MERGE-SPLITBUF.
           INITIALIZE mtordini-mto-k-gdo-SPLITBUF
           MOVE mto-gdo(1:5) TO mtordini-mto-k-gdo-SPLITBUF(1:5)
           MOVE mto-data-ordine(1:8) TO mtordini-mto-k-gdo-SPLITBUF(6:8)
           MOVE mto-chiave(1:12) TO mtordini-mto-k-gdo-SPLITBUF(14:12)
           .

       mtordini-mto-k-bloc-MERGE-SPLITBUF.
           INITIALIZE mtordini-mto-k-bloc-SPLITBUF
           MOVE mto-stato-attivazione(1:1) TO 
           mtordini-mto-k-bloc-SPLITBUF(1:1)
           MOVE mto-data-ordine(1:8) TO 
           mtordini-mto-k-bloc-SPLITBUF(2:8)
           MOVE mto-cod-cli(1:5) TO mtordini-mto-k-bloc-SPLITBUF(10:5)
           MOVE mto-prg-destino(1:5) TO 
           mtordini-mto-k-bloc-SPLITBUF(15:5)
           .

       mtordini-k-giang-MERGE-SPLITBUF.
           INITIALIZE mtordini-k-giang-SPLITBUF
           MOVE mto-data-note1(1:8) TO mtordini-k-giang-SPLITBUF(1:8)
           MOVE mto-chiave(1:12) TO mtordini-k-giang-SPLITBUF(9:12)
           .

       mtordini-mto-k-promo-MERGE-SPLITBUF.
           INITIALIZE mtordini-mto-k-promo-SPLITBUF
           MOVE mto-promo(1:1) TO mtordini-mto-k-promo-SPLITBUF(1:1)
           MOVE mto-tipo-CF(1:1) TO mtordini-mto-k-promo-SPLITBUF(2:1)
           MOVE mto-cod-cli(1:5) TO mtordini-mto-k-promo-SPLITBUF(3:5)
           MOVE mto-prg-destino(1:5) TO 
           mtordini-mto-k-promo-SPLITBUF(8:5)
           MOVE mto-chiave(1:12) TO mtordini-mto-k-promo-SPLITBUF(13:12)
           .

       DataSet1-mtordini-INITSTART.
           IF DataSet1-mtordini-KEY-Asc
              MOVE Low-Value TO mto-chiave
           ELSE
              MOVE High-Value TO mto-chiave
           END-IF
           .

       DataSet1-mtordini-INITEND.
           IF DataSet1-mtordini-KEY-Asc
              MOVE High-Value TO mto-chiave
           ELSE
              MOVE Low-Value TO mto-chiave
           END-IF
           .

      * mtordini
       DataSet1-mtordini-START.
           IF DataSet1-mtordini-KEY-Asc
              START mtordini KEY >= mto-chiave
           ELSE
              START mtordini KEY <= mto-chiave
           END-IF
           .

       DataSet1-mtordini-START-NOTGREATER.
           IF DataSet1-mtordini-KEY-Asc
              START mtordini KEY <= mto-chiave
           ELSE
              START mtordini KEY >= mto-chiave
           END-IF
           .

       DataSet1-mtordini-START-GREATER.
           IF DataSet1-mtordini-KEY-Asc
              START mtordini KEY > mto-chiave
           ELSE
              START mtordini KEY < mto-chiave
           END-IF
           .

       DataSet1-mtordini-START-LESS.
           IF DataSet1-mtordini-KEY-Asc
              START mtordini KEY < mto-chiave
           ELSE
              START mtordini KEY > mto-chiave
           END-IF
           .

       DataSet1-mtordini-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-mtordini-LOCK
              READ mtordini WITH LOCK 
              KEY mto-chiave
           ELSE
              READ mtordini WITH NO LOCK 
              KEY mto-chiave
           END-IF
           PERFORM mtordini-mto-k-ord-cli-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-data-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-clides-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-age-MERGE-SPLITBUF
           PERFORM mtordini-k-mto-stato-sel-MERGE-SPLITBUF
           PERFORM mtordini-k-mto-stato-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-gdo-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-bloc-MERGE-SPLITBUF
           PERFORM mtordini-k-giang-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-promo-MERGE-SPLITBUF
           MOVE STATUS-mtordini TO TOTEM-ERR-STAT 
           MOVE "mtordini" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-mtordini-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-mtordini-KEY-Asc
              IF DataSet1-mtordini-LOCK
                 READ mtordini NEXT WITH LOCK
              ELSE
                 READ mtordini NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-mtordini-LOCK
                 READ mtordini PREVIOUS WITH LOCK
              ELSE
                 READ mtordini PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM mtordini-mto-k-ord-cli-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-data-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-clides-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-age-MERGE-SPLITBUF
           PERFORM mtordini-k-mto-stato-sel-MERGE-SPLITBUF
           PERFORM mtordini-k-mto-stato-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-gdo-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-bloc-MERGE-SPLITBUF
           PERFORM mtordini-k-giang-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-promo-MERGE-SPLITBUF
           MOVE STATUS-mtordini TO TOTEM-ERR-STAT
           MOVE "mtordini" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-mtordini-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-mtordini-KEY-Asc
              IF DataSet1-mtordini-LOCK
                 READ mtordini PREVIOUS WITH LOCK
              ELSE
                 READ mtordini PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-mtordini-LOCK
                 READ mtordini NEXT WITH LOCK
              ELSE
                 READ mtordini NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM mtordini-mto-k-ord-cli-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-data-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-clides-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-age-MERGE-SPLITBUF
           PERFORM mtordini-k-mto-stato-sel-MERGE-SPLITBUF
           PERFORM mtordini-k-mto-stato-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-gdo-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-bloc-MERGE-SPLITBUF
           PERFORM mtordini-k-giang-MERGE-SPLITBUF
           PERFORM mtordini-mto-k-promo-MERGE-SPLITBUF
           MOVE STATUS-mtordini TO TOTEM-ERR-STAT
           MOVE "mtordini" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-mtordini-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-mtordini TO TOTEM-ERR-STAT
           MOVE "mtordini" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-mtordini-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-mtordini TO TOTEM-ERR-STAT
           MOVE "mtordini" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-mtordini-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-mtordini TO TOTEM-ERR-STAT
           MOVE "mtordini" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:mtordini, AfterDelete>
      * <TOTEM:END>
           .

       clienti-cli-K1-MERGE-SPLITBUF.
           INITIALIZE clienti-cli-K1-SPLITBUF
           MOVE cli-tipo-CF OF clienti(1:1) TO 
           clienti-cli-K1-SPLITBUF(1:1)
           MOVE cli-ragsoc-1 OF clienti(1:40) TO 
           clienti-cli-K1-SPLITBUF(2:40)
           MOVE cli-codice OF clienti(1:5) TO 
           clienti-cli-K1-SPLITBUF(42:5)
           .

       clienti-cli-K3-MERGE-SPLITBUF.
           INITIALIZE clienti-cli-K3-SPLITBUF
           MOVE cli-gdo OF clienti(1:5) TO clienti-cli-K3-SPLITBUF(1:5)
           MOVE cli-chiave OF clienti(1:6) TO 
           clienti-cli-K3-SPLITBUF(6:6)
           .

       clienti-cli-K4-MERGE-SPLITBUF.
           INITIALIZE clienti-cli-K4-SPLITBUF
           MOVE cli-utf OF clienti(1:1) TO clienti-cli-K4-SPLITBUF(1:1)
           MOVE cli-chiave OF clienti(1:6) TO 
           clienti-cli-K4-SPLITBUF(2:6)
           .

       DataSet1-clienti-INITSTART.
           IF DataSet1-clienti-KEY-Asc
              MOVE Low-Value TO cli-chiave OF clienti
           ELSE
              MOVE High-Value TO cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-INITEND.
           IF DataSet1-clienti-KEY-Asc
              MOVE High-Value TO cli-chiave OF clienti
           ELSE
              MOVE Low-Value TO cli-chiave OF clienti
           END-IF
           .

      * clienti
       DataSet1-clienti-START.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY >= cli-chiave OF clienti
           ELSE
              START clienti KEY <= cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-START-NOTGREATER.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY <= cli-chiave OF clienti
           ELSE
              START clienti KEY >= cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-START-GREATER.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY > cli-chiave OF clienti
           ELSE
              START clienti KEY < cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-START-LESS.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY < cli-chiave OF clienti
           ELSE
              START clienti KEY > cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-clienti-LOCK
              READ clienti WITH LOCK 
              KEY cli-chiave OF clienti
           ELSE
              READ clienti WITH NO LOCK 
              KEY cli-chiave OF clienti
           END-IF
           PERFORM clienti-cli-K1-MERGE-SPLITBUF
           PERFORM clienti-cli-K3-MERGE-SPLITBUF
           PERFORM clienti-cli-K4-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT 
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-clienti-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-clienti-KEY-Asc
              IF DataSet1-clienti-LOCK
                 READ clienti NEXT WITH LOCK
              ELSE
                 READ clienti NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-clienti-LOCK
                 READ clienti PREVIOUS WITH LOCK
              ELSE
                 READ clienti PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM clienti-cli-K1-MERGE-SPLITBUF
           PERFORM clienti-cli-K3-MERGE-SPLITBUF
           PERFORM clienti-cli-K4-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-clienti-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-clienti-KEY-Asc
              IF DataSet1-clienti-LOCK
                 READ clienti PREVIOUS WITH LOCK
              ELSE
                 READ clienti PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-clienti-LOCK
                 READ clienti NEXT WITH LOCK
              ELSE
                 READ clienti NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM clienti-cli-K1-MERGE-SPLITBUF
           PERFORM clienti-cli-K3-MERGE-SPLITBUF
           PERFORM clienti-cli-K4-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterDelete>
      * <TOTEM:END>
           .

       destini-K1-MERGE-SPLITBUF.
           INITIALIZE destini-K1-SPLITBUF
           MOVE des-ragsoc-1(1:100) TO destini-K1-SPLITBUF(1:100)
           MOVE des-codice(1:5) TO destini-K1-SPLITBUF(101:5)
           MOVE des-prog(1:5) TO destini-K1-SPLITBUF(106:5)
           .

       destini-k-localita-MERGE-SPLITBUF.
           INITIALIZE destini-k-localita-SPLITBUF
           MOVE des-localita(1:35) TO destini-k-localita-SPLITBUF(1:35)
           .

       DataSet1-destini-INITSTART.
           IF DataSet1-destini-KEY-Asc
              MOVE Low-Value TO des-chiave
           ELSE
              MOVE High-Value TO des-chiave
           END-IF
           .

       DataSet1-destini-INITEND.
           IF DataSet1-destini-KEY-Asc
              MOVE High-Value TO des-chiave
           ELSE
              MOVE Low-Value TO des-chiave
           END-IF
           .

      * destini
       DataSet1-destini-START.
           IF DataSet1-destini-KEY-Asc
              START destini KEY >= des-chiave
           ELSE
              START destini KEY <= des-chiave
           END-IF
           .

       DataSet1-destini-START-NOTGREATER.
           IF DataSet1-destini-KEY-Asc
              START destini KEY <= des-chiave
           ELSE
              START destini KEY >= des-chiave
           END-IF
           .

       DataSet1-destini-START-GREATER.
           IF DataSet1-destini-KEY-Asc
              START destini KEY > des-chiave
           ELSE
              START destini KEY < des-chiave
           END-IF
           .

       DataSet1-destini-START-LESS.
           IF DataSet1-destini-KEY-Asc
              START destini KEY < des-chiave
           ELSE
              START destini KEY > des-chiave
           END-IF
           .

       DataSet1-destini-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-destini-LOCK
              READ destini WITH LOCK 
              KEY des-chiave
           ELSE
              READ destini WITH NO LOCK 
              KEY des-chiave
           END-IF
           PERFORM destini-K1-MERGE-SPLITBUF
           PERFORM destini-k-localita-MERGE-SPLITBUF
           MOVE STATUS-destini TO TOTEM-ERR-STAT 
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-destini-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-destini-KEY-Asc
              IF DataSet1-destini-LOCK
                 READ destini NEXT WITH LOCK
              ELSE
                 READ destini NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-destini-LOCK
                 READ destini PREVIOUS WITH LOCK
              ELSE
                 READ destini PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM destini-K1-MERGE-SPLITBUF
           PERFORM destini-k-localita-MERGE-SPLITBUF
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-destini-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-destini-KEY-Asc
              IF DataSet1-destini-LOCK
                 READ destini PREVIOUS WITH LOCK
              ELSE
                 READ destini PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-destini-LOCK
                 READ destini NEXT WITH LOCK
              ELSE
                 READ destini NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM destini-K1-MERGE-SPLITBUF
           PERFORM destini-k-localita-MERGE-SPLITBUF
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-destini-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-destini-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-destini-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-INIT-RECORD.
           INITIALIZE tpr-rec OF tpromo
           INITIALIZE rpr-rec OF rpromo
           INITIALIZE art-rec OF articoli
           INITIALIZE prg-rec OF progmag
           INITIALIZE pev-rec OF promoeva
           INITIALIZE mag-rec OF tmagaz
           INITIALIZE line-riga OF lineseq
           INITIALIZE tmto-rec OF tmp-mtordini
           INITIALIZE mro-rec OF mrordini
           INITIALIZE mto-rec OF mtordini
           INITIALIZE cli-rec OF clienti
           INITIALIZE des-rec OF destini
           .


      * GRID
       form1-gd-1-Content.
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 1, Y = 1,
                CELL-DATA = "Art.",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 2, Y = 1,
                CELL-COLOR = 5,
                CELL-FONT Verdana8B-Occidentale,
                CELL-DATA = "Descrizione",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 3, Y = 1,
                CELL-DATA = "Dt Ins.",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 4, Y = 1,
                CELL-DATA = "Promo",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 5, Y = 1,
                CELL-DATA = "Descrizione",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 6, Y = 1,
                CELL-DATA = "GDO",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 7, Y = 1,
                CELL-DATA = "Ini Vol",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 8, Y = 1,
                CELL-DATA = "Fine Vol",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 9, Y = 1,
                CELL-DATA = "SOS",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 10, Y = 1,
                CELL-DATA = "Prenot",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 11, Y = 1,
                CELL-DATA = "Evasa",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 12, Y = 1,
                CELL-DATA = "Boll",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 13, Y = 1,
                CELL-DATA = "Rim.za",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 14, Y = 1,
                CELL-DATA = "Imp. M",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 15, Y = 1,
                CELL-DATA = "G. Utile",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 16, Y = 1,
                CELL-DATA = "Pren. QTA",
      * COLUMNS' SETTING
              MODIFY form1-gd-1, X = 10  
                COLUMN-COLOR = 432,
                COLUMN-FONT = Large-Font,
           .

      * FD's Initialize Paragraph
       DataSet1-tpromo-INITREC.
           INITIALIZE tpr-rec OF tpromo
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-rpromo-INITREC.
           INITIALIZE rpr-rec OF rpromo
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-articoli-INITREC.
           INITIALIZE art-rec OF articoli
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-progmag-INITREC.
           INITIALIZE prg-rec OF progmag
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-promoeva-INITREC.
           INITIALIZE pev-rec OF promoeva
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tmagaz-INITREC.
           INITIALIZE mag-rec OF tmagaz
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-lineseq-INITREC.
           INITIALIZE line-riga OF lineseq
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tmp-mtordini-INITREC.
           INITIALIZE tmto-rec OF tmp-mtordini
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-mrordini-INITREC.
           INITIALIZE mro-rec OF mrordini
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-mtordini-INITREC.
           INITIALIZE mto-rec OF mtordini
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-clienti-INITREC.
           INITIALIZE cli-rec OF clienti
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-destini-INITREC.
           INITIALIZE des-rec OF destini
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      *
       DataSet1-DISPATCH-BUFTOFLD.
           EVALUATE TOTEM-Form-Index ALSO TOTEM-Frame-Index
              WHEN 1 ALSO 0
                  PERFORM Form1-Buf-To-Fld
           END-EVALUATE
           .

       Form1-Open-Routine.
           PERFORM Form1-Scrn
           PERFORM Form1-Proc
           .

       Form1-Scrn.
           PERFORM Form1-Create-Win
           PERFORM Form1-Init-Value
           PERFORM Form1-Init-Data
      * Tab keystrok settings
      * Tool Bar
           PERFORM Form1-DISPLAY
           .

       Form1-Create-Win.
           Display Independent GRAPHICAL WINDOW
              LINES 44,31,
              SIZE 180,43,
              COLOR 65793,
              CONTROL FONT Verdana8-Occidentale,
              LINK TO THREAD,
              NO SCROLL,
              TITLE-BAR,
              TITLE titolo,
              AUTO-MINIMIZE,
              WITH SYSTEM MENU,
              USER-GRAY,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE Form1-Event-Proc,
              HANDLE IS Form1-Handle,
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
      * Status-bar
           DISPLAY Form1 UPON Form1-Handle
      * DISPLAY-COLUMNS settings
              MODIFY form1-gd-1, DISPLAY-COLUMNS (1, 7, 37, 48, 56, 89, 
           96, 107, 118, 125, 133, 140, 147, 154, 161, 168)
           .

       Form1-PROC.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeAccept>
           move 2 to chiave.
           perform LOAD-RECORD.

           move 2  to event-data-2.
           perform SPOSTAMENTO.

           perform INIT.
           set CambioQta to false.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT Form1
                 ON EXCEPTION
                    PERFORM Form1-Evaluate-Func
                 MOVE 1 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY Form1-Handle
           INITIALIZE Key-Status
           .

       Form1-Evaluate-Func.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterAccept>
           if BeginEntry
              inquire form1-gd-1(riga, 1), cell-data pev-articolo
              inquire form1-gd-1(riga, 4), cell-data pev-tpr-codice
              inquire form1-gd-1(riga, 6), cell-data pev-gdo

              initialize path-tmp-mtordini
              accept path-tmp-mtordini   from environment "PATH_ST"
              accept como-data from century-date
              accept como-ora  from time
              inspect path-tmp-mtordini replacing trailing spaces by 
           low-value
              string  path-tmp-mtordini delimited low-value
                      "TMP_MTORDINI_"   delimited low-value
                      como-data         delimited low-value
                      "_"               delimited low-value
                      como-ora          delimited low-value
                      ".tmp"            delimited low-value
                      into path-tmp-mtordini
              end-string
              move spaces to ext-file
              open output tmp-mtordini

              move low-value to mro-rec
              move pev-articolo   to mro-prg-cod-articolo
              move pev-tpr-codice to mro-promo
              start mrordini key >= mro-k-tprev
                    invalid continue
                not invalid
                    perform until 1 = 2
                       read mrordini next at end exit perform end-read
                       if mro-prg-cod-articolo not = pev-articolo or
                          mro-promo            not = pev-tpr-codice
                          exit perform
                       end-if
                       move path-tmp-mtordini to ext-file
                       move mro-anno          to tmto-anno   mto-anno
                       move mro-numero        to tmto-numero mto-numero
                       read mtordini no lock
                       move pev-gdo           to tmto-gdo
                       move mto-cod-cli       to cli-codice
                       set cli-tipo-C to true
                       read clienti no lock invalid continue end-read
                       move cli-ragsoc-1 to tmto-cliente 
                       if mto-prg-destino = 0
                          move cli-localita to tmto-destino
                       else
                          move mto-cod-cli       to des-codice
                          move mto-prg-destino   to des-prog
                          read destini no lock
                          move des-localita   to tmto-destino
                       end-if
                       move mro-qta           to tmto-qta-ord
                       move mto-data-ordine   to tmto-data-ord
                       move mto-data-note1    to tmto-data-cons
                       evaluate mto-stato-ordine 
                       when 1 move "REGISTRATO"  to tmto-stato-esteso
                       when 2 move "IN LAVORAZ"  to tmto-stato-esteso
                       when 3 move "SPED. PARZ." to tmto-stato-esteso
                       when 4 move "SPED. TOT."  to tmto-stato-esteso
                       when 7 move "CHIUSO"      to tmto-stato-esteso
                       end-evaluate
                       write tmto-rec
                    end-perform
              end-start
              close tmp-mtordini
              if ext-file not = spaces
                 move "tmp-mtordini" to como-file
                 call   "zoom-gt" using como-file, tmto-rec
                                 giving stato-zoom
                 cancel "zoom-gt"
                 if stato-zoom  = 0
                    move tmto-chiave to LinkChiave
                    call   "ordinevar" using lk-blockpgm, user-codi, 1,
                                             gordcvar-linkage
                    cancel "ordinevar"
                 end-if
              end-if
              delete file tmp-mtordini
              set BeginEntry to false
           end-if

           if PrenQta           
              inquire form1-gd-1(riga, 16), hidden-data in col-pren
              close promoeva
              perform OPEN-IO-PROMOEVA-LOCK
              if not RecLocked                                    
                 if col-pren = "S"
                    move "N" to col-pren
                 else
                    move "S" to col-pren
                 end-if                                           
                 modify form1-gd-1(riga, 16), hidden-data col-pren
                 if col-pren = "S"              
                    modify form1-gd-1(riga, 16) bitmap 
           spunta2-nera-bmp, 
                                                bitmap-number = 2 
                                                bitmap-width  = 20
                 else
                    modify form1-gd-1(riga, 16) bitmap 
           spunta2-nera-bmp, 
                                                bitmap-number = 1
                                                bitmap-width  = 20
                 end-if
                 inquire form1-gd-1(riga, 1), hidden-data gruppo-hidden
                 move hid-chiave to pev-chiave
                 read promoeva
                 move col-pren to pev-rpr-prenotazioni
                 rewrite pev-rec              
                 move pev-tpr-codice to rpr-codice
                 move pev-articolo   to rpr-articolo
                 read rpromo 
                 move col-pren to rpr-prenotazioni
                 rewrite rpr-rec
                 unlock rpromo   all records
                 unlock promoeva all records
                 close promoeva
              end-if             
              open input promoeva
              move 78-ID-form1-gd-1 to control-id
              move 4 to accept-control
              modify form1-gd-1, cursor-y riga, cursor-x 16
              set PrenQta to false
           end-if

           .
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM Form1-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM Form1-Exit
                 END-IF
              WHEN Key-Status = 1000
                 PERFORM pb-su-LinkTo
              WHEN Key-Status = 1001
                 PERFORM pb-giu-LinkTo
              WHEN Key-Status = 5
                 PERFORM pb-reset-LinkTo
              WHEN Key-Status = 1002
                 PERFORM pb-stampa-LinkTo
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       Form1-CLEAR.
           PERFORM Form1-INIT-VALUE
           PERFORM Form1-DISPLAY
           .

       Form1-DISPLAY.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY Form1 UPON Form1-Handle
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterDisplay>
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       Form1-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeExit>
      *****     perform SALV-MOD.
           set tutto-ok to true.
           if CambioQta
              display message "Confermi i cambi di quantità e ricalcolo 
      -    "promo?"
                        title titolo
                         type mb-yes-no-cancel
                         icon 2
                       giving scelta
              evaluate scelta
              when mb-cancel set errori to true
              when mb-no     continue
              when mb-yes
                   close    rpromo
                   open i-o rpromo
                   inquire form1-gd-1, last-row in tot-righe
                   perform varying riga from 2 by 1 
                             until riga > tot-righe
                      inquire form1-gd-1(riga, 1), hidden-data in 
           gruppo-hidden
                      if hid-cambio = 1
                         inquire form1-gd-1(riga, 1), cell-data in 
           rpr-articolo
                         inquire form1-gd-1(riga, 4), cell-data in 
           rpr-codice
                         read rpromo no lock invalid continue end-read
                         inquire form1-gd-1(riga, 9), cell-data in 
           rpr-qta
                         rewrite rpr-rec invalid continue end-rewrite
                      end-if
                   end-perform
                   close      rpromo
                   open input rpromo
                   perform SCR-ELAB-OPEN-ROUTINE
              end-evaluate
           end-if.
           if errori
              move 28 to key-status
              exit paragraph
           end-if.

           .
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       Form1-Init-Data.
           MOVE 1 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
      * GRID
           PERFORM form1-gd-1-Content
           .

       Form1-DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-promoeva-KEY1-ORDER
           END-EVALUATE
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-promoeva-KEY1-ORDER
           END-EVALUATE
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Update-Key.
           MOVE pev-rec OF promoeva TO
                     Form1-MULKEY-TMPBUF
           PERFORM Form1-CLEAR
           PERFORM Form1-INIT-DATA
           MOVE Form1-MULKEY-TMPBUF TO
                     pev-rec OF promoeva
           PERFORM DataSet1-promoeva-Read
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-CURR
           PERFORM Form1-IUD-Display
           .

       Form1-DUPLICATE-MOVEKEY.
           .

       Form1-First.
           PERFORM Form1-DUMMY-FIRST
           PERFORM DataSet1-promoeva-INITSTART
           PERFORM DataSet1-promoeva-START
           IF NOT Valid-STATUS-promoeva
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeFirst>
      * <TOTEM:END>
           PERFORM DataSet1-promoeva-Read-Next
           IF NOT Valid-STATUS-promoeva
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterFirst>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY.
           PERFORM Form1-IUD-Display
           .

       Form1-Previous.
              PERFORM Form1-Buf-To-Fld
              PERFORM DataSet1-promoeva-START-LESS
           IF NOT Valid-STATUS-promoeva
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforePrevious>
      * <TOTEM:END>
           PERFORM DataSet1-promoeva-Read-Prev
           IF NOT Valid-STATUS-promoeva
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterPrevious>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-PREVIOUS
           PERFORM Form1-IUD-Display
           .

       Form1-Next.
              PERFORM Form1-Buf-To-Fld
              PERFORM DataSet1-promoeva-START-GREATER
           IF NOT Valid-STATUS-promoeva
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeNext>
      * <TOTEM:END>
           PERFORM DataSet1-promoeva-Read-Next
           IF NOT Valid-STATUS-promoeva
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterNext>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-NEXT
           PERFORM Form1-IUD-Display
           .
      
       Form1-Last.
           PERFORM Form1-DUMMY-LAST
           PERFORM DataSet1-promoeva-INITEND
           PERFORM DataSet1-promoeva-START-NOTGREATER
           IF NOT Valid-STATUS-promoeva
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeLast>
      * <TOTEM:END>
           PERFORM DataSet1-promoeva-Read-Prev
           IF NOT Valid-STATUS-promoeva
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterLast>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY.
           PERFORM Form1-IUD-Display
           .

       Form1-Curr.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeCurrent>
      * <TOTEM:END>
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-promoeva-Read
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-CURR
           PERFORM Form1-IUD-Display
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterCurrent>
      * <TOTEM:END>
           .

       Form1-IUD-Display.
           IF Valid-STATUS-promoeva
              PERFORM Form1-ALLGRID-RESET
              PERFORM Form1-Fld-To-Buf
              PERFORM Form1-NAVI-FOR-MASTERGRID
              PERFORM Form1-DISPLAY
           ELSE
              IF Form1-FLAG-REFRESH
                 CONTINUE
              ELSE
                 PERFORM Form1-Extended-File-Status
              END-IF
           END-IF
           .

       Form1-Add.
           PERFORM Form1-Buf-To-Fld
           PERFORM Form1-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM Form1-DUMMY-ADD
           PERFORM DataSet1-promoeva-INITREC
           PERFORM Form1-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeAdd>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-promoeva-Rec-Write
           IF Valid-STATUS-promoeva
              PERFORM Form1-RESUMMARY-INS
              PERFORM Form1-DUMMY-UPDATE-INIT
              MOVE "301" TO TOTEM-MSG-ID
              PERFORM Form1-IUD-Display
           END-IF
           PERFORM Form1-ERR-CHECKING
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterAdd>
      * <TOTEM:END>
           .
     
       Form1-Update.
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-promoeva-START              
           IF NOT Valid-STATUS-promoeva
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
           PERFORM DataSet1-promoeva-Read
           PERFORM Form1-Buf-To-Fld
           PERFORM Form1-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM Form1-DUMMY-UPDATE
           PERFORM Form1-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeUpdate>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-promoeva-Rec-Rewrite
           IF Valid-STATUS-promoeva
              PERFORM Form1-RESUMMARY-DEL
              PERFORM Form1-DUMMY-UPDATE-INIT
              MOVE "302" TO TOTEM-MSG-ID
              PERFORM Form1-IUD-Display
           END-IF
           PERFORM Form1-ERR-CHECKING
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterUpdate>
      * <TOTEM:END>
           .

       Form1-Delete.
           MOVE "203" TO TOTEM-MSG-ID
           PERFORM MESSAGE-BOX-DISPLAY
           IF TOTEM-MSG-RETURN-VALUE NOT = 1
              INITIALIZE TOTEM-MSG-TEXT
              EXIT PARAGRAPH 
           END-IF
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDelete>
      * <TOTEM:END>
           PERFORM Form1-DUMMY-DELETE
      * delete
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-promoeva-Rec-Delete
           IF Valid-STATUS-promoeva
              PERFORM Form1-CLEAR
              PERFORM Form1-DUMMY-DELETE-INIT
              MOVE "303" TO TOTEM-MSG-ID
              MOVE "00" to STATUS-promoeva
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterDelete>
      * <TOTEM:END>
           PERFORM Form1-ERR-CHECKING
           .

       Form1-NAVI-FOR-MASTERGRID.
           .

       Form1-ERR-CHECKING.
           IF Valid-STATUS-promoeva
              PERFORM Form1-SHOW-MSG-ROUTINE
           ELSE
              PERFORM Form1-Extended-File-Status
           END-IF
           .

       Form1-RESUMMARY-INS.
           .

       Form1-RESUMMARY-DEL.
           .


       Form1-DUMMY-FIRST.
           .

       Form1-DUMMY-PREVIOUS.
           .

       Form1-DUMMY-NEXT.
           .

       Form1-DUMMY-LAST.
           .

       Form1-DUMMY-CURR.
           .

       Form1-DUMMY-ADD.
           .

       Form1-DUMMY-UPDATE.
           .

       Form1-DUMMY-UPDATE-INIT.
           .

       Form1-DUMMY-DELETE.
           .

       Form1-DUMMY-DELETE-INIT.
           .

       Form1-Init-Value.
           MOVE titolo TO TOTEM-MSG-TITLE
      * FORM : Form1
           PERFORM DataSet1-INIT-RECORD
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, SetDefault>
      * <TOTEM:END>
           PERFORM Form1-FLD-TO-BUF
           .


       Form1-ALLGRID-RESET.
           .

      * for Form's Validation
       Form1-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       Form1-Buf-To-Fld.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterBufToFld>
      * <TOTEM:END>
           .

       Form1-Fld-To-Buf.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeFldToBuf>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterFldToBuf>
      * <TOTEM:END>
           .

       Form1-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform Form1-BUF-TO-FLD.
           move 0 to scelta.
           .
       Form1-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM Form1-SHOW-MSG-ROUTINE
           .

       Form1-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM Form1-DISPLAY-MESSAGE
           .

       Form1-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       Form1-Save-Status.
           MOVE DataSet1-promoeva-KEY1-ORDER TO TMP-Form1-KEY1-ORDER
           MOVE DataSet1-KEYIS TO TMP-Form1-KEYIS
           MOVE pev-rec OF promoeva TO 
              TMP-Form1-promoeva-RESTOREBUF
           .             

       Form1-Restore-Status.
           MOVE TMP-Form1-KEY1-ORDER TO DataSet1-promoeva-KEY1-ORDER
           MOVE TMP-Form1-KEYIS TO DataSet1-KEYIS
           MOVE TMP-Form1-promoeva-RESTOREBUF TO
              pev-rec OF promoeva
           PERFORM DataSet1-promoeva-START
           IF Valid-STATUS-promoeva
              PERFORM DataSet1-promoeva-Read-Next
           ELSE
              PERFORM DataSet1-promoeva-INITREC
           END-IF
           PERFORM UNTIL NOT Valid-STATUS-promoeva OR
              (Valid-STATUS-promoeva AND
                 pev-rec OF promoeva = 
                   TMP-Form1-promoeva-RESTOREBUF)
              PERFORM DataSet1-promoeva-Read-Next
           END-PERFORM
           .

       scr-elab-Open-Routine.
           PERFORM scr-elab-Scrn
           PERFORM scr-elab-Proc
           .

       scr-elab-Scrn.
           PERFORM scr-elab-Create-Win
           PERFORM scr-elab-Init-Value
           PERFORM scr-elab-Init-Data
      * Tab keystrok settings
      * Tool Bar
           PERFORM scr-elab-DISPLAY
           .

       scr-elab-Create-Win.
           Display Floating GRAPHICAL WINDOW
              LINES 5,00,
              SIZE 50,00,
              CELL HEIGHT 10,
              CELL WIDTH 10,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 65793,
              ERASE,
              LABEL-OFFSET 0,
              LINK TO THREAD,
              MODELESS,
              NO SCROLL,
              USER-GRAY,
              USER-WHITE,
              No WRAP,
              HANDLE IS scr-elab-HANDLE,
      * <TOTEM:EPT. FORM:scr-elab, FORM:scr-elab, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
      * Status-bar
           DISPLAY scr-elab UPON scr-elab-HANDLE
      * DISPLAY-COLUMNS settings
           .

       scr-elab-PROC.
      * <TOTEM:EPT. FORM:scr-elab, FORM:scr-elab, BeforeAccept>
           close promoeva.
           move user-codi       to link-tprev-user.
           move scr-elab-handle to link-tprev-handle.
           call   "tprev-p"  using tprev-linkage.
           cancel "tprev-p".
           move 27 to key-status.
           open input promoeva.
           
           move 2 to chiave.
           perform LOAD-RECORD.

           move 2  to event-data-2.
           perform SPOSTAMENTO.

           perform INIT.
           set CambioQta to false.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT OMITTED LINE 1 COL 1
                 ON EXCEPTION
                    PERFORM scr-elab-Evaluate-Func
                 MOVE 2 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:scr-elab, FORM:scr-elab, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:scr-elab, FORM:scr-elab, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY scr-elab-HANDLE
           INITIALIZE Key-Status
           .

       scr-elab-Evaluate-Func.
      * <TOTEM:EPT. FORM:scr-elab, FORM:scr-elab, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM scr-elab-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM scr-elab-Exit
                 END-IF
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       scr-elab-CLEAR.
           PERFORM scr-elab-INIT-VALUE
           PERFORM scr-elab-DISPLAY
           .

       scr-elab-DISPLAY.
      * <TOTEM:EPT. FORM:scr-elab, FORM:scr-elab, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY scr-elab UPON scr-elab-HANDLE
      * <TOTEM:EPT. FORM:scr-elab, FORM:scr-elab, AfterDisplay>
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       scr-elab-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:scr-elab, FORM:scr-elab, BeforeExit>
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       scr-elab-Init-Data.
           MOVE 2 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
           .

       scr-elab-Init-Value.
      * <TOTEM:EPT. FORM:scr-elab, FORM:scr-elab, SetDefault>
      * <TOTEM:END>
           PERFORM scr-elab-FLD-TO-BUF
           .


       scr-elab-ALLGRID-RESET.
           .

      * for Form's Validation
       scr-elab-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       scr-elab-Buf-To-Fld.
      * <TOTEM:EPT. FORM:scr-elab, FORM:scr-elab, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:scr-elab, FORM:scr-elab, AfterBufToFld>
      * <TOTEM:END>
           .

       scr-elab-Fld-To-Buf.
      * <TOTEM:EPT. FORM:scr-elab, FORM:scr-elab, BeforeFldToBuf>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:scr-elab, FORM:scr-elab, AfterFldToBuf>
      * <TOTEM:END>
           .

       scr-elab-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform scr-elab-BUF-TO-FLD.
           move 0 to scelta.
           .
       scr-elab-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM scr-elab-SHOW-MSG-ROUTINE
           .

       scr-elab-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM scr-elab-DISPLAY-MESSAGE
           .

       scr-elab-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       scr-elab-Save-Status.
           .             

       scr-elab-Restore-Status.
           .



       Form1-Event-Proc.
           .

       Form1-Gd-1-Event-Proc.
           EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
           WHEN Msg-Begin-Drag ALSO 5001 ALSO
                    Form1-Handle 
              PERFORM form1-gd-1-Ev-Msg-Begin-Drag
           WHEN Msg-Begin-Entry ALSO 5001 ALSO
                    Form1-Handle 
              PERFORM form1-gd-1-Ev-Msg-Begin-Entry
           WHEN Msg-End-Drag ALSO 5001 ALSO
                    Form1-Handle 
              PERFORM form1-gd-1-Ev-Msg-End-Drag
           WHEN Msg-Finish-Entry ALSO 5001 ALSO
                    Form1-Handle 
              PERFORM form1-gd-1-Ev-Msg-Finish-Entry
           WHEN Msg-Goto-Cell ALSO 5001 ALSO
                    Form1-Handle 
              PERFORM form1-gd-1-Ev-Msg-Goto-Cell
           WHEN Msg-Goto-Cell-Drag ALSO 5001 ALSO
                    Form1-Handle 
              PERFORM form1-gd-1-Ev-Msg-Goto-Cell-Drag
           WHEN Msg-Goto-Cell-Mouse ALSO 5001 ALSO
                    Form1-Handle 
              PERFORM form1-gd-1-Ev-Msg-Goto-Cell-Mouse
           WHEN Msg-Heading-Dblclick ALSO 5001 ALSO
                    Form1-Handle 
              PERFORM form1-gd-1-Ev-Msg-Heading-Dblclick
           END-EVALUATE
           .

      * USER DEFINE PARAGRAPH
       COLORE-RIGA.
      * <TOTEM:PARA. COLORE-RIGA>
           if riga < 2 
              move 2 to riga
           end-if.

           inquire form1-gd-1(riga,  9), cell-data in pev-rpr-qta.
           inquire form1-gd-1(riga, 10), cell-data in pev-prenotata.
      *****     if pev-rpr-qta > pev-prenotata
      *****        move 485 to colore
      *****     else
              move 481 to colore
      *****     end-if.
           modify form1-gd-1, start-x 1,    x 16,
                              start-y riga, y riga,
                         region-color colore 
           .
      * <TOTEM:END>

       CONTROLLO.
      * <TOTEM:PARA. CONTROLLO>
      *****     set tutto-ok to true.
      *****
      *****     inquire form1-gd-1, cursor-y in riga.
      *****
      *****     perform VALORE-RIGA.
      *****
      *****     evaluate colonna
      *****     when 1
      *****          if nuovo
      *****             if reg-codice in zero or spaces 
      *****                set errori to true
      *****                move 1     to colonna
      *****                display message box MSG-Codice-obbligatorio
      *****                        title in tit-err
      *****                        icon mb-warning-icon
      *****             else  
      *****                read tregioni
      *****                     not invalid
      *****                         set errori to true
      *****                         display message MGS-codice-gia-inserito|"Codice già inserito!"
      *****                                 title in tit-err
      *****                                 icon mb-warning-icon
      *****                end-read
      *****             end-if
      *****          end-if
      *****     when 2
      *****          if reg-descrizione in spaces
      *****             set errori to true
      *****             move 2 to colonna
      *****             display message box MSG-Descrizione-mancante|"Descrizione mancante"
      *****                     title in tit-err
      *****                     icon mb-warning-icon
      *****          end-if
      *****     end-evaluate.
      *****
      *****     if errori
      *****        modify form1-gd-1, cursor-y in riga, cursor-x in colonna
      *****        move riga    to event-data-2
      *****        move colonna to event-data-1
      *****     end-if 
           .
      * <TOTEM:END>

       INIT.
      * <TOTEM:PARA. INIT>
           set vecchio  to true.
           set tutto-ok to true 
           .
      * <TOTEM:END>

       LOAD-RECORD.
      * <TOTEM:PARA. LOAD-RECORD>
           move low-value to pev-rec.
           start promoeva key >= pev-chiave
                 invalid  perform SCR-ELAB-OPEN-ROUTINE
           end-start.

           move 0   to save-articolo.
           move 257 to colore.
           modify form1-gd-1, mass-update 1, reset-grid 1.
           perform FORM1-GD-1-CONTENT.
           move low-value to pev-rec.
           evaluate chiave
           when 1
                start promoeva key >= pev-chiave
                      invalid  continue
                  not invalid  perform RIEMPI-GRID
                end-start
           when 2
                start promoeva key >= pev-k-descr-art
                      invalid  continue
                  not invalid  perform RIEMPI-GRID
                end-start
           when 3
                start promoeva key >= pev-k-gdo
                      invalid  continue
                  not invalid  perform RIEMPI-GRID
                end-start
           when 4
                start promoeva key >= pev-k-promo
                      invalid  continue
                  not invalid  perform RIEMPI-GRID
                end-start
           when 5
                start promoeva key >= pev-k-descr-promo
                      invalid  continue
                  not invalid  perform RIEMPI-GRID
                end-start
           end-evaluate.
           
           modify form1-gd-1, mass-update 0.

      ***---
       RIEMPI-GRID.
           perform varying riga from 2 by 1
                   until 1 = 2
              read promoeva next at end exit perform end-read
              if pev-articolo not = save-articolo
                 move pev-articolo to save-articolo
                 if colore = 257
                    move 513 to colore
                 else
                    move 257 to colore
                 end-if
              end-if   
              move pev-articolo to art-codice col-art-codice
              read articoli no lock invalid continue end-read
      *        move art-descrizione to col-art-descrizione
              move pev-descr-art     to col-art-descrizione

              move pev-data-ins(1:4) to col-pev-data-ins(7:4)
              move "/"               to col-pev-data-ins(6:1)
              move pev-data-ins(5:2) to col-pev-data-ins(4:2)
              move "/"               to col-pev-data-ins(3:1)
              move pev-data-ins(7:2) to col-pev-data-ins(1:2)

              move pev-tpr-codice         to col-tpr-codice tpr-codice
              read tpromo no lock invalid continue end-read
              move pev-tpr-descrizione    to col-tpr-descrizione
              move pev-gdo                to col-tpr-gdo

              move tpr-ini-volantino(1:4) to col-tpr-ini-vol(7:4)
              move "/"                    to col-tpr-ini-vol(6:1)
              move tpr-ini-volantino(5:2) to col-tpr-ini-vol(4:2)
              move "/"                    to col-tpr-ini-vol(3:1)
              move tpr-ini-volantino(7:2) to col-tpr-ini-vol(1:2)

              move tpr-fine-volantino(1:4) to col-tpr-fine-vol(7:4)
              move "/"                     to col-tpr-fine-vol(6:1)
              move tpr-fine-volantino(5:2) to col-tpr-fine-vol(4:2)
              move "/"                     to col-tpr-fine-vol(3:1)
              move tpr-fine-volantino(7:2) to col-tpr-fine-vol(1:2)

              move pev-rpr-qta    to col-rpr-qta
              move pev-prenotata  to col-pev-prenotata
              move pev-evasa      to col-pev-evasa
              move pev-boll       to col-pev-boll
              move pev-rimanenza  to col-pev-rimanenza
              move pev-impegnato  to col-pev-impegnato
              move pev-giac-utile to col-pev-giac-utile
              move pev-rpr-prenotazioni to col-pren
              perform METTI-RIGA  
              modify form1-gd-1(riga), row-color colore
              modify form1-gd-1(riga, 10), cell-color 432

              if pev-rpr-qta > pev-prenotata
                 modify form1-gd-1(riga, 9), cell-color = 385
              end-if
           end-perform 
           
           .
      * <TOTEM:END>

       METTI-RIGA.
      * <TOTEM:PARA. METTI-RIGA>
           modify form1-gd-1(riga,  1), cell-data col-art-codice.
           modify form1-gd-1(riga,  2), cell-data col-art-descrizione.
           modify form1-gd-1(riga,  3), cell-data col-pev-data-ins.
           modify form1-gd-1(riga,  4), cell-data col-tpr-codice.
           modify form1-gd-1(riga,  5), cell-data col-tpr-descrizione.
           modify form1-gd-1(riga,  6), cell-data col-tpr-gdo.
           modify form1-gd-1(riga,  7), cell-data col-tpr-ini-vol.
           modify form1-gd-1(riga,  8), cell-data col-tpr-fine-vol.
           modify form1-gd-1(riga,  9), cell-data col-rpr-qta.
           modify form1-gd-1(riga, 10), cell-data col-pev-prenotata.
           modify form1-gd-1(riga, 11), cell-data col-pev-evasa.
           modify form1-gd-1(riga, 12), cell-data col-pev-boll.
           modify form1-gd-1(riga, 13), cell-data col-pev-rimanenza.
           modify form1-gd-1(riga, 14), cell-data col-pev-impegnato.
           modify form1-gd-1(riga, 15), cell-data col-pev-giac-utile.
           modify form1-gd-1(riga, 16), hidden-data col-pren.
           if col-pren = "S"              
              modify form1-gd-1(riga, 16) bitmap spunta2-nera-bmp, 
                                          bitmap-number = 2 
                                          bitmap-width  = 20
           else
              modify form1-gd-1(riga, 16) bitmap spunta2-nera-bmp, 
                                          bitmap-number = 1
                                          bitmap-width  = 20
           end-if.
           move pev-chiave to hid-chiave.
           modify form1-gd-1(riga, 1), hidden-data gruppo-hidden 
           .
      * <TOTEM:END>

       OPEN-IO-PROMOEVA-LOCK.
      * <TOTEM:PARA. OPEN-IO-PROMOEVA-LOCK>
           perform until 1 = 2
              move "promoeva" to geslock-nome-file
              initialize geslock-messaggio
              string   "Il file delle quantità promo per evasione" 
                x"0d0a""è in uso su altro terminale." delimited size
                       into geslock-messaggio
              end-string

              move 1 to no-msg
              set tutto-ok  to true
              set RecLocked to false
              open i-o promoeva allowing readers
              if RecLocked
                 set errori to true
                 move 1     to geslock-v-termina
                 move 1     to geslock-v-riprova
                 move 0     to geslock-v-ignora
                 call   "geslock" using geslock-linkage
                 cancel "geslock"
      
                 evaluate true
                 when riprova continue
                 when other   display message "Operazione interrotta!"
                                        title titolo
                                         icon 2
                              exit perform
                 end-evaluate
              else
                 exit perform
              end-if
           end-perform.            
           move 0 to no-msg 
           .
      * <TOTEM:END>

       PARAGRAFO-COPY.
      * <TOTEM:PARA. PARAGRAFO-COPY>
           copy "color-custom.cpy".   
           copy "common-excel.cpy" 
           .
      * <TOTEM:END>

       SALV-MOD.
      * <TOTEM:PARA. SALV-MOD>
      *****     if nuovo
      *****        perform VALORE-RIGA
      *****        if reg-rec not in old-reg-rec
      *****           set NoSalvato to true
      *****        else
      *****           set SiSalvato to true
      *****        end-if
      *****     end-if.
      *****
      *****     set tutto-ok to true.
      *****     if NoSalvato
      *****        display message box MSG-Salvare-le-modifiche, 
      *****                       title in titolo
      *****                       type in mb-yes-no-cancel
      *****                       giving scelta
      *****
      *****        evaluate scelta
      *****        when mb-yes    perform SALVA
      *****        when mb-cancel set errori    to true
      *****        when mb-no     set tutto-ok  to true
      *****                       set SiSalvato to true
      *****                       set ricarica  to true
      *****        end-evaluate
      *****
      *****     end-if 
           .
      * <TOTEM:END>

       SALVA.
      * <TOTEM:PARA. SALVA>
      *****     if sisalvato or mod in 0 exit paragraph end-if.
      *****
      *****     inquire form1-gd-1, cursor-x in colonna, 
      *****                         cursor-y in riga.
      *****
      *****
      *****     perform varying colonna from 1 by 1 
      *****               until colonna > 2
      *****        perform CONTROLLO
      *****        if errori exit perform end-if
      *****     end-perform.
      *****
      *****     if tutto-ok
      ******    luciano start
      *****        perform VALORIZZA-DATI-COMUNI
      ******    luciano end
      *****        write reg-rec 
      *****           invalid 
      *****              rewrite reg-rec
      *****        end-write
      *****        set sisalvato to true
      *****        set vecchio   to true
      *****     else                   
      *****        perform ABILITAZIONI
      *****     end-if                  
           .
      * <TOTEM:END>

       SPOSTAMENTO.
      * <TOTEM:PARA. SPOSTAMENTO>
           inquire form1-gd-1, cursor-x in colonna, cursor-y in riga, 
                   last-row in tot-righe.
           move event-data-2 to riga.
      *****
      *****     if event-data-2 not in riga
      *****        perform VALORE-RIGA
      *****        if reg-codice in spaces or zero
      *****           modify form1-gd-1, record-to-delete riga
      *****           set vecchio to true
      *****        else  
      *****           perform SALVA
      *****           if errori
      *****              move riga    to event-data-2
      *****              move colonna to event-data-1 | (isacco)
      *****              set event-action to event-action-fail
      *****           end-if
      *****        end-if
      *****     else
      *****        if colonna not in event-data-1
      *****           perform CONTROLLO
      *****           if errori
      *****              set event-action to event-action-fail
      *****           end-if
      *****        end-if
      *****     end-if.
      *****
      * COLORAZIONE RIGA IN GRID
           perform COLORE-RIGA.

           inquire form1-gd-1(riga, 11), cell-data in col-pev-evasa.
           move col-pev-evasa to pev-evasa.
           if pev-evasa = 0
              if riga < tot-righe
                 add 1 to riga giving store-riga
                 inquire form1-gd-1(store-riga, 11), cell-data in 
           col-pev-evasa
                 move col-pev-evasa to pev-evasa
                 if pev-evasa = 0
                    move 1 to e-sposta-giu
                    modify pb-giu, enabled = e-sposta-giu, 
           bitmap-number = 1
                 else
                    move 0 to e-sposta-giu
                    modify pb-giu, enabled = e-sposta-giu, 
           bitmap-number = 3
                 end-if
              else
                 move 0 to e-sposta-giu
                 modify pb-giu, enabled = e-sposta-giu, bitmap-number = 
           3
              end-if

              if riga > 2
                 subtract 1 from riga giving store-riga
                 inquire form1-gd-1(store-riga, 11), cell-data in 
           col-pev-evasa
                 move col-pev-evasa to pev-evasa
                 if pev-evasa = 0
                    move 1 to e-sposta-su
                    modify pb-su, enabled = e-sposta-su, bitmap-number 
           = 1
                 else
                    move 0 to e-sposta-su
                    modify pb-su, enabled = e-sposta-su, bitmap-number 
           = 3
                 end-if
              else
                 move 0 to e-sposta-su
                 modify pb-su, enabled = e-sposta-su, bitmap-number = 3
              end-if
           else
              move 0 to e-sposta-su
              move 0 to e-sposta-giu
              modify pb-su,  enabled = e-sposta-su,  bitmap-number = 3
              modify pb-giu, enabled = e-sposta-giu, bitmap-number = 3
           end-if.
           
           inquire form1-gd-1(riga, 1), cell-data in col-art-codice.
           move col-art-codice to pev-articolo.

           if e-sposta-giu = 1
              add 1 to riga giving store-riga
              inquire form1-gd-1(store-riga, 1), cell-data in 
           col-art-codice
              move col-art-codice to succ-articolo
              if succ-articolo = pev-articolo
                 move 1 to e-sposta-giu
                 modify pb-giu, enabled = e-sposta-giu, bitmap-number = 
           1
              else
                 move 0 to e-sposta-giu
                 modify pb-giu, enabled = e-sposta-giu, bitmap-number = 
           3
              end-if
           end-if.

           if e-sposta-su = 1
              subtract 1 from riga giving store-riga
              inquire form1-gd-1(store-riga, 1), cell-data in 
           col-art-codice
              move col-art-codice to prec-articolo
              if prec-articolo = pev-articolo
                 move 1 to e-sposta-su
                 modify pb-su, enabled = e-sposta-su, bitmap-number = 1
              else
                 move 0 to e-sposta-su
                 modify pb-su, enabled = e-sposta-su, bitmap-number = 3
              end-if
           end-if.

           initialize prg-chiave replacing numeric data by zeroes
                                      alphanumeric data by spaces.
           inquire form1-gd-1(riga, 1), cell-data in pev-articolo.
           move pev-articolo to prg-cod-articolo.
           move "LBX"        to prg-cod-magazzino.
           move 0            to como-giacenza.
           start progmag key >= prg-chiave invalid continue end-start.
           perform until 1 = 2
              read progmag next at end exit perform end-read
              if prg-cod-articolo  not = pev-articolo or
                 prg-cod-magazzino not = "LBX"
                 exit perform
              end-if
              add prg-giacenza to como-giacenza
           end-perform.
           move como-giacenza to lab-giac-buf.
           display lab-giac.
           if como-giacenza < 0
              modify lab-giac, color 5
           else
              modify lab-giac, color 3
           end-if.
           inquire form1-gd-1(event-data-2, 16), cell-data in col-pren
           .
      * <TOTEM:END>

       VALORE-RIGA.
      * <TOTEM:PARA. VALORE-RIGA>
           inquire form1-gd-1(riga,  1), cell-data in col-art-codice.
           inquire form1-gd-1(riga,  2), cell-data in 
           col-art-descrizione.
           inquire form1-gd-1(riga,  3), cell-data in col-pev-data-ins.
           inquire form1-gd-1(riga,  4), cell-data in col-tpr-codice.
           inquire form1-gd-1(riga,  5), cell-data in 
           col-tpr-descrizione.
           inquire form1-gd-1(riga,  6), cell-data in col-tpr-gdo.
           inquire form1-gd-1(riga,  7), cell-data in col-tpr-ini-vol.
           inquire form1-gd-1(riga,  8), cell-data in col-tpr-fine-vol.
           inquire form1-gd-1(riga,  9), cell-data in col-rpr-qta       
           inquire form1-gd-1(riga, 10), cell-data in col-pev-prenotata
           inquire form1-gd-1(riga, 11), cell-data in col-pev-evasa.
           inquire form1-gd-1(riga, 12), cell-data in col-pev-boll.
           inquire form1-gd-1(riga, 13), cell-data in col-pev-rimanenza.
           inquire form1-gd-1(riga, 14), cell-data in col-pev-impegnato.
           inquire form1-gd-1(riga, 15), cell-data in col-pev-giac-utile
           inquire form1-gd-1(riga, 16), cell-data in col-pren.
           inquire form1-gd-1(riga, 1), hidden-data in gruppo-hidden 
           .
      * <TOTEM:END>

       VALORIZZA-DATI-COMUNI.
      * <TOTEM:PARA. VALORIZZA-DATI-COMUNI>
      *    se non ho valorizzato i campi di creazione li valorizzo
           accept pev-data-modifica from century-date.
           accept pev-ora-modifica from time.
           move user-codi to pev-utente-modifica 
           .
      * <TOTEM:END>

      * EVENT PARAGRAPH
       I-O-BLOCCO.
      * <TOTEM:PARA. I-O-BLOCCO>
           SET LK-BL-CANCELLAZIONE TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           call "W$BITMAP" using wbitmap-destroy, spunta2-nera-bmp 
           .
      * <TOTEM:END>
       PAS004P-Ev-Before-Program.
      * <TOTEM:PARA. PAS004P-Ev-Before-Program>
           move LK-BL-PROG-ID    TO COMO-PROG-ID.
           copy resource "spunta2-nera.bmp".
           call "W$BITMAP" using wbitmap-load, "spunta2-nera.bmp"
                          giving spunta2-nera-bmp 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-Begin-Entry.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-Begin-Entry>
           evaluate event-data-1
           when  9
                inquire form1-gd-1(riga, 9), cell-data in old-qta
           when 14          
                inquire form1-gd-1, entry-reason in como-x
                set event-action to event-action-fail-terminate
                evaluate como-x
                when X"00"|doppio click
                when X"0D"|invio       
                when X"20"|spazio
                     set BeginEntry to true
                end-evaluate
           when 16
                inquire form1-gd-1, entry-reason in como-x
                set event-action to event-action-fail-terminate
                evaluate como-x
                when X"00"|doppio click   
                when X"0D"|invio
                when X"20"|spazio
                     set PrenQta to true
                end-evaluate
           when other
                set event-action to event-action-fail
           end-evaluate 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-End-Drag.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-End-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-Goto-Cell.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-Goto-Cell>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-Goto-Cell-Drag.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-Goto-Cell-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-Goto-Cell-Mouse.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-Goto-Cell-Mouse>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-Begin-Drag.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-Begin-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       pb-su-BeforeProcedure.
      * <TOTEM:PARA. pb-su-BeforeProcedure>
           modify pb-su, bitmap-number 2 
           .
      * <TOTEM:END>
       pb-su-AfterProcedure.
      * <TOTEM:PARA. pb-su-AfterProcedure>
           modify pb-su, bitmap-number 1 
           .
      * <TOTEM:END>
       pb-giu-BeforeProcedure.
      * <TOTEM:PARA. pb-giu-BeforeProcedure>
           modify pb-giu, bitmap-number 2 
           .
      * <TOTEM:END>
       pb-giu-AfterProcedure.
      * <TOTEM:PARA. pb-giu-AfterProcedure>
           modify pb-giu, bitmap-number 1 
           .
      * <TOTEM:END>
       pb-su-LinkTo.
      * <TOTEM:PARA. pb-su-LinkTo>
           inquire form1-gd-1, cursor-y in riga.
           if riga = 2
              exit paragraph
           end-if.
           move riga to store-riga.
           inquire form1-gd-1(riga, 1), hidden-data in gruppo-hidden.
           move hid-chiave to corr-chiave.
           subtract 1 from riga
           inquire form1-gd-1(riga, 1), hidden-data in gruppo-hidden.
           move hid-chiave to prec-chiave.
           if corr-articolo not = prec-articolo
              exit paragraph
           end-if.

           move prec-chiave to pev-chiave.
           read promoeva no lock.
           move pev-rec  to prec-rec.
           delete promoeva record.

           move corr-chiave to pev-chiave.
           read promoeva no lock.
           move pev-rec  to corr-rec.
           delete promoeva record.

           move corr-chiave to pev-chiave
           move prec-dati   to pev-dati.
           write pev-rec.

           move prec-chiave to pev-chiave
           move corr-dati   to pev-dati.
           write pev-rec.

           modify form1-gd-1, mass-update = 1.
           modify form1-gd-1, insertion-index riga, insert-rows = 1.
           add 1 to store-riga giving riga.
           perform VALORE-RIGA.
           subtract 2 from riga.
           perform METTI-RIGA.
           add 1 to riga.
           move corr-chiave to hid-chiave.
           modify form1-gd-1(riga, 1), hidden-data gruppo-hidden.
           add 1 to riga.
           modify form1-gd-1, record-to-delete = riga.
           
           perform SCR-ELAB-OPEN-ROUTINE.

           perform LOAD-RECORD.
                                            
           modify form1-gd-1, mass-update = 0.
           subtract 1 from store-riga.

           move store-riga to event-data-2 riga.
           modify form1-gd-1, cursor-y riga.
           move store-riga to event-data-2.
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       pb-giu-LinkTo.
      * <TOTEM:PARA. pb-giu-LinkTo>
           inquire form1-gd-1, cursor-y in riga, last-row in tot-righe.
           if riga = tot-righe
              exit paragraph
           end-if.
              
           move riga to store-riga.
           inquire form1-gd-1(riga, 1), hidden-data in gruppo-hidden.
           move hid-chiave to corr-chiave.
           add 1 to riga
           inquire form1-gd-1(riga, 1), hidden-data in gruppo-hidden.
           move hid-chiave to succ-chiave.
           if corr-articolo not = succ-articolo
              exit paragraph
           end-if.

           move succ-chiave to pev-chiave.
           read promoeva no lock.
           move pev-rec  to succ-rec.
           delete promoeva record.

           move corr-chiave to pev-chiave.
           read promoeva no lock.
           move pev-rec  to corr-rec.
           delete promoeva record.

           move corr-chiave to pev-chiave
           move succ-dati   to pev-dati.
           write pev-rec.

           move succ-chiave to pev-chiave
           move corr-dati   to pev-dati.
           write pev-rec.
                              
           modify form1-gd-1, mass-update = 1.
           modify form1-gd-1, insertion-index riga + 1, insert-rows = 1.
           move store-riga to riga.
           perform VALORE-RIGA.
           add 2 to riga.
           perform METTI-RIGA.
           subtract 1 from riga.
           move corr-chiave to hid-chiave.
           modify form1-gd-1(riga, 1), hidden-data gruppo-hidden.
           subtract 1 from riga.
           modify form1-gd-1, record-to-delete = riga.
           add 1 to store-riga 
           move store-riga to event-data-2.
           perform SPOSTAMENTO.
           
           perform SCR-ELAB-OPEN-ROUTINE.

           perform LOAD-RECORD.
                                            
           modify form1-gd-1, mass-update = 0.
           add 1 to store-riga.

           move store-riga to event-data-2 riga.
           modify form1-gd-1, cursor-y riga.
           move store-riga to event-data-2.
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       pb-reset-LinkTo.
      * <TOTEM:PARA. pb-reset-LinkTo>
           perform SCR-ELAB-OPEN-ROUTINE 
           .
      * <TOTEM:END>
       pb-stampa-LinkTo.
      * <TOTEM:PARA. pb-stampa-LinkTo>
           inquire form1-gd-1, last-row in tot-righe.
           if tot-righe = 1 exit paragraph end-if.
           call "w$mouse"    using SET-MOUSE-SHAPE, WAIT-POINTER.
           display message "Portare su Excel?"
                      title titolo
                       type mb-yes-no
                     giving scelta
           if scelta = mb-yes
              move low-value to pev-rec
              evaluate chiave
              when 1
                   start promoeva key >= pev-chiave
                         invalid  continue
                     not invalid  perform STAMPA-GRID
                   end-start
              when 2
                   start promoeva key >= pev-k-descr-art
                         invalid  continue
                     not invalid  perform STAMPA-GRID
                   end-start
              when 3
                   start promoeva key >= pev-k-gdo
                         invalid  continue
                     not invalid  perform STAMPA-GRID
                   end-start
              when 4
                   start promoeva key >= pev-k-promo
                         invalid  continue
                     not invalid  perform STAMPA-GRID
                   end-start
              when 5
                   start promoeva key >= pev-k-descr-promo
                         invalid  continue
                     not invalid  perform STAMPA-GRID
                   end-start
              end-evaluate
           end-if.
           call "w$mouse"    using SET-MOUSE-SHAPE, ARROW-POINTER.

      ***---
       STAMPA-GRID.
           perform ACCETTA-SEPARATORE.
           initialize wstampa
           accept wstampa   from environment "PATH_ST"
           accept como-data from century-date
           accept como-ora  from time
           inspect wstampa  replacing trailing spaces by low-value
           string  wstampa     delimited low-value
                   "PROMOEVA_" delimited low-value
                   como-data   delimited low-value
                   "_"         delimited low-value
                   como-ora    delimited low-value
                   ".csv"      delimited low-value
                   into wstampa
           end-string
           open output lineseq
           string "Art."           delimited size
                  separatore       delimited size
                  "Descrizione"    delimited size
                  separatore       delimited size
                  "Dt Ins."        delimited size
                  separatore       delimited size
                  "Promo"          delimited size
                  separatore       delimited size
                  "Descrizione"    delimited size
                  separatore       delimited size
                  "GDO"            delimited size
                  separatore       delimited size
                  "Ini Vol"        delimited size
                  separatore       delimited size
                  "Fine Vol"       delimited size
                  separatore       delimited size
                  "SOS"            delimited size
                  separatore       delimited size
                  "Prenot"         delimited size
                  separatore       delimited size
                  "Evasa"          delimited size
                  separatore       delimited size
                  "Boll"           delimited size
                  separatore       delimited size
                  "Rim.za"         delimited size
                  separatore       delimited size
                  "Imp. M"         delimited size
                  separatore       delimited size
                  "G. Utile"       delimited size
                  separatore       delimited size
                  "Prenotazioni"   delimited size
                  separatore       delimited size
                  into line-riga
           end-string.
           write line-riga.
           perform until 1 = 2
              read promoeva next at end exit perform end-read
              move pev-articolo to art-codice col-art-codice
              read articoli no lock invalid continue end-read
              move pev-descr-art          to col-art-descrizione

              move pev-data-ins(1:4)      to col-pev-data-ins(7:4)
              move "/"                    to col-pev-data-ins(6:1)
              move pev-data-ins(5:2)      to col-pev-data-ins(4:2)
              move "/"                    to col-pev-data-ins(3:1)
              move pev-data-ins(7:2)      to col-pev-data-ins(1:2)

              move pev-tpr-codice         to col-tpr-codice tpr-codice
              read tpromo no lock invalid continue end-read
              move pev-tpr-descrizione    to col-tpr-descrizione
              move pev-gdo                to col-tpr-gdo

              move tpr-ini-volantino(1:4) to col-tpr-ini-vol(7:4)
              move "/"                    to col-tpr-ini-vol(6:1)
              move tpr-ini-volantino(5:2) to col-tpr-ini-vol(4:2)
              move "/"                    to col-tpr-ini-vol(3:1)
              move tpr-ini-volantino(7:2) to col-tpr-ini-vol(1:2)

              move tpr-fine-volantino(1:4) to col-tpr-fine-vol(7:4)
              move "/"                     to col-tpr-fine-vol(6:1)
              move tpr-fine-volantino(5:2) to col-tpr-fine-vol(4:2)
              move "/"                     to col-tpr-fine-vol(3:1)
              move tpr-fine-volantino(7:2) to col-tpr-fine-vol(1:2)

              move pev-rpr-qta    to col-rpr-qta
              move pev-prenotata  to col-pev-prenotata
              move pev-evasa      to col-pev-evasa
              move pev-boll       to col-pev-boll
              move pev-rimanenza  to col-pev-rimanenza
              move pev-impegnato  to col-pev-impegnato
              move pev-giac-utile to col-pev-giac-utile
              move pev-rpr-prenotazioni to col-pren
              initialize line-riga
              string col-art-codice       delimited size
                     separatore           delimited size
                     col-art-descrizione  delimited size
                     separatore           delimited size
                     col-pev-data-ins     delimited size
                     separatore           delimited size
                     col-tpr-codice       delimited size
                     separatore           delimited size
                     col-tpr-descrizione  delimited size
                     separatore           delimited size
                     col-tpr-gdo          delimited size
                     separatore           delimited size
                     col-tpr-ini-vol      delimited size
                     separatore           delimited size
                     col-tpr-fine-vol     delimited size
                     separatore           delimited size
                     col-rpr-qta          delimited size
                     separatore           delimited size
                     col-pev-prenotata    delimited size
                     separatore           delimited size
                     col-pev-evasa        delimited size
                     separatore           delimited size
                     col-pev-boll         delimited size
                     separatore           delimited size
                     col-pev-rimanenza    delimited size
                     separatore           delimited size
                     col-pev-impegnato    delimited size
                     separatore           delimited size   
                     col-pev-giac-utile   delimited size
                     separatore           delimited size
                     col-pren   delimited size
                     separatore           delimited size
                     into line-riga
              end-string
              write line-riga

           end-perform.
           close lineseq.
           perform CALL-EXCEL 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-Heading-Dblclick.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-Heading-Dblclick>
           evaluate event-data-1
           when 1
                move 1 to chiave
                perform LOAD-RECORD
                perform COLORA-CELLE
           when 2
                move 2 to chiave
                perform LOAD-RECORD
                perform COLORA-CELLE
           when 4
                move 4 to chiave
                perform LOAD-RECORD
                perform COLORA-CELLE
           when 5
                move 5 to chiave
                perform LOAD-RECORD
                perform COLORA-CELLE
           when 6
                move 3 to chiave
                perform LOAD-RECORD
                perform COLORA-CELLE
           end-evaluate.

      ***---
       COLORA-CELLE.
           modify form1-gd-1(1, 1), cell-font = Verdana8-Occidentale, 
           cell-color = 0.
           modify form1-gd-1(1, 2), cell-font = Verdana8-Occidentale, 
           cell-color = 0.
           modify form1-gd-1(1, 6), cell-font = Verdana8-Occidentale, 
           cell-color = 0.

           modify form1-gd-1(1, event-data-1), 
                  cell-color = 5, cell-font = Verdana8B-Occidentale 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-Finish-Entry.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-Finish-Entry>
           evaluate event-data-1
           when 9
                inquire form1-gd-1(riga, 9), cell-data in new-qta
                move new-qta to col-rpr-qta
                modify form1-gd-1(riga, 9),  cell-data col-rpr-qta
           end-evaluate.

           if old-qta not = new-qta
              set CambioQta to true
              inquire form1-gd-1(riga, 1), hidden-data in gruppo-hidden
              move 1 to hid-cambio
              modify form1-gd-1(riga, 1),  hidden-data    gruppo-hidden
           end-if
              
           .
      * <TOTEM:END>

      *{TOTEM}END

      *{TOTEM}SHOW-MSG
       MESSAGE-FOR-FILEERROR.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
              MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           .

       SHOW-TRANSACTION-ROUTINE.
           IF TOTEM-TRANSACTION-FLAG = SPACES
              IF TRANSACTION-STATUS NOT = 0
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-1
              END-IF
           ELSE
              PERFORM SHOW-MSG-ROUTINE
              IF TRANSACTION-STATUS = 0
                 MOVE "Transazione terminata con Rollback." TO 
           TOTEM-MSG-3
              ELSE
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-3
              END-IF
           END-IF
           .

       SHOW-MSG-ROUTINE.
           MOVE SPACE TO TOTEM-MSG-1 TOTEM-MSG-2 TOTEM-MSG-3
           EVALUATE TOTEM-MSG-ID
               WHEN "10"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Nessun altro dato." TO TOTEM-MSG-2
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "22"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Chiave Duplicata." TO TOTEM-MSG-2
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "23"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Raggiunta fine file." TO TOTEM-MSG-2
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "101"
                    MOVE "Terminare l'applicazione?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "201"
                    MOVE "Aggiungere un nuovo record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "202"
                    MOVE "Aggiornare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "203"
                    MOVE "Cancellare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "204"
                    MOVE "Chiave duplicata." TO TOTEM-MSG-1
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "301"
                    MOVE "Inserimento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "302"
                    MOVE "Aggiornamento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "303"
                    MOVE "Cancellazione avvenuta con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "401"
                    MOVE "Shell non trovata." TO TOTEM-MSG-1
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN OTHER
                    MOVE TEXT-MESSAGE TO TOTEM-MSG-1
                    STRING "FILE:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-3
                    MOVE 0 TO TOTEM-IDX1
                    INSPECT TOTEM-MSG-3 TALLYING TOTEM-IDX1
                       FOR TRAILING SPACE
                    STRING TOTEM-MSG-3(1:TOTEM-MSG-LENGTH - 
           TOTEM-IDX1), 
                       ", FILE STATUS ", PRIMARY-ERROR "," 
                       SECONDARY-ERROR
                    DELIMITED BY SIZE INTO TOTEM-MSG-2
                    MOVE SPACES TO TOTEM-MSG-3
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
           END-EVALUATE
           PERFORM MESSAGE-BOX-ROUTINE
           .

       MESSAGE-BOX-ROUTINE.
           MOVE 1 TO TOTEM-MSG-TEXT-POINTER
           IF TOTEM-MSG-1 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-1 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              STRING TOTEM-MSG-1( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                 DELIMITED BY SIZE
                 INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-2 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-2 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-2( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-3 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-3 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-3( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-TEXT-POINTER = 1
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-TEXT TALLYING TOTEM-MSG-SIZE FOR 
           TRAILING SPACE
                  COMPUTE TOTEM-MSG-TEXT-POINTER = 
           TOTEM-MSG-FULL-LENGTH - TOTEM-MSG-SIZE + 1
           END-IF
           MOVE LOW-VALUES TO TOTEM-MSG-TEXT(TOTEM-MSG-TEXT-POINTER : 1 
           )
           .

       MESSAGE-BOX-DISPLAY.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

      *{TOTEM}END

