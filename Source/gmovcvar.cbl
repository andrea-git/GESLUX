      *{TOTEM}PRG-COMMENT
      * gmovcvar.Cbl
      * gmovcvar.Cbl is generated by TOTEM
      * This is a generated file. DO NOT modify this file directly.
      *{TOTEM}END
       IDENTIFICATION       DIVISION.
      *{TOTEM}PRGID
       PROGRAM-ID.          gmovcvar.
       AUTHOR.              andre.
       DATE-WRITTEN.        venerdì 13 maggio 2022 09:31:04.
       REMARKS.
      *{TOTEM}END

       ENVIRONMENT          DIVISION.
       CONFIGURATION        SECTION.
       SPECIAL-NAMES.
      *{TOTEM}SPECIAL-NAME
      * <TOTEM:EPT. INIT:gmovcvar, INIT:gmovcvar, SpecialName>
      * <TOTEM:END>
      *{TOTEM}END
      *{TOTEM}ACTIVEX-DEF
      *{TOTEM}END
      *{TOTEM}DECIMAL-POINT
           DECIMAL-POINT IS COMMA.
      *{TOTEM}END

       INPUT-OUTPUT         SECTION.
       FILE-CONTROL.
      *{TOTEM}FILE-CONTROL
           COPY "tmovmag.sl".
           COPY "rmovmag.sl".
           COPY "clienti.sl".
           COPY "tmagaz.sl".
           COPY "tparamge.sl".
           COPY "tcodpag.sl".
           COPY "tcaumag.sl".
           COPY "articoli.sl".
           COPY "timposte.sl".
           COPY "progmag.sl".
           COPY "tmarche.sl".
           COPY "timballi.sl".
           COPY "destini.sl".
           COPY "timbalqta.sl".
           COPY "ttipocli.sl".
           COPY "tmp-progmag-zoom.sl".
           COPY "tgrupgdo.sl".
           COPY "tordforn.sl".
           COPY "rordforn.sl".
           COPY "reva.sl".
           COPY "tvettori.sl".
           COPY "teva.sl".
           COPY "brnotacr.sl".
           COPY "btnotacr.sl".
           COPY "tsetinvio.sl".
           COPY "tcontat.sl".
           COPY "movutf.sl".
           COPY "tnazioni.sl".
           COPY "lineseq-mail.sl".
      *{TOTEM}END
       DATA                 DIVISION.
       FILE                 SECTION.
      *{TOTEM}FILE
           COPY "tmovmag.fd".
           COPY "rmovmag.fd".
           COPY "clienti.fd".
           COPY "tmagaz.fd".
           COPY "tparamge.fd".
           COPY "tcodpag.fd".
           COPY "tcaumag.fd".
           COPY "articoli.fd".
           COPY "timposte.fd".
           COPY "progmag.fd".
           COPY "tmarche.fd".
           COPY "timballi.fd".
           COPY "destini.fd".
           COPY "timbalqta.fd".
           COPY "ttipocli.fd".
           COPY "tmp-progmag-zoom.fd".
           COPY "tgrupgdo.fd".
           COPY "tordforn.fd".
           COPY "rordforn.fd".
           COPY "reva.fd".
           COPY "tvettori.fd".
           COPY "teva.fd".
           COPY "brnotacr.fd".
           COPY "btnotacr.fd".
           COPY "tsetinvio.fd".
           COPY "tcontat.fd".
           COPY "movutf.fd".
           COPY "tnazioni.fd".
           COPY "lineseq-mail.fd".
      *{TOTEM}END

       WORKING-STORAGE      SECTION.
      *{TOTEM}ACU-DEF
               COPY "acugui.def".
               COPY "acucobol.def".
               COPY "fonts.def".
               COPY "crtvars.def".
               COPY "showmsg.def".
               COPY "totem.def".
               COPY "standard.def".
      *{TOTEM}END

      *{TOTEM}COPY-WORKING
      * Key Status
       77 Key-Status IS SPECIAL-NAMES CRT STATUS PIC 9(5) VALUE 0.
          88 Enter-Pushed VALUE 13.
          88 Exit-Pushed VALUE 27.
          88 Message-Received VALUE 95.
          88 Event-Occurred VALUE 96.
          88 Screen-No-Input-Field VALUE 97.
      * Properties & User defined Working Stoarge
       77 Verdana12-Occidentale
                  USAGE IS HANDLE OF FONT.
           COPY  "MOVMAG-WS.DEF".
       77 Verdana16-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 lab-num-fatt-buf PIC  z(8).
       77 progressivo      PIC  9(6).
       77 save-teva-anno   PIC  9(4).
       77 wk-date          PIC  9(8).
       77 wk-hour          PIC  9(8).
       77 wk-path          PIC  x(256).
       77 copy-status
                  USAGE IS SIGNED-SHORT.
       01 prova-mail       PIC  x.
           88 MailInProva VALUE IS "S"    WHEN SET TO FALSE  "N". 
       01 FILLER           PIC  9.
           88 SystemErrorOccurred VALUE IS 1    WHEN SET TO FALSE  0. 
       01 FILLER           PIC  9.
           88 CancellazioneFisica VALUE IS 1    WHEN SET TO FALSE  0. 
           88 CancellazioneLogica VALUE IS 2    WHEN SET TO FALSE  0. 
       77 como-tipo        PIC  x.
       77 save-tot-righe   PIC  9(6).
       77 lab-data-fatt-buf            PIC  99/99/9999.
       77 write-effettuate PIC  9(5).
       77 lab-anno-buf     PIC  x(25).
       77 righe-iniziali   PIC  9(5).
       77 righe-finali     PIC  9(5).
       77 righe-iniziali-x PIC  zz.zz9.
       77 righe-finali-x   PIC  zz.zz9.
       77 tipo-messaggio   PIC  9(3).
       77 STATUS-tgrupgdo  PIC  X(2).
           88 Valid-STATUS-tgrupgdo VALUE IS "00" THRU "09". 
       77 path-tmp-eva     PIC  X(32).
       77 STATUS-tmp-eva   PIC  X(2).
           88 Valid-STATUS-tmp-eva VALUE IS "00" THRU "09". 
       77 STATUS-rordforn  PIC  X(2).
           88 Valid-STATUS-rordforn VALUE IS "00" THRU "09". 
       77 STATUS-tordforn  PIC  X(2).
           88 Valid-STATUS-tordforn VALUE IS "00" THRU "09". 
       77 STATUS-reva      PIC  X(2).
           88 Valid-STATUS-reva VALUE IS "00" THRU "09". 
       77 STATUS-teva      PIC  X(2).
           88 Valid-STATUS-teva VALUE IS "00" THRU "09". 
       77 v-evasione       PIC  9
                  VALUE IS 0.
       77 lab-anno-e-buf   PIC  9(4).
       77 lab-numero-e-buf PIC  z(8).
       77 STATUS-brnotacr  PIC  X(2).
           88 Valid-STATUS-brnotacr VALUE IS "00" THRU "09". 
       77 STATUS-btnotacr  PIC  X(2).
           88 Valid-STATUS-btnotacr VALUE IS "00" THRU "09". 
       77 STATUS-tsetmerc  PIC  X(2).
           88 Valid-STATUS-tsetmerc VALUE IS "00" THRU "09". 
       77 STATUS-tsetinvio PIC  X(2).
           88 Valid-STATUS-tsetinvio VALUE IS "00" THRU "09". 
       77 STATUS-tcontat   PIC  X(2).
           88 Valid-STATUS-tcontat VALUE IS "00" THRU "09". 
       77 STATUS-movutf    PIC  X(2).
           88 Valid-STATUS-movutf VALUE IS "00" THRU "09". 
       77 STATUS-tnazioni  PIC  X(2).
           88 Valid-STATUS-tnazioni VALUE IS "00" THRU "09". 
       77 path-lineseq-mail            PIC  X(32).
       77 STATUS-lineseq-mail          PIC  X(2).
           88 Valid-STATUS-lineseq-mail VALUE IS "00" THRU "09". 

      ***********************************************************
      *   Code Gen's Buffer                                     *
      ***********************************************************
       77 Screen1-Ta-1-TAB-VALUE  PIC  99  VALUE 1.
       77 STATUS-Form1-FLAG-REFRESH PIC  9.
          88 Form1-FLAG-REFRESH  VALUE 1 FALSE 0. 
      * DATA CONTROL BUFFER
       01 Form1-BUF.
      * Page
              05 PAGE-1-BUF.
      * Data.Entry-Field
              10 ef-data-BUF PIC 99/99/9999.
              10 ef-data-VALUEBUF PIC 9(8).
      * Data.Entry-Field
              10 ef-causale-BUF PIC X(4).
              10 ef-causale-VALUEBUF PIC X(4).
      * Data.Entry-Field
              10 ef-clifor-BUF PIC x(5).
              10 ef-clifor-VALUEBUF PIC 9(5).
      * Data.Entry-Field
              10 ef-destino-BUF PIC x(5).
              10 ef-destino-VALUEBUF PIC 9(5).
      * Data.Entry-Field
              10 ef-vettore-BUF PIC z(5).
      * Data.Entry-Field
              10 ef-num-BUF PIC z(8).
      * Data.Entry-Field
              10 ef-data-doc-BUF PIC 99/99/9999.
      * Data.Entry-Field
              10 ef-via-BUF PIC z(8).
      * Data.Entry-Field
              10 ef-data-via-BUF PIC 99/99/9999.
      * Data.Entry-Field
              10 ef-pag-BUF PIC X(3).
      * Data.Entry-Field
              10 ef-mag-BUF PIC x(3).
      * Data.Label
              10 lab-causale-BUF PIC X(40).
      * Data.Label
              10 lab-cli-BUF PIC X(40).
      * Data.Label
              10 lab-mag-BUF PIC X(50).
      * Data.Label
              10 lab-destino-BUF PIC x(100).
      * Data.Label
              10 lab-vettore-BUF PIC X(40).
      * Page
              05 PAGE-2-BUF.
      * Data.Entry-Field
              10 ef-art-BUF PIC zzzzz9.
      * Data.Entry-Field
              10 ef-qta-BUF PIC zz.zzz.zz9 blank zero.
      * Data.Entry-Field
              10 ef-listino-BUF PIC zzz.zzz.zz9,99 blank zero.
      * Data.Entry-Field
              10 ef-sconto-BUF PIC z9,99 blank zero.
      * Data.Entry-Field
              10 ef-cons-BUF PIC z.zz9,99 blank zero.
      * Data.Entry-Field
              10 ef-coubat-BUF PIC z.zz9,99 blank zero.
      * Data.Label
              10 lab-desart-BUF PIC X(50).
      * Data.Label
              10 lab-udm-BUF PIC X(2).
      * Data.Label
              10 lab-imb-BUF PIC X(3).
      * Data.Label
              10 lab-desimb-BUF PIC x(100).
      * Data.Label
              10 lab-peso-udm-BUF PIC zz.zz9,999 blank zero.
      * Data.Entry-Field
              10 ef-imp-merce-BUF PIC zzz.zzz.zz9,99 blank zero.
      * Data.Label
              05 lab-peso-utf-BUF PIC zz.zzz.zzz.zz9,999.

       77 TMP-Form1-KEY1-ORDER  PIC X VALUE "A".
       77 TMP-Form1-tmovmag-RESTOREBUF  PIC X(256).
       77 TMP-Form1-KEYIS  PIC 9(3) VALUE 1.
       77 Form1-MULKEY-TMPBUF   PIC X(256).
       77 STATUS-Form2-FLAG-REFRESH PIC  9.
          88 Form2-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 TMP-DataSet1-tmovmag-BUF     PIC X(256).
       77 TMP-DataSet1-rmovmag-BUF     PIC X(446).
       77 TMP-DataSet1-clienti-BUF     PIC X(3610).
       77 TMP-DataSet1-tmagaz-BUF     PIC X(212).
       77 TMP-DataSet1-tparamge-BUF     PIC X(815).
       77 TMP-DataSet1-tcodpag-BUF     PIC X(1380).
       77 TMP-DataSet1-tcaumag-BUF     PIC X(254).
       77 TMP-DataSet1-articoli-BUF     PIC X(3669).
       77 TMP-DataSet1-timposte-BUF     PIC X(717).
       77 TMP-DataSet1-progmag-BUF     PIC X(1090).
       77 TMP-DataSet1-tmarche-BUF     PIC X(217).
       77 TMP-DataSet1-timballi-BUF     PIC X(210).
       77 TMP-DataSet1-destini-BUF     PIC X(3676).
       77 TMP-DataSet1-timbalqta-BUF     PIC X(167).
       77 TMP-DataSet1-ttipocli-BUF     PIC X(889).
       77 TMP-DataSet1-tmp-progmag-zoom-BUF     PIC X(195).
       77 TMP-DataSet1-tgrupgdo-BUF     PIC X(1206).
       77 TMP-DataSet1-tordforn-BUF     PIC X(556).
       77 TMP-DataSet1-rordforn-BUF     PIC X(544).
       77 TMP-DataSet1-reva-BUF     PIC X(260).
       77 TMP-DataSet1-tvettori-BUF     PIC X(1847).
       77 TMP-DataSet1-teva-BUF     PIC X(199).
       77 TMP-DataSet1-brnotacr-BUF     PIC X(424).
       77 TMP-DataSet1-btnotacr-BUF     PIC X(912).
       77 TMP-DataSet1-tsetinvio-BUF     PIC X(1023).
       77 TMP-DataSet1-tcontat-BUF     PIC X(3270).
       77 TMP-DataSet1-movutf-BUF     PIC X(217).
       77 TMP-DataSet1-tnazioni-BUF     PIC X(190).
       77 TMP-DataSet1-lineseq-mail-BUF     PIC X(1000).
      * VARIABLES FOR RECORD LENGTH.
       77  TotemFdSlRecordClearOffset   PIC 9(5) COMP-4.
       77  TotemFdSlRecordLength        PIC 9(5) COMP-4.
      * FILE'S LOCK MODE FLAG
       77 DataSet1-tmovmag-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tmovmag-LOCK  VALUE "Y".
       77 DataSet1-KEYIS   PIC 9(3) VALUE 1.
       77 DataSet1-tmovmag-KEY1-ORDER  PIC X VALUE "A".
          88 DataSet1-tmovmag-KEY1-Asc  VALUE "A".
          88 DataSet1-tmovmag-KEY1-Desc VALUE "D".
       77 DataSet1-rmovmag-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-rmovmag-LOCK  VALUE "Y".
       77 DataSet1-rmovmag-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-rmovmag-KEY-Asc  VALUE "A".
          88 DataSet1-rmovmag-KEY-Desc VALUE "D".
       77 DataSet1-clienti-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-clienti-LOCK  VALUE "Y".
       77 DataSet1-clienti-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-clienti-KEY-Asc  VALUE "A".
          88 DataSet1-clienti-KEY-Desc VALUE "D".
       77 DataSet1-tmagaz-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tmagaz-LOCK  VALUE "Y".
       77 DataSet1-tmagaz-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tmagaz-KEY-Asc  VALUE "A".
          88 DataSet1-tmagaz-KEY-Desc VALUE "D".
       77 DataSet1-tparamge-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tparamge-LOCK  VALUE "Y".
       77 DataSet1-tparamge-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tparamge-KEY-Asc  VALUE "A".
          88 DataSet1-tparamge-KEY-Desc VALUE "D".
       77 DataSet1-tcodpag-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tcodpag-LOCK  VALUE "Y".
       77 DataSet1-tcodpag-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tcodpag-KEY-Asc  VALUE "A".
          88 DataSet1-tcodpag-KEY-Desc VALUE "D".
       77 DataSet1-tcaumag-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tcaumag-LOCK  VALUE "Y".
       77 DataSet1-tcaumag-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tcaumag-KEY-Asc  VALUE "A".
          88 DataSet1-tcaumag-KEY-Desc VALUE "D".
       77 DataSet1-articoli-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-articoli-LOCK  VALUE "Y".
       77 DataSet1-articoli-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-articoli-KEY-Asc  VALUE "A".
          88 DataSet1-articoli-KEY-Desc VALUE "D".
       77 DataSet1-timposte-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-timposte-LOCK  VALUE "Y".
       77 DataSet1-timposte-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-timposte-KEY-Asc  VALUE "A".
          88 DataSet1-timposte-KEY-Desc VALUE "D".
       77 DataSet1-progmag-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-progmag-LOCK  VALUE "Y".
       77 DataSet1-progmag-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-progmag-KEY-Asc  VALUE "A".
          88 DataSet1-progmag-KEY-Desc VALUE "D".
       77 DataSet1-tmarche-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tmarche-LOCK  VALUE "Y".
       77 DataSet1-tmarche-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tmarche-KEY-Asc  VALUE "A".
          88 DataSet1-tmarche-KEY-Desc VALUE "D".
       77 DataSet1-timballi-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-timballi-LOCK  VALUE "Y".
       77 DataSet1-timballi-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-timballi-KEY-Asc  VALUE "A".
          88 DataSet1-timballi-KEY-Desc VALUE "D".
       77 DataSet1-destini-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-destini-LOCK  VALUE "Y".
       77 DataSet1-destini-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-destini-KEY-Asc  VALUE "A".
          88 DataSet1-destini-KEY-Desc VALUE "D".
       77 DataSet1-timbalqta-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-timbalqta-LOCK  VALUE "Y".
       77 DataSet1-timbalqta-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-timbalqta-KEY-Asc  VALUE "A".
          88 DataSet1-timbalqta-KEY-Desc VALUE "D".
       77 DataSet1-ttipocli-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-ttipocli-LOCK  VALUE "Y".
       77 DataSet1-ttipocli-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-ttipocli-KEY-Asc  VALUE "A".
          88 DataSet1-ttipocli-KEY-Desc VALUE "D".
       77 DataSet1-tmp-progmag-zoom-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tmp-progmag-zoom-LOCK  VALUE "Y".
       77 DataSet1-tmp-progmag-zoom-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tmp-progmag-zoom-KEY-Asc  VALUE "A".
          88 DataSet1-tmp-progmag-zoom-KEY-Desc VALUE "D".
       77 DataSet1-tgrupgdo-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tgrupgdo-LOCK  VALUE "Y".
       77 DataSet1-tgrupgdo-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tgrupgdo-KEY-Asc  VALUE "A".
          88 DataSet1-tgrupgdo-KEY-Desc VALUE "D".
       77 DataSet1-tordforn-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tordforn-LOCK  VALUE "Y".
       77 DataSet1-tordforn-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tordforn-KEY-Asc  VALUE "A".
          88 DataSet1-tordforn-KEY-Desc VALUE "D".
       77 DataSet1-rordforn-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-rordforn-LOCK  VALUE "Y".
       77 DataSet1-rordforn-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-rordforn-KEY-Asc  VALUE "A".
          88 DataSet1-rordforn-KEY-Desc VALUE "D".
       77 DataSet1-reva-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-reva-LOCK  VALUE "Y".
       77 DataSet1-reva-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-reva-KEY-Asc  VALUE "A".
          88 DataSet1-reva-KEY-Desc VALUE "D".
       77 DataSet1-tvettori-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tvettori-LOCK  VALUE "Y".
       77 DataSet1-tvettori-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tvettori-KEY-Asc  VALUE "A".
          88 DataSet1-tvettori-KEY-Desc VALUE "D".
       77 DataSet1-teva-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-teva-LOCK  VALUE "Y".
       77 DataSet1-teva-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-teva-KEY-Asc  VALUE "A".
          88 DataSet1-teva-KEY-Desc VALUE "D".
       77 DataSet1-brnotacr-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-brnotacr-LOCK  VALUE "Y".
       77 DataSet1-brnotacr-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-brnotacr-KEY-Asc  VALUE "A".
          88 DataSet1-brnotacr-KEY-Desc VALUE "D".
       77 DataSet1-btnotacr-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-btnotacr-LOCK  VALUE "Y".
       77 DataSet1-btnotacr-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-btnotacr-KEY-Asc  VALUE "A".
          88 DataSet1-btnotacr-KEY-Desc VALUE "D".
       77 DataSet1-tsetinvio-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tsetinvio-LOCK  VALUE "Y".
       77 DataSet1-tsetinvio-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tsetinvio-KEY-Asc  VALUE "A".
          88 DataSet1-tsetinvio-KEY-Desc VALUE "D".
       77 DataSet1-tcontat-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tcontat-LOCK  VALUE "Y".
       77 DataSet1-tcontat-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tcontat-KEY-Asc  VALUE "A".
          88 DataSet1-tcontat-KEY-Desc VALUE "D".
       77 DataSet1-movutf-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-movutf-LOCK  VALUE "Y".
       77 DataSet1-movutf-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-movutf-KEY-Asc  VALUE "A".
          88 DataSet1-movutf-KEY-Desc VALUE "D".
       77 DataSet1-tnazioni-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tnazioni-LOCK  VALUE "Y".
       77 DataSet1-tnazioni-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tnazioni-KEY-Asc  VALUE "A".
          88 DataSet1-tnazioni-KEY-Desc VALUE "D".
       77 DataSet1-lineseq-mail-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-lineseq-mail-LOCK  VALUE "Y".
       77 DataSet1-lineseq-mail-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-lineseq-mail-KEY-Asc  VALUE "A".
          88 DataSet1-lineseq-mail-KEY-Desc VALUE "D".

       77 tmovmag-key01-SPLITBUF  PIC X(17).
       77 tmovmag-k2-SPLITBUF  PIC X(20).
       77 tmovmag-k-data-SPLITBUF  PIC X(17).
       77 rmovmag-k-articolo-SPLITBUF  PIC X(19).
       77 rmovmag-rmo-chiave-ricerca-SPLITBUF  PIC X(25).
       77 rmovmag-k-progmag-SPLITBUF  PIC X(21).
       77 rmovmag-k-art-data-SPLITBUF  PIC X(15).
       77 clienti-cli-K1-SPLITBUF  PIC X(47).
       77 clienti-cli-K3-SPLITBUF  PIC X(12).
       77 clienti-cli-K4-SPLITBUF  PIC X(8).
       77 tcodpag-TBL-CODICE-01-SPLITBUF  PIC X(53).
       77 tcaumag-k-mag-SPLITBUF  PIC X(5).
       77 articoli-art-k1-SPLITBUF  PIC X(51).
       77 articoli-art-k-frn-SPLITBUF  PIC X(16).
       77 progmag-key01-SPLITBUF  PIC X(21).
       77 destini-K1-SPLITBUF  PIC X(111).
       77 destini-k-localita-SPLITBUF  PIC X(36).
       77 tmp-progmag-zoom-key-des-SPLITBUF  PIC X(64).
       77 tmp-progmag-zoom-key-art-SPLITBUF  PIC X(7).
       77 tgrupgdo-gdo-k-g2-SPLITBUF  PIC X(9).
       77 tordforn-tof-k-causale-SPLITBUF  PIC X(17).
       77 tordforn-tof-k-stato-SPLITBUF  PIC X(14).
       77 tordforn-k-fornitore-SPLITBUF  PIC X(24).
       77 tordforn-tof-k-data-SPLITBUF  PIC X(21).
       77 tordforn-tof-k-consegna-SPLITBUF  PIC X(21).
       77 rordforn-rof-k-articolo-SPLITBUF  PIC X(24).
       77 rordforn-rof-k-art-mag-SPLITBUF  PIC X(27).
       77 reva-reva-k-articolo-SPLITBUF  PIC X(26).
       77 tvettori-k-des-SPLITBUF  PIC X(41).
       77 teva-teva-stato-SPLITBUF  PIC X(14).
       77 brnotacr-brno-k-articolo-SPLITBUF  PIC X(25).
       77 btnotacr-k1-SPLITBUF  PIC X(23).
       77 btnotacr-k-data-SPLITBUF  PIC X(17).
       77 btnotacr-k-fattura-SPLITBUF  PIC X(13).
       77 btnotacr-k-reso-SPLITBUF  PIC X(13).
       77 btnotacr-k-bolla-SPLITBUF  PIC X(25).
       77 btnotacr-k-vettore-SPLITBUF  PIC X(18).
       77 btnotacr-k-nota-SPLITBUF  PIC X(13).
       77 btnotacr-k-fatman-SPLITBUF  PIC X(13).
       77 movutf-k-data-SPLITBUF  PIC X(32).
       77 movutf-k-data-bolla-SPLITBUF  PIC X(42).
       77 movutf-k-data-reg-SPLITBUF  PIC X(42).
       77 movutf-k-data-movim-SPLITBUF  PIC X(40).
      * FOR SPLIT KEY BUFFER
       77 DataSet1-tmp-progmag-zoom-SPLIT-BUF1   PIC X(64).


      *{TOTEM}END

      *{TOTEM}ID-LOGICI
      ***** Elenco ID Logici *****
       78  78-ID-ef-data VALUE 5001.
       78  78-ID-ef-causale VALUE 5002.
       78  78-ID-ef-clifor VALUE 5003.
       78  78-ID-ef-destino VALUE 5004.
       78  78-ID-ef-vettore VALUE 5005.
       78  78-ID-ef-num VALUE 5006.
       78  78-ID-ef-data-doc VALUE 5007.
       78  78-ID-ef-via VALUE 5008.
       78  78-ID-ef-data-via VALUE 5009.
       78  78-ID-ef-pag VALUE 5010.
       78  78-ID-ef-mag VALUE 5011.
       78  78-ID-cbo-stato VALUE 5012.
       78  78-ID-ef-art VALUE 5013.
       78  78-ID-ef-qta VALUE 5014.
       78  78-ID-ef-listino VALUE 5015.
       78  78-ID-ef-sconto VALUE 5016.
       78  78-ID-ef-cons VALUE 5017.
       78  78-ID-ef-coubat VALUE 5018.
       78  78-ID-ef-definitivo VALUE 5001.
      ***** Fine ID Logici *****
      *{TOTEM}END

       LINKAGE          SECTION.
      *{TOTEM}LINKAGE
           COPY  "COMMON-LINKAGE.DEF".
       01 LinkChiave.
           05 LinkAnno         PIC  9(4).
           05 LinkNumero       PIC  9(8).
       77 LinkRicaricaGrid PIC  9.
           88 RicaricaGrid VALUE IS 1    WHEN SET TO FALSE  0. 

      *{TOTEM}END

       SCREEN           SECTION.
      *{TOTEM}COPY-SCREEN
      * FORM
       01 
           Form1, 
           AFTER PROCEDURE Form1-AfterProcedure,
           BEFORE PROCEDURE Form1-BeforeProcedure,
           .

      * BAR
       05
           Form1-Br-2, 
           Bar,
           COL 1,00, 
           LINE 10,00,
           SIZE 158,00 ,
           ID IS 100,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           COLORS (8, 8),
           SHADING (-1, 1),
           WIDTH 2,
           .

      * LABEL
       05
           Form1-Custom1-1, 
           Label, 
           COL 102,50, 
           LINE 1,69,
           LINES 0,62 ,
           SIZE 12,33 ,
           FONT IS Default-Font,
           ID IS 666,
           TRANSPARENT,
           TITLE "CUSTOM CONTROL",
           VISIBLE v-custom,
           .

      * TAB
       05
           Screen1-Ta-1, 
           Tab-Control, 
           COL 2,50, 
           LINE 10,92,
           LINES 35,54 ,
           SIZE 155,00 ,
           ID IS 5000,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           EVENT PROCEDURE Screen1-Ta-1-Event-Proc,
           .

      * PAGE
       05
           PAGE-1, 
           VISIBLE Form1-Pg-1-Visible,
           COL 4, 
           LINE 13,
           .

      * ENTRY FIELD
       10
           ef-data, 
           Entry-Field, 
           COL 27,17, 
           LINE 15,61,
           LINES 1,31 ,
           SIZE 11,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod-campi,
           FONT IS Small-Font,
           ID IS 78-ID-ef-data,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           MAX-TEXT 8,
           VALUE ef-data-BUF,
           .

      * ENTRY FIELD
       10
           ef-causale, 
           Entry-Field, 
           COL 27,17, 
           LINE 18,61,
           LINES 1,31 ,
           SIZE 7,00 ,
           BOXED,
           UPPER,
           COLOR IS 513,
           ENABLED mod-campi,
           FONT IS Small-Font,
           ID IS 78-ID-ef-causale,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           LEFT,
           MAX-TEXT 4,
           VALUE ef-causale-BUF,
           .

      * ENTRY FIELD
       10
           ef-clifor, 
           Entry-Field, 
           COL 27,17, 
           LINE 21,61,
           LINES 1,31 ,
           SIZE 7,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod-campi,
           FONT IS Small-Font,
           ID IS 78-ID-ef-clifor,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 5,
           VALUE ef-clifor-BUF,
           .

      * ENTRY FIELD
       10
           ef-destino, 
           Entry-Field, 
           COL 27,17, 
           LINE 24,61,
           LINES 1,31 ,
           SIZE 7,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod-campi,
           FONT IS Small-Font,
           ID IS 78-ID-ef-destino,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 5,
           VALUE ef-destino-BUF,
           VISIBLE v-destino,
           .

      * ENTRY FIELD
       10
           ef-vettore, 
           Entry-Field, 
           COL 27,17, 
           LINE 27,61,
           LINES 1,31 ,
           SIZE 7,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod-campi,
           FONT IS Small-Font,
           ID IS 78-ID-ef-vettore,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 5,
           VALUE ef-vettore-BUF,
           .

      * ENTRY FIELD
       10
           ef-num, 
           Entry-Field, 
           COL 27,17, 
           LINE 30,61,
           LINES 1,31 ,
           SIZE 11,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod-campi,
           FONT IS Small-Font,
           ID IS 78-ID-ef-num,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 15,
           NUMERIC,
           VALUE ef-num-BUF,
           .

      * ENTRY FIELD
       10
           ef-data-doc, 
           Entry-Field, 
           COL 84,17, 
           LINE 30,61,
           LINES 1,31 ,
           SIZE 11,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod-campi,
           FONT IS Small-Font,
           ID IS 78-ID-ef-data-doc,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           MAX-TEXT 8,
           VALUE ef-data-doc-BUF,
           .

      * ENTRY FIELD
       10
           ef-via, 
           Entry-Field, 
           COL 27,17, 
           LINE 33,61,
           LINES 1,31 ,
           SIZE 11,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod-campi,
           FONT IS Small-Font,
           ID IS 78-ID-ef-via,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 8,
           NUMERIC,
           VALUE ef-via-BUF,
           .

      * ENTRY FIELD
       10
           ef-data-via, 
           Entry-Field, 
           COL 84,17, 
           LINE 33,61,
           LINES 1,31 ,
           SIZE 11,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod-campi,
           FONT IS Small-Font,
           ID IS 78-ID-ef-data-via,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           MAX-TEXT 8,
           VALUE ef-data-via-BUF,
           .

      * ENTRY FIELD
       10
           ef-pag, 
           Entry-Field, 
           COL 27,17, 
           LINE 36,61,
           LINES 1,31 ,
           SIZE 7,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod-campi,
           FONT IS Small-Font,
           ID IS 78-ID-ef-pag,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 3,
           VALUE ef-pag-BUF,
           .

      * ENTRY FIELD
       10
           ef-mag, 
           Entry-Field, 
           COL 27,17, 
           LINE 39,61,
           LINES 1,31 ,
           SIZE 7,00 ,
           BOXED,
           UPPER,
           COLOR IS 513,
           ENABLED mod-campi,
           FONT IS Small-Font,
           ID IS 78-ID-ef-mag,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           LEFT,
           MAX-TEXT 3,
           READ-ONLY,
           VALUE ef-mag-BUF,
           .

      * COMBO-BOX
       10
           cbo-stato, 
           Combo-Box, 
           COL 27,17, 
           LINE 42,61,
           LINES 3,00 ,
           SIZE 17,00 ,
           3-D,
           COLOR IS 513,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 78-ID-cbo-stato,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MASS-UPDATE 0,
           NOTIFY-SELCHANGE,
           DROP-LIST,
           UNSORTED,
           VALUE cbo-stato-buf,
           AFTER PROCEDURE cbo-stato-AfterProcedure, 
           .

      * LABEL
       10
           Form1-La-4, 
           Label, 
           COL 5,17, 
           LINE 30,61,
           LINES 1,31 ,
           SIZE 19,00 ,
           FONT IS Small-Font,
           ID IS 13,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Numero Bolla",
           .

      * LABEL
       10
           Form1-La-5, 
           Label, 
           COL 5,17, 
           LINE 15,61,
           LINES 1,31 ,
           SIZE 14,00 ,
           FONT IS Small-Font,
           ID IS 15,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Data movimento",
           .

      * LABEL
       10
           Form1-La-6, 
           Label, 
           COL 72,17, 
           LINE 30,61,
           LINES 1,31 ,
           SIZE 10,00 ,
           FONT IS Small-Font,
           ID IS 17,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Data Bolla",
           .

      * LABEL
       10
           Form1-La-7, 
           Label, 
           COL 5,17, 
           LINE 18,61,
           LINES 1,31 ,
           SIZE 19,00 ,
           FONT IS Small-Font,
           ID IS 19,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Causale di magazzino",
           .

      * LABEL
       10
           lab-clifor, 
           Label, 
           COL 5,17, 
           LINE 21,61,
           LINES 1,31 ,
           SIZE 19,00 ,
           FONT IS Small-Font,
           ID IS 21,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE codice-clifor,
           .

      * LABEL
       10
           Form1-La-9, 
           Label, 
           COL 5,17, 
           LINE 36,61,
           LINES 1,31 ,
           SIZE 19,00 ,
           FONT IS Small-Font,
           ID IS 23,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Codice pagamento",
           .

      * LABEL
       10
           Form1-La-10, 
           Label, 
           COL 5,17, 
           LINE 39,61,
           LINES 1,31 ,
           SIZE 19,00 ,
           FONT IS Small-Font,
           ID IS 25,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Codice magazzino",
           .

      * LABEL
       10
           Form1-La-29, 
           Label, 
           COL 5,17, 
           LINE 42,61,
           LINES 1,31 ,
           SIZE 10,00 ,
           FONT IS Small-Font,
           ID IS 57,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Stato",
           .

      * DB_LABEL
       10
           lab-causale, 
           Label, 
           COL 35,17, 
           LINE 18,61,
           LINES 1,31 ,
           SIZE 100,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 45,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-causale-BUF,
           TRANSPARENT,
           .

      * DB_LABEL
       10
           lab-cli, 
           Label, 
           COL 35,17, 
           LINE 21,61,
           LINES 1,31 ,
           SIZE 100,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 47,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-cli-BUF,
           TRANSPARENT,
           .

      * DB_LABEL
       10
           lab-mag, 
           Label, 
           COL 35,17, 
           LINE 39,61,
           LINES 1,31 ,
           SIZE 100,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 48,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-mag-BUF,
           TRANSPARENT,
           .

      * LABEL
       10
           lab-prg-des, 
           Label, 
           COL 5,17, 
           LINE 24,61,
           LINES 1,31 ,
           SIZE 19,00 ,
           FONT IS Small-Font,
           ID IS 5,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Progressivo destino",
           VISIBLE v-destino,
           .

      * DB_LABEL
       10
           lab-destino, 
           Label, 
           COL 35,17, 
           LINE 24,61,
           LINES 1,31 ,
           SIZE 100,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 9,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-destino-BUF,
           TRANSPARENT,
           VISIBLE v-destino,
           .

      * LABEL
       10
           lab-pag, 
           Label, 
           COL 35,17, 
           LINE 36,61,
           LINES 1,31 ,
           SIZE 100,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 14,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-pag-buf,
           .

      * FRAME
       10
           Screen1-Fr-1a, 
           Frame, 
           COL 55,00, 
           LINE 13,15,
           LINES 3,38 ,
           SIZE 50,00 ,
           COLOR IS 525,
           ID IS 2,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           HEAVY,
           VISIBLE v-cons,
           .

      * LABEL
       10
           Screen1-La-8, 
           Label, 
           COL 59,00, 
           LINE 14,15,
           LINES 1,62 ,
           SIZE 42,00 ,
           COLOR IS 13,
           FONT IS Verdana16-Occidentale,
           ID IS 4,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Movimento Consolidato",
           VISIBLE v-cons,
           .

      * LABEL
       10
           lab-prg-desa, 
           Label, 
           COL 5,17, 
           LINE 27,61,
           LINES 1,31 ,
           SIZE 19,00 ,
           FONT IS Small-Font,
           ID IS 6,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Codice Vettore",
           .

      * DB_LABEL
       10
           lab-vettore, 
           Label, 
           COL 35,17, 
           LINE 27,61,
           LINES 1,31 ,
           SIZE 100,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 7,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-vettore-BUF,
           TRANSPARENT,
           .

      * LABEL
       10
           Form1-La-4a, 
           Label, 
           COL 5,17, 
           LINE 33,61,
           LINES 1,31 ,
           SIZE 19,00 ,
           FONT IS Small-Font,
           ID IS 8,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Numero VIA",
           .

      * LABEL
       10
           Form1-La-6a, 
           Label, 
           COL 72,17, 
           LINE 33,61,
           LINES 1,31 ,
           SIZE 10,00 ,
           FONT IS Small-Font,
           ID IS 10,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Data VIA",
           .

      * PAGE
       05
           PAGE-2, 
           VISIBLE Form1-Pg-2-Visible,
           COL 4, 
           LINE 13,
           .

      * ENTRY FIELD
       10
           ef-art, 
           Entry-Field, 
           COL 14,17, 
           LINE 36,61,
           LINES 1,31 ,
           SIZE 7,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod-campi,
           FONT IS Small-Font,
           ID IS 78-ID-ef-art,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 6,
           VALUE ef-art-BUF,
           .

      * ENTRY FIELD
       10
           ef-qta, 
           Entry-Field, 
           COL 14,17, 
           LINE 40,61,
           LINES 1,31 ,
           SIZE 10,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod-campi,
           FONT IS Small-Font,
           ID IS 78-ID-ef-qta,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 8,
           VALUE ef-qta-BUF,
           .

      * ENTRY FIELD
       10
           ef-listino, 
           Entry-Field, 
           COL 14,17, 
           LINE 42,61,
           LINES 1,31 ,
           SIZE 14,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod-campi,
           FONT IS Small-Font,
           ID IS 78-ID-ef-listino,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 12,
           VALUE ef-listino-BUF,
           .

      * ENTRY FIELD
       10
           ef-sconto, 
           Entry-Field, 
           COL 41,17, 
           LINE 42,61,
           LINES 1,31 ,
           SIZE 6,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod-campi,
           FONT IS Small-Font,
           ID IS 78-ID-ef-sconto,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 5,
           VALUE ef-sconto-BUF,
           .

      * ENTRY FIELD
       10
           ef-cons, 
           Entry-Field, 
           COL 70,17, 
           LINE 42,61,
           LINES 1,31 ,
           SIZE 8,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod-campi,
           FONT IS Small-Font,
           ID IS 78-ID-ef-cons,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 7,
           VALUE ef-cons-BUF,
           .

      * ENTRY FIELD
       10
           ef-coubat, 
           Entry-Field, 
           COL 103,17, 
           LINE 42,61,
           LINES 1,31 ,
           SIZE 8,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod-campi,
           FONT IS Small-Font,
           ID IS 78-ID-ef-coubat,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 7,
           VALUE ef-coubat-BUF,
           .

      * GRID
       10
           Form1-Gd-1, 
           Grid, 
           COL 4,67, 
           LINE 14,61,
           LINES 19,54 ,
           SIZE 150,50 ,
           BOXED,
           CENTERED-HEADINGS,
           COLOR IS 516,
           DATA-COLUMNS (1, 6, 12, 62, 70, 80, 99, 113, 118, 132, 140, 
           148),
           ALIGNMENT ("R", "R", "U", "R", "R", "R", "R", "R", "R", "R", 
           "R", "R"),
           SEPARATION (5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5),
           DATA-TYPES ("9(5)", "9(6)", "X", "9(8)", "9(7)", "9(9)", "9(1
      -    "2)", "9(4)", "9(12)", "9(6)", "9(6)", "9(15)"),
           NUM-COL-HEADINGS 1,
           COLUMN-HEADINGS,
           CURSOR-FRAME-WIDTH 0,
           DIVIDER-COLOR 1,
           HEADING-COLOR 257,
           HEADING-DIVIDER-COLOR 1,
           ID IS 2000,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           ROW-HEADINGS,
           TILED-HEADINGS,
           VPADDING 54,
           VSCROLL,
           EVENT PROCEDURE Form1-Gd-1-Event-Proc,
           .

      * LABEL
       10
           Form1-La-1, 
           Label, 
           COL 5,17, 
           LINE 36,61,
           LINES 1,31 ,
           SIZE 8,00 ,
           FONT IS Small-Font,
           ID IS 2001,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Articolo",
           .

      * LABEL
       10
           Form1-La-2, 
           Label, 
           COL 5,17, 
           LINE 40,61,
           LINES 1,31 ,
           SIZE 8,00 ,
           FONT IS Small-Font,
           ID IS 2003,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Quantità",
           .

      * LABEL
       10
           Form1-La-8, 
           Label, 
           COL 5,17, 
           LINE 42,61,
           LINES 1,31 ,
           SIZE 8,00 ,
           FONT IS Small-Font,
           ID IS 2005,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Listino",
           .

      * LABEL
       10
           Form1-La-12, 
           Label, 
           COL 30,17, 
           LINE 42,61,
           LINES 1,31 ,
           SIZE 9,00 ,
           FONT IS Small-Font,
           ID IS 2007,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "% Sconto",
           .

      * LABEL
       10
           lab-coubat, 
           Label, 
           COL 82,17, 
           LINE 42,61,
           LINES 1,31 ,
           SIZE 19,00 ,
           FONT IS Small-Font,
           ID IS 2011,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE label-cou-cobat,
           .

      * DB_LABEL
       10
           lab-desart, 
           Label, 
           COL 30,17, 
           LINE 36,61,
           LINES 1,31 ,
           SIZE 45,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 2013,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-desart-BUF,
           TRANSPARENT,
           .

      * DB_LABEL
       10
           lab-udm, 
           Label, 
           COL 91,17, 
           LINE 36,61,
           LINES 1,31 ,
           SIZE 4,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 2014,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-udm-BUF,
           TRANSPARENT,
           .

      * DB_LABEL
       10
           lab-imb, 
           Label, 
           COL 40,17, 
           LINE 38,61,
           LINES 1,31 ,
           SIZE 6,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 2015,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-imb-BUF,
           TRANSPARENT,
           .

      * LABEL
       10
           Form1-La-15, 
           Label, 
           COL 97,17, 
           LINE 38,61,
           LINES 1,31 ,
           SIZE 6,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 2017,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Totale",
           .

      * LABEL
       10
           lab-tot, 
           Label, 
           COL 107,17, 
           LINE 38,61,
           LINES 1,31 ,
           SIZE 14,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 2018,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           TRANSPARENT,
           TITLE lab-tot-buf,
           .

      * LABEL
       10
           Form1-La-17, 
           Label, 
           COL 51,84, 
           LINE 42,61,
           LINES 1,31 ,
           SIZE 17,00 ,
           FONT IS Small-Font,
           ID IS 2019,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Imposta di consumo",
           .

      * DB_LABEL
       10
           lab-desimb, 
           Label, 
           COL 48,17, 
           LINE 38,61,
           LINES 1,31 ,
           SIZE 47,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 2021,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-desimb-BUF,
           TRANSPARENT,
           .

      * LABEL
       10
           Form1-La-18, 
           Label, 
           COL 77,17, 
           LINE 36,61,
           LINES 1,31 ,
           SIZE 13,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 1,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Unità di misura",
           .

      * LABEL
       10
           Form1-La-20, 
           Label, 
           COL 30,17, 
           LINE 38,61,
           LINES 1,31 ,
           SIZE 9,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 3,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Imballo",
           .

      * LABEL
       10
           Form1-La-21, 
           Label, 
           COL 30,17, 
           LINE 40,61,
           LINES 1,31 ,
           SIZE 11,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 11,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Peso U.d.M.",
           .

      * LABEL
       10
           Form1-La-22, 
           Label, 
           COL 53,17, 
           LINE 40,61,
           LINES 1,31 ,
           SIZE 9,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 12,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Totale Kg.",
           .

      * LABEL
       10
           lab-peso-kg, 
           Label, 
           COL 63,17, 
           LINE 40,61,
           LINES 1,31 ,
           SIZE 18,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 16,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           TRANSPARENT,
           TITLE lab-peso-kg-buf,
           .

      * PUSH BUTTON
       10
           pb-grid-elimina, 
           Push-Button, 
           COL 139,17, 
           LINE 34,61,
           LINES 2,15 ,
           SIZE 13,50 ,
           BITMAP-HANDLE STRIP_GRID_GCLIENTI-BMP,
           BITMAP-NUMBER 4,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 1005,
           FLAT,
           FONT IS Small-Font,
           ID IS 1001,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           SELF-ACT,
           TITLE "&Elimina la riga selezionata",
           AFTER PROCEDURE pb-grid-elimina-AfterProcedure, 
           BEFORE PROCEDURE pb-grid-elimina-BeforeProcedure, 
           .

      * PUSH BUTTON
       10
           pb-codici, 
           Push-Button, 
           COL 139,17, 
           LINE 37,38,
           LINES 29,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE ALTERNATIVI-BMP,
           UNFRAMED,
           SQUARE,
           ENABLED mod-campi,
           EXCEPTION-VALUE 1004,
           FLAT,
           FONT IS Small-Font,
           ID IS 87,
           SELF-ACT,
           TITLE "Creazione Codici Alternativi",
           BITMAP-NUMBER=NumBitmapCodici
           AFTER PROCEDURE pb-codici-AfterProcedure, 
           BEFORE PROCEDURE pb-codici-BeforeProcedure, 
           .

      * PUSH BUTTON
       10
           pb-grid-nuovo, 
           Push-Button, 
           COL 126,17, 
           LINE 34,61,
           LINES 2,15 ,
           SIZE 13,50 ,
           BITMAP-HANDLE STRIP_GRID_GCLIENTI-BMP,
           BITMAP-NUMBER 5,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 1002,
           FLAT,
           FONT IS Small-Font,
           ID IS 51,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           SELF-ACT,
           TITLE "Aggi&unge una riga all'ordine",
           AFTER PROCEDURE pb-grid-nuovo-AfterProcedure, 
           BEFORE PROCEDURE pb-grid-nuovo-BeforeProcedure, 
           .

      * DB_LABEL
       10
           lab-peso-udm, 
           Label, 
           COL 42,17, 
           LINE 40,61,
           LINES 1,31 ,
           SIZE 10,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 54,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-peso-udm-BUF,
           RIGHT,
           TRANSPARENT,
           .

      * LABEL
       10
           Form1-La-8a, 
           Label, 
           COL 118,50, 
           LINE 42,61,
           LINES 1,31 ,
           SIZE 10,00 ,
           FONT IS Small-Font,
           ID IS 55,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Imp. Merce",
           .

      * ENTRY FIELD
       10
           ef-imp-merce, 
           Entry-Field, 
           COL 130,17, 
           LINE 42,61,
           LINES 1,31 ,
           SIZE 14,00 ,
           BOXED,
           COLOR IS 33281,
           ENABLED mod-campi,
           FONT IS Small-Font,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 12,
           READ-ONLY,
           VALUE ef-imp-merce-BUF,
           .

      * LABEL
       05
           Form1-La-11, 
           Label, 
           COL 3,00, 
           LINE 4,00,
           LINES 1,31 ,
           SIZE 17,33 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 56,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Data del movimento",
           .

      * LABEL
       05
           lab-data, 
           Label, 
           COL 23,00, 
           LINE 4,00,
           LINES 1,31 ,
           SIZE 10,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 59,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-data-buf,
           .

      * LABEL
       05
           Form1-La-13, 
           Label, 
           COL 3,00, 
           LINE 6,00,
           LINES 1,31 ,
           SIZE 17,33 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 18,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Causale di magazzino",
           .

      * LABEL
       05
           lab-cau, 
           Label, 
           COL 23,00, 
           LINE 6,00,
           LINES 1,31 ,
           SIZE 8,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 27,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           LEFT,
           TRANSPARENT,
           TITLE lab-cau-buf,
           .

      * LABEL
       05
           lab-des-cau, 
           Label, 
           COL 32,00, 
           LINE 6,00,
           LINES 1,31 ,
           SIZE 70,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 29,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-des-cau-buf,
           .

      * LABEL
       05
           Form1-La-16, 
           Label, 
           COL 3,00, 
           LINE 8,00,
           LINES 1,31 ,
           SIZE 17,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 31,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Codice di magazzino",
           .

      * LABEL
       05
           lab-codmag, 
           Label, 
           COL 23,00, 
           LINE 8,00,
           LINES 1,31 ,
           SIZE 8,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 33,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-codmag-buf,
           .

      * LABEL
       05
           lab-desmag, 
           Label, 
           COL 32,00, 
           LINE 8,00,
           LINES 1,31 ,
           SIZE 70,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 35,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-desmag-buf,
           .

      * BAR
       05
           Form1-Br-2a, 
           Bar,
           COL 1,00, 
           LINE 10,38,
           SIZE 158,00 ,
           ID IS 36,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           COLORS (8, 8),
           SHADING (-1, 1),
           WIDTH 2,
           .

      * LABEL
       05
           Form1-La-3, 
           Label, 
           COL 3,00, 
           LINE 2,00,
           LINES 1,31 ,
           SIZE 17,33 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 37,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Numero movimento",
           .

      * LABEL
       05
           lab-numero, 
           Label, 
           COL 24,00, 
           LINE 2,00,
           LINES 1,31 ,
           SIZE 9,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 38,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           TRANSPARENT,
           TITLE numero-edit,
           .

      * LABEL
       05
           Form1-La-23, 
           Label, 
           COL 104,00, 
           LINE 8,00,
           LINES 1,31 ,
           SIZE 17,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 39,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Peso UTF definitivo:",
           .

      * DB_LABEL
       05
           lab-peso-utf, 
           Label, 
           COL 122,00, 
           LINE 8,00,
           LINES 1,31 ,
           SIZE 17,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 40,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-peso-utf-BUF,
           RIGHT,
           TRANSPARENT,
           .

      * LABEL
       05
           lab-anno, 
           Label, 
           COL 61,50, 
           LINE 4,00,
           LINES 1,54 ,
           SIZE 37,00 ,
           COLOR IS 5,
           FONT IS Verdana12-Occidentale,
           ID IS 42,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE lab-anno-buf,
           .

      * FRAME
       05
           fr-evasione, 
           Frame, 
           COL 134,17, 
           LINE 1,00,
           LINES 4,77 ,
           SIZE 21,33 ,
           COLOR IS 2,
           ID IS 20,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Evasione",
           TITLE-POSITION 2,
           VISIBLE v-evasione,
           .

      * LABEL
       05
           Form1-La-3a, 
           Label, 
           COL 136,34, 
           LINE 2,38,
           LINES 1,31 ,
           SIZE 7,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 22,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Anno",
           VISIBLE v-evasione,
           .

      * LABEL
       05
           Form1-La-3aa, 
           Label, 
           COL 136,34, 
           LINE 3,85,
           LINES 1,31 ,
           SIZE 7,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 24,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Numero",
           VISIBLE v-evasione,
           .

      * LABEL
       05
           lab-anno-e, 
           Label, 
           COL 144,50, 
           LINE 2,38,
           LINES 1,31 ,
           SIZE 7,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 26,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           TRANSPARENT,
           TITLE lab-anno-e-buf,
           VISIBLE v-evasione,
           .

      * LABEL
       05
           lab-numero-e, 
           Label, 
           COL 144,50, 
           LINE 3,85,
           LINES 1,31 ,
           SIZE 7,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 28,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           TRANSPARENT,
           TITLE lab-numero-e-buf,
           VISIBLE v-evasione,
           .

      * TOOLBAR
       01
           Form1-Tb-1,
           .    

      * PUSH BUTTON
       05
           TOOL-ESCI, 
           Push-Button, 
           COL 1,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           ENABLED E-ESCI,
           EXCEPTION-VALUE 27,
           FLAT,
           ID IS 110,
           SELF-ACT,
           ESCAPE-BUTTON,
           TITLE "Esci (Esc)",
           .

      * PUSH BUTTON
       05
           TOOL-NUOVO, 
           Push-Button, 
           COL 6,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           BITMAP-NUMBER 23,
           FRAMED,
           SQUARE,
           ENABLED E-NUOVO,
           FLAT,
           ID IS 111,
           SELF-ACT,
           TITLE "Nuovo (F2)",
           .

      * PUSH BUTTON
       05
           TOOL-CANCELLA, 
           Push-Button, 
           COL 16,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           FRAMED,
           SQUARE,
           ENABLED E-CANCELLA,
           EXCEPTION-VALUE 4,
           FLAT,
           ID IS 112,
           SELF-ACT,
           TITLE "Cancella (F4)",
           BITMAP-NUMBER BitmapNumDelete
           .

      * PUSH BUTTON
       05
           TOOL-SALVA, 
           Push-Button, 
           COL 11,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           FRAMED,
           SQUARE,
           ENABLED E-SALVA,
           EXCEPTION-VALUE 3,
           FLAT,
           ID IS 75,
           SELF-ACT,
           TITLE "Salva (F3)",
           BITMAP-NUMBER BitmapNumSave
           .

      * PUSH BUTTON
       05
           TOOL-ANTEPRIMA, 
           Push-Button, 
           COL 26,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           BITMAP-NUMBER 17,
           FRAMED,
           SQUARE,
           ENABLED E-ANTEPRIMA,
           FLAT,
           ID IS 76,
           SELF-ACT,
           TITLE "Anteprima (F6)",
           .

      * CHECK BOX
       05
           TOOL-MODIFICA, 
           Check-Box, 
           COL 21,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           BITMAP-NUMBER 5,
           FRAMED,
           SQUARE,
           ENABLED E-MODIFICA,
           EXCEPTION-VALUE 150
           FLAT,
           ID IS 77,
           SELF-ACT,
           TITLE "Modifica (F5)",
           VALUE 1,
           BITMAP-NUMBER BitmapNumEdit
           AFTER PROCEDURE TOOL-MODIFICA-AfterProcedure,
           BEFORE PROCEDURE TOOL-MODIFICA-BeforeProcedure, 
           .
      * PUSH BUTTON
       05
           TOOL-STAMPA, 
           Push-Button, 
           COL 31,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           BITMAP-NUMBER 18,
           FRAMED,
           SQUARE,
           ENABLED E-STAMPA,
           FLAT,
           ID IS 78,
           SELF-ACT,
           TITLE "Stampa (F7)",
           .

      * PUSH BUTTON
       05
           TOOL-CERCA, 
           Push-Button, 
           COL 36,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           FRAMED,
           SQUARE,
           ENABLED E-CERCA,
           EXCEPTION-VALUE 8,
           FLAT,
           ID IS 79,
           SELF-ACT,
           TITLE "Cerca (F8)",
           BITMAP-NUMBER BitmapNumZoom
           .

      * PUSH BUTTON
       05
           TOOL-SELEZIONA, 
           Push-Button, 
           COL 41,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           FRAMED,
           SQUARE,
           ENABLED E-SELEZIONA,
           FLAT,
           ID IS 80,
           SELF-ACT,
           TITLE "Seleziona (F9)",
           BITMAP-NUMBER BitmapNumSelect
           .

      * FORM
       01 
           Form2, 
           AFTER PROCEDURE  Form2-AFTER-SCREEN
           BEFORE PROCEDURE  Form2-BEFORE-SCREEN
           .

      * FRAME
       05
           Screen1-Fr-1, 
           Frame, 
           COL 2,10, 
           LINE 1,78,
           LINES 11,78 ,
           SIZE 38,80 ,
           ID IS 1,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Richiesta conferma peso",
           TITLE-POSITION 2,
           .

      * ENTRY FIELD
       05
           ef-definitivo, 
           Entry-Field, 
           COL 21,00, 
           LINE 8,78,
           LINES 1,28 ,
           SIZE 18,00 ,
           BOXED,
           COLOR IS 481,
           ID IS 78-ID-ef-definitivo,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           VALUE ef-definitivo-buf,
           AFTER PROCEDURE Screen1-Ef-1-AfterProcedure, 
           BEFORE PROCEDURE Screen1-Ef-1-BeforeProcedure, 
           .


      * PUSH BUTTON
       05
           PB-OK, 
           Push-Button, 
           COL 17,40, 
           LINE 10,78,
           LINES 2,06 ,
           SIZE 8,10 ,
           BITMAP-HANDLE BOTTONE-OK-BMP,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 27,
           FLAT,
           ID IS 5,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           ESCAPE-BUTTON,
           TITLE "OK",
           AFTER PROCEDURE PB-OK-AfterProcedure, 
           BEFORE PROCEDURE PB-OK-BeforeProcedure, 
           .

      * LABEL
       05
           Screen1-La-1, 
           Label, 
           COL 4,00, 
           LINE 3,78,
           LINES 1,28 ,
           SIZE 14,00 ,
           ID IS 2,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Da somma righe",
           .

      * LABEL
       05
           Screen1-La-2, 
           Label, 
           COL 4,00, 
           LINE 8,78,
           LINES 1,28 ,
           SIZE 14,00 ,
           ID IS 3,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Valore definitivo",
           .

      * LABEL
       05
           Screen1-La-3, 
           Label, 
           COL 4,00, 
           LINE 5,78,
           LINES 1,28 ,
           SIZE 14,00 ,
           ID IS 4,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Da testa",
           .

      * LABEL
       05
           lab-tot-righe, 
           Label, 
           COL 21,00, 
           LINE 3,78,
           LINES 1,28 ,
           SIZE 18,00 ,
           ID IS 6,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           TRANSPARENT,
           TITLE lab-tot-righe-buf,
           .

      * LABEL
       05
           lab-testa, 
           Label, 
           COL 21,00, 
           LINE 5,78,
           LINES 1,28 ,
           SIZE 18,00 ,
           ID IS 7,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           TRANSPARENT,
           TITLE lab-testa-buf,
           .

      * BAR
       05
           Screen1-Br-1a, 
           Bar,
           COL 4,00, 
           LINE 7,67,
           SIZE 35,00 ,
           ID IS 8,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           COLORS (8, 8),
           SHADING (1, -1),
           WIDTH 2,
           .

      * BAR
       05
           Screen1-Br-1aa, 
           Bar,
           COL 4,00, 
           LINE 8,00,
           SIZE 35,00 ,
           ID IS 9,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           COLORS (8, 8),
           SHADING (1, -1),
           WIDTH 2,
           .

      *{TOTEM}END

      *{TOTEM}LINKPARA
       PROCEDURE  DIVISION USING LK-BLOCKPGM, USER-CODI, LIVELLO-ABIL, 
           LinkChiave, LinkRicaricaGrid.
      *{TOTEM}END

      *{TOTEM}DECLARATIVE
       DECLARATIVES.
      * <TOTEM:EPT. INIT:gmovcvar, INIT:gmovcvar, BeforeDeclarative>

       copy "mail-decl.cpy".
       
       PROGMAG-ERROR SECTION.
           use after error procedure on progmag.
           set RecLocked to false.
           evaluate status-progmag
           when "35"
                display message "File [PROGMAG] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [PROGMAG] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[PROGMAG] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           when "93"
           when "99" set RecLocked to true
           end-evaluate.

       TMOVMAG-ERROR SECTION.
           use after error procedure on tmovmag.
           set RecLocked to false.
           evaluate status-tmovmag
           when "35"
                display message "File [TMOVMAG] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TMOVMAG] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TMOVMAG] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           when "93"
                display message "File già in uso!"
                          title tit-err
                           icon 3
                perform AFTER-PROGRAM
                goback
           when "99" set RecLocked to true
                display message box "Movimento già in uso su altro termi
      -    "nale!"
                             x"0d0a""Sarà possibile la sola visualizzazi
      -    "one."
                        title = titolo
                        icon 3
                move 0 to mod
                modify tool-modifica value = mod
           end-evaluate.

      ***---
       RMOVMAG-ERR SECTION.
           use after error procedure on rmovmag.
           set tutto-ok  to true.
           evaluate status-rmovmag
           when "35"
                display message "File [RMOVMAG] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [RMOVMAG] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[RMOVMAG] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       CLIENTI-ERR SECTION.
           use after error procedure on clienti.
           set tutto-ok  to true.
           evaluate status-clienti
           when "35"
                display message "File [CLIENTI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [CLIENTI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[CLIENTI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       TMAGAZ-ERR SECTION.
           use after error procedure on tmagaz.
           set tutto-ok  to true.
           evaluate status-tmagaz
           when "35"
                display message "File [TMAGAZ] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TMAGAZ] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TMAGAZ] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       TPARAMGE-ERR SECTION.
           use after error procedure on tparamge.
           set tutto-ok  to true.
           evaluate status-tparamge
           when "35"
                display message "File [TPARAMGE] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TPARAMGE] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TPARAMGE] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       TCODPAG-ERR SECTION.
           use after error procedure on tcodpag.
           set tutto-ok  to true.
           evaluate status-tcodpag
           when "35"
                display message "File [TCODPAG] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TCODPAG] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TCODPAG] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       TCAUMAG-ERR SECTION.
           use after error procedure on tcaumag.
           set tutto-ok  to true.
           evaluate status-tcaumag
           when "35"
                display message "File [TCAUMAG] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TCAUMAG] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TCAUMAG] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       ARTICOLI-ERR SECTION.
           use after error procedure on articoli.
           set tutto-ok  to true.
           evaluate status-articoli
           when "35"
                display message "File [ARTICOLI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [ARTICOLI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[ARTICOLI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       TIMPOSTE-ERR SECTION.
           use after error procedure on timposte.
           set tutto-ok  to true.
           evaluate status-timposte
           when "35"
                display message "File [TIMPOSTE] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TIMPOSTE] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TIMPOSTE] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.          
 
      ***---
       TMARCHE-ERR SECTION.
           use after error procedure on tmarche.
           set tutto-ok  to true.
           evaluate status-tmarche
           when "35"
                display message "File [TMARCHE] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TMARCHE] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TMARCHE] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       TIMBALLI-ERR SECTION.
           use after error procedure on timballi.
           set tutto-ok  to true.
           evaluate status-timballi
           when "35"
                display message "File [TIMBALLI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TIMBALLI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TIMBALLI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       DESTINI-ERR SECTION.
           use after error procedure on destini.
           set tutto-ok  to true.
           evaluate status-destini
           when "35"
                display message "File [DESTINI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [DESTINI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[DESTINI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       TIMBALQTA-ERR SECTION.
           use after error procedure on timbalqta.
           set tutto-ok  to true.
           evaluate status-timbalqta
           when "35"
                display message "File [TIMBALQTA] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TIMBALQTA] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TIMBALQTA] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       TVETTORI-ERR SECTION.
           use after error procedure on tvettori.
           set tutto-ok  to true.
           evaluate status-tvettori
           when "35"
                display message "File [TVETTORI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TVETTORI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TVETTORI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       TTIPOCLI-ERR SECTION.
           use after error procedure on ttipocli.
           set tutto-ok  to true.
           evaluate status-ttipocli
           when "35"
                display message "File [TTIPOCLI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TTIPOCLI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TTIPOCLI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       TMP-PROGMAG-ZOOM-ERR SECTION.
           use after error procedure on tmp-progmag-zoom.
           set tutto-ok  to true.
           evaluate status-tmp-progmag-zoom
           when "35"
                display message "File [TMP-PROGMAG-ZOOM] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TMP-PROGMAG-ZOOM] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TMP-PROGMAG-ZOOM] Indexed file corrupt
      -    "!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.

      ***---
       TORDFORN-ERROR SECTION.
           use after error procedure on tordforn.
           set RecLocked to false.
           evaluate status-tordforn
           when "35"
                display message "File [TORDFORN] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TORDFORN] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TORDFORN] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           when "93"
           when "99" set RecLocked to true
           end-evaluate.       
           
      ***---     
       MOVUTF-ERROR SECTION.
           use after error procedure on movutf.
           set RecLocked to false.
           evaluate status-movutf
           when "35"
                display message "File [MOVUTF] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [MOVUTF] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[MOVUTF] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           when "93"
           when "99" set RecLocked to true
           end-evaluate.

      * <TOTEM:END>
       INPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON INPUT.
       0100-DECL.
           EXIT.
       I-O-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON I-O.
       0200-DECL.
           EXIT.
       OUTPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON OUTPUT.
       0300-DECL.
           EXIT.
       TRANSACTION-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON TRANSACTION.
       0400-DECL.
           EXIT.
       END DECLARATIVES.
      *{TOTEM}END

       MAIN-LOGIC.
      *{TOTEM}ENTRY-BEFPRG
      *    Before-Program
           PERFORM anagr01-Ev-Before-Program
      *{TOTEM}END
           PERFORM INITIALIZE-ROUTINE.
      * run main screen
      *{TOTEM}RUN-MAINSCR
           PERFORM Form1-OPEN-ROUTINE.
      *{TOTEM}END

      *{TOTEM}COPY-PROCEDURE
       EXIT-STOP-ROUTINE.
           PERFORM CLOSE-FILE-RTN
      * <TOTEM:EPT. INIT:gmovcvar, INIT:gmovcvar, BeforeDestroyResource>
      * <TOTEM:END>
           DESTROY Verdana16-Occidentale
           DESTROY Verdana12-Occidentale
           CALL "w$bitmap" USING WBITMAP-DESTROY, 
           STRIP_GRID_GCLIENTI-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, ALTERNATIVI-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, TOOLBAR-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, BOTTONE-OK-BMP
      *    After-Program
           PERFORM anagr01-Ev-After-Program
           set environment "KEYSTROKE" to "DATA=46   46".
           set environment "KEYSTROKE" to "DATA=44   44".
           EXIT PROGRAM TOTEM-PgmStatus
           STOP RUN.

       INITIALIZE-ROUTINE.
      *    Before Init
      * initialize program status variable
           Initialize TOTEM-PgmStatus.
      * get system information
           ACCEPT SYSTEM-INFORMATION FROM SYSTEM-INFO.
      * get terminal information
           ACCEPT TERMINAL-ABILITIES FROM TERMINAL-INFO.
      * set font
           PERFORM INIT-FONT.
      * load bitmap
           PERFORM INIT-BMP.
      * load resource
           PERFORM INIT-RES.
      * create pop-up menu
           PERFORM INIT-POPUP.
      * open files
           PERFORM OPEN-FILE-RTN.
      *    After Init
           .
    
       INIT-FONT.
      * Verdana16-Occidentale
           INITIALIZE WFONT-DATA Verdana16-Occidentale
           MOVE 16 TO WFONT-SIZE
           MOVE "Verdana" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO FALSE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Verdana16-Occidentale, WFONT-DATA
      * Verdana12-Occidentale
           INITIALIZE WFONT-DATA Verdana12-Occidentale
           MOVE 12 TO WFONT-SIZE
           MOVE "Verdana" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO FALSE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Verdana12-Occidentale, WFONT-DATA
           .

       INIT-BMP.
      * pb-grid-elimina
           COPY RESOURCE "STRIP_GRID_GCLIENTI.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "STRIP_GRID_GCLIENTI.BMP"
           , 
                   GIVING STRIP_GRID_GCLIENTI-BMP.
      * pb-codici
           COPY RESOURCE "ALTERNATIVI.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "ALTERNATIVI.BMP", 
                   GIVING ALTERNATIVI-BMP.
      * TOOL-ESCI
           COPY RESOURCE "TOOLBAR.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "TOOLBAR.BMP", 
                   GIVING TOOLBAR-BMP.
      * PB-OK
           COPY RESOURCE "BOTTONE-OK.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "BOTTONE-OK.BMP", 
                   GIVING BOTTONE-OK-BMP.
           .

       INIT-RES.
           .

       INIT-POPUP.
           .

       OPEN-FILE-RTN.
      *    Before Open
           PERFORM OPEN-tmovmag
           PERFORM OPEN-rmovmag
           PERFORM OPEN-clienti
           PERFORM OPEN-tmagaz
           PERFORM OPEN-tparamge
           PERFORM OPEN-tcodpag
           PERFORM OPEN-tcaumag
           PERFORM OPEN-articoli
           PERFORM OPEN-timposte
           PERFORM OPEN-progmag
           PERFORM OPEN-tmarche
           PERFORM OPEN-timballi
           PERFORM OPEN-destini
           PERFORM OPEN-timbalqta
           PERFORM OPEN-ttipocli
      *    tmp-progmag-zoom OPEN MODE IS FALSE
      *    PERFORM OPEN-tmp-progmag-zoom
           PERFORM OPEN-tgrupgdo
           PERFORM OPEN-tordforn
           PERFORM OPEN-rordforn
           PERFORM OPEN-reva
           PERFORM OPEN-tvettori
           PERFORM OPEN-teva
           PERFORM OPEN-brnotacr
           PERFORM OPEN-btnotacr
      *    tsetinvio OPEN MODE IS FALSE
      *    PERFORM OPEN-tsetinvio
      *    tcontat OPEN MODE IS FALSE
      *    PERFORM OPEN-tcontat
      *    movutf OPEN MODE IS FALSE
      *    PERFORM OPEN-movutf
           PERFORM OPEN-tnazioni
           PERFORM OPEN-lineseq-mail
      *    After Open
           .

       OPEN-tmovmag.
      * <TOTEM:EPT. INIT:gmovcvar, FD:tmovmag, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O tmovmag
           IF STATUS-tmovmag = "35"
              OPEN OUTPUT tmovmag
                IF Valid-STATUS-tmovmag
                   CLOSE tmovmag
                   OPEN I-O tmovmag
                END-IF
           END-IF
           IF NOT Valid-STATUS-tmovmag
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovcvar, FD:tmovmag, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-rmovmag.
      * <TOTEM:EPT. INIT:gmovcvar, FD:rmovmag, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O rmovmag
           IF STATUS-rmovmag = "35"
              OPEN OUTPUT rmovmag
                IF Valid-STATUS-rmovmag
                   CLOSE rmovmag
                   OPEN I-O rmovmag
                END-IF
           END-IF
           IF NOT Valid-STATUS-rmovmag
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovcvar, FD:rmovmag, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-clienti.
      * <TOTEM:EPT. INIT:gmovcvar, FD:clienti, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT clienti
           IF NOT Valid-STATUS-clienti
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovcvar, FD:clienti, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tmagaz.
      * <TOTEM:EPT. INIT:gmovcvar, FD:tmagaz, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tmagaz
           IF NOT Valid-STATUS-tmagaz
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovcvar, FD:tmagaz, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tparamge.
      * <TOTEM:EPT. INIT:gmovcvar, FD:tparamge, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tparamge
           IF NOT Valid-STATUS-tparamge
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovcvar, FD:tparamge, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tcodpag.
      * <TOTEM:EPT. INIT:gmovcvar, FD:tcodpag, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tcodpag
           IF NOT Valid-STATUS-tcodpag
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovcvar, FD:tcodpag, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tcaumag.
      * <TOTEM:EPT. INIT:gmovcvar, FD:tcaumag, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tcaumag
           IF NOT Valid-STATUS-tcaumag
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovcvar, FD:tcaumag, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-articoli.
      * <TOTEM:EPT. INIT:gmovcvar, FD:articoli, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT articoli
           IF NOT Valid-STATUS-articoli
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovcvar, FD:articoli, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-timposte.
      * <TOTEM:EPT. INIT:gmovcvar, FD:timposte, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT timposte
           IF NOT Valid-STATUS-timposte
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovcvar, FD:timposte, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-progmag.
      * <TOTEM:EPT. INIT:gmovcvar, FD:progmag, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT progmag
           IF NOT Valid-STATUS-progmag
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovcvar, FD:progmag, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tmarche.
      * <TOTEM:EPT. INIT:gmovcvar, FD:tmarche, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tmarche
           IF NOT Valid-STATUS-tmarche
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovcvar, FD:tmarche, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-timballi.
      * <TOTEM:EPT. INIT:gmovcvar, FD:timballi, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT timballi
           IF NOT Valid-STATUS-timballi
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovcvar, FD:timballi, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-destini.
      * <TOTEM:EPT. INIT:gmovcvar, FD:destini, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT destini
           IF NOT Valid-STATUS-destini
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovcvar, FD:destini, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-timbalqta.
      * <TOTEM:EPT. INIT:gmovcvar, FD:timbalqta, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT timbalqta
           IF NOT Valid-STATUS-timbalqta
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovcvar, FD:timbalqta, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-ttipocli.
      * <TOTEM:EPT. INIT:gmovcvar, FD:ttipocli, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT ttipocli
           IF NOT Valid-STATUS-ttipocli
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovcvar, FD:ttipocli, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tmp-progmag-zoom.
      * <TOTEM:EPT. INIT:gmovcvar, FD:tmp-progmag-zoom, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O tmp-progmag-zoom
           IF STATUS-tmp-progmag-zoom = "35"
              OPEN OUTPUT tmp-progmag-zoom
                IF Valid-STATUS-tmp-progmag-zoom
                   CLOSE tmp-progmag-zoom
                   OPEN I-O tmp-progmag-zoom
                END-IF
           END-IF
           IF NOT Valid-STATUS-tmp-progmag-zoom
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovcvar, FD:tmp-progmag-zoom, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tgrupgdo.
      * <TOTEM:EPT. INIT:gmovcvar, FD:tgrupgdo, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tgrupgdo
           IF NOT Valid-STATUS-tgrupgdo
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovcvar, FD:tgrupgdo, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tordforn.
      * <TOTEM:EPT. INIT:gmovcvar, FD:tordforn, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O tordforn
           IF STATUS-tordforn = "35"
              OPEN OUTPUT tordforn
                IF Valid-STATUS-tordforn
                   CLOSE tordforn
                   OPEN I-O tordforn
                END-IF
           END-IF
           IF NOT Valid-STATUS-tordforn
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovcvar, FD:tordforn, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-rordforn.
      * <TOTEM:EPT. INIT:gmovcvar, FD:rordforn, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O rordforn
           IF STATUS-rordforn = "35"
              OPEN OUTPUT rordforn
                IF Valid-STATUS-rordforn
                   CLOSE rordforn
                   OPEN I-O rordforn
                END-IF
           END-IF
           IF NOT Valid-STATUS-rordforn
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovcvar, FD:rordforn, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-reva.
      * <TOTEM:EPT. INIT:gmovcvar, FD:reva, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O reva
           IF STATUS-reva = "35"
              OPEN OUTPUT reva
                IF Valid-STATUS-reva
                   CLOSE reva
                   OPEN I-O reva
                END-IF
           END-IF
           IF NOT Valid-STATUS-reva
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovcvar, FD:reva, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tvettori.
      * <TOTEM:EPT. INIT:gmovcvar, FD:tvettori, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tvettori
           IF NOT Valid-STATUS-tvettori
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovcvar, FD:tvettori, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-teva.
      * <TOTEM:EPT. INIT:gmovcvar, FD:teva, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O teva
           IF STATUS-teva = "35"
              OPEN OUTPUT teva
                IF Valid-STATUS-teva
                   CLOSE teva
                   OPEN I-O teva
                END-IF
           END-IF
           IF NOT Valid-STATUS-teva
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovcvar, FD:teva, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-brnotacr.
      * <TOTEM:EPT. INIT:gmovcvar, FD:brnotacr, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O brnotacr
           IF STATUS-brnotacr = "35"
              OPEN OUTPUT brnotacr
                IF Valid-STATUS-brnotacr
                   CLOSE brnotacr
                   OPEN I-O brnotacr
                END-IF
           END-IF
           IF NOT Valid-STATUS-brnotacr
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovcvar, FD:brnotacr, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-btnotacr.
      * <TOTEM:EPT. INIT:gmovcvar, FD:btnotacr, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O btnotacr
           IF STATUS-btnotacr = "35"
              OPEN OUTPUT btnotacr
                IF Valid-STATUS-btnotacr
                   CLOSE btnotacr
                   OPEN I-O btnotacr
                END-IF
           END-IF
           IF NOT Valid-STATUS-btnotacr
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovcvar, FD:btnotacr, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tsetinvio.
      * <TOTEM:EPT. INIT:gmovcvar, FD:tsetinvio, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O tsetinvio
           IF STATUS-tsetinvio = "35"
              OPEN OUTPUT tsetinvio
                IF Valid-STATUS-tsetinvio
                   CLOSE tsetinvio
                   OPEN I-O tsetinvio
                END-IF
           END-IF
           IF NOT Valid-STATUS-tsetinvio
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovcvar, FD:tsetinvio, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tcontat.
      * <TOTEM:EPT. INIT:gmovcvar, FD:tcontat, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tcontat
           IF NOT Valid-STATUS-tcontat
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovcvar, FD:tcontat, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-movutf.
      * <TOTEM:EPT. INIT:gmovcvar, FD:movutf, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O movutf
           IF STATUS-movutf = "35"
              OPEN OUTPUT movutf
                IF Valid-STATUS-movutf
                   CLOSE movutf
                   OPEN I-O movutf
                END-IF
           END-IF
           IF NOT Valid-STATUS-movutf
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovcvar, FD:movutf, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tnazioni.
      * <TOTEM:EPT. INIT:gmovcvar, FD:tnazioni, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tnazioni
           IF NOT Valid-STATUS-tnazioni
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovcvar, FD:tnazioni, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-lineseq-mail.
      * <TOTEM:EPT. INIT:gmovcvar, FD:lineseq-mail, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT lineseq-mail
           IF NOT Valid-STATUS-lineseq-mail
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovcvar, FD:lineseq-mail, AfterOpen>
      * <TOTEM:END>
           .

       CLOSE-FILE-RTN.
      *    Before Close
           PERFORM CLOSE-tmovmag
           PERFORM CLOSE-rmovmag
           PERFORM CLOSE-clienti
           PERFORM CLOSE-tmagaz
           PERFORM CLOSE-tparamge
           PERFORM CLOSE-tcodpag
           PERFORM CLOSE-tcaumag
           PERFORM CLOSE-articoli
           PERFORM CLOSE-timposte
           PERFORM CLOSE-progmag
           PERFORM CLOSE-tmarche
           PERFORM CLOSE-timballi
           PERFORM CLOSE-destini
           PERFORM CLOSE-timbalqta
           PERFORM CLOSE-ttipocli
      *    tmp-progmag-zoom CLOSE MODE IS FALSE
      *    PERFORM CLOSE-tmp-progmag-zoom
           PERFORM CLOSE-tgrupgdo
           PERFORM CLOSE-tordforn
           PERFORM CLOSE-rordforn
           PERFORM CLOSE-reva
           PERFORM CLOSE-tvettori
           PERFORM CLOSE-teva
           PERFORM CLOSE-brnotacr
           PERFORM CLOSE-btnotacr
      *    tsetinvio CLOSE MODE IS FALSE
      *    PERFORM CLOSE-tsetinvio
      *    tcontat CLOSE MODE IS FALSE
      *    PERFORM CLOSE-tcontat
      *    movutf CLOSE MODE IS FALSE
      *    PERFORM CLOSE-movutf
           PERFORM CLOSE-tnazioni
           PERFORM CLOSE-lineseq-mail
      *    After Close
           .

       CLOSE-tmovmag.
      * <TOTEM:EPT. INIT:gmovcvar, FD:tmovmag, BeforeClose>
      * <TOTEM:END>
           CLOSE tmovmag
           .

       CLOSE-rmovmag.
      * <TOTEM:EPT. INIT:gmovcvar, FD:rmovmag, BeforeClose>
      * <TOTEM:END>
           CLOSE rmovmag
           .

       CLOSE-clienti.
      * <TOTEM:EPT. INIT:gmovcvar, FD:clienti, BeforeClose>
      * <TOTEM:END>
           CLOSE clienti
           .

       CLOSE-tmagaz.
      * <TOTEM:EPT. INIT:gmovcvar, FD:tmagaz, BeforeClose>
      * <TOTEM:END>
           CLOSE tmagaz
           .

       CLOSE-tparamge.
      * <TOTEM:EPT. INIT:gmovcvar, FD:tparamge, BeforeClose>
      * <TOTEM:END>
           CLOSE tparamge
           .

       CLOSE-tcodpag.
      * <TOTEM:EPT. INIT:gmovcvar, FD:tcodpag, BeforeClose>
      * <TOTEM:END>
           CLOSE tcodpag
           .

       CLOSE-tcaumag.
      * <TOTEM:EPT. INIT:gmovcvar, FD:tcaumag, BeforeClose>
      * <TOTEM:END>
           CLOSE tcaumag
           .

       CLOSE-articoli.
      * <TOTEM:EPT. INIT:gmovcvar, FD:articoli, BeforeClose>
      * <TOTEM:END>
           CLOSE articoli
           .

       CLOSE-timposte.
      * <TOTEM:EPT. INIT:gmovcvar, FD:timposte, BeforeClose>
      * <TOTEM:END>
           CLOSE timposte
           .

       CLOSE-progmag.
      * <TOTEM:EPT. INIT:gmovcvar, FD:progmag, BeforeClose>
      * <TOTEM:END>
           CLOSE progmag
           .

       CLOSE-tmarche.
      * <TOTEM:EPT. INIT:gmovcvar, FD:tmarche, BeforeClose>
      * <TOTEM:END>
           CLOSE tmarche
           .

       CLOSE-timballi.
      * <TOTEM:EPT. INIT:gmovcvar, FD:timballi, BeforeClose>
      * <TOTEM:END>
           CLOSE timballi
           .

       CLOSE-destini.
      * <TOTEM:EPT. INIT:gmovcvar, FD:destini, BeforeClose>
      * <TOTEM:END>
           CLOSE destini
           .

       CLOSE-timbalqta.
      * <TOTEM:EPT. INIT:gmovcvar, FD:timbalqta, BeforeClose>
      * <TOTEM:END>
           CLOSE timbalqta
           .

       CLOSE-ttipocli.
      * <TOTEM:EPT. INIT:gmovcvar, FD:ttipocli, BeforeClose>
      * <TOTEM:END>
           CLOSE ttipocli
           .

       CLOSE-tmp-progmag-zoom.
      * <TOTEM:EPT. INIT:gmovcvar, FD:tmp-progmag-zoom, BeforeClose>
      * <TOTEM:END>
           .

       CLOSE-tgrupgdo.
      * <TOTEM:EPT. INIT:gmovcvar, FD:tgrupgdo, BeforeClose>
      * <TOTEM:END>
           CLOSE tgrupgdo
           .

       CLOSE-tordforn.
      * <TOTEM:EPT. INIT:gmovcvar, FD:tordforn, BeforeClose>
      * <TOTEM:END>
           CLOSE tordforn
           .

       CLOSE-rordforn.
      * <TOTEM:EPT. INIT:gmovcvar, FD:rordforn, BeforeClose>
      * <TOTEM:END>
           CLOSE rordforn
           .

       CLOSE-reva.
      * <TOTEM:EPT. INIT:gmovcvar, FD:reva, BeforeClose>
      * <TOTEM:END>
           CLOSE reva
           .

       CLOSE-tvettori.
      * <TOTEM:EPT. INIT:gmovcvar, FD:tvettori, BeforeClose>
      * <TOTEM:END>
           CLOSE tvettori
           .

       CLOSE-teva.
      * <TOTEM:EPT. INIT:gmovcvar, FD:teva, BeforeClose>
      * <TOTEM:END>
           CLOSE teva
           .

       CLOSE-brnotacr.
      * <TOTEM:EPT. INIT:gmovcvar, FD:brnotacr, BeforeClose>
      * <TOTEM:END>
           CLOSE brnotacr
           .

       CLOSE-btnotacr.
      * <TOTEM:EPT. INIT:gmovcvar, FD:btnotacr, BeforeClose>
      * <TOTEM:END>
           CLOSE btnotacr
           .

       CLOSE-tsetinvio.
      * <TOTEM:EPT. INIT:gmovcvar, FD:tsetinvio, BeforeClose>
      * <TOTEM:END>
           .

       CLOSE-tcontat.
      * <TOTEM:EPT. INIT:gmovcvar, FD:tcontat, BeforeClose>
      * <TOTEM:END>
           .

       CLOSE-movutf.
      * <TOTEM:EPT. INIT:gmovcvar, FD:movutf, BeforeClose>
      * <TOTEM:END>
           .

       CLOSE-tnazioni.
      * <TOTEM:EPT. INIT:gmovcvar, FD:tnazioni, BeforeClose>
      * <TOTEM:END>
           CLOSE tnazioni
           .

       CLOSE-lineseq-mail.
      * <TOTEM:EPT. INIT:gmovcvar, FD:lineseq-mail, BeforeClose>
      * <TOTEM:END>
           CLOSE lineseq-mail
           .

       tmovmag-key01-MERGE-SPLITBUF.
           INITIALIZE tmovmag-key01-SPLITBUF
           MOVE tmo-anno(1:4) TO tmovmag-key01-SPLITBUF(1:4)
           MOVE tmo-causale(1:4) TO tmovmag-key01-SPLITBUF(5:4)
           MOVE tmo-numero(1:8) TO tmovmag-key01-SPLITBUF(9:8)
           .

       tmovmag-k2-MERGE-SPLITBUF.
           INITIALIZE tmovmag-k2-SPLITBUF
           MOVE tmo-tipo(1:1) TO tmovmag-k2-SPLITBUF(1:1)
           MOVE tmo-cod-clifor(1:5) TO tmovmag-k2-SPLITBUF(2:5)
           MOVE tmo-destino(1:5) TO tmovmag-k2-SPLITBUF(7:5)
           MOVE tmo-data-movim(1:8) TO tmovmag-k2-SPLITBUF(12:8)
           .

       tmovmag-k-data-MERGE-SPLITBUF.
           INITIALIZE tmovmag-k-data-SPLITBUF
           MOVE tmo-data-movim(1:8) TO tmovmag-k-data-SPLITBUF(1:8)
           MOVE tmo-numero(1:8) TO tmovmag-k-data-SPLITBUF(9:8)
           .

       DataSet1-tmovmag-INITSTART.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tmovmag-KEY1-Asc
                 MOVE Low-Value TO tmo-chiave
              ELSE
                 MOVE High-Value TO tmo-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tmovmag-INITEND.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tmovmag-KEY1-Asc
                 MOVE High-Value TO tmo-chiave
              ELSE
                 MOVE Low-Value TO tmo-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           .   

       DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-tmovmag-KEY1-ORDER
           END-EVALUATE
           .

       DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-tmovmag-KEY1-ORDER
           END-EVALUATE
           .

      * tmovmag
       DataSet1-tmovmag-START.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tmovmag-KEY1-Asc
                 START tmovmag KEY >= tmo-chiave
              ELSE
                 START tmovmag KEY <= tmo-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tmovmag-START-NOTGREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tmovmag-KEY1-Asc
                 START tmovmag KEY <= tmo-chiave
              ELSE
                 START tmovmag KEY >= tmo-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tmovmag-START-GREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tmovmag-KEY1-Asc
                 START tmovmag KEY > tmo-chiave
              ELSE
                 START tmovmag KEY < tmo-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tmovmag-START-LESS.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tmovmag-KEY1-Asc
                 START tmovmag KEY < tmo-chiave
              ELSE
                 START tmovmag KEY > tmo-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tmovmag-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tmovmag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmovmag, BeforeReadRecord>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tmovmag-LOCK
                 READ tmovmag WITH LOCK 
                 KEY tmo-chiave
              ELSE
                 READ tmovmag WITH NO LOCK 
                 KEY tmo-chiave
              END-IF
           END-EVALUATE
           PERFORM tmovmag-key01-MERGE-SPLITBUF
           PERFORM tmovmag-k2-MERGE-SPLITBUF
           PERFORM tmovmag-k-data-MERGE-SPLITBUF
           MOVE STATUS-tmovmag TO TOTEM-ERR-STAT 
           MOVE "tmovmag" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmovmag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmovmag, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tmovmag-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tmovmag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmovmag, BeforeReadNext>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tmovmag-KEY1-Asc
                 IF DataSet1-tmovmag-LOCK
                    READ tmovmag NEXT WITH LOCK
                 ELSE
                    READ tmovmag NEXT WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-tmovmag-LOCK
                    READ tmovmag PREVIOUS WITH LOCK
                 ELSE
                    READ tmovmag PREVIOUS WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           PERFORM tmovmag-key01-MERGE-SPLITBUF
           PERFORM tmovmag-k2-MERGE-SPLITBUF
           PERFORM tmovmag-k-data-MERGE-SPLITBUF
           MOVE STATUS-tmovmag TO TOTEM-ERR-STAT
           MOVE "tmovmag" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmovmag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmovmag, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tmovmag-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tmovmag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmovmag, BeforeReadPrev>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tmovmag-KEY1-Asc
                 IF DataSet1-tmovmag-LOCK
                    READ tmovmag PREVIOUS WITH LOCK
                 ELSE
                    READ tmovmag PREVIOUS WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-tmovmag-LOCK
                    READ tmovmag NEXT WITH LOCK
                 ELSE
                    READ tmovmag NEXT WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           PERFORM tmovmag-key01-MERGE-SPLITBUF
           PERFORM tmovmag-k2-MERGE-SPLITBUF
           PERFORM tmovmag-k-data-MERGE-SPLITBUF
           MOVE STATUS-tmovmag TO TOTEM-ERR-STAT
           MOVE "tmovmag" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmovmag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmovmag, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tmovmag-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tmovmag, BeforeWrite>
      * <TOTEM:END>
           WRITE tmo-rec OF tmovmag.
           MOVE STATUS-tmovmag TO TOTEM-ERR-STAT
           MOVE "tmovmag" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmovmag, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tmovmag-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tmovmag, BeforeRewrite>
      * <TOTEM:END>
           REWRITE tmo-rec OF tmovmag.
           MOVE STATUS-tmovmag TO TOTEM-ERR-STAT
           MOVE "tmovmag" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmovmag, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tmovmag-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tmovmag, BeforeDelete>
      * <TOTEM:END>
           DELETE tmovmag.
           MOVE STATUS-tmovmag TO TOTEM-ERR-STAT
           MOVE "tmovmag" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmovmag, AfterDelete>
      * <TOTEM:END>
           .

       rmovmag-k-articolo-MERGE-SPLITBUF.
           INITIALIZE rmovmag-k-articolo-SPLITBUF
           MOVE rmo-anno OF rmovmag(1:4) TO 
           rmovmag-k-articolo-SPLITBUF(1:4)
           MOVE rmo-movim OF rmovmag(1:8) TO 
           rmovmag-k-articolo-SPLITBUF(5:8)
           MOVE rmo-articolo OF rmovmag(1:6) TO 
           rmovmag-k-articolo-SPLITBUF(13:6)
           .

       rmovmag-rmo-chiave-ricerca-MERGE-SPLITBUF.
           INITIALIZE rmovmag-rmo-chiave-ricerca-SPLITBUF
           MOVE rmo-tipo OF rmovmag(1:1) TO 
           rmovmag-rmo-chiave-ricerca-SPLITBUF(1:1)
           MOVE rmo-cod-clifor OF rmovmag(1:5) TO 
           rmovmag-rmo-chiave-ricerca-SPLITBUF(2:5)
           MOVE rmo-causale OF rmovmag(1:4) TO 
           rmovmag-rmo-chiave-ricerca-SPLITBUF(7:4)
           MOVE rmo-articolo OF rmovmag(1:6) TO 
           rmovmag-rmo-chiave-ricerca-SPLITBUF(11:6)
           MOVE rmo-data-movim OF rmovmag(1:8) TO 
           rmovmag-rmo-chiave-ricerca-SPLITBUF(17:8)
           .

       rmovmag-k-progmag-MERGE-SPLITBUF.
           INITIALIZE rmovmag-k-progmag-SPLITBUF
           MOVE rmo-chiave-progmag OF rmovmag(1:20) TO 
           rmovmag-k-progmag-SPLITBUF(1:20)
           .

       rmovmag-k-art-data-MERGE-SPLITBUF.
           INITIALIZE rmovmag-k-art-data-SPLITBUF
           MOVE rmo-articolo OF rmovmag(1:6) TO 
           rmovmag-k-art-data-SPLITBUF(1:6)
           MOVE rmo-data-movim OF rmovmag(1:8) TO 
           rmovmag-k-art-data-SPLITBUF(7:8)
           .

       DataSet1-rmovmag-INITSTART.
           IF DataSet1-rmovmag-KEY-Asc
              MOVE Low-Value TO rmo-chiave OF rmovmag
           ELSE
              MOVE High-Value TO rmo-chiave OF rmovmag
           END-IF
           .

       DataSet1-rmovmag-INITEND.
           IF DataSet1-rmovmag-KEY-Asc
              MOVE High-Value TO rmo-chiave OF rmovmag
           ELSE
              MOVE Low-Value TO rmo-chiave OF rmovmag
           END-IF
           .

      * rmovmag
       DataSet1-rmovmag-START.
           IF DataSet1-rmovmag-KEY-Asc
              START rmovmag KEY >= rmo-chiave OF rmovmag
           ELSE
              START rmovmag KEY <= rmo-chiave OF rmovmag
           END-IF
           .

       DataSet1-rmovmag-START-NOTGREATER.
           IF DataSet1-rmovmag-KEY-Asc
              START rmovmag KEY <= rmo-chiave OF rmovmag
           ELSE
              START rmovmag KEY >= rmo-chiave OF rmovmag
           END-IF
           .

       DataSet1-rmovmag-START-GREATER.
           IF DataSet1-rmovmag-KEY-Asc
              START rmovmag KEY > rmo-chiave OF rmovmag
           ELSE
              START rmovmag KEY < rmo-chiave OF rmovmag
           END-IF
           .

       DataSet1-rmovmag-START-LESS.
           IF DataSet1-rmovmag-KEY-Asc
              START rmovmag KEY < rmo-chiave OF rmovmag
           ELSE
              START rmovmag KEY > rmo-chiave OF rmovmag
           END-IF
           .

       DataSet1-rmovmag-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:rmovmag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rmovmag, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-rmovmag-LOCK
              READ rmovmag WITH LOCK 
              KEY rmo-chiave OF rmovmag
           ELSE
              READ rmovmag WITH NO LOCK 
              KEY rmo-chiave OF rmovmag
           END-IF
           PERFORM rmovmag-k-articolo-MERGE-SPLITBUF
           PERFORM rmovmag-rmo-chiave-ricerca-MERGE-SPLITBUF
           PERFORM rmovmag-k-progmag-MERGE-SPLITBUF
           PERFORM rmovmag-k-art-data-MERGE-SPLITBUF
           MOVE STATUS-rmovmag TO TOTEM-ERR-STAT 
           MOVE "rmovmag" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rmovmag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rmovmag, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-rmovmag-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:rmovmag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rmovmag, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-rmovmag-KEY-Asc
              IF DataSet1-rmovmag-LOCK
                 READ rmovmag NEXT WITH LOCK
              ELSE
                 READ rmovmag NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-rmovmag-LOCK
                 READ rmovmag PREVIOUS WITH LOCK
              ELSE
                 READ rmovmag PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM rmovmag-k-articolo-MERGE-SPLITBUF
           PERFORM rmovmag-rmo-chiave-ricerca-MERGE-SPLITBUF
           PERFORM rmovmag-k-progmag-MERGE-SPLITBUF
           PERFORM rmovmag-k-art-data-MERGE-SPLITBUF
           MOVE STATUS-rmovmag TO TOTEM-ERR-STAT
           MOVE "rmovmag" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rmovmag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rmovmag, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-rmovmag-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:rmovmag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rmovmag, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-rmovmag-KEY-Asc
              IF DataSet1-rmovmag-LOCK
                 READ rmovmag PREVIOUS WITH LOCK
              ELSE
                 READ rmovmag PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-rmovmag-LOCK
                 READ rmovmag NEXT WITH LOCK
              ELSE
                 READ rmovmag NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM rmovmag-k-articolo-MERGE-SPLITBUF
           PERFORM rmovmag-rmo-chiave-ricerca-MERGE-SPLITBUF
           PERFORM rmovmag-k-progmag-MERGE-SPLITBUF
           PERFORM rmovmag-k-art-data-MERGE-SPLITBUF
           MOVE STATUS-rmovmag TO TOTEM-ERR-STAT
           MOVE "rmovmag" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rmovmag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rmovmag, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-rmovmag-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:rmovmag, BeforeWrite>
      * <TOTEM:END>
           WRITE rmo-rec OF rmovmag.
           MOVE STATUS-rmovmag TO TOTEM-ERR-STAT
           MOVE "rmovmag" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rmovmag, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-rmovmag-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:rmovmag, BeforeRewrite>
      * <TOTEM:END>
           REWRITE rmo-rec OF rmovmag.
           MOVE STATUS-rmovmag TO TOTEM-ERR-STAT
           MOVE "rmovmag" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rmovmag, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-rmovmag-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:rmovmag, BeforeDelete>
      * <TOTEM:END>
           DELETE rmovmag.
           MOVE STATUS-rmovmag TO TOTEM-ERR-STAT
           MOVE "rmovmag" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rmovmag, AfterDelete>
      * <TOTEM:END>
           .

       clienti-cli-K1-MERGE-SPLITBUF.
           INITIALIZE clienti-cli-K1-SPLITBUF
           MOVE cli-tipo-CF OF clienti(1:1) TO 
           clienti-cli-K1-SPLITBUF(1:1)
           MOVE cli-ragsoc-1 OF clienti(1:40) TO 
           clienti-cli-K1-SPLITBUF(2:40)
           MOVE cli-codice OF clienti(1:5) TO 
           clienti-cli-K1-SPLITBUF(42:5)
           .

       clienti-cli-K3-MERGE-SPLITBUF.
           INITIALIZE clienti-cli-K3-SPLITBUF
           MOVE cli-gdo OF clienti(1:5) TO clienti-cli-K3-SPLITBUF(1:5)
           MOVE cli-chiave OF clienti(1:6) TO 
           clienti-cli-K3-SPLITBUF(6:6)
           .

       clienti-cli-K4-MERGE-SPLITBUF.
           INITIALIZE clienti-cli-K4-SPLITBUF
           MOVE cli-utf OF clienti(1:1) TO clienti-cli-K4-SPLITBUF(1:1)
           MOVE cli-chiave OF clienti(1:6) TO 
           clienti-cli-K4-SPLITBUF(2:6)
           .

       DataSet1-clienti-INITSTART.
           IF DataSet1-clienti-KEY-Asc
              MOVE Low-Value TO cli-chiave OF clienti
           ELSE
              MOVE High-Value TO cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-INITEND.
           IF DataSet1-clienti-KEY-Asc
              MOVE High-Value TO cli-chiave OF clienti
           ELSE
              MOVE Low-Value TO cli-chiave OF clienti
           END-IF
           .

      * clienti
       DataSet1-clienti-START.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY >= cli-chiave OF clienti
           ELSE
              START clienti KEY <= cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-START-NOTGREATER.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY <= cli-chiave OF clienti
           ELSE
              START clienti KEY >= cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-START-GREATER.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY > cli-chiave OF clienti
           ELSE
              START clienti KEY < cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-START-LESS.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY < cli-chiave OF clienti
           ELSE
              START clienti KEY > cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-clienti-LOCK
              READ clienti WITH LOCK 
              KEY cli-chiave OF clienti
           ELSE
              READ clienti WITH NO LOCK 
              KEY cli-chiave OF clienti
           END-IF
           PERFORM clienti-cli-K1-MERGE-SPLITBUF
           PERFORM clienti-cli-K3-MERGE-SPLITBUF
           PERFORM clienti-cli-K4-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT 
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-clienti-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-clienti-KEY-Asc
              IF DataSet1-clienti-LOCK
                 READ clienti NEXT WITH LOCK
              ELSE
                 READ clienti NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-clienti-LOCK
                 READ clienti PREVIOUS WITH LOCK
              ELSE
                 READ clienti PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM clienti-cli-K1-MERGE-SPLITBUF
           PERFORM clienti-cli-K3-MERGE-SPLITBUF
           PERFORM clienti-cli-K4-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-clienti-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-clienti-KEY-Asc
              IF DataSet1-clienti-LOCK
                 READ clienti PREVIOUS WITH LOCK
              ELSE
                 READ clienti PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-clienti-LOCK
                 READ clienti NEXT WITH LOCK
              ELSE
                 READ clienti NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM clienti-cli-K1-MERGE-SPLITBUF
           PERFORM clienti-cli-K3-MERGE-SPLITBUF
           PERFORM clienti-cli-K4-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tmagaz-INITSTART.
           IF DataSet1-tmagaz-KEY-Asc
              MOVE Low-Value TO mag-chiave
           ELSE
              MOVE High-Value TO mag-chiave
           END-IF
           .

       DataSet1-tmagaz-INITEND.
           IF DataSet1-tmagaz-KEY-Asc
              MOVE High-Value TO mag-chiave
           ELSE
              MOVE Low-Value TO mag-chiave
           END-IF
           .

      * tmagaz
       DataSet1-tmagaz-START.
           IF DataSet1-tmagaz-KEY-Asc
              START tmagaz KEY >= mag-chiave
           ELSE
              START tmagaz KEY <= mag-chiave
           END-IF
           .

       DataSet1-tmagaz-START-NOTGREATER.
           IF DataSet1-tmagaz-KEY-Asc
              START tmagaz KEY <= mag-chiave
           ELSE
              START tmagaz KEY >= mag-chiave
           END-IF
           .

       DataSet1-tmagaz-START-GREATER.
           IF DataSet1-tmagaz-KEY-Asc
              START tmagaz KEY > mag-chiave
           ELSE
              START tmagaz KEY < mag-chiave
           END-IF
           .

       DataSet1-tmagaz-START-LESS.
           IF DataSet1-tmagaz-KEY-Asc
              START tmagaz KEY < mag-chiave
           ELSE
              START tmagaz KEY > mag-chiave
           END-IF
           .

       DataSet1-tmagaz-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tmagaz-LOCK
              READ tmagaz WITH LOCK 
              KEY mag-chiave
           ELSE
              READ tmagaz WITH NO LOCK 
              KEY mag-chiave
           END-IF
           MOVE STATUS-tmagaz TO TOTEM-ERR-STAT 
           MOVE "tmagaz" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tmagaz-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tmagaz-KEY-Asc
              IF DataSet1-tmagaz-LOCK
                 READ tmagaz NEXT WITH LOCK
              ELSE
                 READ tmagaz NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tmagaz-LOCK
                 READ tmagaz PREVIOUS WITH LOCK
              ELSE
                 READ tmagaz PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tmagaz TO TOTEM-ERR-STAT
           MOVE "tmagaz" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tmagaz-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tmagaz-KEY-Asc
              IF DataSet1-tmagaz-LOCK
                 READ tmagaz PREVIOUS WITH LOCK
              ELSE
                 READ tmagaz PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tmagaz-LOCK
                 READ tmagaz NEXT WITH LOCK
              ELSE
                 READ tmagaz NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tmagaz TO TOTEM-ERR-STAT
           MOVE "tmagaz" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tmagaz-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tmagaz TO TOTEM-ERR-STAT
           MOVE "tmagaz" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tmagaz-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tmagaz TO TOTEM-ERR-STAT
           MOVE "tmagaz" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tmagaz-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tmagaz TO TOTEM-ERR-STAT
           MOVE "tmagaz" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tparamge-INITSTART.
           IF DataSet1-tparamge-KEY-Asc
              MOVE Low-Value TO tge-chiave
           ELSE
              MOVE High-Value TO tge-chiave
           END-IF
           .

       DataSet1-tparamge-INITEND.
           IF DataSet1-tparamge-KEY-Asc
              MOVE High-Value TO tge-chiave
           ELSE
              MOVE Low-Value TO tge-chiave
           END-IF
           .

      * tparamge
       DataSet1-tparamge-START.
           IF DataSet1-tparamge-KEY-Asc
              START tparamge KEY >= tge-chiave
           ELSE
              START tparamge KEY <= tge-chiave
           END-IF
           .

       DataSet1-tparamge-START-NOTGREATER.
           IF DataSet1-tparamge-KEY-Asc
              START tparamge KEY <= tge-chiave
           ELSE
              START tparamge KEY >= tge-chiave
           END-IF
           .

       DataSet1-tparamge-START-GREATER.
           IF DataSet1-tparamge-KEY-Asc
              START tparamge KEY > tge-chiave
           ELSE
              START tparamge KEY < tge-chiave
           END-IF
           .

       DataSet1-tparamge-START-LESS.
           IF DataSet1-tparamge-KEY-Asc
              START tparamge KEY < tge-chiave
           ELSE
              START tparamge KEY > tge-chiave
           END-IF
           .

       DataSet1-tparamge-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tparamge-LOCK
              READ tparamge WITH LOCK 
              KEY tge-chiave
           ELSE
              READ tparamge WITH NO LOCK 
              KEY tge-chiave
           END-IF
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT 
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tparamge-KEY-Asc
              IF DataSet1-tparamge-LOCK
                 READ tparamge NEXT WITH LOCK
              ELSE
                 READ tparamge NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tparamge-LOCK
                 READ tparamge PREVIOUS WITH LOCK
              ELSE
                 READ tparamge PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tparamge-KEY-Asc
              IF DataSet1-tparamge-LOCK
                 READ tparamge PREVIOUS WITH LOCK
              ELSE
                 READ tparamge PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tparamge-LOCK
                 READ tparamge NEXT WITH LOCK
              ELSE
                 READ tparamge NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterDelete>
      * <TOTEM:END>
           .

       tcodpag-TBL-CODICE-01-MERGE-SPLITBUF.
           INITIALIZE tcodpag-TBL-CODICE-01-SPLITBUF
           MOVE TBLPA-CODICE1(1:2) TO 
           tcodpag-TBL-CODICE-01-SPLITBUF(1:2)
           MOVE TBLPA-DESCRIZIONE1(1:30) TO 
           tcodpag-TBL-CODICE-01-SPLITBUF(3:30)
           MOVE TBLPA-CODICE2(1:20) TO 
           tcodpag-TBL-CODICE-01-SPLITBUF(33:20)
           .

       DataSet1-tcodpag-INITSTART.
           IF DataSet1-tcodpag-KEY-Asc
              MOVE Low-Value TO TBLPA-CODICE
           ELSE
              MOVE High-Value TO TBLPA-CODICE
           END-IF
           .

       DataSet1-tcodpag-INITEND.
           IF DataSet1-tcodpag-KEY-Asc
              MOVE High-Value TO TBLPA-CODICE
           ELSE
              MOVE Low-Value TO TBLPA-CODICE
           END-IF
           .

      * tcodpag
       DataSet1-tcodpag-START.
           IF DataSet1-tcodpag-KEY-Asc
              START tcodpag KEY >= TBLPA-CODICE
           ELSE
              START tcodpag KEY <= TBLPA-CODICE
           END-IF
           .

       DataSet1-tcodpag-START-NOTGREATER.
           IF DataSet1-tcodpag-KEY-Asc
              START tcodpag KEY <= TBLPA-CODICE
           ELSE
              START tcodpag KEY >= TBLPA-CODICE
           END-IF
           .

       DataSet1-tcodpag-START-GREATER.
           IF DataSet1-tcodpag-KEY-Asc
              START tcodpag KEY > TBLPA-CODICE
           ELSE
              START tcodpag KEY < TBLPA-CODICE
           END-IF
           .

       DataSet1-tcodpag-START-LESS.
           IF DataSet1-tcodpag-KEY-Asc
              START tcodpag KEY < TBLPA-CODICE
           ELSE
              START tcodpag KEY > TBLPA-CODICE
           END-IF
           .

       DataSet1-tcodpag-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tcodpag-LOCK
              READ tcodpag WITH LOCK 
              KEY TBLPA-CODICE
           ELSE
              READ tcodpag WITH NO LOCK 
              KEY TBLPA-CODICE
           END-IF
           PERFORM tcodpag-TBL-CODICE-01-MERGE-SPLITBUF
           MOVE status-tcodpag TO TOTEM-ERR-STAT 
           MOVE "tcodpag" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tcodpag-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tcodpag-KEY-Asc
              IF DataSet1-tcodpag-LOCK
                 READ tcodpag NEXT WITH LOCK
              ELSE
                 READ tcodpag NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tcodpag-LOCK
                 READ tcodpag PREVIOUS WITH LOCK
              ELSE
                 READ tcodpag PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tcodpag-TBL-CODICE-01-MERGE-SPLITBUF
           MOVE status-tcodpag TO TOTEM-ERR-STAT
           MOVE "tcodpag" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tcodpag-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tcodpag-KEY-Asc
              IF DataSet1-tcodpag-LOCK
                 READ tcodpag PREVIOUS WITH LOCK
              ELSE
                 READ tcodpag PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tcodpag-LOCK
                 READ tcodpag NEXT WITH LOCK
              ELSE
                 READ tcodpag NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tcodpag-TBL-CODICE-01-MERGE-SPLITBUF
           MOVE status-tcodpag TO TOTEM-ERR-STAT
           MOVE "tcodpag" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tcodpag-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeWrite>
      * <TOTEM:END>
           MOVE status-tcodpag TO TOTEM-ERR-STAT
           MOVE "tcodpag" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tcodpag-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeRewrite>
      * <TOTEM:END>
           MOVE status-tcodpag TO TOTEM-ERR-STAT
           MOVE "tcodpag" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tcodpag-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeDelete>
      * <TOTEM:END>
           MOVE status-tcodpag TO TOTEM-ERR-STAT
           MOVE "tcodpag" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterDelete>
      * <TOTEM:END>
           .

       tcaumag-k-mag-MERGE-SPLITBUF.
           INITIALIZE tcaumag-k-mag-SPLITBUF
           MOVE tca-cod-magaz(1:3) TO tcaumag-k-mag-SPLITBUF(1:3)
           MOVE tca-ord-forn(1:1) TO tcaumag-k-mag-SPLITBUF(4:1)
           .

       DataSet1-tcaumag-INITSTART.
           IF DataSet1-tcaumag-KEY-Asc
              MOVE Low-Value TO tca-chiave
           ELSE
              MOVE High-Value TO tca-chiave
           END-IF
           .

       DataSet1-tcaumag-INITEND.
           IF DataSet1-tcaumag-KEY-Asc
              MOVE High-Value TO tca-chiave
           ELSE
              MOVE Low-Value TO tca-chiave
           END-IF
           .

      * tcaumag
       DataSet1-tcaumag-START.
           IF DataSet1-tcaumag-KEY-Asc
              START tcaumag KEY >= tca-chiave
           ELSE
              START tcaumag KEY <= tca-chiave
           END-IF
           .

       DataSet1-tcaumag-START-NOTGREATER.
           IF DataSet1-tcaumag-KEY-Asc
              START tcaumag KEY <= tca-chiave
           ELSE
              START tcaumag KEY >= tca-chiave
           END-IF
           .

       DataSet1-tcaumag-START-GREATER.
           IF DataSet1-tcaumag-KEY-Asc
              START tcaumag KEY > tca-chiave
           ELSE
              START tcaumag KEY < tca-chiave
           END-IF
           .

       DataSet1-tcaumag-START-LESS.
           IF DataSet1-tcaumag-KEY-Asc
              START tcaumag KEY < tca-chiave
           ELSE
              START tcaumag KEY > tca-chiave
           END-IF
           .

       DataSet1-tcaumag-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tcaumag-LOCK
              READ tcaumag WITH LOCK 
              KEY tca-chiave
           ELSE
              READ tcaumag WITH NO LOCK 
              KEY tca-chiave
           END-IF
           PERFORM tcaumag-k-mag-MERGE-SPLITBUF
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT 
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tcaumag-KEY-Asc
              IF DataSet1-tcaumag-LOCK
                 READ tcaumag NEXT WITH LOCK
              ELSE
                 READ tcaumag NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tcaumag-LOCK
                 READ tcaumag PREVIOUS WITH LOCK
              ELSE
                 READ tcaumag PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tcaumag-k-mag-MERGE-SPLITBUF
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tcaumag-KEY-Asc
              IF DataSet1-tcaumag-LOCK
                 READ tcaumag PREVIOUS WITH LOCK
              ELSE
                 READ tcaumag PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tcaumag-LOCK
                 READ tcaumag NEXT WITH LOCK
              ELSE
                 READ tcaumag NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tcaumag-k-mag-MERGE-SPLITBUF
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterDelete>
      * <TOTEM:END>
           .

       articoli-art-k1-MERGE-SPLITBUF.
           INITIALIZE articoli-art-k1-SPLITBUF
           MOVE art-descrizione OF articoli(1:50) TO 
           articoli-art-k1-SPLITBUF(1:50)
           .

       articoli-art-k-frn-MERGE-SPLITBUF.
           INITIALIZE articoli-art-k-frn-SPLITBUF
           MOVE art-cod-art-frn OF articoli(1:15) TO 
           articoli-art-k-frn-SPLITBUF(1:15)
           .

       DataSet1-articoli-INITSTART.
           IF DataSet1-articoli-KEY-Asc
              MOVE Low-Value TO art-chiave OF articoli
           ELSE
              MOVE High-Value TO art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-INITEND.
           IF DataSet1-articoli-KEY-Asc
              MOVE High-Value TO art-chiave OF articoli
           ELSE
              MOVE Low-Value TO art-chiave OF articoli
           END-IF
           .

      * articoli
       DataSet1-articoli-START.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY >= art-chiave OF articoli
           ELSE
              START articoli KEY <= art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-START-NOTGREATER.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY <= art-chiave OF articoli
           ELSE
              START articoli KEY >= art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-START-GREATER.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY > art-chiave OF articoli
           ELSE
              START articoli KEY < art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-START-LESS.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY < art-chiave OF articoli
           ELSE
              START articoli KEY > art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-articoli-LOCK
              READ articoli WITH LOCK 
              KEY art-chiave OF articoli
           ELSE
              READ articoli WITH NO LOCK 
              KEY art-chiave OF articoli
           END-IF
           PERFORM articoli-art-k1-MERGE-SPLITBUF
           PERFORM articoli-art-k-frn-MERGE-SPLITBUF
           MOVE STATUS-articoli TO TOTEM-ERR-STAT 
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-articoli-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-articoli-KEY-Asc
              IF DataSet1-articoli-LOCK
                 READ articoli NEXT WITH LOCK
              ELSE
                 READ articoli NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-articoli-LOCK
                 READ articoli PREVIOUS WITH LOCK
              ELSE
                 READ articoli PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM articoli-art-k1-MERGE-SPLITBUF
           PERFORM articoli-art-k-frn-MERGE-SPLITBUF
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-articoli-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-articoli-KEY-Asc
              IF DataSet1-articoli-LOCK
                 READ articoli PREVIOUS WITH LOCK
              ELSE
                 READ articoli PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-articoli-LOCK
                 READ articoli NEXT WITH LOCK
              ELSE
                 READ articoli NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM articoli-art-k1-MERGE-SPLITBUF
           PERFORM articoli-art-k-frn-MERGE-SPLITBUF
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-articoli-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-articoli-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-articoli-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-timposte-INITSTART.
           IF DataSet1-timposte-KEY-Asc
              MOVE Low-Value TO imp-chiave
           ELSE
              MOVE High-Value TO imp-chiave
           END-IF
           .

       DataSet1-timposte-INITEND.
           IF DataSet1-timposte-KEY-Asc
              MOVE High-Value TO imp-chiave
           ELSE
              MOVE Low-Value TO imp-chiave
           END-IF
           .

      * timposte
       DataSet1-timposte-START.
           IF DataSet1-timposte-KEY-Asc
              START timposte KEY >= imp-chiave
           ELSE
              START timposte KEY <= imp-chiave
           END-IF
           .

       DataSet1-timposte-START-NOTGREATER.
           IF DataSet1-timposte-KEY-Asc
              START timposte KEY <= imp-chiave
           ELSE
              START timposte KEY >= imp-chiave
           END-IF
           .

       DataSet1-timposte-START-GREATER.
           IF DataSet1-timposte-KEY-Asc
              START timposte KEY > imp-chiave
           ELSE
              START timposte KEY < imp-chiave
           END-IF
           .

       DataSet1-timposte-START-LESS.
           IF DataSet1-timposte-KEY-Asc
              START timposte KEY < imp-chiave
           ELSE
              START timposte KEY > imp-chiave
           END-IF
           .

       DataSet1-timposte-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-timposte-LOCK
              READ timposte WITH LOCK 
              KEY imp-chiave
           ELSE
              READ timposte WITH NO LOCK 
              KEY imp-chiave
           END-IF
           MOVE STATUS-timposte TO TOTEM-ERR-STAT 
           MOVE "timposte" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-timposte-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-timposte-KEY-Asc
              IF DataSet1-timposte-LOCK
                 READ timposte NEXT WITH LOCK
              ELSE
                 READ timposte NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-timposte-LOCK
                 READ timposte PREVIOUS WITH LOCK
              ELSE
                 READ timposte PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-timposte TO TOTEM-ERR-STAT
           MOVE "timposte" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-timposte-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-timposte-KEY-Asc
              IF DataSet1-timposte-LOCK
                 READ timposte PREVIOUS WITH LOCK
              ELSE
                 READ timposte PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-timposte-LOCK
                 READ timposte NEXT WITH LOCK
              ELSE
                 READ timposte NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-timposte TO TOTEM-ERR-STAT
           MOVE "timposte" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-timposte-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-timposte TO TOTEM-ERR-STAT
           MOVE "timposte" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-timposte-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-timposte TO TOTEM-ERR-STAT
           MOVE "timposte" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-timposte-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-timposte TO TOTEM-ERR-STAT
           MOVE "timposte" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterDelete>
      * <TOTEM:END>
           .

       progmag-key01-MERGE-SPLITBUF.
           INITIALIZE progmag-key01-SPLITBUF
           MOVE prg-cod-magazzino OF progmag(1:3) TO 
           progmag-key01-SPLITBUF(1:3)
           MOVE prg-cod-articolo OF progmag(1:6) TO 
           progmag-key01-SPLITBUF(4:6)
           MOVE prg-tipo-imballo OF progmag(1:3) TO 
           progmag-key01-SPLITBUF(10:3)
           MOVE prg-peso OF progmag(1:8) TO progmag-key01-SPLITBUF(13:8)
           .

       DataSet1-progmag-INITSTART.
           IF DataSet1-progmag-KEY-Asc
              MOVE Low-Value TO prg-chiave OF progmag
           ELSE
              MOVE High-Value TO prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-INITEND.
           IF DataSet1-progmag-KEY-Asc
              MOVE High-Value TO prg-chiave OF progmag
           ELSE
              MOVE Low-Value TO prg-chiave OF progmag
           END-IF
           .

      * progmag
       DataSet1-progmag-START.
           IF DataSet1-progmag-KEY-Asc
              START progmag KEY >= prg-chiave OF progmag
           ELSE
              START progmag KEY <= prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-START-NOTGREATER.
           IF DataSet1-progmag-KEY-Asc
              START progmag KEY <= prg-chiave OF progmag
           ELSE
              START progmag KEY >= prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-START-GREATER.
           IF DataSet1-progmag-KEY-Asc
              START progmag KEY > prg-chiave OF progmag
           ELSE
              START progmag KEY < prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-START-LESS.
           IF DataSet1-progmag-KEY-Asc
              START progmag KEY < prg-chiave OF progmag
           ELSE
              START progmag KEY > prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-progmag-LOCK
              READ progmag WITH LOCK 
              KEY prg-chiave OF progmag
           ELSE
              READ progmag WITH NO LOCK 
              KEY prg-chiave OF progmag
           END-IF
           PERFORM progmag-key01-MERGE-SPLITBUF
           MOVE STATUS-progmag TO TOTEM-ERR-STAT 
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-progmag-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-progmag-KEY-Asc
              IF DataSet1-progmag-LOCK
                 READ progmag NEXT WITH LOCK
              ELSE
                 READ progmag NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-progmag-LOCK
                 READ progmag PREVIOUS WITH LOCK
              ELSE
                 READ progmag PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM progmag-key01-MERGE-SPLITBUF
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-progmag-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-progmag-KEY-Asc
              IF DataSet1-progmag-LOCK
                 READ progmag PREVIOUS WITH LOCK
              ELSE
                 READ progmag PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-progmag-LOCK
                 READ progmag NEXT WITH LOCK
              ELSE
                 READ progmag NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM progmag-key01-MERGE-SPLITBUF
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-progmag-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-progmag-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-progmag-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tmarche-INITSTART.
           IF DataSet1-tmarche-KEY-Asc
              MOVE Low-Value TO mar-chiave
           ELSE
              MOVE High-Value TO mar-chiave
           END-IF
           .

       DataSet1-tmarche-INITEND.
           IF DataSet1-tmarche-KEY-Asc
              MOVE High-Value TO mar-chiave
           ELSE
              MOVE Low-Value TO mar-chiave
           END-IF
           .

      * tmarche
       DataSet1-tmarche-START.
           IF DataSet1-tmarche-KEY-Asc
              START tmarche KEY >= mar-chiave
           ELSE
              START tmarche KEY <= mar-chiave
           END-IF
           .

       DataSet1-tmarche-START-NOTGREATER.
           IF DataSet1-tmarche-KEY-Asc
              START tmarche KEY <= mar-chiave
           ELSE
              START tmarche KEY >= mar-chiave
           END-IF
           .

       DataSet1-tmarche-START-GREATER.
           IF DataSet1-tmarche-KEY-Asc
              START tmarche KEY > mar-chiave
           ELSE
              START tmarche KEY < mar-chiave
           END-IF
           .

       DataSet1-tmarche-START-LESS.
           IF DataSet1-tmarche-KEY-Asc
              START tmarche KEY < mar-chiave
           ELSE
              START tmarche KEY > mar-chiave
           END-IF
           .

       DataSet1-tmarche-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tmarche-LOCK
              READ tmarche WITH LOCK 
              KEY mar-chiave
           ELSE
              READ tmarche WITH NO LOCK 
              KEY mar-chiave
           END-IF
           MOVE STATUS-tmarche TO TOTEM-ERR-STAT 
           MOVE "tmarche" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tmarche-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tmarche-KEY-Asc
              IF DataSet1-tmarche-LOCK
                 READ tmarche NEXT WITH LOCK
              ELSE
                 READ tmarche NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tmarche-LOCK
                 READ tmarche PREVIOUS WITH LOCK
              ELSE
                 READ tmarche PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tmarche TO TOTEM-ERR-STAT
           MOVE "tmarche" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tmarche-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tmarche-KEY-Asc
              IF DataSet1-tmarche-LOCK
                 READ tmarche PREVIOUS WITH LOCK
              ELSE
                 READ tmarche PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tmarche-LOCK
                 READ tmarche NEXT WITH LOCK
              ELSE
                 READ tmarche NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tmarche TO TOTEM-ERR-STAT
           MOVE "tmarche" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tmarche-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tmarche TO TOTEM-ERR-STAT
           MOVE "tmarche" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tmarche-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tmarche TO TOTEM-ERR-STAT
           MOVE "tmarche" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tmarche-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tmarche TO TOTEM-ERR-STAT
           MOVE "tmarche" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-timballi-INITSTART.
           IF DataSet1-timballi-KEY-Asc
              MOVE Low-Value TO imb-chiave
           ELSE
              MOVE High-Value TO imb-chiave
           END-IF
           .

       DataSet1-timballi-INITEND.
           IF DataSet1-timballi-KEY-Asc
              MOVE High-Value TO imb-chiave
           ELSE
              MOVE Low-Value TO imb-chiave
           END-IF
           .

      * timballi
       DataSet1-timballi-START.
           IF DataSet1-timballi-KEY-Asc
              START timballi KEY >= imb-chiave
           ELSE
              START timballi KEY <= imb-chiave
           END-IF
           .

       DataSet1-timballi-START-NOTGREATER.
           IF DataSet1-timballi-KEY-Asc
              START timballi KEY <= imb-chiave
           ELSE
              START timballi KEY >= imb-chiave
           END-IF
           .

       DataSet1-timballi-START-GREATER.
           IF DataSet1-timballi-KEY-Asc
              START timballi KEY > imb-chiave
           ELSE
              START timballi KEY < imb-chiave
           END-IF
           .

       DataSet1-timballi-START-LESS.
           IF DataSet1-timballi-KEY-Asc
              START timballi KEY < imb-chiave
           ELSE
              START timballi KEY > imb-chiave
           END-IF
           .

       DataSet1-timballi-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-timballi-LOCK
              READ timballi WITH LOCK 
              KEY imb-chiave
           ELSE
              READ timballi WITH NO LOCK 
              KEY imb-chiave
           END-IF
           MOVE STATUS-timballi TO TOTEM-ERR-STAT 
           MOVE "timballi" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-timballi-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-timballi-KEY-Asc
              IF DataSet1-timballi-LOCK
                 READ timballi NEXT WITH LOCK
              ELSE
                 READ timballi NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-timballi-LOCK
                 READ timballi PREVIOUS WITH LOCK
              ELSE
                 READ timballi PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-timballi TO TOTEM-ERR-STAT
           MOVE "timballi" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-timballi-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-timballi-KEY-Asc
              IF DataSet1-timballi-LOCK
                 READ timballi PREVIOUS WITH LOCK
              ELSE
                 READ timballi PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-timballi-LOCK
                 READ timballi NEXT WITH LOCK
              ELSE
                 READ timballi NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-timballi TO TOTEM-ERR-STAT
           MOVE "timballi" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-timballi-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-timballi TO TOTEM-ERR-STAT
           MOVE "timballi" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-timballi-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-timballi TO TOTEM-ERR-STAT
           MOVE "timballi" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-timballi-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-timballi TO TOTEM-ERR-STAT
           MOVE "timballi" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterDelete>
      * <TOTEM:END>
           .

       destini-K1-MERGE-SPLITBUF.
           INITIALIZE destini-K1-SPLITBUF
           MOVE des-ragsoc-1(1:100) TO destini-K1-SPLITBUF(1:100)
           MOVE des-codice(1:5) TO destini-K1-SPLITBUF(101:5)
           MOVE des-prog(1:5) TO destini-K1-SPLITBUF(106:5)
           .

       destini-k-localita-MERGE-SPLITBUF.
           INITIALIZE destini-k-localita-SPLITBUF
           MOVE des-localita(1:35) TO destini-k-localita-SPLITBUF(1:35)
           .

       DataSet1-destini-INITSTART.
           IF DataSet1-destini-KEY-Asc
              MOVE Low-Value TO des-chiave
           ELSE
              MOVE High-Value TO des-chiave
           END-IF
           .

       DataSet1-destini-INITEND.
           IF DataSet1-destini-KEY-Asc
              MOVE High-Value TO des-chiave
           ELSE
              MOVE Low-Value TO des-chiave
           END-IF
           .

      * destini
       DataSet1-destini-START.
           IF DataSet1-destini-KEY-Asc
              START destini KEY >= des-chiave
           ELSE
              START destini KEY <= des-chiave
           END-IF
           .

       DataSet1-destini-START-NOTGREATER.
           IF DataSet1-destini-KEY-Asc
              START destini KEY <= des-chiave
           ELSE
              START destini KEY >= des-chiave
           END-IF
           .

       DataSet1-destini-START-GREATER.
           IF DataSet1-destini-KEY-Asc
              START destini KEY > des-chiave
           ELSE
              START destini KEY < des-chiave
           END-IF
           .

       DataSet1-destini-START-LESS.
           IF DataSet1-destini-KEY-Asc
              START destini KEY < des-chiave
           ELSE
              START destini KEY > des-chiave
           END-IF
           .

       DataSet1-destini-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-destini-LOCK
              READ destini WITH LOCK 
              KEY des-chiave
           ELSE
              READ destini WITH NO LOCK 
              KEY des-chiave
           END-IF
           PERFORM destini-K1-MERGE-SPLITBUF
           PERFORM destini-k-localita-MERGE-SPLITBUF
           MOVE STATUS-destini TO TOTEM-ERR-STAT 
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-destini-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-destini-KEY-Asc
              IF DataSet1-destini-LOCK
                 READ destini NEXT WITH LOCK
              ELSE
                 READ destini NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-destini-LOCK
                 READ destini PREVIOUS WITH LOCK
              ELSE
                 READ destini PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM destini-K1-MERGE-SPLITBUF
           PERFORM destini-k-localita-MERGE-SPLITBUF
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-destini-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-destini-KEY-Asc
              IF DataSet1-destini-LOCK
                 READ destini PREVIOUS WITH LOCK
              ELSE
                 READ destini PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-destini-LOCK
                 READ destini NEXT WITH LOCK
              ELSE
                 READ destini NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM destini-K1-MERGE-SPLITBUF
           PERFORM destini-k-localita-MERGE-SPLITBUF
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-destini-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-destini-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-destini-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-timbalqta-INITSTART.
           IF DataSet1-timbalqta-KEY-Asc
              MOVE Low-Value TO imq-chiave
           ELSE
              MOVE High-Value TO imq-chiave
           END-IF
           .

       DataSet1-timbalqta-INITEND.
           IF DataSet1-timbalqta-KEY-Asc
              MOVE High-Value TO imq-chiave
           ELSE
              MOVE Low-Value TO imq-chiave
           END-IF
           .

      * timbalqta
       DataSet1-timbalqta-START.
           IF DataSet1-timbalqta-KEY-Asc
              START timbalqta KEY >= imq-chiave
           ELSE
              START timbalqta KEY <= imq-chiave
           END-IF
           .

       DataSet1-timbalqta-START-NOTGREATER.
           IF DataSet1-timbalqta-KEY-Asc
              START timbalqta KEY <= imq-chiave
           ELSE
              START timbalqta KEY >= imq-chiave
           END-IF
           .

       DataSet1-timbalqta-START-GREATER.
           IF DataSet1-timbalqta-KEY-Asc
              START timbalqta KEY > imq-chiave
           ELSE
              START timbalqta KEY < imq-chiave
           END-IF
           .

       DataSet1-timbalqta-START-LESS.
           IF DataSet1-timbalqta-KEY-Asc
              START timbalqta KEY < imq-chiave
           ELSE
              START timbalqta KEY > imq-chiave
           END-IF
           .

       DataSet1-timbalqta-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-timbalqta-LOCK
              READ timbalqta WITH LOCK 
              KEY imq-chiave
           ELSE
              READ timbalqta WITH NO LOCK 
              KEY imq-chiave
           END-IF
           MOVE STATUS-timbalqta TO TOTEM-ERR-STAT 
           MOVE "timbalqta" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-timbalqta-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-timbalqta-KEY-Asc
              IF DataSet1-timbalqta-LOCK
                 READ timbalqta NEXT WITH LOCK
              ELSE
                 READ timbalqta NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-timbalqta-LOCK
                 READ timbalqta PREVIOUS WITH LOCK
              ELSE
                 READ timbalqta PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-timbalqta TO TOTEM-ERR-STAT
           MOVE "timbalqta" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-timbalqta-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-timbalqta-KEY-Asc
              IF DataSet1-timbalqta-LOCK
                 READ timbalqta PREVIOUS WITH LOCK
              ELSE
                 READ timbalqta PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-timbalqta-LOCK
                 READ timbalqta NEXT WITH LOCK
              ELSE
                 READ timbalqta NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-timbalqta TO TOTEM-ERR-STAT
           MOVE "timbalqta" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-timbalqta-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-timbalqta TO TOTEM-ERR-STAT
           MOVE "timbalqta" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-timbalqta-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-timbalqta TO TOTEM-ERR-STAT
           MOVE "timbalqta" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-timbalqta-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-timbalqta TO TOTEM-ERR-STAT
           MOVE "timbalqta" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-ttipocli-INITSTART.
           IF DataSet1-ttipocli-KEY-Asc
              MOVE Low-Value TO tcl-chiave
           ELSE
              MOVE High-Value TO tcl-chiave
           END-IF
           .

       DataSet1-ttipocli-INITEND.
           IF DataSet1-ttipocli-KEY-Asc
              MOVE High-Value TO tcl-chiave
           ELSE
              MOVE Low-Value TO tcl-chiave
           END-IF
           .

      * ttipocli
       DataSet1-ttipocli-START.
           IF DataSet1-ttipocli-KEY-Asc
              START ttipocli KEY >= tcl-chiave
           ELSE
              START ttipocli KEY <= tcl-chiave
           END-IF
           .

       DataSet1-ttipocli-START-NOTGREATER.
           IF DataSet1-ttipocli-KEY-Asc
              START ttipocli KEY <= tcl-chiave
           ELSE
              START ttipocli KEY >= tcl-chiave
           END-IF
           .

       DataSet1-ttipocli-START-GREATER.
           IF DataSet1-ttipocli-KEY-Asc
              START ttipocli KEY > tcl-chiave
           ELSE
              START ttipocli KEY < tcl-chiave
           END-IF
           .

       DataSet1-ttipocli-START-LESS.
           IF DataSet1-ttipocli-KEY-Asc
              START ttipocli KEY < tcl-chiave
           ELSE
              START ttipocli KEY > tcl-chiave
           END-IF
           .

       DataSet1-ttipocli-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-ttipocli-LOCK
              READ ttipocli WITH LOCK 
              KEY tcl-chiave
           ELSE
              READ ttipocli WITH NO LOCK 
              KEY tcl-chiave
           END-IF
           MOVE STATUS-ttipocli TO TOTEM-ERR-STAT 
           MOVE "ttipocli" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-ttipocli-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-ttipocli-KEY-Asc
              IF DataSet1-ttipocli-LOCK
                 READ ttipocli NEXT WITH LOCK
              ELSE
                 READ ttipocli NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-ttipocli-LOCK
                 READ ttipocli PREVIOUS WITH LOCK
              ELSE
                 READ ttipocli PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-ttipocli TO TOTEM-ERR-STAT
           MOVE "ttipocli" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-ttipocli-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-ttipocli-KEY-Asc
              IF DataSet1-ttipocli-LOCK
                 READ ttipocli PREVIOUS WITH LOCK
              ELSE
                 READ ttipocli PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-ttipocli-LOCK
                 READ ttipocli NEXT WITH LOCK
              ELSE
                 READ ttipocli NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-ttipocli TO TOTEM-ERR-STAT
           MOVE "ttipocli" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-ttipocli-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-ttipocli TO TOTEM-ERR-STAT
           MOVE "ttipocli" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-ttipocli-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-ttipocli TO TOTEM-ERR-STAT
           MOVE "ttipocli" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-ttipocli-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-ttipocli TO TOTEM-ERR-STAT
           MOVE "ttipocli" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:ttipocli, AfterDelete>
      * <TOTEM:END>
           .

       tmp-progmag-zoom-key-des-MERGE-SPLITBUF.
           INITIALIZE tmp-progmag-zoom-key-des-SPLITBUF
           MOVE tmp-prg-z-art-des(1:40) TO 
           tmp-progmag-zoom-key-des-SPLITBUF(1:40)
           MOVE tmp-prg-z-chiave(1:23) TO 
           tmp-progmag-zoom-key-des-SPLITBUF(41:23)
           .

       tmp-progmag-zoom-key-des-SPLITBUF-TOFLD.
           MOVE tmp-progmag-zoom-key-des-SPLITBUF(1:40) TO 
           tmp-prg-z-art-des(1:40)
           MOVE tmp-progmag-zoom-key-des-SPLITBUF(41:23) TO 
           tmp-prg-z-chiave(1:23)
           .

       tmp-progmag-zoom-key-art-MERGE-SPLITBUF.
           INITIALIZE tmp-progmag-zoom-key-art-SPLITBUF
           MOVE tmp-prg-z-cod-articolo(1:6) TO 
           tmp-progmag-zoom-key-art-SPLITBUF(1:6)
           .

       DataSet1-tmp-progmag-zoom-INITSTART.
           IF DataSet1-tmp-progmag-zoom-KEY-Asc
              MOVE Low-Value TO tmp-prg-z-art-des
           ELSE
              MOVE High-Value TO tmp-prg-z-art-des
           END-IF
           IF DataSet1-tmp-progmag-zoom-KEY-Asc
              MOVE Low-Value TO tmp-prg-z-chiave
           ELSE
              MOVE High-Value TO tmp-prg-z-chiave
           END-IF
           .

       DataSet1-tmp-progmag-zoom-INITEND.
           IF DataSet1-tmp-progmag-zoom-KEY-Asc
              MOVE High-Value to tmp-prg-z-art-des
           ELSE
              MOVE Low-Value to tmp-prg-z-art-des
           END-IF
           IF DataSet1-tmp-progmag-zoom-KEY-Asc
              MOVE High-Value to tmp-prg-z-chiave
           ELSE
              MOVE Low-Value to tmp-prg-z-chiave
           END-IF
           .

       DataSet1-tmp-progmag-zoom-TMPBUF-TO-FLD.
           MOVE DataSet1-tmp-progmag-zoom-SPLIT-BUF1(1:40) TO
                tmp-prg-z-art-des(1:40)
           MOVE DataSet1-tmp-progmag-zoom-SPLIT-BUF1(41:23) TO
                tmp-prg-z-chiave(1:23)
           .

       DataSet1-tmp-progmag-zoom-FLD-TO-TMPBUF.
           MOVE tmp-prg-z-art-des(1:40) TO
                DataSet1-tmp-progmag-zoom-SPLIT-BUF1(1:40)
           MOVE tmp-prg-z-chiave(1:23) TO
                DataSet1-tmp-progmag-zoom-SPLIT-BUF1(41:23)
           .

      * tmp-progmag-zoom
       DataSet1-tmp-progmag-zoom-START.
           IF DataSet1-tmp-progmag-zoom-KEY-Asc
              START tmp-progmag-zoom KEY >= key-des
           ELSE
              START tmp-progmag-zoom KEY <= key-des
           END-IF
           .

       DataSet1-tmp-progmag-zoom-START-NOTGREATER.
           IF DataSet1-tmp-progmag-zoom-KEY-Asc
              START tmp-progmag-zoom KEY <= key-des
           ELSE
              START tmp-progmag-zoom KEY >= key-des
           END-IF
           .

       DataSet1-tmp-progmag-zoom-START-GREATER.
           IF DataSet1-tmp-progmag-zoom-KEY-Asc
              START tmp-progmag-zoom KEY > key-des
           ELSE
              START tmp-progmag-zoom KEY < key-des
           END-IF
           .

       DataSet1-tmp-progmag-zoom-START-LESS.
           IF DataSet1-tmp-progmag-zoom-KEY-Asc
              START tmp-progmag-zoom KEY < key-des
           ELSE
              START tmp-progmag-zoom KEY > key-des
           END-IF
           .

       DataSet1-tmp-progmag-zoom-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tmp-progmag-zoom-LOCK
              READ tmp-progmag-zoom WITH LOCK 
              KEY key-des
           ELSE
              READ tmp-progmag-zoom WITH NO LOCK 
              KEY key-des
           END-IF
           PERFORM tmp-progmag-zoom-key-des-MERGE-SPLITBUF
           PERFORM tmp-progmag-zoom-key-art-MERGE-SPLITBUF
           MOVE STATUS-tmp-progmag-zoom TO TOTEM-ERR-STAT 
           MOVE "tmp-progmag-zoom" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tmp-progmag-zoom-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tmp-progmag-zoom-KEY-Asc
              IF DataSet1-tmp-progmag-zoom-LOCK
                 READ tmp-progmag-zoom NEXT WITH LOCK
              ELSE
                 READ tmp-progmag-zoom NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tmp-progmag-zoom-LOCK
                 READ tmp-progmag-zoom PREVIOUS WITH LOCK
              ELSE
                 READ tmp-progmag-zoom PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tmp-progmag-zoom-key-des-MERGE-SPLITBUF
           PERFORM tmp-progmag-zoom-key-art-MERGE-SPLITBUF
           MOVE STATUS-tmp-progmag-zoom TO TOTEM-ERR-STAT
           MOVE "tmp-progmag-zoom" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tmp-progmag-zoom-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tmp-progmag-zoom-KEY-Asc
              IF DataSet1-tmp-progmag-zoom-LOCK
                 READ tmp-progmag-zoom PREVIOUS WITH LOCK
              ELSE
                 READ tmp-progmag-zoom PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tmp-progmag-zoom-LOCK
                 READ tmp-progmag-zoom NEXT WITH LOCK
              ELSE
                 READ tmp-progmag-zoom NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tmp-progmag-zoom-key-des-MERGE-SPLITBUF
           PERFORM tmp-progmag-zoom-key-art-MERGE-SPLITBUF
           MOVE STATUS-tmp-progmag-zoom TO TOTEM-ERR-STAT
           MOVE "tmp-progmag-zoom" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tmp-progmag-zoom-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, BeforeWrite>
      * <TOTEM:END>
           WRITE tmp-prg-z-rec OF tmp-progmag-zoom.
           MOVE STATUS-tmp-progmag-zoom TO TOTEM-ERR-STAT
           MOVE "tmp-progmag-zoom" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tmp-progmag-zoom-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, BeforeRewrite>
      * <TOTEM:END>
           REWRITE tmp-prg-z-rec OF tmp-progmag-zoom.
           MOVE STATUS-tmp-progmag-zoom TO TOTEM-ERR-STAT
           MOVE "tmp-progmag-zoom" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tmp-progmag-zoom-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, BeforeDelete>
      * <TOTEM:END>
           DELETE tmp-progmag-zoom.
           MOVE STATUS-tmp-progmag-zoom TO TOTEM-ERR-STAT
           MOVE "tmp-progmag-zoom" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-progmag-zoom, AfterDelete>
      * <TOTEM:END>
           .

       tgrupgdo-gdo-k-g2-MERGE-SPLITBUF.
           INITIALIZE tgrupgdo-gdo-k-g2-SPLITBUF
           MOVE gdo-codice-G2 OF tgrupgdo(1:3) TO 
           tgrupgdo-gdo-k-g2-SPLITBUF(1:3)
           MOVE gdo-chiave OF tgrupgdo(1:5) TO 
           tgrupgdo-gdo-k-g2-SPLITBUF(4:5)
           .

       DataSet1-tgrupgdo-INITSTART.
           IF DataSet1-tgrupgdo-KEY-Asc
              MOVE Low-Value TO gdo-chiave OF tgrupgdo
           ELSE
              MOVE High-Value TO gdo-chiave OF tgrupgdo
           END-IF
           .

       DataSet1-tgrupgdo-INITEND.
           IF DataSet1-tgrupgdo-KEY-Asc
              MOVE High-Value TO gdo-chiave OF tgrupgdo
           ELSE
              MOVE Low-Value TO gdo-chiave OF tgrupgdo
           END-IF
           .

      * tgrupgdo
       DataSet1-tgrupgdo-START.
           IF DataSet1-tgrupgdo-KEY-Asc
              START tgrupgdo KEY >= gdo-chiave OF tgrupgdo
           ELSE
              START tgrupgdo KEY <= gdo-chiave OF tgrupgdo
           END-IF
           .

       DataSet1-tgrupgdo-START-NOTGREATER.
           IF DataSet1-tgrupgdo-KEY-Asc
              START tgrupgdo KEY <= gdo-chiave OF tgrupgdo
           ELSE
              START tgrupgdo KEY >= gdo-chiave OF tgrupgdo
           END-IF
           .

       DataSet1-tgrupgdo-START-GREATER.
           IF DataSet1-tgrupgdo-KEY-Asc
              START tgrupgdo KEY > gdo-chiave OF tgrupgdo
           ELSE
              START tgrupgdo KEY < gdo-chiave OF tgrupgdo
           END-IF
           .

       DataSet1-tgrupgdo-START-LESS.
           IF DataSet1-tgrupgdo-KEY-Asc
              START tgrupgdo KEY < gdo-chiave OF tgrupgdo
           ELSE
              START tgrupgdo KEY > gdo-chiave OF tgrupgdo
           END-IF
           .

       DataSet1-tgrupgdo-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tgrupgdo-LOCK
              READ tgrupgdo WITH LOCK 
              KEY gdo-chiave OF tgrupgdo
           ELSE
              READ tgrupgdo WITH NO LOCK 
              KEY gdo-chiave OF tgrupgdo
           END-IF
           PERFORM tgrupgdo-gdo-k-g2-MERGE-SPLITBUF
           MOVE STATUS-tgrupgdo TO TOTEM-ERR-STAT 
           MOVE "tgrupgdo" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tgrupgdo-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tgrupgdo-KEY-Asc
              IF DataSet1-tgrupgdo-LOCK
                 READ tgrupgdo NEXT WITH LOCK
              ELSE
                 READ tgrupgdo NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tgrupgdo-LOCK
                 READ tgrupgdo PREVIOUS WITH LOCK
              ELSE
                 READ tgrupgdo PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tgrupgdo-gdo-k-g2-MERGE-SPLITBUF
           MOVE STATUS-tgrupgdo TO TOTEM-ERR-STAT
           MOVE "tgrupgdo" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tgrupgdo-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tgrupgdo-KEY-Asc
              IF DataSet1-tgrupgdo-LOCK
                 READ tgrupgdo PREVIOUS WITH LOCK
              ELSE
                 READ tgrupgdo PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tgrupgdo-LOCK
                 READ tgrupgdo NEXT WITH LOCK
              ELSE
                 READ tgrupgdo NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tgrupgdo-gdo-k-g2-MERGE-SPLITBUF
           MOVE STATUS-tgrupgdo TO TOTEM-ERR-STAT
           MOVE "tgrupgdo" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tgrupgdo-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tgrupgdo TO TOTEM-ERR-STAT
           MOVE "tgrupgdo" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tgrupgdo-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tgrupgdo TO TOTEM-ERR-STAT
           MOVE "tgrupgdo" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tgrupgdo-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tgrupgdo TO TOTEM-ERR-STAT
           MOVE "tgrupgdo" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tgrupgdo, AfterDelete>
      * <TOTEM:END>
           .

       tordforn-tof-k-causale-MERGE-SPLITBUF.
           INITIALIZE tordforn-tof-k-causale-SPLITBUF
           MOVE tof-causale(1:4) TO tordforn-tof-k-causale-SPLITBUF(1:4)
           MOVE tof-chiave(1:12) TO 
           tordforn-tof-k-causale-SPLITBUF(5:12)
           .

       tordforn-tof-k-stato-MERGE-SPLITBUF.
           INITIALIZE tordforn-tof-k-stato-SPLITBUF
           MOVE tof-stato(1:1) TO tordforn-tof-k-stato-SPLITBUF(1:1)
           MOVE tof-chiave(1:12) TO tordforn-tof-k-stato-SPLITBUF(2:12)
           .

       tordforn-k-fornitore-MERGE-SPLITBUF.
           INITIALIZE tordforn-k-fornitore-SPLITBUF
           MOVE tof-cod-forn(1:5) TO tordforn-k-fornitore-SPLITBUF(1:5)
           MOVE tof-destino(1:5) TO tordforn-k-fornitore-SPLITBUF(6:5)
           MOVE tof-stato(1:1) TO tordforn-k-fornitore-SPLITBUF(11:1)
           MOVE tof-chiave(1:12) TO tordforn-k-fornitore-SPLITBUF(12:12)
           .

       tordforn-tof-k-data-MERGE-SPLITBUF.
           INITIALIZE tordforn-tof-k-data-SPLITBUF
           MOVE tof-data-ordine OF tordforn(1:8) TO 
           tordforn-tof-k-data-SPLITBUF(1:8)
           MOVE tof-chiave OF tordforn(1:12) TO 
           tordforn-tof-k-data-SPLITBUF(9:12)
           .

       tordforn-tof-k-consegna-MERGE-SPLITBUF.
           INITIALIZE tordforn-tof-k-consegna-SPLITBUF
           MOVE tof-data-consegna OF tordforn(1:8) TO 
           tordforn-tof-k-consegna-SPLITBUF(1:8)
           MOVE tof-chiave OF tordforn(1:12) TO 
           tordforn-tof-k-consegna-SPLITBUF(9:12)
           .

       DataSet1-tordforn-INITSTART.
           IF DataSet1-tordforn-KEY-Asc
              MOVE Low-Value TO tof-chiave
           ELSE
              MOVE High-Value TO tof-chiave
           END-IF
           .

       DataSet1-tordforn-INITEND.
           IF DataSet1-tordforn-KEY-Asc
              MOVE High-Value TO tof-chiave
           ELSE
              MOVE Low-Value TO tof-chiave
           END-IF
           .

      * tordforn
       DataSet1-tordforn-START.
           IF DataSet1-tordforn-KEY-Asc
              START tordforn KEY >= tof-chiave
           ELSE
              START tordforn KEY <= tof-chiave
           END-IF
           .

       DataSet1-tordforn-START-NOTGREATER.
           IF DataSet1-tordforn-KEY-Asc
              START tordforn KEY <= tof-chiave
           ELSE
              START tordforn KEY >= tof-chiave
           END-IF
           .

       DataSet1-tordforn-START-GREATER.
           IF DataSet1-tordforn-KEY-Asc
              START tordforn KEY > tof-chiave
           ELSE
              START tordforn KEY < tof-chiave
           END-IF
           .

       DataSet1-tordforn-START-LESS.
           IF DataSet1-tordforn-KEY-Asc
              START tordforn KEY < tof-chiave
           ELSE
              START tordforn KEY > tof-chiave
           END-IF
           .

       DataSet1-tordforn-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tordforn-LOCK
              READ tordforn WITH LOCK 
              KEY tof-chiave
           ELSE
              READ tordforn WITH NO LOCK 
              KEY tof-chiave
           END-IF
           PERFORM tordforn-tof-k-causale-MERGE-SPLITBUF
           PERFORM tordforn-tof-k-stato-MERGE-SPLITBUF
           PERFORM tordforn-k-fornitore-MERGE-SPLITBUF
           PERFORM tordforn-tof-k-data-MERGE-SPLITBUF
           PERFORM tordforn-tof-k-consegna-MERGE-SPLITBUF
           MOVE STATUS-tordforn TO TOTEM-ERR-STAT 
           MOVE "tordforn" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tordforn-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tordforn-KEY-Asc
              IF DataSet1-tordforn-LOCK
                 READ tordforn NEXT WITH LOCK
              ELSE
                 READ tordforn NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tordforn-LOCK
                 READ tordforn PREVIOUS WITH LOCK
              ELSE
                 READ tordforn PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tordforn-tof-k-causale-MERGE-SPLITBUF
           PERFORM tordforn-tof-k-stato-MERGE-SPLITBUF
           PERFORM tordforn-k-fornitore-MERGE-SPLITBUF
           PERFORM tordforn-tof-k-data-MERGE-SPLITBUF
           PERFORM tordforn-tof-k-consegna-MERGE-SPLITBUF
           MOVE STATUS-tordforn TO TOTEM-ERR-STAT
           MOVE "tordforn" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tordforn-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tordforn-KEY-Asc
              IF DataSet1-tordforn-LOCK
                 READ tordforn PREVIOUS WITH LOCK
              ELSE
                 READ tordforn PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tordforn-LOCK
                 READ tordforn NEXT WITH LOCK
              ELSE
                 READ tordforn NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tordforn-tof-k-causale-MERGE-SPLITBUF
           PERFORM tordforn-tof-k-stato-MERGE-SPLITBUF
           PERFORM tordforn-k-fornitore-MERGE-SPLITBUF
           PERFORM tordforn-tof-k-data-MERGE-SPLITBUF
           PERFORM tordforn-tof-k-consegna-MERGE-SPLITBUF
           MOVE STATUS-tordforn TO TOTEM-ERR-STAT
           MOVE "tordforn" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tordforn-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, BeforeWrite>
      * <TOTEM:END>
           WRITE tof-rec OF tordforn.
           MOVE STATUS-tordforn TO TOTEM-ERR-STAT
           MOVE "tordforn" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tordforn-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, BeforeRewrite>
      * <TOTEM:END>
           REWRITE tof-rec OF tordforn.
           MOVE STATUS-tordforn TO TOTEM-ERR-STAT
           MOVE "tordforn" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tordforn-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, BeforeDelete>
      * <TOTEM:END>
           DELETE tordforn.
           MOVE STATUS-tordforn TO TOTEM-ERR-STAT
           MOVE "tordforn" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordforn, AfterDelete>
      * <TOTEM:END>
           .

       rordforn-rof-k-articolo-MERGE-SPLITBUF.
           INITIALIZE rordforn-rof-k-articolo-SPLITBUF
           MOVE rof-cod-articolo OF rordforn(1:6) TO 
           rordforn-rof-k-articolo-SPLITBUF(1:6)
           MOVE rof-chiave OF rordforn(1:17) TO 
           rordforn-rof-k-articolo-SPLITBUF(7:17)
           .

       rordforn-rof-k-art-mag-MERGE-SPLITBUF.
           INITIALIZE rordforn-rof-k-art-mag-SPLITBUF
           MOVE rof-cod-articolo OF rordforn(1:6) TO 
           rordforn-rof-k-art-mag-SPLITBUF(1:6)
           MOVE rof-cod-magazzino OF rordforn(1:3) TO 
           rordforn-rof-k-art-mag-SPLITBUF(7:3)
           MOVE rof-chiave OF rordforn(1:17) TO 
           rordforn-rof-k-art-mag-SPLITBUF(10:17)
           .

       DataSet1-rordforn-INITSTART.
           IF DataSet1-rordforn-KEY-Asc
              MOVE Low-Value TO rof-chiave OF rordforn
           ELSE
              MOVE High-Value TO rof-chiave OF rordforn
           END-IF
           .

       DataSet1-rordforn-INITEND.
           IF DataSet1-rordforn-KEY-Asc
              MOVE High-Value TO rof-chiave OF rordforn
           ELSE
              MOVE Low-Value TO rof-chiave OF rordforn
           END-IF
           .

      * rordforn
       DataSet1-rordforn-START.
           IF DataSet1-rordforn-KEY-Asc
              START rordforn KEY >= rof-chiave OF rordforn
           ELSE
              START rordforn KEY <= rof-chiave OF rordforn
           END-IF
           .

       DataSet1-rordforn-START-NOTGREATER.
           IF DataSet1-rordforn-KEY-Asc
              START rordforn KEY <= rof-chiave OF rordforn
           ELSE
              START rordforn KEY >= rof-chiave OF rordforn
           END-IF
           .

       DataSet1-rordforn-START-GREATER.
           IF DataSet1-rordforn-KEY-Asc
              START rordforn KEY > rof-chiave OF rordforn
           ELSE
              START rordforn KEY < rof-chiave OF rordforn
           END-IF
           .

       DataSet1-rordforn-START-LESS.
           IF DataSet1-rordforn-KEY-Asc
              START rordforn KEY < rof-chiave OF rordforn
           ELSE
              START rordforn KEY > rof-chiave OF rordforn
           END-IF
           .

       DataSet1-rordforn-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-rordforn-LOCK
              READ rordforn WITH LOCK 
              KEY rof-chiave OF rordforn
           ELSE
              READ rordforn WITH NO LOCK 
              KEY rof-chiave OF rordforn
           END-IF
           PERFORM rordforn-rof-k-articolo-MERGE-SPLITBUF
           PERFORM rordforn-rof-k-art-mag-MERGE-SPLITBUF
           MOVE STATUS-rordforn TO TOTEM-ERR-STAT 
           MOVE "rordforn" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-rordforn-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-rordforn-KEY-Asc
              IF DataSet1-rordforn-LOCK
                 READ rordforn NEXT WITH LOCK
              ELSE
                 READ rordforn NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-rordforn-LOCK
                 READ rordforn PREVIOUS WITH LOCK
              ELSE
                 READ rordforn PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM rordforn-rof-k-articolo-MERGE-SPLITBUF
           PERFORM rordforn-rof-k-art-mag-MERGE-SPLITBUF
           MOVE STATUS-rordforn TO TOTEM-ERR-STAT
           MOVE "rordforn" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-rordforn-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-rordforn-KEY-Asc
              IF DataSet1-rordforn-LOCK
                 READ rordforn PREVIOUS WITH LOCK
              ELSE
                 READ rordforn PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-rordforn-LOCK
                 READ rordforn NEXT WITH LOCK
              ELSE
                 READ rordforn NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM rordforn-rof-k-articolo-MERGE-SPLITBUF
           PERFORM rordforn-rof-k-art-mag-MERGE-SPLITBUF
           MOVE STATUS-rordforn TO TOTEM-ERR-STAT
           MOVE "rordforn" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-rordforn-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, BeforeWrite>
      * <TOTEM:END>
           WRITE rof-rec OF rordforn.
           MOVE STATUS-rordforn TO TOTEM-ERR-STAT
           MOVE "rordforn" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-rordforn-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, BeforeRewrite>
      * <TOTEM:END>
           REWRITE rof-rec OF rordforn.
           MOVE STATUS-rordforn TO TOTEM-ERR-STAT
           MOVE "rordforn" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-rordforn-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, BeforeDelete>
      * <TOTEM:END>
           DELETE rordforn.
           MOVE STATUS-rordforn TO TOTEM-ERR-STAT
           MOVE "rordforn" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rordforn, AfterDelete>
      * <TOTEM:END>
           .

       reva-reva-k-articolo-MERGE-SPLITBUF.
           INITIALIZE reva-reva-k-articolo-SPLITBUF
           MOVE reva-qta OF reva(1:8) TO 
           reva-reva-k-articolo-SPLITBUF(1:8)
           MOVE reva-chiave OF reva(1:17) TO 
           reva-reva-k-articolo-SPLITBUF(9:17)
           .

       DataSet1-reva-INITSTART.
           IF DataSet1-reva-KEY-Asc
              MOVE Low-Value TO reva-chiave
           ELSE
              MOVE High-Value TO reva-chiave
           END-IF
           .

       DataSet1-reva-INITEND.
           IF DataSet1-reva-KEY-Asc
              MOVE High-Value TO reva-chiave
           ELSE
              MOVE Low-Value TO reva-chiave
           END-IF
           .

      * reva
       DataSet1-reva-START.
           IF DataSet1-reva-KEY-Asc
              START reva KEY >= reva-chiave
           ELSE
              START reva KEY <= reva-chiave
           END-IF
           .

       DataSet1-reva-START-NOTGREATER.
           IF DataSet1-reva-KEY-Asc
              START reva KEY <= reva-chiave
           ELSE
              START reva KEY >= reva-chiave
           END-IF
           .

       DataSet1-reva-START-GREATER.
           IF DataSet1-reva-KEY-Asc
              START reva KEY > reva-chiave
           ELSE
              START reva KEY < reva-chiave
           END-IF
           .

       DataSet1-reva-START-LESS.
           IF DataSet1-reva-KEY-Asc
              START reva KEY < reva-chiave
           ELSE
              START reva KEY > reva-chiave
           END-IF
           .

       DataSet1-reva-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:reva, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:reva, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-reva-LOCK
              READ reva WITH LOCK 
              KEY reva-chiave
           ELSE
              READ reva WITH NO LOCK 
              KEY reva-chiave
           END-IF
           PERFORM reva-reva-k-articolo-MERGE-SPLITBUF
           MOVE STATUS-reva TO TOTEM-ERR-STAT 
           MOVE "reva" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:reva, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:reva, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-reva-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:reva, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:reva, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-reva-KEY-Asc
              IF DataSet1-reva-LOCK
                 READ reva NEXT WITH LOCK
              ELSE
                 READ reva NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-reva-LOCK
                 READ reva PREVIOUS WITH LOCK
              ELSE
                 READ reva PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM reva-reva-k-articolo-MERGE-SPLITBUF
           MOVE STATUS-reva TO TOTEM-ERR-STAT
           MOVE "reva" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:reva, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:reva, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-reva-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:reva, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:reva, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-reva-KEY-Asc
              IF DataSet1-reva-LOCK
                 READ reva PREVIOUS WITH LOCK
              ELSE
                 READ reva PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-reva-LOCK
                 READ reva NEXT WITH LOCK
              ELSE
                 READ reva NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM reva-reva-k-articolo-MERGE-SPLITBUF
           MOVE STATUS-reva TO TOTEM-ERR-STAT
           MOVE "reva" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:reva, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:reva, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-reva-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:reva, BeforeWrite>
      * <TOTEM:END>
           WRITE reva-rec OF reva.
           MOVE STATUS-reva TO TOTEM-ERR-STAT
           MOVE "reva" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:reva, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-reva-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:reva, BeforeRewrite>
      * <TOTEM:END>
           REWRITE reva-rec OF reva.
           MOVE STATUS-reva TO TOTEM-ERR-STAT
           MOVE "reva" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:reva, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-reva-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:reva, BeforeDelete>
      * <TOTEM:END>
           DELETE reva.
           MOVE STATUS-reva TO TOTEM-ERR-STAT
           MOVE "reva" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:reva, AfterDelete>
      * <TOTEM:END>
           .

       tvettori-k-des-MERGE-SPLITBUF.
           INITIALIZE tvettori-k-des-SPLITBUF
           MOVE vet-descrizione(1:40) TO tvettori-k-des-SPLITBUF(1:40)
           .

       DataSet1-tvettori-INITSTART.
           IF DataSet1-tvettori-KEY-Asc
              MOVE Low-Value TO vet-chiave
           ELSE
              MOVE High-Value TO vet-chiave
           END-IF
           .

       DataSet1-tvettori-INITEND.
           IF DataSet1-tvettori-KEY-Asc
              MOVE High-Value TO vet-chiave
           ELSE
              MOVE Low-Value TO vet-chiave
           END-IF
           .

      * tvettori
       DataSet1-tvettori-START.
           IF DataSet1-tvettori-KEY-Asc
              START tvettori KEY >= vet-chiave
           ELSE
              START tvettori KEY <= vet-chiave
           END-IF
           .

       DataSet1-tvettori-START-NOTGREATER.
           IF DataSet1-tvettori-KEY-Asc
              START tvettori KEY <= vet-chiave
           ELSE
              START tvettori KEY >= vet-chiave
           END-IF
           .

       DataSet1-tvettori-START-GREATER.
           IF DataSet1-tvettori-KEY-Asc
              START tvettori KEY > vet-chiave
           ELSE
              START tvettori KEY < vet-chiave
           END-IF
           .

       DataSet1-tvettori-START-LESS.
           IF DataSet1-tvettori-KEY-Asc
              START tvettori KEY < vet-chiave
           ELSE
              START tvettori KEY > vet-chiave
           END-IF
           .

       DataSet1-tvettori-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tvettori-LOCK
              READ tvettori WITH LOCK 
              KEY vet-chiave
           ELSE
              READ tvettori WITH NO LOCK 
              KEY vet-chiave
           END-IF
           PERFORM tvettori-k-des-MERGE-SPLITBUF
           MOVE STATUS-tvettori TO TOTEM-ERR-STAT 
           MOVE "tvettori" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tvettori-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tvettori-KEY-Asc
              IF DataSet1-tvettori-LOCK
                 READ tvettori NEXT WITH LOCK
              ELSE
                 READ tvettori NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tvettori-LOCK
                 READ tvettori PREVIOUS WITH LOCK
              ELSE
                 READ tvettori PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tvettori-k-des-MERGE-SPLITBUF
           MOVE STATUS-tvettori TO TOTEM-ERR-STAT
           MOVE "tvettori" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tvettori-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tvettori-KEY-Asc
              IF DataSet1-tvettori-LOCK
                 READ tvettori PREVIOUS WITH LOCK
              ELSE
                 READ tvettori PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tvettori-LOCK
                 READ tvettori NEXT WITH LOCK
              ELSE
                 READ tvettori NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tvettori-k-des-MERGE-SPLITBUF
           MOVE STATUS-tvettori TO TOTEM-ERR-STAT
           MOVE "tvettori" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tvettori-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tvettori TO TOTEM-ERR-STAT
           MOVE "tvettori" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tvettori-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tvettori TO TOTEM-ERR-STAT
           MOVE "tvettori" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tvettori-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tvettori TO TOTEM-ERR-STAT
           MOVE "tvettori" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterDelete>
      * <TOTEM:END>
           .

       teva-teva-stato-MERGE-SPLITBUF.
           INITIALIZE teva-teva-stato-SPLITBUF
           MOVE teva-stato OF teva(1:1) TO teva-teva-stato-SPLITBUF(1:1)
           MOVE teva-chiave OF teva(1:12) TO 
           teva-teva-stato-SPLITBUF(2:12)
           .

       DataSet1-teva-INITSTART.
           IF DataSet1-teva-KEY-Asc
              MOVE Low-Value TO teva-chiave OF teva
           ELSE
              MOVE High-Value TO teva-chiave OF teva
           END-IF
           .

       DataSet1-teva-INITEND.
           IF DataSet1-teva-KEY-Asc
              MOVE High-Value TO teva-chiave OF teva
           ELSE
              MOVE Low-Value TO teva-chiave OF teva
           END-IF
           .

      * teva
       DataSet1-teva-START.
           IF DataSet1-teva-KEY-Asc
              START teva KEY >= teva-chiave OF teva
           ELSE
              START teva KEY <= teva-chiave OF teva
           END-IF
           .

       DataSet1-teva-START-NOTGREATER.
           IF DataSet1-teva-KEY-Asc
              START teva KEY <= teva-chiave OF teva
           ELSE
              START teva KEY >= teva-chiave OF teva
           END-IF
           .

       DataSet1-teva-START-GREATER.
           IF DataSet1-teva-KEY-Asc
              START teva KEY > teva-chiave OF teva
           ELSE
              START teva KEY < teva-chiave OF teva
           END-IF
           .

       DataSet1-teva-START-LESS.
           IF DataSet1-teva-KEY-Asc
              START teva KEY < teva-chiave OF teva
           ELSE
              START teva KEY > teva-chiave OF teva
           END-IF
           .

       DataSet1-teva-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:teva, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:teva, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-teva-LOCK
              READ teva WITH LOCK 
              KEY teva-chiave OF teva
           ELSE
              READ teva WITH NO LOCK 
              KEY teva-chiave OF teva
           END-IF
           PERFORM teva-teva-stato-MERGE-SPLITBUF
           MOVE STATUS-teva TO TOTEM-ERR-STAT 
           MOVE "teva" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:teva, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:teva, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-teva-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:teva, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:teva, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-teva-KEY-Asc
              IF DataSet1-teva-LOCK
                 READ teva NEXT WITH LOCK
              ELSE
                 READ teva NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-teva-LOCK
                 READ teva PREVIOUS WITH LOCK
              ELSE
                 READ teva PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM teva-teva-stato-MERGE-SPLITBUF
           MOVE STATUS-teva TO TOTEM-ERR-STAT
           MOVE "teva" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:teva, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:teva, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-teva-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:teva, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:teva, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-teva-KEY-Asc
              IF DataSet1-teva-LOCK
                 READ teva PREVIOUS WITH LOCK
              ELSE
                 READ teva PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-teva-LOCK
                 READ teva NEXT WITH LOCK
              ELSE
                 READ teva NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM teva-teva-stato-MERGE-SPLITBUF
           MOVE STATUS-teva TO TOTEM-ERR-STAT
           MOVE "teva" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:teva, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:teva, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-teva-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:teva, BeforeWrite>
      * <TOTEM:END>
           WRITE teva-rec OF teva.
           MOVE STATUS-teva TO TOTEM-ERR-STAT
           MOVE "teva" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:teva, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-teva-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:teva, BeforeRewrite>
      * <TOTEM:END>
           REWRITE teva-rec OF teva.
           MOVE STATUS-teva TO TOTEM-ERR-STAT
           MOVE "teva" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:teva, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-teva-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:teva, BeforeDelete>
      * <TOTEM:END>
           DELETE teva.
           MOVE STATUS-teva TO TOTEM-ERR-STAT
           MOVE "teva" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:teva, AfterDelete>
      * <TOTEM:END>
           .

       brnotacr-brno-k-articolo-MERGE-SPLITBUF.
           INITIALIZE brnotacr-brno-k-articolo-SPLITBUF
           MOVE brno-cod-articolo(1:6) TO 
           brnotacr-brno-k-articolo-SPLITBUF(1:6)
           MOVE brno-chiave(1:18) TO 
           brnotacr-brno-k-articolo-SPLITBUF(7:18)
           .

       DataSet1-brnotacr-INITSTART.
           IF DataSet1-brnotacr-KEY-Asc
              MOVE Low-Value TO brno-chiave
           ELSE
              MOVE High-Value TO brno-chiave
           END-IF
           .

       DataSet1-brnotacr-INITEND.
           IF DataSet1-brnotacr-KEY-Asc
              MOVE High-Value TO brno-chiave
           ELSE
              MOVE Low-Value TO brno-chiave
           END-IF
           .

      * brnotacr
       DataSet1-brnotacr-START.
           IF DataSet1-brnotacr-KEY-Asc
              START brnotacr KEY >= brno-chiave
           ELSE
              START brnotacr KEY <= brno-chiave
           END-IF
           .

       DataSet1-brnotacr-START-NOTGREATER.
           IF DataSet1-brnotacr-KEY-Asc
              START brnotacr KEY <= brno-chiave
           ELSE
              START brnotacr KEY >= brno-chiave
           END-IF
           .

       DataSet1-brnotacr-START-GREATER.
           IF DataSet1-brnotacr-KEY-Asc
              START brnotacr KEY > brno-chiave
           ELSE
              START brnotacr KEY < brno-chiave
           END-IF
           .

       DataSet1-brnotacr-START-LESS.
           IF DataSet1-brnotacr-KEY-Asc
              START brnotacr KEY < brno-chiave
           ELSE
              START brnotacr KEY > brno-chiave
           END-IF
           .

       DataSet1-brnotacr-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-brnotacr-LOCK
              READ brnotacr WITH LOCK 
              KEY brno-chiave
           ELSE
              READ brnotacr WITH NO LOCK 
              KEY brno-chiave
           END-IF
           PERFORM brnotacr-brno-k-articolo-MERGE-SPLITBUF
           MOVE STATUS-brnotacr TO TOTEM-ERR-STAT 
           MOVE "brnotacr" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-brnotacr-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-brnotacr-KEY-Asc
              IF DataSet1-brnotacr-LOCK
                 READ brnotacr NEXT WITH LOCK
              ELSE
                 READ brnotacr NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-brnotacr-LOCK
                 READ brnotacr PREVIOUS WITH LOCK
              ELSE
                 READ brnotacr PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM brnotacr-brno-k-articolo-MERGE-SPLITBUF
           MOVE STATUS-brnotacr TO TOTEM-ERR-STAT
           MOVE "brnotacr" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-brnotacr-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-brnotacr-KEY-Asc
              IF DataSet1-brnotacr-LOCK
                 READ brnotacr PREVIOUS WITH LOCK
              ELSE
                 READ brnotacr PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-brnotacr-LOCK
                 READ brnotacr NEXT WITH LOCK
              ELSE
                 READ brnotacr NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM brnotacr-brno-k-articolo-MERGE-SPLITBUF
           MOVE STATUS-brnotacr TO TOTEM-ERR-STAT
           MOVE "brnotacr" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-brnotacr-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, BeforeWrite>
      * <TOTEM:END>
           WRITE brno-rec OF brnotacr.
           MOVE STATUS-brnotacr TO TOTEM-ERR-STAT
           MOVE "brnotacr" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-brnotacr-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, BeforeRewrite>
      * <TOTEM:END>
           REWRITE brno-rec OF brnotacr.
           MOVE STATUS-brnotacr TO TOTEM-ERR-STAT
           MOVE "brnotacr" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-brnotacr-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, BeforeDelete>
      * <TOTEM:END>
           DELETE brnotacr.
           MOVE STATUS-brnotacr TO TOTEM-ERR-STAT
           MOVE "brnotacr" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, AfterDelete>
      * <TOTEM:END>
           .

       btnotacr-k1-MERGE-SPLITBUF.
           INITIALIZE btnotacr-k1-SPLITBUF
           MOVE btno-cod-cli(1:5) TO btnotacr-k1-SPLITBUF(1:5)
           MOVE btno-prg-destino(1:5) TO btnotacr-k1-SPLITBUF(6:5)
           MOVE btno-anno(1:4) TO btnotacr-k1-SPLITBUF(11:4)
           MOVE btno-numero(1:8) TO btnotacr-k1-SPLITBUF(15:8)
           .

       btnotacr-k-data-MERGE-SPLITBUF.
           INITIALIZE btnotacr-k-data-SPLITBUF
           MOVE btno-data(1:8) TO btnotacr-k-data-SPLITBUF(1:8)
           MOVE btno-numero(1:8) TO btnotacr-k-data-SPLITBUF(9:8)
           .

       btnotacr-k-fattura-MERGE-SPLITBUF.
           INITIALIZE btnotacr-k-fattura-SPLITBUF
           MOVE btno-anno-fatt(1:4) TO btnotacr-k-fattura-SPLITBUF(1:4)
           MOVE btno-num-fatt(1:8) TO btnotacr-k-fattura-SPLITBUF(5:8)
           .

       btnotacr-k-reso-MERGE-SPLITBUF.
           INITIALIZE btnotacr-k-reso-SPLITBUF
           MOVE btno-anno(1:4) TO btnotacr-k-reso-SPLITBUF(1:4)
           MOVE btno-num-reso(1:8) TO btnotacr-k-reso-SPLITBUF(5:8)
           .

       btnotacr-k-bolla-MERGE-SPLITBUF.
           INITIALIZE btnotacr-k-bolla-SPLITBUF
           MOVE btno-anno-bolla(1:4) TO btnotacr-k-bolla-SPLITBUF(1:4)
           MOVE btno-num-bolla(1:20) TO btnotacr-k-bolla-SPLITBUF(5:20)
           .

       btnotacr-k-vettore-MERGE-SPLITBUF.
           INITIALIZE btnotacr-k-vettore-SPLITBUF
           MOVE btno-vettore(1:5) TO btnotacr-k-vettore-SPLITBUF(1:5)
           MOVE btno-anno(1:4) TO btnotacr-k-vettore-SPLITBUF(6:4)
           MOVE btno-numero(1:8) TO btnotacr-k-vettore-SPLITBUF(10:8)
           .

       btnotacr-k-nota-MERGE-SPLITBUF.
           INITIALIZE btnotacr-k-nota-SPLITBUF
           MOVE btno-anno-nc(1:4) TO btnotacr-k-nota-SPLITBUF(1:4)
           MOVE btno-num-nc(1:8) TO btnotacr-k-nota-SPLITBUF(5:8)
           .

       btnotacr-k-fatman-MERGE-SPLITBUF.
           INITIALIZE btnotacr-k-fatman-SPLITBUF
           MOVE btno-anno-fm(1:4) TO btnotacr-k-fatman-SPLITBUF(1:4)
           MOVE btno-num-fm(1:8) TO btnotacr-k-fatman-SPLITBUF(5:8)
           .

       DataSet1-btnotacr-INITSTART.
           IF DataSet1-btnotacr-KEY-Asc
              MOVE Low-Value TO btno-chiave
           ELSE
              MOVE High-Value TO btno-chiave
           END-IF
           .

       DataSet1-btnotacr-INITEND.
           IF DataSet1-btnotacr-KEY-Asc
              MOVE High-Value TO btno-chiave
           ELSE
              MOVE Low-Value TO btno-chiave
           END-IF
           .

      * btnotacr
       DataSet1-btnotacr-START.
           IF DataSet1-btnotacr-KEY-Asc
              START btnotacr KEY >= btno-chiave
           ELSE
              START btnotacr KEY <= btno-chiave
           END-IF
           .

       DataSet1-btnotacr-START-NOTGREATER.
           IF DataSet1-btnotacr-KEY-Asc
              START btnotacr KEY <= btno-chiave
           ELSE
              START btnotacr KEY >= btno-chiave
           END-IF
           .

       DataSet1-btnotacr-START-GREATER.
           IF DataSet1-btnotacr-KEY-Asc
              START btnotacr KEY > btno-chiave
           ELSE
              START btnotacr KEY < btno-chiave
           END-IF
           .

       DataSet1-btnotacr-START-LESS.
           IF DataSet1-btnotacr-KEY-Asc
              START btnotacr KEY < btno-chiave
           ELSE
              START btnotacr KEY > btno-chiave
           END-IF
           .

       DataSet1-btnotacr-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-btnotacr-LOCK
              READ btnotacr WITH LOCK 
              KEY btno-chiave
           ELSE
              READ btnotacr WITH NO LOCK 
              KEY btno-chiave
           END-IF
           PERFORM btnotacr-k1-MERGE-SPLITBUF
           PERFORM btnotacr-k-data-MERGE-SPLITBUF
           PERFORM btnotacr-k-fattura-MERGE-SPLITBUF
           PERFORM btnotacr-k-reso-MERGE-SPLITBUF
           PERFORM btnotacr-k-bolla-MERGE-SPLITBUF
           PERFORM btnotacr-k-vettore-MERGE-SPLITBUF
           PERFORM btnotacr-k-nota-MERGE-SPLITBUF
           PERFORM btnotacr-k-fatman-MERGE-SPLITBUF
           MOVE STATUS-btnotacr TO TOTEM-ERR-STAT 
           MOVE "btnotacr" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-btnotacr-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-btnotacr-KEY-Asc
              IF DataSet1-btnotacr-LOCK
                 READ btnotacr NEXT WITH LOCK
              ELSE
                 READ btnotacr NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-btnotacr-LOCK
                 READ btnotacr PREVIOUS WITH LOCK
              ELSE
                 READ btnotacr PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM btnotacr-k1-MERGE-SPLITBUF
           PERFORM btnotacr-k-data-MERGE-SPLITBUF
           PERFORM btnotacr-k-fattura-MERGE-SPLITBUF
           PERFORM btnotacr-k-reso-MERGE-SPLITBUF
           PERFORM btnotacr-k-bolla-MERGE-SPLITBUF
           PERFORM btnotacr-k-vettore-MERGE-SPLITBUF
           PERFORM btnotacr-k-nota-MERGE-SPLITBUF
           PERFORM btnotacr-k-fatman-MERGE-SPLITBUF
           MOVE STATUS-btnotacr TO TOTEM-ERR-STAT
           MOVE "btnotacr" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-btnotacr-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-btnotacr-KEY-Asc
              IF DataSet1-btnotacr-LOCK
                 READ btnotacr PREVIOUS WITH LOCK
              ELSE
                 READ btnotacr PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-btnotacr-LOCK
                 READ btnotacr NEXT WITH LOCK
              ELSE
                 READ btnotacr NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM btnotacr-k1-MERGE-SPLITBUF
           PERFORM btnotacr-k-data-MERGE-SPLITBUF
           PERFORM btnotacr-k-fattura-MERGE-SPLITBUF
           PERFORM btnotacr-k-reso-MERGE-SPLITBUF
           PERFORM btnotacr-k-bolla-MERGE-SPLITBUF
           PERFORM btnotacr-k-vettore-MERGE-SPLITBUF
           PERFORM btnotacr-k-nota-MERGE-SPLITBUF
           PERFORM btnotacr-k-fatman-MERGE-SPLITBUF
           MOVE STATUS-btnotacr TO TOTEM-ERR-STAT
           MOVE "btnotacr" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-btnotacr-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, BeforeWrite>
      * <TOTEM:END>
           WRITE btno-rec OF btnotacr.
           MOVE STATUS-btnotacr TO TOTEM-ERR-STAT
           MOVE "btnotacr" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-btnotacr-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, BeforeRewrite>
      * <TOTEM:END>
           REWRITE btno-rec OF btnotacr.
           MOVE STATUS-btnotacr TO TOTEM-ERR-STAT
           MOVE "btnotacr" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-btnotacr-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, BeforeDelete>
      * <TOTEM:END>
           DELETE btnotacr.
           MOVE STATUS-btnotacr TO TOTEM-ERR-STAT
           MOVE "btnotacr" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tsetinvio-INITSTART.
           IF DataSet1-tsetinvio-KEY-Asc
              MOVE Low-Value TO tsi-chiave
           ELSE
              MOVE High-Value TO tsi-chiave
           END-IF
           .

       DataSet1-tsetinvio-INITEND.
           IF DataSet1-tsetinvio-KEY-Asc
              MOVE High-Value TO tsi-chiave
           ELSE
              MOVE Low-Value TO tsi-chiave
           END-IF
           .

      * tsetinvio
       DataSet1-tsetinvio-START.
           IF DataSet1-tsetinvio-KEY-Asc
              START tsetinvio KEY >= tsi-chiave
           ELSE
              START tsetinvio KEY <= tsi-chiave
           END-IF
           .

       DataSet1-tsetinvio-START-NOTGREATER.
           IF DataSet1-tsetinvio-KEY-Asc
              START tsetinvio KEY <= tsi-chiave
           ELSE
              START tsetinvio KEY >= tsi-chiave
           END-IF
           .

       DataSet1-tsetinvio-START-GREATER.
           IF DataSet1-tsetinvio-KEY-Asc
              START tsetinvio KEY > tsi-chiave
           ELSE
              START tsetinvio KEY < tsi-chiave
           END-IF
           .

       DataSet1-tsetinvio-START-LESS.
           IF DataSet1-tsetinvio-KEY-Asc
              START tsetinvio KEY < tsi-chiave
           ELSE
              START tsetinvio KEY > tsi-chiave
           END-IF
           .

       DataSet1-tsetinvio-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tsetinvio, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tsetinvio, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tsetinvio-LOCK
              READ tsetinvio WITH LOCK 
              KEY tsi-chiave
           ELSE
              READ tsetinvio WITH NO LOCK 
              KEY tsi-chiave
           END-IF
           MOVE STATUS-tsetinvio TO TOTEM-ERR-STAT 
           MOVE "tsetinvio" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tsetinvio, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tsetinvio, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tsetinvio-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tsetinvio, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tsetinvio, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tsetinvio-KEY-Asc
              IF DataSet1-tsetinvio-LOCK
                 READ tsetinvio NEXT WITH LOCK
              ELSE
                 READ tsetinvio NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tsetinvio-LOCK
                 READ tsetinvio PREVIOUS WITH LOCK
              ELSE
                 READ tsetinvio PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tsetinvio TO TOTEM-ERR-STAT
           MOVE "tsetinvio" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tsetinvio, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tsetinvio, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tsetinvio-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tsetinvio, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tsetinvio, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tsetinvio-KEY-Asc
              IF DataSet1-tsetinvio-LOCK
                 READ tsetinvio PREVIOUS WITH LOCK
              ELSE
                 READ tsetinvio PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tsetinvio-LOCK
                 READ tsetinvio NEXT WITH LOCK
              ELSE
                 READ tsetinvio NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tsetinvio TO TOTEM-ERR-STAT
           MOVE "tsetinvio" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tsetinvio, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tsetinvio, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tsetinvio-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tsetinvio, BeforeWrite>
      * <TOTEM:END>
           WRITE tsi-rec OF tsetinvio.
           MOVE STATUS-tsetinvio TO TOTEM-ERR-STAT
           MOVE "tsetinvio" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tsetinvio, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tsetinvio-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tsetinvio, BeforeRewrite>
      * <TOTEM:END>
           REWRITE tsi-rec OF tsetinvio.
           MOVE STATUS-tsetinvio TO TOTEM-ERR-STAT
           MOVE "tsetinvio" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tsetinvio, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tsetinvio-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tsetinvio, BeforeDelete>
      * <TOTEM:END>
           DELETE tsetinvio.
           MOVE STATUS-tsetinvio TO TOTEM-ERR-STAT
           MOVE "tsetinvio" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tsetinvio, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tcontat-INITSTART.
           IF DataSet1-tcontat-KEY-Asc
              MOVE Low-Value TO con-chiave
           ELSE
              MOVE High-Value TO con-chiave
           END-IF
           .

       DataSet1-tcontat-INITEND.
           IF DataSet1-tcontat-KEY-Asc
              MOVE High-Value TO con-chiave
           ELSE
              MOVE Low-Value TO con-chiave
           END-IF
           .

      * tcontat
       DataSet1-tcontat-START.
           IF DataSet1-tcontat-KEY-Asc
              START tcontat KEY >= con-chiave
           ELSE
              START tcontat KEY <= con-chiave
           END-IF
           .

       DataSet1-tcontat-START-NOTGREATER.
           IF DataSet1-tcontat-KEY-Asc
              START tcontat KEY <= con-chiave
           ELSE
              START tcontat KEY >= con-chiave
           END-IF
           .

       DataSet1-tcontat-START-GREATER.
           IF DataSet1-tcontat-KEY-Asc
              START tcontat KEY > con-chiave
           ELSE
              START tcontat KEY < con-chiave
           END-IF
           .

       DataSet1-tcontat-START-LESS.
           IF DataSet1-tcontat-KEY-Asc
              START tcontat KEY < con-chiave
           ELSE
              START tcontat KEY > con-chiave
           END-IF
           .

       DataSet1-tcontat-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tcontat-LOCK
              READ tcontat WITH LOCK 
              KEY con-chiave
           ELSE
              READ tcontat WITH NO LOCK 
              KEY con-chiave
           END-IF
           MOVE STATUS-tcontat TO TOTEM-ERR-STAT 
           MOVE "tcontat" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tcontat-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tcontat-KEY-Asc
              IF DataSet1-tcontat-LOCK
                 READ tcontat NEXT WITH LOCK
              ELSE
                 READ tcontat NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tcontat-LOCK
                 READ tcontat PREVIOUS WITH LOCK
              ELSE
                 READ tcontat PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tcontat TO TOTEM-ERR-STAT
           MOVE "tcontat" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tcontat-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tcontat-KEY-Asc
              IF DataSet1-tcontat-LOCK
                 READ tcontat PREVIOUS WITH LOCK
              ELSE
                 READ tcontat PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tcontat-LOCK
                 READ tcontat NEXT WITH LOCK
              ELSE
                 READ tcontat NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tcontat TO TOTEM-ERR-STAT
           MOVE "tcontat" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tcontat-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tcontat TO TOTEM-ERR-STAT
           MOVE "tcontat" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tcontat-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tcontat TO TOTEM-ERR-STAT
           MOVE "tcontat" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tcontat-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tcontat TO TOTEM-ERR-STAT
           MOVE "tcontat" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, AfterDelete>
      * <TOTEM:END>
           .

       movutf-k-data-MERGE-SPLITBUF.
           INITIALIZE movutf-k-data-SPLITBUF
           MOVE mov-anno(1:4) TO movutf-k-data-SPLITBUF(1:4)
           MOVE mov-num-reg(1:8) TO movutf-k-data-SPLITBUF(5:8)
           MOVE mov-data(1:8) TO movutf-k-data-SPLITBUF(13:8)
           MOVE mov-tipo(1:1) TO movutf-k-data-SPLITBUF(21:1)
           MOVE mov-prog-reg(1:10) TO movutf-k-data-SPLITBUF(22:10)
           .

       movutf-k-data-bolla-MERGE-SPLITBUF.
           INITIALIZE movutf-k-data-bolla-SPLITBUF
           MOVE mov-anno(1:4) TO movutf-k-data-bolla-SPLITBUF(1:4)
           MOVE mov-num-reg(1:8) TO movutf-k-data-bolla-SPLITBUF(5:8)
           MOVE mov-data(1:8) TO movutf-k-data-bolla-SPLITBUF(13:8)
           MOVE mov-num-doc(1:10) TO movutf-k-data-bolla-SPLITBUF(21:10)
           MOVE mov-tipo(1:1) TO movutf-k-data-bolla-SPLITBUF(31:1)
           MOVE mov-prog-reg(1:10) TO 
           movutf-k-data-bolla-SPLITBUF(32:10)
           .

       movutf-k-data-reg-MERGE-SPLITBUF.
           INITIALIZE movutf-k-data-reg-SPLITBUF
           MOVE mov-anno(1:4) TO movutf-k-data-reg-SPLITBUF(1:4)
           MOVE mov-data(1:8) TO movutf-k-data-reg-SPLITBUF(5:8)
           MOVE mov-num-reg(1:8) TO movutf-k-data-reg-SPLITBUF(13:8)
           MOVE mov-num-doc(1:10) TO movutf-k-data-reg-SPLITBUF(21:10)
           MOVE mov-tipo(1:1) TO movutf-k-data-reg-SPLITBUF(31:1)
           MOVE mov-prog-reg(1:10) TO movutf-k-data-reg-SPLITBUF(32:10)
           .

       movutf-k-data-movim-MERGE-SPLITBUF.
           INITIALIZE movutf-k-data-movim-SPLITBUF
           MOVE mov-anno(1:4) TO movutf-k-data-movim-SPLITBUF(1:4)
           MOVE mov-data(1:8) TO movutf-k-data-movim-SPLITBUF(5:8)
           MOVE mov-tipo(1:1) TO movutf-k-data-movim-SPLITBUF(13:1)
           MOVE mov-num-movim(1:8) TO movutf-k-data-movim-SPLITBUF(14:8)
           MOVE mov-num-reg(1:8) TO movutf-k-data-movim-SPLITBUF(22:8)
           MOVE mov-prog-reg(1:10) TO 
           movutf-k-data-movim-SPLITBUF(30:10)
           .

       DataSet1-movutf-INITSTART.
           IF DataSet1-movutf-KEY-Asc
              MOVE Low-Value TO mov-chiave
           ELSE
              MOVE High-Value TO mov-chiave
           END-IF
           .

       DataSet1-movutf-INITEND.
           IF DataSet1-movutf-KEY-Asc
              MOVE High-Value TO mov-chiave
           ELSE
              MOVE Low-Value TO mov-chiave
           END-IF
           .

      * movutf
       DataSet1-movutf-START.
           IF DataSet1-movutf-KEY-Asc
              START movutf KEY >= mov-chiave
           ELSE
              START movutf KEY <= mov-chiave
           END-IF
           .

       DataSet1-movutf-START-NOTGREATER.
           IF DataSet1-movutf-KEY-Asc
              START movutf KEY <= mov-chiave
           ELSE
              START movutf KEY >= mov-chiave
           END-IF
           .

       DataSet1-movutf-START-GREATER.
           IF DataSet1-movutf-KEY-Asc
              START movutf KEY > mov-chiave
           ELSE
              START movutf KEY < mov-chiave
           END-IF
           .

       DataSet1-movutf-START-LESS.
           IF DataSet1-movutf-KEY-Asc
              START movutf KEY < mov-chiave
           ELSE
              START movutf KEY > mov-chiave
           END-IF
           .

       DataSet1-movutf-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:movutf, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:movutf, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-movutf-LOCK
              READ movutf WITH LOCK 
              KEY mov-chiave
           ELSE
              READ movutf WITH NO LOCK 
              KEY mov-chiave
           END-IF
           PERFORM movutf-k-data-MERGE-SPLITBUF
           PERFORM movutf-k-data-bolla-MERGE-SPLITBUF
           PERFORM movutf-k-data-reg-MERGE-SPLITBUF
           PERFORM movutf-k-data-movim-MERGE-SPLITBUF
           MOVE STATUS-movutf TO TOTEM-ERR-STAT 
           MOVE "movutf" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:movutf, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:movutf, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-movutf-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:movutf, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:movutf, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-movutf-KEY-Asc
              IF DataSet1-movutf-LOCK
                 READ movutf NEXT WITH LOCK
              ELSE
                 READ movutf NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-movutf-LOCK
                 READ movutf PREVIOUS WITH LOCK
              ELSE
                 READ movutf PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM movutf-k-data-MERGE-SPLITBUF
           PERFORM movutf-k-data-bolla-MERGE-SPLITBUF
           PERFORM movutf-k-data-reg-MERGE-SPLITBUF
           PERFORM movutf-k-data-movim-MERGE-SPLITBUF
           MOVE STATUS-movutf TO TOTEM-ERR-STAT
           MOVE "movutf" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:movutf, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:movutf, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-movutf-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:movutf, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:movutf, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-movutf-KEY-Asc
              IF DataSet1-movutf-LOCK
                 READ movutf PREVIOUS WITH LOCK
              ELSE
                 READ movutf PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-movutf-LOCK
                 READ movutf NEXT WITH LOCK
              ELSE
                 READ movutf NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM movutf-k-data-MERGE-SPLITBUF
           PERFORM movutf-k-data-bolla-MERGE-SPLITBUF
           PERFORM movutf-k-data-reg-MERGE-SPLITBUF
           PERFORM movutf-k-data-movim-MERGE-SPLITBUF
           MOVE STATUS-movutf TO TOTEM-ERR-STAT
           MOVE "movutf" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:movutf, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:movutf, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-movutf-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:movutf, BeforeWrite>
      * <TOTEM:END>
           WRITE mov-rec OF movutf.
           MOVE STATUS-movutf TO TOTEM-ERR-STAT
           MOVE "movutf" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:movutf, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-movutf-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:movutf, BeforeRewrite>
      * <TOTEM:END>
           REWRITE mov-rec OF movutf.
           MOVE STATUS-movutf TO TOTEM-ERR-STAT
           MOVE "movutf" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:movutf, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-movutf-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:movutf, BeforeDelete>
      * <TOTEM:END>
           DELETE movutf.
           MOVE STATUS-movutf TO TOTEM-ERR-STAT
           MOVE "movutf" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:movutf, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tnazioni-INITSTART.
           IF DataSet1-tnazioni-KEY-Asc
              MOVE Low-Value TO naz-chiave
           ELSE
              MOVE High-Value TO naz-chiave
           END-IF
           .

       DataSet1-tnazioni-INITEND.
           IF DataSet1-tnazioni-KEY-Asc
              MOVE High-Value TO naz-chiave
           ELSE
              MOVE Low-Value TO naz-chiave
           END-IF
           .

      * tnazioni
       DataSet1-tnazioni-START.
           IF DataSet1-tnazioni-KEY-Asc
              START tnazioni KEY >= naz-chiave
           ELSE
              START tnazioni KEY <= naz-chiave
           END-IF
           .

       DataSet1-tnazioni-START-NOTGREATER.
           IF DataSet1-tnazioni-KEY-Asc
              START tnazioni KEY <= naz-chiave
           ELSE
              START tnazioni KEY >= naz-chiave
           END-IF
           .

       DataSet1-tnazioni-START-GREATER.
           IF DataSet1-tnazioni-KEY-Asc
              START tnazioni KEY > naz-chiave
           ELSE
              START tnazioni KEY < naz-chiave
           END-IF
           .

       DataSet1-tnazioni-START-LESS.
           IF DataSet1-tnazioni-KEY-Asc
              START tnazioni KEY < naz-chiave
           ELSE
              START tnazioni KEY > naz-chiave
           END-IF
           .

       DataSet1-tnazioni-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tnazioni, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tnazioni, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tnazioni-LOCK
              READ tnazioni WITH LOCK 
              KEY naz-chiave
           ELSE
              READ tnazioni WITH NO LOCK 
              KEY naz-chiave
           END-IF
           MOVE STATUS-tnazioni TO TOTEM-ERR-STAT 
           MOVE "tnazioni" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tnazioni, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tnazioni, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tnazioni-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tnazioni, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tnazioni, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tnazioni-KEY-Asc
              IF DataSet1-tnazioni-LOCK
                 READ tnazioni NEXT WITH LOCK
              ELSE
                 READ tnazioni NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tnazioni-LOCK
                 READ tnazioni PREVIOUS WITH LOCK
              ELSE
                 READ tnazioni PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tnazioni TO TOTEM-ERR-STAT
           MOVE "tnazioni" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tnazioni, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tnazioni, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tnazioni-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tnazioni, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tnazioni, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tnazioni-KEY-Asc
              IF DataSet1-tnazioni-LOCK
                 READ tnazioni PREVIOUS WITH LOCK
              ELSE
                 READ tnazioni PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tnazioni-LOCK
                 READ tnazioni NEXT WITH LOCK
              ELSE
                 READ tnazioni NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tnazioni TO TOTEM-ERR-STAT
           MOVE "tnazioni" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tnazioni, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tnazioni, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tnazioni-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tnazioni, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tnazioni TO TOTEM-ERR-STAT
           MOVE "tnazioni" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tnazioni, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tnazioni-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tnazioni, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tnazioni TO TOTEM-ERR-STAT
           MOVE "tnazioni" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tnazioni, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tnazioni-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tnazioni, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tnazioni TO TOTEM-ERR-STAT
           MOVE "tnazioni" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tnazioni, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-lineseq-mail-INITSTART.
           .

       DataSet1-lineseq-mail-INITEND.
           .

       DataSet1-lineseq-mail-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq-mail, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq-mail, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-lineseq-mail-LOCK
              READ lineseq-mail WITH LOCK 
           ELSE
              READ lineseq-mail WITH NO LOCK 
           END-IF
           MOVE STATUS-lineseq-mail TO TOTEM-ERR-STAT 
           MOVE "lineseq-mail" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq-mail, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq-mail, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-lineseq-mail-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq-mail, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq-mail, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-lineseq-mail-KEY-Asc
              IF DataSet1-lineseq-mail-LOCK
                 READ lineseq-mail NEXT WITH LOCK
              ELSE
                 READ lineseq-mail NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-lineseq-mail TO TOTEM-ERR-STAT
           MOVE "lineseq-mail" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq-mail, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq-mail, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-lineseq-mail-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq-mail, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq-mail, BeforeReadPrev>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq-mail, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq-mail, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-lineseq-mail-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq-mail, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-lineseq-mail TO TOTEM-ERR-STAT
           MOVE "lineseq-mail" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq-mail, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-lineseq-mail-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq-mail, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-lineseq-mail TO TOTEM-ERR-STAT
           MOVE "lineseq-mail" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq-mail, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-lineseq-mail-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq-mail, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-lineseq-mail TO TOTEM-ERR-STAT
           MOVE "lineseq-mail" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:lineseq-mail, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-INIT-RECORD.
           INITIALIZE tmo-rec OF tmovmag
           INITIALIZE rmo-rec OF rmovmag
           INITIALIZE cli-rec OF clienti
           INITIALIZE mag-rec OF tmagaz
           INITIALIZE tge-rec OF tparamge
           INITIALIZE record-tblpa OF tcodpag
           INITIALIZE tca-rec OF tcaumag
           INITIALIZE art-rec OF articoli
           INITIALIZE imp-rec OF timposte
           INITIALIZE prg-rec OF progmag
           INITIALIZE mar-rec OF tmarche
           INITIALIZE imb-rec OF timballi
           INITIALIZE des-rec OF destini
           INITIALIZE imq-rec OF timbalqta
           INITIALIZE tcl-rec OF ttipocli
           INITIALIZE tmp-prg-z-rec OF tmp-progmag-zoom
           INITIALIZE gdo-rec OF tgrupgdo
           INITIALIZE tof-rec OF tordforn
           INITIALIZE rof-rec OF rordforn
           INITIALIZE reva-rec OF reva
           INITIALIZE vet-rec OF tvettori
           INITIALIZE teva-rec OF teva
           INITIALIZE brno-rec OF brnotacr
           INITIALIZE btno-rec OF btnotacr
           INITIALIZE tsi-rec OF tsetinvio
           INITIALIZE con-rec OF tcontat
           INITIALIZE mov-rec OF movutf
           INITIALIZE naz-rec OF tnazioni
           INITIALIZE line-riga-mail OF lineseq-mail
           .


      * COMBO-BOX
       cbo-stato-Content.
           .

      * GRID
       Form1-Gd-1-Content.
      * CELLS' SETTING
              MODIFY Form1-Gd-1, X = 2, Y = 1,
                CELL-DATA = "Articolo",
      * CELLS' SETTING
              MODIFY Form1-Gd-1, X = 3, Y = 1,
                CELL-DATA = "Descrizione",
      * CELLS' SETTING
              MODIFY Form1-Gd-1, X = 4, Y = 1,
                CELL-DATA = "Q.tà",
      * CELLS' SETTING
              MODIFY Form1-Gd-1, X = 5, Y = 1,
                CELL-DATA = "Peso UM",
      * CELLS' SETTING
              MODIFY Form1-Gd-1, X = 6, Y = 1,
                CELL-DATA = "Peso KG.",
      * CELLS' SETTING
              MODIFY Form1-Gd-1, X = 7, Y = 1,
                CELL-DATA = "Listino",
      * CELLS' SETTING
              MODIFY Form1-Gd-1, X = 8, Y = 1,
                CELL-DATA = "% Sconto",
      * CELLS' SETTING
              MODIFY Form1-Gd-1, X = 9, Y = 1,
                CELL-DATA = "Imp. Merce",
      * CELLS' SETTING
              MODIFY Form1-Gd-1, X = 10, Y = 1,
                CELL-DATA = "Imp. Consumo",
      * CELLS' SETTING
              MODIFY Form1-Gd-1, X = 11, Y = 1,
                CELL-DATA = "COU/Cobat",
      * CELLS' SETTING
              MODIFY Form1-Gd-1, X = 12, Y = 1,
                CELL-DATA = "Totale",
           .

      * FD's Initialize Paragraph
       DataSet1-tmovmag-INITREC.
           INITIALIZE tmo-rec OF tmovmag
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-rmovmag-INITREC.
           INITIALIZE rmo-rec OF rmovmag
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-clienti-INITREC.
           INITIALIZE cli-rec OF clienti
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tmagaz-INITREC.
           INITIALIZE mag-rec OF tmagaz
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tparamge-INITREC.
           INITIALIZE tge-rec OF tparamge
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tcodpag-INITREC.
           INITIALIZE record-tblpa OF tcodpag
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tcaumag-INITREC.
           INITIALIZE tca-rec OF tcaumag
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-articoli-INITREC.
           INITIALIZE art-rec OF articoli
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-timposte-INITREC.
           INITIALIZE imp-rec OF timposte
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-progmag-INITREC.
           INITIALIZE prg-rec OF progmag
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tmarche-INITREC.
           INITIALIZE mar-rec OF tmarche
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-timballi-INITREC.
           INITIALIZE imb-rec OF timballi
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-destini-INITREC.
           INITIALIZE des-rec OF destini
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-timbalqta-INITREC.
           INITIALIZE imq-rec OF timbalqta
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-ttipocli-INITREC.
           INITIALIZE tcl-rec OF ttipocli
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tmp-progmag-zoom-INITREC.
           INITIALIZE tmp-prg-z-rec OF tmp-progmag-zoom
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tgrupgdo-INITREC.
           INITIALIZE gdo-rec OF tgrupgdo
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tordforn-INITREC.
           INITIALIZE tof-rec OF tordforn
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-rordforn-INITREC.
           INITIALIZE rof-rec OF rordforn
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-reva-INITREC.
           INITIALIZE reva-rec OF reva
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tvettori-INITREC.
           INITIALIZE vet-rec OF tvettori
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-teva-INITREC.
           INITIALIZE teva-rec OF teva
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-brnotacr-INITREC.
           INITIALIZE brno-rec OF brnotacr
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-btnotacr-INITREC.
           INITIALIZE btno-rec OF btnotacr
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tsetinvio-INITREC.
           INITIALIZE tsi-rec OF tsetinvio
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tcontat-INITREC.
           INITIALIZE con-rec OF tcontat
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-movutf-INITREC.
           INITIALIZE mov-rec OF movutf
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tnazioni-INITREC.
           INITIALIZE naz-rec OF tnazioni
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-lineseq-mail-INITREC.
           INITIALIZE line-riga-mail OF lineseq-mail
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      *
       DataSet1-DISPATCH-BUFTOFLD.
           EVALUATE TOTEM-Form-Index ALSO TOTEM-Frame-Index
              WHEN 1 ALSO 0
                  PERFORM Form1-Buf-To-Fld
           END-EVALUATE
           .

       Form1-DISPLAY-STATUS-MSG.
            MODIFY Form1-St-1-Handle PANEL-INDEX = 1
                PANEL-TEXT = TOTEM-HINT-TEXT
           .

       Form1-CLEAR-STATUS-MSG.
           MOVE SPACES TO TOTEM-MSG-1, TOTEM-MSG-2, TOTEM-MSG-3, 
           TOTEM-MSG-TEXT
           PERFORM Form1-DISPLAY-STATUS-MSG
           .

       Form1-Open-Routine.
           PERFORM Form1-Scrn
           PERFORM Form1-Proc
           .

       Form1-Scrn.
           PERFORM Form1-Create-Win
           PERFORM Form1-Init-Value
           PERFORM Form1-Init-Data
      * Tab keystrok settings
      * Tool Bar
           DISPLAY Form1-Tb-1
           PERFORM Form1-DISPLAY
           .

       Form1-Create-Win.
           Display Independent GRAPHICAL WINDOW
              SCREEN LINE 1,
              SCREEN COLUMN 0,
              LINES 47,15,
              SIZE 158,00,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 65793,
              CONTROL FONT Small-Font,
              LABEL-OFFSET 23,
              LINK TO THREAD,
              MODELESS,
              NO SCROLL,
              TITLE-BAR,
              TITLE TITOLO,
              AUTO-MINIMIZE,
              WITH SYSTEM MENU,
              USER-GRAY,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE Form1-Event-Proc,
              HANDLE IS Form1-Handle,
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
           DISPLAY TOOL-BAR 
              LINES 2,69,   
              HANDLE IN Form1-Tb-1-Handle
           DISPLAY Form1-Tb-1 UPON Form1-Tb-1-Handle

      * Status-bar
           DISPLAY STATUS-BAR
              GRIP,
              PANEL-WIDTHS (100, 35, 999),
              PANEL-STYLE  (1, 1, 1),
              PANEL-TEXT   (SPACE, SPACE, SPACE),
              HANDLE IS Form1-St-1-Handle
           DISPLAY Form1 UPON Form1-Handle
      * DISPLAY-COLUMNS settings
              MODIFY Form1-Gd-1, DISPLAY-COLUMNS (1, 7, 14, 44, 52, 62, 
           77, 88, 97, 109, 121, 133)
           .

       Form1-PROC.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeAccept>
           perform VALORIZZA-ULT-DATA-MOVIM.
           set RicaricaGrid to false.
           perform INIT.
           perform INIT-OLD-REC.
           perform ABILITA-TOOLBAR.
           perform ABILITAZIONI.
           set StatusVisua         to true.
           set SystemErrorOccurred to false.
           perform STATUS-BAR-MSG.
           perform LEGGI-ANNO. 
           move 0 to mod-campi mod.
           move 0 to mod-k.
           move LinkChiave to tmo-chiave.
           read tmovmag no lock invalid continue end-read.
           move tmo-teva-anno to save-teva-anno.

           set movimento to true.
           perform CANCELLA-FLAG.
           perform CURRENT-RECORD.
           if tmo-teva-anno not = 0
              set evasione to true
              move tmo-teva-chiave to teva-chiave
              read teva no lock invalid continue end-read
              move teva-mag to EvaMag
           end-if.
           move MagazzinoInUso to EvaMag.
           if pgm-chiamante not = "selmovcons"
              if tmo-data-movim <= tge-data-consolid-progmag
                 set MovimentoConsolidato to true
                 move 1 to v-cons
                 move BitmapEditDisabled to BitmapNumEdit           
                 move 0 to e-modifica
                 modify tool-modifica, bitmap-number = BitmapNumEdit,
                                       enabled       = e-modifica
              end-if
           end-if.

           if evasione
              move 1 to v-evasione
              move tmo-teva-anno   to lab-anno-e-buf
              move tmo-teva-numero to lab-numero-e-buf
           else
              move 0 to v-evasione
           end-if.

           move LinkNumero to numero-edit.
           perform DISPLAY-SCREEN.
           accept data-oggi from century-date.
           move 3 to NumBitmapCodici.
           display pb-codici.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT Form1
                 ON EXCEPTION
                    PERFORM Form1-Evaluate-Func
                 MOVE 1 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterEndAccept>
           perform AFTER-END-ACCEPT

      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY Form1-Handle
           INITIALIZE Key-Status
           .

       Form1-Evaluate-Func.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterAccept>
           evaluate key-status
           when 5 |modifica
                inquire tool-modifica, enabled in e-modifica
                if e-modifica = 1
                   if mod = zero move 1 to mod
                   else          move zero to mod
                   end-if
                   modify tool-modifica, value = mod
                   perform MODIFICA
                end-if
           end-evaluate.

           .
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM Form1-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM Form1-Exit
                 END-IF
                 IF Event-Type = Cmd-Tabchanged AND 
                                 Event-Control-Id = 5000
                    MOVE EVENT-DATA-1 TO Screen1-Ta-1-TAB-VALUE
                    PERFORM Screen1-Ta-1-TABCHANGE
                 END-IF

              WHEN Key-Status = 1005
                 PERFORM pb-grid-elimina-LinkTo
              WHEN Key-Status = 1004
                 PERFORM pb-codici-LinkTo
              WHEN Key-Status = 1002
                 PERFORM pb-grid-nuovo-LinkTo
              WHEN Key-Status = 4
                 PERFORM TOOL-CANCELLA-LinkTo
              WHEN Key-Status = 3
                 PERFORM TOOL-SALVA-LinkTo
              WHEN Key-Status = 150
                 PERFORM TOOL-MODIFICA-LinkTo
              WHEN Key-Status = 8
                 PERFORM TOOL-CERCA-LinkTo
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       Form1-CLEAR.
           PERFORM Form1-INIT-VALUE
           PERFORM Form1-DISPLAY
           .

       Form1-DISPLAY.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY Form1-Tb-1
           DISPLAY Form1 UPON Form1-Handle
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterDisplay>
      * <TOTEM:END>
           .

       Form1-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeExit>
           if not SystemErrorOccurred
              perform SALV-MOD
           end-if.

           if errori
              move 26 to key-status
              exit paragraph
           end-if.

           set ArticoloSetFocus to false.

           set environment "KEYSTROKE" to "DATA=44   44".
           set environment "KEYSTROKE" to "DATA=46   46".

           .
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       Form1-Init-Data.
           MOVE 1 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
      * TAB
              MODIFY Screen1-Ta-1, RESET-TABS = 1
              MODIFY Screen1-Ta-1, 
           TAB-TO-ADD = (
                 "Sezione dati di &Testata",
                 "Sezione &Righe",
                        )
           MOVE 0 TO 
                   Form1-Pg-1-Visible,
                   Form1-Pg-2-Visible,
           MOVE 1 TO Form1-Pg-1-Visible
           PERFORM Screen1-Ta-1-TABCHANGE
      * COMBO-BOX
           PERFORM cbo-stato-Content
      * GRID
           PERFORM Form1-Gd-1-Content
           .

       Form1-DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-tmovmag-KEY1-ORDER
           END-EVALUATE
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-tmovmag-KEY1-ORDER
           END-EVALUATE
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Update-Key.
           MOVE tmo-rec OF tmovmag TO
                     Form1-MULKEY-TMPBUF
           PERFORM Form1-CLEAR
           PERFORM Form1-INIT-DATA
           MOVE Form1-MULKEY-TMPBUF TO
                     tmo-rec OF tmovmag
           PERFORM DataSet1-tmovmag-Read
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-CURR
           PERFORM Form1-IUD-Display
           .

       Form1-DUPLICATE-MOVEKEY.
           .

       Form1-First.
           PERFORM Form1-DUMMY-FIRST
           PERFORM DataSet1-tmovmag-INITSTART
           PERFORM DataSet1-tmovmag-START
           IF NOT Valid-STATUS-tmovmag
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeFirst>
      * <TOTEM:END>
           PERFORM DataSet1-tmovmag-Read-Next
           IF NOT Valid-STATUS-tmovmag
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterFirst>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY.
           PERFORM Form1-IUD-Display
           .

       Form1-Previous.
              PERFORM Form1-Buf-To-Fld
              PERFORM DataSet1-tmovmag-START-LESS
           IF NOT Valid-STATUS-tmovmag
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforePrevious>
      * <TOTEM:END>
           PERFORM DataSet1-tmovmag-Read-Prev
           IF NOT Valid-STATUS-tmovmag
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterPrevious>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-PREVIOUS
           PERFORM Form1-IUD-Display
           .

       Form1-Next.
              PERFORM Form1-Buf-To-Fld
              PERFORM DataSet1-tmovmag-START-GREATER
           IF NOT Valid-STATUS-tmovmag
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeNext>
      * <TOTEM:END>
           PERFORM DataSet1-tmovmag-Read-Next
           IF NOT Valid-STATUS-tmovmag
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterNext>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-NEXT
           PERFORM Form1-IUD-Display
           .
      
       Form1-Last.
           PERFORM Form1-DUMMY-LAST
           PERFORM DataSet1-tmovmag-INITEND
           PERFORM DataSet1-tmovmag-START-NOTGREATER
           IF NOT Valid-STATUS-tmovmag
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeLast>
      * <TOTEM:END>
           PERFORM DataSet1-tmovmag-Read-Prev
           IF NOT Valid-STATUS-tmovmag
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterLast>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY.
           PERFORM Form1-IUD-Display
           .

       Form1-Curr.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeCurrent>
      * <TOTEM:END>
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-tmovmag-Read
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-CURR
           PERFORM Form1-IUD-Display
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterCurrent>
      * <TOTEM:END>
           .

       Form1-IUD-Display.
           IF Valid-STATUS-tmovmag
              PERFORM Form1-ALLGRID-RESET
              PERFORM Form1-Fld-To-Buf
              PERFORM Form1-NAVI-FOR-MASTERGRID
              PERFORM Form1-DISPLAY
           ELSE
              IF Form1-FLAG-REFRESH
                 CONTINUE
              ELSE
                 PERFORM Form1-Extended-File-Status
              END-IF
           END-IF
           .

       Form1-Add.
           PERFORM Form1-Buf-To-Fld
           PERFORM Form1-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM Form1-DUMMY-ADD
           PERFORM DataSet1-tmovmag-INITREC
           PERFORM Form1-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeAdd>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-tmovmag-Rec-Write
           IF Valid-STATUS-tmovmag
              PERFORM Form1-RESUMMARY-INS
              PERFORM Form1-DUMMY-UPDATE-INIT
              MOVE "301" TO TOTEM-MSG-ID
              PERFORM Form1-IUD-Display
           END-IF
           PERFORM Form1-ERR-CHECKING
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterAdd>
      * <TOTEM:END>
           .
     
       Form1-Update.
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-tmovmag-START              
           IF NOT Valid-STATUS-tmovmag
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
           PERFORM DataSet1-tmovmag-Read
           PERFORM Form1-Buf-To-Fld
           PERFORM Form1-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM Form1-DUMMY-UPDATE
           PERFORM Form1-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeUpdate>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-tmovmag-Rec-Rewrite
           IF Valid-STATUS-tmovmag
              PERFORM Form1-RESUMMARY-DEL
              PERFORM Form1-DUMMY-UPDATE-INIT
              MOVE "302" TO TOTEM-MSG-ID
              PERFORM Form1-IUD-Display
           END-IF
           PERFORM Form1-ERR-CHECKING
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterUpdate>
      * <TOTEM:END>
           .

       Form1-Delete.
           MOVE "203" TO TOTEM-MSG-ID
           PERFORM MESSAGE-BOX-DISPLAY
           IF TOTEM-MSG-RETURN-VALUE NOT = 1
              INITIALIZE TOTEM-MSG-TEXT
              EXIT PARAGRAPH 
           END-IF
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDelete>
      * <TOTEM:END>
           PERFORM Form1-DUMMY-DELETE
      * delete
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-tmovmag-Rec-Delete
           IF Valid-STATUS-tmovmag
              PERFORM Form1-CLEAR
              PERFORM Form1-DUMMY-DELETE-INIT
              MOVE "303" TO TOTEM-MSG-ID
              MOVE "00" to STATUS-tmovmag
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterDelete>
      * <TOTEM:END>
           PERFORM Form1-ERR-CHECKING
           .

       Form1-NAVI-FOR-MASTERGRID.
           .

       Form1-ERR-CHECKING.
           IF Valid-STATUS-tmovmag
              PERFORM Form1-SHOW-MSG-ROUTINE
           ELSE
              PERFORM Form1-Extended-File-Status
           END-IF
           .

       Form1-RESUMMARY-INS.
           .

       Form1-RESUMMARY-DEL.
           .


       Form1-DUMMY-FIRST.
           .

       Form1-DUMMY-PREVIOUS.
           .

       Form1-DUMMY-NEXT.
           .

       Form1-DUMMY-LAST.
           .

       Form1-DUMMY-CURR.
           .

       Form1-DUMMY-ADD.
           .

       Form1-DUMMY-UPDATE.
           .

       Form1-DUMMY-UPDATE-INIT.
           .

       Form1-DUMMY-DELETE.
           .

       Form1-DUMMY-DELETE-INIT.
           .

       Form1-Init-Value.
           MOVE TITOLO TO TOTEM-MSG-TITLE
           INITIALIZE Form1-BUF
      * FORM : Form1
           PERFORM DataSet1-INIT-RECORD
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, SetDefault>
      * <TOTEM:END>
           PERFORM Form1-FLD-TO-BUF
           .


       Form1-ALLGRID-RESET.
           .

      * for Form's Validation
       Form1-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
      * ef-data's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-data-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 1 TO Screen1-Ta-1-TAB-VALUE
               PERFORM Screen1-Ta-1-TABCHANGE
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5001 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-causale's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-causale-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 1 TO Screen1-Ta-1-TAB-VALUE
               PERFORM Screen1-Ta-1-TABCHANGE
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5002 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-clifor's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-clifor-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 1 TO Screen1-Ta-1-TAB-VALUE
               PERFORM Screen1-Ta-1-TABCHANGE
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5003 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-destino's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-destino-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 1 TO Screen1-Ta-1-TAB-VALUE
               PERFORM Screen1-Ta-1-TABCHANGE
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5004 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-vettore's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-vettore-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 1 TO Screen1-Ta-1-TAB-VALUE
               PERFORM Screen1-Ta-1-TABCHANGE
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5005 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-num's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-num-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 1 TO Screen1-Ta-1-TAB-VALUE
               PERFORM Screen1-Ta-1-TABCHANGE
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5006 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-data-doc's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-data-doc-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 1 TO Screen1-Ta-1-TAB-VALUE
               PERFORM Screen1-Ta-1-TABCHANGE
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5007 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-via's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-via-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 1 TO Screen1-Ta-1-TAB-VALUE
               PERFORM Screen1-Ta-1-TABCHANGE
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5008 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-data-via's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-data-via-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 1 TO Screen1-Ta-1-TAB-VALUE
               PERFORM Screen1-Ta-1-TABCHANGE
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5009 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-pag's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-pag-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 1 TO Screen1-Ta-1-TAB-VALUE
               PERFORM Screen1-Ta-1-TABCHANGE
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5010 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-mag's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-mag-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 1 TO Screen1-Ta-1-TAB-VALUE
               PERFORM Screen1-Ta-1-TABCHANGE
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5011 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-art's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-art-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 2 TO Screen1-Ta-1-TAB-VALUE
               PERFORM Screen1-Ta-1-TABCHANGE
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5013 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-qta's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-qta-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 2 TO Screen1-Ta-1-TAB-VALUE
               PERFORM Screen1-Ta-1-TABCHANGE
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5014 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-listino's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-listino-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 2 TO Screen1-Ta-1-TAB-VALUE
               PERFORM Screen1-Ta-1-TABCHANGE
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5015 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-sconto's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-sconto-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 2 TO Screen1-Ta-1-TAB-VALUE
               PERFORM Screen1-Ta-1-TABCHANGE
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5016 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-cons's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-cons-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 2 TO Screen1-Ta-1-TAB-VALUE
               PERFORM Screen1-Ta-1-TABCHANGE
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5017 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-coubat's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-coubat-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 2 TO Screen1-Ta-1-TAB-VALUE
               PERFORM Screen1-Ta-1-TABCHANGE
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5018 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-imp-merce's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-imp-merce-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 2 TO Screen1-Ta-1-TAB-VALUE
               PERFORM Screen1-Ta-1-TABCHANGE
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 24 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
           .

       ef-data-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-data, BeforeValidation>
      * <TOTEM:END>
           .

       ef-data-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-data, AfterValidation>
      * <TOTEM:END>
           .

      * ef-data's Validation
       ef-data-VALIDATION.
           PERFORM ef-data-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-data-AFTER-VALIDATION
           .

       ef-causale-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-causale, BeforeValidation>
      * <TOTEM:END>
           .

       ef-causale-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-causale, AfterValidation>
      * <TOTEM:END>
           .

      * ef-causale's Validation
       ef-causale-VALIDATION.
           PERFORM ef-causale-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-causale-AFTER-VALIDATION
           .

       ef-clifor-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-clifor, BeforeValidation>
      * <TOTEM:END>
           .

       ef-clifor-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-clifor, AfterValidation>
      * <TOTEM:END>
           .

      * ef-clifor's Validation
       ef-clifor-VALIDATION.
           PERFORM ef-clifor-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-clifor-AFTER-VALIDATION
           .

       ef-destino-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-destino, BeforeValidation>
      * <TOTEM:END>
           .

       ef-destino-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-destino, AfterValidation>
      * <TOTEM:END>
           .

      * ef-destino's Validation
       ef-destino-VALIDATION.
           PERFORM ef-destino-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-destino-AFTER-VALIDATION
           .

       ef-vettore-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-vettore, BeforeValidation>
      * <TOTEM:END>
           .

       ef-vettore-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-vettore, AfterValidation>
      * <TOTEM:END>
           .

      * ef-vettore's Validation
       ef-vettore-VALIDATION.
           PERFORM ef-vettore-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-vettore-AFTER-VALIDATION
           .

       ef-num-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-num, BeforeValidation>
      * <TOTEM:END>
           .

       ef-num-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-num, AfterValidation>
      * <TOTEM:END>
           .

      * ef-num's Validation
       ef-num-VALIDATION.
           PERFORM ef-num-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-num-AFTER-VALIDATION
           .

       ef-data-doc-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-data-doc, BeforeValidation>
      * <TOTEM:END>
           .

       ef-data-doc-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-data-doc, AfterValidation>
      * <TOTEM:END>
           .

      * ef-data-doc's Validation
       ef-data-doc-VALIDATION.
           PERFORM ef-data-doc-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-data-doc-AFTER-VALIDATION
           .

       ef-via-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-via, BeforeValidation>
      * <TOTEM:END>
           .

       ef-via-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-via, AfterValidation>
      * <TOTEM:END>
           .

      * ef-via's Validation
       ef-via-VALIDATION.
           PERFORM ef-via-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-via-AFTER-VALIDATION
           .

       ef-data-via-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-data-via, BeforeValidation>
      * <TOTEM:END>
           .

       ef-data-via-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-data-via, AfterValidation>
      * <TOTEM:END>
           .

      * ef-data-via's Validation
       ef-data-via-VALIDATION.
           PERFORM ef-data-via-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-data-via-AFTER-VALIDATION
           .

       ef-pag-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-pag, BeforeValidation>
      * <TOTEM:END>
           .

       ef-pag-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-pag, AfterValidation>
      * <TOTEM:END>
           .

      * ef-pag's Validation
       ef-pag-VALIDATION.
           PERFORM ef-pag-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-pag-AFTER-VALIDATION
           .

       ef-mag-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-mag, BeforeValidation>
      * <TOTEM:END>
           .

       ef-mag-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-mag, AfterValidation>
      * <TOTEM:END>
           .

      * ef-mag's Validation
       ef-mag-VALIDATION.
           PERFORM ef-mag-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-mag-AFTER-VALIDATION
           .

       ef-art-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-art, BeforeValidation>
      * <TOTEM:END>
           .

       ef-art-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-art, AfterValidation>
      * <TOTEM:END>
           .

      * ef-art's Validation
       ef-art-VALIDATION.
           PERFORM ef-art-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-art-AFTER-VALIDATION
           .

       ef-qta-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-qta, BeforeValidation>
      * <TOTEM:END>
           .

       ef-qta-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-qta, AfterValidation>
      * <TOTEM:END>
           .

      * ef-qta's Validation
       ef-qta-VALIDATION.
           PERFORM ef-qta-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-qta-AFTER-VALIDATION
           .

       ef-listino-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-listino, BeforeValidation>
      * <TOTEM:END>
           .

       ef-listino-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-listino, AfterValidation>
      * <TOTEM:END>
           .

      * ef-listino's Validation
       ef-listino-VALIDATION.
           PERFORM ef-listino-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-listino-AFTER-VALIDATION
           .

       ef-sconto-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-sconto, BeforeValidation>
      * <TOTEM:END>
           .

       ef-sconto-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-sconto, AfterValidation>
      * <TOTEM:END>
           .

      * ef-sconto's Validation
       ef-sconto-VALIDATION.
           PERFORM ef-sconto-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-sconto-AFTER-VALIDATION
           .

       ef-cons-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-cons, BeforeValidation>
      * <TOTEM:END>
           .

       ef-cons-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-cons, AfterValidation>
      * <TOTEM:END>
           .

      * ef-cons's Validation
       ef-cons-VALIDATION.
           PERFORM ef-cons-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-cons-AFTER-VALIDATION
           .

       ef-coubat-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-coubat, BeforeValidation>
      * <TOTEM:END>
           .

       ef-coubat-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-coubat, AfterValidation>
      * <TOTEM:END>
           .

      * ef-coubat's Validation
       ef-coubat-VALIDATION.
           PERFORM ef-coubat-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-coubat-AFTER-VALIDATION
           .

       ef-imp-merce-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-imp-merce, BeforeValidation>
      * <TOTEM:END>
           .

       ef-imp-merce-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-imp-merce, AfterValidation>
      * <TOTEM:END>
           .

      * ef-imp-merce's Validation
       ef-imp-merce-VALIDATION.
           PERFORM ef-imp-merce-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-imp-merce-AFTER-VALIDATION
           .


       Form1-Buf-To-Fld.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeBufToFld>
      * <TOTEM:END>
      * DB_Entry-Field : ef-data
           MOVE ef-data-BUF TO tmo-data-movim
      * DB_Entry-Field : ef-causale
           MOVE ef-causale-BUF TO tmo-causale
      * DB_Entry-Field : ef-clifor
           MOVE ef-clifor-BUF TO tmo-cod-clifor
      * DB_Entry-Field : ef-destino
           MOVE ef-destino-BUF TO tmo-destino
      * DB_Entry-Field : ef-vettore
           MOVE ef-vettore-BUF TO tmo-vettore
      * DB_Entry-Field : ef-num
           MOVE ef-num-BUF TO tmo-numdoc-clifor
      * DB_Entry-Field : ef-data-doc
           MOVE ef-data-doc-BUF TO tmo-data-doc
      * DB_Entry-Field : ef-via
           MOVE ef-via-BUF TO tmo-num-via
      * DB_Entry-Field : ef-data-via
           MOVE ef-data-via-BUF TO tmo-dt-via
      * DB_Entry-Field : ef-pag
           MOVE ef-pag-BUF TO tmo-codpag
      * DB_Entry-Field : ef-mag
           MOVE ef-mag-BUF TO tmo-codmag
      * DB_Entry-Field : ef-art
           MOVE ef-art-BUF TO rmo-articolo
      * DB_Entry-Field : ef-qta
           MOVE ef-qta-BUF TO rmo-qta
      * DB_Entry-Field : ef-listino
           MOVE ef-listino-BUF TO rmo-listino
      * DB_Entry-Field : ef-sconto
           MOVE ef-sconto-BUF TO rmo-sconto
      * DB_Entry-Field : ef-cons
           MOVE ef-cons-BUF TO rmo-imp-cons
      * DB_Entry-Field : ef-coubat
           MOVE ef-coubat-BUF TO rmo-coubat
      * DB_Entry-Field : ef-imp-merce
           MOVE ef-imp-merce-BUF TO rmo-netto
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterBufToFld>
           perform AFTER-BUF-TO-FLD.

           .
      * <TOTEM:END>
           .

       Form1-Fld-To-Buf.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeFldToBuf>
      * <TOTEM:END>
      * DB_Entry-Field : ef-data
           MOVE tmo-data-movim TO ef-data-BUF
      * DB_Entry-Field : ef-causale
           MOVE tmo-causale TO ef-causale-BUF
      * DB_Entry-Field : ef-clifor
           MOVE tmo-cod-clifor TO ef-clifor-BUF
      * DB_Entry-Field : ef-destino
           MOVE tmo-destino TO ef-destino-BUF
      * DB_Entry-Field : ef-vettore
           MOVE tmo-vettore TO ef-vettore-BUF
      * DB_Entry-Field : ef-num
           MOVE tmo-numdoc-clifor TO ef-num-BUF
      * DB_Entry-Field : ef-data-doc
           MOVE tmo-data-doc TO ef-data-doc-BUF
      * DB_Entry-Field : ef-via
           MOVE tmo-num-via TO ef-via-BUF
      * DB_Entry-Field : ef-data-via
           MOVE tmo-dt-via TO ef-data-via-BUF
      * DB_Entry-Field : ef-pag
           MOVE tmo-codpag TO ef-pag-BUF
      * DB_Entry-Field : ef-mag
           MOVE tmo-codmag TO ef-mag-BUF
      * DB_LABEL : lab-causale
              MOVE tca-descrizione  TO lab-causale-BUF
      * DB_LABEL : lab-cli
              MOVE cli-ragsoc-1  TO lab-cli-BUF
      * DB_LABEL : lab-mag
              MOVE mag-descrizione  TO lab-mag-BUF
      * DB_LABEL : lab-destino
              MOVE des-ragsoc-1 OF destini  TO lab-destino-BUF
      * DB_LABEL : lab-vettore
              MOVE vet-descrizione  TO lab-vettore-BUF
      * DB_Entry-Field : ef-art
           MOVE rmo-articolo TO ef-art-BUF
      * DB_Entry-Field : ef-qta
           MOVE rmo-qta TO ef-qta-BUF
      * DB_Entry-Field : ef-listino
           MOVE rmo-listino TO ef-listino-BUF
      * DB_Entry-Field : ef-sconto
           MOVE rmo-sconto TO ef-sconto-BUF
      * DB_Entry-Field : ef-cons
           MOVE rmo-imp-cons TO ef-cons-BUF
      * DB_Entry-Field : ef-coubat
           MOVE rmo-coubat TO ef-coubat-BUF
      * DB_LABEL : lab-desart
              MOVE art-descrizione  TO lab-desart-BUF
      * DB_LABEL : lab-udm
              MOVE art-unita-di-misura  TO lab-udm-BUF
      * DB_LABEL : lab-imb
              MOVE prg-tipo-imballo  TO lab-imb-BUF
      * DB_LABEL : lab-desimb
              MOVE imb-descrizione  TO lab-desimb-BUF
      * DB_LABEL : lab-peso-udm
              MOVE art-peso-standard  TO lab-peso-udm-BUF
      * DB_Entry-Field : ef-imp-merce
           MOVE rmo-netto TO ef-imp-merce-BUF
      * DB_LABEL : lab-peso-utf
              MOVE tmo-peso-utf  TO lab-peso-utf-BUF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterFldToBuf>
      *
           perform VALORIZZA-OLD.
      *
           move tmo-cod-clifor to  codice-ed.
           move codice-ed      to  ef-clifor-buf.
           call "C$JUSTIFY" using ef-clifor-buf, "L".
           display ef-clifor.

           move tmo-destino to  codice-ed.
           move codice-ed   to  ef-destino-buf.
           call "C$JUSTIFY" using ef-destino-buf, "L".
           display ef-destino.

           move tmo-data-movim to como-data.
           perform DATE-TO-SCREEN.
           move como-data to ef-data-buf lab-data-buf.

           initialize lab-anno-buf.
           string "Anno del movimento " delimited size
                  tmo-anno              delimited size
                  into lab-anno-buf
           end-string.

           move tmo-data-doc to como-data.
           perform DATE-TO-SCREEN.
           move como-data to ef-data-doc-buf.

           move tmo-data-doc to como-data.
           perform DATE-TO-SCREEN.
           move como-data to ef-data-doc-buf.

           move tmo-dt-via   to como-data.
           perform DATE-TO-SCREEN.
           move como-data    to ef-data-via-buf.

           move tmo-causale to lab-cau-buf.

           move tmo-codmag  to lab-codmag-buf.

           move tmo-stato to stato.
           perform CARICA-COMBO-STATO.
           evaluate true
           when attivo    move 1 to mod-campi
                          move 1 to NumBitmapCodici
           when bloccato  move 1 to mod-campi
                          move 1 to NumBitmapCodici
           when disattivo move 0 to mod-campi
                          move 3 to NumBitmapCodici
           end-evaluate.
           display pb-codici.

           perform ABILITAZIONI.

           .
      * <TOTEM:END>
           .

       Form1-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform Form1-BUF-TO-FLD.
           move 0 to scelta.
           if tmo-data-movim not = old-tmo-data-movim
              and SiSalvato
              set NoSalvato to true
              |78-ID-ef-data è l'ID del campo ef-data
              move 78-ID-ef-data to store-id 
           end-if

           if tmo-causale not = old-tmo-causale
              and SiSalvato
              set NoSalvato to true
              |78-ID-ef-causale è l'ID del campo ef-causale
              move 78-ID-ef-causale to store-id 
           end-if

           if tmo-cod-clifor not = old-tmo-cod-clifor
              and SiSalvato
              set NoSalvato to true
              |78-ID-ef-clifor è l'ID del campo ef-clifor
              move 78-ID-ef-clifor to store-id 
           end-if

           if tmo-destino not = old-tmo-destino
              and SiSalvato
              set NoSalvato to true
              |78-ID-ef-destino è l'ID del campo ef-destino
              move 78-ID-ef-destino to store-id 
           end-if

           if tmo-vettore not = old-tmo-vettore
              and SiSalvato
              set NoSalvato to true
              |78-ID-ef-vettore è l'ID del campo ef-vettore
              move 78-ID-ef-vettore to store-id 
           end-if

           if tmo-numdoc-clifor not = old-tmo-numdoc-clifor
              and SiSalvato
              set NoSalvato to true
              |78-ID-ef-num è l'ID del campo ef-num
              move 78-ID-ef-num to store-id 
           end-if

           if tmo-data-doc not = old-tmo-data-doc
              and SiSalvato
              set NoSalvato to true
              |78-ID-ef-data-doc è l'ID del campo ef-data-doc
              move 78-ID-ef-data-doc to store-id 
           end-if

           if tmo-num-via not = old-tmo-num-via
              and SiSalvato
              set NoSalvato to true
              |78-ID-ef-via è l'ID del campo ef-via
              move 78-ID-ef-via to store-id 
           end-if

           if tmo-dt-via not = old-tmo-dt-via
              and SiSalvato
              set NoSalvato to true
              |78-ID-ef-data-via è l'ID del campo ef-data-via
              move 78-ID-ef-data-via to store-id 
           end-if

           if tmo-codpag not = old-tmo-codpag
              and SiSalvato
              set NoSalvato to true
              |78-ID-ef-pag è l'ID del campo ef-pag
              move 78-ID-ef-pag to store-id 
           end-if

           if tmo-codmag not = old-tmo-codmag
              and SiSalvato
              set NoSalvato to true
              |78-ID-ef-mag è l'ID del campo ef-mag
              move 78-ID-ef-mag to store-id 
           end-if

           if tmo-stato not = old-tmo-stato
              and SiSalvato
              set NoSalvato to true
              |78-ID-cbo-stato è l'ID del campo cbo-stato
              move 78-ID-cbo-stato to store-id 
           end-if

           .
       Form1-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM Form1-SHOW-MSG-ROUTINE
           .

       Form1-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM Form1-DISPLAY-MESSAGE
           .

       Form1-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       Form1-Save-Status.
           MOVE DataSet1-tmovmag-KEY1-ORDER TO TMP-Form1-KEY1-ORDER
           MOVE DataSet1-KEYIS TO TMP-Form1-KEYIS
           MOVE tmo-rec OF tmovmag TO 
              TMP-Form1-tmovmag-RESTOREBUF
           .             

       Form1-Restore-Status.
           MOVE TMP-Form1-KEY1-ORDER TO DataSet1-tmovmag-KEY1-ORDER
           MOVE TMP-Form1-KEYIS TO DataSet1-KEYIS
           MOVE TMP-Form1-tmovmag-RESTOREBUF TO
              tmo-rec OF tmovmag
           PERFORM DataSet1-tmovmag-START
           IF Valid-STATUS-tmovmag
              PERFORM DataSet1-tmovmag-Read-Next
           ELSE
              PERFORM DataSet1-tmovmag-INITREC
           END-IF
           PERFORM UNTIL NOT Valid-STATUS-tmovmag OR
              (Valid-STATUS-tmovmag AND
                 tmo-rec OF tmovmag = 
                   TMP-Form1-tmovmag-RESTOREBUF)
              PERFORM DataSet1-tmovmag-Read-Next
           END-PERFORM
           .


      * Paragrafo per la struttura del codice in BEFORE sulla screen Form1
      ***---
       Form1-BEFORE-SCREEN.
           evaluate control-id
           |78-ID-ef-causale è l'ID del campo ef-causale
           when 78-ID-ef-causale
                move 1 to StatusHelp
                perform STATUS-HELP
           |78-ID-ef-clifor è l'ID del campo ef-clifor
           when 78-ID-ef-clifor
                move 1 to StatusHelp
                perform STATUS-HELP
           |78-ID-ef-destino è l'ID del campo ef-destino
           when 78-ID-ef-destino
                move 1 to StatusHelp
                perform STATUS-HELP
           |78-ID-ef-vettore è l'ID del campo ef-vettore
           when 78-ID-ef-vettore
                move 1 to StatusHelp
                perform STATUS-HELP
           |78-ID-ef-pag è l'ID del campo ef-pag
           when 78-ID-ef-pag
                move 1 to StatusHelp
                perform STATUS-HELP
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella BEFORE della screen
           when 99999 continue
           when other continue
           end-evaluate.

      * Generazione settaggio keyboard "." ---> ","
           evaluate control-id
           |78-ID-ef-listino è l'ID del campo ef-listino
           when 78-ID-ef-listino
                if  KeyboardReleased
                   set KeyboardSaved to true
      *            sostituisco il punto come virgola
                   set environment "KEYSTROKE" to "DATA=44 46"
                end-if
           |78-ID-ef-sconto è l'ID del campo ef-sconto
           when 78-ID-ef-sconto
                if  KeyboardReleased
                   set KeyboardSaved to true
      *            sostituisco il punto come virgola
                   set environment "KEYSTROKE" to "DATA=44 46"
                end-if
           |78-ID-ef-cons è l'ID del campo ef-cons
           when 78-ID-ef-cons
                if  KeyboardReleased
                   set KeyboardSaved to true
      *            sostituisco il punto come virgola
                   set environment "KEYSTROKE" to "DATA=44 46"
                end-if
           |78-ID-ef-coubat è l'ID del campo ef-coubat
           when 78-ID-ef-coubat
                if  KeyboardReleased
                   set KeyboardSaved to true
      *            sostituisco il punto come virgola
                   set environment "KEYSTROKE" to "DATA=44 46"
                end-if
           |24 è l'ID del campo ef-imp-merce
           when 24
                if  KeyboardReleased
                   set KeyboardSaved to true
      *            sostituisco il punto come virgola
                   set environment "KEYSTROKE" to "DATA=44 46"
                end-if
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella BEFORE della screen
           when 99999 continue
           when other continue
           end-evaluate.

      * Paragrafo per la struttura del codice in AFTER sulla screen Form1
      ***---
       Form1-AFTER-SCREEN.
           evaluate control-id
           |78-ID-ef-causale è l'ID del campo ef-causale
           when 78-ID-ef-causale
                move 0 to StatusHelp
                perform STATUS-HELP

           |78-ID-ef-clifor è l'ID del campo ef-clifor
           when 78-ID-ef-clifor
                move 0 to StatusHelp
                perform STATUS-HELP

           |78-ID-ef-destino è l'ID del campo ef-destino
           when 78-ID-ef-destino
                move 0 to StatusHelp
                perform STATUS-HELP

           |78-ID-ef-vettore è l'ID del campo ef-vettore
           when 78-ID-ef-vettore
                move 0 to StatusHelp
                perform STATUS-HELP

           |78-ID-ef-pag è l'ID del campo ef-pag
           when 78-ID-ef-pag
                move 0 to StatusHelp
                perform STATUS-HELP

           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER della screen
           when 99999 continue
           when other continue
           end-evaluate.

      * Generazione risettaggio keyboard "." ---> "."
           evaluate control-id
           |78-ID-ef-listino è l'ID del campo ef-listino
           when 78-ID-ef-listino
                if  KeyboardSaved
                   set KeyboardReleased to true
      *            setto la tastiera originale (PUNTO come PUNTO, VIROGLA come VIRGOLA)
                   set environment "KEYSTROKE" to "DATA=44   44"
                   set environment "KEYSTROKE" to "DATA=46   46"
                end-if

           |78-ID-ef-sconto è l'ID del campo ef-sconto
           when 78-ID-ef-sconto
                if  KeyboardSaved
                   set KeyboardReleased to true
      *            setto la tastiera originale (PUNTO come PUNTO, VIROGLA come VIRGOLA)
                   set environment "KEYSTROKE" to "DATA=44   44"
                   set environment "KEYSTROKE" to "DATA=46   46"
                end-if

           |78-ID-ef-cons è l'ID del campo ef-cons
           when 78-ID-ef-cons
                if  KeyboardSaved
                   set KeyboardReleased to true
      *            setto la tastiera originale (PUNTO come PUNTO, VIROGLA come VIRGOLA)
                   set environment "KEYSTROKE" to "DATA=44   44"
                   set environment "KEYSTROKE" to "DATA=46   46"
                end-if

           |78-ID-ef-coubat è l'ID del campo ef-coubat
           when 78-ID-ef-coubat
                if  KeyboardSaved
                   set KeyboardReleased to true
      *            setto la tastiera originale (PUNTO come PUNTO, VIROGLA come VIRGOLA)
                   set environment "KEYSTROKE" to "DATA=44   44"
                   set environment "KEYSTROKE" to "DATA=46   46"
                end-if

           |24 è l'ID del campo ef-imp-merce
           when 24
                if  KeyboardSaved
                   set KeyboardReleased to true
      *            setto la tastiera originale (PUNTO come PUNTO, VIROGLA come VIRGOLA)
                   set environment "KEYSTROKE" to "DATA=44   44"
                   set environment "KEYSTROKE" to "DATA=46   46"
                end-if

           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella BEFORE della screen
           when 99999 continue
           when other continue
           end-evaluate.

      * Generazione stringa perform CONTROLLO
           evaluate control-id
           |78-ID-ef-data è l'ID del campo ef-data
           when 78-ID-ef-data
                perform CONTROLLO
           |78-ID-ef-causale è l'ID del campo ef-causale
           when 78-ID-ef-causale
                perform CONTROLLO
           |78-ID-ef-clifor è l'ID del campo ef-clifor
           when 78-ID-ef-clifor
                perform CONTROLLO
           |78-ID-ef-destino è l'ID del campo ef-destino
           when 78-ID-ef-destino
                perform CONTROLLO
           |78-ID-ef-vettore è l'ID del campo ef-vettore
           when 78-ID-ef-vettore
                perform CONTROLLO
           |78-ID-ef-num è l'ID del campo ef-num
           when 78-ID-ef-num
                perform CONTROLLO
           |78-ID-ef-data-doc è l'ID del campo ef-data-doc
           when 78-ID-ef-data-doc
                perform CONTROLLO
           |78-ID-ef-via è l'ID del campo ef-via
           when 78-ID-ef-via
                perform CONTROLLO
           |78-ID-ef-data-via è l'ID del campo ef-data-via
           when 78-ID-ef-data-via
                perform CONTROLLO
           |78-ID-ef-pag è l'ID del campo ef-pag
           when 78-ID-ef-pag
                perform CONTROLLO
           |78-ID-ef-mag è l'ID del campo ef-mag
           when 78-ID-ef-mag
                perform CONTROLLO
           |78-ID-cbo-stato è l'ID del campo cbo-stato
           when 78-ID-cbo-stato
                perform CONTROLLO
           |78-ID-ef-art è l'ID del campo ef-art
           when 78-ID-ef-art
                perform CONTROLLO
           |78-ID-ef-qta è l'ID del campo ef-qta
           when 78-ID-ef-qta
                perform CONTROLLO
           |78-ID-ef-listino è l'ID del campo ef-listino
           when 78-ID-ef-listino
                perform CONTROLLO
           |78-ID-ef-sconto è l'ID del campo ef-sconto
           when 78-ID-ef-sconto
                perform CONTROLLO
           |78-ID-ef-cons è l'ID del campo ef-cons
           when 78-ID-ef-cons
                perform CONTROLLO
           |78-ID-ef-coubat è l'ID del campo ef-coubat
           when 78-ID-ef-coubat
                perform CONTROLLO
           |24 è l'ID del campo ef-imp-merce
           when 24
                perform CONTROLLO
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER CONTROLLO della screen
           when 99999 continue
           when other continue
           end-evaluate.

       Form2-Open-Routine.
           PERFORM Form2-Scrn
           PERFORM Form2-Proc
           .

       Form2-Scrn.
           PERFORM Form2-Create-Win
           PERFORM Form2-Init-Value
           PERFORM Form2-Init-Data
      * Tab keystrok settings
      * Tool Bar
           PERFORM Form2-DISPLAY
           .

       Form2-Create-Win.
           Display Floating GRAPHICAL WINDOW
              LINES 13,39,
              SIZE 41,10,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 65793,
              CONTROL FONT Verdana12-Occidentale,
              NO SCROLL,
              TITLE-BAR,
              TITLE titolo,
              WITH SYSTEM MENU,
              USER-GRAY,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE Screen1-Event-Proc,
              HANDLE IS Screen1-Handle,
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
      * Status-bar
           DISPLAY Form2 UPON Screen1-Handle
      * DISPLAY-COLUMNS settings
           .

       Form2-PROC.
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeAccept>
           move link-peso-tot to lab-tot-righe-buf.
           move tmo-peso-utf  to ef-definitivo-buf lab-testa-buf.
           display form2.
           move 78-ID-ef-definitivo to control-id.
           move 4 to accept-control.
           set environment "KEYSTROKE" to "DATA=44 46"

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT Form2
                 ON EXCEPTION
                    PERFORM Form2-Evaluate-Func
                 MOVE 2 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY Screen1-Handle
           INITIALIZE Key-Status
           .

       Form2-Evaluate-Func.
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM Form2-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM Form2-Exit
                 END-IF
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       Form2-CLEAR.
           PERFORM Form2-INIT-VALUE
           PERFORM Form2-DISPLAY
           .

       Form2-DISPLAY.
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY Form2 UPON Screen1-Handle
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterDisplay>
      * <TOTEM:END>
           .

       Form2-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeExit>
           set environment "KEYSTROKE" to "DATA=46 44"

           .
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       Form2-Init-Data.
           MOVE 2 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
           .

       Form2-Init-Value.
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, SetDefault>
      * <TOTEM:END>
           PERFORM Form2-FLD-TO-BUF
           .


       Form2-ALLGRID-RESET.
           .

      * for Form's Validation
       Form2-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       Form2-Buf-To-Fld.
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterBufToFld>
      * <TOTEM:END>
           .

       Form2-Fld-To-Buf.
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, BeforeFldToBuf>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:Form2, FORM:Form2, AfterFldToBuf>
      * <TOTEM:END>
           .

       Form2-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform Form2-BUF-TO-FLD.
           move 0 to scelta.
           .
       Form2-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM Form2-SHOW-MSG-ROUTINE
           .

       Form2-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM Form2-DISPLAY-MESSAGE
           .

       Form2-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       Form2-Save-Status.
           .             

       Form2-Restore-Status.
           .


      * Paragrafo per la struttura del codice in BEFORE sulla screen Form2
      ***---
       Form2-BEFORE-SCREEN.
           evaluate control-id
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella BEFORE della screen
           when 99999 continue
           when other continue
           end-evaluate.

      * Generazione settaggio keyboard "." ---> ","
           evaluate control-id
           |78-ID-ef-definitivo è l'ID del campo ef-definitivo
           when 78-ID-ef-definitivo
                if  KeyboardReleased
                   set KeyboardSaved to true
      *            sostituisco il punto come virgola
                   set environment "KEYSTROKE" to "DATA=44 46"
                end-if
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella BEFORE della screen
           when 99999 continue
           when other continue
           end-evaluate.

      * Paragrafo per la struttura del codice in AFTER sulla screen Form2
      ***---
       Form2-AFTER-SCREEN.
           evaluate control-id
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER della screen
           when 99999 continue
           when other continue
           end-evaluate.

      * Generazione risettaggio keyboard "." ---> "."
           evaluate control-id
           |78-ID-ef-definitivo è l'ID del campo ef-definitivo
           when 78-ID-ef-definitivo
                if  KeyboardSaved
                   set KeyboardReleased to true
      *            setto la tastiera originale (PUNTO come PUNTO, VIROGLA come VIRGOLA)
                   set environment "KEYSTROKE" to "DATA=44   44"
                   set environment "KEYSTROKE" to "DATA=46   46"
                end-if

           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella BEFORE della screen
           when 99999 continue
           when other continue
           end-evaluate.

      * Generazione stringa perform CONTROLLO
           evaluate control-id
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER CONTROLLO della screen
           when 99999 continue
           when other continue
           end-evaluate.



       Screen1-Ta-1-TABCHANGE.
           MOVE 0 TO 
                   Form1-Pg-1-Visible,
                   Form1-Pg-2-Visible,
           EVALUATE Screen1-Ta-1-TAB-VALUE
           WHEN 1
                  MOVE 1 TO Form1-Pg-1-Visible
                  MODIFY Screen1-Ta-1, VALUE = 1
           WHEN 2
                  MOVE 1 TO Form1-Pg-2-Visible
                  MODIFY Screen1-Ta-1, VALUE = 2
           END-EVALUATE
           MOVE 5000 TO CONTROL-ID
           DISPLAY Form1
           .

       Form1-BeforeProcedure.
           EVALUATE Control-Id
           WHEN 5001 MOVE "Digitare la data di movimento" to 
           TOTEM-HINT-TEXT
           WHEN 5002 MOVE "Digitare la causale di magazzino" to 
           TOTEM-HINT-TEXT
           WHEN 5003 MOVE "Digitare il codice del fornitore - cliente" 
           to TOTEM-HINT-TEXT
           WHEN 5004 MOVE "Digitare il progressivo del destino" to 
           TOTEM-HINT-TEXT
           WHEN 5005 MOVE "Digitare il codice del Vettore" to 
           TOTEM-HINT-TEXT
           WHEN 5006 MOVE "Digitare il numero del documento" to 
           TOTEM-HINT-TEXT
           WHEN 5007 MOVE "Digitare la data del documento" to 
           TOTEM-HINT-TEXT
           WHEN 5008 MOVE "Digitare il numero VIA" to TOTEM-HINT-TEXT
           WHEN 5009 MOVE "Digitare la data del documento" to 
           TOTEM-HINT-TEXT
           WHEN 5010 MOVE "Digitare il codice di pagamento" to 
           TOTEM-HINT-TEXT
           WHEN 5011 MOVE "Digitare il codice del magazzino" to 
           TOTEM-HINT-TEXT
           WHEN 5012 MOVE "Selezionare uno stato" to TOTEM-HINT-TEXT
           WHEN 5013 MOVE "Digitare il codice dell'articolo" to 
           TOTEM-HINT-TEXT
           WHEN 5014 MOVE "Digitare la quantit" to TOTEM-HINT-TEXT
           WHEN 5015 MOVE "Digitare il listino" to TOTEM-HINT-TEXT
           WHEN 5016 MOVE "Digitare la percentuale di sconto" to 
           TOTEM-HINT-TEXT
           WHEN 5017 MOVE "Digitare il valore dell'imposta di consumo" 
           to TOTEM-HINT-TEXT
           WHEN 5018 MOVE "Digitare il valore dell'imposta COU/COBAT" 
           to TOTEM-HINT-TEXT
           WHEN 24 MOVE "Digitare il listino" to TOTEM-HINT-TEXT
           WHEN OTHER MOVE SPACES TO TOTEM-HINT-TEXT
           END-EVALUATE
           EVALUATE Control-Id
           When 5001 PERFORM ef-data-BeforeProcedure
           When 5002 PERFORM ef-causale-BeforeProcedure
           When 5003 PERFORM ef-clifor-BeforeProcedure
           When 5004 PERFORM ef-destino-BeforeProcedure
           When 5005 PERFORM ef-destino-BeforeProcedure
           When 5006 PERFORM ef-num-BeforeProcedure
           When 5007 PERFORM ef-data-doc-BeforeProcedure
           When 5008 PERFORM ef-num-BeforeProcedure
           When 5009 PERFORM ef-data-doc-BeforeProcedure
           When 5010 PERFORM ef-pag-BeforeProcedure
           When 5011 PERFORM ef-mag-BeforeProcedure
           When 5012 PERFORM cbo-stato-BeforeProcedure
           When 5013 PERFORM ef-art-BeforeProcedure
           When 5014 PERFORM ef-qta-BeforeProcedure
           When 5015 PERFORM ef-listino-BeforeProcedure
           When 5016 PERFORM ef-sconto-BeforeProcedure
           When 5017 PERFORM ef-cons-BeforeProcedure
           When 5018 PERFORM ef-coubat-BeforeProcedure
           When 24 PERFORM ef-listino-BeforeProcedure
           END-EVALUATE
           PERFORM Form1-DISPLAY-STATUS-MSG
           perform Form1-BEFORE-SCREEN
           .

       Form1-AfterProcedure.
           EVALUATE Control-Id
           When 5001 PERFORM ef-data-AfterProcedure
           When 5002 PERFORM ef-causale-AfterProcedure
           When 5003 PERFORM ef-clifor-AfterProcedure
           When 5004 PERFORM ef-destino-AfterProcedure
           When 5005 PERFORM ef-destino-AfterProcedure
           When 5006 PERFORM ef-num-AfterProcedure
           When 5007 PERFORM ef-data-doc-AfterProcedure
           When 5008 PERFORM ef-num-AfterProcedure
           When 5009 PERFORM ef-data-doc-AfterProcedure
           When 5010 PERFORM ef-pag-AfterProcedure
           When 5011 PERFORM ef-mag-AfterProcedure
           When 5013 PERFORM ef-art-AfterProcedure
           When 5014 PERFORM ef-qta-AfterProcedure
           When 5015 PERFORM ef-listino-AfterProcedure
           When 5016 PERFORM ef-sconto-AfterProcedure
           When 5017 PERFORM ef-cons-AfterProcedure
           When 5018 PERFORM ef-coubat-AfterProcedure
           When 24 PERFORM ef-listino-AfterProcedure
           END-EVALUATE
           perform Form1-AFTER-SCREEN
           .

       Form1-Event-Proc.
           .

       Screen1-Ta-1-Event-Proc.
           EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
           WHEN Cmd-Tabchanged ALSO 5000 ALSO
                    Form1-Handle
              PERFORM Screen1-Ta-1-Ev-Cmd-Tabchanged
           END-EVALUATE
           .

       Form1-Gd-1-Event-Proc.
           EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
           WHEN Msg-Begin-Drag ALSO 2000 ALSO
                    Form1-Handle 
              PERFORM Form1-Gd-1-Ev-Msg-Begin-Drag
           WHEN Msg-Begin-Entry ALSO 2000 ALSO
                    Form1-Handle 
              PERFORM Form1-Gd-1-Ev-Msg-Begin-Entry
           WHEN Msg-End-Drag ALSO 2000 ALSO
                    Form1-Handle 
              PERFORM Form1-Gd-1-Ev-Msg-End-Drag
           WHEN Msg-Goto-Cell ALSO 2000 ALSO
                    Form1-Handle 
              PERFORM Form1-Gd-1-Ev-Msg-Goto-Cell
           WHEN Msg-Goto-Cell-Drag ALSO 2000 ALSO
                    Form1-Handle 
              PERFORM Form1-Gd-1-Ev-Msg-Goto-Cell-Drag
           WHEN Msg-Goto-Cell-Mouse ALSO 2000 ALSO
                    Form1-Handle 
              PERFORM Form1-Gd-1-Ev-Msg-Goto-Cell-Mouse
           END-EVALUATE
           .

       Screen1-Event-Proc.
           .

      * USER DEFINE PARAGRAPH
       ABILITAZIONI.
      * <TOTEM:PARA. ABILITAZIONI>
           modify cbo-stato,     enabled mod.
           modify tool-modifica,   value mod.
           move BitmapNewDisabled     to BitmapNumNew.   
           move BitmapEditEnabled     to BitmapNumEdit.
           move BitmapPrintDisabled   to BitmapNumPrint.
           move BitmapPreviewDisabled to BitmapNumPreview.
           move BitmapSelectDisabled  to BitmapNumSelect.
           move 0 to e-anteprima 
                     e-stampa 
                     e-nuovo
                     e-seleziona.
                           

           if mod = 1
              inquire cbo-stato,   value cbo-stato-buf
              if cbo-stato-buf not = "Disattivo" 
                 move 1 to mod-campi
                 move 1 to NumBitmapCodici
                 display pb-codici
              else
                 move 0 to mod-campi
                 move 3 to NumBitmapCodici
                 display pb-codici
              end-if
              move 0 to mod-k
              move BitmapDeleteEnabled  to BitmapNumDelete
              move BitmapSaveEnabled    to BitmapNumSave
           else
              move 1 to mod-k
              move 0 to mod-campi
              move 3 to NumBitmapCodici
              display pb-codici
              move BitmapDeleteDisabled to BitmapNumDelete
              move BitmapSaveDisabled   to BitmapNumSave
           end-if.
           move mod to e-salva e-cancella.
           perform DISPLAY-SCREEN.
                                                      
           modify tool-nuovo,     enabled = e-nuovo,
                                  bitmap-number = BitmapNumNew.
           modify tool-cancella,  enabled = e-cancella,
                                  bitmap-number = BitmapNumDelete.
           modify tool-modifica,  enabled = e-modifica,
                                  bitmap-number = BitmapNumEdit.
           modify tool-anteprima, enabled = e-anteprima,
                                  bitmap-number = BitmapNumPreview.
           modify tool-stampa,    enabled = e-stampa,
                                  bitmap-number = BitmapNumPrint.
           modify tool-seleziona, enabled = e-seleziona,
                                  bitmap-number = BitmapNumSelect.
           modify tool-salva,     enabled = e-salva,
                                  bitmap-number = BitmapNumSave 
           .
      * <TOTEM:END>

       ANTEPRIMA.
      * <TOTEM:PARA. ANTEPRIMA>
           SET ANTEPRIMA     TO TRUE 
           .
      * <TOTEM:END>

       CANCELLA.
      * <TOTEM:PARA. CANCELLA>
           display message box "Cancellare il movimento corrente?"
                   title = titolo
                   type mb-yes-no
                   default mb-no
                   giving scelta
                   icon 2

           if scelta = mb-yes
              set DeleteXX to true
              perform ACCESSOXX

              set CancellazioneFisica to true
              move LinkChiave to tmo-chiave
              move low-value  to rmo-rec
              move tmo-chiave to rmo-chiave

              move tmo-causale to tca-codice
              read tcaumag no lock
              
PATCH         start transaction  

              if evasione
                 move tmo-teva-chiave to teva-chiave
                 unlock teva all records
                 perform BLOCCA-EVASIONE
                 move teva-chiave to tmo-teva-chiave
              end-if

              if tutto-ok
                 perform DELETE-RIGHE
                 if not SystemErrorOccurred
PATCH               commit transaction

                    delete tmovmag  record invalid continue end-delete

                    open i-o movutf
                          
                    move low-value      to mov-rec                      
                          
                    if tca-movim-giac-pos
                       set mov-entrata to true
                    else
                       set mov-uscita  to true
                    end-if
                    move mov-tipo       to como-tipo
                    move tmo-anno       to mov-anno
                    move tmo-data-movim to mov-data
                    move tmo-numero     to mov-num-movim

                    start movutf key >= k-data-movim
                          invalid continue
                      not invalid
                          perform until 1 = 2
                             read movutf next no lock at end exit 
           perform end-read

                             if mov-anno      not = tmo-anno       or
                                mov-data      not = tmo-data-movim or
                                mov-num-movim not = tmo-numero     or
                                mov-tipo      not = como-tipo
                                exit perform
                             end-if
                             perform until 1 = 2
                                set RecLocked to false
                                delete movutf record
                                if not Reclocked
                                   exit perform
                                end-if
                                move "MOVUTF" to geslock-nome-file
                                move 1 to geslock-v-riprova
                                move 1 to geslock-v-ignora
                                move 0 to geslock-v-termina
                                call   "geslock" using geslock-linkage
                                cancel "geslock"
                                evaluate true
                                when riprova continue
                                when ignora  exit perform
                                end-evaluate
                             end-perform
                          end-perform
                    end-start
                    close movutf

                    if evasione
                       set teva-aperta to true
                       move 0 to teva-anno-movim
                       move 0 to teva-num-movim
                       rewrite teva-rec invalid continue end-rewrite
                       unlock teva all records
                    end-if
                    move 0 to mod
                    set RigaCambiata to false
                    initialize tmo-rec 
                           old-tmo-rec replacing numeric data by zeroes
                                            alphanumeric data by spaces

                    display message "Cancellazione avenuta con successo!
      -    ""
                              title titolo
                    set RicaricaGrid to true
                    set RigaCambiata to false
                    set HoSalvato    to true
                 end-if
              end-if
              perform FORM1-EXIT
              perform DESTROYXX
           end-if 
           .
      * <TOTEM:END>

       CANCELLA-FLAG.
      * <TOTEM:PARA. CANCELLA-FLAG>
PATCH      move low-value  to rmo-chiave
PATCH      move tmo-anno   to rmo-anno
PATCH      move tmo-numero to rmo-movim
PATCH      start rmovmag key >= rmo-chiave
PATCH            invalid continue
PATCH        not invalid
PATCH            perform until 1 = 2
PATCH               read rmovmag next no lock 
PATCH                    at end exit perform 
PATCH               end-read
PATCH               if rmo-anno  not = tmo-anno or
PATCH                  rmo-movim not = tmo-numero
PATCH                  exit perform
PATCH               end-if
PATCH               if rmo-cancellato
PATCH                  delete rmovmag record
PATCH                         invalid continue
PATCH                  end-delete
PATCH                  if status-rmovmag not = "00"
PATCH                     move 6 to tipo-messaggio
PATCH                     perform INVIO-MAIL
PATCH                     exit perform
PATCH                  end-if
PATCH               end-if
PATCH            end-perform
PATCH      end-start 
           .
      * <TOTEM:END>

       DELETE-RIGHE.
      * <TOTEM:PARA. DELETE-RIGHE>
           move 0 to tot-ordf.
           start rmovmag key is >= rmo-chiave
                 invalid continue
             not invalid 
                 perform until 1 = 2
                    read rmovmag next at end exit perform end-read
                    if tmo-anno   not = rmo-anno or
                       tmo-numero not = rmo-movim
                       exit perform
                    end-if
PATCH               if status-rmovmag not = "00"
PATCH                  move 5 to tipo-messaggio
PATCH                  perform INVIO-MAIL
PATCH                  exit perform
PATCH               end-if
                    if CancellazioneFisica
                       delete rmovmag record 
                              invalid
PATCH                         move 4 to tipo-messaggio
PATCH                         perform INVIO-MAIL
PATCH                         exit perform
                       end-delete
                    else
                       set rmo-cancellato to true
                       rewrite rmo-rec
                               invalid
PATCH                          move 4 to tipo-messaggio
PATCH                          perform INVIO-MAIL
PATCH                          exit perform
                       end-rewrite
                    end-if
                    initialize link-wprogmag
                    perform VALORIZZA-ARRAY-CAUSALI
                    move "0000000000000000" to link-array
                    move -1                 to multiplyer(1)
                    move -1                 to multiplyer(15)
                    set link-update         to true
                    move rmo-chiave-progmag to link-key
                    move old-tmo-causale    to link-causale
                    move rmo-qta            to link-valore
                    move user-codi          to link-user
                                            of link-wprogmag
                    call   "wprogmag"    using link-wprogmag
                    cancel "wprogmag"

                    if evasione
                       read reva next
                       move reva-qta            to link-valore
                       move "0000000000000000"  to link-array
                       move 1                   to multiplyer(1)
                       move 1                   to multiplyer(15)
                       call   "wprogmag"    using link-wprogmag
                       cancel "wprogmag"
                    end-if
                        
                 end-perform
           end-start 
           .
      * <TOTEM:END>

       DISPLAY-SCREEN.
      * <TOTEM:PARA. DISPLAY-SCREEN>
           display form1 
           .
      * <TOTEM:END>

       ENTRY-TO-ROW.
      * <TOTEM:PARA. ENTRY-TO-ROW>
           inquire form1-gd-1, last-row in tot-righe.
           inquire ef-art,     value in col-art.
           inquire ef-qta,     value in col-qta.
           inquire ef-listino, value in col-listino.
           inquire ef-sconto,  value in col-sconto.
           inquire ef-cons,    value in col-cons.
           inquire ef-coubat,  value in col-coubat.
           
           move lab-desart-buf   to col-des.
           move ef-imp-merce-buf to col-netto.
           move lab-tot-buf      to col-tot.
           move lab-peso-udm-buf to col-udm.
           move lab-peso-kg-buf  to col-kg.
      *
           if NewRow
              add 1 to tot-righe    giving riga
              modify form1-gd-1, insert-rows 1
              add 1        to LastPrg
              move LastPrg to col-num     
              perform COLORE
              move col-art to old-art-codice
           else
              inquire form1-gd-1, cursor-y in riga
           end-if.
      *
           modify form1-gd-1(riga, 1),  cell-data = col-num.
           modify form1-gd-1(riga, 2),  cell-data = col-art.    
           modify form1-gd-1(riga, 3),  cell-data = col-des.    
           modify form1-gd-1(riga, 4),  cell-data = col-qta.    
           modify form1-gd-1(riga, 5),  cell-data = col-udm.
           modify form1-gd-1(riga, 6),  cell-data = col-kg.
           modify form1-gd-1(riga, 7),  cell-data = col-listino.
           modify form1-gd-1(riga, 8),  cell-data = col-sconto. 
           modify form1-gd-1(riga, 9),  cell-data = col-netto. 
           modify form1-gd-1(riga, 10), cell-data = col-cons.   
           modify form1-gd-1(riga, 11), cell-data = col-coubat. 
           modify form1-gd-1(riga, 12), cell-data = col-tot.

           perform INQUIRE-HIDDEN.

           move col-art           to hid-cod-articolo  prg-cod-articolo
           move prg-cod-magazzino to hid-cod-magazzino prg-cod-magazzino
           move lab-imb-buf       to hid-tipo-imballo  prg-tipo-imballo
           move lab-peso-udm-buf  to hid-peso          prg-peso.
           move lab-udm-buf       to hid-udm.
           move lab-desimb-buf    to hid-desimb. 
           if lab-imp-cou set hid-cou   to true
           else           set hid-cobat to true
           end-if.
           read progmag no lock invalid continue end-read.
           move prg-peso-utf      to hid-utf.   
           move prg-peso-non-utf  to hid-non-utf.
           move prg-peso          to hid-peso.

LUBEXX*****     inquire form1-gd-1(riga, 78-NumCol + 8),
LUBEXX*****             hidden-data in hid-old-qta.

           perform MODIFY-HIDDEN.

           perform PULISCI-CAMPI.

           modify form1-gd-1, cursor-y = riga.

           if col-art     not = old-col-art 
              if not NewRow
                 set YesDeleted   to true
              end-if
              set RigaCambiata to true 
           end-if.

           if col-qta     not = old-col-qta 
              set RigaCambiata to true 
           end-if.   
   
           if col-listino not = old-col-listino
              set RigaCambiata to true 
           end-if.   

           if col-sconto  not = old-col-sconto 
              set RigaCambiata to true 
           end-if.   

           if col-cons    not = old-col-cons   
              set RigaCambiata to true 
           end-if.   

           if col-coubat  not = old-col-coubat 
              set RigaCambiata to true 
           end-if    
           .
      * <TOTEM:END>

       INVIO-MAIL.
      * <TOTEM:PARA. INVIO-MAIL>
           accept como-data from century-date.
           accept como-ora  from time.
           accept system-information from system-info.

           initialize LinkSubject.
           string "ATTENZIONE: ERRORE RIGHE GESLUX " delimited size
                  " - VERIFICATOSI IN DATA: "        delimited size
                  como-data(7:2)                     delimited size
                  "/"                                delimited size
                  como-data(5:2)                     delimited size
                  "/"                                delimited size
                  como-data(1:4)                     delimited size
                  " - ALLE ORE: "                    delimited size
                  como-ora(1:2)                      delimited size
                  ":"                                delimited size
                  como-ora(3:2)                      delimited size
                  ". Programma: GMOVCVAR"            delimited size
                  " - UTENTE: "                      delimited size
                  user-codi                          delimited size
                  " - DALLA POSTAZIONE: "            delimited size
                  user-id                            delimited size
                  into LinkSubject
           end-string.

           initialize LinkBody.
           evaluate tipo-messaggio
           when 1
                string "Numero: "                delimited size
                       tmo-numero                delimited size
                       " GRIGLIA: "              delimited size
                       tot-righe                 delimited size
                       " REALI: "                delimited size
                       righe-finali              delimited size
                       " WRITE EFFETUATE: "      delimited size
                       write-effettuate          delimited size
                       ". FARE COPIA ARCHIVI!!!" delimited size
                       ". Programma: GMOVCVAR"   delimited size
                       " - UTENTE: "             delimited size
                       user-codi                 delimited size
                       " - DALLA POSTAZIONE: "   delimited size
                       user-id                   delimited size
                       into LinkBody
                end-string
           when 2
                call "C$RERR" using extend-stat, 
                                    text-message
                string "CANCELLAZIONE PREVENTIVA" delimited size
                       "(DELETE INVALID...)"      delimited size
                       " - TESTATA: "             delimited size
                       tmo-chiave                 delimited size
                       " - RIGA: "                delimited size
                       rmo-chiave                 delimited size
                       " - CODICE D'ERRORE: "     delimited size
                       extend-stat                delimited size
                       ". OPERAZIONE FALLITA!"    delimited size
                       ". Programma: GMOVCVAR"    delimited size
                       " - UTENTE: "              delimited size
                       user-codi                  delimited size
                       " - DALLA POSTAZIONE: "    delimited size
                       user-id                    delimited size
                       into LinkBody
                end-string
           when 3
                call "C$RERR" using extend-stat, 
                                    text-message
                string "SCRITTURA DA GRIGLIA "  delimited size
                       "(WRITE INVALID...)"     delimited size
                       " - TESTATA: "           delimited size
                       tmo-chiave               delimited size
                       " - RIGA: "              delimited size
                       rmo-chiave               delimited size
                       " - CODICE D'ERRORE: "   delimited size
                       extend-stat              delimited size
                       ". OPERAZIONE FALLITA!"  delimited size
                       ". Programma: GMOVCVAR"  delimited size
                       " - UTENTE: "            delimited size
                       user-codi                delimited size
                       " - DALLA POSTAZIONE: "  delimited size
                       user-id                  delimited size
                       into LinkBody
                end-string
           when 4
                call "C$RERR" using extend-stat,
                                    text-message
                if CancellazioneFisica
                   string "CANCELLAZIONE DELETE-RIGHE" delimited size
                          "(DELETE INVALID...)"        delimited size
                          " - TESTATA: "               delimited size
                          tmo-chiave                   delimited size
                          " - RIGA: "                  delimited size
                          rmo-chiave                   delimited size
                          " - CODICE D'ERRORE: "       delimited size
                          extend-stat                  delimited size
                          ". OPERAZIONE FALLITA!"      delimited size
                          ". Programma: GMOVCVAR"      delimited size
                          " - UTENTE: "                delimited size
                           user-codi                   delimited size
                          " - DALLA POSTAZIONE: "      delimited size
                          user-id                      delimited size
                          into LinkBody
                   end-string
                else
                   string "REWRITE DELETE-RIGHE"   delimited size
                          "(CANCELLAZIONE LOGICA)" delimited size
                          " - TESTATA: "           delimited size
                          tmo-chiave               delimited size
                          " - RIGA: "              delimited size
                          rmo-chiave               delimited size
                          " - CODICE D'ERRORE: "   delimited size
                          extend-stat              delimited size
                          ". OPERAZIONE FALLITA!"  delimited size
                          ". Programma: GMOVCVAR"  delimited size
                          " - UTENTE: "            delimited size
                          user-codi                delimited size
                          " - DALLA POSTAZIONE: "  delimited size
                          user-id                  delimited size
                          into LinkBody
                    end-string
                end-if
           when 5
                call "C$RERR" using extend-stat, 
                                    text-message
                string "CANCELLAZIONE DELETE-RIGHE"      delimited size
                       "(IF STATUS-RMOVMAG NOT = 00...)" delimited size
                       " - TESTATA: "                    delimited size
                       tmo-chiave                        delimited size
                       " - RIGA: "                       delimited size
                       rmo-chiave                        delimited size
                       " - CODICE D'ERRORE: "            delimited size
                       extend-stat                       delimited size
                       ". OPERAZIONE FALLITA!"           delimited size
                       ". Programma: GMOVCVAR"           delimited size
                       " - UTENTE: "                     delimited size
                       user-codi                         delimited size
                       " - DALLA POSTAZIONE: "           delimited size
                       user-id                           delimited size
                       into LinkBody
                end-string
           when 6
                call "C$RERR" using extend-stat, 
                                    text-message
                string "CANCELLAZIONE RIGHE CON FLAG"    delimited size
                       "(IF STATUS-RMOVMAG NOT = 00...)" delimited size
                       " - TESTATA: "                    delimited size
                       tmo-chiave                        delimited size
                       " - RIGA: "                       delimited size
                       rmo-chiave                        delimited size
                       " - CODICE D'ERRORE: "            delimited size
                       extend-stat                       delimited size
                       ". OPERAZIONE FALLITA!"           delimited size
                       ". Programma: GMOVCVAR"           delimited size
                       " - UTENTE: "                     delimited size
                       user-codi                         delimited size
                       " - DALLA POSTAZIONE: "           delimited size
                       user-id                           delimited size
                       into LinkBody
                end-string
           end-evaluate.
           accept prova-mail from environment "PROVA_MAIL".
           if MailInProva
              move "a.eventi@goodworks.it" to LinkAddress
           else
              initialize LinkAddress
              string "a.eventi@goodworks.it;" delimited size
                     into LinkAddress
              end-string
           end-if.             
           move "gmovcvar" to NomeProgramma.
           move 5 to tentativi-mail.
           perform CICLO-SEND-MAIL.
           initialize wk-path copy-status.
           accept  wk-date from century-date.
           accept  wk-hour from time.
           accept  wk-path from environment "PATH_BACKUP".
           inspect wk-path replacing trailing spaces by low-value.
           string  wk-path     delimited low-value
                   "InvioMail" delimited size
                   "_"         delimited size
                   wk-date     delimited size
                   "_"         delimited size
                   wk-hour     delimited size
                   ".ini"      delimited size
                   into wk-path
           end-string.
           call "C$COPY" using path-lineseq-mail, wk-path, "S"
                        giving copy-status.

           perform 3 times
              set SystemErrorOccurred to true
              display message "ERRORE DI SISTEMA!!!"
                       x"0d0a""ORDINE NON AGGIORNATO!!!"
                       x"0d0a""CONTROLLARE!!!"
                        title titolo
                         icon 3
           end-perform.
           rollback transaction.

      ***---
       AFTER-SEND-MAIL 
           .
      * <TOTEM:END>

       MODIFICA.
      * <TOTEM:PARA. MODIFICA>
           move 5 to key-status.
           inquire tool-modifica, value in mod.
           set tutto-ok to true.
           
      *  se l'utente e' abilitato puo' modificare un record
           if mod = 1
              set YesMessage to true
              set movimento  to true
              perform CURRENT-RECORD
              if tmo-teva-anno not = 0
                 set evasione to true
                 move tmo-teva-chiave to teva-chiave
                 read teva no lock invalid continue end-read
                 move teva-mag to EvaMag
              end-if
              if tutto-ok
                 inquire Screen1-Ta-1, value in idx
                 evaluate idx
                 when 1 move 78-ID-ef-data to control-id
                        set ArticoloSetFocus to false
                 when 2 move 2 to event-data-2 riga
                        move 4 to event-data-1 colonna
                        set ArticoloSetFocus to true
                 end-evaluate    
                 move 1 to mod
                 set StatusModifica to true
                 perform STATUS-BAR-MSG
              end-if
           else
              move 1 to mod
              perform SALV-MOD            
              move 0 to mod
              if errori
                 move 1 to mod
              else
                 move 5000 to control-id
                 set NoMessage to true 
                 set movimento to true
                 perform CURRENT-RECORD
                 if tmo-teva-anno not = 0
                    set evasione to true
                    move tmo-teva-chiave to teva-chiave
                    read teva no lock invalid continue end-read
                    move teva-mag to EvaMag
                 end-if
                 set StatusVisua to true
                 perform STATUS-BAR-MSG 
                 unlock articoli all records
                 if KeyboardSaved
                    set KeyboardReleased to true
                    set environment "KEYSTROKE" to "DATA=44 44"
                    set environment "KEYSTROKE" to "DATA=46 46"
                 end-if
                 move 5000 to control-id
              end-if
           end-if.
                                
           perform DISPLAY-SCREEN.
           modify tool-modifica,  value mod.
           perform CANCELLA-COLORE.

           move 4 to accept-control.
           move 0 to StatusHelp.
           perform STATUS-HELP.

           perform ABILITAZIONI 
           .
      * <TOTEM:END>

       PARAGRAFO-COPY.
      * <TOTEM:PARA. PARAGRAFO-COPY>
           copy "abilita-toolbar.cpy".
           copy "riempi-combo-stato.cpy".
           copy "color-custom.cpy".
           Copy "utydata.cpy". 
           copy "movmag-procedure.cpy".
           copy "mail.cpy".
           copy "aggiorna-stato-ordf.cpy".
           copy "accessoxx.cpy" 
           .
      * <TOTEM:END>

       ROW-TO-ENTRY.
      * <TOTEM:PARA. ROW-TO-ENTRY>
      *    Questo prf. porta i dati da grid a entry-field
      *    quando rec-grd e rec-not sono valorizzati
           inquire form1-gd-1(riga, 1),  cell-data in col-num.
           inquire form1-gd-1(riga, 2),  cell-data in col-art.    
           inquire form1-gd-1(riga, 3),  cell-data in col-des.    
           inquire form1-gd-1(riga, 4),  cell-data in col-qta.    
           inquire form1-gd-1(riga, 5),  cell-data in col-udm.
           inquire form1-gd-1(riga, 6),  cell-data in col-kg.
           inquire form1-gd-1(riga, 7),  cell-data in col-listino.
           inquire form1-gd-1(riga, 8),  cell-data in col-sconto. 
           inquire form1-gd-1(riga, 9),  cell-data in col-netto. 
           inquire form1-gd-1(riga, 10), cell-data in col-cons.
           inquire form1-gd-1(riga, 11), cell-data in col-coubat.
           inquire form1-gd-1(riga, 12), cell-data in col-tot.
      *                             
           perform INQUIRE-HIDDEN.
      *    
           move col-art     to old-col-art     ef-art-buf old-art-codice
           move col-qta     to old-col-qta     ef-qta-buf rmo-qta.
           move col-udm     to old-col-udm     lab-peso-udm-buf.
           move col-kg      to old-col-kg      lab-peso-kg-buf.
           move col-listino to old-col-listino ef-listino-buf 
           rmo-listino
           move col-sconto  to old-col-sconto  ef-sconto-buf.
           move col-cons    to old-col-cons    ef-cons-buf.
           move col-coubat  to old-col-coubat  ef-coubat-buf.
           move col-des     to old-col-des     lab-desart-buf.
           move col-tot     to old-col-tot     lab-tot-buf.
           move col-netto   to ef-imp-merce-buf.
           
           if VariazioneDiValore move 1 to rmo-qta end-if.
                                                
           move hid-cod-articolo  to col-art prg-cod-articolo 
           art-codice.
           move hid-cod-magazzino to prg-cod-magazzino.
           move hid-tipo-imballo  to prg-tipo-imballo lab-imb-buf.
           move hid-peso          to prg-peso.
           move hid-udm           to lab-udm-buf.

           if hid-cou set lab-imp-cou   to true
           else       set lab-imp-cobat to true
           end-if.

           move hid-tipo-imballo to imq-codice.
           perform STRING-DESCRIZIONE-IMBALLO.
      *
           perform DISPLAY-SCREEN.
           set NewRow to false.

           if rmo-listino = 0
              modify ef-sconto,     read-only
              modify ef-cons,       read-only
              modify ef-coubat,     read-only
           else
              modify ef-sconto, not read-only
              modify ef-cons,   not read-only
              modify ef-coubat, not read-only
           end-if 
           .
      * <TOTEM:END>

       SALV-MOD.
      * <TOTEM:PARA. SALV-MOD>
           set tutto-ok to true.
           perform FORM1-CONTROLLO-OLD.

           if RigaCambiata
              set NoSalvato to true
           end-if.
                     
           if NoSalvato
              display message box MSG-Salvare-le-modifiche
                            title titolo
                            type mb-yes-no-cancel
                            giving scelta

              evaluate scelta
              when mb-yes
                   perform SALVA
              when mb-no
                   continue
              when other
                   perform CANCELLA-COLORE

                   set errori to true
                   |controllo che l'errore sia sulla pagina corrente
                   |specifico per i pgm. aventi Tab-Control
                   inquire Screen1-Ta-1, value in pagina
                   if store-id >= min-id(pagina) and
                      store-id <= max-id(pagina)
                      move store-id to CONTROL-ID
                   end-if
                   |******
                   move 4 to accept-control
              end-evaluate
           end-if 
           .
      * <TOTEM:END>

       SALVA.
      * <TOTEM:PARA. SALVA>
           if mod-k = 1 exit paragraph end-if.

PATCH      move BitmapSaveDisabled to BitmapNumSave
PATCH      move 0 to e-salva.
PATCH      modify tool-salva, 
PATCH             enabled = e-salva,
PATCH       bitmap-number = BitmapNumSave.

           set tutto-ok to true.

           |Setto a zero queste due variabili così il controllo
           |su alcuni campi della griglia non vengono RIFATTI
           |perchè già presi in considerazione precedentemente
           |con la pressione del tasto "Salva" relativo alla grid...

           perform CHECK-PAGE-1.

           if tutto-ok
              move 78-ID-cbo-stato to control-id
              perform CONTROLLO
              if tutto-ok
                 inquire Form1-Gd-1, last-row in tot-righe
                 if tot-righe <= 1
                    display message 
                            "Impossibile registrare il movimento"
                            " in quanto non sono presenti righe"
                            title = tit-err
                            icon mb-warning-icon
                    set errori to true
                    perform CANCELLA-COLORE
                 end-if
              end-if
           end-if.
 
           set SaveXX to true.
           perform ACCESSOXX.

           if evasione and tutto-ok
              move tmo-teva-chiave to teva-chiave
              perform BLOCCA-EVASIONE
           end-if.

           if errori
              inquire Screen1-Ta-1, value in pagina
              |******
              if store-id >= min-id(pagina) and
                 store-id <= max-id(pagina)
                 move store-id to CONTROL-ID
              end-if
              |******
              move 4 to accept-control
           else
              perform CANCELLA-COLORE
              perform CALCOLA-UTF-TOTALE
              perform VALORIZZA-NUMERO
              perform FORM1-BUF-TO-FLD
      *****        if YesDeleted
      *****           move tmo-chiave to rmo-chiave
      *****           move low-value  to rmo-riga
      *****           perform DELETE-RIGHE
      *****        end-if

PATCH         start transaction

PATCH         perform SCRIVI-RIGHE

PATCH         |Ne ho ritrovato meno di quelle che ho in grid
PATCH         if save-tot-righe not = righe-finali
PATCH            move 1 to tipo-messaggio
PATCH            perform INVIO-MAIL
PATCH         end-if

              if not SystemErrorOccurred

                 accept como-ora from time
                 move data-oggi  to tmo-data-ultima-modifica
                 move como-ora   to tmo-ora-ultima-modifica
                 move user-codi  to tmo-utente-ultima-modifica

                 |Valorizzo il gruppo GDO del movimento
LUBEXX           move cli-gdo to gdo-codice
LUBEXX           read tgrupgdo 
LUBEXX                invalid move spaces to gdo-capogruppo 
LUBEXX           end-read
LUBEXX           move gdo-capogruppo to tmo-gdo

PATCH            commit transaction

                 rewrite tmo-rec invalid continue end-rewrite

                 unlock tmovmag all record 

                 if evasione
                    perform STATO-ORDINI-FORNITORI
                    set teva-chiusa to true
                    move tmo-chiave to teva-k-mov
                    rewrite teva-rec invalid continue end-rewrite
                    unlock teva all records
                 end-if

                 perform VALORIZZA-OLD
                 perform TORNA-IN-VISUA
                 set RicaricaGrid to true
              end-if

           end-if.
           perform DESTROYXX.

           if not SystemErrorOccurred

              perform DISPLAY-SCREEN

PATCH         move BitmapSaveEnabled to BitmapNumSave
PATCH         move 1 to e-salva
PATCH         modify tool-salva, 
PATCH                enabled = e-salva,
PATCH          bitmap-number = BitmapNumSave
           else
              perform FORM1-EXIT
           end-if 
           .
      * <TOTEM:END>

       SCRIVI-RIGHE.
      * <TOTEM:PARA. SCRIVI-RIGHE>
PATCH*******    Prima le cancello tutte per sicurezza
PATCH *****     move low-value  to rmo-chiave.
PATCH *****     move tmo-anno   to rmo-anno.
PATCH *****     move tmo-numero to rmo-movim.
PATCH *****     start rmovmag key >= rmo-chiave
PATCH *****           invalid continue
PATCH *****       not invalid
PATCH *****           perform until 1 = 2
PATCH *****              read rmovmag next no lock 
PATCH *****                   at end exit perform 
PATCH *****              end-read
PATCH *****              if rmo-anno  not = tmo-anno or
PATCH *****                 rmo-movim not = tmo-numero
PATCH *****                 exit perform
PATCH *****              end-if
PATCH *****              delete rmovmag record 
PATCH *****                     invalid
PATCH *****                     move 2 to tipo-messaggio
PATCH *****                     perform INVIO-MAIL
PATCH *****              end-delete
PATCH *****           end-perform
PATCH *****     end-start.

PATCH      move 0 to righe-finali progressivo write-effettuate.

           move tmo-chiave to rmo-chiave.
           move low-value  to rmo-riga.

           set CancellazioneLogica to true.
           set HoSalvato           to true.
           perform DELETE-RIGHE.

           if not SystemErrorOccurred

              move low-value   to reva-riga
              move teva-chiave to reva-chiave-testa

              start reva key is >= reva-chiave 
                    invalid set errori to true 
              end-start

              modify  form1-gd-1, mass-update = 1
              inquire form1-gd-1, last-row in tot-righe
              move 0 to store-riga write-effettuate
              perform varying riga from 2 by 1 
                        until riga > tot-righe
PATCH            add 1 to progressivo
                 initialize rmo-rec replacing numeric data by zeroes
                                         alphanumeric data by spaces
                 move tmo-anno   to rmo-anno
      
                 move tmo-numero to rmo-movim
              
PATCH**                 inquire form1-gd-1(riga, 1),  cell-data in col-num
PATCH**                 move col-num to rmo-riga

PATCH            move progressivo to rmo-riga
PATCH            modify form1-gd-1(riga, 1), cell-data rmo-riga
      
                 inquire form1-gd-1(riga, 2),  cell-data in col-art
                 move col-art to rmo-articolo art-codice

                 read articoli no lock invalid continue end-read
                 move art-marca-prodotto to rmo-marca-prodotto
                 move art-peso-standard  to rmo-peso-udm

                 inquire form1-gd-1(riga, 4),  cell-data in col-qta
                 move col-qta  to rmo-qta

                 inquire form1-gd-1(riga, 5),  cell-data in col-udm
                 move col-udm to rmo-peso

                 inquire form1-gd-1(riga, 7),  cell-data in col-listino
                 move col-listino to rmo-listino

                 inquire form1-gd-1(riga, 8),  cell-data in col-sconto
                 move col-sconto to rmo-sconto

                 inquire form1-gd-1(riga, 9),  cell-data in col-netto
                 move col-netto to rmo-netto

                 inquire form1-gd-1(riga, 10), cell-data in col-cons
                 move col-cons to rmo-imp-cons

                 inquire form1-gd-1(riga, 11), cell-data in col-coubat
                 move col-coubat to rmo-coubat

                 move 0 to numero
                 initialize gruppo-hidden
                 perform INQUIRE-HIDDEN

                 move hid-udm            to rmo-udm
                 move hid-tipo-imballo   to rmo-imballo
                 move hid-cod-magazzino  to rmo-codmag
                 move hid-peso           to rmo-peso
                 move HiddenKey          to rmo-chiave-progmag
                                            prg-chiave

                 perform FORZA-PESO-UGUALE

                 move tmo-stato       to rmo-stato

                 move tmo-dati-comuni to rmo-dati-comuni
      *
                 if CallWProgmag
                    if VariazioneDiQuantita
                       initialize link-wprogmag
                       perform VALORIZZA-ARRAY-CAUSALI
                       compute link-valore-costo = rmo-netto    +
                                                   rmo-imp-cons +
                                                   rmo-coubat

LUBEXX                 if link-valore-costo = 0 or
LUBEXX                    rmo-qta           = 0
LUBEXX                    move 0 to multiplyer(16)
LUBEXX                 end-if

      *****                 if YesDeleted
                         |Aggiorno i progressivi con la quantità
                         |totale dato che l'ho storanta in precedenza
                          move HiddenKey       to link-key
                          move tmo-causale     to link-causale
                          set link-update      to true
                          move rmo-qta         to link-valore
                          move user-codi       to link-user
                                               of link-wprogmag
                          call   "wprogmag" using link-wprogmag
                          cancel "wprogmag"
      *****                 else

                          |Storno la quantità dal vecchio magazzino
                          |in caso di cambio causale
                          if tmo-causale not = old-tmo-causale
                             move old-tmo-causale to link-causale
                             compute link-valore = rmo-qta - (rmo-qta * 
           2)
                             move user-codi to link-user of 
           link-wprogmag
                             call   "wprogmag" using link-wprogmag
                             cancel "wprogmag"
                             move 0 to hid-old-qta
                          end-if

      *****                 if rmo-qta not = hid-old-qta
      *****                    move HiddenKey       to link-key
      *****                    move tmo-causale     to link-causale
      *****                    set link-update      to true
      *****                    compute link-valore = (rmo-qta - hid-old-qta)
      *****                    move user-codi  to link-user of link-wprogmag
      *****                    call   "wprogmag" using link-wprogmag
      *****                    cancel "wprogmag"
      *****                 end-if
      *****              end-if

                    end-if
                 end-if

                 move HiddenKey       to rmo-chiave-progmag

201204           move tmo-tipo        to rmo-tipo
201204           move tmo-cod-clifor  to rmo-cod-clifor
201204           move tmo-destino     to rmo-destino
201204           move tmo-causale     to rmo-causale
201204           move tmo-data-movim  to rmo-data-movim

                 accept como-ora from time
                 move data-oggi  to rmo-data-ultima-modifica
                 move como-ora   to rmo-ora-ultima-modifica
                 move user-codi  to rmo-utente-ultima-modifica
                          
                 if evasione
                    perform OPERAZIONI-EVASIONE
                 end-if                     
                 move reva-chiave to rmo-chiave-eva

                 set rmo-cancellato to false
                 write rmo-rec
                       invalid 
                       rewrite rmo-rec
                               invalid continue
PATCH                      not invalid add 1 to write-effettuate
                       end-rewrite
PATCH              not invalid add 1 to write-effettuate
                 end-write

                 evaluate status-rmovmag
                 when "00"
                 when "02" continue
                 when other
PATCH                 move 3 to tipo-messaggio
PATCH                 perform INVIO-MAIL
                      exit perform
                 end-evaluate

              end-perform
              modify form1-gd-1, mass-update = 0

PATCH *       Per monitorare l'errore di cancellazione/inserimento altre righe
              if tutto-ok
                 if righe-iniziali not = write-effettuate
                    move righe-iniziali   to righe-iniziali-x
                    move write-effettuate to righe-finali-x
                    inspect righe-iniziali-x 
                            replacing leading x"30" by x"20"
                    inspect righe-iniziali-x 
                            replacing leading x"30" by x"20"
                    call "C$JUSTIFY" using righe-iniziali-x, "L"
                    call "C$JUSTIFY" using righe-finali-x,   "L"
                    initialize geslock-linkage 
                               replacing numeric data by zeroes
                                    alphanumeric data by spaces
                    move 1 to geslock-v-salva
                    set geslock-righe to true
                    string "Da "            delimited size
                           righe-iniziali-x delimited spaces
                           " a "            delimited size
                           righe-finali-x   delimited spaces
                           " righe."        delimited size
                           into geslock-messaggio
                    end-string
                    perform 5 times
                       call   "geslock" using geslock-linkage
                       cancel "geslock"
                    end-perform
                 end-if
              end-if

PATCH**       Invio mail nel caso in cui le righe presenti su
PATCH**       griglia non siano le stesse scritte su file
PATCH         inquire form1-gd-1, last-row in save-tot-righe
PATCH         subtract 1 from save-tot-righe

PATCH         move low-value  to rmo-chiave
PATCH         move tmo-anno   to rmo-anno
PATCH         move tmo-numero to rmo-movim
PATCH         start rmovmag key >= rmo-chiave
PATCH               invalid continue
PATCH           not invalid
PATCH               perform until 1 = 2
PATCH                  read rmovmag next no lock
PATCH                       at end exit perform
PATCH                  end-read
PATCH                  if rmo-anno  not = tmo-anno or
PATCH                     rmo-movim not = tmo-numero
PATCH                     exit perform
PATCH               end-if
PATCH               if rmo-cancellato
PATCH                  delete rmovmag record
PATCH                         invalid continue
PATCH                  end-delete
PATCH                  if status-rmovmag not = "00"
PATCH                     move 6 to tipo-messaggio
PATCH                     perform INVIO-MAIL
PATCH                     exit perform
PATCH                  end-if
PATCH               end-if
PATCH            end-perform
PATCH         end-start

PATCH         move 0 to righe-finali
PATCH         move low-value  to rmo-chiave
PATCH         move tmo-anno   to rmo-anno
PATCH         move tmo-numero to rmo-movim
PATCH         start rmovmag key >= rmo-chiave
PATCH               invalid continue
PATCH           not invalid
PATCH               perform until 1 = 2
PATCH                  read rmovmag next no lock
PATCH                       at end exit perform
PATCH                  end-read
PATCH                  if rmo-anno  not = tmo-anno or
PATCH                     rmo-movim not = tmo-numero
PATCH                     exit perform
PATCH                  end-if
PATCH                  add 1 to righe-finali
PATCH               end-perform
PATCH         end-start
           end-if 
           .
      * <TOTEM:END>

       TORNA-IN-VISUA.
      * <TOTEM:PARA. TORNA-IN-VISUA>
           move 0 to mod.
           move 1 to mod-k.
           set NoMessage        to true.
           perform ABILITAZIONI.
           set StatusVisua      to true.
           perform STATUS-BAR-MSG.
           unlock articoli all records.
           set RigaCambiata to false.
                        
           modify tool-modifica,  value mod.
           move 4 to ACCEPT-CONTROL.

           if KeyboardSaved
              set KeyboardReleased to true
              set environment "KEYSTROKE" to "DATA=44 44"
              set environment "KEYSTROKE" to "DATA=46 46"
           end-if.         
           set NonCambiareTab   to false.
           set ArticoloSetFocus to false.
           set ControllaCampi   to true.

           
           move 1 to event-data-1 screen1-ta-1-tab-value.
           perform SCREEN1-TA-1-TABCHANGE 
           .
      * <TOTEM:END>

       VALORIZZA-NUMERO.
      * <TOTEM:PARA. VALORIZZA-NUMERO>
           perform FORM2-OPEN-ROUTINE.
           move ef-definitivo-buf to tmo-peso-utf lab-peso-utf-buf.
           move LinkChiave        to tmo-chiave 
           .
      * <TOTEM:END>

      * EVENT PARAGRAPH
       anagr01-Ev-After-Program.
      * <TOTEM:PARA. anagr01-Ev-After-Program>
           perform AFTER-PROGRAM 
           .
      * <TOTEM:END>
       anagr01-Ev-Before-Program.
      * <TOTEM:PARA. anagr01-Ev-Before-Program>
           move "gmovcvar" to nome-pgm.
           perform BEFORE-PROGRAM.

           accept esercizio-x from environment "ESERCIZIO".
           move   esercizio-x to esercizio 
           .
      * <TOTEM:END>
       TOOL-SALVA-LinkTo.
      * <TOTEM:PARA. TOOL-SALVA-LinkTo>
           inquire tool-modifica, value in mod           
      
           inquire tool-salva, enabled in e-salva
           if e-salva = 1
              perform SALVA
           end-if           
           .
      * <TOTEM:END>
       TOOL-MODIFICA-LinkTo.
      * <TOTEM:PARA. TOOL-MODIFICA-LinkTo>
           INQUIRE TOOL-MODIFICA, ENABLED IN E-MODIFICA.
      
           IF E-MODIFICA = 1
              PERFORM MODIFICA
           END-IF 
           .
      * <TOTEM:END>
       TOOL-CERCA-LinkTo.
      * <TOTEM:PARA. TOOL-CERCA-LinkTo>
           inquire tool-cerca, enabled in e-cerca
           if e-cerca = 1
              perform CERCA
           end-if 
           .
      * <TOTEM:END>
       ef-data-BeforeProcedure.
      * <TOTEM:PARA. ef-data-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-data-AfterProcedure.
      * <TOTEM:PARA. ef-data-AfterProcedure>
              INQUIRE ef-data, VALUE IN tmo-data-movim
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-data-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       cbo-stato-BeforeProcedure.
      * <TOTEM:PARA. cbo-stato-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           if ChangeTabToPageTwo
              perform CHECK-PAGE-1
              if tutto-ok
                 perform CANCELLA-COLORE
                 move 2 to screen1-ta-1-tab-value event-data-1
                 perform SCREEN1-TA-1-TABCHANGE
                 set ControllaCampi     to true
                 set ArticoloSetFocus   to true
                 set ChangeTabToPageTwo to false
              end-if
           end-if 
           .
      * <TOTEM:END>
       cbo-stato-AfterProcedure.
      * <TOTEM:PARA. cbo-stato-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       Screen1-Ta-1-Ev-Cmd-Tabchanged.
      * <TOTEM:PARA. Screen1-Ta-1-Ev-Cmd-Tabchanged>
           perform CHANGE-TAB 
           .
      * <TOTEM:END>
       ef-causale-BeforeProcedure.
      * <TOTEM:PARA. ef-causale-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           if not CambioCausale
              modify ef-causale,     read-only
           else
              modify ef-causale, not read-only
           end-if.
           if tmo-btno-anno not = 0
              modify ef-causale,     read-only
           else
              modify ef-causale, not read-only
           end-if 
           .
      * <TOTEM:END>
       ef-clifor-BeforeProcedure.
      * <TOTEM:PARA. ef-clifor-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           perform EF-CLIFOR-BEFORE-PROCEDURE.
           if tmo-btno-anno not = 0
              modify ef-clifor,     read-only
           else
              modify ef-clifor, not read-only
           end-if 
           .
      * <TOTEM:END>
       ef-num-BeforeProcedure.
      * <TOTEM:PARA. ef-num-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-data-doc-BeforeProcedure.
      * <TOTEM:PARA. ef-data-doc-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-pag-BeforeProcedure.
      * <TOTEM:PARA. ef-pag-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-mag-BeforeProcedure.
      * <TOTEM:PARA. ef-mag-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-causale-AfterProcedure.
      * <TOTEM:PARA. ef-causale-AfterProcedure>
              INQUIRE ef-causale, VALUE IN tmo-causale
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-causale-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-clifor-AfterProcedure.
      * <TOTEM:PARA. ef-clifor-AfterProcedure>
              INQUIRE ef-clifor, VALUE IN tmo-cod-clifor
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-clifor-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-num-AfterProcedure.
      * <TOTEM:PARA. ef-num-AfterProcedure>
              INQUIRE ef-num, VALUE IN tmo-numdoc-clifor
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-num-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
              INQUIRE ef-via, VALUE IN tmo-num-via
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-via-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-data-doc-AfterProcedure.
      * <TOTEM:PARA. ef-data-doc-AfterProcedure>
              INQUIRE ef-data-doc, VALUE IN tmo-data-doc
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-data-doc-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
              INQUIRE ef-data-via, VALUE IN tmo-dt-via
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-data-via-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-pag-AfterProcedure.
      * <TOTEM:PARA. ef-pag-AfterProcedure>
              INQUIRE ef-pag, VALUE IN tmo-codpag
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-pag-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-mag-AfterProcedure.
      * <TOTEM:PARA. ef-mag-AfterProcedure>
              INQUIRE ef-mag, VALUE IN tmo-codmag
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-mag-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-art-BeforeProcedure.
      * <TOTEM:PARA. ef-art-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           perform BEFORE-ARTICOLO 
             
           .
      * <TOTEM:END>
       ef-qta-BeforeProcedure.
      * <TOTEM:PARA. ef-qta-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           perform BEFORE-QTA
           .
      * <TOTEM:END>
       ef-listino-BeforeProcedure.
      * <TOTEM:PARA. ef-listino-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-sconto-BeforeProcedure.
      * <TOTEM:PARA. ef-sconto-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-cons-BeforeProcedure.
      * <TOTEM:PARA. ef-cons-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-coubat-BeforeProcedure.
      * <TOTEM:PARA. ef-coubat-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-art-AfterProcedure.
      * <TOTEM:PARA. ef-art-AfterProcedure>
              INQUIRE ef-art, VALUE IN rmo-articolo
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-art-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-qta-AfterProcedure.
      * <TOTEM:PARA. ef-qta-AfterProcedure>
              INQUIRE ef-qta, VALUE IN rmo-qta
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-qta-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-listino-AfterProcedure.
      * <TOTEM:PARA. ef-listino-AfterProcedure>
              INQUIRE ef-listino, VALUE IN rmo-listino
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-listino-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
              INQUIRE ef-imp-merce, VALUE IN rmo-netto
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-imp-merce-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-sconto-AfterProcedure.
      * <TOTEM:PARA. ef-sconto-AfterProcedure>
              INQUIRE ef-sconto, VALUE IN rmo-sconto
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-sconto-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-cons-AfterProcedure.
      * <TOTEM:PARA. ef-cons-AfterProcedure>
              INQUIRE ef-cons, VALUE IN rmo-imp-cons
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-cons-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-coubat-AfterProcedure.
      * <TOTEM:PARA. ef-coubat-AfterProcedure>
              INQUIRE ef-coubat, VALUE IN rmo-coubat
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-coubat-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       Form1-Gd-1-Ev-Msg-Begin-Entry.
      * <TOTEM:PARA. Form1-Gd-1-Ev-Msg-Begin-Entry>
           set event-action to event-action-fail 
           .
      * <TOTEM:END>
       Form1-Gd-1-Ev-Msg-Goto-Cell.
      * <TOTEM:PARA. Form1-Gd-1-Ev-Msg-Goto-Cell>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       Form1-Gd-1-Ev-Msg-Goto-Cell-Drag.
      * <TOTEM:PARA. Form1-Gd-1-Ev-Msg-Goto-Cell-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       Form1-Gd-1-Ev-Msg-Goto-Cell-Mouse.
      * <TOTEM:PARA. Form1-Gd-1-Ev-Msg-Goto-Cell-Mouse>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       Form1-Gd-1-Ev-Msg-Begin-Drag.
      * <TOTEM:PARA. Form1-Gd-1-Ev-Msg-Begin-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       Form1-Gd-1-Ev-Msg-End-Drag.
      * <TOTEM:PARA. Form1-Gd-1-Ev-Msg-End-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       pb-grid-elimina-LinkTo.
      * <TOTEM:PARA. pb-grid-elimina-LinkTo>
           if mod-campi = 0 exit paragraph end-if.
           if evasione
              display message "Impossibile eliminare righe ad un'evasion
      -    "e"
                       x"0d0a""Rettificare la bozza"
                        title titolo
           else
              perform CANCELLA-RIGA
           end-if 
           .
      * <TOTEM:END>
       pb-codici-LinkTo.
      * <TOTEM:PARA. pb-codici-LinkTo>
           perform PB-CODICI-PRESSED 
           .
      * <TOTEM:END>
       pb-grid-nuovo-LinkTo.
      * <TOTEM:PARA. pb-grid-nuovo-LinkTo>
           if mod-campi = 0 exit paragraph end-if.

           if evasione
              display message "Impossibile aggiungere righe ad un'evasio
      -    "ne"
                       x"0d0a""Rettificare la bozza"
                        title titolo
           else           
              perform PULISCI-CAMPI
              perform CANCELLA-COLORE
              move 78-ID-ef-art to control-id
              move 4 to accept-control
              set NewRow to true
           end-if 
           .
      * <TOTEM:END>
       TOOL-CANCELLA-LinkTo.
      * <TOTEM:PARA. TOOL-CANCELLA-LinkTo>
           inquire tool-cancella, enabled in e-cancella.
           if e-cancella = 1 perform CANCELLA end-if 
           .
      * <TOTEM:END>
       TOOL-MODIFICA-BeforeProcedure.
      * <TOTEM:PARA. TOOL-MODIFICA-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       TOOL-MODIFICA-AfterProcedure.
      * <TOTEM:PARA. TOOL-MODIFICA-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       Screen1-Ef-1-BeforeProcedure.
      * <TOTEM:PARA. Screen1-Ef-1-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       Screen1-Ef-1-AfterProcedure.
      * <TOTEM:PARA. Screen1-Ef-1-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       ef-destino-BeforeProcedure.
      * <TOTEM:PARA. ef-destino-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           perform EF-DESTINO-BEFORE-PROCEDURE.
           if tmo-btno-anno not = 0
              modify ef-destino,     read-only
           else
              modify ef-destino, not read-only
           end-if 
           .
      * <TOTEM:END>
       ef-destino-AfterProcedure.
      * <TOTEM:PARA. ef-destino-AfterProcedure>
              INQUIRE ef-destino, VALUE IN tmo-destino
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-destino-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
              INQUIRE ef-vettore, VALUE IN tmo-vettore
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-vettore-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       PB-OK-BeforeProcedure.
      * <TOTEM:PARA. PB-OK-BeforeProcedure>
           modify pb-ok, bitmap-number = 2 
           .
      * <TOTEM:END>
       PB-OK-AfterProcedure.
      * <TOTEM:PARA. PB-OK-AfterProcedure>
           modify pb-ok, bitmap-number = 1 
           .
      * <TOTEM:END>
       pb-grid-nuovo-BeforeProcedure.
      * <TOTEM:PARA. pb-grid-nuovo-BeforeProcedure>
           modify pb-grid-nuovo, bitmap-number = 2 
           .
      * <TOTEM:END>
       pb-grid-nuovo-AfterProcedure.
      * <TOTEM:PARA. pb-grid-nuovo-AfterProcedure>
           modify pb-grid-nuovo, bitmap-number = 5 
           .
      * <TOTEM:END>
       pb-grid-elimina-AfterProcedure.
      * <TOTEM:PARA. pb-grid-elimina-AfterProcedure>
           modify pb-grid-elimina, bitmap-number = 4 
           .
      * <TOTEM:END>
       pb-grid-elimina-BeforeProcedure.
      * <TOTEM:PARA. pb-grid-elimina-BeforeProcedure>
           modify pb-grid-elimina, bitmap-number = 1 
           .
      * <TOTEM:END>
       pb-codici-BeforeProcedure.
      * <TOTEM:PARA. pb-codici-BeforeProcedure>
           move 2 to NumBitmapCodici.
           display pb-codici 
           .
      * <TOTEM:END>
       pb-codici-AfterProcedure.
      * <TOTEM:PARA. pb-codici-AfterProcedure>
           move 1 to NumBitmapCodici.
           display pb-codici 
           .
      * <TOTEM:END>

      *{TOTEM}END

      *{TOTEM}SHOW-MSG
       MESSAGE-FOR-FILEERROR.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
              MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           .

       SHOW-TRANSACTION-ROUTINE.
           IF TOTEM-TRANSACTION-FLAG = SPACES
              IF TRANSACTION-STATUS NOT = 0
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-1
              END-IF
           ELSE
              PERFORM SHOW-MSG-ROUTINE
              IF TRANSACTION-STATUS = 0
                 MOVE "Transazione terminata con Rollback." TO 
           TOTEM-MSG-3
              ELSE
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-3
              END-IF
           END-IF
           .

       SHOW-MSG-ROUTINE.
           MOVE SPACE TO TOTEM-MSG-1 TOTEM-MSG-2 TOTEM-MSG-3
           EVALUATE TOTEM-MSG-ID
               WHEN "10"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Nessun altro dato." TO TOTEM-MSG-2
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "22"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Chiave Duplicata." TO TOTEM-MSG-2
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "23"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Raggiunta fine file." TO TOTEM-MSG-2
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "101"
                    MOVE "Terminare l'applicazione?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "201"
                    MOVE "Aggiungere un nuovo record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "202"
                    MOVE "Aggiornare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "203"
                    MOVE "Cancellare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "204"
                    MOVE "Chiave duplicata." TO TOTEM-MSG-1
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "301"
                    MOVE "Inserimento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "302"
                    MOVE "Aggiornamento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "303"
                    MOVE "Cancellazione avvenuta con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "401"
                    MOVE "Shell non trovata." TO TOTEM-MSG-1
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN OTHER
                    MOVE TEXT-MESSAGE TO TOTEM-MSG-1
                    STRING "FILE:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-3
                    MOVE 0 TO TOTEM-IDX1
                    INSPECT TOTEM-MSG-3 TALLYING TOTEM-IDX1
                       FOR TRAILING SPACE
                    STRING TOTEM-MSG-3(1:TOTEM-MSG-LENGTH - 
           TOTEM-IDX1), 
                       ", FILE STATUS ", PRIMARY-ERROR "," 
                       SECONDARY-ERROR
                    DELIMITED BY SIZE INTO TOTEM-MSG-2
                    MOVE SPACES TO TOTEM-MSG-3
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
           END-EVALUATE
           PERFORM MESSAGE-BOX-ROUTINE
           .

       MESSAGE-BOX-ROUTINE.
           MOVE 1 TO TOTEM-MSG-TEXT-POINTER
           IF TOTEM-MSG-1 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-1 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              STRING TOTEM-MSG-1( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                 DELIMITED BY SIZE
                 INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-2 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-2 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-2( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-3 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-3 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-3( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-TEXT-POINTER = 1
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-TEXT TALLYING TOTEM-MSG-SIZE FOR 
           TRAILING SPACE
                  COMPUTE TOTEM-MSG-TEXT-POINTER = 
           TOTEM-MSG-FULL-LENGTH - TOTEM-MSG-SIZE + 1
           END-IF
           MOVE LOW-VALUES TO TOTEM-MSG-TEXT(TOTEM-MSG-TEXT-POINTER : 1 
           )
           .

       MESSAGE-BOX-DISPLAY.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

      *{TOTEM}END

