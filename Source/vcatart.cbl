      *{TOTEM}PRG-COMMENT
      * vcatart.Cbl
      * vcatart.Cbl is generated by TOTEM
      * This is a generated file. DO NOT modify this file directly.
      *{TOTEM}END
       IDENTIFICATION       DIVISION.
      *{TOTEM}PRGID
       PROGRAM-ID.          vcatart.
       AUTHOR.              ANDREA EVENTI.
       DATE-WRITTEN.        martedì 1 aprile 2014 19:20:31.
       REMARKS.
      *{TOTEM}END

       ENVIRONMENT          DIVISION.
       CONFIGURATION        SECTION.
       SPECIAL-NAMES.
      *{TOTEM}SPECIAL-NAME
      * <TOTEM:EPT. INIT:vcatart, INIT:vcatart, SpecialName>
      * <TOTEM:END>
      *{TOTEM}END
      *{TOTEM}ACTIVEX-DEF
      *{TOTEM}END
      *{TOTEM}DECIMAL-POINT
           DECIMAL-POINT IS COMMA.
      *{TOTEM}END

       INPUT-OUTPUT         SECTION.
       FILE-CONTROL.
      *{TOTEM}FILE-CONTROL
           COPY "articoli.sl".
           COPY "catart.sl".
      *{TOTEM}END
       DATA                 DIVISION.
       FILE                 SECTION.
      *{TOTEM}FILE
           COPY "articoli.fd".
           COPY "catart.fd".
      *{TOTEM}END

       WORKING-STORAGE      SECTION.
      *{TOTEM}ACU-DEF
               COPY "acugui.def".
               COPY "acucobol.def".
               COPY "fonts.def".
               COPY "crtvars.def".
               COPY "showmsg.def".
               COPY "totem.def".
               COPY "F:\Lubex\GESLUX\Copylib\UTYDATA.DEF".
               COPY "F:\Lubex\GESLUX\Copylib\comune.def".
               COPY "F:\Lubex\GESLUX\Copylib\custom.def".
      *{TOTEM}END

      *{TOTEM}COPY-WORKING
      * Key Status
       77 Key-Status IS SPECIAL-NAMES CRT STATUS PIC 9(5) VALUE 0.
          88 Enter-Pushed VALUE 13.
          88 Exit-Pushed VALUE 27.
          88 Message-Received VALUE 95.
          88 Event-Occurred VALUE 96.
          88 Screen-No-Input-Field VALUE 97.
          88 Screen-Time-Out VALUE 99.
      * Properties & User defined Working Stoarge
       78 titolo VALUE IS "Geslux - Visualizzazione Catene Articoli". 
       78 titolo-2 VALUE IS "Geslux - Visualizzazione Catene Articoli - 
      -    "Dettaglio". 
       77 save-riga        PIC  9(9).
       77 FILLER           PIC  9.
           88 CallManutenzione VALUE IS 1    WHEN SET TO FALSE  0. 
       77 Small-Font
                  USAGE IS HANDLE OF FONT SMALL-FONT.
       77 form1-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 AUTO-ID          PIC  9(6)
                  VALUE IS 0.
       77 Verdana10B-Occidentale
                  USAGE IS HANDLE OF FONT DEFAULT-FONT.
       77 como-x           PIC  x.
       77 Form3-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 Verdana12BI-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 font-evidenzia-griglia
                  USAGE IS HANDLE OF FONT.
       77 elemento-bmp     PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS ZERO.
       77 como-riga
                  USAGE IS UNSIGNED-INT.
       77 como-colonna
                  USAGE IS UNSIGNED-INT.
       77 bottone-ok-bmp   PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 Verdana12-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 STATUS-articoli  PIC  X(2).
           88 Valid-STATUS-articoli VALUE IS "00" THRU "09". 
       77 status-catart    PIC  X(2).
           88 Valid-status-catart VALUE IS "00" THRU "09". 
       01 rec-grid.
           05 col-nulla        PIC  X.
           05 Col-art-princ    PIC  z(6).
           05 col-desc-art-princ           PIC  x(40).
           05 collegati.
               10 Col-collegato-1  PIC  z(6).
               10 col-collegato-2  PIC  z(06).
               10 col-collegato-3  PIC  z(06).
               10 col-collegato-4  PIC  z(06).
               10 col-collegato-5  PIC  z(06).
               10 col-collegato-6  PIC  z(06).
               10 col-collegato-7  PIC  z(06).
               10 col-collegato-8  PIC  z(06).
               10 col-collegato-9  PIC  z(06).
               10 col-collegato-10 PIC  z(06).
               10 col-collegato-11 PIC  z(06).
               10 col-collegato-12 PIC  z(06).
               10 col-collegato-13 PIC  z(06).
               10 col-collegato-14 PIC  z(06).
               10 col-collegato-15 PIC  z(06).
               10 col-collegato-16 PIC  z(06).
               10 col-collegato-17 PIC  z(06).
               10 col-collegato-18 PIC  z(06).
               10 col-collegato-19 PIC  z(06).
               10 col-collegato-20 PIC  z(06).
           05 FILLER REDEFINES collegati.
               10 col-collegato    PIC  z(6)
                          OCCURS 20 TIMES.
       77 bottone-exit-bmp PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 form2-Handle
                  USAGE IS HANDLE OF WINDOW.
       01 rec-grid-dett.
           05 col-nulla-d      PIC  X.
           05 Col-articolo     PIC  z(6).
           05 col-desc-art     PIC  x(40).
       77 riga-det         PIC  9(4).
       77 tot-righe-det    PIC  9(4).
       77 lbl-art-buf      PIC  X(50).
       77 lbl-descr-art-buf            PIC  X(50).
       77 CERCA-BMP        PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 ef-art-buf       PIC  9(5).

      ***********************************************************
      *   Code Gen's Buffer                                     *
      ***********************************************************
       77 STATUS-Form1-FLAG-REFRESH PIC  9.
          88 Form1-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 TMP-Form1-KEY1-ORDER  PIC X VALUE "A".
       77 TMP-Form1-catart-RESTOREBUF  PIC X(6622).
       77 TMP-Form1-KEYIS  PIC 9(3) VALUE 1.
       77 Form1-MULKEY-TMPBUF   PIC X(6622).
       77 TMP-DataSet1-articoli-BUF     PIC X(3669).
       77 TMP-DataSet1-catart-BUF     PIC X(6622).
      * VARIABLES FOR RECORD LENGTH.
       77  TotemFdSlRecordClearOffset   PIC 9(5) COMP-4.
       77  TotemFdSlRecordLength        PIC 9(5) COMP-4.
      * FILE'S LOCK MODE FLAG
       77 DataSet1-articoli-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-articoli-LOCK  VALUE "Y".
       77 DataSet1-articoli-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-articoli-KEY-Asc  VALUE "A".
          88 DataSet1-articoli-KEY-Desc VALUE "D".
       77 DataSet1-catart-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-catart-LOCK  VALUE "Y".
       77 DataSet1-KEYIS   PIC 9(3) VALUE 1.
       77 DataSet1-catart-KEY1-ORDER  PIC X VALUE "A".
          88 DataSet1-catart-KEY1-Asc  VALUE "A".
          88 DataSet1-catart-KEY1-Desc VALUE "D".

       77 articoli-art-k1-SPLITBUF  PIC X(51).
       77 catart-cat-art-princ-SPLITBUF  PIC X(13).

       77  cod-ed   pic z(6).
      *{TOTEM}END

      *{TOTEM}ID-LOGICI
      ***** Elenco ID Logici *****
      ***** Fine ID Logici *****
      *{TOTEM}END

       LINKAGE          SECTION.
      *{TOTEM}LINKAGE
           COPY  "COMMON-LINKAGE.DEF".

      *{TOTEM}END

       SCREEN           SECTION.
      *{TOTEM}COPY-SCREEN
      * FORM
       01 
           Form1, 
           .

      * ENTRY FIELD
       05
           ef-art, 
           Entry-Field, 
           COL 25,67, 
           LINE 1,69,
           LINES 1,70 ,
           SIZE 10,00 ,
           BOXED,
           COLOR IS 513,
           FONT IS Verdana12-Occidentale,
           ID IS 5,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 6,
           VALUE ef-art-buf,
           AFTER PROCEDURE Screen1-Ef-1-AfterProcedure, 
           BEFORE PROCEDURE Screen1-Ef-1-BeforeProcedure, 
           .

      * PUSH BUTTON
       05
           pb-cerca, 
           Push-Button, 
           COL 37,17, 
           LINE 1,31,
           LINES 24,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE CERCA-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 1234,
           FONT IS Small-Font,
           ID IS 8,
           TITLE "Ricerca Articolo",
           AFTER PROCEDURE pb-cerca-AfterProcedure, 
           BEFORE PROCEDURE pb-cerca-BeforeProcedure, 
           .

      * FRAME
       05
           Screen1-Fr-1, 
           Frame, 
           COL 1,17, 
           LINE 47,69,
           LINES 3,00 ,
           SIZE 33,00 ,
           LOWERED,
           FULL-HEIGHT,
           ID IS 2,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           .

      * GRID
       05
           gd-catena, 
           Grid, 
           COL 2,67, 
           LINE 4,31,
           LINES 40,54 ,
           SIZE 161,67 ,
           BOXED,
           DATA-COLUMNS (1, 2, 8, 48, 54, 60, 66, 72, 78, 84, 90, 96, 
           102, 108, 114, 120, 126, 132, 138, 144, 150, 156, 162),
           ALIGNMENT ("C", "C", "L", "C", "C", "C", "C", "C", "C", "C", 
           "C", "C", "C", "C", "C", "C", "C", "C", "C", "C", "C", "C", 
           "C"),
           SEPARATION (5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 
           5, 5, 5, 5, 5, 5, 5),
           DATA-TYPES ("X", "9(6)", "X", "9(6)", "9(6)", "9(6)", "9(6)"
           , "9(6)", "9(6)", "9(6)", "9(6)", "9(6)", "9(6)", "9(6)", "9(
      -    "6)", "9(6)", "9(6)", "9(6)", "9(6)", "9(6)", "9(6)", "9(6)"
           , "9(6)"),
           NUM-COL-HEADINGS 1,
           COLUMN-HEADINGS,
           CURSOR-COLOR 480
           CURSOR-FRAME-WIDTH 0,
           DIVIDER-COLOR 1,
           HEADING-COLOR 257,
           HEADING-DIVIDER-COLOR 1,
           HEADING-FONT IS Verdana10B-Occidentale,
           HSCROLL,
           ID IS 1,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           ROW-HEADINGS,
           TILED-HEADINGS,
           VPADDING 50,
           VSCROLL,
           EVENT PROCEDURE Screen1-Gd-1-Event-Proc,
           .

      * FRAME
       05
           Screen1-Fr-1a, 
           Frame, 
           COL 34,54, 
           LINE 47,69,
           LINES 3,00 ,
           SIZE 103,83 ,
           LOWERED,
           FULL-HEIGHT,
           ID IS 202,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           .

      * LABEL
       05
           Screen1-La-1, 
           Label, 
           COL 36,54, 
           LINE 48,31,
           LINES 1,54 ,
           SIZE 89,00 ,
           FONT IS Verdana12-Occidentale,
           ID IS 203,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Doppio Click o Invio per visualizzare i dettagli dell'
      -    "articolo",
           .

      * FRAME
       05
           Screen1-Fr-1aa, 
           Frame, 
           COL 138,50, 
           LINE 47,69,
           LINES 3,00 ,
           SIZE 27,50 ,
           LOWERED,
           FULL-HEIGHT,
           ID IS 6,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           .

      * PUSH BUTTON
       05
           pb-annulla2, 
           Push-Button, 
           COL 152,33, 
           LINE 47,84,
           LINES 30,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE BOTTONE-EXIT-BMP,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 27,
           FLAT,
           ID IS 201,
           SELF-ACT,
           ESCAPE-BUTTON,
           AFTER PROCEDURE pb-annulla2-AfterProcedure, 
           BEFORE PROCEDURE pb-annulla2-BeforeProcedure, 
           .

      * PUSH BUTTON
       05
           pb-ok2, 
           Push-Button, 
           COL 139,17, 
           LINE 47,84,
           LINES 30,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE BOTTONE-OK-BMP,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 1000,
           FLAT,
           ID IS 200,
           AFTER PROCEDURE pb-ok2-AfterProcedure, 
           BEFORE PROCEDURE pb-ok2-BeforeProcedure, 
           .

      * LABEL
       05
           Screen1-blockpgm-1, 
           Label, 
           COL 138,00, 
           LINE 46,31,
           LINES 1,31 ,
           SIZE 14,83 ,
           ID IS 3,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "BlockPgm",
           VISIBLE v-custom,
           .

      * LABEL
       05
           Screen1-Custom1-1, 
           Label, 
           COL 155,50, 
           LINE 46,15,
           LINES 1,31 ,
           SIZE 7,67 ,
           ID IS 7,
           TRANSPARENT,
           TITLE "CUSTOM CONTROL",
           VISIBLE v-custom,
           .

      * LABEL
       05
           lbl-descr-art, 
           Label, 
           COL 2,67, 
           LINE 45,85,
           LINES 2,00 ,
           SIZE 74,00 ,
           COLOR IS 5,
           FONT IS Verdana12BI-Occidentale,
           ID IS 204,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           LEFT,
           TRANSPARENT,
           TITLE lbl-descr-art-buf,
           .

      * LABEL
       05
           Screen1-La-2, 
           Label, 
           COL 2,67, 
           LINE 1,69,
           LINES 1,70 ,
           SIZE 21,50 ,
           FONT IS Verdana12-Occidentale,
           ID IS 4,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Ricerca articolo",
           .

      *{TOTEM}END

      *{TOTEM}LINKPARA
       PROCEDURE  DIVISION USING LK-BLOCKPGM, USER-CODI, LIVELLO-ABIL.
      *{TOTEM}END

      *{TOTEM}DECLARATIVE
       DECLARATIVES.
      * <TOTEM:EPT. INIT:vcatart, INIT:vcatart, BeforeDeclarative>
      ***---
       CATART-ERR SECTION.
           use after error procedure on CATART.
           set tutto-ok  to true.
           evaluate status-CATART
           when "35"
                display message "File [CATART] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [CATART] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[CATART] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       ARTICOLI-ERR SECTION.
           use after error procedure on ARTICOLI.
           set tutto-ok  to true.
           evaluate status-ARTICOLI
           when "35"
                display message "File [ARTICOLI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [ARTICOLI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[ARTICOLI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.

      * <TOTEM:END>
       INPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON INPUT.
       0100-DECL.
           EXIT.
       I-O-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON I-O.
       0200-DECL.
           EXIT.
       OUTPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON OUTPUT.
       0300-DECL.
           EXIT.
       TRANSACTION-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON TRANSACTION.
       0400-DECL.
           EXIT.
       END DECLARATIVES.
      *{TOTEM}END

       MAIN-LOGIC.
      *{TOTEM}ENTRY-BEFPRG
      *    Before-Program
           PERFORM ginqui-Ev-Before-Program
      *{TOTEM}END
           PERFORM INITIALIZE-ROUTINE.
      * run main screen
      *{TOTEM}RUN-MAINSCR
           PERFORM Form1-OPEN-ROUTINE.
      *{TOTEM}END

      *{TOTEM}COPY-PROCEDURE
       EXIT-STOP-ROUTINE.
           PERFORM CLOSE-FILE-RTN
      * <TOTEM:EPT. INIT:vcatart, INIT:vcatart, BeforeDestroyResource>
      * <TOTEM:END>
           DESTROY Verdana12-Occidentale
           DESTROY Verdana10B-Occidentale
           DESTROY Verdana12BI-Occidentale
           CALL "w$bitmap" USING WBITMAP-DESTROY, CERCA-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, BOTTONE-EXIT-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, BOTTONE-OK-BMP
      *    After-Program
           PERFORM ginqui-Ev-After-Program
           EXIT PROGRAM TOTEM-PgmStatus
           STOP RUN.

       INITIALIZE-ROUTINE.
      *    Before Init
      * initialize program status variable
           Initialize TOTEM-PgmStatus.
      * get system information
           ACCEPT SYSTEM-INFORMATION FROM SYSTEM-INFO.
      * get terminal information
           ACCEPT TERMINAL-ABILITIES FROM TERMINAL-INFO.
      * set font
           PERFORM INIT-FONT.
      * load bitmap
           PERFORM INIT-BMP.
      * load resource
           PERFORM INIT-RES.
      * create pop-up menu
           PERFORM INIT-POPUP.
      * open files
           PERFORM OPEN-FILE-RTN.
      *    After Init
           .
    
       INIT-FONT.
      * Verdana12-Occidentale
           INITIALIZE WFONT-DATA Verdana12-Occidentale
           MOVE 12 TO WFONT-SIZE
           MOVE "Verdana" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO FALSE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Verdana12-Occidentale, WFONT-DATA
      * Verdana10B-Occidentale
           INITIALIZE WFONT-DATA Verdana10B-Occidentale
           MOVE 10 TO WFONT-SIZE
           MOVE "Verdana" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO TRUE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Verdana10B-Occidentale, WFONT-DATA
      * Verdana12BI-Occidentale
           INITIALIZE WFONT-DATA Verdana12BI-Occidentale
           MOVE 12 TO WFONT-SIZE
           MOVE "Verdana" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO TRUE
           SET WFONT-ITALIC TO TRUE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Verdana12BI-Occidentale, WFONT-DATA
           .

       INIT-BMP.
      * pb-cerca
           COPY RESOURCE "CERCA.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "CERCA.BMP", 
                   GIVING CERCA-BMP.
      * pb-annulla2
           COPY RESOURCE "BOTTONE-EXIT.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "BOTTONE-EXIT.BMP", 
                   GIVING BOTTONE-EXIT-BMP.
      * pb-ok2
           COPY RESOURCE "BOTTONE-OK.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "BOTTONE-OK.BMP", 
                   GIVING BOTTONE-OK-BMP.
           .

       INIT-RES.
           .

       INIT-POPUP.
           .

       OPEN-FILE-RTN.
      *    Before Open
           PERFORM OPEN-articoli
           PERFORM OPEN-catart
      *    After Open
           .

       OPEN-articoli.
      * <TOTEM:EPT. INIT:vcatart, FD:articoli, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT articoli
           IF NOT Valid-STATUS-articoli
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:vcatart, FD:articoli, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-catart.
      * <TOTEM:EPT. INIT:vcatart, FD:catart, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT catart
           IF NOT Valid-status-catart
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:vcatart, FD:catart, AfterOpen>
      * <TOTEM:END>
           .

       CLOSE-FILE-RTN.
      *    Before Close
           PERFORM CLOSE-articoli
           PERFORM CLOSE-catart
      *    After Close
           .

       CLOSE-articoli.
      * <TOTEM:EPT. INIT:vcatart, FD:articoli, BeforeClose>
      * <TOTEM:END>
           CLOSE articoli
           .

       CLOSE-catart.
      * <TOTEM:EPT. INIT:vcatart, FD:catart, BeforeClose>
      * <TOTEM:END>
           CLOSE catart
           .

       articoli-art-k1-MERGE-SPLITBUF.
           INITIALIZE articoli-art-k1-SPLITBUF
           MOVE art-descrizione OF articoli(1:50) TO 
           articoli-art-k1-SPLITBUF(1:50)
           .

       DataSet1-articoli-INITSTART.
           IF DataSet1-articoli-KEY-Asc
              MOVE Low-Value TO art-chiave OF articoli
           ELSE
              MOVE High-Value TO art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-INITEND.
           IF DataSet1-articoli-KEY-Asc
              MOVE High-Value TO art-chiave OF articoli
           ELSE
              MOVE Low-Value TO art-chiave OF articoli
           END-IF
           .

      * articoli
       DataSet1-articoli-START.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY >= art-chiave OF articoli
           ELSE
              START articoli KEY <= art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-START-NOTGREATER.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY <= art-chiave OF articoli
           ELSE
              START articoli KEY >= art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-START-GREATER.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY > art-chiave OF articoli
           ELSE
              START articoli KEY < art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-START-LESS.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY < art-chiave OF articoli
           ELSE
              START articoli KEY > art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-articoli-LOCK
              READ articoli WITH LOCK 
              KEY art-chiave OF articoli
           ELSE
              READ articoli WITH NO LOCK 
              KEY art-chiave OF articoli
           END-IF
           PERFORM articoli-art-k1-MERGE-SPLITBUF
           MOVE STATUS-articoli TO TOTEM-ERR-STAT 
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-articoli-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-articoli-KEY-Asc
              IF DataSet1-articoli-LOCK
                 READ articoli NEXT WITH LOCK
              ELSE
                 READ articoli NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-articoli-LOCK
                 READ articoli PREVIOUS WITH LOCK
              ELSE
                 READ articoli PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM articoli-art-k1-MERGE-SPLITBUF
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-articoli-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-articoli-KEY-Asc
              IF DataSet1-articoli-LOCK
                 READ articoli PREVIOUS WITH LOCK
              ELSE
                 READ articoli PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-articoli-LOCK
                 READ articoli NEXT WITH LOCK
              ELSE
                 READ articoli NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM articoli-art-k1-MERGE-SPLITBUF
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-articoli-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-articoli-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-articoli-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterDelete>
      * <TOTEM:END>
           .

       catart-cat-art-princ-MERGE-SPLITBUF.
           INITIALIZE catart-cat-art-princ-SPLITBUF
           MOVE cat-princ OF catart(1:6) TO 
           catart-cat-art-princ-SPLITBUF(1:6)
           MOVE cat-codice OF catart(1:6) TO 
           catart-cat-art-princ-SPLITBUF(7:6)
           .

       DataSet1-catart-INITSTART.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-catart-KEY1-Asc
                 MOVE Low-Value TO cat-chiave OF catart
              ELSE
                 MOVE High-Value TO cat-chiave OF catart
              END-IF
           END-EVALUATE
           .

       DataSet1-catart-INITEND.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-catart-KEY1-Asc
                 MOVE High-Value TO cat-chiave OF catart
              ELSE
                 MOVE Low-Value TO cat-chiave OF catart
              END-IF
           END-EVALUATE
           .

       DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           .   

       DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-catart-KEY1-ORDER
           END-EVALUATE
           .

       DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-catart-KEY1-ORDER
           END-EVALUATE
           .

      * catart
       DataSet1-catart-START.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-catart-KEY1-Asc
                 START catart KEY >= cat-chiave OF catart
              ELSE
                 START catart KEY <= cat-chiave OF catart
              END-IF
           END-EVALUATE
           .

       DataSet1-catart-START-NOTGREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-catart-KEY1-Asc
                 START catart KEY <= cat-chiave OF catart
              ELSE
                 START catart KEY >= cat-chiave OF catart
              END-IF
           END-EVALUATE
           .

       DataSet1-catart-START-GREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-catart-KEY1-Asc
                 START catart KEY > cat-chiave OF catart
              ELSE
                 START catart KEY < cat-chiave OF catart
              END-IF
           END-EVALUATE
           .

       DataSet1-catart-START-LESS.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-catart-KEY1-Asc
                 START catart KEY < cat-chiave OF catart
              ELSE
                 START catart KEY > cat-chiave OF catart
              END-IF
           END-EVALUATE
           .

       DataSet1-catart-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:catart, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:catart, BeforeReadRecord>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-catart-LOCK
                 READ catart WITH LOCK 
                 KEY cat-chiave OF catart
              ELSE
                 READ catart WITH NO LOCK 
                 KEY cat-chiave OF catart
              END-IF
           END-EVALUATE
           PERFORM catart-cat-art-princ-MERGE-SPLITBUF
           MOVE status-catart TO TOTEM-ERR-STAT 
           MOVE "catart" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:catart, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:catart, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-catart-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:catart, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:catart, BeforeReadNext>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-catart-KEY1-Asc
                 IF DataSet1-catart-LOCK
                    READ catart NEXT WITH LOCK
                 ELSE
                    READ catart NEXT WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-catart-LOCK
                    READ catart PREVIOUS WITH LOCK
                 ELSE
                    READ catart PREVIOUS WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           PERFORM catart-cat-art-princ-MERGE-SPLITBUF
           MOVE status-catart TO TOTEM-ERR-STAT
           MOVE "catart" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:catart, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:catart, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-catart-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:catart, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:catart, BeforeReadPrev>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-catart-KEY1-Asc
                 IF DataSet1-catart-LOCK
                    READ catart PREVIOUS WITH LOCK
                 ELSE
                    READ catart PREVIOUS WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-catart-LOCK
                    READ catart NEXT WITH LOCK
                 ELSE
                    READ catart NEXT WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           PERFORM catart-cat-art-princ-MERGE-SPLITBUF
           MOVE status-catart TO TOTEM-ERR-STAT
           MOVE "catart" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:catart, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:catart, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-catart-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:catart, BeforeWrite>
      * <TOTEM:END>
           MOVE status-catart TO TOTEM-ERR-STAT
           MOVE "catart" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:catart, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-catart-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:catart, BeforeRewrite>
      * <TOTEM:END>
           MOVE status-catart TO TOTEM-ERR-STAT
           MOVE "catart" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:catart, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-catart-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:catart, BeforeDelete>
      * <TOTEM:END>
           MOVE status-catart TO TOTEM-ERR-STAT
           MOVE "catart" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:catart, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-INIT-RECORD.
           INITIALIZE art-rec OF articoli
           INITIALIZE cat-rec OF catart
           .


      * GRID
       gd-catena-Content.
      * CELLS' SETTING
              MODIFY gd-catena, X = 2, Y = 1,
                CELL-DATA = "Articolo",
      * CELLS' SETTING
              MODIFY gd-catena, X = 4, Y = 1,
                CELL-DATA = "Coll. 1",
      * CELLS' SETTING
              MODIFY gd-catena, X = 5, Y = 1,
                CELL-DATA = "Coll. 2",
      * CELLS' SETTING
              MODIFY gd-catena, X = 6, Y = 1,
                CELL-DATA = "Coll. 3",
      * CELLS' SETTING
              MODIFY gd-catena, X = 7, Y = 1,
                CELL-DATA = "Coll. 4",
      * CELLS' SETTING
              MODIFY gd-catena, X = 8, Y = 1,
                CELL-DATA = "Coll. 5",
      * CELLS' SETTING
              MODIFY gd-catena, X = 9, Y = 1,
                CELL-DATA = "Coll. 6",
      * CELLS' SETTING
              MODIFY gd-catena, X = 10, Y = 1,
                CELL-DATA = "Coll. 7",
      * CELLS' SETTING
              MODIFY gd-catena, X = 11, Y = 1,
                CELL-DATA = "Coll. 8",
      * CELLS' SETTING
              MODIFY gd-catena, X = 12, Y = 1,
                CELL-DATA = "Coll. 9",
      * CELLS' SETTING
              MODIFY gd-catena, X = 13, Y = 1,
                CELL-DATA = "Coll. 10",
      * CELLS' SETTING
              MODIFY gd-catena, X = 14, Y = 1,
                CELL-DATA = "Coll. 11",
      * CELLS' SETTING
              MODIFY gd-catena, X = 15, Y = 1,
                CELL-DATA = "Coll. 12",
      * CELLS' SETTING
              MODIFY gd-catena, X = 16, Y = 1,
                CELL-DATA = "Coll. 13",
      * CELLS' SETTING
              MODIFY gd-catena, X = 17, Y = 1,
                CELL-DATA = "Coll. 14",
      * CELLS' SETTING
              MODIFY gd-catena, X = 18, Y = 1,
                CELL-DATA = "Coll. 15",
      * CELLS' SETTING
              MODIFY gd-catena, X = 19, Y = 1,
                CELL-DATA = "Coll. 16",
      * CELLS' SETTING
              MODIFY gd-catena, X = 20, Y = 1,
                CELL-DATA = "Coll. 17",
      * CELLS' SETTING
              MODIFY gd-catena, X = 21, Y = 1,
                CELL-DATA = "Coll. 18",
      * CELLS' SETTING
              MODIFY gd-catena, X = 22, Y = 1,
                CELL-DATA = "Coll. 19",
      * CELLS' SETTING
              MODIFY gd-catena, X = 23, Y = 1,
                CELL-DATA = "Coll. 20",
           .

      * FD's Initialize Paragraph
       DataSet1-articoli-INITREC.
           INITIALIZE art-rec OF articoli
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-catart-INITREC.
           INITIALIZE cat-rec OF catart
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      *
       DataSet1-DISPATCH-BUFTOFLD.
           EVALUATE TOTEM-Form-Index ALSO TOTEM-Frame-Index
              WHEN 1 ALSO 0
                  PERFORM Form1-Buf-To-Fld
           END-EVALUATE
           .

       Form1-Open-Routine.
           PERFORM Form1-Scrn
           PERFORM Form1-Proc
           .

       Form1-Scrn.
           PERFORM Form1-Create-Win
           PERFORM Form1-Init-Value
           PERFORM Form1-Init-Data
      * Tab keystrok settings
      * Tool Bar
           PERFORM Form1-DISPLAY
           .

       Form1-Create-Win.
           Display Independent GRAPHICAL WINDOW
              LINES 49,69,
              SIZE 165,00,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 65793,
              CONTROL FONT Small-Font,
              LABEL-OFFSET 23,
              LINK TO THREAD,
              MODELESS,
              NO SCROLL,
              TITLE-BAR,
              TITLE titolo,
              WITH SYSTEM MENU,
              USER-GRAY,
           VISIBLE 1,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE Screen1-Event-Proc,
              HANDLE IS form1-Handle,
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
      * Status-bar
           DISPLAY Form1 UPON form1-Handle
      * DISPLAY-COLUMNS settings
              MODIFY gd-catena, DISPLAY-COLUMNS (1, 4, 14, 44, 54, 64, 
           74, 84, 94, 104, 114, 124, 134, 144, 154, 164, 174, 184, 
           194, 204, 214, 224, 234)
           .

       Form1-PROC.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeAccept>
           set CallManutenzione to false.
           perform RIEMPI-GRID

           move 2 to riga, EVENT-DATA-2
           modify gd-catena, CURSOR-Y = 2
           perform CAMBIA-FONT-RIGA

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT Form1
                 ON EXCEPTION
                    PERFORM Form1-Evaluate-Func
                 MOVE 1 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterEndAccept>
           if CallManutenzione
              perform ORDINE-DA-GRIGLIA
              set CallManutenzione to false
           end-if

      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY form1-Handle
           INITIALIZE Key-Status
           .

       Form1-Evaluate-Func.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM Form1-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM Form1-Exit
                 END-IF
              WHEN Key-Status = 1234
                 PERFORM pb-cerca-LinkTo
              WHEN Key-Status = 1000
                 PERFORM pb-ok2-LinkTo
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       Form1-CLEAR.
           PERFORM Form1-INIT-VALUE
           PERFORM Form1-DISPLAY
           .

       Form1-DISPLAY.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY Form1 UPON form1-Handle
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterDisplay>
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       Form1-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeExit>
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       Form1-Init-Data.
           MOVE 1 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
      * GRID
           PERFORM gd-catena-Content
           .

       Form1-DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-catart-KEY1-ORDER
           END-EVALUATE
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-catart-KEY1-ORDER
           END-EVALUATE
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Update-Key.
           MOVE cat-rec OF catart TO
                     Form1-MULKEY-TMPBUF
           PERFORM Form1-CLEAR
           PERFORM Form1-INIT-DATA
           MOVE Form1-MULKEY-TMPBUF TO
                     cat-rec OF catart
           PERFORM DataSet1-catart-Read
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-CURR
           PERFORM Form1-IUD-Display
           .

       Form1-DUPLICATE-MOVEKEY.
           .

       Form1-First.
           PERFORM Form1-DUMMY-FIRST
           PERFORM DataSet1-catart-INITSTART
           PERFORM DataSet1-catart-START
           IF NOT Valid-status-catart
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeFirst>
      * <TOTEM:END>
           PERFORM DataSet1-catart-Read-Next
           IF NOT Valid-status-catart
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterFirst>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY.
           PERFORM Form1-IUD-Display
           .

       Form1-Previous.
              PERFORM Form1-Buf-To-Fld
              PERFORM DataSet1-catart-START-LESS
           IF NOT Valid-status-catart
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforePrevious>
      * <TOTEM:END>
           PERFORM DataSet1-catart-Read-Prev
           IF NOT Valid-status-catart
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterPrevious>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-PREVIOUS
           PERFORM Form1-IUD-Display
           .

       Form1-Next.
              PERFORM Form1-Buf-To-Fld
              PERFORM DataSet1-catart-START-GREATER
           IF NOT Valid-status-catart
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeNext>
      * <TOTEM:END>
           PERFORM DataSet1-catart-Read-Next
           IF NOT Valid-status-catart
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterNext>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-NEXT
           PERFORM Form1-IUD-Display
           .
      
       Form1-Last.
           PERFORM Form1-DUMMY-LAST
           PERFORM DataSet1-catart-INITEND
           PERFORM DataSet1-catart-START-NOTGREATER
           IF NOT Valid-status-catart
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeLast>
      * <TOTEM:END>
           PERFORM DataSet1-catart-Read-Prev
           IF NOT Valid-status-catart
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterLast>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY.
           PERFORM Form1-IUD-Display
           .

       Form1-Curr.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeCurrent>
      * <TOTEM:END>
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-catart-Read
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-CURR
           PERFORM Form1-IUD-Display
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterCurrent>
      * <TOTEM:END>
           .

       Form1-IUD-Display.
           IF Valid-status-catart
              PERFORM Form1-ALLGRID-RESET
              PERFORM Form1-Fld-To-Buf
              PERFORM Form1-NAVI-FOR-MASTERGRID
              PERFORM Form1-DISPLAY
           ELSE
              IF Form1-FLAG-REFRESH
                 CONTINUE
              ELSE
                 PERFORM Form1-Extended-File-Status
              END-IF
           END-IF
           .

       Form1-Add.
           PERFORM Form1-Buf-To-Fld
           PERFORM Form1-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM Form1-DUMMY-ADD
           PERFORM DataSet1-catart-INITREC
           PERFORM Form1-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeAdd>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-catart-Rec-Write
           IF Valid-status-catart
              PERFORM Form1-RESUMMARY-INS
              PERFORM Form1-DUMMY-UPDATE-INIT
              MOVE "301" TO TOTEM-MSG-ID
              PERFORM Form1-IUD-Display
           END-IF
           PERFORM Form1-ERR-CHECKING
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterAdd>
      * <TOTEM:END>
           .
     
       Form1-Update.
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-catart-START              
           IF NOT Valid-status-catart
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
           PERFORM DataSet1-catart-Read
           PERFORM Form1-Buf-To-Fld
           PERFORM Form1-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM Form1-DUMMY-UPDATE
           PERFORM Form1-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeUpdate>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-catart-Rec-Rewrite
           IF Valid-status-catart
              PERFORM Form1-RESUMMARY-DEL
              PERFORM Form1-DUMMY-UPDATE-INIT
              MOVE "302" TO TOTEM-MSG-ID
              PERFORM Form1-IUD-Display
           END-IF
           PERFORM Form1-ERR-CHECKING
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterUpdate>
      * <TOTEM:END>
           .

       Form1-Delete.
           MOVE "203" TO TOTEM-MSG-ID
           PERFORM MESSAGE-BOX-DISPLAY
           IF TOTEM-MSG-RETURN-VALUE NOT = 1
              INITIALIZE TOTEM-MSG-TEXT
              EXIT PARAGRAPH 
           END-IF
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDelete>
      * <TOTEM:END>
           PERFORM Form1-DUMMY-DELETE
      * delete
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-catart-Rec-Delete
           IF Valid-status-catart
              PERFORM Form1-CLEAR
              PERFORM Form1-DUMMY-DELETE-INIT
              MOVE "303" TO TOTEM-MSG-ID
              MOVE "00" to status-catart
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterDelete>
      * <TOTEM:END>
           PERFORM Form1-ERR-CHECKING
           .

       Form1-NAVI-FOR-MASTERGRID.
           .

       Form1-ERR-CHECKING.
           IF Valid-status-catart
              PERFORM Form1-SHOW-MSG-ROUTINE
           ELSE
              PERFORM Form1-Extended-File-Status
           END-IF
           .

       Form1-RESUMMARY-INS.
           .

       Form1-RESUMMARY-DEL.
           .


       Form1-DUMMY-FIRST.
           .

       Form1-DUMMY-PREVIOUS.
           .

       Form1-DUMMY-NEXT.
           .

       Form1-DUMMY-LAST.
           .

       Form1-DUMMY-CURR.
           .

       Form1-DUMMY-ADD.
           .

       Form1-DUMMY-UPDATE.
           .

       Form1-DUMMY-UPDATE-INIT.
           .

       Form1-DUMMY-DELETE.
           .

       Form1-DUMMY-DELETE-INIT.
           .

       Form1-Init-Value.
           MOVE titolo TO TOTEM-MSG-TITLE
      * FORM : Form1
           PERFORM DataSet1-INIT-RECORD
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, SetDefault>
      * <TOTEM:END>
           PERFORM Form1-FLD-TO-BUF
           .


       Form1-ALLGRID-RESET.
           .

      * for Form's Validation
       Form1-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       Form1-Buf-To-Fld.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterBufToFld>
      * <TOTEM:END>
           .

       Form1-Fld-To-Buf.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeFldToBuf>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterFldToBuf>
      * <TOTEM:END>
           .

       Form1-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform Form1-BUF-TO-FLD.
           move 0 to scelta.
           .
       Form1-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM Form1-SHOW-MSG-ROUTINE
           .

       Form1-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM Form1-DISPLAY-MESSAGE
           .

       Form1-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       Form1-Save-Status.
           MOVE DataSet1-catart-KEY1-ORDER TO TMP-Form1-KEY1-ORDER
           MOVE DataSet1-KEYIS TO TMP-Form1-KEYIS
           MOVE cat-rec OF catart TO 
              TMP-Form1-catart-RESTOREBUF
           .             

       Form1-Restore-Status.
           MOVE TMP-Form1-KEY1-ORDER TO DataSet1-catart-KEY1-ORDER
           MOVE TMP-Form1-KEYIS TO DataSet1-KEYIS
           MOVE TMP-Form1-catart-RESTOREBUF TO
              cat-rec OF catart
           PERFORM DataSet1-catart-START
           IF Valid-status-catart
              PERFORM DataSet1-catart-Read-Next
           ELSE
              PERFORM DataSet1-catart-INITREC
           END-IF
           PERFORM UNTIL NOT Valid-status-catart OR
              (Valid-status-catart AND
                 cat-rec OF catart = 
                   TMP-Form1-catart-RESTOREBUF)
              PERFORM DataSet1-catart-Read-Next
           END-PERFORM
           .



       Screen1-Event-Proc.
           .

       Screen1-Gd-1-Event-Proc.
           EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
           WHEN Msg-Begin-Drag ALSO 1 ALSO
                    form1-Handle 
              PERFORM gd-ordini-Ev-Msg-Begin-Drag
           WHEN Msg-Begin-Entry ALSO 1 ALSO
                    form1-Handle 
              PERFORM gd-ordini-Ev-Msg-Begin-Entry
           WHEN Msg-End-Drag ALSO 1 ALSO
                    form1-Handle 
              PERFORM gd-ordini-Ev-Msg-End-Drag
           WHEN Msg-Goto-Cell ALSO 1 ALSO
                    form1-Handle 
              PERFORM gd-ordini-Ev-Msg-Goto-Cell
           WHEN Msg-Goto-Cell-Drag ALSO 1 ALSO
                    form1-Handle 
              PERFORM gd-ordini-Ev-Msg-Goto-Cell-Drag
           WHEN Msg-Goto-Cell-Mouse ALSO 1 ALSO
                    form1-Handle 
              PERFORM gd-ordini-Ev-Msg-Goto-Cell-Mouse
           END-EVALUATE
           .

      * USER DEFINE PARAGRAPH
       CAMBIA-FONT-RIGA.
      * <TOTEM:PARA. CAMBIA-FONT-RIGA>
           modify gd-catena(riga), ROW-FONT = small-font.

           modify gd-catena(riga, 1),
                  bitmap        = elemento-bmp,
                  bitmap-number = 1,
                  bitmap-width  = 16.


           move event-data-2 to riga.
           modify gd-catena(riga), ROW-FONT = font-evidenzia-griglia..

           modify gd-catena, (riga, 1),
                  bitmap        = elemento-bmp,
                  bitmap-number = 2,
                  bitmap-width  = 16.


      *     display form1 
           .
      * <TOTEM:END>

       CARICA-CATENE.
      * <TOTEM:PARA. CARICA-CATENE>
           move low-value to cat-codice
                             cat-princ

           start catart key not < cat-art-princ 
              invalid 
                      continue
              not invalid 
                 perform SCORRI-CATENE
           end-start
           .
      * <TOTEM:END>

       CHIAMA-MANUTENZIONE.
      * <TOTEM:PARA. CHIAMA-MANUTENZIONE>
           read articoli no lock 
                invalid continue
            not invalid
                modify form2-Handle, visible = 0
                call   "varticoli" using art-codice
                cancel "varticoli"
                modify form2-Handle, visible = 1
           end-read 
           .
      * <TOTEM:END>

       METTI-IN-GRIGLIA.
      * <TOTEM:PARA. METTI-IN-GRIGLIA>
           initialize rec-grid
           move cat-codice         to Col-art-princ    
                                      art-codice
           read articoli no lock
              invalid
                 initialize art-descrizione
           end-read
           move art-descrizione    to col-desc-art-princ

           perform varying idx from 1 by 1 until idx > cat-num-el-catena
              move cat-collegato(idx) to col-collegato(idx)
              if idx = 20
                 exit perform
              end-if
           end-perform

           modify gd-catena, RECORD-TO-ADD rec-grid.

           inquire gd-catena, LAST-ROW = riga 
           .
      * <TOTEM:END>

       ORDINE-DA-GRIGLIA.
      * <TOTEM:PARA. ORDINE-DA-GRIGLIA>
           evaluate colonna
           when 3|descrizione articolo
                inquire gd-catena(riga, 2), CELL-DATA art-codice
           when other
                inquire gd-catena(riga, colonna), CELL-DATA art-codice
           end-evaluate

           move riga   to como-riga
           move colonna   to como-colonna

           perform CHIAMA-MANUTENZIONE.

           move como-colonna to colonna
                                EVENT-DATA-2
           move como-riga    to riga, 
                                EVENT-DATA-2.
           perform SPOSTAMENTO.

           modify gd-catena, cursor-y = riga.
           perform CAMBIA-FONT-RIGA 
           .
      * <TOTEM:END>

       PARAGRAFO-COPY.
      * <TOTEM:PARA. PARAGRAFO-COPY>
           copy "utydata.cpy".
           copy "color-custom.cpy" 
           .
      * <TOTEM:END>

       RIEMPI-GRID.
      * <TOTEM:PARA. RIEMPI-GRID>
           modify gd-catena, mass-update = 1.
           modify gd-catena, reset-grid = 1.
           perform GD-CATENA-CONTENT.
           perform CARICA-CATENE.
           modify gd-catena, mass-update = 0 
           .
      * <TOTEM:END>

       SCORRI-CATENE.
      * <TOTEM:PARA. SCORRI-CATENE>
           set trovato to false.

           modify gd-catena, mass-update 1.

           perform until 1 = 2
              read catart next 
                 at end 
                    exit perform 
              end-read

              if cat-princ not = zero
                 exit perform 
              end-if

              perform METTI-IN-GRIGLIA 
           end-perform.

           modify gd-catena, mass-update 0 
           .
      * <TOTEM:END>

       SPOSTAMENTO.
      * <TOTEM:PARA. SPOSTAMENTO>
           inquire gd-catena, last-row in tot-righe.
           if event-data-2 < 2 
              move 2 to event-data-2 
           end-if.
           if event-data-2 > tot-righe 
              move tot-righe to event-data-2 
           end-if.
           if riga not = event-data-2 
              perform CAMBIA-FONT-RIGA
           end-if.

           move event-data-1 to colonna

           perform PUNTA-CELLA
           .
      * <TOTEM:END>

       PUNTA-CELLA.
      * <TOTEM:PARA. PUNTA-CELLA>
           evaluate colonna
           when 3|descrizione articolo
                inquire gd-catena(riga, 2), cell-data art-codice
           when other
                inquire gd-catena(riga, colonna), cell-data art-codice
           end-evaluate


           read articoli no lock
              invalid
                 initialize art-descrizione
           end-read
           move art-descrizione to lbl-descr-art-buf

           modify lbl-descr-art title lbl-descr-art-buf

           .
      * <TOTEM:END>

      * EVENT PARAGRAPH
       ginqui-Ev-Before-Program.
      * <TOTEM:PARA. ginqui-Ev-Before-Program>
      * Verdana10B-Occidentale
           INITIALIZE WFONT-DATA, font-evidenzia-griglia
           MOVE 10                TO WFONT-SIZE
           MOVE "Arial"           TO WFONT-NAME
           SET WFONT-BOLD         TO true
           SET WFONT-ITALIC       TO true
           SET WFONT-UNDERLINE    TO FALSE
           SET WFONT-STRIKEOUT    TO FALSE
           SET WFONT-FIXED-PITCH  TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     font-evidenzia-griglia, WFONT-DATA

           copy resource "elemento.bmp".
           call "W$BITMAP" using wbitmap-load, "elemento.bmp"
                          giving elemento-bmp.
           move LK-BL-PROG-ID    TO COMO-PROG-ID 
           .
      * <TOTEM:END>
       ginqui-Ev-After-Program.
      * <TOTEM:PARA. ginqui-Ev-After-Program>
           DESTROY font-evidenzia-griglia.

           call "W$BITMAP" using wbitmap-destroy, elemento-bmp.
           SET LK-BL-CANCELLAZIONE TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM 
           .
      * <TOTEM:END>
       gd-ordini-Ev-Msg-Begin-Entry.
      * <TOTEM:PARA. gd-ordini-Ev-Msg-Begin-Entry>
           inquire gd-catena, entry-reason in como-x.

           set EVENT-ACTION to EVENT-ACTION-FAIL-TERMINATE.
           evaluate como-x
           when X"00"|doppio click
           when X"0D"|invio
                inquire gd-catena, CURSOR-Y = riga
                set CallManutenzione to true
           end-evaluate 
           .
      * <TOTEM:END>
       gd-ordini-Ev-Msg-Goto-Cell.
      * <TOTEM:PARA. gd-ordini-Ev-Msg-Goto-Cell>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd-ordini-Ev-Msg-Goto-Cell-Mouse.
      * <TOTEM:PARA. gd-ordini-Ev-Msg-Goto-Cell-Mouse>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd-ordini-Ev-Msg-End-Drag.
      * <TOTEM:PARA. gd-ordini-Ev-Msg-End-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd-ordini-Ev-Msg-Begin-Drag.
      * <TOTEM:PARA. gd-ordini-Ev-Msg-Begin-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd-ordini-Ev-Msg-Goto-Cell-Drag.
      * <TOTEM:PARA. gd-ordini-Ev-Msg-Goto-Cell-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       pb-annulla2-BeforeProcedure.
      * <TOTEM:PARA. pb-annulla2-BeforeProcedure>
           modify pb-annulla2, bitmap-number 2
           .
      * <TOTEM:END>
       pb-annulla2-AfterProcedure.
      * <TOTEM:PARA. pb-annulla2-AfterProcedure>
           modify pb-annulla2, bitmap-number 1
           .
      * <TOTEM:END>
       pb-ok2-BeforeProcedure.
      * <TOTEM:PARA. pb-ok2-BeforeProcedure>
           modify pb-ok2, bitmap-number 2
           .
      * <TOTEM:END>
       pb-ok2-AfterProcedure.
      * <TOTEM:PARA. pb-ok2-AfterProcedure>
           modify pb-ok2, bitmap-number 1
           .
      * <TOTEM:END>
       pb-ok2-LinkTo.
      * <TOTEM:PARA. pb-ok2-LinkTo>
           inquire gd-catena, CURSOR-Y = riga.

           perform ORDINE-DA-GRIGLIA 
           .
      * <TOTEM:END>
       Screen1-Ef-1-BeforeProcedure.
      * <TOTEM:PARA. Screen1-Ef-1-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       Screen1-Ef-1-AfterProcedure.
      * <TOTEM:PARA. Screen1-Ef-1-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       pb-cerca-BeforeProcedure.
      * <TOTEM:PARA. pb-cerca-BeforeProcedure>
           modify pb-cerca, bitmap-number = 2 
           .
      * <TOTEM:END>
       pb-cerca-AfterProcedure.
      * <TOTEM:PARA. pb-cerca-AfterProcedure>
           modify pb-cerca, bitmap-number = 1 
           .
      * <TOTEM:END>
       pb-cerca-LinkTo.
      * <TOTEM:PARA. pb-cerca-LinkTo>
           inquire ef-art, value in ef-art-buf.

           move 0 to ResultSearch

           inquire gd-catena, cursor-y in store-riga

           inquire gd-catena, search-options in grid-search-options
           
           |direzione di ricerca
           set GRID-SEARCH-FORWARDS to true
           set GRID-SEARCH-WRAP     to true

           set GRID-SEARCH-IGNORE-CASE to true.

           |trova la parola nella cella
           set GRID-SEARCH-MATCH-ANY to true

           |ricerca nelle sole celle visible 
           |ignorando gli eventuali hidden-data
           set GRID-SEARCH-VISIBLE to true

           |non considerare quello su cui sono posizionato
           set GRID-SEARCH-SKIP-CURRENT   to true

           |si posiziona sulla cella trovata
           set GRID-SEARCH-MOVES-CURSOR   to true 

           perform CERCA-TESTO.
           if not trovato
              set GRID-SEARCH-FORWARDS to false
              perform CERCA-TESTO
              if not trovato
                 display message box MSG-Testo-non-trovato
                               title titolo
              end-if
           end-if.

           if trovato
              move 1 to control-id
              move 4 to accept-control
           end-if.

      ***---
       CERCA-TESTO.
           set trovato to false.
           |num colonna sulla quale fare la ricerca
           move 1 to GRID-SEARCH-COLUMN 
           perform 15 times
              add 1 to GRID-SEARCH-COLUMN 
              modify gd-catena, search-options GRID-SEARCH-OPTIONS
              modify gd-catena(riga, tipo-ricerca), 
                     search-text ef-art-buf |testo da ricercare
                          giving ResultSearch |1, 2 = trovato 0 = non trovato

              if ResultSearch = GRDSRCH-NOT-FOUND
                 continue
              else
                 set trovato to true
                 exit perform
              end-if
           end-perform 
           .
      * <TOTEM:END>

      *{TOTEM}END

      *{TOTEM}SHOW-MSG
       MESSAGE-FOR-FILEERROR.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
              MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           .

       SHOW-TRANSACTION-ROUTINE.
           IF TOTEM-TRANSACTION-FLAG = SPACES
              IF TRANSACTION-STATUS NOT = 0
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-1
              END-IF
           ELSE
              PERFORM SHOW-MSG-ROUTINE
              IF TRANSACTION-STATUS = 0
                 MOVE "Transazione terminata con Rollback." TO 
           TOTEM-MSG-3
              ELSE
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-3
              END-IF
           END-IF
           .

       SHOW-MSG-ROUTINE.
           MOVE SPACE TO TOTEM-MSG-1 TOTEM-MSG-2 TOTEM-MSG-3
           EVALUATE TOTEM-MSG-ID
               WHEN "10"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Nessun altro dato." TO TOTEM-MSG-2
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "22"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Chiave Duplicata." TO TOTEM-MSG-2
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "23"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Raggiunta fine file." TO TOTEM-MSG-2
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "101"
                    MOVE "Terminare l'applicazione?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "201"
                    MOVE "Aggiungere un nuovo record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "202"
                    MOVE "Aggiornare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "203"
                    MOVE "Cancellare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "204"
                    MOVE "Chiave duplicata." TO TOTEM-MSG-1
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "301"
                    MOVE "Inserimento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "302"
                    MOVE "Aggiornamento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "303"
                    MOVE "Cancellazione avvenuta con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "401"
                    MOVE "Shell non trovata." TO TOTEM-MSG-1
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN OTHER
                    MOVE TEXT-MESSAGE TO TOTEM-MSG-1
                    STRING "FILE:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-3
                    MOVE 0 TO TOTEM-IDX1
                    INSPECT TOTEM-MSG-3 TALLYING TOTEM-IDX1
                       FOR TRAILING SPACE
                    STRING TOTEM-MSG-3(1:TOTEM-MSG-LENGTH - 
           TOTEM-IDX1), 
                       ", FILE STATUS ", PRIMARY-ERROR "," 
                       SECONDARY-ERROR
                    DELIMITED BY SIZE INTO TOTEM-MSG-2
                    MOVE SPACES TO TOTEM-MSG-3
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
           END-EVALUATE
           PERFORM MESSAGE-BOX-ROUTINE
           .

       MESSAGE-BOX-ROUTINE.
           MOVE 1 TO TOTEM-MSG-TEXT-POINTER
           IF TOTEM-MSG-1 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-1 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              STRING TOTEM-MSG-1( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                 DELIMITED BY SIZE
                 INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-2 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-2 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-2( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-3 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-3 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-3( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-TEXT-POINTER = 1
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-TEXT TALLYING TOTEM-MSG-SIZE FOR 
           TRAILING SPACE
                  COMPUTE TOTEM-MSG-TEXT-POINTER = 
           TOTEM-MSG-FULL-LENGTH - TOTEM-MSG-SIZE + 1
           END-IF
           MOVE LOW-VALUES TO TOTEM-MSG-TEXT(TOTEM-MSG-TEXT-POINTER : 1 
           )
           .

       MESSAGE-BOX-DISPLAY.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

      *{TOTEM}END

