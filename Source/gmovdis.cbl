      *{TOTEM}PRG-COMMENT
      * gmovdis.Cbl
      * gmovdis.Cbl is generated by TOTEM
      * This is a generated file. DO NOT modify this file directly.
      *{TOTEM}END
       IDENTIFICATION       DIVISION.
      *{TOTEM}PRGID
       PROGRAM-ID.          gmovdis.
       AUTHOR.              ANDREA EVENTI.
       DATE-WRITTEN.        lunedì 2 febbraio 2015 16:57:16.
       REMARKS.
      *{TOTEM}END

       ENVIRONMENT          DIVISION.
       CONFIGURATION        SECTION.
       SPECIAL-NAMES.
      *{TOTEM}SPECIAL-NAME
      * <TOTEM:EPT. INIT:gmovdis, INIT:gmovdis, SpecialName>
      * <TOTEM:END>
      *{TOTEM}END
      *{TOTEM}ACTIVEX-DEF
      *{TOTEM}END
      *{TOTEM}DECIMAL-POINT
           DECIMAL-POINT IS COMMA.
      *{TOTEM}END

       INPUT-OUTPUT         SECTION.
       FILE-CONTROL.
      *{TOTEM}FILE-CONTROL
           COPY "tmovmag.sl".
           COPY "rmovmag.sl".
           COPY "tparamge.sl".
           COPY "tcodpag.sl".
           COPY "articoli.sl".
           COPY "tcaudisb.sl".
           COPY "tcaumag.sl".
           COPY "clienti.sl".
           COPY "timballi.sl".
           COPY "distinteb.sl".
           COPY "timbalqta.sl".
           COPY "progmag.sl".
           COPY "tmagaz.sl".
           COPY "zoom-distinteb.sl".
           COPY "tmarche.sl".
           COPY "timposte.sl".
      *{TOTEM}END
       DATA                 DIVISION.
       FILE                 SECTION.
      *{TOTEM}FILE
           COPY "tmovmag.fd".
           COPY "rmovmag.fd".
           COPY "tparamge.fd".
           COPY "tcodpag.fd".
           COPY "articoli.fd".
           COPY "tcaudisb.fd".
           COPY "tcaumag.fd".
           COPY "clienti.fd".
           COPY "timballi.fd".
           COPY "distinteb.fd".
           COPY "timbalqta.fd".
           COPY "progmag.fd".
           COPY "tmagaz.fd".
           COPY "zoom-distinteb.fd".
           COPY "tmarche.fd".
           COPY "timposte.fd".
      *{TOTEM}END

       WORKING-STORAGE      SECTION.
      *{TOTEM}ACU-DEF
               COPY "acugui.def".
               COPY "acucobol.def".
               COPY "fonts.def".
               COPY "crtvars.def".
               COPY "showmsg.def".
               COPY "totem.def".
               COPY "F:\lubex\geslux\Copylib\standard.def".
      *{TOTEM}END

      *{TOTEM}COPY-WORKING
      * Key Status
       77 Key-Status IS SPECIAL-NAMES CRT STATUS PIC 9(5) VALUE 0.
          88 Enter-Pushed VALUE 13.
          88 Exit-Pushed VALUE 27.
          88 Message-Received VALUE 95.
          88 Event-Occurred VALUE 96.
          88 Screen-No-Input-Field VALUE 97.
      * Properties & User defined Working Stoarge
           COPY  "LINK-WPROGMAG.DEF".
           COPY  "EXTERNALS.DEF".
           COPY  "LINK-NAMBAR.DEF".
           COPY  "COSTO-MEDIO.DEF".
           COPY  "IMPOSTE.DEF".
       77 data-ult-movim   PIC  9(8).
       77 como-articolo    PIC  9(6).
       77 ef-oneri-buf     PIC  ----.---.---.--9,99.
       77 ef-tot-utf-buf   PIC  zzz.zz9,999.
       77 ef-tot-non-utf-buf           PIC  zzz.zz9,999.
       77 ef-tot-prezzo-buf            PIC  ----.---.---.--9,99.
       77 ArticoloInUso    PIC  9(6).
       77 ef-tot-oneri-buf PIC  zzz.zzz.zzz.zz9,99.
       77 col-oneri-num    PIC  s9(15)v99.
       77 tot-peso-utf-t   PIC  9(5)v999.
       77 tot-peso-utf-r   PIC  9(5)v999.
       77 num-movim-testa  PIC  9(10).
       77 num-movim-righe  PIC  9(10).
       77 SavePesoT        PIC  s9(15)v999.
       77 SavePesoR        PIC  s9(15)v999.
       01 SaveKeyT.
           05 SaveAnnoT        PIC  9(4).
           05 SaveNumT         PIC  9(8).
       01 SaveKeyR.
           05 SaveAnnoR        PIC  9(4).
           05 SaveNumR         PIC  9(8).
       77 STATUS-distinteb PIC  X(2).
           88 Valid-STATUS-distinteb VALUE IS "00" THRU "09". 
       77 lab-des-buf      PIC  x(50).
      **** HANDLES
       77 Verdana10-Occidentale
                  USAGE IS HANDLE OF FONT.
       01 hid-dati-articolo.
           05 hid-marca-prodotto           PIC  9(4).
           05 hid-peso-udm     PIC  9(5)v999.
           05 hid-art-um       PIC  xx.
       77 somma-utf        PIC  9(15)v999.
       77 como-utf         PIC  9(15)v999.
       77 somma-oneri      PIC  9(15)v999.
       77 como-oneri       PIC  9(15)v999.
       77 somma-non-utf    PIC  9(15)v999.
       77 como-non-utf     PIC  9(15)v999.
       77 somma-prezzo     PIC  9(15)v999.
       77 como-prezzo      PIC  9(15)v999.
       77 num-articoli     PIC  9(3).
       77 como-peso        PIC  9(9)v9(3).
       77 somma-peso       PIC  9(9)v9(3).
       77 peso-totale      PIC  9(9)v9(3).
       01 rec-grid.
           05 col-idx          PIC  99.
           05 col-art          PIC  z(6)
                      BLANK WHEN ZERO.
           05 col-mag          PIC  x(3).
           05 col-imb          PIC  x(3).
           05 col-peso         PIC  zz9,999
                      BLANK WHEN ZERO.
           05 col-des          PIC  x(100).
           05 col-utf          PIC  zz9,999
                      BLANK WHEN ZERO.
           05 col-non-utf      PIC  zz9,999
                      BLANK WHEN ZERO.
           05 col-mp           PIC  ----.---.---.--9,99
                      BLANK WHEN ZERO.
           05 col-qta          PIC  zz.zzz.zz9,999
                      BLANK WHEN ZERO.
           05 col-oneri        PIC  ----.---.---.--9,99
                      BLANK WHEN ZERO.
           05 col-giacenza     PIC  ----.---.---.--9.
       77 descr-articolo   PIC  x(100).
       77 Default-Font
                  USAGE IS HANDLE OF FONT DEFAULT-FONT.
       77 Small-Font
                  USAGE IS HANDLE OF FONT SMALL-FONT.
       77 Form1-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 Form1-Tb-1-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 Screen1-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 Form1-St-1-Handle
                  USAGE IS HANDLE OF STATUS-BAR.
       77 bottone-ok-bmp
                  USAGE IS HANDLE OF BITMAP.
       77 Default-bmp
                  USAGE IS HANDLE OF BITMAP.
       77 toolbar-bmp
                  USAGE IS HANDLE OF BITMAP.
       77 STRIP-GRID-GCLIENTI-BMP
                  USAGE IS HANDLE OF BITMAP.
      **** FLAGS
       77 filler           PIC  xx.
           88 TotaleSizero VALUE IS "SI". 
           88 TotaleNozero VALUE IS "NO". 
       77 filler           PIC  9.
           88 CallWProgmag VALUE IS 1,    WHEN SET TO FALSE  0. 
       77 filler           PIC  9.
           88 MovimentoConsolidato VALUE IS 1,    WHEN SET TO FALSE  0. 
       77 StatusPass       PIC  9.
           88 StatusOk VALUE IS 1,    WHEN SET TO FALSE  0. 
       01 filler           PIC  x.
           88 ArtAttivo VALUE IS "A". 
           88 ArtBloccato VALUE IS "B". 
           88 ArtDisattivo VALUE IS "D". 
       78 titolo VALUE IS "Geslux - Distinta Base, Movimentazioni - Cari
      -    "chi e scarichi". 
       77 nome-pgm         PIC  x(25).
       77 StoreMagazzino   PIC  x(3).
       77 como-qta         PIC  9(8)V9(3).
       77 decimali         PIC  9(3).
       77 qta-arrotondata  PIC  9(8).
       77 imballi-ed       PIC  zz.zz9.
       77 codice-x         PIC  x(5).
       77 como-anno        PIC  9(4).
       77 countchar        PIC  9(3).
       77 e-esci           PIC  9
                  VALUE IS 1.
       77 e-nuovo          PIC  9
                  VALUE IS 0.
       77 save-codice      PIC  9(8).
       77 e-salva          PIC  9
                  VALUE IS 1.
       77 e-cancella       PIC  9
                  VALUE IS 1.
       77 e-modifica       PIC  9
                  VALUE IS 0.
       77 e-anteprima      PIC  9
                  VALUE IS 0.
       77 e-stampa         PIC  9
                  VALUE IS 0.
       77 e-cerca          PIC  9
                  VALUE IS 0.
       77 data-oggi        PIC  9(8).
       77 e-seleziona      PIC  9
                  VALUE IS 1.
       77 mod-campi        PIC  9
                  VALUE IS 0.
       77 cbo-stato-buf    PIC  x(10).
       77 codice-ed        PIC  z(5).
       77 lab-desmag-buf   PIC  x(50).
       77 lab-codmag-buf   PIC  x(3).
       77 lab-des-cau-buf  PIC  x(50).
       77 lab-cau-buf      PIC  x(4).
       77 lab-data-buf     PIC  99/99/9999.
       77 auto-id          PIC  9(6)
                  VALUE IS 0.
       77 numero-edit      PIC  z(8).
       77 ef-definitivo-buf            PIC  9(5)v999.
       77 v-cons           PIC  9
                  VALUE IS 0.
       77 lab-pag-buf      PIC  x(100).
      *
      ***FILE STATUS
       77 STATUS-clienti   PIC  X(2).
           88 Valid-STATUS-clienti VALUE IS "00" THRU "09". 
       77 STATUS-tcodpag   PIC  X(2).
           88 Valid-STATUS-tcodpag VALUE IS "00" THRU "09". 
       77 STATUS-articoli  PIC  X(2).
           88 Valid-STATUS-articoli VALUE IS "00" THRU "09". 
       77 STATUS-tparamge  PIC  X(2).
           88 Valid-STATUS-tparamge VALUE IS "00" THRU "09". 
       77 STATUS-rmovmag   PIC  X(2).
           88 Valid-STATUS-rmovmag VALUE IS "00" THRU "09". 
       77 STATUS-tcaumag   PIC  X(2).
           88 Valid-STATUS-tcaumag VALUE IS "00" THRU "09". 
       77 STATUS-tmovmag   PIC  X(2).
           88 Valid-STATUS-tmovmag VALUE IS "00" THRU "09". 
       77 STATUS-timballi  PIC  X(2).
           88 Valid-STATUS-timballi VALUE IS "00" THRU "09". 
       77 STATUS-timbalqta PIC  X(2).
           88 Valid-STATUS-timbalqta VALUE IS "00" THRU "09". 
       77 STATUS-tcaudisb  PIC  X(2).
           88 Valid-STATUS-tcaudisb VALUE IS "00" THRU "09". 
       77 ef-art-buf       PIC  z(6).
       77 ef-qta-buf       PIC  zz.zzz.zz9.
       77 STATUS-progmag   PIC  X(2).
           88 Valid-STATUS-progmag VALUE IS "00" THRU "09". 
       77 form-num-SF-HANDLE
                  USAGE IS HANDLE OF WINDOW.
       77 fatto-bmp        PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 Verdana12-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 Verdana11-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 Impact24-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 num-carico-edit  PIC  zz.zzz.zz9.
       77 peso-utf-carico-edit         PIC  zz.zz9,999.
       77 num-scarico-edit PIC  zz.zzz.zz9.
       77 peso-utf-scarico-edit        PIC  zz.zz9,999.
       77 STATUS-tmagaz    PIC  X(2).
           88 Valid-STATUS-tmagaz VALUE IS "00" THRU "09". 
       77 path-zoom-distinteb          PIC  X(256).
       77 STATUS-zoom-distinteb        PIC  X(2).
           88 Valid-STATUS-zoom-distinteb VALUE IS "00" THRU "09". 
       77 STATUS-timposte  PIC  X(2).
           88 Valid-STATUS-timposte VALUE IS "00" THRU "09". 
       77 STATUS-tmarche   PIC  X(2).
           88 Valid-STATUS-tmarche VALUE IS "00" THRU "09". 

      ***********************************************************
      *   Code Gen's Buffer                                     *
      ***********************************************************
       77 STATUS-Form1-FLAG-REFRESH PIC  9.
          88 Form1-FLAG-REFRESH  VALUE 1 FALSE 0. 
      * DATA CONTROL BUFFER
       01 Form1-BUF.
      * Data.Entry-Field
              05 ef-data-BUF PIC 99/99/9999.
              05 ef-data-VALUEBUF PIC 9(8).
      * Data.Entry-Field
              05 ef-causale-BUF PIC X(4).
              05 ef-causale-VALUEBUF PIC X(4).
      * Data.Entry-Field
              05 ef-for-BUF PIC x(5).
              05 ef-for-VALUEBUF PIC 9(5).
      * Data.Entry-Field
              05 ef-num-BUF PIC 9(8).
      * Data.Entry-Field
              05 ef-data-doc-BUF PIC 99/99/9999.
      * Data.Entry-Field
              05 ef-pag-BUF PIC X(3).
      * Data.Label
              05 lab-causale-BUF PIC X(40).
      * Data.Label
              05 lab-for-BUF PIC X(40).
      * Data.Label
              05 lab-carico-BUF PIC X(4).
      * Data.Label
              05 lab-scarico-BUF PIC X(4).
      * Data.Entry-Field
              05 ef-art-v-BUF PIC z(6).
      * Data.Entry-Field
              05 ef-mag-BUF PIC X(3).
      * Data.Entry-Field
              05 ef-imb-BUF PIC X(3).
      * Data.Entry-Field
              05 ef-peso-BUF PIC zz9,999.
      * Data.Entry-Field
              05 ef-peso-utf-BUF PIC zz9,999.
      * Data.Entry-Field
              05 ef-peso-non-utf-BUF PIC zz9,999.
      * Data.Entry-Field
              05 ef-mp-BUF PIC ----.---.---.--9,99.

       77 TMP-Form1-KEY1-ORDER  PIC X VALUE "A".
       77 TMP-Form1-tmovmag-RESTOREBUF  PIC X(256).
       77 TMP-Form1-KEYIS  PIC 9(3) VALUE 1.
       77 Form1-MULKEY-TMPBUF   PIC X(256).
       77 STATUS-form-num-FLAG-REFRESH PIC  9.
          88 form-num-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 TMP-DataSet1-tmovmag-BUF     PIC X(256).
       77 TMP-DataSet1-rmovmag-BUF     PIC X(446).
       77 TMP-DataSet1-tparamge-BUF     PIC X(815).
       77 TMP-DataSet1-tcodpag-BUF     PIC X(1380).
       77 TMP-DataSet1-articoli-BUF     PIC X(3669).
       77 TMP-DataSet1-tcaudisb-BUF     PIC X(209).
       77 TMP-DataSet1-tcaumag-BUF     PIC X(254).
       77 TMP-DataSet1-clienti-BUF     PIC X(1910).
       77 TMP-DataSet1-timballi-BUF     PIC X(210).
       77 TMP-DataSet1-distinteb-BUF     PIC X(672).
       77 TMP-DataSet1-timbalqta-BUF     PIC X(167).
       77 TMP-DataSet1-progmag-BUF     PIC X(1090).
       77 TMP-DataSet1-tmagaz-BUF     PIC X(212).
       77 TMP-DataSet1-zoom-distinteb-BUF     PIC X(197).
       77 TMP-DataSet1-tmarche-BUF     PIC X(217).
       77 TMP-DataSet1-timposte-BUF     PIC X(277).
      * VARIABLES FOR RECORD LENGTH.
       77  TotemFdSlRecordClearOffset   PIC 9(5) COMP-4.
       77  TotemFdSlRecordLength        PIC 9(5) COMP-4.
      * FILE'S LOCK MODE FLAG
       77 DataSet1-tmovmag-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tmovmag-LOCK  VALUE "Y".
       77 DataSet1-KEYIS   PIC 9(3) VALUE 1.
       77 DataSet1-tmovmag-KEY1-ORDER  PIC X VALUE "A".
          88 DataSet1-tmovmag-KEY1-Asc  VALUE "A".
          88 DataSet1-tmovmag-KEY1-Desc VALUE "D".
       77 DataSet1-rmovmag-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-rmovmag-LOCK  VALUE "Y".
       77 DataSet1-rmovmag-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-rmovmag-KEY-Asc  VALUE "A".
          88 DataSet1-rmovmag-KEY-Desc VALUE "D".
       77 DataSet1-tparamge-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tparamge-LOCK  VALUE "Y".
       77 DataSet1-tparamge-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tparamge-KEY-Asc  VALUE "A".
          88 DataSet1-tparamge-KEY-Desc VALUE "D".
       77 DataSet1-tcodpag-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tcodpag-LOCK  VALUE "Y".
       77 DataSet1-tcodpag-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tcodpag-KEY-Asc  VALUE "A".
          88 DataSet1-tcodpag-KEY-Desc VALUE "D".
       77 DataSet1-articoli-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-articoli-LOCK  VALUE "Y".
       77 DataSet1-articoli-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-articoli-KEY-Asc  VALUE "A".
          88 DataSet1-articoli-KEY-Desc VALUE "D".
       77 DataSet1-tcaudisb-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tcaudisb-LOCK  VALUE "Y".
       77 DataSet1-tcaudisb-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tcaudisb-KEY-Asc  VALUE "A".
          88 DataSet1-tcaudisb-KEY-Desc VALUE "D".
       77 DataSet1-tcaumag-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tcaumag-LOCK  VALUE "Y".
       77 DataSet1-tcaumag-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tcaumag-KEY-Asc  VALUE "A".
          88 DataSet1-tcaumag-KEY-Desc VALUE "D".
       77 DataSet1-clienti-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-clienti-LOCK  VALUE "Y".
       77 DataSet1-clienti-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-clienti-KEY-Asc  VALUE "A".
          88 DataSet1-clienti-KEY-Desc VALUE "D".
       77 DataSet1-timballi-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-timballi-LOCK  VALUE "Y".
       77 DataSet1-timballi-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-timballi-KEY-Asc  VALUE "A".
          88 DataSet1-timballi-KEY-Desc VALUE "D".
       77 DataSet1-distinteb-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-distinteb-LOCK  VALUE "Y".
       77 DataSet1-distinteb-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-distinteb-KEY-Asc  VALUE "A".
          88 DataSet1-distinteb-KEY-Desc VALUE "D".
       77 DataSet1-timbalqta-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-timbalqta-LOCK  VALUE "Y".
       77 DataSet1-timbalqta-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-timbalqta-KEY-Asc  VALUE "A".
          88 DataSet1-timbalqta-KEY-Desc VALUE "D".
       77 DataSet1-progmag-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-progmag-LOCK  VALUE "Y".
       77 DataSet1-progmag-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-progmag-KEY-Asc  VALUE "A".
          88 DataSet1-progmag-KEY-Desc VALUE "D".
       77 DataSet1-tmagaz-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tmagaz-LOCK  VALUE "Y".
       77 DataSet1-tmagaz-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tmagaz-KEY-Asc  VALUE "A".
          88 DataSet1-tmagaz-KEY-Desc VALUE "D".
       77 DataSet1-zoom-distinteb-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-zoom-distinteb-LOCK  VALUE "Y".
       77 DataSet1-zoom-distinteb-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-zoom-distinteb-KEY-Asc  VALUE "A".
          88 DataSet1-zoom-distinteb-KEY-Desc VALUE "D".
       77 DataSet1-tmarche-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tmarche-LOCK  VALUE "Y".
       77 DataSet1-tmarche-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tmarche-KEY-Asc  VALUE "A".
          88 DataSet1-tmarche-KEY-Desc VALUE "D".
       77 DataSet1-timposte-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-timposte-LOCK  VALUE "Y".
       77 DataSet1-timposte-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-timposte-KEY-Asc  VALUE "A".
          88 DataSet1-timposte-KEY-Desc VALUE "D".

       77 tmovmag-key01-SPLITBUF  PIC X(17).
       77 tmovmag-k2-SPLITBUF  PIC X(20).
       77 tmovmag-k-data-SPLITBUF  PIC X(17).
       77 rmovmag-k-articolo-SPLITBUF  PIC X(19).
       77 rmovmag-rmo-chiave-ricerca-SPLITBUF  PIC X(25).
       77 rmovmag-k-progmag-SPLITBUF  PIC X(21).
       77 rmovmag-k-art-data-SPLITBUF  PIC X(15).
       77 tcodpag-TBL-CODICE-01-SPLITBUF  PIC X(53).
       77 articoli-art-k1-SPLITBUF  PIC X(51).
       77 tcaumag-k-mag-SPLITBUF  PIC X(5).
       77 clienti-cli-K1-SPLITBUF  PIC X(47).
       77 clienti-cli-K3-SPLITBUF  PIC X(12).
       77 clienti-cli-K4-SPLITBUF  PIC X(8).
       77 distinteb-k-articolo-SPLITBUF  PIC X(12).
       77 distinteb-k-progmag-SPLITBUF  PIC X(21).
       77 progmag-key01-SPLITBUF  PIC X(21).
       77 zoom-distinteb-k-des-SPLITBUF  PIC X(56).

      *{TOTEM}END

      *{TOTEM}ID-LOGICI
      ***** Elenco ID Logici *****
       78  78-ID-ef-data VALUE 5001.
       78  78-ID-ef-causale VALUE 5002.
       78  78-ID-ef-for VALUE 5003.
       78  78-ID-ef-num VALUE 5004.
       78  78-ID-ef-data-doc VALUE 5005.
       78  78-ID-ef-pag VALUE 5006.
       78  78-ID-ef-art VALUE 5007.
       78  78-ID-ef-qta VALUE 5008.
       78  78-ID-ef-peso-carico VALUE 5001.
       78  78-ID-ef-peso-scarico VALUE 5002.
      ***** Fine ID Logici *****
      *{TOTEM}END

       LINKAGE          SECTION.
      *{TOTEM}LINKAGE
           COPY  "COMMON-LINKAGE.DEF".

      *{TOTEM}END

       SCREEN           SECTION.
      *{TOTEM}COPY-SCREEN
      * FORM
       01 
           Form1, 
           AFTER PROCEDURE Form1-AfterProcedure,
           BEFORE PROCEDURE Form1-BeforeProcedure,
           .

      * ENTRY FIELD
       05
           ef-data, 
           Entry-Field, 
           COL 25,00, 
           LINE 2,00,
           LINES 1,31 ,
           SIZE 11,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod-campi,
           FONT IS Small-Font,
           ID IS 78-ID-ef-data,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           MAX-TEXT 8,
           VALUE ef-data-BUF,
           .

      * ENTRY FIELD
       05
           ef-causale, 
           Entry-Field, 
           COL 25,00, 
           LINE 4,00,
           LINES 1,31 ,
           SIZE 7,00 ,
           BOXED,
           UPPER,
           COLOR IS 513,
           ENABLED mod-campi,
           FONT IS Small-Font,
           ID IS 78-ID-ef-causale,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           LEFT,
           MAX-TEXT 4,
           VALUE ef-causale-BUF,
           .

      * ENTRY FIELD
       05
           ef-for, 
           Entry-Field, 
           COL 25,00, 
           LINE 6,00,
           LINES 1,31 ,
           SIZE 7,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod-campi,
           FONT IS Small-Font,
           ID IS 78-ID-ef-for,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 5,
           VALUE ef-for-BUF,
           .

      * ENTRY FIELD
       05
           ef-num, 
           Entry-Field, 
           COL 25,00, 
           LINE 8,00,
           LINES 1,31 ,
           SIZE 18,67 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod-campi,
           FONT IS Small-Font,
           ID IS 78-ID-ef-num,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 15,
           VALUE ef-num-BUF,
           .

      * ENTRY FIELD
       05
           ef-data-doc, 
           Entry-Field, 
           COL 82,00, 
           LINE 8,00,
           LINES 1,31 ,
           SIZE 11,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod-campi,
           FONT IS Small-Font,
           ID IS 78-ID-ef-data-doc,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           MAX-TEXT 8,
           VALUE ef-data-doc-BUF,
           .

      * ENTRY FIELD
       05
           ef-pag, 
           Entry-Field, 
           COL 25,00, 
           LINE 10,00,
           LINES 1,31 ,
           SIZE 7,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod-campi,
           FONT IS Small-Font,
           ID IS 78-ID-ef-pag,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 3,
           VALUE ef-pag-BUF,
           .

      * ENTRY FIELD
       05
           ef-art, 
           Entry-Field, 
           COL 11,00, 
           LINE 40,00,
           LINES 1,31 ,
           SIZE 8,00 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 78-ID-ef-art,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           VALUE ef-art-buf,
           AFTER PROCEDURE ef-art-AfterProcedure, 
           .


      * ENTRY FIELD
       05
           ef-qta, 
           Entry-Field, 
           COL 31,00, 
           LINE 40,00,
           LINES 1,31 ,
           SIZE 8,00 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 78-ID-ef-qta,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           VALUE ef-qta-buf,
           AFTER PROCEDURE ef-qta-AfterProcedure, 
           .


      * BAR
       05
           Form1-Br-2, 
           Bar,
           COL 1,00, 
           LINE 12,23,
           SIZE 162,83 ,
           ID IS 100,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           COLORS (8, 8),
           SHADING (-1, 1),
           WIDTH 2,
           .

      * LABEL
       05
           CST-BLOCKPGM, 
           Label, 
           COL 117,67, 
           LINE 1,38,
           LINES 1,00 ,
           SIZE 13,86 ,
           ID IS 999,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "BlockPgm",
           VISIBLE v-custom,
           .

      * LABEL
       05
           Form1-Custom1-1, 
           Label, 
           COL 102,50, 
           LINE 1,69,
           LINES 0,62 ,
           SIZE 12,33 ,
           FONT IS Default-Font,
           ID IS 666,
           TRANSPARENT,
           TITLE "CUSTOM CONTROL",
           VISIBLE v-custom,
           .

      * BAR
       05
           Form1-Br-2a, 
           Bar,
           COL 1,00, 
           LINE 12,77,
           SIZE 162,83 ,
           ID IS 36,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           COLORS (8, 8),
           SHADING (-1, 1),
           WIDTH 2,
           .

      * LABEL
       05
           Form1-La-4, 
           Label, 
           COL 3,00, 
           LINE 8,00,
           LINES 1,31 ,
           SIZE 19,00 ,
           FONT IS Small-Font,
           ID IS 13,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Numero Bolla",
           .

      * LABEL
       05
           Form1-La-5, 
           Label, 
           COL 3,00, 
           LINE 2,00,
           LINES 1,31 ,
           SIZE 14,00 ,
           FONT IS Small-Font,
           ID IS 15,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Data movimento",
           .

      * LABEL
       05
           Form1-La-6, 
           Label, 
           COL 63,00, 
           LINE 8,00,
           LINES 1,31 ,
           SIZE 17,00 ,
           FONT IS Small-Font,
           ID IS 17,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Data Bolla",
           .

      * LABEL
       05
           Form1-La-7, 
           Label, 
           COL 3,00, 
           LINE 4,00,
           LINES 1,31 ,
           SIZE 19,00 ,
           FONT IS Small-Font,
           ID IS 19,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Causale di magazzino",
           .

      * LABEL
       05
           lab-clifor, 
           Label, 
           COL 3,00, 
           LINE 6,00,
           LINES 1,31 ,
           SIZE 19,00 ,
           FONT IS Small-Font,
           ID IS 21,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Codice Fornitore",
           .

      * LABEL
       05
           Form1-La-9, 
           Label, 
           COL 3,00, 
           LINE 10,00,
           LINES 1,31 ,
           SIZE 19,00 ,
           FONT IS Small-Font,
           ID IS 23,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Codice pagamento",
           .

      * DB_LABEL
       05
           lab-causale, 
           Label, 
           COL 33,00, 
           LINE 4,00,
           LINES 1,31 ,
           SIZE 50,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 45,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-causale-BUF,
           TRANSPARENT,
           .

      * DB_LABEL
       05
           lab-for, 
           Label, 
           COL 33,00, 
           LINE 6,00,
           LINES 1,31 ,
           SIZE 75,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 47,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-for-BUF,
           TRANSPARENT,
           .

      * LABEL
       05
           lab-pag, 
           Label, 
           COL 33,00, 
           LINE 10,00,
           LINES 1,31 ,
           SIZE 70,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 14,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-pag-buf,
           .

      * LABEL
       05
           Form1-La-3, 
           Label, 
           COL 87,00, 
           LINE 4,00,
           LINES 1,31 ,
           SIZE 5,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 2,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Carico",
           .

      * LABEL
       05
           Form1-La-3a, 
           Label, 
           COL 107,00, 
           LINE 4,00,
           LINES 1,31 ,
           SIZE 6,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 3,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Scarico",
           .

      * DB_LABEL
       05
           lab-carico, 
           Label, 
           COL 95,00, 
           LINE 4,00,
           LINES 1,31 ,
           SIZE 6,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 5,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-carico-BUF,
           TRANSPARENT,
           .

      * DB_LABEL
       05
           lab-scarico, 
           Label, 
           COL 116,00, 
           LINE 4,00,
           LINES 1,31 ,
           SIZE 6,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 9,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-scarico-BUF,
           TRANSPARENT,
           .

      * GRID
       05
           form1-Gd-1, 
           Grid, 
           COL 3,00, 
           LINE 14,00,
           LINES 17,08 ,
           SIZE 158,33 ,
           BOXED,
           CENTERED-HEADINGS,
           DATA-COLUMNS (1, 3, 9, 12, 15, 22, 62, 69, 76, 95, 105, 124),
           ALIGNMENT ("C", "R", "C", "C", "R", "U", "R", "R", "R", "R", 
           "R", "R"),
           SEPARATION (5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5),
           DATA-TYPES ("X", "9(6)", "U(3)", "U(3)", "9(7)", "x(40)", "9(
      -    "7)", "9(7)", "9(19)", "9(10)", "9(19)", "9(19)"),
           NUM-COL-HEADINGS 1,
           COLUMN-HEADINGS,
           CURSOR-FRAME-WIDTH 2,
           DIVIDER-COLOR 1,
           HEADING-COLOR 144,
           HEADING-DIVIDER-COLOR 1,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           NUM-ROWS 11,
           ROW-HEADINGS,
           TILED-HEADINGS,
           VIRTUAL-WIDTH 158,
           VPADDING 50,
           EVENT PROCEDURE Screen1-Gd-1-Event-Proc,
           .

      * ENTRY FIELD
       05
           ef-art-v, 
           Entry-Field, 
           COL 3,00, 
           LINE 36,00,
           LINES 1,31 ,
           SIZE 7,00 ,
           BOXED,
           COLOR IS 33281,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 10,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 6,
           VALUE ef-art-v-BUF,
           .

      * ENTRY FIELD
       05
           ef-mag, 
           Entry-Field, 
           COL 64,00, 
           LINE 36,00,
           LINES 1,31 ,
           SIZE 6,00 ,
           BOXED,
           COLOR IS 33281,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 11,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 3,
           READ-ONLY,
           VALUE ef-mag-BUF,
           .

      * ENTRY FIELD
       05
           ef-imb, 
           Entry-Field, 
           COL 75,00, 
           LINE 36,00,
           LINES 1,31 ,
           SIZE 6,00 ,
           BOXED,
           COLOR IS 33281,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 12,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 3,
           READ-ONLY,
           VALUE ef-imb-BUF,
           .

      * ENTRY FIELD
       05
           ef-peso, 
           Entry-Field, 
           COL 85,00, 
           LINE 36,00,
           LINES 1,31 ,
           SIZE 11,00 ,
           BOXED,
           COLOR IS 33281,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 16,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 7,
           READ-ONLY,
           VALUE ef-peso-BUF,
           .
      * ENTRY FIELD
       05
           ef-peso-utf, 
           Entry-Field, 
           COL 98,00, 
           LINE 36,00,
           LINES 1,31 ,
           SIZE 11,00 ,
           BOXED,
           COLOR IS 33281,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 18,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 7,
           READ-ONLY,
           VALUE ef-peso-utf-BUF,
           .
      * ENTRY FIELD
       05
           ef-peso-non-utf, 
           Entry-Field, 
           COL 111,00, 
           LINE 36,00,
           LINES 1,31 ,
           SIZE 11,00 ,
           BOXED,
           COLOR IS 33281,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 20,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 7,
           READ-ONLY,
           VALUE ef-peso-non-utf-BUF,
           .
      * ENTRY FIELD
       05
           ef-mp, 
           Entry-Field, 
           COL 124,00, 
           LINE 36,00,
           LINES 1,31 ,
           SIZE 18,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod-campi,
           FONT IS Small-Font,
           ID IS 22,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 16,
           VALUE ef-mp-BUF,
           .
      * ENTRY FIELD
       05
           ef-oneri, 
           Entry-Field, 
           COL 143,50, 
           LINE 36,00,
           LINES 1,31 ,
           SIZE 18,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod-campi,
           FONT IS Small-Font,
           ID IS 26,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           VALUE ef-oneri-buf,
           AFTER PROCEDURE Screen1-Ef-1-AfterProcedure, 
           .

      * LABEL
       05
           Screen1-La-2, 
           Label, 
           COL 3,00, 
           LINE 31,85,
           LINES 1,31 ,
           SIZE 27,17 ,
           COLOR IS 32773,
           FONT IS Small-Font,
           ID IS 27,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "TOTALI:",
           .

      * ENTRY FIELD
       05
           ef-tot-utf, 
           Entry-Field, 
           COL 84,17, 
           LINE 31,85,
           LINES 1,31 ,
           SIZE 10,17 ,
           BOXED,
           COLOR IS 32773,
           FONT IS Small-Font,
           ID IS 4,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           READ-ONLY,
           VALUE ef-tot-utf-buf,
           AFTER PROCEDURE Screen1-Ef-1-AfterProcedure, 
           BEFORE PROCEDURE Screen1-Ef-1-BeforeProcedure, 
           .

      * ENTRY FIELD
       05
           ef-tot-non-utf, 
           Entry-Field, 
           COL 94,17, 
           LINE 31,85,
           LINES 1,31 ,
           SIZE 10,17 ,
           BOXED,
           COLOR IS 32773,
           FONT IS Small-Font,
           ID IS 6,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           READ-ONLY,
           VALUE ef-tot-non-utf-buf,
           AFTER PROCEDURE Screen1-Ef-1-AfterProcedure, 
           BEFORE PROCEDURE Screen1-Ef-1-BeforeProcedure, 
           .

      * ENTRY FIELD
       05
           ef-tot-prezzo, 
           Entry-Field, 
           COL 104,17, 
           LINE 31,85,
           LINES 1,31 ,
           SIZE 16,17 ,
           BOXED,
           COLOR IS 32773,
           FONT IS Small-Font,
           ID IS 7,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           READ-ONLY,
           VALUE ef-tot-prezzo-buf,
           AFTER PROCEDURE Screen1-Ef-1-AfterProcedure, 
           BEFORE PROCEDURE Screen1-Ef-1-BeforeProcedure, 
           .

      * ENTRY FIELD
       05
           ef-tot-oneri, 
           Entry-Field, 
           COL 129,17, 
           LINE 31,85,
           LINES 1,31 ,
           SIZE 16,17 ,
           BOXED,
           COLOR IS 32773,
           FONT IS Small-Font,
           ID IS 8,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           READ-ONLY,
           VALUE ef-tot-oneri-buf,
           AFTER PROCEDURE Screen1-Ef-1-AfterProcedure, 
           BEFORE PROCEDURE Screen1-Ef-1-BeforeProcedure, 
           .

      * LABEL
       05
           Screen1-La-3, 
           Label, 
           COL 3,00, 
           LINE 34,00,
           LINES 1,31 ,
           SIZE 7,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 24,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Articolo",
           .

      * LABEL
       05
           Screen1-La-4, 
           Label, 
           COL 62,00, 
           LINE 34,00,
           LINES 1,31 ,
           SIZE 10,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 25,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Magazzino",
           .

      * LABEL
       05
           Screen1-La-5, 
           Label, 
           COL 75,00, 
           LINE 34,00,
           LINES 1,31 ,
           SIZE 6,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 28,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Imballo",
           .

      * LABEL
       05
           Screen1-La-6, 
           Label, 
           COL 85,00, 
           LINE 34,00,
           LINES 1,31 ,
           SIZE 11,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 30,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Peso Totale",
           .

      * LABEL
       05
           Screen1-La-7, 
           Label, 
           COL 98,00, 
           LINE 34,00,
           LINES 1,31 ,
           SIZE 11,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 31,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Totale UTF",
           .

      * LABEL
       05
           Screen1-La-8, 
           Label, 
           COL 110,50, 
           LINE 34,00,
           LINES 1,31 ,
           SIZE 12,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 32,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Totale Esente",
           .

      * LABEL
       05
           Screen1-La-9, 
           Label, 
           COL 124,00, 
           LINE 34,00,
           LINES 1,31 ,
           SIZE 18,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 33,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Prezzo MP",
           .

      * LABEL
       05
           lab-des, 
           Label, 
           COL 11,00, 
           LINE 36,00,
           LINES 1,31 ,
           SIZE 51,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 34,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-des-buf,
           .

      * LABEL
       05
           Screen1-La-11, 
           Label, 
           COL 143,50, 
           LINE 34,00,
           LINES 1,31 ,
           SIZE 18,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 35,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Oneri accessori x UM",
           .

      * LABEL
       05
           Screen1-La-3a, 
           Label, 
           COL 11,00, 
           LINE 34,00,
           LINES 1,31 ,
           SIZE 51,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 39,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Descrizione",
           .

      * BAR
       05
           Form1-Br-2b, 
           Bar,
           COL 1,17, 
           LINE 38,31,
           SIZE 162,83 ,
           ID IS 40,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           COLORS (8, 8),
           SHADING (-1, 1),
           WIDTH 2,
           .

      * BAR
       05
           Form1-Br-2aa, 
           Bar,
           COL 1,17, 
           LINE 38,85,
           SIZE 162,83 ,
           ID IS 41,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           COLORS (8, 8),
           SHADING (-1, 1),
           WIDTH 2,
           .

      * LABEL
       05
           Form1-La-1, 
           Label, 
           COL 3,00, 
           LINE 40,00,
           LINES 1,31 ,
           SIZE 7,00 ,
           FONT IS Small-Font,
           ID IS 37,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Articolo",
           .

      * LABEL
       05
           Form1-La-2, 
           Label, 
           COL 22,00, 
           LINE 40,00,
           LINES 1,31 ,
           SIZE 7,00 ,
           FONT IS Small-Font,
           ID IS 42,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Quantità",
           .

      * TOOLBAR
       01
           Form1-Tb-1,
           .    

      * PUSH BUTTON
       05
           TOOL-ESCI, 
           Push-Button, 
           COL 1,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           ENABLED E-ESCI,
           EXCEPTION-VALUE 27,
           FLAT,
           ID IS 110,
           SELF-ACT,
           ESCAPE-BUTTON,
           TITLE "Esci (Esc)",
           .

      * PUSH BUTTON
       05
           TOOL-NUOVO, 
           Push-Button, 
           COL 6,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           BITMAP-NUMBER 23,
           FRAMED,
           SQUARE,
           ENABLED E-NUOVO,
           FLAT,
           ID IS 111,
           SELF-ACT,
           TITLE "Nuovo (F2)",
           .

      * PUSH BUTTON
       05
           TOOL-CANCELLA, 
           Push-Button, 
           COL 16,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           FRAMED,
           SQUARE,
           ENABLED E-CANCELLA,
           FLAT,
           ID IS 112,
           SELF-ACT,
           TITLE "Cancella (F4)",
           BITMAP-NUMBER BitmapNumDelete
           .

      * PUSH BUTTON
       05
           TOOL-SALVA, 
           Push-Button, 
           COL 11,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           FRAMED,
           SQUARE,
           ENABLED E-SALVA,
           EXCEPTION-VALUE 3,
           FLAT,
           ID IS 75,
           SELF-ACT,
           TITLE "Salva (F3)",
           BITMAP-NUMBER BitmapNumSave
           .

      * PUSH BUTTON
       05
           TOOL-ANTEPRIMA, 
           Push-Button, 
           COL 26,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           BITMAP-NUMBER 17,
           FRAMED,
           SQUARE,
           ENABLED E-ANTEPRIMA,
           FLAT,
           ID IS 76,
           SELF-ACT,
           TITLE "Anteprima (F6)",
           .

      * CHECK BOX
       05
           TOOL-MODIFICA, 
           Check-Box, 
           COL 21,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           BITMAP-NUMBER 5,
           FRAMED,
           SQUARE,
           ENABLED E-MODIFICA,
           EXCEPTION-VALUE 150
           FLAT,
           ID IS 77,
           SELF-ACT,
           TITLE "Modifica (F5)",
           VALUE 1,
           BITMAP-NUMBER BitmapNumEdit
           AFTER PROCEDURE TOOL-MODIFICA-AfterProcedure,
           BEFORE PROCEDURE TOOL-MODIFICA-BeforeProcedure, 
           .
      * PUSH BUTTON
       05
           TOOL-STAMPA, 
           Push-Button, 
           COL 31,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           BITMAP-NUMBER 18,
           FRAMED,
           SQUARE,
           ENABLED E-STAMPA,
           FLAT,
           ID IS 78,
           SELF-ACT,
           TITLE "Stampa (F7)",
           .

      * PUSH BUTTON
       05
           TOOL-CERCA, 
           Push-Button, 
           COL 36,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           FRAMED,
           SQUARE,
           ENABLED E-CERCA,
           EXCEPTION-VALUE 8,
           FLAT,
           ID IS 79,
           SELF-ACT,
           TITLE "Cerca (F8)",
           BITMAP-NUMBER BitmapNumZoom
           .

      * PUSH BUTTON
       05
           TOOL-SELEZIONA, 
           Push-Button, 
           COL 41,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           FRAMED,
           SQUARE,
           ENABLED E-SELEZIONA,
           FLAT,
           ID IS 80,
           SELF-ACT,
           TITLE "Seleziona (F9)",
           BITMAP-NUMBER BitmapNumSelect
           .

      * FORM
       01 
           form-num, 
           HELP-ID 1,
           BEFORE PROCEDURE form-num-BeforeProcedure,
           AFTER PROCEDURE  form-num-AFTER-SCREEN
           .

      * PUSH BUTTON
       05
           pb-fatto, 
           Push-Button, 
           COL 26,50, 
           LINE 19,00,
           LINES 30,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE FATTO-BMP,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 13,
           FLAT,
           FONT IS Small-Font,
           ID IS 1,
           AFTER PROCEDURE pb-fatto-AfterProcedure, 
           BEFORE PROCEDURE pb-fatto-BeforeProcedure, 
           .

      * FRAME
       05
           form-num-Fr-1, 
           Frame, 
           COL 2,80, 
           LINE 2,40,
           LINES 15,80 CELLS,
           SIZE 27,00 CELLS,
           ID IS 2,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Movimento di carico",
           .

      * LABEL
       05
           lab-peso, 
           Label, 
           COL 4,30, 
           LINE 14,40,
           LINES 2,00 CELLS,
           SIZE 11,90 CELLS,
           FONT IS Verdana11-Occidentale,
           ID IS 10,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Peso totale UTF",
           VISIBLE 1,
           .

      * ENTRY FIELD
       05
           ef-peso-carico, 
           Entry-Field, 
           COL 18,30, 
           LINE 14,40,
           LINES 2,00 CELLS,
           SIZE 10,00 CELLS,
           BOXED,
           FONT IS Verdana11-Occidentale,
           ID IS 78-ID-ef-peso-carico,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           VALUE peso-utf-carico-edit,
           VISIBLE 1,
           AFTER PROCEDURE ef-peso-carico-AfterProcedure, 
           .


      * FRAME
       05
           form-num-Fr-2, 
           Frame, 
           COL 7,20, 
           LINE 4,40,
           LINES 8,50 CELLS,
           SIZE 18,10 CELLS,
           RAISED,
           ID IS 13,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           .

      * LABEL
       05
           form-num-La-1, 
           Label, 
           COL 8,20, 
           LINE 5,90,
           LINES 2,00 CELLS,
           SIZE 16,00 CELLS,
           ID IS 3,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Numero assegnato",
           .

      * LABEL
       05
           lab-numero-carico, 
           Label, 
           COL 8,70, 
           LINE 8,40,
           LINES 3,50 CELLS,
           SIZE 15,00 CELLS,
           COLOR IS 5,
           FONT IS Impact24-Occidentale,
           ID IS 4,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE num-carico-edit,
           .

      * FRAME
       05
           form-num-Fr-1a, 
           Frame, 
           COL 31,30, 
           LINE 2,40,
           LINES 15,80 CELLS,
           SIZE 27,00 CELLS,
           ID IS 5,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Movimento di scarico",
           .

      * ENTRY FIELD
       05
           ef-peso-scarico, 
           Entry-Field, 
           COL 46,80, 
           LINE 14,40,
           LINES 2,00 CELLS,
           SIZE 10,00 CELLS,
           BOXED,
           FONT IS Verdana11-Occidentale,
           ID IS 78-ID-ef-peso-scarico,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           VALUE peso-utf-scarico-edit,
           VISIBLE 1,
           AFTER PROCEDURE ef-peso-carico-AfterProcedure, 
           .


      * LABEL
       05
           lab-pesoa, 
           Label, 
           COL 32,80, 
           LINE 14,40,
           LINES 2,00 CELLS,
           SIZE 11,90 CELLS,
           FONT IS Verdana11-Occidentale,
           ID IS 7,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Peso totale UTF",
           VISIBLE 1,
           .

      * FRAME
       05
           form-num-Fr-2a, 
           Frame, 
           COL 35,70, 
           LINE 4,40,
           LINES 8,50 CELLS,
           SIZE 18,10 CELLS,
           RAISED,
           ID IS 8,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           .

      * LABEL
       05
           form-num-La-1a, 
           Label, 
           COL 36,70, 
           LINE 5,90,
           LINES 2,00 CELLS,
           SIZE 16,00 CELLS,
           ID IS 9,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Numero assegnato",
           .

      * LABEL
       05
           lab-numero-scarico, 
           Label, 
           COL 37,20, 
           LINE 8,40,
           LINES 3,50 CELLS,
           SIZE 15,00 CELLS,
           COLOR IS 5,
           FONT IS Impact24-Occidentale,
           ID IS 12,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE num-scarico-edit,
           .

      *{TOTEM}END

      *{TOTEM}LINKPARA
       PROCEDURE  DIVISION USING LK-BLOCKPGM, USER-CODI, LIVELLO-ABIL.
      *{TOTEM}END

      *{TOTEM}DECLARATIVE
       DECLARATIVES.
      * <TOTEM:EPT. INIT:gmovdis, INIT:gmovdis, BeforeDeclarative>
       TMOVMAG-ERROR SECTION.
           use after error procedure on tmovmag.
           set RecLocked to false.
           evaluate status-tmovmag
           when "35"
                display message "File [TMOVMAG] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TMOVMAG] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TMOVMAG] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           when "93"
                display message "File già in uso!"
                          title tit-err
                           icon 3
                perform ANAGR01-EV-AFTER-PROGRAM
                goback
           when "99" set RecLocked to true
                display message box "Movimento già in uso su altro termi
      -    "nale!"
                             x"0d0a""Sarà possibile la sola visualizzazi
      -    "one."
                        title = titolo
                        icon 3
                move 0 to mod
                modify tool-modifica value = mod
           end-evaluate.
 
      ***---
       RMOVMAG-ERR SECTION.
           use after error procedure on rmovmag.
           set tutto-ok  to true.
           evaluate status-rmovmag
           when "35"
                display message "File [RMOVMAG] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [RMOVMAG] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[RMOVMAG] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       TPARAMGE-ERR SECTION.
           use after error procedure on tparamge.
           set tutto-ok  to true.
           evaluate status-tparamge
           when "35"
                display message "File [TPARAMGE] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TPARAMGE] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TPARAMGE] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       TCODPAG-ERR SECTION.
           use after error procedure on tcodpag.
           set tutto-ok  to true.
           evaluate status-tcodpag
           when "35"
                display message "File [TCODPAG] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TCODPAG] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TCODPAG] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       ARTICOLI-ERR SECTION.
           use after error procedure on articoli.
           set tutto-ok  to true.
           evaluate status-articoli
           when "35"
                display message "File [ARTICOLI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [ARTICOLI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[ARTICOLI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       TCAUDISB-ERR SECTION.
           use after error procedure on tcaudisb.
           set tutto-ok  to true.
           evaluate status-tcaudisb
           when "35"
                display message "File [TCAUDISB] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TCAUDISB] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TCAUDISB] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       TCAUMAG-ERR SECTION.
           use after error procedure on tcaumag.
           set tutto-ok  to true.
           evaluate status-tcaumag
           when "35"
                display message "File [TCAUMAG] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TCAUMAG] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TCAUMAG] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       CLIENTI-ERR SECTION.
           use after error procedure on clienti.
           set tutto-ok  to true.
           evaluate status-clienti
           when "35"
                display message "File [CLIENTI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [CLIENTI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[CLIENTI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       TIMBALLI-ERR SECTION.
           use after error procedure on timballi.
           set tutto-ok  to true.
           evaluate status-timballi
           when "35"
                display message "File [TIMBALLI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TIMBALLI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TIMBALLI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       DISTINTEB-ERR SECTION.
           use after error procedure on distinteb.
           set tutto-ok  to true.
           evaluate status-distinteb
           when "35"
                display message "File [DISTINTEB] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [DISTINTEB] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[DISTINTEB] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       TIMBALQTA-ERR SECTION.
           use after error procedure on timbalqta.
           set tutto-ok  to true.
           evaluate status-timbalqta
           when "35"
                display message "File [TIMBALQTA] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TIMBALQTA] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TIMBALQTA] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       PROGMAG-ERR SECTION.
           use after error procedure on progmag.
           set tutto-ok  to true.
           evaluate status-progmag
           when "35"
                display message "File [PROGMAG] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [PROGMAG] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[PROGMAG] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.

      * <TOTEM:END>
       INPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON INPUT.
       0100-DECL.
           EXIT.
       I-O-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON I-O.
       0200-DECL.
           EXIT.
       OUTPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON OUTPUT.
       0300-DECL.
           EXIT.
       TRANSACTION-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON TRANSACTION.
       0400-DECL.
           EXIT.
       END DECLARATIVES.
      *{TOTEM}END

       MAIN-LOGIC.
      *{TOTEM}ENTRY-BEFPRG
      *    Before-Program
           PERFORM anagr01-Ev-Before-Program
      *{TOTEM}END
           PERFORM INITIALIZE-ROUTINE.
      * run main screen
      *{TOTEM}RUN-MAINSCR
           PERFORM Form1-OPEN-ROUTINE.
      *{TOTEM}END

      *{TOTEM}COPY-PROCEDURE
       EXIT-STOP-ROUTINE.
           PERFORM CLOSE-FILE-RTN
      * <TOTEM:EPT. INIT:gmovdis, INIT:gmovdis, BeforeDestroyResource>
      * <TOTEM:END>
           DESTROY Verdana11-Occidentale
           DESTROY Impact24-Occidentale
           DESTROY Verdana12-Occidentale
           CALL "w$bitmap" USING WBITMAP-DESTROY, TOOLBAR-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, FATTO-BMP
      *    After-Program
           PERFORM anagr01-Ev-After-Program
           set environment "KEYSTROKE" to "DATA=46   46".
           set environment "KEYSTROKE" to "DATA=44   44".
           EXIT PROGRAM TOTEM-PgmStatus
           STOP RUN.

       INITIALIZE-ROUTINE.
      *    Before Init
      * initialize program status variable
           Initialize TOTEM-PgmStatus.
      * get system information
           ACCEPT SYSTEM-INFORMATION FROM SYSTEM-INFO.
      * get terminal information
           ACCEPT TERMINAL-ABILITIES FROM TERMINAL-INFO.
      * set font
           PERFORM INIT-FONT.
      * load bitmap
           PERFORM INIT-BMP.
      * load resource
           PERFORM INIT-RES.
      * create pop-up menu
           PERFORM INIT-POPUP.
      * open files
           PERFORM OPEN-FILE-RTN.
      *    After Init
           .
    
       INIT-FONT.
      * Verdana11-Occidentale
           INITIALIZE WFONT-DATA Verdana11-Occidentale
           MOVE 11 TO WFONT-SIZE
           MOVE "Verdana" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO FALSE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Verdana11-Occidentale, WFONT-DATA
      * Impact24-Occidentale
           INITIALIZE WFONT-DATA Impact24-Occidentale
           MOVE 24 TO WFONT-SIZE
           MOVE "Impact" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO FALSE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Impact24-Occidentale, WFONT-DATA
      * Verdana12-Occidentale
           INITIALIZE WFONT-DATA Verdana12-Occidentale
           MOVE 12 TO WFONT-SIZE
           MOVE "Verdana" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO FALSE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Verdana12-Occidentale, WFONT-DATA
           .

       INIT-BMP.
      * TOOL-ESCI
           COPY RESOURCE "TOOLBAR.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "TOOLBAR.BMP", 
                   GIVING TOOLBAR-BMP.
      * pb-fatto
           COPY RESOURCE "FATTO.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "FATTO.BMP", 
                   GIVING FATTO-BMP.
           .

       INIT-RES.
           .

       INIT-POPUP.
           .

       OPEN-FILE-RTN.
      *    Before Open
           PERFORM OPEN-tmovmag
           PERFORM OPEN-rmovmag
           PERFORM OPEN-tparamge
           PERFORM OPEN-tcodpag
           PERFORM OPEN-articoli
           PERFORM OPEN-tcaudisb
           PERFORM OPEN-tcaumag
           PERFORM OPEN-clienti
           PERFORM OPEN-timballi
           PERFORM OPEN-distinteb
           PERFORM OPEN-timbalqta
           PERFORM OPEN-progmag
           PERFORM OPEN-tmagaz
      *    zoom-distinteb OPEN MODE IS FALSE
      *    PERFORM OPEN-zoom-distinteb
           PERFORM OPEN-tmarche
           PERFORM OPEN-timposte
      *    After Open
           .

       OPEN-tmovmag.
      * <TOTEM:EPT. INIT:gmovdis, FD:tmovmag, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O tmovmag
           IF STATUS-tmovmag = "35"
              OPEN OUTPUT tmovmag
                IF Valid-STATUS-tmovmag
                   CLOSE tmovmag
                   OPEN I-O tmovmag
                END-IF
           END-IF
           IF NOT Valid-STATUS-tmovmag
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovdis, FD:tmovmag, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-rmovmag.
      * <TOTEM:EPT. INIT:gmovdis, FD:rmovmag, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O rmovmag
           IF STATUS-rmovmag = "35"
              OPEN OUTPUT rmovmag
                IF Valid-STATUS-rmovmag
                   CLOSE rmovmag
                   OPEN I-O rmovmag
                END-IF
           END-IF
           IF NOT Valid-STATUS-rmovmag
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovdis, FD:rmovmag, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tparamge.
      * <TOTEM:EPT. INIT:gmovdis, FD:tparamge, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tparamge
           IF NOT Valid-STATUS-tparamge
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovdis, FD:tparamge, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tcodpag.
      * <TOTEM:EPT. INIT:gmovdis, FD:tcodpag, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tcodpag
           IF NOT Valid-STATUS-tcodpag
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovdis, FD:tcodpag, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-articoli.
      * <TOTEM:EPT. INIT:gmovdis, FD:articoli, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT articoli
           IF NOT Valid-STATUS-articoli
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovdis, FD:articoli, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tcaudisb.
      * <TOTEM:EPT. INIT:gmovdis, FD:tcaudisb, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tcaudisb
           IF NOT Valid-STATUS-tcaudisb
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovdis, FD:tcaudisb, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tcaumag.
      * <TOTEM:EPT. INIT:gmovdis, FD:tcaumag, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tcaumag
           IF NOT Valid-STATUS-tcaumag
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovdis, FD:tcaumag, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-clienti.
      * <TOTEM:EPT. INIT:gmovdis, FD:clienti, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT clienti
           IF NOT Valid-STATUS-clienti
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovdis, FD:clienti, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-timballi.
      * <TOTEM:EPT. INIT:gmovdis, FD:timballi, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT timballi
           IF NOT Valid-STATUS-timballi
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovdis, FD:timballi, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-distinteb.
      * <TOTEM:EPT. INIT:gmovdis, FD:distinteb, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT distinteb
           IF NOT Valid-STATUS-distinteb
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovdis, FD:distinteb, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-timbalqta.
      * <TOTEM:EPT. INIT:gmovdis, FD:timbalqta, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT timbalqta
           IF NOT Valid-STATUS-timbalqta
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovdis, FD:timbalqta, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-progmag.
      * <TOTEM:EPT. INIT:gmovdis, FD:progmag, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT progmag
           IF NOT Valid-STATUS-progmag
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovdis, FD:progmag, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tmagaz.
      * <TOTEM:EPT. INIT:gmovdis, FD:tmagaz, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tmagaz
           IF NOT Valid-STATUS-tmagaz
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovdis, FD:tmagaz, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-zoom-distinteb.
      * <TOTEM:EPT. INIT:gmovdis, FD:zoom-distinteb, BeforeOpen>
      * <TOTEM:END>
           OPEN  OUTPUT zoom-distinteb
           IF NOT Valid-STATUS-zoom-distinteb
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovdis, FD:zoom-distinteb, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tmarche.
      * <TOTEM:EPT. INIT:gmovdis, FD:tmarche, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tmarche
           IF NOT Valid-STATUS-tmarche
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovdis, FD:tmarche, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-timposte.
      * <TOTEM:EPT. INIT:gmovdis, FD:timposte, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT timposte
           IF NOT Valid-STATUS-timposte
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:gmovdis, FD:timposte, AfterOpen>
      * <TOTEM:END>
           .

       CLOSE-FILE-RTN.
      *    Before Close
           PERFORM CLOSE-tmovmag
           PERFORM CLOSE-rmovmag
           PERFORM CLOSE-tparamge
           PERFORM CLOSE-tcodpag
           PERFORM CLOSE-articoli
           PERFORM CLOSE-tcaudisb
           PERFORM CLOSE-tcaumag
           PERFORM CLOSE-clienti
           PERFORM CLOSE-timballi
           PERFORM CLOSE-distinteb
           PERFORM CLOSE-timbalqta
           PERFORM CLOSE-progmag
           PERFORM CLOSE-tmagaz
      *    zoom-distinteb CLOSE MODE IS FALSE
      *    PERFORM CLOSE-zoom-distinteb
           PERFORM CLOSE-tmarche
           PERFORM CLOSE-timposte
      *    After Close
           .

       CLOSE-tmovmag.
      * <TOTEM:EPT. INIT:gmovdis, FD:tmovmag, BeforeClose>
      * <TOTEM:END>
           CLOSE tmovmag
           .

       CLOSE-rmovmag.
      * <TOTEM:EPT. INIT:gmovdis, FD:rmovmag, BeforeClose>
      * <TOTEM:END>
           CLOSE rmovmag
           .

       CLOSE-tparamge.
      * <TOTEM:EPT. INIT:gmovdis, FD:tparamge, BeforeClose>
      * <TOTEM:END>
           CLOSE tparamge
           .

       CLOSE-tcodpag.
      * <TOTEM:EPT. INIT:gmovdis, FD:tcodpag, BeforeClose>
      * <TOTEM:END>
           CLOSE tcodpag
           .

       CLOSE-articoli.
      * <TOTEM:EPT. INIT:gmovdis, FD:articoli, BeforeClose>
      * <TOTEM:END>
           CLOSE articoli
           .

       CLOSE-tcaudisb.
      * <TOTEM:EPT. INIT:gmovdis, FD:tcaudisb, BeforeClose>
      * <TOTEM:END>
           CLOSE tcaudisb
           .

       CLOSE-tcaumag.
      * <TOTEM:EPT. INIT:gmovdis, FD:tcaumag, BeforeClose>
      * <TOTEM:END>
           CLOSE tcaumag
           .

       CLOSE-clienti.
      * <TOTEM:EPT. INIT:gmovdis, FD:clienti, BeforeClose>
      * <TOTEM:END>
           CLOSE clienti
           .

       CLOSE-timballi.
      * <TOTEM:EPT. INIT:gmovdis, FD:timballi, BeforeClose>
      * <TOTEM:END>
           CLOSE timballi
           .

       CLOSE-distinteb.
      * <TOTEM:EPT. INIT:gmovdis, FD:distinteb, BeforeClose>
      * <TOTEM:END>
           CLOSE distinteb
           .

       CLOSE-timbalqta.
      * <TOTEM:EPT. INIT:gmovdis, FD:timbalqta, BeforeClose>
      * <TOTEM:END>
           CLOSE timbalqta
           .

       CLOSE-progmag.
      * <TOTEM:EPT. INIT:gmovdis, FD:progmag, BeforeClose>
      * <TOTEM:END>
           CLOSE progmag
           .

       CLOSE-tmagaz.
      * <TOTEM:EPT. INIT:gmovdis, FD:tmagaz, BeforeClose>
      * <TOTEM:END>
           CLOSE tmagaz
           .

       CLOSE-zoom-distinteb.
      * <TOTEM:EPT. INIT:gmovdis, FD:zoom-distinteb, BeforeClose>
      * <TOTEM:END>
           .

       CLOSE-tmarche.
      * <TOTEM:EPT. INIT:gmovdis, FD:tmarche, BeforeClose>
      * <TOTEM:END>
           CLOSE tmarche
           .

       CLOSE-timposte.
      * <TOTEM:EPT. INIT:gmovdis, FD:timposte, BeforeClose>
      * <TOTEM:END>
           CLOSE timposte
           .

       tmovmag-key01-MERGE-SPLITBUF.
           INITIALIZE tmovmag-key01-SPLITBUF
           MOVE tmo-anno(1:4) TO tmovmag-key01-SPLITBUF(1:4)
           MOVE tmo-causale(1:4) TO tmovmag-key01-SPLITBUF(5:4)
           MOVE tmo-numero(1:8) TO tmovmag-key01-SPLITBUF(9:8)
           .

       tmovmag-k2-MERGE-SPLITBUF.
           INITIALIZE tmovmag-k2-SPLITBUF
           MOVE tmo-tipo(1:1) TO tmovmag-k2-SPLITBUF(1:1)
           MOVE tmo-cod-clifor(1:5) TO tmovmag-k2-SPLITBUF(2:5)
           MOVE tmo-destino(1:5) TO tmovmag-k2-SPLITBUF(7:5)
           MOVE tmo-data-movim(1:8) TO tmovmag-k2-SPLITBUF(12:8)
           .

       tmovmag-k-data-MERGE-SPLITBUF.
           INITIALIZE tmovmag-k-data-SPLITBUF
           MOVE tmo-data-movim(1:8) TO tmovmag-k-data-SPLITBUF(1:8)
           MOVE tmo-numero(1:8) TO tmovmag-k-data-SPLITBUF(9:8)
           .

       DataSet1-tmovmag-INITSTART.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tmovmag-KEY1-Asc
                 MOVE Low-Value TO tmo-chiave
              ELSE
                 MOVE High-Value TO tmo-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tmovmag-INITEND.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tmovmag-KEY1-Asc
                 MOVE High-Value TO tmo-chiave
              ELSE
                 MOVE Low-Value TO tmo-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           .   

       DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-tmovmag-KEY1-ORDER
           END-EVALUATE
           .

       DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-tmovmag-KEY1-ORDER
           END-EVALUATE
           .

      * tmovmag
       DataSet1-tmovmag-START.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tmovmag-KEY1-Asc
                 START tmovmag KEY >= tmo-chiave
              ELSE
                 START tmovmag KEY <= tmo-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tmovmag-START-NOTGREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tmovmag-KEY1-Asc
                 START tmovmag KEY <= tmo-chiave
              ELSE
                 START tmovmag KEY >= tmo-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tmovmag-START-GREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tmovmag-KEY1-Asc
                 START tmovmag KEY > tmo-chiave
              ELSE
                 START tmovmag KEY < tmo-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tmovmag-START-LESS.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tmovmag-KEY1-Asc
                 START tmovmag KEY < tmo-chiave
              ELSE
                 START tmovmag KEY > tmo-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tmovmag-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tmovmag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmovmag, BeforeReadRecord>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tmovmag-LOCK
                 READ tmovmag WITH LOCK 
                 KEY tmo-chiave
              ELSE
                 READ tmovmag WITH NO LOCK 
                 KEY tmo-chiave
              END-IF
           END-EVALUATE
           PERFORM tmovmag-key01-MERGE-SPLITBUF
           PERFORM tmovmag-k2-MERGE-SPLITBUF
           PERFORM tmovmag-k-data-MERGE-SPLITBUF
           MOVE STATUS-tmovmag TO TOTEM-ERR-STAT 
           MOVE "tmovmag" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmovmag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmovmag, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tmovmag-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tmovmag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmovmag, BeforeReadNext>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tmovmag-KEY1-Asc
                 IF DataSet1-tmovmag-LOCK
                    READ tmovmag NEXT WITH LOCK
                 ELSE
                    READ tmovmag NEXT WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-tmovmag-LOCK
                    READ tmovmag PREVIOUS WITH LOCK
                 ELSE
                    READ tmovmag PREVIOUS WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           PERFORM tmovmag-key01-MERGE-SPLITBUF
           PERFORM tmovmag-k2-MERGE-SPLITBUF
           PERFORM tmovmag-k-data-MERGE-SPLITBUF
           MOVE STATUS-tmovmag TO TOTEM-ERR-STAT
           MOVE "tmovmag" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmovmag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmovmag, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tmovmag-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tmovmag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmovmag, BeforeReadPrev>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tmovmag-KEY1-Asc
                 IF DataSet1-tmovmag-LOCK
                    READ tmovmag PREVIOUS WITH LOCK
                 ELSE
                    READ tmovmag PREVIOUS WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-tmovmag-LOCK
                    READ tmovmag NEXT WITH LOCK
                 ELSE
                    READ tmovmag NEXT WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           PERFORM tmovmag-key01-MERGE-SPLITBUF
           PERFORM tmovmag-k2-MERGE-SPLITBUF
           PERFORM tmovmag-k-data-MERGE-SPLITBUF
           MOVE STATUS-tmovmag TO TOTEM-ERR-STAT
           MOVE "tmovmag" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmovmag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmovmag, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tmovmag-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tmovmag, BeforeWrite>
      * <TOTEM:END>
           WRITE tmo-rec OF tmovmag.
           MOVE STATUS-tmovmag TO TOTEM-ERR-STAT
           MOVE "tmovmag" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmovmag, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tmovmag-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tmovmag, BeforeRewrite>
      * <TOTEM:END>
           REWRITE tmo-rec OF tmovmag.
           MOVE STATUS-tmovmag TO TOTEM-ERR-STAT
           MOVE "tmovmag" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmovmag, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tmovmag-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tmovmag, BeforeDelete>
      * <TOTEM:END>
           DELETE tmovmag.
           MOVE STATUS-tmovmag TO TOTEM-ERR-STAT
           MOVE "tmovmag" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmovmag, AfterDelete>
      * <TOTEM:END>
           .

       rmovmag-k-articolo-MERGE-SPLITBUF.
           INITIALIZE rmovmag-k-articolo-SPLITBUF
           MOVE rmo-anno OF rmovmag(1:4) TO 
           rmovmag-k-articolo-SPLITBUF(1:4)
           MOVE rmo-movim OF rmovmag(1:8) TO 
           rmovmag-k-articolo-SPLITBUF(5:8)
           MOVE rmo-articolo OF rmovmag(1:6) TO 
           rmovmag-k-articolo-SPLITBUF(13:6)
           .

       rmovmag-rmo-chiave-ricerca-MERGE-SPLITBUF.
           INITIALIZE rmovmag-rmo-chiave-ricerca-SPLITBUF
           MOVE rmo-tipo OF rmovmag(1:1) TO 
           rmovmag-rmo-chiave-ricerca-SPLITBUF(1:1)
           MOVE rmo-cod-clifor OF rmovmag(1:5) TO 
           rmovmag-rmo-chiave-ricerca-SPLITBUF(2:5)
           MOVE rmo-causale OF rmovmag(1:4) TO 
           rmovmag-rmo-chiave-ricerca-SPLITBUF(7:4)
           MOVE rmo-articolo OF rmovmag(1:6) TO 
           rmovmag-rmo-chiave-ricerca-SPLITBUF(11:6)
           MOVE rmo-data-movim OF rmovmag(1:8) TO 
           rmovmag-rmo-chiave-ricerca-SPLITBUF(17:8)
           .

       rmovmag-k-progmag-MERGE-SPLITBUF.
           INITIALIZE rmovmag-k-progmag-SPLITBUF
           MOVE rmo-chiave-progmag OF rmovmag(1:20) TO 
           rmovmag-k-progmag-SPLITBUF(1:20)
           .

       rmovmag-k-art-data-MERGE-SPLITBUF.
           INITIALIZE rmovmag-k-art-data-SPLITBUF
           MOVE rmo-articolo OF rmovmag(1:6) TO 
           rmovmag-k-art-data-SPLITBUF(1:6)
           MOVE rmo-data-movim OF rmovmag(1:8) TO 
           rmovmag-k-art-data-SPLITBUF(7:8)
           .

       DataSet1-rmovmag-INITSTART.
           IF DataSet1-rmovmag-KEY-Asc
              MOVE Low-Value TO rmo-chiave OF rmovmag
           ELSE
              MOVE High-Value TO rmo-chiave OF rmovmag
           END-IF
           .

       DataSet1-rmovmag-INITEND.
           IF DataSet1-rmovmag-KEY-Asc
              MOVE High-Value TO rmo-chiave OF rmovmag
           ELSE
              MOVE Low-Value TO rmo-chiave OF rmovmag
           END-IF
           .

      * rmovmag
       DataSet1-rmovmag-START.
           IF DataSet1-rmovmag-KEY-Asc
              START rmovmag KEY >= rmo-chiave OF rmovmag
           ELSE
              START rmovmag KEY <= rmo-chiave OF rmovmag
           END-IF
           .

       DataSet1-rmovmag-START-NOTGREATER.
           IF DataSet1-rmovmag-KEY-Asc
              START rmovmag KEY <= rmo-chiave OF rmovmag
           ELSE
              START rmovmag KEY >= rmo-chiave OF rmovmag
           END-IF
           .

       DataSet1-rmovmag-START-GREATER.
           IF DataSet1-rmovmag-KEY-Asc
              START rmovmag KEY > rmo-chiave OF rmovmag
           ELSE
              START rmovmag KEY < rmo-chiave OF rmovmag
           END-IF
           .

       DataSet1-rmovmag-START-LESS.
           IF DataSet1-rmovmag-KEY-Asc
              START rmovmag KEY < rmo-chiave OF rmovmag
           ELSE
              START rmovmag KEY > rmo-chiave OF rmovmag
           END-IF
           .

       DataSet1-rmovmag-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:rmovmag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rmovmag, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-rmovmag-LOCK
              READ rmovmag WITH LOCK 
              KEY rmo-chiave OF rmovmag
           ELSE
              READ rmovmag WITH NO LOCK 
              KEY rmo-chiave OF rmovmag
           END-IF
           PERFORM rmovmag-k-articolo-MERGE-SPLITBUF
           PERFORM rmovmag-rmo-chiave-ricerca-MERGE-SPLITBUF
           PERFORM rmovmag-k-progmag-MERGE-SPLITBUF
           PERFORM rmovmag-k-art-data-MERGE-SPLITBUF
           MOVE STATUS-rmovmag TO TOTEM-ERR-STAT 
           MOVE "rmovmag" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rmovmag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rmovmag, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-rmovmag-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:rmovmag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rmovmag, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-rmovmag-KEY-Asc
              IF DataSet1-rmovmag-LOCK
                 READ rmovmag NEXT WITH LOCK
              ELSE
                 READ rmovmag NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-rmovmag-LOCK
                 READ rmovmag PREVIOUS WITH LOCK
              ELSE
                 READ rmovmag PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM rmovmag-k-articolo-MERGE-SPLITBUF
           PERFORM rmovmag-rmo-chiave-ricerca-MERGE-SPLITBUF
           PERFORM rmovmag-k-progmag-MERGE-SPLITBUF
           PERFORM rmovmag-k-art-data-MERGE-SPLITBUF
           MOVE STATUS-rmovmag TO TOTEM-ERR-STAT
           MOVE "rmovmag" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rmovmag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rmovmag, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-rmovmag-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:rmovmag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rmovmag, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-rmovmag-KEY-Asc
              IF DataSet1-rmovmag-LOCK
                 READ rmovmag PREVIOUS WITH LOCK
              ELSE
                 READ rmovmag PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-rmovmag-LOCK
                 READ rmovmag NEXT WITH LOCK
              ELSE
                 READ rmovmag NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM rmovmag-k-articolo-MERGE-SPLITBUF
           PERFORM rmovmag-rmo-chiave-ricerca-MERGE-SPLITBUF
           PERFORM rmovmag-k-progmag-MERGE-SPLITBUF
           PERFORM rmovmag-k-art-data-MERGE-SPLITBUF
           MOVE STATUS-rmovmag TO TOTEM-ERR-STAT
           MOVE "rmovmag" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rmovmag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rmovmag, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-rmovmag-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:rmovmag, BeforeWrite>
      * <TOTEM:END>
           WRITE rmo-rec OF rmovmag.
           MOVE STATUS-rmovmag TO TOTEM-ERR-STAT
           MOVE "rmovmag" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rmovmag, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-rmovmag-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:rmovmag, BeforeRewrite>
      * <TOTEM:END>
           REWRITE rmo-rec OF rmovmag.
           MOVE STATUS-rmovmag TO TOTEM-ERR-STAT
           MOVE "rmovmag" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rmovmag, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-rmovmag-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:rmovmag, BeforeDelete>
      * <TOTEM:END>
           DELETE rmovmag.
           MOVE STATUS-rmovmag TO TOTEM-ERR-STAT
           MOVE "rmovmag" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rmovmag, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tparamge-INITSTART.
           IF DataSet1-tparamge-KEY-Asc
              MOVE Low-Value TO tge-chiave
           ELSE
              MOVE High-Value TO tge-chiave
           END-IF
           .

       DataSet1-tparamge-INITEND.
           IF DataSet1-tparamge-KEY-Asc
              MOVE High-Value TO tge-chiave
           ELSE
              MOVE Low-Value TO tge-chiave
           END-IF
           .

      * tparamge
       DataSet1-tparamge-START.
           IF DataSet1-tparamge-KEY-Asc
              START tparamge KEY >= tge-chiave
           ELSE
              START tparamge KEY <= tge-chiave
           END-IF
           .

       DataSet1-tparamge-START-NOTGREATER.
           IF DataSet1-tparamge-KEY-Asc
              START tparamge KEY <= tge-chiave
           ELSE
              START tparamge KEY >= tge-chiave
           END-IF
           .

       DataSet1-tparamge-START-GREATER.
           IF DataSet1-tparamge-KEY-Asc
              START tparamge KEY > tge-chiave
           ELSE
              START tparamge KEY < tge-chiave
           END-IF
           .

       DataSet1-tparamge-START-LESS.
           IF DataSet1-tparamge-KEY-Asc
              START tparamge KEY < tge-chiave
           ELSE
              START tparamge KEY > tge-chiave
           END-IF
           .

       DataSet1-tparamge-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tparamge-LOCK
              READ tparamge WITH LOCK 
              KEY tge-chiave
           ELSE
              READ tparamge WITH NO LOCK 
              KEY tge-chiave
           END-IF
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT 
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tparamge-KEY-Asc
              IF DataSet1-tparamge-LOCK
                 READ tparamge NEXT WITH LOCK
              ELSE
                 READ tparamge NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tparamge-LOCK
                 READ tparamge PREVIOUS WITH LOCK
              ELSE
                 READ tparamge PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tparamge-KEY-Asc
              IF DataSet1-tparamge-LOCK
                 READ tparamge PREVIOUS WITH LOCK
              ELSE
                 READ tparamge PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tparamge-LOCK
                 READ tparamge NEXT WITH LOCK
              ELSE
                 READ tparamge NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterDelete>
      * <TOTEM:END>
           .

       tcodpag-TBL-CODICE-01-MERGE-SPLITBUF.
           INITIALIZE tcodpag-TBL-CODICE-01-SPLITBUF
           MOVE TBLPA-CODICE1(1:2) TO 
           tcodpag-TBL-CODICE-01-SPLITBUF(1:2)
           MOVE TBLPA-DESCRIZIONE1(1:30) TO 
           tcodpag-TBL-CODICE-01-SPLITBUF(3:30)
           MOVE TBLPA-CODICE2(1:20) TO 
           tcodpag-TBL-CODICE-01-SPLITBUF(33:20)
           .

       DataSet1-tcodpag-INITSTART.
           IF DataSet1-tcodpag-KEY-Asc
              MOVE Low-Value TO TBLPA-CODICE
           ELSE
              MOVE High-Value TO TBLPA-CODICE
           END-IF
           .

       DataSet1-tcodpag-INITEND.
           IF DataSet1-tcodpag-KEY-Asc
              MOVE High-Value TO TBLPA-CODICE
           ELSE
              MOVE Low-Value TO TBLPA-CODICE
           END-IF
           .

      * tcodpag
       DataSet1-tcodpag-START.
           IF DataSet1-tcodpag-KEY-Asc
              START tcodpag KEY >= TBLPA-CODICE
           ELSE
              START tcodpag KEY <= TBLPA-CODICE
           END-IF
           .

       DataSet1-tcodpag-START-NOTGREATER.
           IF DataSet1-tcodpag-KEY-Asc
              START tcodpag KEY <= TBLPA-CODICE
           ELSE
              START tcodpag KEY >= TBLPA-CODICE
           END-IF
           .

       DataSet1-tcodpag-START-GREATER.
           IF DataSet1-tcodpag-KEY-Asc
              START tcodpag KEY > TBLPA-CODICE
           ELSE
              START tcodpag KEY < TBLPA-CODICE
           END-IF
           .

       DataSet1-tcodpag-START-LESS.
           IF DataSet1-tcodpag-KEY-Asc
              START tcodpag KEY < TBLPA-CODICE
           ELSE
              START tcodpag KEY > TBLPA-CODICE
           END-IF
           .

       DataSet1-tcodpag-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tcodpag-LOCK
              READ tcodpag WITH LOCK 
              KEY TBLPA-CODICE
           ELSE
              READ tcodpag WITH NO LOCK 
              KEY TBLPA-CODICE
           END-IF
           PERFORM tcodpag-TBL-CODICE-01-MERGE-SPLITBUF
           MOVE status-tcodpag TO TOTEM-ERR-STAT 
           MOVE "tcodpag" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tcodpag-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tcodpag-KEY-Asc
              IF DataSet1-tcodpag-LOCK
                 READ tcodpag NEXT WITH LOCK
              ELSE
                 READ tcodpag NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tcodpag-LOCK
                 READ tcodpag PREVIOUS WITH LOCK
              ELSE
                 READ tcodpag PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tcodpag-TBL-CODICE-01-MERGE-SPLITBUF
           MOVE status-tcodpag TO TOTEM-ERR-STAT
           MOVE "tcodpag" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tcodpag-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tcodpag-KEY-Asc
              IF DataSet1-tcodpag-LOCK
                 READ tcodpag PREVIOUS WITH LOCK
              ELSE
                 READ tcodpag PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tcodpag-LOCK
                 READ tcodpag NEXT WITH LOCK
              ELSE
                 READ tcodpag NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tcodpag-TBL-CODICE-01-MERGE-SPLITBUF
           MOVE status-tcodpag TO TOTEM-ERR-STAT
           MOVE "tcodpag" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tcodpag-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeWrite>
      * <TOTEM:END>
           MOVE status-tcodpag TO TOTEM-ERR-STAT
           MOVE "tcodpag" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tcodpag-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeRewrite>
      * <TOTEM:END>
           MOVE status-tcodpag TO TOTEM-ERR-STAT
           MOVE "tcodpag" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tcodpag-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeDelete>
      * <TOTEM:END>
           MOVE status-tcodpag TO TOTEM-ERR-STAT
           MOVE "tcodpag" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterDelete>
      * <TOTEM:END>
           .

       articoli-art-k1-MERGE-SPLITBUF.
           INITIALIZE articoli-art-k1-SPLITBUF
           MOVE art-descrizione OF articoli(1:50) TO 
           articoli-art-k1-SPLITBUF(1:50)
           .

       DataSet1-articoli-INITSTART.
           IF DataSet1-articoli-KEY-Asc
              MOVE Low-Value TO art-chiave OF articoli
           ELSE
              MOVE High-Value TO art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-INITEND.
           IF DataSet1-articoli-KEY-Asc
              MOVE High-Value TO art-chiave OF articoli
           ELSE
              MOVE Low-Value TO art-chiave OF articoli
           END-IF
           .

      * articoli
       DataSet1-articoli-START.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY >= art-chiave OF articoli
           ELSE
              START articoli KEY <= art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-START-NOTGREATER.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY <= art-chiave OF articoli
           ELSE
              START articoli KEY >= art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-START-GREATER.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY > art-chiave OF articoli
           ELSE
              START articoli KEY < art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-START-LESS.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY < art-chiave OF articoli
           ELSE
              START articoli KEY > art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-articoli-LOCK
              READ articoli WITH LOCK 
              KEY art-chiave OF articoli
           ELSE
              READ articoli WITH NO LOCK 
              KEY art-chiave OF articoli
           END-IF
           PERFORM articoli-art-k1-MERGE-SPLITBUF
           MOVE STATUS-articoli TO TOTEM-ERR-STAT 
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-articoli-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-articoli-KEY-Asc
              IF DataSet1-articoli-LOCK
                 READ articoli NEXT WITH LOCK
              ELSE
                 READ articoli NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-articoli-LOCK
                 READ articoli PREVIOUS WITH LOCK
              ELSE
                 READ articoli PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM articoli-art-k1-MERGE-SPLITBUF
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-articoli-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-articoli-KEY-Asc
              IF DataSet1-articoli-LOCK
                 READ articoli PREVIOUS WITH LOCK
              ELSE
                 READ articoli PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-articoli-LOCK
                 READ articoli NEXT WITH LOCK
              ELSE
                 READ articoli NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM articoli-art-k1-MERGE-SPLITBUF
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-articoli-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-articoli-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-articoli-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tcaudisb-INITSTART.
           IF DataSet1-tcaudisb-KEY-Asc
              MOVE Low-Value TO tdc-chiave
           ELSE
              MOVE High-Value TO tdc-chiave
           END-IF
           .

       DataSet1-tcaudisb-INITEND.
           IF DataSet1-tcaudisb-KEY-Asc
              MOVE High-Value TO tdc-chiave
           ELSE
              MOVE Low-Value TO tdc-chiave
           END-IF
           .

      * tcaudisb
       DataSet1-tcaudisb-START.
           IF DataSet1-tcaudisb-KEY-Asc
              START tcaudisb KEY >= tdc-chiave
           ELSE
              START tcaudisb KEY <= tdc-chiave
           END-IF
           .

       DataSet1-tcaudisb-START-NOTGREATER.
           IF DataSet1-tcaudisb-KEY-Asc
              START tcaudisb KEY <= tdc-chiave
           ELSE
              START tcaudisb KEY >= tdc-chiave
           END-IF
           .

       DataSet1-tcaudisb-START-GREATER.
           IF DataSet1-tcaudisb-KEY-Asc
              START tcaudisb KEY > tdc-chiave
           ELSE
              START tcaudisb KEY < tdc-chiave
           END-IF
           .

       DataSet1-tcaudisb-START-LESS.
           IF DataSet1-tcaudisb-KEY-Asc
              START tcaudisb KEY < tdc-chiave
           ELSE
              START tcaudisb KEY > tdc-chiave
           END-IF
           .

       DataSet1-tcaudisb-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaudisb, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaudisb, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tcaudisb-LOCK
              READ tcaudisb WITH LOCK 
              KEY tdc-chiave
           ELSE
              READ tcaudisb WITH NO LOCK 
              KEY tdc-chiave
           END-IF
           MOVE STATUS-tcaudisb TO TOTEM-ERR-STAT 
           MOVE "tcaudisb" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaudisb, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaudisb, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tcaudisb-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaudisb, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaudisb, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tcaudisb-KEY-Asc
              IF DataSet1-tcaudisb-LOCK
                 READ tcaudisb NEXT WITH LOCK
              ELSE
                 READ tcaudisb NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tcaudisb-LOCK
                 READ tcaudisb PREVIOUS WITH LOCK
              ELSE
                 READ tcaudisb PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tcaudisb TO TOTEM-ERR-STAT
           MOVE "tcaudisb" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaudisb, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaudisb, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tcaudisb-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaudisb, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaudisb, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tcaudisb-KEY-Asc
              IF DataSet1-tcaudisb-LOCK
                 READ tcaudisb PREVIOUS WITH LOCK
              ELSE
                 READ tcaudisb PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tcaudisb-LOCK
                 READ tcaudisb NEXT WITH LOCK
              ELSE
                 READ tcaudisb NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tcaudisb TO TOTEM-ERR-STAT
           MOVE "tcaudisb" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaudisb, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaudisb, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tcaudisb-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaudisb, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tcaudisb TO TOTEM-ERR-STAT
           MOVE "tcaudisb" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaudisb, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tcaudisb-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaudisb, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tcaudisb TO TOTEM-ERR-STAT
           MOVE "tcaudisb" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaudisb, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tcaudisb-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaudisb, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tcaudisb TO TOTEM-ERR-STAT
           MOVE "tcaudisb" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaudisb, AfterDelete>
      * <TOTEM:END>
           .

       tcaumag-k-mag-MERGE-SPLITBUF.
           INITIALIZE tcaumag-k-mag-SPLITBUF
           MOVE tca-cod-magaz(1:3) TO tcaumag-k-mag-SPLITBUF(1:3)
           MOVE tca-ord-forn(1:1) TO tcaumag-k-mag-SPLITBUF(4:1)
           .

       DataSet1-tcaumag-INITSTART.
           IF DataSet1-tcaumag-KEY-Asc
              MOVE Low-Value TO tca-chiave
           ELSE
              MOVE High-Value TO tca-chiave
           END-IF
           .

       DataSet1-tcaumag-INITEND.
           IF DataSet1-tcaumag-KEY-Asc
              MOVE High-Value TO tca-chiave
           ELSE
              MOVE Low-Value TO tca-chiave
           END-IF
           .

      * tcaumag
       DataSet1-tcaumag-START.
           IF DataSet1-tcaumag-KEY-Asc
              START tcaumag KEY >= tca-chiave
           ELSE
              START tcaumag KEY <= tca-chiave
           END-IF
           .

       DataSet1-tcaumag-START-NOTGREATER.
           IF DataSet1-tcaumag-KEY-Asc
              START tcaumag KEY <= tca-chiave
           ELSE
              START tcaumag KEY >= tca-chiave
           END-IF
           .

       DataSet1-tcaumag-START-GREATER.
           IF DataSet1-tcaumag-KEY-Asc
              START tcaumag KEY > tca-chiave
           ELSE
              START tcaumag KEY < tca-chiave
           END-IF
           .

       DataSet1-tcaumag-START-LESS.
           IF DataSet1-tcaumag-KEY-Asc
              START tcaumag KEY < tca-chiave
           ELSE
              START tcaumag KEY > tca-chiave
           END-IF
           .

       DataSet1-tcaumag-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tcaumag-LOCK
              READ tcaumag WITH LOCK 
              KEY tca-chiave
           ELSE
              READ tcaumag WITH NO LOCK 
              KEY tca-chiave
           END-IF
           PERFORM tcaumag-k-mag-MERGE-SPLITBUF
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT 
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tcaumag-KEY-Asc
              IF DataSet1-tcaumag-LOCK
                 READ tcaumag NEXT WITH LOCK
              ELSE
                 READ tcaumag NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tcaumag-LOCK
                 READ tcaumag PREVIOUS WITH LOCK
              ELSE
                 READ tcaumag PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tcaumag-k-mag-MERGE-SPLITBUF
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tcaumag-KEY-Asc
              IF DataSet1-tcaumag-LOCK
                 READ tcaumag PREVIOUS WITH LOCK
              ELSE
                 READ tcaumag PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tcaumag-LOCK
                 READ tcaumag NEXT WITH LOCK
              ELSE
                 READ tcaumag NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tcaumag-k-mag-MERGE-SPLITBUF
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterDelete>
      * <TOTEM:END>
           .

       clienti-cli-K1-MERGE-SPLITBUF.
           INITIALIZE clienti-cli-K1-SPLITBUF
           MOVE cli-tipo-CF OF clienti(1:1) TO 
           clienti-cli-K1-SPLITBUF(1:1)
           MOVE cli-ragsoc-1 OF clienti(1:40) TO 
           clienti-cli-K1-SPLITBUF(2:40)
           MOVE cli-codice OF clienti(1:5) TO 
           clienti-cli-K1-SPLITBUF(42:5)
           .

       clienti-cli-K3-MERGE-SPLITBUF.
           INITIALIZE clienti-cli-K3-SPLITBUF
           MOVE cli-gdo OF clienti(1:5) TO clienti-cli-K3-SPLITBUF(1:5)
           MOVE cli-chiave OF clienti(1:6) TO 
           clienti-cli-K3-SPLITBUF(6:6)
           .

       clienti-cli-K4-MERGE-SPLITBUF.
           INITIALIZE clienti-cli-K4-SPLITBUF
           MOVE cli-utf OF clienti(1:1) TO clienti-cli-K4-SPLITBUF(1:1)
           MOVE cli-chiave OF clienti(1:6) TO 
           clienti-cli-K4-SPLITBUF(2:6)
           .

       DataSet1-clienti-INITSTART.
           IF DataSet1-clienti-KEY-Asc
              MOVE Low-Value TO cli-chiave OF clienti
           ELSE
              MOVE High-Value TO cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-INITEND.
           IF DataSet1-clienti-KEY-Asc
              MOVE High-Value TO cli-chiave OF clienti
           ELSE
              MOVE Low-Value TO cli-chiave OF clienti
           END-IF
           .

      * clienti
       DataSet1-clienti-START.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY >= cli-chiave OF clienti
           ELSE
              START clienti KEY <= cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-START-NOTGREATER.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY <= cli-chiave OF clienti
           ELSE
              START clienti KEY >= cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-START-GREATER.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY > cli-chiave OF clienti
           ELSE
              START clienti KEY < cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-START-LESS.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY < cli-chiave OF clienti
           ELSE
              START clienti KEY > cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-clienti-LOCK
              READ clienti WITH LOCK 
              KEY cli-chiave OF clienti
           ELSE
              READ clienti WITH NO LOCK 
              KEY cli-chiave OF clienti
           END-IF
           PERFORM clienti-cli-K1-MERGE-SPLITBUF
           PERFORM clienti-cli-K3-MERGE-SPLITBUF
           PERFORM clienti-cli-K4-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT 
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-clienti-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-clienti-KEY-Asc
              IF DataSet1-clienti-LOCK
                 READ clienti NEXT WITH LOCK
              ELSE
                 READ clienti NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-clienti-LOCK
                 READ clienti PREVIOUS WITH LOCK
              ELSE
                 READ clienti PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM clienti-cli-K1-MERGE-SPLITBUF
           PERFORM clienti-cli-K3-MERGE-SPLITBUF
           PERFORM clienti-cli-K4-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-clienti-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-clienti-KEY-Asc
              IF DataSet1-clienti-LOCK
                 READ clienti PREVIOUS WITH LOCK
              ELSE
                 READ clienti PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-clienti-LOCK
                 READ clienti NEXT WITH LOCK
              ELSE
                 READ clienti NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM clienti-cli-K1-MERGE-SPLITBUF
           PERFORM clienti-cli-K3-MERGE-SPLITBUF
           PERFORM clienti-cli-K4-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-timballi-INITSTART.
           IF DataSet1-timballi-KEY-Asc
              MOVE Low-Value TO imb-chiave
           ELSE
              MOVE High-Value TO imb-chiave
           END-IF
           .

       DataSet1-timballi-INITEND.
           IF DataSet1-timballi-KEY-Asc
              MOVE High-Value TO imb-chiave
           ELSE
              MOVE Low-Value TO imb-chiave
           END-IF
           .

      * timballi
       DataSet1-timballi-START.
           IF DataSet1-timballi-KEY-Asc
              START timballi KEY >= imb-chiave
           ELSE
              START timballi KEY <= imb-chiave
           END-IF
           .

       DataSet1-timballi-START-NOTGREATER.
           IF DataSet1-timballi-KEY-Asc
              START timballi KEY <= imb-chiave
           ELSE
              START timballi KEY >= imb-chiave
           END-IF
           .

       DataSet1-timballi-START-GREATER.
           IF DataSet1-timballi-KEY-Asc
              START timballi KEY > imb-chiave
           ELSE
              START timballi KEY < imb-chiave
           END-IF
           .

       DataSet1-timballi-START-LESS.
           IF DataSet1-timballi-KEY-Asc
              START timballi KEY < imb-chiave
           ELSE
              START timballi KEY > imb-chiave
           END-IF
           .

       DataSet1-timballi-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-timballi-LOCK
              READ timballi WITH LOCK 
              KEY imb-chiave
           ELSE
              READ timballi WITH NO LOCK 
              KEY imb-chiave
           END-IF
           MOVE STATUS-timballi TO TOTEM-ERR-STAT 
           MOVE "timballi" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-timballi-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-timballi-KEY-Asc
              IF DataSet1-timballi-LOCK
                 READ timballi NEXT WITH LOCK
              ELSE
                 READ timballi NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-timballi-LOCK
                 READ timballi PREVIOUS WITH LOCK
              ELSE
                 READ timballi PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-timballi TO TOTEM-ERR-STAT
           MOVE "timballi" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-timballi-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-timballi-KEY-Asc
              IF DataSet1-timballi-LOCK
                 READ timballi PREVIOUS WITH LOCK
              ELSE
                 READ timballi PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-timballi-LOCK
                 READ timballi NEXT WITH LOCK
              ELSE
                 READ timballi NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-timballi TO TOTEM-ERR-STAT
           MOVE "timballi" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-timballi-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-timballi TO TOTEM-ERR-STAT
           MOVE "timballi" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-timballi-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-timballi TO TOTEM-ERR-STAT
           MOVE "timballi" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-timballi-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-timballi TO TOTEM-ERR-STAT
           MOVE "timballi" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timballi, AfterDelete>
      * <TOTEM:END>
           .

       distinteb-k-articolo-MERGE-SPLITBUF.
           INITIALIZE distinteb-k-articolo-SPLITBUF
           MOVE dis-articolo-finale(1:6) TO 
           distinteb-k-articolo-SPLITBUF(1:6)
           MOVE dis-chiave(1:5) TO distinteb-k-articolo-SPLITBUF(7:5)
           .

       distinteb-k-progmag-MERGE-SPLITBUF.
           INITIALIZE distinteb-k-progmag-SPLITBUF
           MOVE dis-chiave-progmag(1:20) TO 
           distinteb-k-progmag-SPLITBUF(1:20)
           .

       DataSet1-distinteb-INITSTART.
           IF DataSet1-distinteb-KEY-Asc
              MOVE Low-Value TO dis-chiave
           ELSE
              MOVE High-Value TO dis-chiave
           END-IF
           .

       DataSet1-distinteb-INITEND.
           IF DataSet1-distinteb-KEY-Asc
              MOVE High-Value TO dis-chiave
           ELSE
              MOVE Low-Value TO dis-chiave
           END-IF
           .

      * distinteb
       DataSet1-distinteb-START.
           IF DataSet1-distinteb-KEY-Asc
              START distinteb KEY >= dis-chiave
           ELSE
              START distinteb KEY <= dis-chiave
           END-IF
           .

       DataSet1-distinteb-START-NOTGREATER.
           IF DataSet1-distinteb-KEY-Asc
              START distinteb KEY <= dis-chiave
           ELSE
              START distinteb KEY >= dis-chiave
           END-IF
           .

       DataSet1-distinteb-START-GREATER.
           IF DataSet1-distinteb-KEY-Asc
              START distinteb KEY > dis-chiave
           ELSE
              START distinteb KEY < dis-chiave
           END-IF
           .

       DataSet1-distinteb-START-LESS.
           IF DataSet1-distinteb-KEY-Asc
              START distinteb KEY < dis-chiave
           ELSE
              START distinteb KEY > dis-chiave
           END-IF
           .

       DataSet1-distinteb-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-distinteb-LOCK
              READ distinteb WITH LOCK 
              KEY dis-chiave
           ELSE
              READ distinteb WITH NO LOCK 
              KEY dis-chiave
           END-IF
           PERFORM distinteb-k-articolo-MERGE-SPLITBUF
           PERFORM distinteb-k-progmag-MERGE-SPLITBUF
           MOVE STATUS-distinteb TO TOTEM-ERR-STAT 
           MOVE "distinteb" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-distinteb-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-distinteb-KEY-Asc
              IF DataSet1-distinteb-LOCK
                 READ distinteb NEXT WITH LOCK
              ELSE
                 READ distinteb NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-distinteb-LOCK
                 READ distinteb PREVIOUS WITH LOCK
              ELSE
                 READ distinteb PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM distinteb-k-articolo-MERGE-SPLITBUF
           PERFORM distinteb-k-progmag-MERGE-SPLITBUF
           MOVE STATUS-distinteb TO TOTEM-ERR-STAT
           MOVE "distinteb" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-distinteb-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-distinteb-KEY-Asc
              IF DataSet1-distinteb-LOCK
                 READ distinteb PREVIOUS WITH LOCK
              ELSE
                 READ distinteb PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-distinteb-LOCK
                 READ distinteb NEXT WITH LOCK
              ELSE
                 READ distinteb NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM distinteb-k-articolo-MERGE-SPLITBUF
           PERFORM distinteb-k-progmag-MERGE-SPLITBUF
           MOVE STATUS-distinteb TO TOTEM-ERR-STAT
           MOVE "distinteb" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-distinteb-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-distinteb TO TOTEM-ERR-STAT
           MOVE "distinteb" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-distinteb-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-distinteb TO TOTEM-ERR-STAT
           MOVE "distinteb" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-distinteb-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-distinteb TO TOTEM-ERR-STAT
           MOVE "distinteb" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-timbalqta-INITSTART.
           IF DataSet1-timbalqta-KEY-Asc
              MOVE Low-Value TO imq-chiave
           ELSE
              MOVE High-Value TO imq-chiave
           END-IF
           .

       DataSet1-timbalqta-INITEND.
           IF DataSet1-timbalqta-KEY-Asc
              MOVE High-Value TO imq-chiave
           ELSE
              MOVE Low-Value TO imq-chiave
           END-IF
           .

      * timbalqta
       DataSet1-timbalqta-START.
           IF DataSet1-timbalqta-KEY-Asc
              START timbalqta KEY >= imq-chiave
           ELSE
              START timbalqta KEY <= imq-chiave
           END-IF
           .

       DataSet1-timbalqta-START-NOTGREATER.
           IF DataSet1-timbalqta-KEY-Asc
              START timbalqta KEY <= imq-chiave
           ELSE
              START timbalqta KEY >= imq-chiave
           END-IF
           .

       DataSet1-timbalqta-START-GREATER.
           IF DataSet1-timbalqta-KEY-Asc
              START timbalqta KEY > imq-chiave
           ELSE
              START timbalqta KEY < imq-chiave
           END-IF
           .

       DataSet1-timbalqta-START-LESS.
           IF DataSet1-timbalqta-KEY-Asc
              START timbalqta KEY < imq-chiave
           ELSE
              START timbalqta KEY > imq-chiave
           END-IF
           .

       DataSet1-timbalqta-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-timbalqta-LOCK
              READ timbalqta WITH LOCK 
              KEY imq-chiave
           ELSE
              READ timbalqta WITH NO LOCK 
              KEY imq-chiave
           END-IF
           MOVE STATUS-timbalqta TO TOTEM-ERR-STAT 
           MOVE "timbalqta" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-timbalqta-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-timbalqta-KEY-Asc
              IF DataSet1-timbalqta-LOCK
                 READ timbalqta NEXT WITH LOCK
              ELSE
                 READ timbalqta NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-timbalqta-LOCK
                 READ timbalqta PREVIOUS WITH LOCK
              ELSE
                 READ timbalqta PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-timbalqta TO TOTEM-ERR-STAT
           MOVE "timbalqta" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-timbalqta-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-timbalqta-KEY-Asc
              IF DataSet1-timbalqta-LOCK
                 READ timbalqta PREVIOUS WITH LOCK
              ELSE
                 READ timbalqta PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-timbalqta-LOCK
                 READ timbalqta NEXT WITH LOCK
              ELSE
                 READ timbalqta NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-timbalqta TO TOTEM-ERR-STAT
           MOVE "timbalqta" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-timbalqta-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-timbalqta TO TOTEM-ERR-STAT
           MOVE "timbalqta" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-timbalqta-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-timbalqta TO TOTEM-ERR-STAT
           MOVE "timbalqta" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-timbalqta-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-timbalqta TO TOTEM-ERR-STAT
           MOVE "timbalqta" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timbalqta, AfterDelete>
      * <TOTEM:END>
           .

       progmag-key01-MERGE-SPLITBUF.
           INITIALIZE progmag-key01-SPLITBUF
           MOVE prg-cod-magazzino OF progmag(1:3) TO 
           progmag-key01-SPLITBUF(1:3)
           MOVE prg-cod-articolo OF progmag(1:6) TO 
           progmag-key01-SPLITBUF(4:6)
           MOVE prg-tipo-imballo OF progmag(1:3) TO 
           progmag-key01-SPLITBUF(10:3)
           MOVE prg-peso OF progmag(1:8) TO progmag-key01-SPLITBUF(13:8)
           .

       DataSet1-progmag-INITSTART.
           IF DataSet1-progmag-KEY-Asc
              MOVE Low-Value TO prg-chiave OF progmag
           ELSE
              MOVE High-Value TO prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-INITEND.
           IF DataSet1-progmag-KEY-Asc
              MOVE High-Value TO prg-chiave OF progmag
           ELSE
              MOVE Low-Value TO prg-chiave OF progmag
           END-IF
           .

      * progmag
       DataSet1-progmag-START.
           IF DataSet1-progmag-KEY-Asc
              START progmag KEY >= prg-chiave OF progmag
           ELSE
              START progmag KEY <= prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-START-NOTGREATER.
           IF DataSet1-progmag-KEY-Asc
              START progmag KEY <= prg-chiave OF progmag
           ELSE
              START progmag KEY >= prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-START-GREATER.
           IF DataSet1-progmag-KEY-Asc
              START progmag KEY > prg-chiave OF progmag
           ELSE
              START progmag KEY < prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-START-LESS.
           IF DataSet1-progmag-KEY-Asc
              START progmag KEY < prg-chiave OF progmag
           ELSE
              START progmag KEY > prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-progmag-LOCK
              READ progmag WITH LOCK 
              KEY prg-chiave OF progmag
           ELSE
              READ progmag WITH NO LOCK 
              KEY prg-chiave OF progmag
           END-IF
           PERFORM progmag-key01-MERGE-SPLITBUF
           MOVE STATUS-progmag TO TOTEM-ERR-STAT 
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-progmag-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-progmag-KEY-Asc
              IF DataSet1-progmag-LOCK
                 READ progmag NEXT WITH LOCK
              ELSE
                 READ progmag NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-progmag-LOCK
                 READ progmag PREVIOUS WITH LOCK
              ELSE
                 READ progmag PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM progmag-key01-MERGE-SPLITBUF
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-progmag-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-progmag-KEY-Asc
              IF DataSet1-progmag-LOCK
                 READ progmag PREVIOUS WITH LOCK
              ELSE
                 READ progmag PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-progmag-LOCK
                 READ progmag NEXT WITH LOCK
              ELSE
                 READ progmag NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM progmag-key01-MERGE-SPLITBUF
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-progmag-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-progmag-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-progmag-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tmagaz-INITSTART.
           IF DataSet1-tmagaz-KEY-Asc
              MOVE Low-Value TO mag-chiave
           ELSE
              MOVE High-Value TO mag-chiave
           END-IF
           .

       DataSet1-tmagaz-INITEND.
           IF DataSet1-tmagaz-KEY-Asc
              MOVE High-Value TO mag-chiave
           ELSE
              MOVE Low-Value TO mag-chiave
           END-IF
           .

      * tmagaz
       DataSet1-tmagaz-START.
           IF DataSet1-tmagaz-KEY-Asc
              START tmagaz KEY >= mag-chiave
           ELSE
              START tmagaz KEY <= mag-chiave
           END-IF
           .

       DataSet1-tmagaz-START-NOTGREATER.
           IF DataSet1-tmagaz-KEY-Asc
              START tmagaz KEY <= mag-chiave
           ELSE
              START tmagaz KEY >= mag-chiave
           END-IF
           .

       DataSet1-tmagaz-START-GREATER.
           IF DataSet1-tmagaz-KEY-Asc
              START tmagaz KEY > mag-chiave
           ELSE
              START tmagaz KEY < mag-chiave
           END-IF
           .

       DataSet1-tmagaz-START-LESS.
           IF DataSet1-tmagaz-KEY-Asc
              START tmagaz KEY < mag-chiave
           ELSE
              START tmagaz KEY > mag-chiave
           END-IF
           .

       DataSet1-tmagaz-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tmagaz-LOCK
              READ tmagaz WITH LOCK 
              KEY mag-chiave
           ELSE
              READ tmagaz WITH NO LOCK 
              KEY mag-chiave
           END-IF
           MOVE STATUS-tmagaz TO TOTEM-ERR-STAT 
           MOVE "tmagaz" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tmagaz-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tmagaz-KEY-Asc
              IF DataSet1-tmagaz-LOCK
                 READ tmagaz NEXT WITH LOCK
              ELSE
                 READ tmagaz NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tmagaz-LOCK
                 READ tmagaz PREVIOUS WITH LOCK
              ELSE
                 READ tmagaz PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tmagaz TO TOTEM-ERR-STAT
           MOVE "tmagaz" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tmagaz-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tmagaz-KEY-Asc
              IF DataSet1-tmagaz-LOCK
                 READ tmagaz PREVIOUS WITH LOCK
              ELSE
                 READ tmagaz PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tmagaz-LOCK
                 READ tmagaz NEXT WITH LOCK
              ELSE
                 READ tmagaz NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tmagaz TO TOTEM-ERR-STAT
           MOVE "tmagaz" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tmagaz-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tmagaz TO TOTEM-ERR-STAT
           MOVE "tmagaz" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tmagaz-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tmagaz TO TOTEM-ERR-STAT
           MOVE "tmagaz" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tmagaz-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tmagaz TO TOTEM-ERR-STAT
           MOVE "tmagaz" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmagaz, AfterDelete>
      * <TOTEM:END>
           .

       zoom-distinteb-k-des-MERGE-SPLITBUF.
           INITIALIZE zoom-distinteb-k-des-SPLITBUF
           MOVE zoom-dis-art-descrizione(1:50) TO 
           zoom-distinteb-k-des-SPLITBUF(1:50)
           MOVE zoom-dis-chiave(1:5) TO 
           zoom-distinteb-k-des-SPLITBUF(51:5)
           .

       DataSet1-zoom-distinteb-INITSTART.
           IF DataSet1-zoom-distinteb-KEY-Asc
              MOVE Low-Value TO zoom-dis-chiave
           ELSE
              MOVE High-Value TO zoom-dis-chiave
           END-IF
           .

       DataSet1-zoom-distinteb-INITEND.
           IF DataSet1-zoom-distinteb-KEY-Asc
              MOVE High-Value TO zoom-dis-chiave
           ELSE
              MOVE Low-Value TO zoom-dis-chiave
           END-IF
           .

      * zoom-distinteb
       DataSet1-zoom-distinteb-START.
           IF DataSet1-zoom-distinteb-KEY-Asc
              START zoom-distinteb KEY >= zoom-dis-chiave
           ELSE
              START zoom-distinteb KEY <= zoom-dis-chiave
           END-IF
           .

       DataSet1-zoom-distinteb-START-NOTGREATER.
           IF DataSet1-zoom-distinteb-KEY-Asc
              START zoom-distinteb KEY <= zoom-dis-chiave
           ELSE
              START zoom-distinteb KEY >= zoom-dis-chiave
           END-IF
           .

       DataSet1-zoom-distinteb-START-GREATER.
           IF DataSet1-zoom-distinteb-KEY-Asc
              START zoom-distinteb KEY > zoom-dis-chiave
           ELSE
              START zoom-distinteb KEY < zoom-dis-chiave
           END-IF
           .

       DataSet1-zoom-distinteb-START-LESS.
           IF DataSet1-zoom-distinteb-KEY-Asc
              START zoom-distinteb KEY < zoom-dis-chiave
           ELSE
              START zoom-distinteb KEY > zoom-dis-chiave
           END-IF
           .

       DataSet1-zoom-distinteb-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-distinteb, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-distinteb, BeforeReadRecord>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-distinteb, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-distinteb, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-zoom-distinteb-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-distinteb, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-distinteb, BeforeReadNext>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-distinteb, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-distinteb, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-zoom-distinteb-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-distinteb, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-distinteb, BeforeReadPrev>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-distinteb, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-distinteb, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-zoom-distinteb-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-distinteb, BeforeWrite>
      * <TOTEM:END>
           WRITE zoom-dis-rec OF zoom-distinteb.
           MOVE STATUS-zoom-distinteb TO TOTEM-ERR-STAT
           MOVE "zoom-distinteb" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-distinteb, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-zoom-distinteb-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-distinteb, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-zoom-distinteb TO TOTEM-ERR-STAT
           MOVE "zoom-distinteb" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-distinteb, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-zoom-distinteb-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-distinteb, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-zoom-distinteb TO TOTEM-ERR-STAT
           MOVE "zoom-distinteb" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:zoom-distinteb, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tmarche-INITSTART.
           IF DataSet1-tmarche-KEY-Asc
              MOVE Low-Value TO mar-chiave
           ELSE
              MOVE High-Value TO mar-chiave
           END-IF
           .

       DataSet1-tmarche-INITEND.
           IF DataSet1-tmarche-KEY-Asc
              MOVE High-Value TO mar-chiave
           ELSE
              MOVE Low-Value TO mar-chiave
           END-IF
           .

      * tmarche
       DataSet1-tmarche-START.
           IF DataSet1-tmarche-KEY-Asc
              START tmarche KEY >= mar-chiave
           ELSE
              START tmarche KEY <= mar-chiave
           END-IF
           .

       DataSet1-tmarche-START-NOTGREATER.
           IF DataSet1-tmarche-KEY-Asc
              START tmarche KEY <= mar-chiave
           ELSE
              START tmarche KEY >= mar-chiave
           END-IF
           .

       DataSet1-tmarche-START-GREATER.
           IF DataSet1-tmarche-KEY-Asc
              START tmarche KEY > mar-chiave
           ELSE
              START tmarche KEY < mar-chiave
           END-IF
           .

       DataSet1-tmarche-START-LESS.
           IF DataSet1-tmarche-KEY-Asc
              START tmarche KEY < mar-chiave
           ELSE
              START tmarche KEY > mar-chiave
           END-IF
           .

       DataSet1-tmarche-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tmarche-LOCK
              READ tmarche WITH LOCK 
              KEY mar-chiave
           ELSE
              READ tmarche WITH NO LOCK 
              KEY mar-chiave
           END-IF
           MOVE STATUS-tmarche TO TOTEM-ERR-STAT 
           MOVE "tmarche" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tmarche-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tmarche-KEY-Asc
              IF DataSet1-tmarche-LOCK
                 READ tmarche NEXT WITH LOCK
              ELSE
                 READ tmarche NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tmarche-LOCK
                 READ tmarche PREVIOUS WITH LOCK
              ELSE
                 READ tmarche PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tmarche TO TOTEM-ERR-STAT
           MOVE "tmarche" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tmarche-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tmarche-KEY-Asc
              IF DataSet1-tmarche-LOCK
                 READ tmarche PREVIOUS WITH LOCK
              ELSE
                 READ tmarche PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tmarche-LOCK
                 READ tmarche NEXT WITH LOCK
              ELSE
                 READ tmarche NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tmarche TO TOTEM-ERR-STAT
           MOVE "tmarche" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tmarche-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tmarche TO TOTEM-ERR-STAT
           MOVE "tmarche" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tmarche-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tmarche TO TOTEM-ERR-STAT
           MOVE "tmarche" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tmarche-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tmarche TO TOTEM-ERR-STAT
           MOVE "tmarche" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-timposte-INITSTART.
           IF DataSet1-timposte-KEY-Asc
              MOVE Low-Value TO imp-chiave
           ELSE
              MOVE High-Value TO imp-chiave
           END-IF
           .

       DataSet1-timposte-INITEND.
           IF DataSet1-timposte-KEY-Asc
              MOVE High-Value TO imp-chiave
           ELSE
              MOVE Low-Value TO imp-chiave
           END-IF
           .

      * timposte
       DataSet1-timposte-START.
           IF DataSet1-timposte-KEY-Asc
              START timposte KEY >= imp-chiave
           ELSE
              START timposte KEY <= imp-chiave
           END-IF
           .

       DataSet1-timposte-START-NOTGREATER.
           IF DataSet1-timposte-KEY-Asc
              START timposte KEY <= imp-chiave
           ELSE
              START timposte KEY >= imp-chiave
           END-IF
           .

       DataSet1-timposte-START-GREATER.
           IF DataSet1-timposte-KEY-Asc
              START timposte KEY > imp-chiave
           ELSE
              START timposte KEY < imp-chiave
           END-IF
           .

       DataSet1-timposte-START-LESS.
           IF DataSet1-timposte-KEY-Asc
              START timposte KEY < imp-chiave
           ELSE
              START timposte KEY > imp-chiave
           END-IF
           .

       DataSet1-timposte-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-timposte-LOCK
              READ timposte WITH LOCK 
              KEY imp-chiave
           ELSE
              READ timposte WITH NO LOCK 
              KEY imp-chiave
           END-IF
           MOVE STATUS-timposte TO TOTEM-ERR-STAT 
           MOVE "timposte" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-timposte-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-timposte-KEY-Asc
              IF DataSet1-timposte-LOCK
                 READ timposte NEXT WITH LOCK
              ELSE
                 READ timposte NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-timposte-LOCK
                 READ timposte PREVIOUS WITH LOCK
              ELSE
                 READ timposte PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-timposte TO TOTEM-ERR-STAT
           MOVE "timposte" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-timposte-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-timposte-KEY-Asc
              IF DataSet1-timposte-LOCK
                 READ timposte PREVIOUS WITH LOCK
              ELSE
                 READ timposte PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-timposte-LOCK
                 READ timposte NEXT WITH LOCK
              ELSE
                 READ timposte NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-timposte TO TOTEM-ERR-STAT
           MOVE "timposte" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-timposte-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-timposte TO TOTEM-ERR-STAT
           MOVE "timposte" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-timposte-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-timposte TO TOTEM-ERR-STAT
           MOVE "timposte" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-timposte-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-timposte TO TOTEM-ERR-STAT
           MOVE "timposte" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-INIT-RECORD.
           INITIALIZE tmo-rec OF tmovmag
           INITIALIZE rmo-rec OF rmovmag
           INITIALIZE tge-rec OF tparamge
           INITIALIZE record-tblpa OF tcodpag
           INITIALIZE art-rec OF articoli
           INITIALIZE tdc-rec OF tcaudisb
           INITIALIZE tca-rec OF tcaumag
           INITIALIZE cli-rec OF clienti
           INITIALIZE imb-rec OF timballi
           INITIALIZE dis-rec OF distinteb
           INITIALIZE imq-rec OF timbalqta
           INITIALIZE prg-rec OF progmag
           INITIALIZE mag-rec OF tmagaz
           INITIALIZE zoom-dis-rec OF zoom-distinteb
           INITIALIZE mar-rec OF tmarche
           INITIALIZE imp-rec OF timposte
           .


      * GRID
       form1-Gd-1-Content.
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 1, Y = 1,
                CELL-DATA = "N°",
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 2, Y = 1,
                CELL-DATA = "Articolo",
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 3, Y = 1,
                CELL-DATA = "Magazz.",
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 4, Y = 1,
                CELL-DATA = "Imballo",
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 5, Y = 1,
                CELL-DATA = "Peso",
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 6, Y = 1,
                CELL-DATA = "Descrizione",
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 7, Y = 1,
                CELL-DATA = "UTF",
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 8, Y = 1,
                CELL-DATA = "Non UTF",
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 9, Y = 1,
                CELL-DATA = "Prezzo MP",
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 10, Y = 1,
                CELL-DATA = "Quantità",
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 11, Y = 1,
                CELL-DATA = "Oneri",
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 12, Y = 1,
                CELL-DATA = "Giacenza",
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 1, Y = 2,
                CELL-DATA = "1",
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 1, Y = 3,
                CELL-DATA = "2",
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 1, Y = 4,
                CELL-DATA = "3",
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 1, Y = 5,
                CELL-DATA = "4",
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 1, Y = 6,
                CELL-DATA = "5",
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 1, Y = 7,
                CELL-DATA = "6",
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 1, Y = 8,
                CELL-DATA = "7",
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 1, Y = 9,
                CELL-DATA = "8",
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 1, Y = 10,
                CELL-DATA = "9",
      * CELLS' SETTING
              MODIFY form1-Gd-1, X = 1, Y = 11,
                CELL-DATA = "10",
           .

      * FD's Initialize Paragraph
       DataSet1-tmovmag-INITREC.
           INITIALIZE tmo-rec OF tmovmag
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-rmovmag-INITREC.
           INITIALIZE rmo-rec OF rmovmag
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tparamge-INITREC.
           INITIALIZE tge-rec OF tparamge
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tcodpag-INITREC.
           INITIALIZE record-tblpa OF tcodpag
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-articoli-INITREC.
           INITIALIZE art-rec OF articoli
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tcaudisb-INITREC.
           INITIALIZE tdc-rec OF tcaudisb
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tcaumag-INITREC.
           INITIALIZE tca-rec OF tcaumag
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-clienti-INITREC.
           INITIALIZE cli-rec OF clienti
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-timballi-INITREC.
           INITIALIZE imb-rec OF timballi
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-distinteb-INITREC.
           INITIALIZE dis-rec OF distinteb
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-timbalqta-INITREC.
           INITIALIZE imq-rec OF timbalqta
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-progmag-INITREC.
           INITIALIZE prg-rec OF progmag
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tmagaz-INITREC.
           INITIALIZE mag-rec OF tmagaz
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-zoom-distinteb-INITREC.
           INITIALIZE zoom-dis-rec OF zoom-distinteb
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tmarche-INITREC.
           INITIALIZE mar-rec OF tmarche
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-timposte-INITREC.
           INITIALIZE imp-rec OF timposte
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      *
       DataSet1-DISPATCH-BUFTOFLD.
           EVALUATE TOTEM-Form-Index ALSO TOTEM-Frame-Index
              WHEN 1 ALSO 0
                  PERFORM Form1-Buf-To-Fld
           END-EVALUATE
           .

       Form1-DISPLAY-STATUS-MSG.
            MODIFY Form1-St-1-Handle PANEL-INDEX = 1
                PANEL-TEXT = TOTEM-HINT-TEXT
           .

       Form1-CLEAR-STATUS-MSG.
           MOVE SPACES TO TOTEM-MSG-1, TOTEM-MSG-2, TOTEM-MSG-3, 
           TOTEM-MSG-TEXT
           PERFORM Form1-DISPLAY-STATUS-MSG
           .

       Form1-Open-Routine.
           PERFORM Form1-Scrn
           PERFORM Form1-Proc
           .

       Form1-Scrn.
           PERFORM Form1-Create-Win
           PERFORM Form1-Init-Value
           PERFORM Form1-Init-Data
      * Tab keystrok settings
      * Tool Bar
           DISPLAY Form1-Tb-1
           PERFORM Form1-DISPLAY
           .

       Form1-Create-Win.
           Display Independent GRAPHICAL WINDOW
              SCREEN LINE 1,
              SCREEN COLUMN 0,
              LINES 42,77,
              SIZE 163,00,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 65793,
              CONTROL FONT Small-Font,
              LABEL-OFFSET 23,
              LINK TO THREAD,
              MODELESS,
              NO SCROLL,
              TITLE-BAR,
              TITLE TITOLO,
              AUTO-MINIMIZE,
              WITH SYSTEM MENU,
              USER-GRAY,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE Form1-Event-Proc,
              HANDLE IS Form1-Handle,
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
           DISPLAY TOOL-BAR 
              LINES 2,69,   
              HANDLE IN Form1-Tb-1-Handle
           DISPLAY Form1-Tb-1 UPON Form1-Tb-1-Handle

      * Status-bar
           DISPLAY STATUS-BAR
              GRIP,
              PANEL-WIDTHS (100, 35, 999),
              PANEL-STYLE  (1, 1, 1),
              PANEL-TEXT   (SPACE, SPACE, SPACE),
              HANDLE IS Form1-St-1-Handle
           DISPLAY Form1 UPON Form1-Handle
      * DISPLAY-COLUMNS settings
              MODIFY form1-Gd-1, DISPLAY-COLUMNS (1, 6, 15, 24, 33, 42, 
           82, 92, 102, 118, 127, 143)
           .

       Form1-PROC.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeAccept>
           perform INIT.
           perform ABILITA-TOOLBAR.
           perform ABILITAZIONI.
           set StatusVisua to true.
           perform LEGGI-ANNO.
           move 1 to mod-campi mod.
           move 0 to mod-k.        
           perform STATUS-BAR-MSG.
           perform DISPLAY-SCREEN.
           accept data-oggi from century-date.

LUBEXX     move data-ult-movim to como-data.
LUBEXX     perform DATE-TO-SCREEN.
LUBEXX     move como-data to ef-data-buf.
LUBEXX     display ef-data.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT Form1
                 ON EXCEPTION
                    PERFORM Form1-Evaluate-Func
                 MOVE 1 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY Form1-Handle
           INITIALIZE Key-Status
           .

       Form1-Evaluate-Func.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM Form1-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM Form1-Exit
                 END-IF
              WHEN Key-Status = 3
                 PERFORM TOOL-SALVA-LinkTo
              WHEN Key-Status = 150
                 PERFORM TOOL-MODIFICA-LinkTo
              WHEN Key-Status = 8
                 PERFORM TOOL-CERCA-LinkTo
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       Form1-CLEAR.
           PERFORM Form1-INIT-VALUE
           PERFORM Form1-DISPLAY
           .

       Form1-DISPLAY.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY Form1-Tb-1
           DISPLAY Form1 UPON Form1-Handle
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterDisplay>
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       Form1-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeExit>
           inquire ef-data, value in como-data.
           |Se ho valorizzato la data vuol dire che ho fatto qualcosa
           |perciò devo chiedere se vuole salvare altrimenti significa
           |che non mi sono nemmeno mosso dal primo campo d'accettazione

           if como-data = 0 set SiSalvato to true
           else             set NoSalvato to true
           end-if.

           if NoSalvato
              display message "Confermare la perdita dei dati inseriti?"
                        title titolo
                         type mb-yes-no
                       giving scelta
                      default mb-no
              if scelta = mb-no
                 move 26 to key-status
                 exit paragraph
              end-if
           end-if.

           .
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       Form1-Init-Data.
           MOVE 1 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
      * GRID
           PERFORM form1-Gd-1-Content
           .

       Form1-DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-tmovmag-KEY1-ORDER
           END-EVALUATE
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-tmovmag-KEY1-ORDER
           END-EVALUATE
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Update-Key.
           MOVE tmo-rec OF tmovmag TO
                     Form1-MULKEY-TMPBUF
           PERFORM Form1-CLEAR
           PERFORM Form1-INIT-DATA
           MOVE Form1-MULKEY-TMPBUF TO
                     tmo-rec OF tmovmag
           PERFORM DataSet1-tmovmag-Read
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-CURR
           PERFORM Form1-IUD-Display
           .

       Form1-DUPLICATE-MOVEKEY.
           .

       Form1-First.
           PERFORM Form1-DUMMY-FIRST
           PERFORM DataSet1-tmovmag-INITSTART
           PERFORM DataSet1-tmovmag-START
           IF NOT Valid-STATUS-tmovmag
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeFirst>
      * <TOTEM:END>
           PERFORM DataSet1-tmovmag-Read-Next
           IF NOT Valid-STATUS-tmovmag
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterFirst>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY.
           PERFORM Form1-IUD-Display
           .

       Form1-Previous.
              PERFORM Form1-Buf-To-Fld
              PERFORM DataSet1-tmovmag-START-LESS
           IF NOT Valid-STATUS-tmovmag
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforePrevious>
      * <TOTEM:END>
           PERFORM DataSet1-tmovmag-Read-Prev
           IF NOT Valid-STATUS-tmovmag
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterPrevious>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-PREVIOUS
           PERFORM Form1-IUD-Display
           .

       Form1-Next.
              PERFORM Form1-Buf-To-Fld
              PERFORM DataSet1-tmovmag-START-GREATER
           IF NOT Valid-STATUS-tmovmag
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeNext>
      * <TOTEM:END>
           PERFORM DataSet1-tmovmag-Read-Next
           IF NOT Valid-STATUS-tmovmag
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterNext>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-NEXT
           PERFORM Form1-IUD-Display
           .
      
       Form1-Last.
           PERFORM Form1-DUMMY-LAST
           PERFORM DataSet1-tmovmag-INITEND
           PERFORM DataSet1-tmovmag-START-NOTGREATER
           IF NOT Valid-STATUS-tmovmag
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeLast>
      * <TOTEM:END>
           PERFORM DataSet1-tmovmag-Read-Prev
           IF NOT Valid-STATUS-tmovmag
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterLast>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY.
           PERFORM Form1-IUD-Display
           .

       Form1-Curr.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeCurrent>
      * <TOTEM:END>
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-tmovmag-Read
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-CURR
           PERFORM Form1-IUD-Display
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterCurrent>
      * <TOTEM:END>
           .

       Form1-IUD-Display.
           IF Valid-STATUS-tmovmag
              PERFORM Form1-ALLGRID-RESET
              PERFORM Form1-Fld-To-Buf
              PERFORM Form1-NAVI-FOR-MASTERGRID
              PERFORM Form1-DISPLAY
           ELSE
              IF Form1-FLAG-REFRESH
                 CONTINUE
              ELSE
                 PERFORM Form1-Extended-File-Status
              END-IF
           END-IF
           .

       Form1-Add.
           PERFORM Form1-Buf-To-Fld
           PERFORM Form1-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM Form1-DUMMY-ADD
           PERFORM DataSet1-tmovmag-INITREC
           PERFORM Form1-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeAdd>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-tmovmag-Rec-Write
           IF Valid-STATUS-tmovmag
              PERFORM Form1-RESUMMARY-INS
              PERFORM Form1-DUMMY-UPDATE-INIT
              MOVE "301" TO TOTEM-MSG-ID
              PERFORM Form1-IUD-Display
           END-IF
           PERFORM Form1-ERR-CHECKING
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterAdd>
      * <TOTEM:END>
           .
     
       Form1-Update.
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-tmovmag-START              
           IF NOT Valid-STATUS-tmovmag
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
           PERFORM DataSet1-tmovmag-Read
           PERFORM Form1-Buf-To-Fld
           PERFORM Form1-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM Form1-DUMMY-UPDATE
           PERFORM Form1-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeUpdate>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-tmovmag-Rec-Rewrite
           IF Valid-STATUS-tmovmag
              PERFORM Form1-RESUMMARY-DEL
              PERFORM Form1-DUMMY-UPDATE-INIT
              MOVE "302" TO TOTEM-MSG-ID
              PERFORM Form1-IUD-Display
           END-IF
           PERFORM Form1-ERR-CHECKING
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterUpdate>
      * <TOTEM:END>
           .

       Form1-Delete.
           MOVE "203" TO TOTEM-MSG-ID
           PERFORM MESSAGE-BOX-DISPLAY
           IF TOTEM-MSG-RETURN-VALUE NOT = 1
              INITIALIZE TOTEM-MSG-TEXT
              EXIT PARAGRAPH 
           END-IF
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDelete>
      * <TOTEM:END>
           PERFORM Form1-DUMMY-DELETE
      * delete
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-tmovmag-Rec-Delete
           IF Valid-STATUS-tmovmag
              PERFORM Form1-CLEAR
              PERFORM Form1-DUMMY-DELETE-INIT
              MOVE "303" TO TOTEM-MSG-ID
              MOVE "00" to STATUS-tmovmag
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterDelete>
      * <TOTEM:END>
           PERFORM Form1-ERR-CHECKING
           .

       Form1-NAVI-FOR-MASTERGRID.
           .

       Form1-ERR-CHECKING.
           IF Valid-STATUS-tmovmag
              PERFORM Form1-SHOW-MSG-ROUTINE
           ELSE
              PERFORM Form1-Extended-File-Status
           END-IF
           .

       Form1-RESUMMARY-INS.
           .

       Form1-RESUMMARY-DEL.
           .


       Form1-DUMMY-FIRST.
           .

       Form1-DUMMY-PREVIOUS.
           .

       Form1-DUMMY-NEXT.
           .

       Form1-DUMMY-LAST.
           .

       Form1-DUMMY-CURR.
           .

       Form1-DUMMY-ADD.
           .

       Form1-DUMMY-UPDATE.
           .

       Form1-DUMMY-UPDATE-INIT.
           .

       Form1-DUMMY-DELETE.
           .

       Form1-DUMMY-DELETE-INIT.
           .

       Form1-Init-Value.
           MOVE TITOLO TO TOTEM-MSG-TITLE
           INITIALIZE Form1-BUF
      * FORM : Form1
           PERFORM DataSet1-INIT-RECORD
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, SetDefault>
      * <TOTEM:END>
           PERFORM Form1-FLD-TO-BUF
           .


       Form1-ALLGRID-RESET.
           .

      * for Form's Validation
       Form1-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
      * ef-data's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-data-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5001 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-causale's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-causale-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5002 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-for's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-for-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5003 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-num's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-num-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5004 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-data-doc's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-data-doc-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5005 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-pag's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-pag-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5006 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-art-v's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-art-v-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 10 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-mag's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-mag-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 11 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-imb's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-imb-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 12 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-peso's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-peso-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 16 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-peso-utf's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-peso-utf-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 18 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-peso-non-utf's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-peso-non-utf-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 20 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-mp's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-mp-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 22 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
           .

       ef-data-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-data, BeforeValidation>
      * <TOTEM:END>
           .

       ef-data-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-data, AfterValidation>
      * <TOTEM:END>
           .

      * ef-data's Validation
       ef-data-VALIDATION.
           PERFORM ef-data-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-data-AFTER-VALIDATION
           .

       ef-causale-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-causale, BeforeValidation>
      * <TOTEM:END>
           .

       ef-causale-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-causale, AfterValidation>
      * <TOTEM:END>
           .

      * ef-causale's Validation
       ef-causale-VALIDATION.
           PERFORM ef-causale-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-causale-AFTER-VALIDATION
           .

       ef-for-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-for, BeforeValidation>
      * <TOTEM:END>
           .

       ef-for-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-for, AfterValidation>
      * <TOTEM:END>
           .

      * ef-for's Validation
       ef-for-VALIDATION.
           PERFORM ef-for-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-for-AFTER-VALIDATION
           .

       ef-num-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-num, BeforeValidation>
      * <TOTEM:END>
           .

       ef-num-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-num, AfterValidation>
      * <TOTEM:END>
           .

      * ef-num's Validation
       ef-num-VALIDATION.
           PERFORM ef-num-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-num-AFTER-VALIDATION
           .

       ef-data-doc-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-data-doc, BeforeValidation>
      * <TOTEM:END>
           .

       ef-data-doc-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-data-doc, AfterValidation>
      * <TOTEM:END>
           .

      * ef-data-doc's Validation
       ef-data-doc-VALIDATION.
           PERFORM ef-data-doc-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-data-doc-AFTER-VALIDATION
           .

       ef-pag-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-pag, BeforeValidation>
      * <TOTEM:END>
           .

       ef-pag-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-pag, AfterValidation>
      * <TOTEM:END>
           .

      * ef-pag's Validation
       ef-pag-VALIDATION.
           PERFORM ef-pag-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-pag-AFTER-VALIDATION
           .

       ef-art-v-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-art-v, BeforeValidation>
      * <TOTEM:END>
           .

       ef-art-v-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-art-v, AfterValidation>
      * <TOTEM:END>
           .

      * ef-art-v's Validation
       ef-art-v-VALIDATION.
           PERFORM ef-art-v-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-art-v-AFTER-VALIDATION
           .

       ef-mag-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-mag, BeforeValidation>
      * <TOTEM:END>
           .

       ef-mag-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-mag, AfterValidation>
      * <TOTEM:END>
           .

      * ef-mag's Validation
       ef-mag-VALIDATION.
           PERFORM ef-mag-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-mag-AFTER-VALIDATION
           .

       ef-imb-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-imb, BeforeValidation>
      * <TOTEM:END>
           .

       ef-imb-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-imb, AfterValidation>
      * <TOTEM:END>
           .

      * ef-imb's Validation
       ef-imb-VALIDATION.
           PERFORM ef-imb-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-imb-AFTER-VALIDATION
           .

       ef-peso-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-peso, BeforeValidation>
      * <TOTEM:END>
           .

       ef-peso-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-peso, AfterValidation>
      * <TOTEM:END>
           .

      * ef-peso's Validation
       ef-peso-VALIDATION.
           PERFORM ef-peso-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-peso-AFTER-VALIDATION
           .

       ef-peso-utf-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-peso-utf, BeforeValidation>
      * <TOTEM:END>
           .

       ef-peso-utf-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-peso-utf, AfterValidation>
      * <TOTEM:END>
           .

      * ef-peso-utf's Validation
       ef-peso-utf-VALIDATION.
           PERFORM ef-peso-utf-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-peso-utf-AFTER-VALIDATION
           .

       ef-peso-non-utf-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-peso-non-utf, BeforeValidation>
      * <TOTEM:END>
           .

       ef-peso-non-utf-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-peso-non-utf, AfterValidation>
      * <TOTEM:END>
           .

      * ef-peso-non-utf's Validation
       ef-peso-non-utf-VALIDATION.
           PERFORM ef-peso-non-utf-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-peso-non-utf-AFTER-VALIDATION
           .

       ef-mp-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-mp, BeforeValidation>
      * <TOTEM:END>
           .

       ef-mp-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-mp, AfterValidation>
      * <TOTEM:END>
           .

      * ef-mp's Validation
       ef-mp-VALIDATION.
           PERFORM ef-mp-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-mp-AFTER-VALIDATION
           .


       Form1-Buf-To-Fld.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeBufToFld>
      * <TOTEM:END>
      * DB_Entry-Field : ef-data
           MOVE ef-data-BUF TO tmo-data-movim
      * DB_Entry-Field : ef-causale
           MOVE ef-causale-BUF TO tmo-causale
      * DB_Entry-Field : ef-for
           MOVE ef-for-BUF TO tmo-cod-clifor
      * DB_Entry-Field : ef-num
           MOVE ef-num-BUF TO tmo-numdoc-clifor
      * DB_Entry-Field : ef-data-doc
           MOVE ef-data-doc-BUF TO tmo-data-doc
      * DB_Entry-Field : ef-pag
           MOVE ef-pag-BUF TO tmo-codpag
      * DB_Entry-Field : ef-art-v
           MOVE ef-art-v-BUF TO dis-articolo-finale
      * DB_Entry-Field : ef-mag
           MOVE ef-mag-BUF TO dis-magazzino-finale
      * DB_Entry-Field : ef-imb
           MOVE ef-imb-BUF TO dis-imballo-finale
      * DB_Entry-Field : ef-peso
           MOVE ef-peso-BUF TO dis-peso-finale
      * DB_Entry-Field : ef-peso-utf
           MOVE ef-peso-utf-BUF TO dis-peso-utf
      * DB_Entry-Field : ef-peso-non-utf
           MOVE ef-peso-non-utf-BUF TO dis-peso-non-utf
      * DB_Entry-Field : ef-mp
           MOVE ef-mp-BUF TO dis-prezzo
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterBufToFld>
      *
           move ef-oneri-buf    to como-oneri.

           move ef-data-buf     to como-data.
           perform DATE-TO-FILE.
           move como-data       to tmo-data-movim.

           move ef-data-doc-buf to como-data.
           perform DATE-TO-FILE.
           move como-data       to tmo-data-doc.
      *
           move ef-for-buf      to tmo-cod-clifor convert.

           move tge-anno        to tmo-anno.
           move num-movim-testa to tmo-numero.

           move tdc-caus-carico to tmo-causale.

           set tmo-fornitore to true.
           move 0 to tmo-destino.
           move ef-qta-buf   to como-qta.
           compute tmo-peso-utf = dis-peso-utf * como-qta.
           move tmo-peso-utf to tot-peso-utf-t SavePesoT.

           move spaces to tmo-gdo.

           move 0 to tmo-anno-fattura.

           set tmo-attivo  to   true.
           accept como-ora from time.
           move data-oggi  to tmo-data-creazione.
           move como-ora   to tmo-ora-creazione.
           move user-codi  to tmo-utente-creazione.

           write tmo-rec invalid continue end-write.
           move tmo-chiave to SaveKeyT.
           
           initialize rmo-rec replacing numeric data by zeroes
                                   alphanumeric data by spaces.

           move tmo-anno              to rmo-anno.
           move tmo-numero            to rmo-movim.
           move 1                     to rmo-riga.
           set  rmo-fornitore         to true.
           move tmo-cod-clifor        to rmo-cod-clifor.
           move tdc-caus-carico       to rmo-causale.
           move tmo-data-movim        to rmo-data-movim.
           move ef-art-buf            to art-codice.
           read articoli no lock invalid continue end-read.
           move art-codice            to rmo-articolo.
           move dis-magazzino-finale  to rmo-codmag.
           move dis-imballo-finale    to rmo-imballo.
           move dis-peso-finale       to rmo-peso.
           move art-unita-di-misura   to rmo-udm.
           move ef-qta-buf            to rmo-qta.
           add  art-peso-utf to art-peso-non-utf giving rmo-peso-udm.

           add  dis-prezzo   to como-oneri       giving rmo-listino.
           move rmo-listino  to rmo-netto.
           move art-marca-prodotto    to rmo-marca-prodotto.
                                                                     
           compute rmo-peso-tot-utf = dis-peso-utf     * rmo-qta.
           compute rmo-peso-tot     = dis-peso-non-utf * rmo-qta.

           set    rmo-attivo          to true.
           move   user-codi           to rmo-utente-creazione.
           accept rmo-data-creazione  from century-date.
           accept rmo-ora-creazione   from time.
           write  rmo-rec invalid continue end-write.
      
           perform CALL-WPROGMAG.

           .
      * <TOTEM:END>
           .

       Form1-Fld-To-Buf.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeFldToBuf>
      * <TOTEM:END>
      * DB_Entry-Field : ef-data
           MOVE tmo-data-movim TO ef-data-BUF
      * DB_Entry-Field : ef-causale
           MOVE tmo-causale TO ef-causale-BUF
      * DB_Entry-Field : ef-for
           MOVE tmo-cod-clifor TO ef-for-BUF
      * DB_Entry-Field : ef-num
           MOVE tmo-numdoc-clifor TO ef-num-BUF
      * DB_Entry-Field : ef-data-doc
           MOVE tmo-data-doc TO ef-data-doc-BUF
      * DB_Entry-Field : ef-pag
           MOVE tmo-codpag TO ef-pag-BUF
      * DB_LABEL : lab-causale
              MOVE tdc-descrizione  TO lab-causale-BUF
      * DB_LABEL : lab-for
              MOVE cli-ragsoc-1  TO lab-for-BUF
      * DB_LABEL : lab-carico
              MOVE tdc-caus-carico  TO lab-carico-BUF
      * DB_LABEL : lab-scarico
              MOVE tdc-caus-scarico  TO lab-scarico-BUF
      * DB_Entry-Field : ef-art-v
           MOVE dis-articolo-finale TO ef-art-v-BUF
      * DB_Entry-Field : ef-mag
           MOVE dis-magazzino-finale TO ef-mag-BUF
      * DB_Entry-Field : ef-imb
           MOVE dis-imballo-finale TO ef-imb-BUF
      * DB_Entry-Field : ef-peso
           MOVE dis-peso-finale TO ef-peso-BUF
      * DB_Entry-Field : ef-peso-utf
           MOVE dis-peso-utf TO ef-peso-utf-BUF
      * DB_Entry-Field : ef-peso-non-utf
           MOVE dis-peso-non-utf TO ef-peso-non-utf-BUF
      * DB_Entry-Field : ef-mp
           MOVE dis-prezzo TO ef-mp-BUF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterFldToBuf>
           move tmo-cod-clifor to  codice-ed.
           move codice-ed      to  ef-for-buf.   
           call "C$JUSTIFY" using ef-for-buf, "L".
           display ef-for.

           .
      * <TOTEM:END>
           .

       Form1-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform Form1-BUF-TO-FLD.
           move 0 to scelta.
           .
       Form1-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM Form1-SHOW-MSG-ROUTINE
           .

       Form1-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM Form1-DISPLAY-MESSAGE
           .

       Form1-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       Form1-Save-Status.
           MOVE DataSet1-tmovmag-KEY1-ORDER TO TMP-Form1-KEY1-ORDER
           MOVE DataSet1-KEYIS TO TMP-Form1-KEYIS
           MOVE tmo-rec OF tmovmag TO 
              TMP-Form1-tmovmag-RESTOREBUF
           .             

       Form1-Restore-Status.
           MOVE TMP-Form1-KEY1-ORDER TO DataSet1-tmovmag-KEY1-ORDER
           MOVE TMP-Form1-KEYIS TO DataSet1-KEYIS
           MOVE TMP-Form1-tmovmag-RESTOREBUF TO
              tmo-rec OF tmovmag
           PERFORM DataSet1-tmovmag-START
           IF Valid-STATUS-tmovmag
              PERFORM DataSet1-tmovmag-Read-Next
           ELSE
              PERFORM DataSet1-tmovmag-INITREC
           END-IF
           PERFORM UNTIL NOT Valid-STATUS-tmovmag OR
              (Valid-STATUS-tmovmag AND
                 tmo-rec OF tmovmag = 
                   TMP-Form1-tmovmag-RESTOREBUF)
              PERFORM DataSet1-tmovmag-Read-Next
           END-PERFORM
           .


      * Paragrafo per la struttura del codice in BEFORE sulla screen Form1
      ***---
       Form1-BEFORE-SCREEN.
           evaluate control-id
           |78-ID-ef-causale è l'ID del campo ef-causale
           when 78-ID-ef-causale
                move 1 to StatusHelp
                perform STATUS-HELP
           |78-ID-ef-for è l'ID del campo ef-for
           when 78-ID-ef-for
                move 1 to StatusHelp
                perform STATUS-HELP
           |78-ID-ef-pag è l'ID del campo ef-pag
           when 78-ID-ef-pag
                move 1 to StatusHelp
                perform STATUS-HELP
           |78-ID-ef-art è l'ID del campo ef-art
           when 78-ID-ef-art
                move 1 to StatusHelp
                perform STATUS-HELP
           |78-ID-ef-qta è l'ID del campo ef-qta
           when 78-ID-ef-qta
                move 1 to StatusHelp
                perform STATUS-HELP
           |10 è l'ID del campo ef-art-v
           when 10
                move 1 to StatusHelp
                perform STATUS-HELP
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella BEFORE della screen
           when 99999 continue
           when other continue
           end-evaluate.

      * Generazione settaggio keyboard "." ---> ","

      * Paragrafo per la struttura del codice in AFTER sulla screen Form1
      ***---
       Form1-AFTER-SCREEN.
           evaluate control-id
           |78-ID-ef-causale è l'ID del campo ef-causale
           when 78-ID-ef-causale
                move 0 to StatusHelp
                perform STATUS-HELP

           |78-ID-ef-for è l'ID del campo ef-for
           when 78-ID-ef-for
                move 0 to StatusHelp
                perform STATUS-HELP

           |78-ID-ef-pag è l'ID del campo ef-pag
           when 78-ID-ef-pag
                move 0 to StatusHelp
                perform STATUS-HELP

           |78-ID-ef-art è l'ID del campo ef-art
           when 78-ID-ef-art
                move 0 to StatusHelp
                perform STATUS-HELP

           |78-ID-ef-qta è l'ID del campo ef-qta
           when 78-ID-ef-qta
                move 0 to StatusHelp
                perform STATUS-HELP

           |10 è l'ID del campo ef-art-v
           when 10
                move 0 to StatusHelp
                perform STATUS-HELP

           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER della screen
           when 99999 continue
           when other continue
           end-evaluate.

      * Generazione risettaggio keyboard "." ---> "."

      * Generazione stringa perform CONTROLLO
           evaluate control-id
           |78-ID-ef-data è l'ID del campo ef-data
           when 78-ID-ef-data
                perform CONTROLLO
           |78-ID-ef-causale è l'ID del campo ef-causale
           when 78-ID-ef-causale
                perform CONTROLLO
           |78-ID-ef-for è l'ID del campo ef-for
           when 78-ID-ef-for
                perform CONTROLLO
           |78-ID-ef-num è l'ID del campo ef-num
           when 78-ID-ef-num
                perform CONTROLLO
           |78-ID-ef-data-doc è l'ID del campo ef-data-doc
           when 78-ID-ef-data-doc
                perform CONTROLLO
           |78-ID-ef-pag è l'ID del campo ef-pag
           when 78-ID-ef-pag
                perform CONTROLLO
           |78-ID-ef-art è l'ID del campo ef-art
           when 78-ID-ef-art
                perform CONTROLLO
           |78-ID-ef-qta è l'ID del campo ef-qta
           when 78-ID-ef-qta
                perform CONTROLLO
           |10 è l'ID del campo ef-art-v
           when 10
                perform CONTROLLO
           |11 è l'ID del campo ef-mag
           when 11
                perform CONTROLLO
           |12 è l'ID del campo ef-imb
           when 12
                perform CONTROLLO
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER CONTROLLO della screen
           when 99999 continue
           when other continue
           end-evaluate.

       form-num-Open-Routine.
           PERFORM form-num-Scrn
           PERFORM form-num-Proc
           .

       form-num-Scrn.
           PERFORM form-num-Create-Win
           PERFORM form-num-Init-Value
           PERFORM form-num-Init-Data
      * Tab keystrok settings
      * Tool Bar
           PERFORM form-num-DISPLAY
           .

       form-num-Create-Win.
           Display Floating GRAPHICAL WINDOW
              LINES 22,60,
              SIZE 59,10,
              CELL HEIGHT 10,
              CELL WIDTH 10,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 65793,
              ERASE,
              CONTROL FONT Verdana12-Occidentale,
              LABEL-OFFSET 0,
              LINK TO THREAD,
              RESIZABLE,
              NO SCROLL,
              TITLE-BAR,
              TITLE "Rapporto registrazione movimenti",
              WITH SYSTEM MENU,
              USER-GRAY,
              USER-WHITE,
              No WRAP,
              HANDLE IS form-num-SF-HANDLE,
      * <TOTEM:EPT. FORM:form-num, FORM:form-num, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
      * Status-bar
           DISPLAY form-num UPON form-num-SF-HANDLE
      * DISPLAY-COLUMNS settings
           .

       form-num-PROC.
      * <TOTEM:EPT. FORM:form-num, FORM:form-num, BeforeAccept>
           move tot-peso-utf-t  to peso-utf-carico-edit.
           move tot-peso-utf-r  to peso-utf-scarico-edit.
           move num-movim-testa to num-carico-edit.
           move num-movim-righe to num-scarico-edit.
           display form-num.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT form-num
                 ON EXCEPTION
                    PERFORM form-num-Evaluate-Func
                 MOVE 2 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:form-num, FORM:form-num, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:form-num, FORM:form-num, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY form-num-SF-HANDLE
           INITIALIZE Key-Status
           .

       form-num-Evaluate-Func.
      * <TOTEM:EPT. FORM:form-num, FORM:form-num, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM form-num-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM form-num-Exit
                 END-IF
              WHEN Key-Status = 13
                 PERFORM pb-fatto-LinkTo
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       form-num-CLEAR.
           PERFORM form-num-INIT-VALUE
           PERFORM form-num-DISPLAY
           .

       form-num-DISPLAY.
      * <TOTEM:EPT. FORM:form-num, FORM:form-num, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY form-num UPON form-num-SF-HANDLE
      * <TOTEM:EPT. FORM:form-num, FORM:form-num, AfterDisplay>
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       form-num-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:form-num, FORM:form-num, BeforeExit>
           inquire ef-peso-carico,  value in tot-peso-utf-t.
           inquire ef-peso-scarico, value in tot-peso-utf-r.

           .
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       form-num-Init-Data.
           MOVE 2 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
           .

       form-num-Init-Value.
      * <TOTEM:EPT. FORM:form-num, FORM:form-num, SetDefault>
      * <TOTEM:END>
           PERFORM form-num-FLD-TO-BUF
           .


       form-num-ALLGRID-RESET.
           .

      * for Form's Validation
       form-num-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       form-num-Buf-To-Fld.
      * <TOTEM:EPT. FORM:form-num, FORM:form-num, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:form-num, FORM:form-num, AfterBufToFld>
      * <TOTEM:END>
           .

       form-num-Fld-To-Buf.
      * <TOTEM:EPT. FORM:form-num, FORM:form-num, BeforeFldToBuf>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:form-num, FORM:form-num, AfterFldToBuf>
      * <TOTEM:END>
           .

       form-num-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform form-num-BUF-TO-FLD.
           move 0 to scelta.
           .
       form-num-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM form-num-SHOW-MSG-ROUTINE
           .

       form-num-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM form-num-DISPLAY-MESSAGE
           .

       form-num-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       form-num-Save-Status.
           .             

       form-num-Restore-Status.
           .


      * Paragrafo per la struttura del codice in BEFORE sulla screen form-num
      ***---
       form-num-BEFORE-SCREEN.
           evaluate control-id
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella BEFORE della screen
           when 99999 continue
           when other continue
           end-evaluate.

      * Generazione settaggio keyboard "." ---> ","
           evaluate control-id
           |78-ID-ef-peso-carico è l'ID del campo ef-peso-carico
           when 78-ID-ef-peso-carico
                if  KeyboardReleased
                   set KeyboardSaved to true
      *            sostituisco il punto come virgola
                   set environment "KEYSTROKE" to "DATA=44 46"
                end-if
           |78-ID-ef-peso-scarico è l'ID del campo ef-peso-scarico
           when 78-ID-ef-peso-scarico
                if  KeyboardReleased
                   set KeyboardSaved to true
      *            sostituisco il punto come virgola
                   set environment "KEYSTROKE" to "DATA=44 46"
                end-if
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella BEFORE della screen
           when 99999 continue
           when other continue
           end-evaluate.

      * Paragrafo per la struttura del codice in AFTER sulla screen form-num
      ***---
       form-num-AFTER-SCREEN.
           evaluate control-id
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER della screen
           when 99999 continue
           when other continue
           end-evaluate.

      * Generazione risettaggio keyboard "." ---> "."
           evaluate control-id
           |78-ID-ef-peso-carico è l'ID del campo ef-peso-carico
           when 78-ID-ef-peso-carico
                if  KeyboardSaved
                   set KeyboardReleased to true
      *            setto la tastiera originale (PUNTO come PUNTO, VIROGLA come VIRGOLA)
                   set environment "KEYSTROKE" to "DATA=44   44"
                   set environment "KEYSTROKE" to "DATA=46   46"
                end-if

           |78-ID-ef-peso-scarico è l'ID del campo ef-peso-scarico
           when 78-ID-ef-peso-scarico
                if  KeyboardSaved
                   set KeyboardReleased to true
      *            setto la tastiera originale (PUNTO come PUNTO, VIROGLA come VIRGOLA)
                   set environment "KEYSTROKE" to "DATA=44   44"
                   set environment "KEYSTROKE" to "DATA=46   46"
                end-if

           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella BEFORE della screen
           when 99999 continue
           when other continue
           end-evaluate.

      * Generazione stringa perform CONTROLLO
           evaluate control-id
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER CONTROLLO della screen
           when 99999 continue
           when other continue
           end-evaluate.



       Form1-BeforeProcedure.
           EVALUATE Control-Id
           WHEN 5001 MOVE "Digitare la data di movimento" to 
           TOTEM-HINT-TEXT
           WHEN 5002 MOVE "Digitare la causale di magazzino" to 
           TOTEM-HINT-TEXT
           WHEN 5003 MOVE "Digitare il codice del fornitore - cliente" 
           to TOTEM-HINT-TEXT
           WHEN 5004 MOVE "Digitare il numero del documento" to 
           TOTEM-HINT-TEXT
           WHEN 5005 MOVE "Digitare la data del documento" to 
           TOTEM-HINT-TEXT
           WHEN 5006 MOVE "Digitare il codice di pagamento" to 
           TOTEM-HINT-TEXT
           WHEN 5007 MOVE "Digitare il codice articolo della distinta (B
      -    "lank = Vedi Tutto)" to TOTEM-HINT-TEXT
           WHEN 5008 MOVE "Digitare la quantità" to TOTEM-HINT-TEXT
           WHEN 9 MOVE totem-hint-text to TOTEM-HINT-TEXT
           WHEN 10 MOVE "Digitare il codice dell'articolo" to 
           TOTEM-HINT-TEXT
           WHEN 11 MOVE "Codice Magazzino" to TOTEM-HINT-TEXT
           WHEN 12 MOVE "Codice Imballaggio" to TOTEM-HINT-TEXT
           WHEN 16 MOVE "Valore Peso" to TOTEM-HINT-TEXT
           WHEN 18 MOVE "Valore Peso UTF" to TOTEM-HINT-TEXT
           WHEN 20 MOVE "Valore Peso non UTF" to TOTEM-HINT-TEXT
           WHEN 22 MOVE "Somma Prezzo MP dei componenti" to 
           TOTEM-HINT-TEXT
           WHEN 26 MOVE "Somma Oneri Accessori dei componenti" to 
           TOTEM-HINT-TEXT
           WHEN OTHER MOVE SPACES TO TOTEM-HINT-TEXT
           END-EVALUATE
           EVALUATE Control-Id
           When 5001 PERFORM ef-data-BeforeProcedure
           When 5002 PERFORM ef-causale-BeforeProcedure
           When 5003 PERFORM ef-for-BeforeProcedure
           When 5004 PERFORM ef-num-BeforeProcedure
           When 5005 PERFORM ef-data-doc-BeforeProcedure
           When 5006 PERFORM ef-pag-BeforeProcedure
           When 5007 PERFORM ef-art-BeforeProcedure
           When 5008 PERFORM ef-qta-BeforeProcedure
           When 9 PERFORM form1-Gd-1-BeforeProcedure
           When 10 PERFORM ef-art-BeforeProcedure
           When 11 PERFORM ef-mag-BeforeProcedure
           When 12 PERFORM ef-imb-BeforeProcedure
           When 16 PERFORM ef-peso-BeforeProcedure
           When 18 PERFORM ef-peso-utf-BeforeProcedure
           When 20 PERFORM ef-peso-non-utf-BeforeProcedure
           When 22 PERFORM ef-mp-BeforeProcedure
           When 26 PERFORM Screen1-Ef-1-BeforeProcedure
           END-EVALUATE
           PERFORM Form1-DISPLAY-STATUS-MSG
           perform Form1-BEFORE-SCREEN
           .

       Form1-AfterProcedure.
           EVALUATE Control-Id
           When 5001 PERFORM ef-data-AfterProcedure
           When 5002 PERFORM ef-causale-AfterProcedure
           When 5003 PERFORM ef-for-AfterProcedure
           When 5004 PERFORM ef-num-AfterProcedure
           When 5005 PERFORM ef-data-doc-AfterProcedure
           When 5006 PERFORM ef-pag-AfterProcedure
           When 10 PERFORM ef-art-AfterProcedure
           When 11 PERFORM ef-mag-AfterProcedure
           When 12 PERFORM ef-imb-AfterProcedure
           When 16 PERFORM ef-peso-AfterProcedure
           When 18 PERFORM ef-peso-utf-AfterProcedure
           When 20 PERFORM ef-peso-non-utf-AfterProcedure
           When 22 PERFORM ef-mp-AfterProcedure
           END-EVALUATE
           perform Form1-AFTER-SCREEN
           .

       form-num-BeforeProcedure.
           EVALUATE Control-Id
           WHEN 5001 MOVE "." to TOTEM-HINT-TEXT
           WHEN 5002 MOVE "." to TOTEM-HINT-TEXT
           WHEN OTHER MOVE SPACES TO TOTEM-HINT-TEXT
           END-EVALUATE
           EVALUATE Control-Id
           When 5001 PERFORM ef-peso-carico-BeforeProcedure
           When 5002 PERFORM ef-peso-carico-BeforeProcedure
           END-EVALUATE
           perform form-num-BEFORE-SCREEN
           .

       Form1-Event-Proc.
           .

       Screen1-Gd-1-Event-Proc.
           EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
           WHEN Msg-Begin-Drag ALSO 9 ALSO
                    Form1-Handle 
              PERFORM form1-Gd-1-Ev-Msg-Begin-Drag
           WHEN Msg-Begin-Entry ALSO 9 ALSO
                    Form1-Handle 
              PERFORM form1-Gd-1-Ev-Msg-Begin-Entry
           WHEN Msg-Cancel-Entry ALSO 9 ALSO
                    Form1-Handle 
              PERFORM form1-Gd-1-Ev-Msg-Cancel-Entry
           WHEN Msg-End-Drag ALSO 9 ALSO
                    Form1-Handle 
              PERFORM form1-Gd-1-Ev-Msg-End-Drag
           WHEN Msg-Finish-Entry ALSO 9 ALSO
                    Form1-Handle 
              PERFORM form1-Gd-1-Ev-Msg-Finish-Entry
           WHEN Msg-Goto-Cell ALSO 9 ALSO
                    Form1-Handle 
              PERFORM form1-Gd-1-Ev-Msg-Goto-Cell
           WHEN Msg-Goto-Cell-Drag ALSO 9 ALSO
                    Form1-Handle 
              PERFORM form1-Gd-1-Ev-Msg-Goto-Cell-Drag
           WHEN Msg-Goto-Cell-Mouse ALSO 9 ALSO
                    Form1-Handle 
              PERFORM form1-Gd-1-Ev-Msg-Goto-Cell-Mouse
           END-EVALUATE
           .

      * USER DEFINE PARAGRAPH
       ABILITAZIONI.
      * <TOTEM:PARA. ABILITAZIONI>
           modify tool-modifica,   value 1.             
           move BitmapNewDisabled     to BitmapNumNew.
           move BitmapDeleteDisabled  to BitmapNumDelete.
           move BitmapEditDisabled    to BitmapNumEdit.
           move BitmapPrintDisabled   to BitmapNumPrint.
           move BitmapPreviewDisabled to BitmapNumPreview.
           move BitmapSelectDisabled  to BitmapNumSelect.
           move BitmapSaveEnabled     to BitmapNumSave.
           move 1 to e-salva.
           move 0 to e-cancella 
                     e-anteprima 
                     e-stampa 
                     e-nuovo
                     e-seleziona
                     e-modifica.
                           

           if mod = 1
              move 1 to mod-campi
              move 0 to mod-k
           else
              move 1 to mod-k
              move 0 to mod-campi
           end-if.
           perform DISPLAY-SCREEN.
                                                      
           modify tool-nuovo,     enabled = e-nuovo,
                                  bitmap-number = BitmapNumNew.
           modify tool-cancella,  enabled = e-cancella,
                                  bitmap-number = BitmapNumDelete.
           modify tool-modifica,  enabled = e-modifica,
                                  bitmap-number = BitmapNumEdit.
           modify tool-anteprima, enabled = e-anteprima,
                                  bitmap-number = BitmapNumPreview.
           modify tool-stampa,    enabled = e-stampa,
                                  bitmap-number = BitmapNumPrint.
           modify tool-seleziona, enabled = e-seleziona,
                                  bitmap-number = BitmapNumSelect.
           modify tool-salva,     enabled = e-salva,
                                  bitmap-number = BitmapNumSave 
           .
      * <TOTEM:END>

       ANTEPRIMA.
      * <TOTEM:PARA. ANTEPRIMA>
           SET ANTEPRIMA     TO TRUE 
           .
      * <TOTEM:END>

       CALL-WPROGMAG.
      * <TOTEM:PARA. CALL-WPROGMAG>
           initialize link-wprogmag.
           set link-update-um     to true.
           set link-update-peso   to false.
           set link-update-valore to false.
           move "0000000000000000"    to link-array.
           move 1                     to multiplyer(1).
           move 1                     to multiplyer(3).
           move 1                     to multiplyer(15).
           move 1                     to multiplyer(16).
           set  link-update           to true.
           move rmo-chiave-progmag    to link-key.
           move rmo-causale           to link-causale.
           move rmo-qta               to link-valore.
           compute link-valore-costo =
                   rmo-netto         +
                   rmo-coubat        +
                   rmo-imp-cons.

LUBEXX     if link-valore-costo = 0 or
LUBEXX        rmo-qta           = 0
LUBEXX        move 0 to multiplyer(16)
LUBEXX     end-if.

           move user-codi             to link-user of link-wprogmag.
           call   "wprogmag" using link-wprogmag.
           cancel "wprogmag" 
           .
      * <TOTEM:END>

       CARICA-DISTINTA.
      * <TOTEM:PARA. CARICA-DISTINTA>
           perform RESETTA-GRID.

           move 1 to idx.
           move 1 to riga.
           move 0 to como-oneri
                     somma-oneri 
                     somma-utf 
                     somma-non-utf 
                     somma-prezzo.

           modify form1-gd-1, mass-update = 1.
           perform varying idx from 1 by 1
                     until idx > 10
              add 1 to riga
              initialize rec-grid replacing numeric data by zeroes
                                       alphanumeric data by spaces
              if dis-articolo(idx) = 0 exit perform end-if
              move dis-articolo(idx)   to   col-art art-codice
              move dis-magazzino(idx)  to   col-mag
              move dis-peso(idx)       to   col-peso
              move dis-imballo(idx)    to   col-imb
              move dis-qta(idx)        to   col-qta
              move dis-oneri(idx)      to   col-oneri
              perform DESCRIZIONE-ARTICOLO
              move descr-articolo      to col-des
              move art-marca-prodotto  to hid-marca-prodotto
              add  art-peso-utf        to art-peso-non-utf 
                                   giving hid-peso-udm
              move art-unita-di-misura to hid-art-um
              move dis-chiave-progmag-el(idx) to prg-chiave
              read progmag  no lock invalid continue end-read
              move prg-peso-utf     to col-utf
              move prg-peso-non-utf to col-non-utf
              move prg-giacenza     to col-giacenza
              move spaces           to prg-cod-magazzino
              move spaces           to prg-tipo-imballo
              move 0                to prg-peso
              read progmag no lock invalid continue end-read
              perform CALCOLA-COSTO-MP

              accept imp-data from century-date
              start timposte key <= imp-chiave
                    invalid continue
                not invalid
                    read timposte previous
              end-start

              perform CALCOLA-COSTO-MP-WHEN-ZERO
              move costo-mp         to col-mp
              modify form1-gd-1(riga, 2),  cell-data = col-art
              modify form1-gd-1(riga, 3),  cell-data = col-mag
              modify form1-gd-1(riga, 4),  cell-data = col-imb
              modify form1-gd-1(riga, 5),  cell-data = col-peso
              modify form1-gd-1(riga, 6),  cell-data = col-des 
              modify form1-gd-1(riga, 7),  cell-data = col-utf
              modify form1-gd-1(riga, 8),  cell-data = col-non-utf
              modify form1-gd-1(riga, 9),  cell-data = col-mp
              modify form1-gd-1(riga, 10), cell-data = col-qta
              modify form1-gd-1(riga, 11), cell-data = col-oneri
              modify form1-gd-1(riga, 12), cell-data = col-giacenza
              modify form1-gd-1(riga, 1) hidden-data = hid-dati-articolo

              move col-qta       to como-qta

              move como-qta      to qta-arrotondata
              move como-qta(9:3) to decimali
              if decimali > 500
                 add 1 to qta-arrotondata
              end-if
              
              move col-utf       to como-utf
LUBEXX        compute somma-utf = somma-utf +
LUBEXX                ( qta-arrotondata * como-utf )
              
              move col-non-utf   to como-non-utf
LUBEXX        compute somma-non-utf = somma-non-utf +
LUBEXX               ( qta-arrotondata * como-non-utf )

              move col-mp        to como-prezzo
LUBEXX        compute somma-prezzo = somma-prezzo +
LUBEXX                  ( qta-arrotondata *  como-prezzo )  

              move col-oneri     to col-oneri-num
LUBEXX        compute somma-oneri = somma-oneri +
LUBEXX                ( col-oneri-num * qta-arrotondata )

              compute como-oneri = 
                    ( qta-arrotondata * col-oneri-num ) + como-oneri
           end-perform.
           move somma-oneri    to ef-tot-oneri-buf.
           move somma-utf      to ef-tot-utf-buf.
           move somma-non-utf  to ef-tot-non-utf-buf.
           move somma-prezzo   to ef-tot-prezzo-buf.
           move como-oneri     to ef-oneri-buf.
           modify form1-gd-1, mass-update = 0.

           move dis-articolo-finale to art-codice ef-art-v-buf 
                                       ArticoloInUso.
           perform DESCRIZIONE-ARTICOLO.
           move descr-articolo to lab-des-buf.
           display ef-art-v lab-des.

           move dis-magazzino-finale to ef-mag-buf.
           move dis-imballo-finale   to ef-imb-buf.
           move dis-peso-finale      to ef-peso-buf.
           move dis-peso-utf         to ef-peso-utf-buf.
           move dis-peso-non-utf     to ef-peso-non-utf-buf.
LUBEXX*****           move dis-prezzo           to ef-mp-buf.
LUBEXX     move somma-prezzo         to ef-mp-buf.

           perform DISPLAY-SCREEN 
           .
      * <TOTEM:END>

       CERCA.
      * <TOTEM:PARA. CERCA>
           evaluate control-id

           when 78-ID-ef-causale
                move "tcaudisb"     to como-file
                inquire ef-causale, value in tdc-codice
                call "zoom-gt"   using como-file, tdc-rec
                                giving stato-zoom
                end-call
                cancel "zoom-gt"
                if stato-zoom = 0
                   move tdc-codice       to ef-causale-buf
                   move tdc-descrizione  to lab-causale-buf
                   move tdc-caus-carico  to lab-carico-buf
                   move tdc-caus-scarico to lab-scarico-buf   
                   display ef-causale 
                           lab-causale 
                           lab-carico 
                           lab-scarico
                end-if

           when 78-ID-ef-for
                set  cli-tipo-F     to true
                move "clienti-CF-all"   to como-file         
                inquire ef-for,  value cli-codice
                call "zoom-gt"   using como-file, cli-rec
                                giving stato-zoom
                end-call
                cancel "zoom-gt"
                if stato-zoom = 0
                   move cli-codice    to ef-for-buf
                   inspect ef-for-buf replacing 
                                        leading x"30" by x"20"
                   call "C$JUSTIFY"       using ef-for-buf, "L"
                   move cli-ragsoc-1         to lab-for-buf
                   display ef-for lab-for
                end-if        
 
           when 78-ID-ef-pag
                move "tcodpag"   to como-file
                move "PA"        to tblpa-codice1
                inquire ef-pag,  value in tblpa-codice2
                call "zoom-gt"   using como-file, record-tblpa
                                giving stato-zoom
                end-call
                cancel "zoom-gt"
                if stato-zoom = 0
                   move tblpa-codice2 to ef-pag-buf
                   initialize lab-pag-buf
                   inspect tblpa-descrizione1 replacing trailing 
                                                 spaces by low-value
                   string  tblpa-descrizione1 delimited by low-value
                           " "                delimited by size
                           tblpa-descrizione2 delimited by size
                           into lab-pag-buf
                   end-string
                   display ef-pag lab-pag
                end-if

           when 78-ID-ef-art
                inquire ef-art, value in ef-art-buf
                move ef-art-buf to como-articolo
                if como-articolo = 0
                   move 0 to art-codice
                   move "articoli"   to como-file
                   call "zoom-gt" using como-file, art-rec
                                 giving stato-zoom
                   end-call
                   cancel "zoom-gt"
                   if stato-zoom = 0
                      move art-codice to como-articolo
                   end-if
                end-if
                if como-articolo not = 0
                   perform RIEMPI-TMP-DISTINTEB
                   move path-zoom-distinteb to ext-file

                   move   "zoom-distinteb" to como-file
                   call   "zoom-gt"     using como-file, zoom-dis-rec
                                       giving stato-zoom
                   cancel "zoom-gt"
                   move zoom-dis-chiave to dis-chiave
                   read distinteb no lock
                   if stato-zoom = 0
                      move dis-articolo-finale to ef-art-buf
                      move 0                   to ef-qta-buf
                      perform CARICA-DISTINTA
                      display ef-art ef-qta
                   end-if
                   delete file zoom-distinteb
                end-if

           end-evaluate   
           .
      * <TOTEM:END>

       CLEAR-SCREEN.
      * <TOTEM:PARA. CLEAR-SCREEN>
           initialize tmo-rec 
                      tdc-rec 
                      dis-rec replacing numeric data by zeroes
                                   alphanumeric data by spaces.
                        
           perform FORM1-FLD-TO-BUF. 
      
           move spaces to lab-causale-buf 
                          lab-for-buf 
                          lab-pag-buf
                          lab-des-buf.

           move      0 to ef-art-buf ef-qta-buf ef-oneri-buf
                          ef-tot-utf-buf ef-tot-non-utf-buf
                          ef-tot-prezzo-buf ef-tot-oneri-buf.

           perform RESETTA-GRID.
      
           perform DISPLAY-SCREEN 
           .
      * <TOTEM:END>

       CONTA-ARTICOLI.
      * <TOTEM:PARA. CONTA-ARTICOLI>
           move 0          to num-articoli.
           move 0          to dis-codice.
           move art-codice to dis-articolo-finale.

           start distinteb key is >= k-articolo
                 invalid continue
             not invalid
                 perform until 1 = 2
                    read distinteb next at end exit perform end-read
                    if dis-articolo-finale not = art-codice
                       exit perform
                    end-if
                    add 1 to num-articoli
                    evaluate true
                    when num-articoli = 1
                         move dis-codice to save-codice
                    when num-articoli > 1
                         exit perform
                    end-evaluate
                 end-perform
           end-start 
           .
      * <TOTEM:END>

       CONTROLLO.
      * <TOTEM:PARA. CONTROLLO>
           set tutto-ok to true. 
           if mod = 0 exit paragraph end-if.
      **
      * Elenco degli Id sui quali fare il CONTROLLO nel programma gclienti
      * paragrafo per la struttura dei controlli sulla screen Form1
           evaluate control-id
           when 78-ID-ef-data
                inquire ef-data, value in como-data
                if como-data = 0
                   move data-oggi to como-data
                   perform DATE-TO-SCREEN
                   move como-data to ef-data-buf
                else
                   move ef-data-buf to como-data
                   perform DATE-FORMAT
                   move como-data to ef-data-buf
                end-if
                display ef-data
                inquire ef-data, value in ef-data-buf
                move ef-data-buf to como-data
                if como-data(5:4) not = tge-anno
                   display message box 
                           "L'anno inserito non corrisponde a quello "
                           "indicato nei parametri generali."
                    x"0d0a""Valore anno: ", tge-anno
                           title tit-err
                           icon  2
                    set errori to true
                    move 78-ID-ef-data to control-id
                else
                   perform DATE-TO-FILE
                   if como-data <= tge-data-consolid-progmag
                      move tge-data-consolid-progmag to como-data
                      perform DATE-TO-SCREEN
                      display message box 
                             "Data inferiore a quella di consolidamento"
                      x"0d0a""Data di consolidamento: "
                              como-data(1:2)
                              "/"
                              como-data(3:2)
                              "/"
                              como-data(5:4)
                              title tit-err
                              icon  2
                       set errori to true
                       move 78-ID-ef-data to control-id
                   end-if
                end-if
                display ef-data
      *
           when 78-ID-ef-causale
                inquire ef-causale value in tdc-codice
                move spaces to lab-causale-buf 
                               lab-carico-buf 
                               lab-scarico-buf
                if tdc-codice not = spaces
                   read tcaudisb
                        invalid
                        set errori to true
                        display message "Codice causale NON valido"
                                title = tit-err
                                icon mb-warning-icon
                        move 78-ID-ef-causale     to control-id
                    not invalid
                        move tdc-descrizione   to lab-causale-buf
                        move tdc-caus-carico   to lab-carico-buf
                        move tdc-caus-scarico  to lab-scarico-buf
                   end-read
                else
                   set errori to true
                   display message "Inserimento codice causale mancante"
                           title = tit-err
                           icon mb-warning-icon
                   move 78-ID-ef-causale to control-id
                end-if
                display lab-causale lab-carico lab-scarico
                move ef-causale-buf  to lab-cau-buf
                move lab-causale-buf to lab-des-cau-buf
                display lab-for
      *               
           when 78-ID-ef-for
                inquire ef-for, value in ef-for-buf
                move spaces to lab-for-buf
                if ef-for-buf not = spaces
                   move ef-for-buf to cli-codice convert
                   inspect ef-for-buf replacing trailing spaces 
                                                         by low-values
                   initialize CountChar
                   inspect ef-for-buf tallying CountChar 
                           for characters before low-value
                   inspect ef-for-buf replacing trailing low-values 
                                                         by spaces

                   | SE E' NUMERICO LEGGO IL RECORD NORMALMENTE
                   if ef-for-buf(1:CountChar) is numeric
                      perform SELEZIONA-NUMERICO
                   else                     
                      | HO DIGITATO UNA SIGLA ALFANUMERICA QUINDI 
                      | APRO LO ZOOM (CASE SENSITIVE)
                      perform SELEZIONA-ALFA
                   end-if

                   if tutto-ok
                      inquire ef-pag, value in tblpa-codice2
                      if tblpa-codice2 = spaces
                         move cli-pag to ef-pag-buf
                         move "PA"    to tblpa-codice1
                         move cli-pag to tblpa-codice2
                         move spaces  to tblpa-descrizione1 
                                         tblpa-descrizione2
                         read tcodpag invalid continue end-read
                         initialize lab-pag-buf
                         inspect tblpa-descrizione1 replacing trailing 
                                                    spaces by low-value
                         string  tblpa-descrizione1 delimited low-value
                                 " "                delimited size
                                 tblpa-descrizione2 delimited size
                                 into lab-pag-buf
                         end-string
                      end-if
                   end-if
                else
                   set errori to true
                   display message box
                           "Inserimento codice fornitore mancante"
                             title tit-err
                              icon mb-warning-icon
                   move 78-ID-ef-for to control-id
                end-if
                display lab-for
                display lab-pag
                display ef-pag
      *                                          
           when 78-ID-ef-num
                inquire ef-num value in tmo-numdoc-clifor
                if tmo-numdoc-clifor = spaces
                   set errori to true
                   display message box 
                           "Inserimento numero documento mancante"
                           title = tit-err
                           icon mb-warning-icon
                   move 78-ID-ef-num to control-id
                end-if         
      *                                          
           when 78-ID-ef-data-doc
                inquire ef-data-doc value in ef-data-doc-buf
                move ef-data-doc-buf to como-data
                perform DATE-FORMAT
                move como-data to ef-data-doc-buf
                display ef-data-doc
      *          
           when 78-ID-ef-pag
                inquire ef-pag, value in tblpa-codice2
                move spaces to lab-pag-buf
                move "PA" to tblpa-codice1
                if tblpa-codice2 = spaces
                   move spaces to lab-pag-buf
                else
                   read tcodpag 
                        invalid 
                           set errori to true
                           display message "Codice pagamento NON valido"
                                   title = tit-err
                                   icon mb-warning-icon
                    not invalid
                        initialize lab-pag-buf
                        inspect tblpa-descrizione1 replacing trailing 
                                                   spaces by low-value
                        string  tblpa-descrizione1 delimited low-value
                                " "                delimited size
                                tblpa-descrizione2 delimited size
                                into lab-pag-buf
                        end-string
                   end-read
                end-if
                if errori move 78-ID-ef-pag to control-id end-if
                display lab-pag
      *
           when 78-ID-ef-art
                inquire ef-art, value in ef-art-buf
                move ef-art-buf to art-codice
                if art-codice = 0
                   perform CERCA
                   if stato-zoom not = 0
                      set errori to true
                      display message "Inserimento articolo mancante"
                                title tit-err
                                 icon 2
                   end-if
                else
                   inquire form1-gd-1, last-row in tot-righe
                   if art-codice not = ArticoloInUso
                      perform CONTA-ARTICOLI
                      evaluate num-articoli
                      when 0
                           move 0 to ArticoloInUso
                           set errori to true
                           perform RESETTA-GRID
                           display message "Nessuna distinta per"
                                           " l'articolo inserito"
                                     title tit-err
                                      icon 2
                      when 1
                           move save-codice to dis-codice
                           read distinteb no lock invalid continue 
                           end-read
                           perform CARICA-DISTINTA
                      when other
                           move art-codice to como-articolo
                           perform RIEMPI-TMP-DISTINTEB
                           move path-zoom-distinteb to ext-file
                           move   "zoom-distinteb"  to como-file
                           call   "zoom-gt"      using como-file, 
                                                       zoom-dis-rec
                                                giving stato-zoom
                           cancel "zoom-gt"
                           if stato-zoom = 0
                              move zoom-dis-chiave to dis-chiave
                              read distinteb no lock
                              move dis-articolo-finale to ef-art-buf
                              move 0                   to ef-qta-buf
                              perform CARICA-DISTINTA
                              display ef-art ef-qta
                           else
                              set errori to true
                              display message 
                                      "Inserimento articolo mancante"
                                        title tit-err
                                         icon 2
                           end-if
                           delete file zoom-distinteb
                      end-evaluate
                   end-if
                end-if
                perform DISPLAY-SCREEN
      * 
           when 78-ID-ef-qta
                inquire ef-qta, value in como-qta
                if como-qta = 0
                   display message box "Inserimento quantità mancante"
                             title tit-err
                              icon 2
                   set errori to true
                end-if

           end-evaluate.
      *
           if errori
              perform CANCELLA-COLORE
              move CONTROL-ID to store-id
              move 4          to ACCEPT-CONTROL
           end-if 
           .
      * <TOTEM:END>

       DESCRIZIONE-ARTICOLO.
      * <TOTEM:PARA. DESCRIZIONE-ARTICOLO>
           initialize descr-articolo.
           read articoli no lock 
                invalid continue
            not invalid
                if art-attivo
                   move art-imballo-standard to imq-codice
                   read timbalqta  no lock invalid continue end-read
                   move imq-qta-imb     to imballi-ed
                   call "C$JUSTIFY"  using imballi-ed, "L"
                   move imq-tipo        to imb-codice
                   read timballi   no lock
                        invalid initialize imb-descrizione
                   end-read
                   inspect imb-descrizione replacing trailing 
                                              spaces by low-value
                   inspect art-descrizione replacing trailing 
                                              spaces by low-value
                   string  art-descrizione delimited by low-value
                           " - "           delimited by size
                           imb-descrizione delimited by low-value
                           " da "          delimited by size
                           imballi-ed      delimited by spaces
                           " x "           delimited by size
                           art-udm-imballo delimited by size
                           into descr-articolo
                   end-string
                end-if    
           end-read 
           .
      * <TOTEM:END>

       DISPLAY-SCREEN.
      * <TOTEM:PARA. DISPLAY-SCREEN>
           display form1 
           .
      * <TOTEM:END>

       INIT.
      * <TOTEM:PARA. INIT>
           move 0 to StatusHelp.

           move 78-ID-ef-data to control-id.
           move 4 to accept-control.

           move 1 to mod.

           move spaces to ef-for-buf.
           display ef-for.

           move 0 to ArticoloInUso 
           .
      * <TOTEM:END>

       LEGGI-ANNO.
      * <TOTEM:PARA. LEGGI-ANNO>
           move spaces to tge-codice.
           move 0 to tge-anno.
           read tparamge no lock invalid continue end-read 
           .
      * <TOTEM:END>

       PARAGRAFO-COPY.
      * <TOTEM:PARA. PARAGRAFO-COPY>
           copy "abilita-toolbar.cpy".
           copy "color-custom.cpy".
           copy "utydata.cpy".
           copy "riempi-zoom-distinteb.cpy".
           copy "costo-medio.cpy".
           copy "calcola-costo-mp-when-zero.cpy".
           |copy "movdis-procedure.cpy" 
           .
      * <TOTEM:END>

       RESETTA-GRID.
      * <TOTEM:PARA. RESETTA-GRID>
           modify form1-gd-1, mass-update = 1.
           modify form1-gd-1, reset-grid  = 1.
           perform INTESTAZIONE.
           modify form1-gd-1, mass-update = 0.

      ***---
       INTESTAZIONE.
           modify form1-gd-1, record-to-add = 11.
           perform FORM1-GD-1-CONTENT 
           .
      * <TOTEM:END>

       RESETTA-VIRGOLA.
      * <TOTEM:PARA. RESETTA-VIRGOLA>
           set environment "KEYSTROKE" to "DATA=46 44" 
           .
      * <TOTEM:END>

       SALVA.
      * <TOTEM:PARA. SALVA>
           if mod = 0   exit paragraph end-if.

           set tutto-ok to true.

           perform varying control-id from 78-ID-ef-data by 1
                     until control-id > 78-ID-ef-qta
              perform CONTROLLO
              if errori exit perform end-if
           end-perform.

           if errori

              move store-id to control-id
              move 4        to accept-control

           else

              perform CANCELLA-COLORE
              perform VALORIZZA-NUMERO

              if tutto-ok

                 perform FORM1-BUF-TO-FLD
                 perform SCRIVI-RIGHE
                 perform LEGGI-ANNO
                 perform FORM-NUM-OPEN-ROUTINE
                 move 1  to mod

                 unlock tmovmag all records

                 if SavePesoT not = tot-peso-utf-t
                    move SaveKeyT to tmo-chiave
                    read tmovmag  no lock invalid continue end-read
                    move tot-peso-utf-t to tmo-peso-utf
                    rewrite tmo-rec invalid continue end-rewrite
                 end-if

                 if SavePesoR not = tot-peso-utf-r
                    move SaveKeyR to tmo-chiave
                    read tmovmag  no lock invalid continue end-read
                    move tot-peso-utf-r to tmo-peso-utf
                    rewrite tmo-rec invalid continue end-rewrite
                 end-if

                 perform INIT
                 perform CLEAR-SCREEN

LUBEXX           move data-ult-movim to como-data
LUBEXX           perform DATE-TO-SCREEN
LUBEXX           move como-data to ef-data-buf
LUBEXX           display ef-data

                 move 78-ID-ef-data to control-id
                 move 4             to accept-control

                 move 0 to StatusHelp
                 perform STATUS-HELP

              else

                 move 27 to key-status

              end-if

           end-if.

           perform DISPLAY-SCREEN 
           .
      * <TOTEM:END>

       SCRIVI-RIGHE.
      * <TOTEM:PARA. SCRIVI-RIGHE>
           move 0 to tot-peso-utf-r.
           inquire form1-gd-1, last-row in tot-righe.
           perform varying riga from 2 by 1
                     until riga > tot-righe
              initialize rmo-rec replacing numeric data by zeroes
                                      alphanumeric data by spaces
              perform VALORE-RIGA

              move tge-anno            to rmo-anno
              move num-movim-righe     to rmo-movim
              subtract 1 from riga giving rmo-riga
              set  rmo-fornitore       to true
              move ef-for-buf          to rmo-cod-clifor convert
              move tdc-caus-scarico    to rmo-causale
              move ef-data-buf         to como-data
              perform DATE-TO-FILE
              move como-data           to rmo-data-movim

              move col-art             to rmo-articolo
              move col-mag             to rmo-codmag
              move col-imb             to rmo-imballo
              move col-peso            to rmo-peso

              move hid-art-um          to rmo-udm

              move col-qta             to como-qta
              move como-qta(9:3)       to decimali
              move como-qta            to qta-arrotondata
              if decimali > 500
                 add 1 to qta-arrotondata
              end-if

              move ef-qta-buf          to como-qta

              compute rmo-qta = como-qta * qta-arrotondata
              move hid-peso-udm        to rmo-peso-udm
              move col-utf             to rmo-peso-tot-utf
              move col-non-utf         to rmo-peso-tot
              move col-oneri           to como-oneri
              move col-mp              to como-prezzo
              add  como-oneri to como-prezzo giving rmo-listino
              add  como-oneri to como-prezzo giving rmo-netto
              move hid-marca-prodotto  to rmo-marca-prodotto

              compute rmo-peso-tot-utf = rmo-peso-tot-utf * rmo-qta
              compute rmo-peso-tot     = rmo-peso-tot     * rmo-qta

              set rmo-attivo to true

              move user-codi to rmo-utente-creazione
              accept rmo-ora-creazione  from time
              accept rmo-data-creazione from century-date

              perform CALL-WPROGMAG

              write rmo-rec invalid rewrite rmo-rec end-write

              compute tot-peso-utf-r = rmo-peso-tot-utf + tot-peso-utf-r

           end-perform.

           initialize tmo-rec replacing numeric data by zeroes
                                   alphanumeric data by spaces.

           move rmo-anno        to tmo-anno.
           move rmo-movim       to tmo-numero.
           move rmo-data-movim  to tmo-data-movim.
           move rmo-causale     to tmo-causale.
           move rmo-tipo        to tmo-tipo.
           move rmo-cod-clifor  to tmo-cod-clifor.
           move ef-num-buf      to tmo-numdoc-clifor.
           move ef-data-doc-buf to como-data.
           perform DATE-TO-FILE.
           move como-data       to tmo-data-doc.
           move ef-pag-buf      to tmo-codpag.
           move tot-peso-utf-r  to tmo-peso-utf SavePesoR.
           set  tmo-attivo      to true.
           move user-codi       to tmo-utente-creazione.
           accept tmo-data-creazione from century-date.
           accept tmo-ora-creazione  from time.
           write tmo-rec invalid continue end-write.
           move tmo-chiave to SaveKeyR 
           .
      * <TOTEM:END>

       SELEZIONA-ALFA.
      * <TOTEM:PARA. SELEZIONA-ALFA>
      * LA SECONDA CHIAVE E' ALFANUMERICA E LA VALUE VARIABLE CONTIENE
      * ANCORA GLI ZERI DAVANTI CHE ELIMINO
           inspect ef-for-buf replacing leading ZERO by spaces.
           move    ef-for-buf to cli-ragsoc-1.
      
      * POI GIUSTIFICO A SINISTRA E MI POSIZIONO SULLO ZOOM PER CHIAVE
      * ALTERNATA
           set cli-tipo-F to true.
           call "C$JUSTIFY" using cli-ragsoc-1, "L".
      
           start clienti     key >= cli-k1
                 invalid     continue
                 not invalid read clienti next 
           end-start.
      
           move "clienti-alfa-CF" to como-file.
           call "zoom-gt" using   como-file, cli-rec
                          giving  stato-zoom.
           cancel "zoom-gt".
           if stato-zoom = ZERO
              move cli-codice    to codice-ed
              move codice-ed     to ef-for-buf   
              call "C$JUSTIFY" using ef-for-buf, "L"
              display ef-for
              move cli-ragsoc-1  to lab-for-buf
           else
              set errori        to true
              move 78-ID-ef-for to control-id
           end-if 
           .
      * <TOTEM:END>

       SELEZIONA-NUMERICO.
      * <TOTEM:PARA. SELEZIONA-NUMERICO>
           set cli-tipo-F to true.
           read clienti no lock
                invalid
                   set errori to true
                   display message box "Codice fornitore NON valido"
                             title = tit-err
                             icon mb-warning-icon  
            not invalid
                if cli-attivo
                   move cli-ragsoc-1 to lab-for-buf
                else
                   move spaces       to lab-for-buf
                   display message "Fornitore NON attivo"
                             title tit-err
                              icon 2
                   set errori to true
                end-if
           end-read 
           .
      * <TOTEM:END>

       SETTA-VIRGOLA.
      * <TOTEM:PARA. SETTA-VIRGOLA>
           set environment "KEYSTROKE" to "DATA=44 46" 
           .
      * <TOTEM:END>

       SPOSTAMENTO.
      * <TOTEM:PARA. SPOSTAMENTO>
           perform X-Y.
           if event-data-2 > tot-righe
              set event-action to event-action-fail
              move tot-righe   to riga event-data-2
              modify form1-gd-1, cursor-y = riga
           end-if.
           modify form1-gd-1, start-y = event-data-2,
                                    y = event-data-2,
                              start-x = 2,
                                    x = 12,
                         region-color = 257
                         cursor-color = 481 
           .
      * <TOTEM:END>

       STATUS-BAR-MSG.
      * <TOTEM:PARA. STATUS-BAR-MSG>
           modify form1-st-1-handle, 
                        panel-index  3, 
                        panel-text  "INSERIMENTO"
           .
      * <TOTEM:END>

       STATUS-HELP.
      * <TOTEM:PARA. STATUS-HELP>
           if StatusHelp = 1
              modify Form1-St-1-Handle, 
                     panel-index = 2, 
                     panel-text "F8 HELP record presenti"
              move BitmapZoomEnabled to BitmapNumZoom
           else
              modify Form1-St-1-Handle, 
                     panel-index = 2, 
                     panel-text spaces
              move BitmapZoomDisabled to BitmapNumZoom
           end-if.
           move StatusHelp to e-cerca.
           modify tool-cerca, enabled       = e-cerca.
           modify tool-cerca, bitmap-number = BitmapNumZoom 
           .
      * <TOTEM:END>

       VALORE-RIGA.
      * <TOTEM:PARA. VALORE-RIGA>
           inquire form1-gd-1(riga, 2),   cell-data in col-art.
           inquire form1-gd-1(riga, 3),   cell-data in col-mag.
           inquire form1-gd-1(riga, 4),   cell-data in col-imb.
           inquire form1-gd-1(riga, 5),   cell-data in col-peso.
           inquire form1-gd-1(riga, 6),   cell-data in col-des.
           inquire form1-gd-1(riga, 7),   cell-data in col-utf.
           inquire form1-gd-1(riga, 8),   cell-data in col-non-utf.
           inquire form1-gd-1(riga, 9),   cell-data in col-mp.
           inquire form1-gd-1(riga, 10),  cell-data in col-qta.
           inquire form1-gd-1(riga, 11),  cell-data in col-oneri.
           inquire form1-gd-1(riga, 12),  cell-data in col-giacenza.
           inquire form1-gd-1(riga, 1), hidden-data in hid-dati-articolo
           .
      * <TOTEM:END>

       VALORIZZA-NUMERO.
      * <TOTEM:PARA. VALORIZZA-NUMERO>
           perform X-Y.
           move 2 to link-num-record.
           move ef-data-buf     to como-data.
           move como-data(5:4)  to link-anno tmo-anno.
           set  link-gmovdis    to true.
           set  link-crea-multi to true.

           call   "nambar" using link-nambar.
           cancel "nambar".
           
           if link-status-nambar = -1 set errori to true end-if.
           add 1 to link-numero giving num-movim-testa.
           add 2 to link-numero giving num-movim-righe 
           .
      * <TOTEM:END>

       X-Y.
      * <TOTEM:PARA. X-Y>
           inquire form1-gd-1, cursor-y in riga, cursor-x in colonna,
                               last-row in tot-righe 
           .
      * <TOTEM:END>

      * EVENT PARAGRAPH
       anagr01-Ev-After-Program.
      * <TOTEM:PARA. anagr01-Ev-After-Program>
           SET LK-BL-CANCELLAZIONE TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM 
           .
      * <TOTEM:END>
       anagr01-Ev-Before-Program.
      * <TOTEM:PARA. anagr01-Ev-Before-Program>
           move LK-BL-PROG-ID    TO COMO-PROG-ID.
LUBEXX* Per incasinarmi il meno possibile mi apro il file in input,
LUBEXX* prelevo la data del'ultimo movimento inserito e chiudo.
LUBEXX     open input tmovmag.
LUBEXX     move high-value to tmo-chiave.
LUBEXX     start tmovmag key is <= tmo-chiave
LUBEXX           invalid move 0 to data-ult-movim
LUBEXX       not invalid
LUBEXX           read tmovmag previous
LUBEXX           move tmo-data-movim to data-ult-movim
LUBEXX     end-start.
LUBEXX     close tmovmag 
           .
      * <TOTEM:END>
       TOOL-SALVA-LinkTo.
      * <TOTEM:PARA. TOOL-SALVA-LinkTo>
           inquire tool-modifica, value in mod           
      
           inquire tool-salva, enabled in e-salva
           if e-salva = 1
              perform SALVA
           end-if           
           .
      * <TOTEM:END>
       TOOL-MODIFICA-LinkTo.
      * <TOTEM:PARA. TOOL-MODIFICA-LinkTo>
      *     INQUIRE TOOL-MODIFICA, ENABLED IN E-MODIFICA.
      *
      *     IF E-MODIFICA = 1
      *        PERFORM MODIFICA
      *     END-IF 
           .
      * <TOTEM:END>
       TOOL-MODIFICA-BeforeProcedure.
      * <TOTEM:PARA. TOOL-MODIFICA-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       TOOL-MODIFICA-AfterProcedure.
      * <TOTEM:PARA. TOOL-MODIFICA-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       TOOL-CERCA-LinkTo.
      * <TOTEM:PARA. TOOL-CERCA-LinkTo>
           inquire tool-cerca, enabled in e-cerca
           if e-cerca = 1
              perform CERCA
           end-if 
           .
      * <TOTEM:END>
       ef-art-BeforeProcedure.
      * <TOTEM:PARA. ef-art-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           if tutto-ok
              inquire ef-art, value in ArticoloInUso
           end-if 
           .
      * <TOTEM:END>
       ef-art-AfterProcedure.
      * <TOTEM:PARA. ef-art-AfterProcedure>
              INQUIRE ef-art-v, VALUE IN dis-articolo-finale
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-art-v-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO.

           .
      * <TOTEM:END>

       Form1-Gd-1-Ev-Msg-Begin-Drag.
      * <TOTEM:PARA. Form1-Gd-1-Ev-Msg-Begin-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       Form1-Gd-1-Ev-Msg-Begin-Entry.
      * <TOTEM:PARA. Form1-Gd-1-Ev-Msg-Begin-Entry>
           perform X-Y.
           inquire form1-gd-1(riga, 2), cell-data in col-art.
           move col-art to art-codice.
           if art-codice = 0
              set event-action to event-action-fail
           else
              if colonna = 9
                 perform SETTA-VIRGOLA
              else
                 set event-action to event-action-fail
              end-if
           end-if 
           .
      * <TOTEM:END>
       Form1-Gd-1-Ev-Msg-End-Drag.
      * <TOTEM:PARA. Form1-Gd-1-Ev-Msg-End-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       Form1-Gd-1-Ev-Msg-Goto-Cell.
      * <TOTEM:PARA. Form1-Gd-1-Ev-Msg-Goto-Cell>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       Form1-Gd-1-Ev-Msg-Goto-Cell-Drag.
      * <TOTEM:PARA. Form1-Gd-1-Ev-Msg-Goto-Cell-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       Form1-Gd-1-Ev-Msg-Goto-Cell-Mouse.
      * <TOTEM:PARA. Form1-Gd-1-Ev-Msg-Goto-Cell-Mouse>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       ef-data-BeforeProcedure.
      * <TOTEM:PARA. ef-data-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-data-AfterProcedure.
      * <TOTEM:PARA. ef-data-AfterProcedure>
              INQUIRE ef-data, VALUE IN tmo-data-movim
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-data-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-causale-BeforeProcedure.
      * <TOTEM:PARA. ef-causale-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-causale-AfterProcedure.
      * <TOTEM:PARA. ef-causale-AfterProcedure>
              INQUIRE ef-causale, VALUE IN tmo-causale
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-causale-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-for-BeforeProcedure.
      * <TOTEM:PARA. ef-for-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-for-AfterProcedure.
      * <TOTEM:PARA. ef-for-AfterProcedure>
              INQUIRE ef-for, VALUE IN tmo-cod-clifor
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-for-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-num-BeforeProcedure.
      * <TOTEM:PARA. ef-num-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-num-AfterProcedure.
      * <TOTEM:PARA. ef-num-AfterProcedure>
              INQUIRE ef-num, VALUE IN tmo-numdoc-clifor
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-num-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-data-doc-BeforeProcedure.
      * <TOTEM:PARA. ef-data-doc-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-data-doc-AfterProcedure.
      * <TOTEM:PARA. ef-data-doc-AfterProcedure>
              INQUIRE ef-data-doc, VALUE IN tmo-data-doc
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-data-doc-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-pag-BeforeProcedure.
      * <TOTEM:PARA. ef-pag-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-pag-AfterProcedure.
      * <TOTEM:PARA. ef-pag-AfterProcedure>
              INQUIRE ef-pag, VALUE IN tmo-codpag
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-pag-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       form1-Gd-1-Ev-Msg-Cancel-Entry.
      * <TOTEM:PARA. form1-Gd-1-Ev-Msg-Cancel-Entry>
           perform X-Y.
           if colonna = 9 perform RESETTA-VIRGOLA end-if 
           .
      * <TOTEM:END>
       form1-Gd-1-BeforeProcedure.
      * <TOTEM:PARA. form1-Gd-1-BeforeProcedure>
           .
      * <TOTEM:END>
       ef-mag-BeforeProcedure.
      * <TOTEM:PARA. ef-mag-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-mag-AfterProcedure.
      * <TOTEM:PARA. ef-mag-AfterProcedure>
              INQUIRE ef-mag, VALUE IN dis-magazzino-finale
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-mag-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-imb-BeforeProcedure.
      * <TOTEM:PARA. ef-imb-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-imb-AfterProcedure.
      * <TOTEM:PARA. ef-imb-AfterProcedure>
              INQUIRE ef-imb, VALUE IN dis-imballo-finale
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-imb-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-peso-BeforeProcedure.
      * <TOTEM:PARA. ef-peso-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-peso-AfterProcedure.
      * <TOTEM:PARA. ef-peso-AfterProcedure>
              INQUIRE ef-peso, VALUE IN dis-peso-finale
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-peso-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-peso-utf-BeforeProcedure.
      * <TOTEM:PARA. ef-peso-utf-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-peso-utf-AfterProcedure.
      * <TOTEM:PARA. ef-peso-utf-AfterProcedure>
              INQUIRE ef-peso-utf, VALUE IN dis-peso-utf
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-peso-utf-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-peso-non-utf-BeforeProcedure.
      * <TOTEM:PARA. ef-peso-non-utf-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-peso-non-utf-AfterProcedure.
      * <TOTEM:PARA. ef-peso-non-utf-AfterProcedure>
              INQUIRE ef-peso-non-utf, VALUE IN dis-peso-non-utf
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-peso-non-utf-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-mp-BeforeProcedure.
      * <TOTEM:PARA. ef-mp-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-mp-AfterProcedure.
      * <TOTEM:PARA. ef-mp-AfterProcedure>
              INQUIRE ef-mp, VALUE IN dis-prezzo
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-mp-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       Screen1-Ef-1-BeforeProcedure.
      * <TOTEM:PARA. Screen1-Ef-1-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       Screen1-Ef-1-AfterProcedure.
      * <TOTEM:PARA. Screen1-Ef-1-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       ef-qta-BeforeProcedure.
      * <TOTEM:PARA. ef-qta-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-qta-AfterProcedure.
      * <TOTEM:PARA. ef-qta-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO.

           .
      * <TOTEM:END>

       form1-Gd-1-Ev-Msg-Finish-Entry.
      * <TOTEM:PARA. form1-Gd-1-Ev-Msg-Finish-Entry>
           perform X-Y.
           move 0 to somma-prezzo.
           perform varying store-riga from 2 by 1 
                     until store-riga > tot-righe
              inquire form1-gd-1(store-riga, 9),  cell-data in costo-mp
              inquire form1-gd-1(store-riga, 10), cell-data in como-qta

              move como-qta      to qta-arrotondata
              move como-qta(9:3) to decimali
              if decimali > 500
                 add 1 to qta-arrotondata
              end-if

              compute somma-prezzo = 
                      somma-prezzo + (costo-mp * qta-arrotondata)
           end-perform.

           move somma-prezzo to ef-mp-buf ef-tot-prezzo-buf.

           display ef-tot-prezzo ef-mp.

           if colonna = 9
              inquire form1-gd-1(riga, 9), cell-data in col-mp
              modify  form1-gd-1(riga, 9), cell-data =  col-mp
              perform RESETTA-VIRGOLA
           end-if 
           .
      * <TOTEM:END>
       pb-fatto-LinkTo.
      * <TOTEM:PARA. pb-fatto-LinkTo>
           inquire ef-peso-carico,  value in tot-peso-utf-t.
           inquire ef-peso-scarico, value in tot-peso-utf-r.
           move 27 to key-status 
           .
      * <TOTEM:END>
       ef-peso-carico-BeforeProcedure.
      * <TOTEM:PARA. ef-peso-carico-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-peso-carico-AfterProcedure.
      * <TOTEM:PARA. ef-peso-carico-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       pb-fatto-BeforeProcedure.
      * <TOTEM:PARA. pb-fatto-BeforeProcedure>
           modify pb-fatto, bitmap-number = 2 
           .
      * <TOTEM:END>
       pb-fatto-AfterProcedure.
      * <TOTEM:PARA. pb-fatto-AfterProcedure>
           modify pb-fatto, bitmap-number = 1 
           .
      * <TOTEM:END>

      *{TOTEM}END

      *{TOTEM}SHOW-MSG
       MESSAGE-FOR-FILEERROR.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
              MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           .

       SHOW-TRANSACTION-ROUTINE.
           IF TOTEM-TRANSACTION-FLAG = SPACES
              IF TRANSACTION-STATUS NOT = 0
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-1
              END-IF
           ELSE
              PERFORM SHOW-MSG-ROUTINE
              IF TRANSACTION-STATUS = 0
                 MOVE "Transazione terminata con Rollback." TO 
           TOTEM-MSG-3
              ELSE
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-3
              END-IF
           END-IF
           .

       SHOW-MSG-ROUTINE.
           MOVE SPACE TO TOTEM-MSG-1 TOTEM-MSG-2 TOTEM-MSG-3
           EVALUATE TOTEM-MSG-ID
               WHEN "10"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Nessun altro dato." TO TOTEM-MSG-2
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "22"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Chiave Duplicata." TO TOTEM-MSG-2
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "23"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Raggiunta fine file." TO TOTEM-MSG-2
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "101"
                    MOVE "Terminare l'applicazione?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "201"
                    MOVE "Aggiungere un nuovo record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "202"
                    MOVE "Aggiornare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "203"
                    MOVE "Cancellare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "204"
                    MOVE "Chiave duplicata." TO TOTEM-MSG-1
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "301"
                    MOVE "Inserimento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "302"
                    MOVE "Aggiornamento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "303"
                    MOVE "Cancellazione avvenuta con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "401"
                    MOVE "Shell non trovata." TO TOTEM-MSG-1
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN OTHER
                    MOVE TEXT-MESSAGE TO TOTEM-MSG-1
                    STRING "FILE:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-3
                    MOVE 0 TO TOTEM-IDX1
                    INSPECT TOTEM-MSG-3 TALLYING TOTEM-IDX1
                       FOR TRAILING SPACE
                    STRING TOTEM-MSG-3(1:TOTEM-MSG-LENGTH - 
           TOTEM-IDX1), 
                       ", FILE STATUS ", PRIMARY-ERROR "," 
                       SECONDARY-ERROR
                    DELIMITED BY SIZE INTO TOTEM-MSG-2
                    MOVE SPACES TO TOTEM-MSG-3
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
           END-EVALUATE
           PERFORM MESSAGE-BOX-ROUTINE
           .

       MESSAGE-BOX-ROUTINE.
           MOVE 1 TO TOTEM-MSG-TEXT-POINTER
           IF TOTEM-MSG-1 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-1 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              STRING TOTEM-MSG-1( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                 DELIMITED BY SIZE
                 INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-2 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-2 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-2( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-3 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-3 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-3( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-TEXT-POINTER = 1
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-TEXT TALLYING TOTEM-MSG-SIZE FOR 
           TRAILING SPACE
                  COMPUTE TOTEM-MSG-TEXT-POINTER = 
           TOTEM-MSG-FULL-LENGTH - TOTEM-MSG-SIZE + 1
           END-IF
           MOVE LOW-VALUES TO TOTEM-MSG-TEXT(TOTEM-MSG-TEXT-POINTER : 1 
           )
           .

       MESSAGE-BOX-DISPLAY.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

      *{TOTEM}END

