      *{TOTEM}PRG-COMMENT
      * glistini.Cbl
      * glistini.Cbl is generated by TOTEM
      * This is a generated file. DO NOT modify this file directly.
      *{TOTEM}END
       IDENTIFICATION       DIVISION.
      *{TOTEM}PRGID
       PROGRAM-ID.          glistini.
       AUTHOR.              andre.
       DATE-WRITTEN.        martedì 16 marzo 2021 10:44:58.
       REMARKS.
      *{TOTEM}END

       ENVIRONMENT          DIVISION.
       CONFIGURATION        SECTION.
       SPECIAL-NAMES.
      *{TOTEM}SPECIAL-NAME
      * <TOTEM:EPT. INIT:glistini, INIT:glistini, SpecialName>
      * <TOTEM:END>
      *{TOTEM}END
      *{TOTEM}ACTIVEX-DEF
      *{TOTEM}END
      *{TOTEM}DECIMAL-POINT
           DECIMAL-POINT IS COMMA.
      *{TOTEM}END

       INPUT-OUTPUT         SECTION.
       FILE-CONTROL.
      *{TOTEM}FILE-CONTROL
           COPY "articoli.sl".
           COPY "rlistini.sl".
           COPY "tlistini.sl".
           COPY "clienti.sl".
           COPY "tlistini.sl"
                REPLACING ==tlistini== BY ==tlistini1==,
                          ==STATUS-tlistini== BY ==STATUS-tlistini1==
                .
           COPY "destinif.sl".
           COPY "impforn.sl".
           COPY "progmag.sl".
           COPY "distinteb.sl".
           COPY "timposte.sl".
           COPY "tpiombo.sl".
           COPY "tparamge.sl".
           COPY "tmp-nlistini.sl".
           COPY "nlistini.sl".
           COPY "nforn-dest.sl".
           COPY "catart.sl".
           COPY "param.sl".
           COPY "tscorte.sl".
      *{TOTEM}END
       DATA                 DIVISION.
       FILE                 SECTION.
      *{TOTEM}FILE
           COPY "articoli.fd".
           COPY "rlistini.fd".
           COPY "tlistini.fd".
           COPY "clienti.fd".
           COPY "tlistini.fd"
                REPLACING ==tlistini== BY ==tlistini1==,
                          ==STATUS-tlistini== BY ==STATUS-tlistini1==
                .
           COPY "destinif.fd".
           COPY "impforn.fd".
           COPY "progmag.fd".
           COPY "distinteb.fd".
           COPY "timposte.fd".
           COPY "tpiombo.fd".
           COPY "tparamge.fd".
           COPY "tmp-nlistini.fd".
           COPY "nlistini.fd".
           COPY "nforn-dest.fd".
           COPY "catart.fd".
           COPY "param.fd".
           COPY "tscorte.fd".
      *{TOTEM}END

       WORKING-STORAGE      SECTION.
      *{TOTEM}ACU-DEF
               COPY "acugui.def".
               COPY "acucobol.def".
               COPY "fonts.def".
               COPY "crtvars.def".
               COPY "showmsg.def".
               COPY "totem.def".
               COPY "standard.def".
      *{TOTEM}END

      *{TOTEM}COPY-WORKING
      * Key Status
       77 Key-Status IS SPECIAL-NAMES CRT STATUS PIC 9(5) VALUE 0.
          88 Enter-Pushed VALUE 13.
          88 Exit-Pushed VALUE 27.
          88 Message-Received VALUE 95.
          88 Event-Occurred VALUE 96.
          88 Screen-No-Input-Field VALUE 97.
          88 Screen-Time-Out VALUE 99.
      * Properties & User defined Working Stoarge
       78 titolo VALUE IS "Geslux - Gestione Offerte Fornitori". 
           COPY  "COSTO-MEDIO.DEF".
           COPY  "IMPOSTE-FORNITORE.DEF".
           COPY  "PRZ-FINITO-FORN.DEF".
           COPY  "LINK-GNOTE-LISTINI.DEF".
           COPY  "TROVA-PARAMETRO.DEF".
       77 RigheIniziali    PIC  9(5)
                  VALUE IS 0.
       77 save-forn        PIC  x(5).
       77 calcolo-piombo   PIC  x.
           88 nuovo-calcolo-piombo VALUE IS "N". 
       77 RigaCambiata     PIC  9(5)
                  VALUE IS 0.
       77 ColonnaCambiata  PIC  9(5)
                  VALUE IS 0.
       77 Form1-Tb-1-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 val-ini          PIC  99/99/9999.
       77 val-fine         PIC  99/99/9999.
       77 store-forn       PIC  x(5).
       77 store-destino    PIC  x(5).
       77 store-fine       PIC  9(8).
       77 store-codice     PIC  9(15).
       77 data-oggi        PIC  9(8).
       77 toolbar-bmp      PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 codice-x         PIC  x(15).
       77 E-ESCI           PIC  9
                  VALUE IS 1.
       77 E-NUOVO          PIC  9
                  VALUE IS 1.
       77 E-CANCELLA       PIC  9
                  VALUE IS 1.
       77 E-SALVA          PIC  9
                  VALUE IS 1.
       77 E-ANTEPRIMA      PIC  9
                  VALUE IS 0.
       77 E-MODIFICA       PIC  9
                  VALUE IS 1.
       77 E-STAMPA         PIC  9
                  VALUE IS 1.
       77 E-CERCA          PIC  9
                  VALUE IS 0.
       77 E-SELEZIONA      PIC  9
                  VALUE IS 1.
       77 Small-Font
                  USAGE IS HANDLE OF FONT SMALL-FONT.
       77 Form1-St-1-Handle
                  USAGE IS HANDLE OF STATUS-BAR.
       77 form1-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 como-data-to     PIC  9(8).
       77 store-articolo   PIC  9(6).
       77 num-dest         PIC  9(6).
       77 como-ven         PIC  9(12)v99.
       77 como-acq         PIC  9(12)v99.
       77 como-qta         PIC  9(12).
       77 link-codice      PIC  9(15).
       77 link-articolo    PIC  9(6).
       77 link-fornitore   PIC  9(5).
       77 ID-AUTO          PIC  9(6)
                  VALUE IS 0.
       77 AUTO-ID          PIC  9(6)
                  VALUE IS 0,00.
       77 STATUS-articoli  PIC  X(2).
           88 Valid-STATUS-articoli VALUE IS "00" THRU "09". 
       77 STATUS-clienti   PIC  X(2).
           88 Valid-STATUS-clienti VALUE IS "00" THRU "09". 
       77 STATUS-rlistini  PIC  X(2).
           88 Valid-STATUS-rlistini VALUE IS "00" THRU "09". 
       77 STATUS-tlistini  PIC  X(2).
           88 Valid-STATUS-tlistini VALUE IS "00" THRU "09". 
       77 BOTTONE-OK-BMP   PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 BOTTONE-CANCEL-BMP           PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 STATUS-tlistini1 PIC  X(2).
           88 VALID-STATUS-tlistini1 VALUE IS "00" THRU "09". 
       77 lab-forn-buf     PIC  X(50).
       77 como-prz-finale  PIC  9(9)v99.
       77 como-lt          PIC  9(9).
       77 save-dest        PIC  9(9).
       77 excel-bmp        PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 form-copia-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 cli-copia        PIC  9(15).
       77 BOTTONE-annulla-BMP          PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 lbl-cli-copia-buf            PIC  X(40).
       77 Form1-Tb-1-Handlea
                  USAGE IS HANDLE OF WINDOW.
       78 titolo-copia VALUE IS "GESLUX - Gestione Offerte - Copia Listi
      -    "no". 
       77 copia-bmp        PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 lab-dest-buf     PIC  X(50).
       77 STATUS-clienti1  PIC  X(2).
           88 VALID-STATUS-clienti1 VALUE IS "00" THRU "09". 
       77 STATUS-destinif  PIC  X(2).
           88 Valid-STATUS-destinif VALUE IS "00" THRU "09". 
       77 STATUS-impforn   PIC  X(2).
           88 Valid-STATUS-impforn VALUE IS "00" THRU "09". 
       01 rec-grid.
           05 col-art          PIC  z(6).
           05 col-des          PIC  x(50).
           05 col-art-forn     PIC  X(20).
           05 col-prz-acq      PIC  z.zzz.zz9,9999.
           05 col-sconto-1     PIC  zz9,99.
           05 col-netto        PIC  z.zzz.zz9,9999.
           05 col-sconto-2     PIC  zz9,99.
           05 col-sconto-3     PIC  zz9,99.
           05 col-sconto-4     PIC  zz9,99.
           05 col-sconto-5     PIC  zz9,99.
           05 col-costi-agg    PIC  zz9,9999.
           05 col-perce-agg    PIC  999v99.
           05 col-perce-pb     PIC  zz9,99.
           05 col-disp         PIC  z.zzz.zz9.
           05 col-lead-time    PIC  zz9.
           05 col-tipo-imp     PIC  z(5).
           05 col-des-imp      PIC  X(50).
           05 col-prz-tot      PIC  z.zzz.zz9,9999.
           05 col-prz-conf     PIC  z.zzz.zz9,9999.
           05 col-PFA          PIC  x.
       01 old-rec-grid.
           05 old-col-art      PIC  z(6).
           05 old-col-des      PIC  x(50).
           05 old-col-art-forn PIC  X(20).
           05 old-col-prz-acq  PIC  z.zzz.zz9,9999.
           05 old-col-sconto-1 PIC  zz9,99.
           05 old-col-netto    PIC  z.zzz.zz9,9999.
           05 old-col-sconto-2 PIC  zz9,99.
           05 old-col-sconto-3 PIC  zz9,99.
           05 old-col-sconto-4 PIC  zz9,99.
           05 old-col-sconto-5 PIC  zz9,99.
           05 old-col-costi-agg            PIC  zz9,9999.
           05 old-col-perce-agg            PIC  999v99.
           05 old-col-perce-pb PIC  zz9,99.
           05 old-col-disp     PIC  z.zzz.zz9.
           05 old-col-lead-time            PIC  zz9.
           05 old-col-tipo-imp PIC  z(5).
           05 old-col-des-imp  PIC  X(50).
           05 old-col-prz-tot  PIC  z.zzz.zz9,9999.
           05 old-col-prz-conf PIC  z.zzz.zz9,9999.
           05 old-col-PFA      PIC  x.
       77 STRIP-GRID-GCLIENTI-BMP      PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 STATUS-progmag   PIC  X(2).
           88 Valid-STATUS-progmag VALUE IS "00" THRU "09". 
       77 STATUS-timposte  PIC  X(2).
           88 Valid-STATUS-timposte VALUE IS "00" THRU "09". 
       77 STATUS-tpiombo   PIC  X(2).
           88 Valid-STATUS-tpiombo VALUE IS "00" THRU "09". 
       77 Verdana8-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 STATUS-tparamge  PIC  X(2).
           88 Valid-STATUS-tparamge VALUE IS "00" THRU "09". 
       77 STATUS-distinteb PIC  X(2).
           88 Valid-STATUS-distinteb VALUE IS "00" THRU "09". 
       77 STATUS-nlistini  PIC  X(2).
           88 Valid-STATUS-nlistini VALUE IS "00" THRU "09". 
       77 path-tmp-nlistini            PIC  X(256).
       77 STATUS-tmp-nlistini          PIC  X(2).
           88 Valid-STATUS-tmp-nlistini VALUE IS "00" THRU "09". 
       01 como-note        PIC  x(200)
                  OCCURS 4 TIMES.
       01 old-como-note    PIC  x(200)
                  OCCURS 4 TIMES.
       77 cont PIC  9(3).
       77 STATUS-nforn-dest            PIC  X(2).
           88 Valid-STATUS-nforn-dest VALUE IS "00" THRU "09". 
       77 Verdana10-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 Verdana12-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 status-catart    PIC  X(2).
           88 Valid-status-catart VALUE IS "00" THRU "09". 
       77 STATUS-param     PIC  X(2).
           88 Valid-STATUS-param VALUE IS "00" THRU "09". 
       77 STATUS-tscorte   PIC  X(2).
           88 Valid-STATUS-tscorte VALUE IS "00" THRU "09". 

      ***********************************************************
      *   Code Gen's Buffer                                     *
      ***********************************************************
       77 STATUS-Form1-FLAG-REFRESH PIC  9.
          88 Form1-FLAG-REFRESH  VALUE 1 FALSE 0. 
      * DATA CONTROL BUFFER
       01 Form1-BUF.
      * Data.Entry-Field
              05 ef-codice-BUF PIC x(15).
      * Data.Entry-Field
              05 ef-forn-BUF PIC z(5).
      * Data.Entry-Field
              05 ef-destino-BUF PIC z(5).
      * Data.Entry-Field
              05 ef-note-BUF PIC X(50).
      * Data.Entry-Field
              05 ef-ini-val-BUF PIC 99/99/9999.
      * Data.Entry-Field
              05 ef-fine-val-BUF PIC 99/99/9999.
      * Data.Check-Box
              05 chk-trasporto-f-BUF PIC 9 VALUE ZERO.
      * Data.Check-Box
              05 chk-trasporto-c-BUF PIC 9 VALUE ZERO.
      * Data.Label
              05 lab-nome-BUF PIC X(50).
      * Data.Entry-Field
              05 ef-note-1-BUF PIC X(200).
      * Data.Entry-Field
              05 ef-note-2-BUF PIC X(200).
      * Data.Entry-Field
              05 ef-note-3-BUF PIC X(200).
      * Data.Entry-Field
              05 ef-note-4-BUF PIC X(200).

       77 TMP-Form1-KEY1-ORDER  PIC X VALUE "A".
       77 TMP-Form1-tlistini-RESTOREBUF  PIC X(257).
       77 TMP-Form1-KEYIS  PIC 9(3) VALUE 1.
       77 Form1-MULKEY-TMPBUF   PIC X(257).
       77 STATUS-form-copia-FLAG-REFRESH PIC  9.
          88 form-copia-FLAG-REFRESH  VALUE 1 FALSE 0. 
       77 TMP-DataSet1-articoli-BUF     PIC X(3669).
       77 TMP-DataSet1-rlistini-BUF     PIC X(448).
       77 TMP-DataSet1-tlistini-BUF     PIC X(257).
       77 TMP-DataSet1-clienti-BUF     PIC X(3610).
       77 TMP-DataSet1-tlistini1-BUF     PIC X(257).
       77 TMP-DataSet1-destinif-BUF     PIC X(1322).
       77 TMP-DataSet1-impforn-BUF     PIC X(220).
       77 TMP-DataSet1-progmag-BUF     PIC X(1090).
       77 TMP-DataSet1-distinteb-BUF     PIC X(672).
       77 TMP-DataSet1-timposte-BUF     PIC X(717).
       77 TMP-DataSet1-tpiombo-BUF     PIC X(739).
       77 TMP-DataSet1-tparamge-BUF     PIC X(815).
       77 TMP-DataSet1-tmp-nlistini-BUF     PIC X(824).
       77 TMP-DataSet1-nlistini-BUF     PIC X(824).
       77 TMP-DataSet1-nforn-dest-BUF     PIC X(379).
       77 TMP-DataSet1-catart-BUF     PIC X(6622).
       77 TMP-DataSet1-param-BUF     PIC X(980).
       77 TMP-DataSet1-tscorte-BUF     PIC X(205).
      * VARIABLES FOR RECORD LENGTH.
       77  TotemFdSlRecordClearOffset   PIC 9(5) COMP-4.
       77  TotemFdSlRecordLength        PIC 9(5) COMP-4.
      * FILE'S LOCK MODE FLAG
       77 DataSet1-articoli-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-articoli-LOCK  VALUE "Y".
       77 DataSet1-articoli-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-articoli-KEY-Asc  VALUE "A".
          88 DataSet1-articoli-KEY-Desc VALUE "D".
       77 DataSet1-rlistini-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-rlistini-LOCK  VALUE "Y".
       77 DataSet1-rlistini-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-rlistini-KEY-Asc  VALUE "A".
          88 DataSet1-rlistini-KEY-Desc VALUE "D".
       77 DataSet1-tlistini-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tlistini-LOCK  VALUE "Y".
       77 DataSet1-KEYIS   PIC 9(3) VALUE 1.
       77 DataSet1-tlistini-KEY1-ORDER  PIC X VALUE "A".
          88 DataSet1-tlistini-KEY1-Asc  VALUE "A".
          88 DataSet1-tlistini-KEY1-Desc VALUE "D".
       77 DataSet1-clienti-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-clienti-LOCK  VALUE "Y".
       77 DataSet1-clienti-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-clienti-KEY-Asc  VALUE "A".
          88 DataSet1-clienti-KEY-Desc VALUE "D".
       77 DataSet1-tlistini1-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tlistini1-LOCK  VALUE "Y".
       77 DataSet1-tlistini1-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tlistini1-KEY-Asc  VALUE "A".
          88 DataSet1-tlistini1-KEY-Desc VALUE "D".
       77 DataSet1-destinif-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-destinif-LOCK  VALUE "Y".
       77 DataSet1-destinif-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-destinif-KEY-Asc  VALUE "A".
          88 DataSet1-destinif-KEY-Desc VALUE "D".
       77 DataSet1-impforn-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-impforn-LOCK  VALUE "Y".
       77 DataSet1-impforn-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-impforn-KEY-Asc  VALUE "A".
          88 DataSet1-impforn-KEY-Desc VALUE "D".
       77 DataSet1-progmag-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-progmag-LOCK  VALUE "Y".
       77 DataSet1-progmag-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-progmag-KEY-Asc  VALUE "A".
          88 DataSet1-progmag-KEY-Desc VALUE "D".
       77 DataSet1-distinteb-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-distinteb-LOCK  VALUE "Y".
       77 DataSet1-distinteb-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-distinteb-KEY-Asc  VALUE "A".
          88 DataSet1-distinteb-KEY-Desc VALUE "D".
       77 DataSet1-timposte-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-timposte-LOCK  VALUE "Y".
       77 DataSet1-timposte-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-timposte-KEY-Asc  VALUE "A".
          88 DataSet1-timposte-KEY-Desc VALUE "D".
       77 DataSet1-tpiombo-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tpiombo-LOCK  VALUE "Y".
       77 DataSet1-tpiombo-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tpiombo-KEY-Asc  VALUE "A".
          88 DataSet1-tpiombo-KEY-Desc VALUE "D".
       77 DataSet1-tparamge-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tparamge-LOCK  VALUE "Y".
       77 DataSet1-tparamge-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tparamge-KEY-Asc  VALUE "A".
          88 DataSet1-tparamge-KEY-Desc VALUE "D".
       77 DataSet1-tmp-nlistini-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tmp-nlistini-LOCK  VALUE "Y".
       77 DataSet1-tmp-nlistini-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tmp-nlistini-KEY-Asc  VALUE "A".
          88 DataSet1-tmp-nlistini-KEY-Desc VALUE "D".
       77 DataSet1-nlistini-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-nlistini-LOCK  VALUE "Y".
       77 DataSet1-nlistini-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-nlistini-KEY-Asc  VALUE "A".
          88 DataSet1-nlistini-KEY-Desc VALUE "D".
       77 DataSet1-nforn-dest-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-nforn-dest-LOCK  VALUE "Y".
       77 DataSet1-nforn-dest-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-nforn-dest-KEY-Asc  VALUE "A".
          88 DataSet1-nforn-dest-KEY-Desc VALUE "D".
       77 DataSet1-catart-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-catart-LOCK  VALUE "Y".
       77 DataSet1-catart-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-catart-KEY-Asc  VALUE "A".
          88 DataSet1-catart-KEY-Desc VALUE "D".
       77 DataSet1-param-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-param-LOCK  VALUE "Y".
       77 DataSet1-param-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-param-KEY-Asc  VALUE "A".
          88 DataSet1-param-KEY-Desc VALUE "D".
       77 DataSet1-tscorte-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tscorte-LOCK  VALUE "Y".
       77 DataSet1-tscorte-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tscorte-KEY-Asc  VALUE "A".
          88 DataSet1-tscorte-KEY-Desc VALUE "D".

       77 articoli-art-k1-SPLITBUF  PIC X(51).
       77 articoli-art-k-frn-SPLITBUF  PIC X(16).
       77 rlistini-rlis-k-art-SPLITBUF  PIC X(33).
       77 rlistini-rlis-k-descr-SPLITBUF  PIC X(66).
       77 clienti-cli-K1-SPLITBUF  PIC X(47).
       77 clienti-cli-K3-SPLITBUF  PIC X(12).
       77 clienti-cli-K4-SPLITBUF  PIC X(8).
       77 destinif-K1-SPLITBUF  PIC X(51).
       77 destinif-desf-k2-SPLITBUF  PIC X(51).
       77 progmag-key01-SPLITBUF  PIC X(21).
       77 distinteb-k-articolo-SPLITBUF  PIC X(12).
       77 distinteb-k-progmag-SPLITBUF  PIC X(21).
       77 catart-cat-art-princ-SPLITBUF  PIC X(13).

           copy "link-stlistini.def".
           copy "link-contr-dt-list.def".
           copy "copia-listino.lks".

       77  como-prz-acq      PIC  9(8)v9999.
       77  como-netto        PIC  9(8)v9999.
       77  como-sconto-1     PIC  9(3)v99.
       77  como-sconto-2     PIC  9(3)v99.
       77  como-sconto-3     PIC  9(3)v99.
       77  como-sconto-4     PIC  9(3)v99.
       77  como-sconto-5     PIC  9(3)v99.
       77  como-perce-pb     PIC  9(3)v99.
       77  como-costi-agg    PIC  9(8)v9999.
       77  como-perce-agg    PIC  9(3)v99.
       77  como-disp         PIC  9(9).
       77  como-lead-time    PIC  9(3).

       78  78-col-art        value 1. 
       78  78-col-des        value 2. 
       78  78-col-art-forn   value 3. 
       78  78-col-prz-acq    value 4. 
       78  78-col-sconto-1   value 5. 
       78  78-col-netto      value 6.
       78  78-col-sconto-2   value 7. 
       78  78-col-sconto-3   value 8. 
       78  78-col-sconto-4   value 9. 
       78  78-col-sconto-5   value 10. 
       78  78-col-costi-agg  value 11.
       78  78-col-perce-agg  value 12. 
       78  78-col-piombo     value 13.
       78  78-col-disp       value 14. 
       78  78-col-lead-time  value 15.
       78  78-col-tipo-imp   value 16. 
       78  78-col-des-imp    value 17.
       78  78-col-PFA        value 18.
       78  78-col-prz-tot    value 19.
       78  78-col-prz-conf   value 20.

       78  78-max-colonne    value 20.

       77  como-riga         pic 9(4).

       77  como-art-forn     pic x(20).

       01                    pic 9.
           88 controllo-finale  value 1 false zero.

       01                 pic 9.
           88 s-excell    value 1.
           88 s-stampa    value 2.
           88 s-anteprima value 3.

       77  messaggio      pic x(200).  
       77  num-copia      pic 9.

       77  como-stringa   pic x(20).


       01                 pic 9.
           88 ord-descr   value 1.
           88 ord-cod     value 2.

       77  BitmapNumGridElimina pic 9.

       01 old-tlis-rec.
           05 old-tlis-chiave.
               10 old-tlis-codice      PIC  9(15).
           05 old-tlis-dati.
               10 old-tlis-chiave-ricerca.
                   15 old-tlis-fornitore   PIC  9(5).
                   15 old-tlis-destino     PIC  9(5).
                   15 old-tlis-ini-val     PIC  9(8).
                   15 old-tlis-fine-val    PIC  9(8).
               10 old-tlis-descrizione        PIC  x(50).
               10 old-tlis-dati-comuni.
                   15 old-tlis-data-creazione          PIC  9(8).
                   15 old-tlis-ora-creazione           PIC  9(8).
                   15 old-tlis-utente-creazione        PIC  X(10).
                   15 old-tlis-data-ultima-modifica    PIC  9(8).
                   15 old-tlis-ora-ultima-modifica     PIC  9(8).
                   15 old-tlis-utente-ultima-modifica  PIC  X(10).
               10 old-tlis-vuoti.
                   15 old-tlis-trasp-f      PIC  9.
                       88 old-tlis-trasp-f-incluso VALUE 1 FALSE  0. 
                       88 old-tlis-trasp-f-escluso VALUE 0 FALSE  1. 
                   15 old-tlis-trasp-c        PIC  9.
                       88 old-tlis-trasp-c-incluso VALUE 1 FALSE  0. 
                       88 old-tlis-trasp-c-escluso VALUE 0 FALSE  1. 
                   15 old-tlis-num-vuoto-1 PIC  9(16).
                   15 old-tlis-num-vuoto-2 PIC  9(18).
                   15 old-tlis-num-vuoto-3 PIC  9(18).
                   15 old-tlis-alfa-vuoto-1            PIC  X(20).
                   15 old-tlis-alfa-vuoto-2            PIC  X(20).
                   15 old-tlis-alfa-vuoto-3            PIC  X(20).

       01 OLD-rlis-rec.
           05 OLD-rlis-chiave.
               10 OLD-rlis-codice      PIC  9(15).
               10 OLD-rlis-articolo    PIC  9(6).
           05 OLD-rlis-dati.
               10 OLD-rlis-art-forn    PIC  x(20).
               10 OLD-rlis-chiave-ricerca.
                   15 OLD-rlis-fornitore   PIC  9(5).
                   15 OLD-rlis-destino     PIC  9(5).
                   15 OLD-rlis-ini-val     PIC  9(8).
                   15 OLD-rlis-fine-val    PIC  9(8).
               10 OLD-rlis-prz-acq     PIC  9(9)v9(4).
               10 OLD-rlis-des-libera  PIC  x(50).
               10 OLD-rlis-sconto-1    PIC  9(3)v9(2).
               10 OLD-rlis-sconto-2    PIC  9(3)v9(2).
               10 OLD-rlis-sconto-3    PIC  9(3)v9(2).
               10 OLD-rlis-sconto-4    PIC  9(3)v9(2).
               10 OLD-rlis-sconto-5    PIC  9(3)v9(2).
               10 OLD-rlis-costi-agg   PIC  9(9)v9(4).
               10 OLD-rlis-disponibilita           PIC  9(9).
               10 OLD-rlis-lead-time   PIC  9(3).
               10 OLD-rlis-perce-pb    PIC  9(3)v9(4).
               10 OLD-rlis-netto       PIC  9(8)v9(4).
               10 OLD-rlis-tipo-tratt-imposte      PIC  9(5).
               10 OLD-rlis-perce-agg   PIC  9(3)v9999.
               10 OLD-rlis-prz-confronto           PIC  9(6)v9999.
               10 OLD-rlis-prz-reale   PIC  9(6)v9999.
               10 OLD-rlis-costi-agg-tot           PIC  9(6)v9999.
               10 OLD-rlis-scelta      PIC  9(6)v9999.
               10 OLD-rlis-sconti-zero PIC  9(1).
                   88 OLD-rlis-sconti-zero-si VALUE IS 1. 
                   88 OLD-rlis-sconti-zero-no VALUE IS 0. 
               10 OLD-rlis-dati-comuni.
                   15 OLD-rlis-data-creazione          PIC  9(8).
                   15 OLD-rlis-ora-creazione           PIC  9(8).
                   15 OLD-rlis-utente-creazione        PIC  X(10).
                   15 OLD-rlis-data-modifica           PIC  9(8).
                   15 OLD-rlis-ora-modifica            PIC  9(8).
                   15 OLD-rlis-utente-modifica         PIC  X(10).
               10 OLD-rlis-vuoti.
                   15 OLD-rlis-num-vuoto-1 PIC  9(18).
                   15 OLD-rlis-num-vuoto-2 PIC  9(18).
                   15 OLD-rlis-num-vuoto-3 PIC  9(18).
                   15 OLD-rlis-PFA         PIC  x.
                       88 OLD-rlis-PFA-si VALUE IS "S". 
                       88 OLD-rlis-PFA-no VALUE IS "N". 
                   15 OLD-rlis-alfa-vuoto-1            PIC  x(29).
                   15 OLD-rlis-alfa-vuoto-2            PIC  x(30).
                   15 OLD-rlis-alfa-vuoto-3            PIC  x(30).


       77  como-old-rlis-articolo  pic 9(6).

       77  como-old-forn  pic 9(5).
       77  como-old-dest  pic 9(5).

       77  COUNTCHAR      pic 9(3).
       77  codice-ed      pic z(15).
      *{TOTEM}END

      *{TOTEM}ID-LOGICI
      ***** Elenco ID Logici *****
       78  78-ID-ef-codice VALUE 5001.
       78  78-ID-ef-forn VALUE 5002.
       78  78-ID-ef-destino VALUE 5003.
       78  78-ID-ef-note VALUE 5004.
       78  78-ID-ef-ini-val VALUE 5005.
       78  78-ID-ef-fine-val VALUE 5006.
       78  78-ID-gd1 VALUE 5007.
       78  78-ID-EF-cli-copia VALUE 5001.
      ***** Fine ID Logici *****
      *{TOTEM}END

       LINKAGE          SECTION.
      *{TOTEM}LINKAGE
           COPY  "COMMON-LINKAGE.DEF".
       77 link-codice-volantino        PIC  9(15).

      *{TOTEM}END

       SCREEN           SECTION.
      *{TOTEM}COPY-SCREEN
      * FORM
       01 
           Form1, 
           AFTER PROCEDURE Form1-AfterProcedure,
           BEFORE PROCEDURE Form1-BeforeProcedure,
           .

      * ENTRY FIELD
       05
           ef-codice, 
           Entry-Field, 
           COL 17,00, 
           LINE 2,00,
           LINES 1,31 ,
           SIZE 20,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod-k,
           FONT IS Small-Font,
           ID IS 78-ID-ef-codice,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           LEFT,
           MAX-TEXT 15,
           VALUE ef-codice-BUF,
           .

      * ENTRY FIELD
       05
           ef-forn, 
           Entry-Field, 
           COL 17,00, 
           LINE 6,00,
           LINES 1,31 ,
           SIZE 10,00 ,
           BOXED,
           UPPER,
           COLOR IS 513,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 78-ID-ef-forn,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 5,
           VALUE ef-forn-BUF,
           .

      * ENTRY FIELD
       05
           ef-destino, 
           Entry-Field, 
           COL 17,00, 
           LINE 8,00,
           LINES 1,31 ,
           SIZE 10,00 ,
           BOXED,
           UPPER,
           COLOR IS 513,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 78-ID-ef-destino,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 5,
           VALUE ef-destino-BUF,
           .

      * ENTRY FIELD
       05
           ef-note, 
           Entry-Field, 
           COL 17,00, 
           LINE 10,00,
           LINES 1,31 ,
           SIZE 80,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 78-ID-ef-note,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 50,
           VALUE ef-note-BUF,
           .

      * ENTRY FIELD
       05
           ef-ini-val, 
           Entry-Field, 
           COL 17,00, 
           LINE 12,00,
           LINES 1,31 ,
           SIZE 11,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 78-ID-ef-ini-val,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           MAX-TEXT 10,
           VALUE ef-ini-val-BUF,
           .

      * ENTRY FIELD
       05
           ef-fine-val, 
           Entry-Field, 
           COL 43,33, 
           LINE 12,00,
           LINES 1,31 ,
           SIZE 11,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 78-ID-ef-fine-val,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           MAX-TEXT 10,
           VALUE ef-fine-val-BUF,
           .

      * CHECK BOX
       05
           chk-trasporto-f, 
           Check-Box, 
           COL 73,83, 
           LINE 12,00,
           LINES 1,15 ,
           SIZE 3,00 ,
           ENABLED mod,
           EXCEPTION-VALUE 1004
           FLAT,
           ID IS 2,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           SELF-ACT,
           TITLE "Trasporto incluso",
           VALUE chk-trasporto-f-BUF,
           BEFORE PROCEDURE Screen1-DaCb-1-BeforeProcedure, 
            .

      * CHECK BOX
       05
           chk-trasporto-c, 
           Check-Box, 
           COL 94,67, 
           LINE 12,00,
           LINES 1,15 ,
           SIZE 3,00 ,
           ENABLED mod,
           EXCEPTION-VALUE 1001
           FLAT,
           ID IS 3,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           SELF-ACT,
           TITLE "Trasporto incluso",
           VALUE chk-trasporto-c-BUF,
           BEFORE PROCEDURE Screen1-DaCb-1-BeforeProcedure, 
            .

      * PUSH BUTTON
       05
           pb-note, 
           Push-Button, 
           COL 3,00, 
           LINE 15,60,
           LINES 2,00 ,
           SIZE 13,00 ,
           EXCEPTION-VALUE 1003,
           FONT IS Small-Font,
           ID IS 19,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Note",
           .

      * GRID
       05
           gd1, 
           Grid, 
           COL 2,50, 
           LINE 18,00,
           LINES 23,23 ,
           SIZE 191,33 ,
           ADJUSTABLE-COLUMNS,
           BOXED,
           CENTERED-HEADINGS,
           DATA-COLUMNS (1, 7, 57, 77, 89, 95, 107, 113, 119, 125, 131, 
           143, 149, 155, 164, 167, 172, 222, 223, 235),
           ALIGNMENT ("R", "U", "L", "R", "R", "R", "R", "R", "R", "R", 
           "R", "R", "R", "R", "R", "C", "L", "C", "R", "R"),
           SEPARATION (5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 
           5, 5, 5, 5),
           DATA-TYPES ("z(6)", "x(50)", "x(20)", "9(8)v99", "zz9,99", "9
      -    "(8)v99", "zz9,99", "zz9,99", "zz9,99", "zz9,99", "9(8)v99", 
           "9(6)", "zz9,999", "zzz.zzz.zz9", "zz9", "9(5)", "x(50)", "U(
      -    "1)", "9(12)", "9(12)"),
           NUM-COL-HEADINGS 1,
           COLUMN-HEADINGS,
           CURSOR-FRAME-WIDTH 2,
           DIVIDER-COLOR 1,
           HEADING-COLOR 257,
           HEADING-DIVIDER-COLOR 1,
           ID IS 78-ID-gd1,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TILED-HEADINGS,
           VIRTUAL-WIDTH 188,
           VPADDING 50,
           VSCROLL,
           EVENT PROCEDURE Screen1-Gd-1-Event-Proc,
           .

      * PUSH BUTTON
       05
           pb-grid-elimina, 
           Push-Button, 
           COL 180,67, 
           LINE 15,54,
           LINES 2,15 ,
           SIZE 13,50 ,
           BITMAP-HANDLE STRIP_GRID_GCLIENTI-BMP,
           UNFRAMED,
           SQUARE,
           ENABLED mod,
           EXCEPTION-VALUE 1005,
           FLAT,
           FONT IS Small-Font,
           ID IS 1001,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           SELF-ACT,
           TITLE "&Elimina la riga selezionata",
           VISIBLE 1,
           BITMAP-NUMBER=BitmapNumGridElimina
           AFTER PROCEDURE pb-grid-elimina-AfterProcedure, 
           BEFORE PROCEDURE pb-grid-elimina-BeforeProcedure, 
           .

      * LABEL
       05
           Screen1-La-1, 
           Label, 
           COL 3,00, 
           LINE 2,00,
           LINES 1,31 ,
           SIZE 11,00 ,
           FONT IS Small-Font,
           ID IS 100,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "ID Volantino",
           .

      * BAR
       05
           Screen1-Br-1, 
           Bar,
           COL 1,00, 
           LINE 5,00,
           SIZE 194,50 ,
           ID IS 22,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           COLORS (8, 8),
           SHADING (-1, 1),
           WIDTH 2,
           .

      * DB_LABEL
       05
           lab-nome, 
           Label, 
           COL 38,00, 
           LINE 2,00,
           LINES 1,31 ,
           SIZE 80,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 23,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE lab-nome-BUF,
           TRANSPARENT,
           .

      * LABEL
       05
           Screen1-La-2, 
           Label, 
           COL 3,00, 
           LINE 6,00,
           LINES 1,31 ,
           SIZE 13,00 ,
           FONT IS Small-Font,
           ID IS 24,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Fornitore",
           .

      * LABEL
       05
           Screen1-La-3, 
           Label, 
           COL 3,00, 
           LINE 12,00,
           LINES 1,31 ,
           SIZE 13,00 ,
           FONT IS Small-Font,
           ID IS 7,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Inizio Validità",
           .

      * LABEL
       05
           Screen1-La-4, 
           Label, 
           COL 30,33, 
           LINE 12,00,
           LINES 1,31 ,
           SIZE 12,00 ,
           FONT IS Small-Font,
           ID IS 9,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Fine Validità",
           .

      * LABEL
       05
           Screen1-La-7, 
           Label, 
           COL 3,00, 
           LINE 10,00,
           LINES 1,23 ,
           SIZE 13,00 ,
           FONT IS Small-Font,
           ID IS 13,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Descrizione",
           .

      * LABEL
       05
           lab-forn, 
           Label, 
           COL 28,00, 
           LINE 6,00,
           LINES 1,31 ,
           SIZE 50,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 25,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-forn-buf,
           .

      * LABEL
       05
           Screen1-blockpgm-1, 
           Label, 
           COL 124,83, 
           LINE 2,31,
           LINES 1,23 ,
           SIZE 4,83 ,
           ID IS 10,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "BlockPgm",
           VISIBLE v-custom,
           .

      * LABEL
       05
           Screen1-Custom1-1, 
           Label, 
           COL 132,83, 
           LINE 1,77,
           LINES 2,00 ,
           SIZE 6,67 ,
           ID IS 12,
           TRANSPARENT,
           TITLE "CUSTOM CONTROL",
           VISIBLE v-custom,
           .

      * PUSH BUTTON
       05
           pb-copia, 
           Push-Button, 
           COL 80,00, 
           LINE 7,00,
           LINES 30,00 ,
           SIZE 99,00 ,
           BITMAP-HANDLE COPIA-BMP,
           BITMAP-NUMBER 3,
           UNFRAMED,
           SQUARE,
           ENABLED mod,
           EXCEPTION-VALUE 100,
           FLAT,
           ID IS 1,
           TITLE "Copia da...",
           bitmap-number=num-copia
           AFTER PROCEDURE pb-copia-AfterProcedure, 
           BEFORE PROCEDURE pb-copia-BeforeProcedure, 
           .

      * PUSH BUTTON
       05
           pb-excell, 
           Push-Button, 
           COL 99,00, 
           LINE 7,00,
           LINES 2,69 ,
           SIZE 6,00 ,
           BITMAP-HANDLE EXCEL-BMP,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 1000,
           FLAT,
           FONT IS Small-Font,
           ID IS 15,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           SELF-ACT,
           TITLE "Esporta il Listino in CSV",
           AFTER PROCEDURE pb-excell-AfterProcedure, 
           BEFORE PROCEDURE pb-excell-BeforeProcedure, 
           .

      * LABEL
       05
           Screen1-La-2a, 
           Label, 
           COL 3,00, 
           LINE 8,00,
           LINES 1,31 ,
           SIZE 13,00 ,
           FONT IS Small-Font,
           ID IS 16,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Destino",
           .

      * LABEL
       05
           lab-dest, 
           Label, 
           COL 28,00, 
           LINE 8,00,
           LINES 1,31 ,
           SIZE 50,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 17,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-dest-buf,
           .

      * LABEL
       05
           Screen1-La-4a, 
           Label, 
           COL 57,17, 
           LINE 12,00,
           LINES 1,31 ,
           SIZE 16,00 ,
           FONT IS Small-Font,
           ID IS 18,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Trasporto fornitore",
           .

      * ENTRY FIELD
       05
           ef-note-1, 
           Entry-Field, 
           COL 17,00, 
           LINE 14,00,
           LINES 1,31 ,
           SIZE 80,00 ,
           BOXED,
           COLOR IS 33281,
           ENABLED mod,
           FONT IS Small-Font,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 50,
           VALUE ef-note-1-BUF,
           .

      * ENTRY FIELD
       05
           ef-note-2, 
           Entry-Field, 
           COL 99,00, 
           LINE 14,00,
           LINES 1,31 ,
           SIZE 80,00 ,
           BOXED,
           COLOR IS 33281,
           ENABLED mod,
           FONT IS Small-Font,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 50,
           VALUE ef-note-2-BUF,
           .

      * ENTRY FIELD
       05
           ef-note-3, 
           Entry-Field, 
           COL 17,00, 
           LINE 16,00,
           LINES 1,31 ,
           SIZE 80,00 ,
           BOXED,
           COLOR IS 33281,
           ENABLED mod,
           FONT IS Small-Font,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 50,
           VALUE ef-note-3-BUF,
           .

      * ENTRY FIELD
       05
           ef-note-4, 
           Entry-Field, 
           COL 99,00, 
           LINE 16,00,
           LINES 1,31 ,
           SIZE 80,00 ,
           BOXED,
           COLOR IS 33281,
           ENABLED mod,
           FONT IS Small-Font,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 50,
           VALUE ef-note-4-BUF,
           .

      * LABEL
       05
           Form1-La-11, 
           Label, 
           COL 3,00, 
           LINE 14,00,
           LINES 1,31 ,
           SIZE 17,00 ,
           FONT IS Small-Font,
           ID IS 27,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Note",
           .

      * LABEL
       05
           Screen1-La-1a, 
           Label, 
           COL 3,00, 
           LINE 3,50,
           LINES 1,31 ,
           SIZE 51,00 ,
           FONT IS Small-Font,
           ID IS 28,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "(Inserire il codice del Volantino o la Ragione Sociale
      -    " del fornitore)",
           .

      * LABEL
       05
           Screen1-La-4aa, 
           Label, 
           COL 78,00, 
           LINE 12,00,
           LINES 1,31 ,
           SIZE 16,00 ,
           FONT IS Small-Font,
           ID IS 29,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Trasporto al cliente",
           .

      * TOOLBAR
       01
           Form1-Tb-1,
           .    

      * PUSH BUTTON
       05
           TOOL-ESCI, 
           Push-Button, 
           COL 1,00, 
           LINE 1,15,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           ENABLED E-ESCI,
           EXCEPTION-VALUE 27,
           FLAT,
           ID IS 72,
           SELF-ACT,
           ESCAPE-BUTTON,
           TITLE "Esci (Esc)",
           .

      * PUSH BUTTON
       05
           TOOL-NUOVO, 
           Push-Button, 
           COL 6,00, 
           LINE 1,15,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           FRAMED,
           SQUARE,
           ENABLED E-NUOVO,
           EXCEPTION-VALUE 2,
           FLAT,
           ID IS 73,
           SELF-ACT,
           TITLE "Nuovo (F2)",
           BITMAP-NUMBER BitmapNumNew
           .

      * PUSH BUTTON
       05
           TOOL-CANCELLA, 
           Push-Button, 
           COL 16,00, 
           LINE 1,15,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           FRAMED,
           SQUARE,
           ENABLED E-CANCELLA,
           EXCEPTION-VALUE 4,
           FLAT,
           ID IS 74,
           SELF-ACT,
           TITLE "Cancella (F4)",
           BITMAP-NUMBER BitmapNumDelete
           .

      * PUSH BUTTON
       05
           TOOL-SALVA, 
           Push-Button, 
           COL 11,00, 
           LINE 1,15,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           FRAMED,
           SQUARE,
           ENABLED E-SALVA,
           EXCEPTION-VALUE 3,
           FLAT,
           ID IS 75,
           SELF-ACT,
           TITLE "Salva (F3)",
           BITMAP-NUMBER BitmapNumSave
           .

      * PUSH BUTTON
       05
           TOOL-ANTEPRIMA, 
           Push-Button, 
           COL 26,00, 
           LINE 1,15,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           FRAMED,
           SQUARE,
           ENABLED E-ANTEPRIMA,
           EXCEPTION-VALUE 6,
           FLAT,
           ID IS 76,
           SELF-ACT,
           TITLE "Anteprima (F6)",
           BITMAP-NUMBER BitmapNumPreview
           .

      * CHECK BOX
       05
           TOOL-MODIFICA, 
           Check-Box, 
           COL 21,00, 
           LINE 1,15,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 5,
           FRAMED,
           SQUARE,
           ENABLED E-MODIFICA,
           EXCEPTION-VALUE 150
           FLAT,
           ID IS 77,
           SELF-ACT,
           TITLE "Modifica (F5)",
           VALUE MOD,
           BITMAP-NUMBER BitmapNumEdit
           AFTER PROCEDURE TOOL-MODIFICA-AfterProcedure,
           BEFORE PROCEDURE TOOL-MODIFICA-BeforeProcedure, 
           .
      * PUSH BUTTON
       05
           TOOL-STAMPA, 
           Push-Button, 
           COL 31,00, 
           LINE 1,15,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           FRAMED,
           SQUARE,
           ENABLED E-STAMPA,
           EXCEPTION-VALUE 7,
           FLAT,
           ID IS 110,
           SELF-ACT,
           TITLE "Stampa (F7)",
           BITMAP-NUMBER BitmapNumPrint
           .

      * PUSH BUTTON
       05
           TOOL-CERCA, 
           Push-Button, 
           COL 36,00, 
           LINE 1,15,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           FRAMED,
           SQUARE,
           ENABLED E-CERCA,
           EXCEPTION-VALUE 8,
           FLAT,
           ID IS 111,
           SELF-ACT,
           TITLE "Cerca (F8)",
           BITMAP-NUMBER BitmapNumZoom
           .

      * PUSH BUTTON
       05
           TOOL-SELEZIONA, 
           Push-Button, 
           COL 41,00, 
           LINE 1,15,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 9,
           FRAMED,
           SQUARE,
           ENABLED E-SELEZIONA,
           EXCEPTION-VALUE 9,
           FLAT,
           ID IS 112,
           SELF-ACT,
           TITLE "Seleziona (F9)",
           .

      * PUSH BUTTON
       05
           Form1-Pb-1a, 
           Push-Button, 
           COL 46,00, 
           LINE 1,15,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 10,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 1002,
           FLAT,
           ID IS 113,
           SELF-ACT,
           TITLE "&Primo",
           .

      * PUSH BUTTON
       05
           Form1-Pb-1b, 
           Push-Button, 
           COL 51,00, 
           LINE 1,15,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 11,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 67,
           FLAT,
           ID IS 114,
           SELF-ACT,
           TITLE "Precedente (PgDn)",
           .

      * PUSH BUTTON
       05
           Form1-Pb-1c, 
           Push-Button, 
           COL 56,00, 
           LINE 1,15,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 12,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 68,
           FLAT,
           ID IS 115,
           SELF-ACT,
           TITLE "Successivo (PgUp)",
           .

      * PUSH BUTTON
       05
           Form1-Pb-1d, 
           Push-Button, 
           COL 61,00, 
           LINE 1,15,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 13,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 1006,
           FLAT,
           ID IS 116,
           SELF-ACT,
           TITLE "&Ultimo",
           .

      * FORM
       01 
           form-copia, 
           AFTER PROCEDURE  form-copia-AFTER-SCREEN
           BEFORE PROCEDURE  form-copia-BEFORE-SCREEN
           .

      * ENTRY FIELD
       05
           EF-cli-copia, 
           Entry-Field, 
           COL 10,00, 
           LINE 2,00,
           LINES 1,38 ,
           SIZE 12,00 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-EF-cli-copia,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           PIC z(15),
           MAX-TEXT 10,
           NUMERIC,
           VALUE cli-copia,
           AFTER PROCEDURE EF-ordine-FROM-AfterProcedure, 
           BEFORE PROCEDURE EF-ordine-FROM-BeforeProcedure, 
           .


      * LABEL
       05
           Screen3-La-1ac, 
           Label, 
           COL 2,00, 
           LINE 2,00,
           LINES 1,15 ,
           SIZE 7,00 ,
           ID IS 5,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE "Listino",
           .

      * FRAME
       05
           Screen4-Fr-1, 
           Frame, 
           COL 1,00, 
           LINE 4,00,
           LINES 2,89 ,
           SIZE 50,00 ,
           LOWERED,
           ID IS 23,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           .

      * PUSH BUTTON
       05
           pb-ok, 
           Push-Button, 
           COL 34,60, 
           LINE 4,61,
           LINES 30,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE BOTTONE-OK-BMP,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 1000,
           FLAT,
           ID IS 200,
           AFTER PROCEDURE pb-ok-AfterProcedure, 
           BEFORE PROCEDURE pb-ok-BeforeProcedure, 
           .

      * PUSH BUTTON
       05
           pb-annulla, 
           Push-Button, 
           COL 42,50, 
           LINE 4,67,
           LINES 30,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE BOTTONE-annulla-BMP,
           BITMAP-NUMBER 1,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 27,
           FLAT,
           ID IS 201,
           SELF-ACT,
           ESCAPE-BUTTON,
           AFTER PROCEDURE pb-annulla-AfterProcedure, 
           BEFORE PROCEDURE pb-annulla-BeforeProcedure, 
           .

      * LABEL
       05
           lbl-cli-copia, 
           Label, 
           COL 23,00, 
           LINE 2,00,
           LINES 2,11 ,
           SIZE 27,00 ,
           COLOR IS 5,
           ID IS 67,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lbl-cli-copia-buf,
           .

      * TOOLBAR
       01
           Form1-Tb-1a,
           .    

      * PUSH BUTTON
       05
           TOOL-ESCIa, 
           Push-Button, 
           COL 1,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           ENABLED E-ESCI,
           EXCEPTION-VALUE 27,
           FLAT,
           ID IS 111,
           SELF-ACT,
           ESCAPE-BUTTON,
           TITLE "Esci (Esc)",
           .

      * PUSH BUTTON
       05
           TOOL-CERCAa, 
           Push-Button, 
           COL 6,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE toolbar-bmp,
           BITMAP-NUMBER 8,
           FRAMED,
           SQUARE,
           EXCEPTION-VALUE 1001,
           FLAT,
           ID IS 120,
           SELF-ACT,
           TITLE "Cerca (F8)",
           .

      *{TOTEM}END

      *{TOTEM}LINKPARA
       PROCEDURE  DIVISION USING LK-BLOCKPGM, USER-CODI, LIVELLO-ABIL, 
           link-codice-volantino.
      *{TOTEM}END

      *{TOTEM}DECLARATIVE
       DECLARATIVES.
      * <TOTEM:EPT. INIT:glistini, INIT:glistini, BeforeDeclarative>
       tlistini-ERROR SECTION.
           use after error procedure on tlistini.
           set RecLocked to false.
           evaluate status-tlistini
           when "35"
                display message "File [tlistini] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [tlistini] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[tlistini] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           when "99"
           when "93"
                set RecLocked to true
                set errori    to true
                move 0 to mod
                modify tool-modifica, value = mod
                move 1 to mod-k
                display form1
                set StatusVisua to true
                perform STATUS-BAR-MSG
                move "00" to status-tlistini
                if ReadSecca
                   read tlistini       no lock 
                        invalid      continue
                        not invalid  perform FORM1-IUD-DISPLAY
                   end-read
                end-if
                display message box MSG-Record-gia-in-uso
                        title = tit-err
                        icon is mb-error-icon
           when "23"
                move 1 to mod-k
                move 0 to mod
                modify tool-modifica, value = mod
                set StatusVisua to true
                perform STATUS-BAR-MSG 
                if nuovo              
                   initialize tlis-dati of tlistini
                              replacing numeric data by zeroes
                                   alphanumeric data by spaces
                   perform FORM1-FLD-TO-BUF
                   display form1-tb-1
                   set vecchio to true
                end-if      
                perform ABILITAZIONI
                display form1
                |RISETTO IL VALORE A "23" PERCHE DENTRO AL PAR. CLEAR-SCREEN
                |CON L'OPERAZIONE UNLOCK VIENE RISETTATO A ZERO COSICCHÈ 
                |QUANDO TORNA DENTRO AI PAR. DI SCORRIMENTO DI TOTEM SI 
                |TROVA IN UNA SITUAZIONE CORRETTA E PROSEGUE CON LA READ
                |USCENDO CON UN MESSAGGIO DI ERRORE DI TIPO "46"
                move "23" to status-tlistini
           end-evaluate.
 
      ***---
       rlistini-ERR SECTION.
           use after error procedure on rlistini.
           set tutto-ok  to true.
           evaluate status-rlistini
           when "35"
                display message "File [rlistini] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [rlistini] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[rlistini] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       CLIENTI-ERR SECTION.
           use after error procedure on clienti.
           set tutto-ok  to true.
           evaluate status-clienti
           when "35"
                display message "File [CLIENTI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [CLIENTI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[CLIENTI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       DESTINIF-ERR SECTION.
           use after error procedure on DESTINIF.
           set tutto-ok  to true.
           evaluate status-DESTINIF
           when "35"
                display message "File [DESTINIF] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [DESTINIF] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[DESTINIF] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       ARTICOLI-ERR SECTION.
           use after error procedure on articoli.
           set tutto-ok  to true.
           evaluate status-articoli
           when "35"
                display message "File [ARTICOLI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [ARTICOLI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[ARTICOLI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       IMPFORN-ERR SECTION.
           use after error procedure on impforn.
           set tutto-ok  to true.
           evaluate status-impforn
           when "35"
                display message "File [IMPFORN] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [IMPFORN] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[IMPFORN] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.

      * <TOTEM:END>
       INPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON INPUT.
       0100-DECL.
           EXIT.
       I-O-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON I-O.
       0200-DECL.
           EXIT.
       OUTPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON OUTPUT.
       0300-DECL.
           EXIT.
       TRANSACTION-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON TRANSACTION.
       0400-DECL.
           EXIT.
       END DECLARATIVES.
      *{TOTEM}END

       MAIN-LOGIC.
      *{TOTEM}ENTRY-BEFPRG
      *    Before-Program
           PERFORM ginqui-Ev-Before-Program
      *{TOTEM}END
           PERFORM INITIALIZE-ROUTINE.
      * run main screen
      *{TOTEM}RUN-MAINSCR
           PERFORM Form1-OPEN-ROUTINE.
      *{TOTEM}END

      *{TOTEM}COPY-PROCEDURE
       EXIT-STOP-ROUTINE.
           PERFORM CLOSE-FILE-RTN
      * <TOTEM:EPT. INIT:glistini, INIT:glistini, BeforeDestroyResource>
      * <TOTEM:END>
           DESTROY Verdana12-Occidentale
           CALL "w$bitmap" USING WBITMAP-DESTROY, 
           STRIP_GRID_GCLIENTI-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, COPIA-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, EXCEL-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, toolbar-bmp
           CALL "w$bitmap" USING WBITMAP-DESTROY, BOTTONE-OK-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, BOTTONE-annulla-BMP
      *    After-Program
           PERFORM ginqui-Ev-After-Program
           EXIT PROGRAM TOTEM-PgmStatus
           STOP RUN.

       INITIALIZE-ROUTINE.
      *    Before Init
      * initialize program status variable
           Initialize TOTEM-PgmStatus.
      * get system information
           ACCEPT SYSTEM-INFORMATION FROM SYSTEM-INFO.
      * get terminal information
           ACCEPT TERMINAL-ABILITIES FROM TERMINAL-INFO.
      * set font
           PERFORM INIT-FONT.
      * load bitmap
           PERFORM INIT-BMP.
      * load resource
           PERFORM INIT-RES.
      * create pop-up menu
           PERFORM INIT-POPUP.
      * open files
           PERFORM OPEN-FILE-RTN.
      *    After Init
           .
    
       INIT-FONT.
      * Verdana12-Occidentale
           INITIALIZE WFONT-DATA Verdana12-Occidentale
           MOVE 12 TO WFONT-SIZE
           MOVE "Verdana" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO FALSE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Verdana12-Occidentale, WFONT-DATA
           .

       INIT-BMP.
      * pb-grid-elimina
           COPY RESOURCE "STRIP_GRID_GCLIENTI.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "STRIP_GRID_GCLIENTI.BMP"
           , 
                   GIVING STRIP_GRID_GCLIENTI-BMP.
      * pb-copia
           COPY RESOURCE "COPIA.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "COPIA.BMP", 
                   GIVING COPIA-BMP.
      * pb-excell
           COPY RESOURCE "EXCEL.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "EXCEL.BMP", 
                   GIVING EXCEL-BMP.
      * TOOL-ESCI
           COPY RESOURCE "toolbar.bmp".
           CALL "w$bitmap" USING WBITMAP-LOAD "toolbar.bmp", 
                   GIVING toolbar-bmp.
      * pb-ok
           COPY RESOURCE "BOTTONE-OK.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "BOTTONE-OK.BMP", 
                   GIVING BOTTONE-OK-BMP.
      * pb-annulla
           COPY RESOURCE "BOTTONE-annulla.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "BOTTONE-annulla.BMP", 
                   GIVING BOTTONE-annulla-BMP.
           .

       INIT-RES.
           .

       INIT-POPUP.
           .

       OPEN-FILE-RTN.
      *    Before Open
           PERFORM OPEN-articoli
           PERFORM OPEN-rlistini
           PERFORM OPEN-tlistini
           PERFORM OPEN-clienti
           PERFORM OPEN-tlistini1
           PERFORM OPEN-destinif
           PERFORM OPEN-impforn
           PERFORM OPEN-progmag
           PERFORM OPEN-distinteb
           PERFORM OPEN-timposte
           PERFORM OPEN-tpiombo
           PERFORM OPEN-tparamge
           PERFORM OPEN-tmp-nlistini
           PERFORM OPEN-nlistini
           PERFORM OPEN-nforn-dest
           PERFORM OPEN-catart
           PERFORM OPEN-param
           PERFORM OPEN-tscorte
      *    After Open
           .

       OPEN-articoli.
      * <TOTEM:EPT. INIT:glistini, FD:articoli, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT articoli
           IF NOT Valid-STATUS-articoli
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:glistini, FD:articoli, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-rlistini.
      * <TOTEM:EPT. INIT:glistini, FD:rlistini, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O rlistini
           IF STATUS-rlistini = "35"
              OPEN OUTPUT rlistini
                IF Valid-STATUS-rlistini
                   CLOSE rlistini
                   OPEN I-O rlistini
                END-IF
           END-IF
           IF NOT Valid-STATUS-rlistini
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:glistini, FD:rlistini, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tlistini.
      * <TOTEM:EPT. INIT:glistini, FD:tlistini, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O tlistini
           IF STATUS-tlistini = "35"
              OPEN OUTPUT tlistini
                IF Valid-STATUS-tlistini
                   CLOSE tlistini
                   OPEN I-O tlistini
                END-IF
           END-IF
           IF NOT Valid-STATUS-tlistini
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:glistini, FD:tlistini, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-clienti.
      * <TOTEM:EPT. INIT:glistini, FD:clienti, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT clienti
           IF NOT Valid-STATUS-clienti
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:glistini, FD:clienti, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tlistini1.
      * <TOTEM:EPT. INIT:glistini, FD:tlistini1, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tlistini1
           IF NOT VALID-STATUS-tlistini1
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:glistini, FD:tlistini1, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-destinif.
      * <TOTEM:EPT. INIT:glistini, FD:destinif, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT destinif
           IF NOT Valid-STATUS-destinif
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:glistini, FD:destinif, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-impforn.
      * <TOTEM:EPT. INIT:glistini, FD:impforn, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT impforn
           IF NOT Valid-STATUS-impforn
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:glistini, FD:impforn, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-progmag.
      * <TOTEM:EPT. INIT:glistini, FD:progmag, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT progmag
           IF NOT Valid-STATUS-progmag
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:glistini, FD:progmag, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-distinteb.
      * <TOTEM:EPT. INIT:glistini, FD:distinteb, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT distinteb
           IF NOT Valid-STATUS-distinteb
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:glistini, FD:distinteb, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-timposte.
      * <TOTEM:EPT. INIT:glistini, FD:timposte, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT timposte
           IF NOT Valid-STATUS-timposte
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:glistini, FD:timposte, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tpiombo.
      * <TOTEM:EPT. INIT:glistini, FD:tpiombo, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tpiombo
           IF NOT Valid-STATUS-tpiombo
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:glistini, FD:tpiombo, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tparamge.
      * <TOTEM:EPT. INIT:glistini, FD:tparamge, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tparamge
           IF NOT Valid-STATUS-tparamge
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:glistini, FD:tparamge, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tmp-nlistini.
      * <TOTEM:EPT. INIT:glistini, FD:tmp-nlistini, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O tmp-nlistini
           IF STATUS-tmp-nlistini = "35"
              OPEN OUTPUT tmp-nlistini
                IF Valid-STATUS-tmp-nlistini
                   CLOSE tmp-nlistini
                   OPEN I-O tmp-nlistini
                END-IF
           END-IF
           IF NOT Valid-STATUS-tmp-nlistini
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:glistini, FD:tmp-nlistini, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-nlistini.
      * <TOTEM:EPT. INIT:glistini, FD:nlistini, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O nlistini
           IF STATUS-nlistini = "35"
              OPEN OUTPUT nlistini
                IF Valid-STATUS-nlistini
                   CLOSE nlistini
                   OPEN I-O nlistini
                END-IF
           END-IF
           IF NOT Valid-STATUS-nlistini
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:glistini, FD:nlistini, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-nforn-dest.
      * <TOTEM:EPT. INIT:glistini, FD:nforn-dest, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT nforn-dest
           IF NOT Valid-STATUS-nforn-dest
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:glistini, FD:nforn-dest, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-catart.
      * <TOTEM:EPT. INIT:glistini, FD:catart, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT catart
           IF NOT Valid-status-catart
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:glistini, FD:catart, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-param.
      * <TOTEM:EPT. INIT:glistini, FD:param, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT param
           IF NOT Valid-STATUS-param
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:glistini, FD:param, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tscorte.
      * <TOTEM:EPT. INIT:glistini, FD:tscorte, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tscorte
           IF NOT Valid-STATUS-tscorte
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:glistini, FD:tscorte, AfterOpen>
      * <TOTEM:END>
           .

       CLOSE-FILE-RTN.
      *    Before Close
           PERFORM CLOSE-articoli
           PERFORM CLOSE-rlistini
           PERFORM CLOSE-tlistini
           PERFORM CLOSE-clienti
           PERFORM CLOSE-tlistini1
           PERFORM CLOSE-destinif
           PERFORM CLOSE-impforn
           PERFORM CLOSE-progmag
           PERFORM CLOSE-distinteb
           PERFORM CLOSE-timposte
           PERFORM CLOSE-tpiombo
           PERFORM CLOSE-tparamge
           PERFORM CLOSE-tmp-nlistini
           PERFORM CLOSE-nlistini
           PERFORM CLOSE-nforn-dest
           PERFORM CLOSE-catart
           PERFORM CLOSE-param
           PERFORM CLOSE-tscorte
      *    After Close
           .

       CLOSE-articoli.
      * <TOTEM:EPT. INIT:glistini, FD:articoli, BeforeClose>
      * <TOTEM:END>
           CLOSE articoli
           .

       CLOSE-rlistini.
      * <TOTEM:EPT. INIT:glistini, FD:rlistini, BeforeClose>
      * <TOTEM:END>
           CLOSE rlistini
           .

       CLOSE-tlistini.
      * <TOTEM:EPT. INIT:glistini, FD:tlistini, BeforeClose>
      * <TOTEM:END>
           CLOSE tlistini
           .

       CLOSE-clienti.
      * <TOTEM:EPT. INIT:glistini, FD:clienti, BeforeClose>
      * <TOTEM:END>
           CLOSE clienti
           .

       CLOSE-tlistini1.
      * <TOTEM:EPT. INIT:glistini, FD:tlistini1, BeforeClose>
      * <TOTEM:END>
           CLOSE tlistini1
           .

       CLOSE-destinif.
      * <TOTEM:EPT. INIT:glistini, FD:destinif, BeforeClose>
      * <TOTEM:END>
           CLOSE destinif
           .

       CLOSE-impforn.
      * <TOTEM:EPT. INIT:glistini, FD:impforn, BeforeClose>
      * <TOTEM:END>
           CLOSE impforn
           .

       CLOSE-progmag.
      * <TOTEM:EPT. INIT:glistini, FD:progmag, BeforeClose>
      * <TOTEM:END>
           CLOSE progmag
           .

       CLOSE-distinteb.
      * <TOTEM:EPT. INIT:glistini, FD:distinteb, BeforeClose>
      * <TOTEM:END>
           CLOSE distinteb
           .

       CLOSE-timposte.
      * <TOTEM:EPT. INIT:glistini, FD:timposte, BeforeClose>
      * <TOTEM:END>
           CLOSE timposte
           .

       CLOSE-tpiombo.
      * <TOTEM:EPT. INIT:glistini, FD:tpiombo, BeforeClose>
      * <TOTEM:END>
           CLOSE tpiombo
           .

       CLOSE-tparamge.
      * <TOTEM:EPT. INIT:glistini, FD:tparamge, BeforeClose>
      * <TOTEM:END>
           CLOSE tparamge
           .

       CLOSE-tmp-nlistini.
      * <TOTEM:EPT. INIT:glistini, FD:tmp-nlistini, BeforeClose>
      * <TOTEM:END>
           CLOSE tmp-nlistini
           .

       CLOSE-nlistini.
      * <TOTEM:EPT. INIT:glistini, FD:nlistini, BeforeClose>
      * <TOTEM:END>
           CLOSE nlistini
           .

       CLOSE-nforn-dest.
      * <TOTEM:EPT. INIT:glistini, FD:nforn-dest, BeforeClose>
      * <TOTEM:END>
           CLOSE nforn-dest
           .

       CLOSE-catart.
      * <TOTEM:EPT. INIT:glistini, FD:catart, BeforeClose>
      * <TOTEM:END>
           CLOSE catart
           .

       CLOSE-param.
      * <TOTEM:EPT. INIT:glistini, FD:param, BeforeClose>
      * <TOTEM:END>
           CLOSE param
           .

       CLOSE-tscorte.
      * <TOTEM:EPT. INIT:glistini, FD:tscorte, BeforeClose>
      * <TOTEM:END>
           CLOSE tscorte
           .

       articoli-art-k1-MERGE-SPLITBUF.
           INITIALIZE articoli-art-k1-SPLITBUF
           MOVE art-descrizione OF articoli(1:50) TO 
           articoli-art-k1-SPLITBUF(1:50)
           .

       articoli-art-k-frn-MERGE-SPLITBUF.
           INITIALIZE articoli-art-k-frn-SPLITBUF
           MOVE art-cod-art-frn OF articoli(1:15) TO 
           articoli-art-k-frn-SPLITBUF(1:15)
           .

       DataSet1-articoli-INITSTART.
           IF DataSet1-articoli-KEY-Asc
              MOVE Low-Value TO art-chiave OF articoli
           ELSE
              MOVE High-Value TO art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-INITEND.
           IF DataSet1-articoli-KEY-Asc
              MOVE High-Value TO art-chiave OF articoli
           ELSE
              MOVE Low-Value TO art-chiave OF articoli
           END-IF
           .

      * articoli
       DataSet1-articoli-START.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY >= art-chiave OF articoli
           ELSE
              START articoli KEY <= art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-START-NOTGREATER.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY <= art-chiave OF articoli
           ELSE
              START articoli KEY >= art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-START-GREATER.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY > art-chiave OF articoli
           ELSE
              START articoli KEY < art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-START-LESS.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY < art-chiave OF articoli
           ELSE
              START articoli KEY > art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-articoli-LOCK
              READ articoli WITH LOCK 
              KEY art-chiave OF articoli
           ELSE
              READ articoli WITH NO LOCK 
              KEY art-chiave OF articoli
           END-IF
           PERFORM articoli-art-k1-MERGE-SPLITBUF
           PERFORM articoli-art-k-frn-MERGE-SPLITBUF
           MOVE STATUS-articoli TO TOTEM-ERR-STAT 
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-articoli-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-articoli-KEY-Asc
              IF DataSet1-articoli-LOCK
                 READ articoli NEXT WITH LOCK
              ELSE
                 READ articoli NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-articoli-LOCK
                 READ articoli PREVIOUS WITH LOCK
              ELSE
                 READ articoli PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM articoli-art-k1-MERGE-SPLITBUF
           PERFORM articoli-art-k-frn-MERGE-SPLITBUF
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-articoli-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-articoli-KEY-Asc
              IF DataSet1-articoli-LOCK
                 READ articoli PREVIOUS WITH LOCK
              ELSE
                 READ articoli PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-articoli-LOCK
                 READ articoli NEXT WITH LOCK
              ELSE
                 READ articoli NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM articoli-art-k1-MERGE-SPLITBUF
           PERFORM articoli-art-k-frn-MERGE-SPLITBUF
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-articoli-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-articoli-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-articoli-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterDelete>
      * <TOTEM:END>
           .

       rlistini-rlis-k-art-MERGE-SPLITBUF.
           INITIALIZE rlistini-rlis-k-art-SPLITBUF
           MOVE rlis-articolo OF rlistini(1:6) TO 
           rlistini-rlis-k-art-SPLITBUF(1:6)
           MOVE rlis-chiave-ricerca OF rlistini(1:26) TO 
           rlistini-rlis-k-art-SPLITBUF(7:26)
           .

       rlistini-rlis-k-descr-MERGE-SPLITBUF.
           INITIALIZE rlistini-rlis-k-descr-SPLITBUF
           MOVE rlis-codice OF rlistini(1:15) TO 
           rlistini-rlis-k-descr-SPLITBUF(1:15)
           MOVE rlis-des-libera OF rlistini(1:50) TO 
           rlistini-rlis-k-descr-SPLITBUF(16:50)
           .

       DataSet1-rlistini-INITSTART.
           IF DataSet1-rlistini-KEY-Asc
              MOVE Low-Value TO rlis-chiave OF rlistini
           ELSE
              MOVE High-Value TO rlis-chiave OF rlistini
           END-IF
           .

       DataSet1-rlistini-INITEND.
           IF DataSet1-rlistini-KEY-Asc
              MOVE High-Value TO rlis-chiave OF rlistini
           ELSE
              MOVE Low-Value TO rlis-chiave OF rlistini
           END-IF
           .

      * rlistini
       DataSet1-rlistini-START.
           IF DataSet1-rlistini-KEY-Asc
              START rlistini KEY >= rlis-chiave OF rlistini
           ELSE
              START rlistini KEY <= rlis-chiave OF rlistini
           END-IF
           .

       DataSet1-rlistini-START-NOTGREATER.
           IF DataSet1-rlistini-KEY-Asc
              START rlistini KEY <= rlis-chiave OF rlistini
           ELSE
              START rlistini KEY >= rlis-chiave OF rlistini
           END-IF
           .

       DataSet1-rlistini-START-GREATER.
           IF DataSet1-rlistini-KEY-Asc
              START rlistini KEY > rlis-chiave OF rlistini
           ELSE
              START rlistini KEY < rlis-chiave OF rlistini
           END-IF
           .

       DataSet1-rlistini-START-LESS.
           IF DataSet1-rlistini-KEY-Asc
              START rlistini KEY < rlis-chiave OF rlistini
           ELSE
              START rlistini KEY > rlis-chiave OF rlistini
           END-IF
           .

       DataSet1-rlistini-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:rlistini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rlistini, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-rlistini-LOCK
              READ rlistini WITH LOCK 
              KEY rlis-chiave OF rlistini
           ELSE
              READ rlistini WITH NO LOCK 
              KEY rlis-chiave OF rlistini
           END-IF
           PERFORM rlistini-rlis-k-art-MERGE-SPLITBUF
           PERFORM rlistini-rlis-k-descr-MERGE-SPLITBUF
           MOVE STATUS-rlistini TO TOTEM-ERR-STAT 
           MOVE "rlistini" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rlistini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rlistini, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-rlistini-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:rlistini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rlistini, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-rlistini-KEY-Asc
              IF DataSet1-rlistini-LOCK
                 READ rlistini NEXT WITH LOCK
              ELSE
                 READ rlistini NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-rlistini-LOCK
                 READ rlistini PREVIOUS WITH LOCK
              ELSE
                 READ rlistini PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM rlistini-rlis-k-art-MERGE-SPLITBUF
           PERFORM rlistini-rlis-k-descr-MERGE-SPLITBUF
           MOVE STATUS-rlistini TO TOTEM-ERR-STAT
           MOVE "rlistini" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rlistini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rlistini, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-rlistini-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:rlistini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rlistini, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-rlistini-KEY-Asc
              IF DataSet1-rlistini-LOCK
                 READ rlistini PREVIOUS WITH LOCK
              ELSE
                 READ rlistini PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-rlistini-LOCK
                 READ rlistini NEXT WITH LOCK
              ELSE
                 READ rlistini NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM rlistini-rlis-k-art-MERGE-SPLITBUF
           PERFORM rlistini-rlis-k-descr-MERGE-SPLITBUF
           MOVE STATUS-rlistini TO TOTEM-ERR-STAT
           MOVE "rlistini" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rlistini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rlistini, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-rlistini-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:rlistini, BeforeWrite>
      * <TOTEM:END>
           WRITE rlis-rec OF rlistini.
           MOVE STATUS-rlistini TO TOTEM-ERR-STAT
           MOVE "rlistini" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rlistini, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-rlistini-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:rlistini, BeforeRewrite>
      * <TOTEM:END>
           REWRITE rlis-rec OF rlistini.
           MOVE STATUS-rlistini TO TOTEM-ERR-STAT
           MOVE "rlistini" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rlistini, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-rlistini-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:rlistini, BeforeDelete>
      * <TOTEM:END>
           DELETE rlistini.
           MOVE STATUS-rlistini TO TOTEM-ERR-STAT
           MOVE "rlistini" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rlistini, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tlistini-INITSTART.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tlistini-KEY1-Asc
                 MOVE Low-Value TO tlis-chiave OF tlistini
              ELSE
                 MOVE High-Value TO tlis-chiave OF tlistini
              END-IF
           END-EVALUATE
           .

       DataSet1-tlistini-INITEND.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tlistini-KEY1-Asc
                 MOVE High-Value TO tlis-chiave OF tlistini
              ELSE
                 MOVE Low-Value TO tlis-chiave OF tlistini
              END-IF
           END-EVALUATE
           .

       DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           .   

       DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-tlistini-KEY1-ORDER
           END-EVALUATE
           .

       DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-tlistini-KEY1-ORDER
           END-EVALUATE
           .

      * tlistini
       DataSet1-tlistini-START.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tlistini-KEY1-Asc
                 START tlistini KEY >= tlis-chiave OF tlistini
              ELSE
                 START tlistini KEY <= tlis-chiave OF tlistini
              END-IF
           END-EVALUATE
           .

       DataSet1-tlistini-START-NOTGREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tlistini-KEY1-Asc
                 START tlistini KEY <= tlis-chiave OF tlistini
              ELSE
                 START tlistini KEY >= tlis-chiave OF tlistini
              END-IF
           END-EVALUATE
           .

       DataSet1-tlistini-START-GREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tlistini-KEY1-Asc
                 START tlistini KEY > tlis-chiave OF tlistini
              ELSE
                 START tlistini KEY < tlis-chiave OF tlistini
              END-IF
           END-EVALUATE
           .

       DataSet1-tlistini-START-LESS.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tlistini-KEY1-Asc
                 START tlistini KEY < tlis-chiave OF tlistini
              ELSE
                 START tlistini KEY > tlis-chiave OF tlistini
              END-IF
           END-EVALUATE
           .

       DataSet1-tlistini-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini, BeforeReadRecord>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tlistini-LOCK
                 READ tlistini WITH LOCK 
                 KEY tlis-chiave OF tlistini
              ELSE
                 READ tlistini WITH NO LOCK 
                 KEY tlis-chiave OF tlistini
              END-IF
           END-EVALUATE
           MOVE STATUS-tlistini TO TOTEM-ERR-STAT 
           MOVE "tlistini" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tlistini-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini, BeforeReadNext>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tlistini-KEY1-Asc
                 IF DataSet1-tlistini-LOCK
                    READ tlistini NEXT WITH LOCK
                 ELSE
                    READ tlistini NEXT WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-tlistini-LOCK
                    READ tlistini PREVIOUS WITH LOCK
                 ELSE
                    READ tlistini PREVIOUS WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           MOVE STATUS-tlistini TO TOTEM-ERR-STAT
           MOVE "tlistini" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tlistini-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini, BeforeReadPrev>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tlistini-KEY1-Asc
                 IF DataSet1-tlistini-LOCK
                    READ tlistini PREVIOUS WITH LOCK
                 ELSE
                    READ tlistini PREVIOUS WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-tlistini-LOCK
                    READ tlistini NEXT WITH LOCK
                 ELSE
                    READ tlistini NEXT WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           MOVE STATUS-tlistini TO TOTEM-ERR-STAT
           MOVE "tlistini" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tlistini-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini, BeforeWrite>
      * <TOTEM:END>
           WRITE tlis-rec OF tlistini.
           MOVE STATUS-tlistini TO TOTEM-ERR-STAT
           MOVE "tlistini" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tlistini-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini, BeforeRewrite>
      * <TOTEM:END>
           REWRITE tlis-rec OF tlistini.
           MOVE STATUS-tlistini TO TOTEM-ERR-STAT
           MOVE "tlistini" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tlistini-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini, BeforeDelete>
      * <TOTEM:END>
           DELETE tlistini.
           MOVE STATUS-tlistini TO TOTEM-ERR-STAT
           MOVE "tlistini" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini, AfterDelete>
      * <TOTEM:END>
           .

       clienti-cli-K1-MERGE-SPLITBUF.
           INITIALIZE clienti-cli-K1-SPLITBUF
           MOVE cli-tipo-CF OF clienti(1:1) TO 
           clienti-cli-K1-SPLITBUF(1:1)
           MOVE cli-ragsoc-1 OF clienti(1:40) TO 
           clienti-cli-K1-SPLITBUF(2:40)
           MOVE cli-codice OF clienti(1:5) TO 
           clienti-cli-K1-SPLITBUF(42:5)
           .

       clienti-cli-K3-MERGE-SPLITBUF.
           INITIALIZE clienti-cli-K3-SPLITBUF
           MOVE cli-gdo OF clienti(1:5) TO clienti-cli-K3-SPLITBUF(1:5)
           MOVE cli-chiave OF clienti(1:6) TO 
           clienti-cli-K3-SPLITBUF(6:6)
           .

       clienti-cli-K4-MERGE-SPLITBUF.
           INITIALIZE clienti-cli-K4-SPLITBUF
           MOVE cli-utf OF clienti(1:1) TO clienti-cli-K4-SPLITBUF(1:1)
           MOVE cli-chiave OF clienti(1:6) TO 
           clienti-cli-K4-SPLITBUF(2:6)
           .

       DataSet1-clienti-INITSTART.
           IF DataSet1-clienti-KEY-Asc
              MOVE Low-Value TO cli-chiave OF clienti
           ELSE
              MOVE High-Value TO cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-INITEND.
           IF DataSet1-clienti-KEY-Asc
              MOVE High-Value TO cli-chiave OF clienti
           ELSE
              MOVE Low-Value TO cli-chiave OF clienti
           END-IF
           .

      * clienti
       DataSet1-clienti-START.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY >= cli-chiave OF clienti
           ELSE
              START clienti KEY <= cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-START-NOTGREATER.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY <= cli-chiave OF clienti
           ELSE
              START clienti KEY >= cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-START-GREATER.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY > cli-chiave OF clienti
           ELSE
              START clienti KEY < cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-START-LESS.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY < cli-chiave OF clienti
           ELSE
              START clienti KEY > cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-clienti-LOCK
              READ clienti WITH LOCK 
              KEY cli-chiave OF clienti
           ELSE
              READ clienti WITH NO LOCK 
              KEY cli-chiave OF clienti
           END-IF
           PERFORM clienti-cli-K1-MERGE-SPLITBUF
           PERFORM clienti-cli-K3-MERGE-SPLITBUF
           PERFORM clienti-cli-K4-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT 
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-clienti-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-clienti-KEY-Asc
              IF DataSet1-clienti-LOCK
                 READ clienti NEXT WITH LOCK
              ELSE
                 READ clienti NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-clienti-LOCK
                 READ clienti PREVIOUS WITH LOCK
              ELSE
                 READ clienti PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM clienti-cli-K1-MERGE-SPLITBUF
           PERFORM clienti-cli-K3-MERGE-SPLITBUF
           PERFORM clienti-cli-K4-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-clienti-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-clienti-KEY-Asc
              IF DataSet1-clienti-LOCK
                 READ clienti PREVIOUS WITH LOCK
              ELSE
                 READ clienti PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-clienti-LOCK
                 READ clienti NEXT WITH LOCK
              ELSE
                 READ clienti NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM clienti-cli-K1-MERGE-SPLITBUF
           PERFORM clienti-cli-K3-MERGE-SPLITBUF
           PERFORM clienti-cli-K4-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tlistini1-INITSTART.
           IF DataSet1-tlistini1-KEY-Asc
              MOVE Low-Value TO tlis-chiave OF tlistini1
           ELSE
              MOVE High-Value TO tlis-chiave OF tlistini1
           END-IF
           .

       DataSet1-tlistini1-INITEND.
           IF DataSet1-tlistini1-KEY-Asc
              MOVE High-Value TO tlis-chiave OF tlistini1
           ELSE
              MOVE Low-Value TO tlis-chiave OF tlistini1
           END-IF
           .

      * tlistini1
       DataSet1-tlistini1-START.
           IF DataSet1-tlistini1-KEY-Asc
              START tlistini1 KEY >= tlis-chiave OF tlistini1
           ELSE
              START tlistini1 KEY <= tlis-chiave OF tlistini1
           END-IF
           .

       DataSet1-tlistini1-START-NOTGREATER.
           IF DataSet1-tlistini1-KEY-Asc
              START tlistini1 KEY <= tlis-chiave OF tlistini1
           ELSE
              START tlistini1 KEY >= tlis-chiave OF tlistini1
           END-IF
           .

       DataSet1-tlistini1-START-GREATER.
           IF DataSet1-tlistini1-KEY-Asc
              START tlistini1 KEY > tlis-chiave OF tlistini1
           ELSE
              START tlistini1 KEY < tlis-chiave OF tlistini1
           END-IF
           .

       DataSet1-tlistini1-START-LESS.
           IF DataSet1-tlistini1-KEY-Asc
              START tlistini1 KEY < tlis-chiave OF tlistini1
           ELSE
              START tlistini1 KEY > tlis-chiave OF tlistini1
           END-IF
           .

       DataSet1-tlistini1-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini1, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini1, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tlistini1-LOCK
              READ tlistini1 WITH LOCK 
              KEY tlis-chiave OF tlistini1
           ELSE
              READ tlistini1 WITH NO LOCK 
              KEY tlis-chiave OF tlistini1
           END-IF
           MOVE STATUS-tlistini1 TO TOTEM-ERR-STAT 
           MOVE "tlistini1" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini1, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini1, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tlistini1-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini1, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini1, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tlistini1-KEY-Asc
              IF DataSet1-tlistini1-LOCK
                 READ tlistini1 NEXT WITH LOCK
              ELSE
                 READ tlistini1 NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tlistini1-LOCK
                 READ tlistini1 PREVIOUS WITH LOCK
              ELSE
                 READ tlistini1 PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tlistini1 TO TOTEM-ERR-STAT
           MOVE "tlistini1" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini1, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini1, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tlistini1-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini1, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini1, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tlistini1-KEY-Asc
              IF DataSet1-tlistini1-LOCK
                 READ tlistini1 PREVIOUS WITH LOCK
              ELSE
                 READ tlistini1 PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tlistini1-LOCK
                 READ tlistini1 NEXT WITH LOCK
              ELSE
                 READ tlistini1 NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tlistini1 TO TOTEM-ERR-STAT
           MOVE "tlistini1" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini1, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini1, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tlistini1-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini1, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tlistini1 TO TOTEM-ERR-STAT
           MOVE "tlistini1" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini1, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tlistini1-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini1, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tlistini1 TO TOTEM-ERR-STAT
           MOVE "tlistini1" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini1, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tlistini1-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini1, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tlistini1 TO TOTEM-ERR-STAT
           MOVE "tlistini1" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tlistini1, AfterDelete>
      * <TOTEM:END>
           .

       destinif-K1-MERGE-SPLITBUF.
           INITIALIZE destinif-K1-SPLITBUF
           MOVE desf-ragsoc-1(1:40) TO destinif-K1-SPLITBUF(1:40)
           MOVE desf-codice(1:5) TO destinif-K1-SPLITBUF(41:5)
           MOVE desf-prog(1:5) TO destinif-K1-SPLITBUF(46:5)
           .

       destinif-desf-k2-MERGE-SPLITBUF.
           INITIALIZE destinif-desf-k2-SPLITBUF
           MOVE desf-codice(1:5) TO destinif-desf-k2-SPLITBUF(1:5)
           MOVE desf-ragsoc-1(1:40) TO destinif-desf-k2-SPLITBUF(6:40)
           MOVE desf-prog(1:5) TO destinif-desf-k2-SPLITBUF(46:5)
           .

       DataSet1-destinif-INITSTART.
           IF DataSet1-destinif-KEY-Asc
              MOVE Low-Value TO desf-chiave
           ELSE
              MOVE High-Value TO desf-chiave
           END-IF
           .

       DataSet1-destinif-INITEND.
           IF DataSet1-destinif-KEY-Asc
              MOVE High-Value TO desf-chiave
           ELSE
              MOVE Low-Value TO desf-chiave
           END-IF
           .

      * destinif
       DataSet1-destinif-START.
           IF DataSet1-destinif-KEY-Asc
              START destinif KEY >= desf-chiave
           ELSE
              START destinif KEY <= desf-chiave
           END-IF
           .

       DataSet1-destinif-START-NOTGREATER.
           IF DataSet1-destinif-KEY-Asc
              START destinif KEY <= desf-chiave
           ELSE
              START destinif KEY >= desf-chiave
           END-IF
           .

       DataSet1-destinif-START-GREATER.
           IF DataSet1-destinif-KEY-Asc
              START destinif KEY > desf-chiave
           ELSE
              START destinif KEY < desf-chiave
           END-IF
           .

       DataSet1-destinif-START-LESS.
           IF DataSet1-destinif-KEY-Asc
              START destinif KEY < desf-chiave
           ELSE
              START destinif KEY > desf-chiave
           END-IF
           .

       DataSet1-destinif-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:destinif, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destinif, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-destinif-LOCK
              READ destinif WITH LOCK 
              KEY desf-chiave
           ELSE
              READ destinif WITH NO LOCK 
              KEY desf-chiave
           END-IF
           PERFORM destinif-K1-MERGE-SPLITBUF
           PERFORM destinif-desf-k2-MERGE-SPLITBUF
           MOVE STATUS-destinif TO TOTEM-ERR-STAT 
           MOVE "destinif" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destinif, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destinif, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-destinif-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:destinif, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destinif, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-destinif-KEY-Asc
              IF DataSet1-destinif-LOCK
                 READ destinif NEXT WITH LOCK
              ELSE
                 READ destinif NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-destinif-LOCK
                 READ destinif PREVIOUS WITH LOCK
              ELSE
                 READ destinif PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM destinif-K1-MERGE-SPLITBUF
           PERFORM destinif-desf-k2-MERGE-SPLITBUF
           MOVE STATUS-destinif TO TOTEM-ERR-STAT
           MOVE "destinif" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destinif, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destinif, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-destinif-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:destinif, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destinif, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-destinif-KEY-Asc
              IF DataSet1-destinif-LOCK
                 READ destinif PREVIOUS WITH LOCK
              ELSE
                 READ destinif PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-destinif-LOCK
                 READ destinif NEXT WITH LOCK
              ELSE
                 READ destinif NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM destinif-K1-MERGE-SPLITBUF
           PERFORM destinif-desf-k2-MERGE-SPLITBUF
           MOVE STATUS-destinif TO TOTEM-ERR-STAT
           MOVE "destinif" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destinif, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destinif, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-destinif-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:destinif, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-destinif TO TOTEM-ERR-STAT
           MOVE "destinif" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destinif, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-destinif-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:destinif, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-destinif TO TOTEM-ERR-STAT
           MOVE "destinif" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destinif, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-destinif-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:destinif, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-destinif TO TOTEM-ERR-STAT
           MOVE "destinif" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destinif, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-impforn-INITSTART.
           IF DataSet1-impforn-KEY-Asc
              MOVE Low-Value TO imf-chiave OF impforn
           ELSE
              MOVE High-Value TO imf-chiave OF impforn
           END-IF
           .

       DataSet1-impforn-INITEND.
           IF DataSet1-impforn-KEY-Asc
              MOVE High-Value TO imf-chiave OF impforn
           ELSE
              MOVE Low-Value TO imf-chiave OF impforn
           END-IF
           .

      * impforn
       DataSet1-impforn-START.
           IF DataSet1-impforn-KEY-Asc
              START impforn KEY >= imf-chiave OF impforn
           ELSE
              START impforn KEY <= imf-chiave OF impforn
           END-IF
           .

       DataSet1-impforn-START-NOTGREATER.
           IF DataSet1-impforn-KEY-Asc
              START impforn KEY <= imf-chiave OF impforn
           ELSE
              START impforn KEY >= imf-chiave OF impforn
           END-IF
           .

       DataSet1-impforn-START-GREATER.
           IF DataSet1-impforn-KEY-Asc
              START impforn KEY > imf-chiave OF impforn
           ELSE
              START impforn KEY < imf-chiave OF impforn
           END-IF
           .

       DataSet1-impforn-START-LESS.
           IF DataSet1-impforn-KEY-Asc
              START impforn KEY < imf-chiave OF impforn
           ELSE
              START impforn KEY > imf-chiave OF impforn
           END-IF
           .

       DataSet1-impforn-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:impforn, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:impforn, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-impforn-LOCK
              READ impforn WITH LOCK 
              KEY imf-chiave OF impforn
           ELSE
              READ impforn WITH NO LOCK 
              KEY imf-chiave OF impforn
           END-IF
           MOVE STATUS-impforn TO TOTEM-ERR-STAT 
           MOVE "impforn" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:impforn, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:impforn, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-impforn-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:impforn, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:impforn, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-impforn-KEY-Asc
              IF DataSet1-impforn-LOCK
                 READ impforn NEXT WITH LOCK
              ELSE
                 READ impforn NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-impforn-LOCK
                 READ impforn PREVIOUS WITH LOCK
              ELSE
                 READ impforn PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-impforn TO TOTEM-ERR-STAT
           MOVE "impforn" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:impforn, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:impforn, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-impforn-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:impforn, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:impforn, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-impforn-KEY-Asc
              IF DataSet1-impforn-LOCK
                 READ impforn PREVIOUS WITH LOCK
              ELSE
                 READ impforn PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-impforn-LOCK
                 READ impforn NEXT WITH LOCK
              ELSE
                 READ impforn NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-impforn TO TOTEM-ERR-STAT
           MOVE "impforn" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:impforn, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:impforn, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-impforn-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:impforn, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-impforn TO TOTEM-ERR-STAT
           MOVE "impforn" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:impforn, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-impforn-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:impforn, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-impforn TO TOTEM-ERR-STAT
           MOVE "impforn" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:impforn, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-impforn-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:impforn, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-impforn TO TOTEM-ERR-STAT
           MOVE "impforn" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:impforn, AfterDelete>
      * <TOTEM:END>
           .

       progmag-key01-MERGE-SPLITBUF.
           INITIALIZE progmag-key01-SPLITBUF
           MOVE prg-cod-magazzino OF progmag(1:3) TO 
           progmag-key01-SPLITBUF(1:3)
           MOVE prg-cod-articolo OF progmag(1:6) TO 
           progmag-key01-SPLITBUF(4:6)
           MOVE prg-tipo-imballo OF progmag(1:3) TO 
           progmag-key01-SPLITBUF(10:3)
           MOVE prg-peso OF progmag(1:8) TO progmag-key01-SPLITBUF(13:8)
           .

       DataSet1-progmag-INITSTART.
           IF DataSet1-progmag-KEY-Asc
              MOVE Low-Value TO prg-chiave OF progmag
           ELSE
              MOVE High-Value TO prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-INITEND.
           IF DataSet1-progmag-KEY-Asc
              MOVE High-Value TO prg-chiave OF progmag
           ELSE
              MOVE Low-Value TO prg-chiave OF progmag
           END-IF
           .

      * progmag
       DataSet1-progmag-START.
           IF DataSet1-progmag-KEY-Asc
              START progmag KEY >= prg-chiave OF progmag
           ELSE
              START progmag KEY <= prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-START-NOTGREATER.
           IF DataSet1-progmag-KEY-Asc
              START progmag KEY <= prg-chiave OF progmag
           ELSE
              START progmag KEY >= prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-START-GREATER.
           IF DataSet1-progmag-KEY-Asc
              START progmag KEY > prg-chiave OF progmag
           ELSE
              START progmag KEY < prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-START-LESS.
           IF DataSet1-progmag-KEY-Asc
              START progmag KEY < prg-chiave OF progmag
           ELSE
              START progmag KEY > prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-progmag-LOCK
              READ progmag WITH LOCK 
              KEY prg-chiave OF progmag
           ELSE
              READ progmag WITH NO LOCK 
              KEY prg-chiave OF progmag
           END-IF
           PERFORM progmag-key01-MERGE-SPLITBUF
           MOVE STATUS-progmag TO TOTEM-ERR-STAT 
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-progmag-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-progmag-KEY-Asc
              IF DataSet1-progmag-LOCK
                 READ progmag NEXT WITH LOCK
              ELSE
                 READ progmag NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-progmag-LOCK
                 READ progmag PREVIOUS WITH LOCK
              ELSE
                 READ progmag PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM progmag-key01-MERGE-SPLITBUF
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-progmag-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-progmag-KEY-Asc
              IF DataSet1-progmag-LOCK
                 READ progmag PREVIOUS WITH LOCK
              ELSE
                 READ progmag PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-progmag-LOCK
                 READ progmag NEXT WITH LOCK
              ELSE
                 READ progmag NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM progmag-key01-MERGE-SPLITBUF
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-progmag-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-progmag-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-progmag-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterDelete>
      * <TOTEM:END>
           .

       distinteb-k-articolo-MERGE-SPLITBUF.
           INITIALIZE distinteb-k-articolo-SPLITBUF
           MOVE dis-articolo-finale(1:6) TO 
           distinteb-k-articolo-SPLITBUF(1:6)
           MOVE dis-chiave(1:5) TO distinteb-k-articolo-SPLITBUF(7:5)
           .

       distinteb-k-progmag-MERGE-SPLITBUF.
           INITIALIZE distinteb-k-progmag-SPLITBUF
           MOVE dis-chiave-progmag(1:20) TO 
           distinteb-k-progmag-SPLITBUF(1:20)
           .

       DataSet1-distinteb-INITSTART.
           IF DataSet1-distinteb-KEY-Asc
              MOVE Low-Value TO dis-chiave
           ELSE
              MOVE High-Value TO dis-chiave
           END-IF
           .

       DataSet1-distinteb-INITEND.
           IF DataSet1-distinteb-KEY-Asc
              MOVE High-Value TO dis-chiave
           ELSE
              MOVE Low-Value TO dis-chiave
           END-IF
           .

      * distinteb
       DataSet1-distinteb-START.
           IF DataSet1-distinteb-KEY-Asc
              START distinteb KEY >= dis-chiave
           ELSE
              START distinteb KEY <= dis-chiave
           END-IF
           .

       DataSet1-distinteb-START-NOTGREATER.
           IF DataSet1-distinteb-KEY-Asc
              START distinteb KEY <= dis-chiave
           ELSE
              START distinteb KEY >= dis-chiave
           END-IF
           .

       DataSet1-distinteb-START-GREATER.
           IF DataSet1-distinteb-KEY-Asc
              START distinteb KEY > dis-chiave
           ELSE
              START distinteb KEY < dis-chiave
           END-IF
           .

       DataSet1-distinteb-START-LESS.
           IF DataSet1-distinteb-KEY-Asc
              START distinteb KEY < dis-chiave
           ELSE
              START distinteb KEY > dis-chiave
           END-IF
           .

       DataSet1-distinteb-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-distinteb-LOCK
              READ distinteb WITH LOCK 
              KEY dis-chiave
           ELSE
              READ distinteb WITH NO LOCK 
              KEY dis-chiave
           END-IF
           PERFORM distinteb-k-articolo-MERGE-SPLITBUF
           PERFORM distinteb-k-progmag-MERGE-SPLITBUF
           MOVE STATUS-distinteb TO TOTEM-ERR-STAT 
           MOVE "distinteb" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-distinteb-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-distinteb-KEY-Asc
              IF DataSet1-distinteb-LOCK
                 READ distinteb NEXT WITH LOCK
              ELSE
                 READ distinteb NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-distinteb-LOCK
                 READ distinteb PREVIOUS WITH LOCK
              ELSE
                 READ distinteb PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM distinteb-k-articolo-MERGE-SPLITBUF
           PERFORM distinteb-k-progmag-MERGE-SPLITBUF
           MOVE STATUS-distinteb TO TOTEM-ERR-STAT
           MOVE "distinteb" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-distinteb-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-distinteb-KEY-Asc
              IF DataSet1-distinteb-LOCK
                 READ distinteb PREVIOUS WITH LOCK
              ELSE
                 READ distinteb PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-distinteb-LOCK
                 READ distinteb NEXT WITH LOCK
              ELSE
                 READ distinteb NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM distinteb-k-articolo-MERGE-SPLITBUF
           PERFORM distinteb-k-progmag-MERGE-SPLITBUF
           MOVE STATUS-distinteb TO TOTEM-ERR-STAT
           MOVE "distinteb" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-distinteb-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-distinteb TO TOTEM-ERR-STAT
           MOVE "distinteb" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-distinteb-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-distinteb TO TOTEM-ERR-STAT
           MOVE "distinteb" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-distinteb-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-distinteb TO TOTEM-ERR-STAT
           MOVE "distinteb" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:distinteb, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-timposte-INITSTART.
           IF DataSet1-timposte-KEY-Asc
              MOVE Low-Value TO imp-chiave
           ELSE
              MOVE High-Value TO imp-chiave
           END-IF
           .

       DataSet1-timposte-INITEND.
           IF DataSet1-timposte-KEY-Asc
              MOVE High-Value TO imp-chiave
           ELSE
              MOVE Low-Value TO imp-chiave
           END-IF
           .

      * timposte
       DataSet1-timposte-START.
           IF DataSet1-timposte-KEY-Asc
              START timposte KEY >= imp-chiave
           ELSE
              START timposte KEY <= imp-chiave
           END-IF
           .

       DataSet1-timposte-START-NOTGREATER.
           IF DataSet1-timposte-KEY-Asc
              START timposte KEY <= imp-chiave
           ELSE
              START timposte KEY >= imp-chiave
           END-IF
           .

       DataSet1-timposte-START-GREATER.
           IF DataSet1-timposte-KEY-Asc
              START timposte KEY > imp-chiave
           ELSE
              START timposte KEY < imp-chiave
           END-IF
           .

       DataSet1-timposte-START-LESS.
           IF DataSet1-timposte-KEY-Asc
              START timposte KEY < imp-chiave
           ELSE
              START timposte KEY > imp-chiave
           END-IF
           .

       DataSet1-timposte-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-timposte-LOCK
              READ timposte WITH LOCK 
              KEY imp-chiave
           ELSE
              READ timposte WITH NO LOCK 
              KEY imp-chiave
           END-IF
           MOVE STATUS-timposte TO TOTEM-ERR-STAT 
           MOVE "timposte" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-timposte-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-timposte-KEY-Asc
              IF DataSet1-timposte-LOCK
                 READ timposte NEXT WITH LOCK
              ELSE
                 READ timposte NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-timposte-LOCK
                 READ timposte PREVIOUS WITH LOCK
              ELSE
                 READ timposte PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-timposte TO TOTEM-ERR-STAT
           MOVE "timposte" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-timposte-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-timposte-KEY-Asc
              IF DataSet1-timposte-LOCK
                 READ timposte PREVIOUS WITH LOCK
              ELSE
                 READ timposte PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-timposte-LOCK
                 READ timposte NEXT WITH LOCK
              ELSE
                 READ timposte NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-timposte TO TOTEM-ERR-STAT
           MOVE "timposte" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-timposte-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-timposte TO TOTEM-ERR-STAT
           MOVE "timposte" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-timposte-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-timposte TO TOTEM-ERR-STAT
           MOVE "timposte" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-timposte-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-timposte TO TOTEM-ERR-STAT
           MOVE "timposte" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:timposte, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tpiombo-INITSTART.
           IF DataSet1-tpiombo-KEY-Asc
              MOVE Low-Value TO tpb-chiave
           ELSE
              MOVE High-Value TO tpb-chiave
           END-IF
           .

       DataSet1-tpiombo-INITEND.
           IF DataSet1-tpiombo-KEY-Asc
              MOVE High-Value TO tpb-chiave
           ELSE
              MOVE Low-Value TO tpb-chiave
           END-IF
           .

      * tpiombo
       DataSet1-tpiombo-START.
           IF DataSet1-tpiombo-KEY-Asc
              START tpiombo KEY >= tpb-chiave
           ELSE
              START tpiombo KEY <= tpb-chiave
           END-IF
           .

       DataSet1-tpiombo-START-NOTGREATER.
           IF DataSet1-tpiombo-KEY-Asc
              START tpiombo KEY <= tpb-chiave
           ELSE
              START tpiombo KEY >= tpb-chiave
           END-IF
           .

       DataSet1-tpiombo-START-GREATER.
           IF DataSet1-tpiombo-KEY-Asc
              START tpiombo KEY > tpb-chiave
           ELSE
              START tpiombo KEY < tpb-chiave
           END-IF
           .

       DataSet1-tpiombo-START-LESS.
           IF DataSet1-tpiombo-KEY-Asc
              START tpiombo KEY < tpb-chiave
           ELSE
              START tpiombo KEY > tpb-chiave
           END-IF
           .

       DataSet1-tpiombo-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tpiombo-LOCK
              READ tpiombo WITH LOCK 
              KEY tpb-chiave
           ELSE
              READ tpiombo WITH NO LOCK 
              KEY tpb-chiave
           END-IF
           MOVE STATUS-tpiombo TO TOTEM-ERR-STAT 
           MOVE "tpiombo" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tpiombo-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tpiombo-KEY-Asc
              IF DataSet1-tpiombo-LOCK
                 READ tpiombo NEXT WITH LOCK
              ELSE
                 READ tpiombo NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tpiombo-LOCK
                 READ tpiombo PREVIOUS WITH LOCK
              ELSE
                 READ tpiombo PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tpiombo TO TOTEM-ERR-STAT
           MOVE "tpiombo" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tpiombo-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tpiombo-KEY-Asc
              IF DataSet1-tpiombo-LOCK
                 READ tpiombo PREVIOUS WITH LOCK
              ELSE
                 READ tpiombo PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tpiombo-LOCK
                 READ tpiombo NEXT WITH LOCK
              ELSE
                 READ tpiombo NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tpiombo TO TOTEM-ERR-STAT
           MOVE "tpiombo" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tpiombo-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tpiombo TO TOTEM-ERR-STAT
           MOVE "tpiombo" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tpiombo-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tpiombo TO TOTEM-ERR-STAT
           MOVE "tpiombo" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tpiombo-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tpiombo TO TOTEM-ERR-STAT
           MOVE "tpiombo" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tpiombo, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tparamge-INITSTART.
           IF DataSet1-tparamge-KEY-Asc
              MOVE Low-Value TO tge-chiave
           ELSE
              MOVE High-Value TO tge-chiave
           END-IF
           .

       DataSet1-tparamge-INITEND.
           IF DataSet1-tparamge-KEY-Asc
              MOVE High-Value TO tge-chiave
           ELSE
              MOVE Low-Value TO tge-chiave
           END-IF
           .

      * tparamge
       DataSet1-tparamge-START.
           IF DataSet1-tparamge-KEY-Asc
              START tparamge KEY >= tge-chiave
           ELSE
              START tparamge KEY <= tge-chiave
           END-IF
           .

       DataSet1-tparamge-START-NOTGREATER.
           IF DataSet1-tparamge-KEY-Asc
              START tparamge KEY <= tge-chiave
           ELSE
              START tparamge KEY >= tge-chiave
           END-IF
           .

       DataSet1-tparamge-START-GREATER.
           IF DataSet1-tparamge-KEY-Asc
              START tparamge KEY > tge-chiave
           ELSE
              START tparamge KEY < tge-chiave
           END-IF
           .

       DataSet1-tparamge-START-LESS.
           IF DataSet1-tparamge-KEY-Asc
              START tparamge KEY < tge-chiave
           ELSE
              START tparamge KEY > tge-chiave
           END-IF
           .

       DataSet1-tparamge-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tparamge-LOCK
              READ tparamge WITH LOCK 
              KEY tge-chiave
           ELSE
              READ tparamge WITH NO LOCK 
              KEY tge-chiave
           END-IF
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT 
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tparamge-KEY-Asc
              IF DataSet1-tparamge-LOCK
                 READ tparamge NEXT WITH LOCK
              ELSE
                 READ tparamge NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tparamge-LOCK
                 READ tparamge PREVIOUS WITH LOCK
              ELSE
                 READ tparamge PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tparamge-KEY-Asc
              IF DataSet1-tparamge-LOCK
                 READ tparamge PREVIOUS WITH LOCK
              ELSE
                 READ tparamge PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tparamge-LOCK
                 READ tparamge NEXT WITH LOCK
              ELSE
                 READ tparamge NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tmp-nlistini-INITSTART.
           IF DataSet1-tmp-nlistini-KEY-Asc
              MOVE Low-Value TO tmp-nlis-chiave OF tmp-nlistini
           ELSE
              MOVE High-Value TO tmp-nlis-chiave OF tmp-nlistini
           END-IF
           .

       DataSet1-tmp-nlistini-INITEND.
           IF DataSet1-tmp-nlistini-KEY-Asc
              MOVE High-Value TO tmp-nlis-chiave OF tmp-nlistini
           ELSE
              MOVE Low-Value TO tmp-nlis-chiave OF tmp-nlistini
           END-IF
           .

      * tmp-nlistini
       DataSet1-tmp-nlistini-START.
           IF DataSet1-tmp-nlistini-KEY-Asc
              START tmp-nlistini KEY >= tmp-nlis-chiave OF tmp-nlistini
           ELSE
              START tmp-nlistini KEY <= tmp-nlis-chiave OF tmp-nlistini
           END-IF
           .

       DataSet1-tmp-nlistini-START-NOTGREATER.
           IF DataSet1-tmp-nlistini-KEY-Asc
              START tmp-nlistini KEY <= tmp-nlis-chiave OF tmp-nlistini
           ELSE
              START tmp-nlistini KEY >= tmp-nlis-chiave OF tmp-nlistini
           END-IF
           .

       DataSet1-tmp-nlistini-START-GREATER.
           IF DataSet1-tmp-nlistini-KEY-Asc
              START tmp-nlistini KEY > tmp-nlis-chiave OF tmp-nlistini
           ELSE
              START tmp-nlistini KEY < tmp-nlis-chiave OF tmp-nlistini
           END-IF
           .

       DataSet1-tmp-nlistini-START-LESS.
           IF DataSet1-tmp-nlistini-KEY-Asc
              START tmp-nlistini KEY < tmp-nlis-chiave OF tmp-nlistini
           ELSE
              START tmp-nlistini KEY > tmp-nlis-chiave OF tmp-nlistini
           END-IF
           .

       DataSet1-tmp-nlistini-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-nlistini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-nlistini, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tmp-nlistini-LOCK
              READ tmp-nlistini WITH LOCK 
              KEY tmp-nlis-chiave OF tmp-nlistini
           ELSE
              READ tmp-nlistini WITH NO LOCK 
              KEY tmp-nlis-chiave OF tmp-nlistini
           END-IF
           MOVE STATUS-tmp-nlistini TO TOTEM-ERR-STAT 
           MOVE "tmp-nlistini" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-nlistini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-nlistini, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tmp-nlistini-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-nlistini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-nlistini, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tmp-nlistini-KEY-Asc
              IF DataSet1-tmp-nlistini-LOCK
                 READ tmp-nlistini NEXT WITH LOCK
              ELSE
                 READ tmp-nlistini NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tmp-nlistini-LOCK
                 READ tmp-nlistini PREVIOUS WITH LOCK
              ELSE
                 READ tmp-nlistini PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tmp-nlistini TO TOTEM-ERR-STAT
           MOVE "tmp-nlistini" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-nlistini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-nlistini, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tmp-nlistini-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-nlistini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-nlistini, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tmp-nlistini-KEY-Asc
              IF DataSet1-tmp-nlistini-LOCK
                 READ tmp-nlistini PREVIOUS WITH LOCK
              ELSE
                 READ tmp-nlistini PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tmp-nlistini-LOCK
                 READ tmp-nlistini NEXT WITH LOCK
              ELSE
                 READ tmp-nlistini NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tmp-nlistini TO TOTEM-ERR-STAT
           MOVE "tmp-nlistini" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-nlistini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-nlistini, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tmp-nlistini-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-nlistini, BeforeWrite>
      * <TOTEM:END>
           WRITE tmp-nlis-rec OF tmp-nlistini.
           MOVE STATUS-tmp-nlistini TO TOTEM-ERR-STAT
           MOVE "tmp-nlistini" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-nlistini, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tmp-nlistini-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-nlistini, BeforeRewrite>
      * <TOTEM:END>
           REWRITE tmp-nlis-rec OF tmp-nlistini.
           MOVE STATUS-tmp-nlistini TO TOTEM-ERR-STAT
           MOVE "tmp-nlistini" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-nlistini, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tmp-nlistini-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-nlistini, BeforeDelete>
      * <TOTEM:END>
           DELETE tmp-nlistini.
           MOVE STATUS-tmp-nlistini TO TOTEM-ERR-STAT
           MOVE "tmp-nlistini" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmp-nlistini, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-nlistini-INITSTART.
           IF DataSet1-nlistini-KEY-Asc
              MOVE Low-Value TO nlis-chiave OF nlistini
           ELSE
              MOVE High-Value TO nlis-chiave OF nlistini
           END-IF
           .

       DataSet1-nlistini-INITEND.
           IF DataSet1-nlistini-KEY-Asc
              MOVE High-Value TO nlis-chiave OF nlistini
           ELSE
              MOVE Low-Value TO nlis-chiave OF nlistini
           END-IF
           .

      * nlistini
       DataSet1-nlistini-START.
           IF DataSet1-nlistini-KEY-Asc
              START nlistini KEY >= nlis-chiave OF nlistini
           ELSE
              START nlistini KEY <= nlis-chiave OF nlistini
           END-IF
           .

       DataSet1-nlistini-START-NOTGREATER.
           IF DataSet1-nlistini-KEY-Asc
              START nlistini KEY <= nlis-chiave OF nlistini
           ELSE
              START nlistini KEY >= nlis-chiave OF nlistini
           END-IF
           .

       DataSet1-nlistini-START-GREATER.
           IF DataSet1-nlistini-KEY-Asc
              START nlistini KEY > nlis-chiave OF nlistini
           ELSE
              START nlistini KEY < nlis-chiave OF nlistini
           END-IF
           .

       DataSet1-nlistini-START-LESS.
           IF DataSet1-nlistini-KEY-Asc
              START nlistini KEY < nlis-chiave OF nlistini
           ELSE
              START nlistini KEY > nlis-chiave OF nlistini
           END-IF
           .

       DataSet1-nlistini-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:nlistini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:nlistini, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-nlistini-LOCK
              READ nlistini WITH LOCK 
              KEY nlis-chiave OF nlistini
           ELSE
              READ nlistini WITH NO LOCK 
              KEY nlis-chiave OF nlistini
           END-IF
           MOVE STATUS-nlistini TO TOTEM-ERR-STAT 
           MOVE "nlistini" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:nlistini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:nlistini, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-nlistini-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:nlistini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:nlistini, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-nlistini-KEY-Asc
              IF DataSet1-nlistini-LOCK
                 READ nlistini NEXT WITH LOCK
              ELSE
                 READ nlistini NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-nlistini-LOCK
                 READ nlistini PREVIOUS WITH LOCK
              ELSE
                 READ nlistini PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-nlistini TO TOTEM-ERR-STAT
           MOVE "nlistini" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:nlistini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:nlistini, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-nlistini-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:nlistini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:nlistini, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-nlistini-KEY-Asc
              IF DataSet1-nlistini-LOCK
                 READ nlistini PREVIOUS WITH LOCK
              ELSE
                 READ nlistini PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-nlistini-LOCK
                 READ nlistini NEXT WITH LOCK
              ELSE
                 READ nlistini NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-nlistini TO TOTEM-ERR-STAT
           MOVE "nlistini" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:nlistini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:nlistini, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-nlistini-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:nlistini, BeforeWrite>
      * <TOTEM:END>
           WRITE nlis-rec OF nlistini.
           MOVE STATUS-nlistini TO TOTEM-ERR-STAT
           MOVE "nlistini" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:nlistini, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-nlistini-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:nlistini, BeforeRewrite>
      * <TOTEM:END>
           REWRITE nlis-rec OF nlistini.
           MOVE STATUS-nlistini TO TOTEM-ERR-STAT
           MOVE "nlistini" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:nlistini, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-nlistini-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:nlistini, BeforeDelete>
      * <TOTEM:END>
           DELETE nlistini.
           MOVE STATUS-nlistini TO TOTEM-ERR-STAT
           MOVE "nlistini" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:nlistini, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-nforn-dest-INITSTART.
           IF DataSet1-nforn-dest-KEY-Asc
              MOVE Low-Value TO nfod-chiave OF nforn-dest
           ELSE
              MOVE High-Value TO nfod-chiave OF nforn-dest
           END-IF
           .

       DataSet1-nforn-dest-INITEND.
           IF DataSet1-nforn-dest-KEY-Asc
              MOVE High-Value TO nfod-chiave OF nforn-dest
           ELSE
              MOVE Low-Value TO nfod-chiave OF nforn-dest
           END-IF
           .

      * nforn-dest
       DataSet1-nforn-dest-START.
           IF DataSet1-nforn-dest-KEY-Asc
              START nforn-dest KEY >= nfod-chiave OF nforn-dest
           ELSE
              START nforn-dest KEY <= nfod-chiave OF nforn-dest
           END-IF
           .

       DataSet1-nforn-dest-START-NOTGREATER.
           IF DataSet1-nforn-dest-KEY-Asc
              START nforn-dest KEY <= nfod-chiave OF nforn-dest
           ELSE
              START nforn-dest KEY >= nfod-chiave OF nforn-dest
           END-IF
           .

       DataSet1-nforn-dest-START-GREATER.
           IF DataSet1-nforn-dest-KEY-Asc
              START nforn-dest KEY > nfod-chiave OF nforn-dest
           ELSE
              START nforn-dest KEY < nfod-chiave OF nforn-dest
           END-IF
           .

       DataSet1-nforn-dest-START-LESS.
           IF DataSet1-nforn-dest-KEY-Asc
              START nforn-dest KEY < nfod-chiave OF nforn-dest
           ELSE
              START nforn-dest KEY > nfod-chiave OF nforn-dest
           END-IF
           .

       DataSet1-nforn-dest-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:nforn-dest, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:nforn-dest, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-nforn-dest-LOCK
              READ nforn-dest WITH LOCK 
              KEY nfod-chiave OF nforn-dest
           ELSE
              READ nforn-dest WITH NO LOCK 
              KEY nfod-chiave OF nforn-dest
           END-IF
           MOVE STATUS-nforn-dest TO TOTEM-ERR-STAT 
           MOVE "nforn-dest" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:nforn-dest, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:nforn-dest, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-nforn-dest-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:nforn-dest, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:nforn-dest, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-nforn-dest-KEY-Asc
              IF DataSet1-nforn-dest-LOCK
                 READ nforn-dest NEXT WITH LOCK
              ELSE
                 READ nforn-dest NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-nforn-dest-LOCK
                 READ nforn-dest PREVIOUS WITH LOCK
              ELSE
                 READ nforn-dest PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-nforn-dest TO TOTEM-ERR-STAT
           MOVE "nforn-dest" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:nforn-dest, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:nforn-dest, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-nforn-dest-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:nforn-dest, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:nforn-dest, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-nforn-dest-KEY-Asc
              IF DataSet1-nforn-dest-LOCK
                 READ nforn-dest PREVIOUS WITH LOCK
              ELSE
                 READ nforn-dest PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-nforn-dest-LOCK
                 READ nforn-dest NEXT WITH LOCK
              ELSE
                 READ nforn-dest NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-nforn-dest TO TOTEM-ERR-STAT
           MOVE "nforn-dest" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:nforn-dest, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:nforn-dest, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-nforn-dest-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:nforn-dest, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-nforn-dest TO TOTEM-ERR-STAT
           MOVE "nforn-dest" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:nforn-dest, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-nforn-dest-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:nforn-dest, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-nforn-dest TO TOTEM-ERR-STAT
           MOVE "nforn-dest" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:nforn-dest, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-nforn-dest-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:nforn-dest, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-nforn-dest TO TOTEM-ERR-STAT
           MOVE "nforn-dest" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:nforn-dest, AfterDelete>
      * <TOTEM:END>
           .

       catart-cat-art-princ-MERGE-SPLITBUF.
           INITIALIZE catart-cat-art-princ-SPLITBUF
           MOVE cat-princ OF catart(1:6) TO 
           catart-cat-art-princ-SPLITBUF(1:6)
           MOVE cat-codice OF catart(1:6) TO 
           catart-cat-art-princ-SPLITBUF(7:6)
           .

       DataSet1-catart-INITSTART.
           IF DataSet1-catart-KEY-Asc
              MOVE Low-Value TO cat-chiave OF catart
           ELSE
              MOVE High-Value TO cat-chiave OF catart
           END-IF
           .

       DataSet1-catart-INITEND.
           IF DataSet1-catart-KEY-Asc
              MOVE High-Value TO cat-chiave OF catart
           ELSE
              MOVE Low-Value TO cat-chiave OF catart
           END-IF
           .

      * catart
       DataSet1-catart-START.
           IF DataSet1-catart-KEY-Asc
              START catart KEY >= cat-chiave OF catart
           ELSE
              START catart KEY <= cat-chiave OF catart
           END-IF
           .

       DataSet1-catart-START-NOTGREATER.
           IF DataSet1-catart-KEY-Asc
              START catart KEY <= cat-chiave OF catart
           ELSE
              START catart KEY >= cat-chiave OF catart
           END-IF
           .

       DataSet1-catart-START-GREATER.
           IF DataSet1-catart-KEY-Asc
              START catart KEY > cat-chiave OF catart
           ELSE
              START catart KEY < cat-chiave OF catart
           END-IF
           .

       DataSet1-catart-START-LESS.
           IF DataSet1-catart-KEY-Asc
              START catart KEY < cat-chiave OF catart
           ELSE
              START catart KEY > cat-chiave OF catart
           END-IF
           .

       DataSet1-catart-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:catart, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:catart, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-catart-LOCK
              READ catart WITH LOCK 
              KEY cat-chiave OF catart
           ELSE
              READ catart WITH NO LOCK 
              KEY cat-chiave OF catart
           END-IF
           PERFORM catart-cat-art-princ-MERGE-SPLITBUF
           MOVE status-catart TO TOTEM-ERR-STAT 
           MOVE "catart" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:catart, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:catart, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-catart-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:catart, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:catart, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-catart-KEY-Asc
              IF DataSet1-catart-LOCK
                 READ catart NEXT WITH LOCK
              ELSE
                 READ catart NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-catart-LOCK
                 READ catart PREVIOUS WITH LOCK
              ELSE
                 READ catart PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM catart-cat-art-princ-MERGE-SPLITBUF
           MOVE status-catart TO TOTEM-ERR-STAT
           MOVE "catart" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:catart, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:catart, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-catart-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:catart, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:catart, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-catart-KEY-Asc
              IF DataSet1-catart-LOCK
                 READ catart PREVIOUS WITH LOCK
              ELSE
                 READ catart PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-catart-LOCK
                 READ catart NEXT WITH LOCK
              ELSE
                 READ catart NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM catart-cat-art-princ-MERGE-SPLITBUF
           MOVE status-catart TO TOTEM-ERR-STAT
           MOVE "catart" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:catart, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:catart, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-catart-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:catart, BeforeWrite>
      * <TOTEM:END>
           MOVE status-catart TO TOTEM-ERR-STAT
           MOVE "catart" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:catart, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-catart-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:catart, BeforeRewrite>
      * <TOTEM:END>
           MOVE status-catart TO TOTEM-ERR-STAT
           MOVE "catart" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:catart, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-catart-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:catart, BeforeDelete>
      * <TOTEM:END>
           MOVE status-catart TO TOTEM-ERR-STAT
           MOVE "catart" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:catart, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-param-INITSTART.
           IF DataSet1-param-KEY-Asc
              MOVE Low-Value TO prm-chiave OF param
           ELSE
              MOVE High-Value TO prm-chiave OF param
           END-IF
           .

       DataSet1-param-INITEND.
           IF DataSet1-param-KEY-Asc
              MOVE High-Value TO prm-chiave OF param
           ELSE
              MOVE Low-Value TO prm-chiave OF param
           END-IF
           .

      * param
       DataSet1-param-START.
           IF DataSet1-param-KEY-Asc
              START param KEY >= prm-chiave OF param
           ELSE
              START param KEY <= prm-chiave OF param
           END-IF
           .

       DataSet1-param-START-NOTGREATER.
           IF DataSet1-param-KEY-Asc
              START param KEY <= prm-chiave OF param
           ELSE
              START param KEY >= prm-chiave OF param
           END-IF
           .

       DataSet1-param-START-GREATER.
           IF DataSet1-param-KEY-Asc
              START param KEY > prm-chiave OF param
           ELSE
              START param KEY < prm-chiave OF param
           END-IF
           .

       DataSet1-param-START-LESS.
           IF DataSet1-param-KEY-Asc
              START param KEY < prm-chiave OF param
           ELSE
              START param KEY > prm-chiave OF param
           END-IF
           .

       DataSet1-param-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:param, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:param, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-param-LOCK
              READ param WITH LOCK 
              KEY prm-chiave OF param
           ELSE
              READ param WITH NO LOCK 
              KEY prm-chiave OF param
           END-IF
           MOVE STATUS-param TO TOTEM-ERR-STAT 
           MOVE "param" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:param, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:param, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-param-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:param, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:param, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-param-KEY-Asc
              IF DataSet1-param-LOCK
                 READ param NEXT WITH LOCK
              ELSE
                 READ param NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-param-LOCK
                 READ param PREVIOUS WITH LOCK
              ELSE
                 READ param PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-param TO TOTEM-ERR-STAT
           MOVE "param" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:param, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:param, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-param-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:param, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:param, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-param-KEY-Asc
              IF DataSet1-param-LOCK
                 READ param PREVIOUS WITH LOCK
              ELSE
                 READ param PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-param-LOCK
                 READ param NEXT WITH LOCK
              ELSE
                 READ param NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-param TO TOTEM-ERR-STAT
           MOVE "param" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:param, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:param, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-param-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:param, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-param TO TOTEM-ERR-STAT
           MOVE "param" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:param, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-param-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:param, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-param TO TOTEM-ERR-STAT
           MOVE "param" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:param, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-param-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:param, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-param TO TOTEM-ERR-STAT
           MOVE "param" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:param, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tscorte-INITSTART.
           IF DataSet1-tscorte-KEY-Asc
              MOVE Low-Value TO sco-chiave
           ELSE
              MOVE High-Value TO sco-chiave
           END-IF
           .

       DataSet1-tscorte-INITEND.
           IF DataSet1-tscorte-KEY-Asc
              MOVE High-Value TO sco-chiave
           ELSE
              MOVE Low-Value TO sco-chiave
           END-IF
           .

      * tscorte
       DataSet1-tscorte-START.
           IF DataSet1-tscorte-KEY-Asc
              START tscorte KEY >= sco-chiave
           ELSE
              START tscorte KEY <= sco-chiave
           END-IF
           .

       DataSet1-tscorte-START-NOTGREATER.
           IF DataSet1-tscorte-KEY-Asc
              START tscorte KEY <= sco-chiave
           ELSE
              START tscorte KEY >= sco-chiave
           END-IF
           .

       DataSet1-tscorte-START-GREATER.
           IF DataSet1-tscorte-KEY-Asc
              START tscorte KEY > sco-chiave
           ELSE
              START tscorte KEY < sco-chiave
           END-IF
           .

       DataSet1-tscorte-START-LESS.
           IF DataSet1-tscorte-KEY-Asc
              START tscorte KEY < sco-chiave
           ELSE
              START tscorte KEY > sco-chiave
           END-IF
           .

       DataSet1-tscorte-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tscorte, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tscorte, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tscorte-LOCK
              READ tscorte WITH LOCK 
              KEY sco-chiave
           ELSE
              READ tscorte WITH NO LOCK 
              KEY sco-chiave
           END-IF
           MOVE STATUS-tscorte TO TOTEM-ERR-STAT 
           MOVE "tscorte" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tscorte, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tscorte, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tscorte-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tscorte, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tscorte, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tscorte-KEY-Asc
              IF DataSet1-tscorte-LOCK
                 READ tscorte NEXT WITH LOCK
              ELSE
                 READ tscorte NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tscorte-LOCK
                 READ tscorte PREVIOUS WITH LOCK
              ELSE
                 READ tscorte PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tscorte TO TOTEM-ERR-STAT
           MOVE "tscorte" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tscorte, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tscorte, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tscorte-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tscorte, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tscorte, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tscorte-KEY-Asc
              IF DataSet1-tscorte-LOCK
                 READ tscorte PREVIOUS WITH LOCK
              ELSE
                 READ tscorte PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tscorte-LOCK
                 READ tscorte NEXT WITH LOCK
              ELSE
                 READ tscorte NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tscorte TO TOTEM-ERR-STAT
           MOVE "tscorte" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tscorte, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tscorte, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tscorte-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tscorte, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tscorte TO TOTEM-ERR-STAT
           MOVE "tscorte" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tscorte, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tscorte-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tscorte, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tscorte TO TOTEM-ERR-STAT
           MOVE "tscorte" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tscorte, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tscorte-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tscorte, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tscorte TO TOTEM-ERR-STAT
           MOVE "tscorte" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tscorte, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-INIT-RECORD.
           INITIALIZE art-rec OF articoli
           INITIALIZE rlis-rec OF rlistini
           INITIALIZE tlis-rec OF tlistini
           INITIALIZE cli-rec OF clienti
           INITIALIZE tlis-rec OF tlistini1
           INITIALIZE desf-rec OF destinif
           INITIALIZE imf-rec OF impforn
           INITIALIZE prg-rec OF progmag
           INITIALIZE dis-rec OF distinteb
           INITIALIZE imp-rec OF timposte
           INITIALIZE tpb-rec OF tpiombo
           INITIALIZE tge-rec OF tparamge
           INITIALIZE tmp-nlis-rec OF tmp-nlistini
           INITIALIZE nlis-rec OF nlistini
           INITIALIZE nfod-rec OF nforn-dest
           INITIALIZE cat-rec OF catart
           INITIALIZE prm-rec OF param
           INITIALIZE sco-rec OF tscorte
           .


      * GRID
       gd1-Content.
      * CELLS' SETTING
              MODIFY gd1, X = 1, Y = 1,
                CELL-DATA = "Articolo",
      * CELLS' SETTING
              MODIFY gd1, X = 2, Y = 1,
                CELL-DATA = "Descrizione",
      * CELLS' SETTING
              MODIFY gd1, X = 3, Y = 1,
                CELL-DATA = "Cod. Fornitore",
      * CELLS' SETTING
              MODIFY gd1, X = 4, Y = 1,
                CELL-DATA = "Prz. Acq.",
      * CELLS' SETTING
              MODIFY gd1, X = 5, Y = 1,
                CELL-DATA = "% sc 1",
      * CELLS' SETTING
              MODIFY gd1, X = 6, Y = 1,
                CELL-DATA = "Netto",
      * CELLS' SETTING
              MODIFY gd1, X = 7, Y = 1,
                CELL-DATA = "% sc 2",
      * CELLS' SETTING
              MODIFY gd1, X = 8, Y = 1,
                CELL-DATA = "% sc 3",
      * CELLS' SETTING
              MODIFY gd1, X = 9, Y = 1,
                CELL-DATA = "% sc 4",
      * CELLS' SETTING
              MODIFY gd1, X = 10, Y = 1,
                CELL-DATA = "% sc 5",
      * CELLS' SETTING
              MODIFY gd1, X = 11, Y = 1,
                CELL-DATA = "Costi Agg.",
      * CELLS' SETTING
              MODIFY gd1, X = 12, Y = 1,
                CELL-DATA = "% Agg.",
      * CELLS' SETTING
              MODIFY gd1, X = 13, Y = 1,
                CELL-DATA = "% Pb.",
      * CELLS' SETTING
              MODIFY gd1, X = 14, Y = 1,
                CELL-DATA = "PZ",
      * CELLS' SETTING
              MODIFY gd1, X = 15, Y = 1,
                CELL-DATA = "LT",
      * CELLS' SETTING
              MODIFY gd1, X = 16, Y = 1,
                CELL-DATA = "Imposta",
      * CELLS' SETTING
              MODIFY gd1, X = 18, Y = 1,
                CELL-DATA = "PFA",
      * CELLS' SETTING
              MODIFY gd1, X = 19, Y = 1,
                CELL-DATA = "Prz. reale",
      * CELLS' SETTING
              MODIFY gd1, X = 20, Y = 1,
                CELL-DATA = "Confronto",
           .

      * FD's Initialize Paragraph
       DataSet1-articoli-INITREC.
           INITIALIZE art-rec OF articoli
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-rlistini-INITREC.
           INITIALIZE rlis-rec OF rlistini
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tlistini-INITREC.
           INITIALIZE tlis-rec OF tlistini
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-clienti-INITREC.
           INITIALIZE cli-rec OF clienti
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tlistini1-INITREC.
           INITIALIZE tlis-rec OF tlistini1
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-destinif-INITREC.
           INITIALIZE desf-rec OF destinif
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-impforn-INITREC.
           INITIALIZE imf-rec OF impforn
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-progmag-INITREC.
           INITIALIZE prg-rec OF progmag
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-distinteb-INITREC.
           INITIALIZE dis-rec OF distinteb
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-timposte-INITREC.
           INITIALIZE imp-rec OF timposte
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tpiombo-INITREC.
           INITIALIZE tpb-rec OF tpiombo
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tparamge-INITREC.
           INITIALIZE tge-rec OF tparamge
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tmp-nlistini-INITREC.
           INITIALIZE tmp-nlis-rec OF tmp-nlistini
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-nlistini-INITREC.
           INITIALIZE nlis-rec OF nlistini
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-nforn-dest-INITREC.
           INITIALIZE nfod-rec OF nforn-dest
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-catart-INITREC.
           INITIALIZE cat-rec OF catart
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-param-INITREC.
           INITIALIZE prm-rec OF param
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tscorte-INITREC.
           INITIALIZE sco-rec OF tscorte
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      *
       DataSet1-DISPATCH-BUFTOFLD.
           EVALUATE TOTEM-Form-Index ALSO TOTEM-Frame-Index
              WHEN 1 ALSO 0
                  PERFORM Form1-Buf-To-Fld
           END-EVALUATE
           .

       Form1-DISPLAY-STATUS-MSG.
            MODIFY Form1-St-1-Handle PANEL-INDEX = 1
                PANEL-TEXT = TOTEM-HINT-TEXT
           .

       Form1-CLEAR-STATUS-MSG.
           MOVE SPACES TO TOTEM-MSG-1, TOTEM-MSG-2, TOTEM-MSG-3, 
           TOTEM-MSG-TEXT
           PERFORM Form1-DISPLAY-STATUS-MSG
           .

       Form1-Open-Routine.
           PERFORM Form1-Scrn
           PERFORM Form1-Proc
           .

       Form1-Scrn.
           PERFORM Form1-Create-Win
           PERFORM Form1-Init-Value
           PERFORM Form1-Init-Data
      * Tab keystrok settings
      * Tool Bar
           DISPLAY Form1-Tb-1
           PERFORM Form1-DISPLAY
           .

       Form1-Create-Win.
           Display Independent GRAPHICAL WINDOW
              LINES 43,00,
              SIZE 194,50,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 65793,
              CONTROL FONT Small-Font,
              LABEL-OFFSET 23,
              LINK TO THREAD,
              MODELESS,
              NO SCROLL,
              TITLE-BAR,
              TITLE titolo,
              AUTO-MINIMIZE,
              WITH SYSTEM MENU,
              USER-GRAY,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE Screen1-Event-Proc,
              HANDLE IS form1-Handle,
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
           DISPLAY TOOL-BAR 
              LINES 2,69,   
              HANDLE IN Form1-Tb-1-Handle
           DISPLAY Form1-Tb-1 UPON Form1-Tb-1-Handle

      * Status-bar
           DISPLAY STATUS-BAR
              FONT IS Small-Font,
              GRIP,
              PANEL-WIDTHS (135, 25, 999),
              PANEL-STYLE  (1, 1, 1),
              PANEL-TEXT   (SPACE, SPACE, SPACE),
              HANDLE IS Form1-St-1-Handle
           DISPLAY Form1 UPON form1-Handle
      * DISPLAY-COLUMNS settings
              MODIFY gd1, DISPLAY-COLUMNS (1, 8, 48, 60, 70, 76, 86, 
           92, 98, 104, 110, 119, 126, 133, 142, 146, 153, 164, 168, 
           178)
           .

       Form1-PROC.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeAccept>
           accept imp-data from century-date.
           start timposte key <= imp-chiave
                 invalid continue
             not invalid
                 read timposte previous
           end-start.

           perform INIT.
           perform ABILITA-TOOLBAR.
           perform ABILITAZIONI.
           perform STATUS-BAR-MSG.

           move 0 to e-anteprima.
           move BitmapPreviewDisabled to BitmapNumPreview.
           modify tool-anteprima, enabled = e-anteprima
                            bitmap-number = BitmapNumPreview.

      *     call "C$CALLEDBY" using CallingPgm.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT Form1
                 ON EXCEPTION
                    PERFORM Form1-Evaluate-Func
                 MOVE 1 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY form1-Handle
           INITIALIZE Key-Status
           .

       Form1-Evaluate-Func.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterAccept>
           evaluate key-status
           when 5 |MODIFICA
                inquire tool-modifica, enabled in e-modifica
                if e-modifica = 1
                   if mod = zero 
                      move 1    to mod
                   else          
                      move zero to mod
                   end-if
                   modify tool-modifica, value = mod
                   perform MODIFICA
                end-if
           end-evaluate.

           .
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM Form1-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM Form1-Exit
                 END-IF
              WHEN Key-Status = 1004
                 PERFORM chk-trasporto-f-LinkTo
              WHEN Key-Status = 1001
                 PERFORM chk-trasporto-c-LinkTo
              WHEN Key-Status = 1003
                 PERFORM pb-note-LinkTo
              WHEN Key-Status = 1005
                 PERFORM pb-grid-elimina-LinkTo
              WHEN Key-Status = 100
                 PERFORM Form1-Pb-1-LinkTo
              WHEN Key-Status = 1000
                 PERFORM pb-excell-LinkTo
              WHEN Key-Status = 2
                 PERFORM NUOVO-LinkTo
              WHEN Key-Status = 4
                 PERFORM CANCELLA-LinkTo
              WHEN Key-Status = 3
                 PERFORM TOOL-SALVA-LinkTo
              WHEN Key-Status = 6
                 PERFORM ANTEPRIMA-LinkTo
              WHEN Key-Status = 150
                 PERFORM TOOL-MODIFICA-LinkTo
              WHEN Key-Status = 7
                 PERFORM STAMPA-LinkTo
              WHEN Key-Status = 8
                 PERFORM TOOL-CERCA-LinkTo
              WHEN Key-Status = 9
                 PERFORM TOOL-SELEZIONA-LinkTo
              WHEN Key-Status = 1002
                 PERFORM TOOL-PRIMO
              WHEN Key-Status = 67
                 PERFORM TOOL-PRECEDENTE
              WHEN Key-Status = 68
                 PERFORM TOOL-SUCCESSIVO
              WHEN Key-Status = 1006
                 PERFORM TOOL-ULTIMO
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       Form1-CLEAR.
           PERFORM Form1-INIT-VALUE
           PERFORM Form1-DISPLAY
           .

       Form1-DISPLAY.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY Form1-Tb-1
           DISPLAY Form1 UPON form1-Handle
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterDisplay>
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       Form1-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeExit>
           perform SALV-MOD.

           if errori
              move 26 to key-status
              exit paragraph
           end-if.

           .
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       Form1-Init-Data.
           MOVE 1 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
      * GRID
           PERFORM gd1-Content
           .

       Form1-DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-tlistini-KEY1-ORDER
           END-EVALUATE
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-tlistini-KEY1-ORDER
           END-EVALUATE
           PERFORM Form1-DataSet1-Update-Key
           .

       Form1-DataSet1-Update-Key.
           MOVE tlis-rec OF tlistini TO
                     Form1-MULKEY-TMPBUF
           PERFORM Form1-CLEAR
           PERFORM Form1-INIT-DATA
           MOVE Form1-MULKEY-TMPBUF TO
                     tlis-rec OF tlistini
           PERFORM DataSet1-tlistini-Read
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-CURR
           PERFORM Form1-IUD-Display
           .

       Form1-DUPLICATE-MOVEKEY.
           .

       Form1-First.
           PERFORM Form1-DUMMY-FIRST
           PERFORM DataSet1-tlistini-INITSTART
           PERFORM DataSet1-tlistini-START
           IF NOT Valid-STATUS-tlistini
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeFirst>
      * <TOTEM:END>
           PERFORM DataSet1-tlistini-Read-Next
           IF NOT Valid-STATUS-tlistini
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterFirst>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY.
           PERFORM Form1-IUD-Display
           .

       Form1-Previous.
              PERFORM Form1-Buf-To-Fld
              PERFORM DataSet1-tlistini-START-LESS
           IF NOT Valid-STATUS-tlistini
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforePrevious>
      * <TOTEM:END>
           PERFORM DataSet1-tlistini-Read-Prev
           IF NOT Valid-STATUS-tlistini
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterPrevious>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-PREVIOUS
           PERFORM Form1-IUD-Display
           .

       Form1-Next.
              PERFORM Form1-Buf-To-Fld
              PERFORM DataSet1-tlistini-START-GREATER
           IF NOT Valid-STATUS-tlistini
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeNext>
      * <TOTEM:END>
           PERFORM DataSet1-tlistini-Read-Next
           IF NOT Valid-STATUS-tlistini
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterNext>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-NEXT
           PERFORM Form1-IUD-Display
           .
      
       Form1-Last.
           PERFORM Form1-DUMMY-LAST
           PERFORM DataSet1-tlistini-INITEND
           PERFORM DataSet1-tlistini-START-NOTGREATER
           IF NOT Valid-STATUS-tlistini
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeLast>
      * <TOTEM:END>
           PERFORM DataSet1-tlistini-Read-Prev
           IF NOT Valid-STATUS-tlistini
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterLast>
      * <TOTEM:END>
           PERFORM Form1-DUPLICATE-MOVEKEY.
           PERFORM Form1-IUD-Display
           .

       Form1-Curr.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeCurrent>
      * <TOTEM:END>
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-tlistini-Read
           PERFORM Form1-DUPLICATE-MOVEKEY
           PERFORM Form1-DUMMY-CURR
           PERFORM Form1-IUD-Display
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterCurrent>
      * <TOTEM:END>
           .

       Form1-IUD-Display.
           IF Valid-STATUS-tlistini
              PERFORM Form1-ALLGRID-RESET
              PERFORM Form1-Fld-To-Buf
              PERFORM Form1-NAVI-FOR-MASTERGRID
              PERFORM Form1-DISPLAY
           ELSE
              IF Form1-FLAG-REFRESH
                 CONTINUE
              ELSE
                 PERFORM Form1-Extended-File-Status
              END-IF
           END-IF
           .

       Form1-Add.
           PERFORM Form1-Buf-To-Fld
           PERFORM Form1-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM Form1-DUMMY-ADD
           PERFORM DataSet1-tlistini-INITREC
           PERFORM Form1-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeAdd>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-tlistini-Rec-Write
           IF Valid-STATUS-tlistini
              PERFORM Form1-RESUMMARY-INS
              PERFORM Form1-DUMMY-UPDATE-INIT
              MOVE "301" TO TOTEM-MSG-ID
              PERFORM Form1-IUD-Display
           END-IF
           PERFORM Form1-ERR-CHECKING
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterAdd>
      * <TOTEM:END>
           .
     
       Form1-Update.
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-tlistini-START              
           IF NOT Valid-STATUS-tlistini
              PERFORM Form1-Extended-File-Status
              EXIT PARAGRAPH
           END-IF
           PERFORM DataSet1-tlistini-Read
           PERFORM Form1-Buf-To-Fld
           PERFORM Form1-VALIDATION-ROUTINE
           IF NOT TOTEM-CHECK-OK
               EXIT PARAGRAPH
           END-IF
           PERFORM Form1-DUMMY-UPDATE
           PERFORM Form1-Buf-To-Fld
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeUpdate>
      * <TOTEM:END>
      * write
           PERFORM DataSet1-tlistini-Rec-Rewrite
           IF Valid-STATUS-tlistini
              PERFORM Form1-RESUMMARY-DEL
              PERFORM Form1-DUMMY-UPDATE-INIT
              MOVE "302" TO TOTEM-MSG-ID
              PERFORM Form1-IUD-Display
           END-IF
           PERFORM Form1-ERR-CHECKING
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterUpdate>
      * <TOTEM:END>
           .

       Form1-Delete.
           MOVE "203" TO TOTEM-MSG-ID
           PERFORM MESSAGE-BOX-DISPLAY
           IF TOTEM-MSG-RETURN-VALUE NOT = 1
              INITIALIZE TOTEM-MSG-TEXT
              EXIT PARAGRAPH 
           END-IF
           MOVE SPACES TO TOTEM-TRANSACTION-FLAG
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDelete>
      * <TOTEM:END>
           PERFORM Form1-DUMMY-DELETE
      * delete
           PERFORM Form1-Buf-To-Fld
           PERFORM DataSet1-tlistini-Rec-Delete
           IF Valid-STATUS-tlistini
              PERFORM Form1-CLEAR
              PERFORM Form1-DUMMY-DELETE-INIT
              MOVE "303" TO TOTEM-MSG-ID
              MOVE "00" to STATUS-tlistini
           END-IF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterDelete>
      * <TOTEM:END>
           PERFORM Form1-ERR-CHECKING
           .

       Form1-NAVI-FOR-MASTERGRID.
           .

       Form1-ERR-CHECKING.
           IF Valid-STATUS-tlistini
              PERFORM Form1-SHOW-MSG-ROUTINE
           ELSE
              PERFORM Form1-Extended-File-Status
           END-IF
           .

       Form1-RESUMMARY-INS.
           .

       Form1-RESUMMARY-DEL.
           .


       Form1-DUMMY-FIRST.
           .

       Form1-DUMMY-PREVIOUS.
           .

       Form1-DUMMY-NEXT.
           .

       Form1-DUMMY-LAST.
           .

       Form1-DUMMY-CURR.
           .

       Form1-DUMMY-ADD.
           .

       Form1-DUMMY-UPDATE.
           .

       Form1-DUMMY-UPDATE-INIT.
           .

       Form1-DUMMY-DELETE.
           .

       Form1-DUMMY-DELETE-INIT.
           .

       Form1-Init-Value.
           MOVE titolo TO TOTEM-MSG-TITLE
           INITIALIZE Form1-BUF
      * FORM : Form1
           PERFORM DataSet1-INIT-RECORD
      * DB_CHECK BOX
              MOVE 0 TO tlis-trasp-f OF tlistini
      * DB_CHECK BOX
              MOVE 0 TO tlis-trasp-c OF tlistini
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, SetDefault>
      * <TOTEM:END>
           PERFORM Form1-FLD-TO-BUF
           .


       Form1-ALLGRID-RESET.
           .

      * for Form's Validation
       Form1-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
      * ef-codice's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-codice-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5001 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-forn's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-forn-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5002 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-destino's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-destino-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5003 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-note's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-note-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5004 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-ini-val's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-ini-val-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5005 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-fine-val's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-fine-val-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5006 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-note-1's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-note-1-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 14 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-note-2's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-note-2-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 15 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-note-3's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-note-3-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 16 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-note-4's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-note-4-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 17 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
           .

       ef-codice-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-codice, BeforeValidation>
      * <TOTEM:END>
           .

       ef-codice-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-codice, AfterValidation>
      * <TOTEM:END>
           .

      * ef-codice's Validation
       ef-codice-VALIDATION.
           PERFORM ef-codice-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-codice-AFTER-VALIDATION
           .

       ef-forn-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-forn, BeforeValidation>
      * <TOTEM:END>
           .

       ef-forn-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-forn, AfterValidation>
      * <TOTEM:END>
           .

      * ef-forn's Validation
       ef-forn-VALIDATION.
           PERFORM ef-forn-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-forn-AFTER-VALIDATION
           .

       ef-destino-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-destino, BeforeValidation>
      * <TOTEM:END>
           .

       ef-destino-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-destino, AfterValidation>
      * <TOTEM:END>
           .

      * ef-destino's Validation
       ef-destino-VALIDATION.
           PERFORM ef-destino-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-destino-AFTER-VALIDATION
           .

       ef-note-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-note, BeforeValidation>
      * <TOTEM:END>
           .

       ef-note-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-note, AfterValidation>
      * <TOTEM:END>
           .

      * ef-note's Validation
       ef-note-VALIDATION.
           PERFORM ef-note-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-note-AFTER-VALIDATION
           .

       ef-ini-val-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-ini-val, BeforeValidation>
      * <TOTEM:END>
           .

       ef-ini-val-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-ini-val, AfterValidation>
      * <TOTEM:END>
           .

      * ef-ini-val's Validation
       ef-ini-val-VALIDATION.
           PERFORM ef-ini-val-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-ini-val-AFTER-VALIDATION
           .

       ef-fine-val-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-fine-val, BeforeValidation>
      * <TOTEM:END>
           .

       ef-fine-val-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-fine-val, AfterValidation>
      * <TOTEM:END>
           .

      * ef-fine-val's Validation
       ef-fine-val-VALIDATION.
           PERFORM ef-fine-val-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-fine-val-AFTER-VALIDATION
           .

       ef-note-1-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-note-1, BeforeValidation>
      * <TOTEM:END>
           .

       ef-note-1-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-note-1, AfterValidation>
      * <TOTEM:END>
           .

      * ef-note-1's Validation
       ef-note-1-VALIDATION.
           PERFORM ef-note-1-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-note-1-AFTER-VALIDATION
           .

       ef-note-2-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-note-2, BeforeValidation>
      * <TOTEM:END>
           .

       ef-note-2-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-note-2, AfterValidation>
      * <TOTEM:END>
           .

      * ef-note-2's Validation
       ef-note-2-VALIDATION.
           PERFORM ef-note-2-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-note-2-AFTER-VALIDATION
           .

       ef-note-3-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-note-3, BeforeValidation>
      * <TOTEM:END>
           .

       ef-note-3-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-note-3, AfterValidation>
      * <TOTEM:END>
           .

      * ef-note-3's Validation
       ef-note-3-VALIDATION.
           PERFORM ef-note-3-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-note-3-AFTER-VALIDATION
           .

       ef-note-4-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-note-4, BeforeValidation>
      * <TOTEM:END>
           .

       ef-note-4-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-note-4, AfterValidation>
      * <TOTEM:END>
           .

      * ef-note-4's Validation
       ef-note-4-VALIDATION.
           PERFORM ef-note-4-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-note-4-AFTER-VALIDATION
           .


       Form1-Buf-To-Fld.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeBufToFld>
      * <TOTEM:END>
      * DB_Entry-Field : ef-codice
           MOVE ef-codice-BUF TO tlis-codice OF tlistini
      * DB_Entry-Field : ef-forn
           MOVE ef-forn-BUF TO tlis-fornitore OF tlistini
      * DB_Entry-Field : ef-destino
           MOVE ef-destino-BUF TO tlis-destino OF tlistini
      * DB_Entry-Field : ef-note
           MOVE ef-note-BUF TO tlis-descrizione OF tlistini
      * DB_Entry-Field : ef-ini-val
           MOVE ef-ini-val-BUF TO tlis-ini-val OF tlistini
      * DB_Entry-Field : ef-fine-val
           MOVE ef-fine-val-BUF TO tlis-fine-val OF tlistini
      * DB_CHECK BOX : chk-trasporto-f
              IF chk-trasporto-f-BUF = 1
                 MOVE 1 TO tlis-trasp-f OF tlistini
              ELSE
                 MOVE 0 TO tlis-trasp-f OF tlistini
              END-IF
      * DB_CHECK BOX : chk-trasporto-c
              IF chk-trasporto-c-BUF = 1
                 MOVE 1 TO tlis-trasp-c OF tlistini
              ELSE
                 MOVE 0 TO tlis-trasp-c OF tlistini
              END-IF
      * DB_Entry-Field : ef-note-1
           MOVE ef-note-1-BUF TO como-note(1)
      * DB_Entry-Field : ef-note-2
           MOVE ef-note-2-BUF TO como-note(2)
      * DB_Entry-Field : ef-note-3
           MOVE ef-note-3-BUF TO como-note(3)
      * DB_Entry-Field : ef-note-4
           MOVE ef-note-4-BUF TO como-note(4)
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterBufToFld>
           move ef-codice-buf to tlis-codice of tlistini convert.  


           move ef-ini-val-buf to como-data.
           perform DATE-TO-FILE.
           move como-data to tlis-ini-val of tlistini.

           move ef-fine-val-buf to como-data.
           perform DATE-TO-FILE.
           move como-data to tlis-fine-val of tlistini.

           .
      * <TOTEM:END>
           .

       Form1-Fld-To-Buf.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeFldToBuf>
      * <TOTEM:END>
      * DB_Entry-Field : ef-codice
           MOVE tlis-codice OF tlistini TO ef-codice-BUF
      * DB_Entry-Field : ef-forn
           MOVE tlis-fornitore OF tlistini TO ef-forn-BUF
      * DB_Entry-Field : ef-destino
           MOVE tlis-destino OF tlistini TO ef-destino-BUF
      * DB_Entry-Field : ef-note
           MOVE tlis-descrizione OF tlistini TO ef-note-BUF
      * DB_Entry-Field : ef-ini-val
           MOVE tlis-ini-val OF tlistini TO ef-ini-val-BUF
      * DB_Entry-Field : ef-fine-val
           MOVE tlis-fine-val OF tlistini TO ef-fine-val-BUF
      * DB_CHECK BOX : chk-trasporto-f
              IF tlis-trasp-f OF tlistini = 1
                 MOVE 1 TO chk-trasporto-f-BUF
              ELSE
                 MOVE 0 TO chk-trasporto-f-BUF
              END-IF
      * DB_CHECK BOX : chk-trasporto-c
              IF tlis-trasp-c OF tlistini = 1
                 MOVE 1 TO chk-trasporto-c-BUF
              ELSE
                 MOVE 0 TO chk-trasporto-c-BUF
              END-IF
      * DB_LABEL : lab-nome
              MOVE tlis-descrizione OF tlistini  TO lab-nome-BUF
      * DB_Entry-Field : ef-note-1
           MOVE como-note(1) TO ef-note-1-BUF
      * DB_Entry-Field : ef-note-2
           MOVE como-note(2) TO ef-note-2-BUF
      * DB_Entry-Field : ef-note-3
           MOVE como-note(3) TO ef-note-3-BUF
      * DB_Entry-Field : ef-note-4
           MOVE como-note(4) TO ef-note-4-BUF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterFldToBuf>
           move tlis-codice of tlistini  to  codice-ed.
           move codice-ed     to  ef-codice-buf.   
           call "C$JUSTIFY" using ef-codice-buf, "L".
           display ef-codice.   

           perform ABILITAZIONI.

           move tlis-fornitore of tlistini to cli-codice.
           set cli-tipo-f to true
           read clienti no lock
              invalid 
                 move spaces to cli-ragsoc-1
           end-read.
           move cli-ragsoc-1 to lab-forn-buf.

           move tlis-fornitore of tlistini to desf-codice.
           move tlis-destino of tlistini to desf-prog
           read destinif no lock
              invalid 
                 move spaces to desf-ragsoc-1
           end-read.
           move desf-ragsoc-1 to lab-dest-buf.


           move tlis-ini-val of tlistini to como-data.
           perform DATE-TO-SCREEN.
           move como-data to ef-ini-val-buf.

           move tlis-fine-val of tlistini to como-data.
           perform DATE-TO-SCREEN.
           move como-data to ef-fine-val-buf.

           Perform VALORIZZA-OLD.

           .
      * <TOTEM:END>
           .

       Form1-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform Form1-BUF-TO-FLD.
           move 0 to scelta.

           if tlis-fornitore OF tlistini not = old-tlis-fornitore
              and SiSalvato
              set NoSalvato to true
              |78-ID-ef-forn è l'ID del campo ef-forn
              move 78-ID-ef-forn to store-id 
           end-if


           if tlis-destino OF tlistini not = old-tlis-destino
              and SiSalvato
              set NoSalvato to true
              |78-ID-ef-destino è l'ID del campo ef-destino
              move 78-ID-ef-destino to store-id 
           end-if


           if tlis-descrizione OF tlistini not = old-tlis-descrizione
              and SiSalvato
              set NoSalvato to true
              |78-ID-ef-note è l'ID del campo ef-note
              move 78-ID-ef-note to store-id 
           end-if


           if tlis-ini-val OF tlistini not = old-tlis-ini-val
              and SiSalvato
              set NoSalvato to true
              |78-ID-ef-ini-val è l'ID del campo ef-ini-val
              move 78-ID-ef-ini-val to store-id 
           end-if


           if tlis-fine-val OF tlistini not = old-tlis-fine-val
              and SiSalvato
              set NoSalvato to true
              |78-ID-ef-fine-val è l'ID del campo ef-fine-val
              move 78-ID-ef-fine-val to store-id 
           end-if


           if tlis-trasp-f OF tlistini not = old-tlis-trasp-f
              and SiSalvato
              set NoSalvato to true
              |2 è l'ID del campo chk-trasporto-f
              move 2 to store-id
           end-if


           if tlis-trasp-c OF tlistini not = old-tlis-trasp-c
              and SiSalvato
              set NoSalvato to true
              |3 è l'ID del campo chk-trasporto-c
              move 3 to store-id
           end-if

           if como-note(1) not = old-como-note(1)
              and SiSalvato
              set NoSalvato to true
              |14 è l'ID del campo ef-note-1
              move 14 to store-id
           end-if

           if como-note(2) not = old-como-note(2)
              and SiSalvato
              set NoSalvato to true
              |15 è l'ID del campo ef-note-2
              move 15 to store-id
           end-if

           if como-note(3) not = old-como-note(3)
              and SiSalvato
              set NoSalvato to true
              |16 è l'ID del campo ef-note-3
              move 16 to store-id
           end-if

           if como-note(4) not = old-como-note(4)
              and SiSalvato
              set NoSalvato to true
              |17 è l'ID del campo ef-note-4
              move 17 to store-id
           end-if

           .
       Form1-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM Form1-SHOW-MSG-ROUTINE
           .

       Form1-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM Form1-DISPLAY-MESSAGE
           .

       Form1-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       Form1-Save-Status.
           MOVE DataSet1-tlistini-KEY1-ORDER TO TMP-Form1-KEY1-ORDER
           MOVE DataSet1-KEYIS TO TMP-Form1-KEYIS
           MOVE tlis-rec OF tlistini TO 
              TMP-Form1-tlistini-RESTOREBUF
           .             

       Form1-Restore-Status.
           MOVE TMP-Form1-KEY1-ORDER TO DataSet1-tlistini-KEY1-ORDER
           MOVE TMP-Form1-KEYIS TO DataSet1-KEYIS
           MOVE TMP-Form1-tlistini-RESTOREBUF TO
              tlis-rec OF tlistini
           PERFORM DataSet1-tlistini-START
           IF Valid-STATUS-tlistini
              PERFORM DataSet1-tlistini-Read-Next
           ELSE
              PERFORM DataSet1-tlistini-INITREC
           END-IF
           PERFORM UNTIL NOT Valid-STATUS-tlistini OR
              (Valid-STATUS-tlistini AND
                 tlis-rec OF tlistini = 
                   TMP-Form1-tlistini-RESTOREBUF)
              PERFORM DataSet1-tlistini-Read-Next
           END-PERFORM
           .


      * Paragrafo per la struttura del codice in BEFORE sulla screen Form1
      ***---
       Form1-BEFORE-SCREEN.
           evaluate control-id
           |78-ID-ef-forn è l'ID del campo ef-forn
           when 78-ID-ef-forn
                move 1 to StatusHelp
                perform STATUS-HELP
           |78-ID-ef-destino è l'ID del campo ef-destino
           when 78-ID-ef-destino
                move 1 to StatusHelp
                perform STATUS-HELP
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella BEFORE della screen
           when 99999 continue
           when other continue
           end-evaluate.

      * Generazione settaggio keyboard "." ---> ","

      * Paragrafo per la struttura del codice in AFTER sulla screen Form1
      ***---
       Form1-AFTER-SCREEN.
           evaluate control-id
           |78-ID-ef-forn è l'ID del campo ef-forn
           when 78-ID-ef-forn
                move 0 to StatusHelp
                perform STATUS-HELP

           |78-ID-ef-destino è l'ID del campo ef-destino
           when 78-ID-ef-destino
                move 0 to StatusHelp
                perform STATUS-HELP

           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER della screen
           when 99999 continue
           when other continue
           end-evaluate.

      * Generazione risettaggio keyboard "." ---> "."

      * Generazione stringa perform CONTROLLO
           evaluate control-id
           |78-ID-ef-codice è l'ID del campo ef-codice
           when 78-ID-ef-codice
                perform CONTROLLO
           |78-ID-ef-forn è l'ID del campo ef-forn
           when 78-ID-ef-forn
                perform CONTROLLO
           |78-ID-ef-destino è l'ID del campo ef-destino
           when 78-ID-ef-destino
                perform CONTROLLO
           |78-ID-ef-note è l'ID del campo ef-note
           when 78-ID-ef-note
                perform CONTROLLO
           |78-ID-ef-ini-val è l'ID del campo ef-ini-val
           when 78-ID-ef-ini-val
                perform CONTROLLO
           |78-ID-ef-fine-val è l'ID del campo ef-fine-val
           when 78-ID-ef-fine-val
                perform CONTROLLO
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER CONTROLLO della screen
           when 99999 continue
           when other continue
           end-evaluate.

       form-copia-Open-Routine.
           PERFORM form-copia-Scrn
           PERFORM form-copia-Proc
           .

       form-copia-Scrn.
           PERFORM form-copia-Create-Win
           PERFORM form-copia-Init-Value
           PERFORM form-copia-Init-Data
      * Tab keystrok settings
      * Tool Bar
           DISPLAY Form1-Tb-1a
           PERFORM form-copia-DISPLAY
           .

       form-copia-Create-Win.
           Display Independent GRAPHICAL WINDOW
              LINES 5,89,
              SIZE 50,00,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 65793,
              CONTROL FONT Verdana12-Occidentale,
              LABEL-OFFSET 23,
              LINK TO THREAD,
              NO SCROLL,
              TITLE-BAR,
              TITLE titolo-copia,
              WITH SYSTEM MENU,
              USER-GRAY,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE Screen4-Event-Proc,
              HANDLE IS form-copia-Handle,
      * <TOTEM:EPT. FORM:form-copia, FORM:form-copia, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
           DISPLAY TOOL-BAR 
              LINES 2,67,   
              HANDLE IN Form1-Tb-1-Handlea
           DISPLAY Form1-Tb-1a UPON Form1-Tb-1-Handlea

      * Status-bar
           DISPLAY form-copia UPON form-copia-Handle
      * DISPLAY-COLUMNS settings
           .

       form-copia-PROC.
      * <TOTEM:EPT. FORM:form-copia, FORM:form-copia, BeforeAccept>
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT form-copia
                 ON EXCEPTION
                    PERFORM form-copia-Evaluate-Func
                 MOVE 2 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:form-copia, FORM:form-copia, AfterEndAccept>
      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:form-copia, FORM:form-copia, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY form-copia-Handle
           INITIALIZE Key-Status
           .

       form-copia-Evaluate-Func.
      * <TOTEM:EPT. FORM:form-copia, FORM:form-copia, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM form-copia-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM form-copia-Exit
                 END-IF
              WHEN Key-Status = 1000
                 PERFORM pb-ok-LinkTo
              WHEN Key-Status = 27
                 PERFORM pb-annulla-LinkTo
              WHEN Key-Status = 1001
                 PERFORM TOOL-CERCAa-LinkTo
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       form-copia-CLEAR.
           PERFORM form-copia-INIT-VALUE
           PERFORM form-copia-DISPLAY
           .

       form-copia-DISPLAY.
      * <TOTEM:EPT. FORM:form-copia, FORM:form-copia, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY Form1-Tb-1a
           DISPLAY form-copia UPON form-copia-Handle
      * <TOTEM:EPT. FORM:form-copia, FORM:form-copia, AfterDisplay>
      *<<** Customized_Default, SP-G, Screen1-blockpgm-1, Disable **>>

           .
      * <TOTEM:END>
           .

       form-copia-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:form-copia, FORM:form-copia, BeforeExit>
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       form-copia-Init-Data.
           MOVE 2 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
           .

       form-copia-Init-Value.
      * <TOTEM:EPT. FORM:form-copia, FORM:form-copia, SetDefault>
      * <TOTEM:END>
           PERFORM form-copia-FLD-TO-BUF
           .


       form-copia-ALLGRID-RESET.
           .

      * for Form's Validation
       form-copia-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
           .


       form-copia-Buf-To-Fld.
      * <TOTEM:EPT. FORM:form-copia, FORM:form-copia, BeforeBufToFld>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:form-copia, FORM:form-copia, AfterBufToFld>
      * <TOTEM:END>
           .

       form-copia-Fld-To-Buf.
      * <TOTEM:EPT. FORM:form-copia, FORM:form-copia, BeforeFldToBuf>
      * <TOTEM:END>
      * <TOTEM:EPT. FORM:form-copia, FORM:form-copia, AfterFldToBuf>
      * <TOTEM:END>
           .

       form-copia-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform form-copia-BUF-TO-FLD.
           move 0 to scelta.
           .
       form-copia-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM form-copia-SHOW-MSG-ROUTINE
           .

       form-copia-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM form-copia-DISPLAY-MESSAGE
           .

       form-copia-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       form-copia-Save-Status.
           .             

       form-copia-Restore-Status.
           .


      * Paragrafo per la struttura del codice in BEFORE sulla screen form-copia
      ***---
       form-copia-BEFORE-SCREEN.
           evaluate control-id
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella BEFORE della screen
           when 99999 continue
           when other continue
           end-evaluate.

      * Generazione settaggio keyboard "." ---> ","

      * Paragrafo per la struttura del codice in AFTER sulla screen form-copia
      ***---
       form-copia-AFTER-SCREEN.
           evaluate control-id
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER della screen
           when 99999 continue
           when other continue
           end-evaluate.

      * Generazione risettaggio keyboard "." ---> "."

      * Generazione stringa perform CONTROLLO
           evaluate control-id
           |78-ID-EF-cli-copia è l'ID del campo EF-cli-copia
           when 78-ID-EF-cli-copia
                perform CONTROLLO
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER CONTROLLO della screen
           when 99999 continue
           when other continue
           end-evaluate.



       Form1-BeforeProcedure.
           EVALUATE Control-Id
           WHEN 5001 MOVE "Digitare il Codice" to TOTEM-HINT-TEXT
           WHEN 5002 MOVE "Digitare il Fornitore" to TOTEM-HINT-TEXT
           WHEN 5003 MOVE "Digitare il Destino" to TOTEM-HINT-TEXT
           WHEN 5004 MOVE "Digitare il nome del volantino" to 
           TOTEM-HINT-TEXT
           WHEN 5005 MOVE "Digitare la data d'inizio DPO" to 
           TOTEM-HINT-TEXT
           WHEN 5006 MOVE "Digitare la data di fine DPO" to 
           TOTEM-HINT-TEXT
           WHEN 14 MOVE "Digitare i dati di consegna" to TOTEM-HINT-TEXT
           WHEN 15 MOVE "Digitare le note di destinazione" to 
           TOTEM-HINT-TEXT
           WHEN 16 MOVE "Digitare le note di destinazione" to 
           TOTEM-HINT-TEXT
           WHEN 17 MOVE "Digitare le note di destinazione" to 
           TOTEM-HINT-TEXT
           WHEN OTHER MOVE SPACES TO TOTEM-HINT-TEXT
           END-EVALUATE
           EVALUATE Control-Id
           When 5001 PERFORM Screen1-DaEf-1-BeforeProcedure
           When 5002 PERFORM ef-forn-BeforeProcedure
           When 5003 PERFORM ef-gdo-BeforeProcedure
           When 5004 PERFORM ef-nome-BeforeProcedure
           When 5005 PERFORM ef-ini-dpo-BeforeProcedure
           When 5006 PERFORM ef-fine-dpo-BeforeProcedure
           When 14 PERFORM ef-note-1-BeforeProcedure
           When 15 PERFORM ef-note-2-BeforeProcedure
           When 16 PERFORM ef-note-3-BeforeProcedure
           When 17 PERFORM ef-note-4-BeforeProcedure
           END-EVALUATE
           PERFORM Form1-DISPLAY-STATUS-MSG
           perform Form1-BEFORE-SCREEN
           .

       Form1-AfterProcedure.
           EVALUATE Control-Id
           When 5001 PERFORM Screen1-DaEf-1-AfterProcedure
           When 5002 PERFORM ef-gdo-AfterProcedure
           When 5003 PERFORM ef-gdo-AfterProcedure
           When 5004 PERFORM ef-nome-AfterProcedure
           When 5005 PERFORM ef-ini-dpo-AfterProcedure
           When 5006 PERFORM ef-fine-dpo-AfterProcedure
           When 2 PERFORM Screen1-DaCb-1-AfterProcedure
           When 3 PERFORM Screen1-DaCb-1-AfterProcedure
           When 14 PERFORM ef-note-1-AfterProcedure
           When 15 PERFORM ef-note-2-AfterProcedure
           When 16 PERFORM ef-note-3-AfterProcedure
           When 17 PERFORM ef-note-4-AfterProcedure
           END-EVALUATE
           perform Form1-AFTER-SCREEN
           .

       Screen1-Event-Proc.
           .

       Screen1-Gd-1-Event-Proc.
           EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
           WHEN Msg-Begin-Drag ALSO 5007 ALSO
                    form1-Handle 
              PERFORM gd1-Ev-Msg-Begin-Drag
           WHEN Msg-Begin-Entry ALSO 5007 ALSO
                    form1-Handle 
              PERFORM gd1-Ev-Msg-Begin-Entry
           WHEN Msg-End-Drag ALSO 5007 ALSO
                    form1-Handle 
              PERFORM gd1-Ev-Msg-End-Drag
           WHEN Msg-Finish-Entry ALSO 5007 ALSO
                    form1-Handle 
              PERFORM gd1-Ev-Msg-Finish-Entry
           WHEN Msg-Goto-Cell ALSO 5007 ALSO
                    form1-Handle 
              PERFORM gd1-Ev-Msg-Goto-Cell
           WHEN Msg-Goto-Cell-Drag ALSO 5007 ALSO
                    form1-Handle 
              PERFORM gd1-Ev-Msg-Goto-Cell-Drag
           WHEN Msg-Goto-Cell-Mouse ALSO 5007 ALSO
                    form1-Handle 
              PERFORM gd1-Ev-Msg-Goto-Cell-Mouse
           WHEN Msg-Heading-Clicked ALSO 5007 ALSO
                    form1-Handle 
              PERFORM gd1-Ev-Msg-Heading-Clicked
           END-EVALUATE
           .

       Screen4-Event-Proc.
           .

      * USER DEFINE PARAGRAPH
       PARAGRAFO-COPY.
      * <TOTEM:PARA. PARAGRAFO-COPY>
           copy "abilita-toolbar.cpy".
           copy "color-custom.cpy".
           copy "status.cpy".
           copy "utydata.cpy".
           copy "imposte-fornitore.cpy".
           copy "addizionale-piombo-fornitore.cpy".
           copy "prz-finito-forn.cpy".
           copy "costo-medio.cpy".
           copy "trova-parametro.cpy".

      ***--- DUMMY PER COSTO MP
       RECUPERO-ANAGRAFICA 
           .
      * <TOTEM:END>

       ABILITAZIONI.
      * <TOTEM:PARA. ABILITAZIONI>
           if mod = 1              
              move BitmapDeleteEnabled to BitmapNumDelete
              move BitmapSaveEnabled   to BitmapNumSave
              move 1 to e-salva e-cancella
           else           
              move BitmapDeleteDisabled to BitmapNumDelete
              move BitmapSaveDisabled   to BitmapNumSave
              move 0 to e-salva e-cancella
           end-if.      

      * ISACCO (CORREZIONE SU LIVELLO ABILITAZIONE 2) - 10/11/2003
      * (CANCELLAZIONE NON PERMESSA)
           if livello-abil = 2 
              move 0 to e-cancella
              move BitmapDeleteDisabled to BitmapNumDelete
           end-if.
      * FINE

           modify tool-cancella, enabled = e-cancella.
           modify tool-salva,    enabled = e-salva.
       
      * ISACCO (SERVE SEMPRE PER LA MODIFICA PRCEDENTE E PER RIPRISTINARE
      * LE BITMAP DISABILITATE. - 10/11/2003
      *     perform FORM1-DISPLAY.
           display tool-nuovo, tool-salva, tool-cancella, tool-modifica.
      * FINE 
           .
      * <TOTEM:END>

       ANTEPRIMA.
      * <TOTEM:PARA. ANTEPRIMA>
           set s-anteprima to true.
           perform STAMPA-ANTEPRIMA 
           .
      * <TOTEM:END>

       CALCOLA-TRASPORTO.
      * <TOTEM:PARA. CALCOLA-TRASPORTO>
           move 0 to costo-trasporto.
           move spaces to tge-chiave.
           read tparamge no lock.
           move ef-forn-buf    to desf-codice.
           move ef-destino-buf to desf-prog.
           read destinif no lock invalid continue end-read.
           move rlis-articolo to art-codice.
           read articoli no lock.
           if como-trasporto-f = 1
              compute costo-trasporto = 
                    ( art-peso-utf + art-peso-non-utf ) * tge-trasp-f
           end-if.
           if como-trasporto-c = 1
              compute costo-trasporto = costo-trasporto +
                    (( art-peso-utf + art-peso-non-utf ) * tge-trasp-c)
           end-if  
           .
      * <TOTEM:END>

       CANCELLA.
      * <TOTEM:PARA. CANCELLA>
           if mod = 0 exit paragraph end-if.
      *
           display message box MSG-Cancellare-il-record-corrente
                   title   titolo
                   type    mb-yes-no 
                   default mb-no
                   giving  scelta

           if scelta = mb-yes
              perform RIEMPI-CHIAVE
              delete tlistini record 
                 invalid 
                    continue
                 not invalid
                    perform DELETE-RIGHE
                    perform CANCELLA-NOTE
              end-delete

              move 0   to save-forn
              move 3   to num-copia
              move 0   to mod
              move 1   to mod-k
              move 7   to BitmapNumGridElimina
              perform FORM1-CLEAR
              set vecchio to true
              perform CANCELLA-COLORE
              perform INIT-OLD-REC
              perform RESETTA-GRID
              
              display message box 
           MSG-Cancellazione-avvenuta-con-successo
                      title titolo                         

              unlock tlistini all records

              perform PRIMO 
              move 78-ID-ef-codice to control-id     
              move 4               to accept-control 

              set Statusvisua to true
              perform STATUS-BAR-MSG
              modify TOOL-MODIFICA value = mod
           end-if 
           .
      * <TOTEM:END>

       CERCA.
      * <TOTEM:PARA. CERCA>
           evaluate CONTROL-ID
           when 78-ID-ef-forn
                inquire ef-forn, value in cli-codice
                set cli-tipo-F  to true
                move "clienti-all"  to Como-File
                call   "zoom-gt" using como-file, cli-rec
                                giving stato-zoom
                cancel "zoom-gt"
                if stato-zoom = 0
                   move cli-codice       to ef-forn-buf
                   move cli-ragsoc-1     to lab-forn-buf
                   display ef-forn lab-forn
                   move 4 to accept-control
                end-if
           when 78-ID-ef-destino
                inquire ef-forn, value in desf-codice
                inquire ef-destino, VALUE desf-prog
                move "destinif-forn"  to Como-File
                call   "zoom-gt" using como-file, desf-rec
                                giving stato-zoom
                cancel "zoom-gt"
                if stato-zoom = 0
                   move desf-prog        to ef-destino-buf
                   move desf-ragsoc-1    to lab-dest-buf
                   display ef-destino lab-dest
                   move 4 to accept-control
                end-if
      *
           when 78-ID-gd1
                perform X-Y
                evaluate colonna
                when 78-col-art
                     inquire gd1(riga, 78-col-art), 
                                               cell-data in art-codice
                     move "articoli"     to Como-File
                     call   "zoom-gt" using  como-file, art-rec
                                      giving stato-zoom
                     cancel "zoom-gt"
                     if stato-zoom = 0
                        perform CONTROLLA-ARTICOLO-GIA-INSERITO
                        if not trovato
                           move art-codice        to col-art
                           move art-descrizione   to col-des
                           modify gd1(riga, 78-col-art), 
                                                     cell-data = col-art
                           modify gd1(riga, 78-col-des), 
                                                     cell-data = col-des
                           perform CONTROLLO-RIGA
                        end-if
                     end-if
                when 78-col-tipo-imp
                     inquire gd1(riga, 78-col-tipo-imp), 
                                               cell-data in imf-codice
                     move "impforn"     to Como-File
                     call   "zoom-gt" using  como-file, imf-rec
                                      giving stato-zoom
                     cancel "zoom-gt"
                     if stato-zoom = 0
                        move imf-codice        to col-tipo-imp
                        move imf-descrizione   to col-des-imp
                        modify gd1(riga, 78-col-tipo-imp), 
                                               cell-data = col-tipo-imp
                        modify gd1(riga, 78-col-des-imp), 
                                               cell-data = col-des-imp
                     end-if
                end-evaluate
           end-evaluate  
           .
      * <TOTEM:END>

       COLORE-RIGA.
      * <TOTEM:PARA. COLORE-RIGA>
           modify gd1, start-x = 1,
                             x = 78-max-colonne,
                       start-y = riga,
                             y = riga,
                  region-color = 257,
                  cursor-color = 481 
           .
      * <TOTEM:END>

       CLEAR-SCREEN.
      * <TOTEM:PARA. CLEAR-SCREEN>
           move tlis-chiave of tlistini to old-tlis-chiave.

           initialize tlis-dati of tlistini 
                     replacing numeric data by zeroes
                          alphanumeric data by spaces.
                         
           perform FORM1-FLD-TO-BUF. 

           perform INIT-OLD-REC.
                                          
           display form1. 

           perform RESETTA-GRID.
  
           unlock tlistini all records 
           .
      * <TOTEM:END>

       CHECK-INSERIMENTO.
      * <TOTEM:PARA. CHECK-INSERIMENTO>
      * MODIFICA LA STATUS-BAR
      * CONTROLLO SE DA INSERIMENTO SCORRO. ALLORA DEVO SEGNALARE CHE
      * SONO TORNATO IN MODIFICA.
           inquire tool-modifica, value in mod.

           evaluate mod
           when 1  
                set StatusModifica to true
           when 0
                set StatusVisua    to true   
           end-evaluate.
      
           perform STATUS-BAR-MSG 
           .
      * <TOTEM:END>

       CONTROLLA-ARTICOLO-GIA-INSERITO.
      * <TOTEM:PARA. CONTROLLA-ARTICOLO-GIA-INSERITO>
           set trovato  to false.

           perform varying store-riga from 2 by 1 until
                           store-riga > tot-righe
              inquire gd1(store-riga, 1), cell-data in store-articolo
              if store-articolo  = art-codice and 
                 store-riga  not = riga
                 set trovato to true
                 subtract 1 from store-riga
                 display message "Articolo già inserito a riga: " 
           store-riga
                           title tit-err
                            icon 2
                 set errori to true
                 move spaces to col-des
                 modify gd1(riga, 2), cell-data = col-des
                 exit perform
              end-if
           end-perform 
           .
      * <TOTEM:END>

       CONTROLLA-PERIODO-PROMO.
      * <TOTEM:PARA. CONTROLLA-PERIODO-PROMO>
      *     move ef-forn-buf     to store-forn
      *                             tlis-fornitore of tlistini1.
      *     move ef-destino-buf  to store-destino
      *                             tlis-destino of tlistini1.
      *     move ef-codice-buf   to store-codice.
      *
      *
      *     start tlistini1 key >= tlis-chiave-ricerca of tlistini1
      *        invalid 
      *           continue
      *        not invalid
      *           perform until 1 = 2
      *              read tlistini1 next 
      *                 at end 
      *                    exit perform 
      *              end-read
      *              if tlis-fornitore of tlistini1 not = store-forn or
      *                 tlis-destino of tlistini1 not = store-destino or
      *                 tlis-ini-val  of tlistini1 not = store-ini or
      *                 tlis-fine-val of tlistini1 not = store-fine
      *                 exit perform
      *              end-if
      *
      *              if tlis-codice of tlistini1 not = tlis-codice of tlistini
      *                 move tlis-ini-val of tlistini1 to como-data
      *                 perform DATE-TO-SCREEN
      *                 move como-data to val-ini
      *
      *                 move tlis-fine-val  of tlistini1 to como-data
      *                 perform DATE-TO-SCREEN
      *                 move como-data to val-fine
      *
      *                 display message 
      *                       "Codice: ", tlis-codice of tlistini1
      *                 x"0d0a" tlis-descrizione       of tlistini1
      *                 x"0d0a""Periodo validità: " val-ini " - " val-fine
      *                 x"0d0a""Continuare?"
      *                           title "ATTENZIONE!!!"
      *                            icon 2
      *                            type mb-yes-no
      *                         default mb-no
      *                          giving scelta
      *                 if scelta = mb-no
      *                    set errori to true
      *                    exit perform
      *                 end-if
      *              end-if
      *          end-perform
      *     end-start.

           if nuovo
              move zero            to cdl-codice
           else
              inquire ef-codice, VALUE cdl-codice
           end-if

           move ef-forn-buf        to cdl-fornitore
           move ef-destino-buf     to cdl-destino

           move ef-ini-val-buf  to como-data.
           perform DATE-TO-FILE.
           move como-data to cdl-ini-val
      
           move ef-fine-val-buf to como-data.
           perform DATE-TO-FILE.
           move como-data to cdl-fine-val

           call "contr-dt-list" using contr-dt-list-linkage
           cancel "contr-dt-list"

           if cdl-sovrapposizione
              set errori  to true
           end-if 
           .
      * <TOTEM:END>

       CONTROLLO.
      * <TOTEM:PARA. CONTROLLO>
           set tutto-ok to true. 

           evaluate CONTROL-ID
           when 78-ID-ef-codice
                perform RIEMPI-CHIAVE           
                if ef-codice-buf not = spaces                           
                               
                   inspect ef-codice-buf replacing trailing 
                                         spaces by low-values
                   initialize CountChar
                   inspect ef-codice-buf tallying CountChar 
                           for characters before low-value
                   inspect ef-codice-buf replacing trailing 
                                         low-values by spaces

                   | SE E' NUMERICO LEGGO IL RECORD NORMALMENTE
                   if ef-codice-buf(1:CountChar) is numeric
                      perform SELEZIONA-NUMERICO
                   else                     
                      | HO DIGITATO UNA SIGLA ALFANUMERICA QUINDI 
                      | APRO LO ZOOM (CASE SENSITIVE)
                      perform SELEZIONA-ALFA
                   end-if
                   move 78-ID-ef-codice to control-id
                   move 4               to accept-control

                else
                   set errori to true  
                   move 78-ID-ef-codice to control-id
                   display message box MSG-record-inesistente
                           title = tit-err
                           icon mb-warning-icon
                end-if
           when 78-ID-ef-forn
                inquire ef-forn value in cli-codice
                set cli-tipo-F  to true
                read clienti no lock
                   invalid
                      move spaces to cli-ragsoc-1
                      set errori to true
                      display message "Fornitore non valido"
                              title tit-err
                              icon 2
                end-read
                move cli-ragsoc-1 to lab-forn-buf
                display lab-forn

           when 78-ID-ef-destino
                inquire ef-forn value in desf-codice
                inquire ef-destino value in desf-prog
                read destinif no lock
                   invalid
                      move spaces to desf-ragsoc-1
                      set errori to true
                      display message "Destino non valido"
                              title tit-err
                              icon 2
                end-read
                move desf-ragsoc-1 to lab-dest-buf
                display lab-dest
      ****          if tutto-ok
      ****             if gdo-codice not = save-gdo and not StoSalvando
      ****                perform RIEMPI-GRID-DESTINI
      ****             end-if
      ****          end-if

                if tutto-ok
                   if desf-codice not = como-old-forn or
                      desf-prog   not = como-old-dest
                      perform VAL-NOTE-FORN
                      move desf-codice   to como-old-forn
                      move desf-prog     to como-old-dest
                   end-if
                end-if

           when 78-ID-ef-ini-val
                inquire ef-ini-val, value in como-data
                perform DATE-FORMAT
                move como-data to ef-ini-val-buf
                display ef-ini-val

           when 78-ID-ef-fine-val
                inquire ef-fine-val, value in como-data
                perform DATE-FORMAT
                move como-data to ef-fine-val-buf                
                display ef-fine-val
                perform DATE-TO-FILE
                move como-data to como-data-to
                inquire ef-ini-val, value in como-data
                perform DATE-TO-FILE
                if como-data-to < como-data
                   set errori to true
                   display message "Range Date Validità errato"
                             title tit-err
                              icon 2
                   move 78-ID-ef-ini-val to control-id
                end-if

                if tutto-ok
                   perform CONTROLLA-PERIODO-PROMO
                   if errori
                      move 78-ID-ef-ini-val to control-id
                   end-if
                end-if
      
           when 78-ID-ef-note
                inquire ef-note, value in lab-nome-buf
                display lab-nome

           end-evaluate.
      
           if errori
              perform CANCELLA-COLORE
              move CONTROL-ID to store-id
              move 4          to ACCEPT-CONTROL
           end-if 
           .
      * <TOTEM:END>

       CONTROLLO-RIGA.
      * <TOTEM:PARA. CONTROLLO-RIGA>
           set tutto-ok to true.
           if mod = 0 
              exit paragraph 
           end-if.

           evaluate colonna
           when 78-col-art
                if art-codice < 90000
                   read articoli no lock
                        invalid
                        set errori to true
                        display message "Articolo NON valido"
                                  title tit-err
                                   icon 2
                        move spaces to art-descrizione
                   end-read
                   modify gd1(riga, 78-col-des), 
                                            cell-data art-descrizione
                   if col-art-forn = spaces
                      modify gd1(riga, 78-col-art-forn),
                             cell-data art-cod-art-frn
                   end-if
                else
                   move space   to art-cod-art-frn
                end-if
                if rlis-disponibilita = 0
                   move 999999999 to rlis-disponibilita
                   move rlis-disponibilita to col-disp
                   modify gd1(riga, 78-col-disp), cell-data col-disp
                end-if
                if rlis-lead-time = 0
                   move desf-gg-consegna to rlis-lead-time
                   move rlis-lead-time to col-lead-time
                   modify gd1(riga, 78-col-lead-time), 
                                               cell-data col-lead-time
                end-if
      *          if rlis-tipo-tratt-imposte = spaces
      *             move "G" to rlis-tipo-tratt-imposte col-tipo-imp
      *             modify gd1(riga, 78-col-tipo-imp), 
      *                                         cell-data col-tipo-imp
      *          end-if
                if rlis-articolo not = como-old-rlis-articolo
                   move art-cod-art-frn  to col-art-forn

                   modify gd1(riga, 78-col-art-forn), 
                                         cell-data col-art-forn
                   move rlis-articolo to como-old-rlis-articolo
                end-if
                if rlis-PFA = space
                   move "S"  to col-PFA
                   modify gd1(riga, 78-col-PFA), 
                                         cell-data col-PFA
                end-if

           when 78-col-des
                if col-des = spaces
                   set errori to true
                   display message "Descrizione NON valida"
                           title tit-err
                           icon 2
                end-if
           when 78-col-art-forn
                continue
      *****          if col-art-forn not = space and not controllo-finale
      *****             perform CERCA-IN-GRIGLIA-ART-FORN
      *****          end-if

           when 78-col-prz-acq
                continue
      *****          if como-prz-acq = 0
      *****             set errori to true
      *****             display message "Prezzo d'acquisto obbligatorio"
      *****                       title tit-err
      *****                        icon 2
      *****          end-if 

           when 78-col-sconto-1
                if como-sconto-1 > 100
                   set errori to true
                   display message "Sconto errato"
                             title tit-err
                              icon 2
                end-if 
           when 78-col-sconto-2
                if como-sconto-2 > 100
                   set errori to true
                   display message "Sconto errato"
                             title tit-err
                              icon 2
                end-if 
           when 78-col-sconto-3
                if como-sconto-3 > 100
                   set errori to true
                   display message "Sconto errato"
                             title tit-err
                              icon 2
                end-if 
           when 78-col-sconto-4
                if como-sconto-4 > 100
                   set errori to true
                   display message "Sconto errato"
                             title tit-err
                              icon 2
                end-if 
           when 78-col-sconto-5
                if como-sconto-5 > 100
                   set errori to true
                   display message "Sconto errato"
                             title tit-err
                              icon 2
                end-if 
      *     when 78-col-costi-agg
           when 78-col-disp
                if como-disp = 0
                   set errori to true
                   display message "Disponibilità obbligatoria"
                             title tit-err
                              icon 2
                end-if 

           when 78-col-lead-time
                if como-lead-time = 0
                   move 20 to col-lead-time
                   modify gd1(riga, 78-col-lead-time), 
                                               cell-data col-lead-time
                else
                   move como-lead-time to rlis-lead-time
                   divide rlis-lead-time by 20 giving como-lt
                   multiply como-lt      by 20 giving como-lt
                   if como-lt not = rlis-lead-time
                      set errori to true
                     display message "Inserire un valore multiplo di 20"
                                title tit-err
                                 icon 2
                      move 78-col-lead-time to colonna
                   end-if
                end-if 
      *     when 78-col-lead-time


           when 78-col-tipo-imp
      *          evaluate col-tipo-imp
      *          when "E"
      *          when "G"
      *          when "S" continue
      *          when other
      *               set errori to true
      *               display message 
      *                             "Trattamente Imposte NON valido!"
      *                         title tit-err
      *                          icon 2
      *               move 78-col-tipo-imp to colonna
      *          end-evaluate
                move col-tipo-imp  to imf-codice
                read impforn no lock
                   invalid
                      set errori to true
                      display message "Trattamento Imposte NON valido!"
                              title tit-err
                              icon 2
                      move spaces to imf-descrizione
                end-read
                modify gd1(riga, 78-col-des-imp), cell-data 
           imf-descrizione
           when 78-col-PFA
                if col-PFA not = "S" and col-PFA not = "N"
                   set errori to true
                   display message "Tipo PFA errato"
                             title tit-err
                              icon 2
                end-if 

           end-evaluate.

      ********---
      ***** CERCA-IN-GRIGLIA-ART-FORN.
      ******    salvo la posizione iniziale
      *****     inquire gd1, cursor-y = como-riga.
      *****     move riga   to store-riga
      *****     perform varying riga from 2 by 1 until riga > tot-righe
      *****        inquire gd1(riga, 3) cell-data in como-art-forn
      *****        if como-art-forn = col-art-forn
      *****           if riga not = como-riga
      *****              set errori to true
      *****             display message box "Articolo fornitore già inserito"
      *****              exit perform
      *****           end-if
      *****        end-if
      *****     end-perform.
      *****     move store-riga   to riga.
      *****     modify gd1, cursor-y = como-riga 
           .
      * <TOTEM:END>

       CURRENT-RECORD.
      * <TOTEM:PARA. CURRENT-RECORD>
           perform RIEMPI-CHIAVE.
           set tutto-ok  to true.
           set ReadSecca to true.
           if nuovo move 0 to mod end-if.
      
           if mod = 1
              read tlistini lock 
                 invalid
                    set errori to true 
              end-read
           else
              read tlistini no lock 
                 invalid 
                    set errori to true 
              end-read
           end-if.                    
           set ReadSecca to false.
      
           if RecLocked
              set RecLocked to false
           else
              if tutto-ok
                 perform CANCELLA-COLORE
                 if nuovo
                    move 0      to mod
                    move 1      to mod-k
                    move 78-ID-ef-codice to control-id
                    move 4      to accept-control
                 else
                    move 78-ID-ef-forn to control-id
                    move 4      to accept-control
                 end-if   
                 perform FORM1-IUD-DISPLAY
                 set vecchio to true
                 if mod = 1
                    set StatusModifica to true
                 else                         
                    set StatusVisua    to true
                 end-if
                 perform STATUS-BAR-MSG
                 perform LOAD-NOTE
                 perform VALORIZZA-OLD
                 perform RIEMPI-GRID
              else
                 move 0 to mod
                 move 1 to mod-k
                 if vecchio
                    perform CLEAR-SCREEN
                    if YesMessage
                       move 78-ID-ef-codice to CONTROL-ID
                       move 4               to accept-control
                       display message MSG-Record-inesistente
                                 title tit-err
                                  icon 2
                    end-if
                 end-if
              end-if
           end-if 
           .
      * <TOTEM:END>

       DELETE-RIGHE.
      * <TOTEM:PARA. DELETE-RIGHE>
           move tlis-codice of tlistini to rlis-codice.
           move low-value  to rlis-articolo.
           start rlistini key >= rlis-chiave
              invalid 
                 continue
              not invalid
                 perform until 1 = 2
                    read rlistini next 
                       at end 
                          exit perform 
                    end-read
                    if rlis-codice not = tlis-codice of tlistini
                       exit perform 
                    end-if
                    delete rlistini record 
                       invalid 
                          continue 
                    end-delete
                 end-perform
           end-start 
           .
      * <TOTEM:END>

       HELP-GRID.
      * <TOTEM:PARA. HELP-GRID>
           move 0 to StatusHelp.

           if mod = 1
              evaluate colonna
              when 78-col-art
                   move "Digitare l'articolo"        to totem-hint-text
                   move 1 to StatusHelp
              when 78-col-des      
                   move "Descrizione Articolo"       to totem-hint-text
              when 78-col-art-forn 
                   move "Digitare il cod. articolo fornitore"
                                                     to totem-hint-text
              when 78-col-prz-acq  
                   move "Digitare il prezzo d'acquisto"  
                                                     to totem-hint-text
              when 78-col-sconto-1 
                   move "Digitare il primo sconto"   to totem-hint-text
              when 78-col-sconto-2 
                   move "Digitare il secondo sconto" to totem-hint-text
              when 78-col-sconto-3 
                   move "Digitare il terzo sconto"   to totem-hint-text
              when 78-col-sconto-4
                   move "Digitare il quarto sconto"   to totem-hint-text
              when 78-col-sconto-5
                   move "Digitare il quinto sconto"   to totem-hint-text
              when 78-col-costi-agg
                   move "Digitare i costi aggiuntivi"
                                                     to totem-hint-text
              when 78-col-perce-agg
                   move "Digitare la percentuale aggiuntiva"
                                                     to totem-hint-text
              when 78-col-disp     
                   move "Digitare la disponibilità del fornitore"  
                                                     to totem-hint-text
              when 78-col-lead-time
                   move "Digitare il Lead-Time"      to totem-hint-text
              when 78-col-tipo-imp
      *             move "Valori ammessi S = Standard; E = Estero; G = GDO"
      *                                               to totem-hint-text
                   move "Digitare il Tipo imposta"   to totem-hint-text
                   move 1 to StatusHelp

              when 78-col-piombo
                   move "Digitare la percentuale dell'Addizionale Piombi
      -    "o"
                                                     to totem-hint-text
              when 78-col-netto
                   move "Digitare il prezzo netto"
                                                     to totem-hint-text
              when 78-col-PFA
                   move "Valori ammessi S = Si, N = No"       
                                                     to totem-hint-text
              when other
                   move space                        to totem-hint-text

              end-evaluate
           else
              evaluate colonna
              when 78-col-art
                   move "Codice Articolo"            to totem-hint-text
              when 78-col-des      
                   move "Descrizione Articolo"       to totem-hint-text
              when 78-col-art-forn 
                   move "Codice articolo fornitore"  to totem-hint-text
              when 78-col-prz-acq  
                   move "Prezzo d'acquisto"          to totem-hint-text
              when 78-col-sconto-1 
                   move "Primo sconto"               to totem-hint-text
              when 78-col-sconto-2 
                   move "Secondo sconto"             to totem-hint-text
              when 78-col-sconto-3 
                   move "Terzo sconto"               to totem-hint-text
              when 78-col-sconto-4 
                   move "Quarto sconto"               to totem-hint-text
              when 78-col-sconto-5 
                   move "Quinto sconto"               to totem-hint-text
              when 78-col-costi-agg
                   move "Costi aggiuntivi"           to totem-hint-text
              when 78-col-perce-agg
                   move "Percentuale aggiuntiva"     to totem-hint-text
              when 78-col-disp     
                   move "Disponibilità del fornitore"  
                                                     to totem-hint-text
              when 78-col-lead-time
                   move "Lead-Time"                  to totem-hint-text
              when 78-col-tipo-imp
      *             move "Valori ammessi S = tipo standard / tradizionale
      *-          ", G = GDO Scorporo, E = Estero senza imposte"       
      *                                               to totem-hint-text
                   move "Tipo Imposta"   to totem-hint-text
              when 78-col-piombo
                   move "Percentuale Addizionale Piombio"        
                                                     to totem-hint-text
              when 78-col-netto
                   move "Prezzo netto"               to totem-hint-text
              when other
                   move space                        to totem-hint-text

              end-evaluate
           end-if

           modify Form1-St-1-Handle, panel-index = 1,
                                     panel-text  = totem-hint-text.
           perform STATUS-HELP 
           .
      * <TOTEM:END>

       INIT.
      * <TOTEM:PARA. INIT>
           move 0 to StatusHelp.
           move 1 to mod-k.
           set StatusVisua    to true  
           .
      * <TOTEM:END>

       INIT-OLD-REC.
      * <TOTEM:PARA. INIT-OLD-REC>
           initialize old-tlis-rec replacing numeric data by zeroes
                                       alphanumeric data by spaces.

           initialize old-rlis-rec replacing numeric data by zeroes
                                       alphanumeric data by spaces 
           .
      * <TOTEM:END>

       MODIFICA.
      * <TOTEM:PARA. MODIFICA>
           move 5 to key-status.
           inquire tool-modifica, value in mod.
           set tutto-ok to true.

           if nuovo
              move 1   to mod                  
              move 1   to num-copia
              modify tool-modifica, value mod
           else
      *  SE L'UTENTE E' ABILITATO PUO' MODIFICARE UN RECORD
              if mod = 1
                 set YesMessage to true
                 perform CURRENT-RECORD
                 if tutto-ok
                    move 0   to mod-k
                    move 1   to mod
                    move 1   to num-copia
                    set StatusModifica to true
                    perform STATUS-BAR-MSG
                 end-if
              else
                 move 1 to mod
                 perform SALV-MOD            
                 move 0 to mod
                 move 1 to mod-k
                 if errori
                    move 1 to mod
                    move 0 to mod-k
                 else
                    move 3   to num-copia
                    move 78-ID-ef-codice to control-id
                    set NoMessage to true
                    perform CURRENT-RECORD
                    set StatusVisua to true
                    perform STATUS-BAR-MSG 
                    unlock tlistini all records
                 end-if
              end-if

              if mod = 1
                 move 4   to BitmapNumGridElimina
              else
                 move 7   to BitmapNumGridElimina
              end-if
                        
              display form1
              modify tool-modifica,  value mod
              perform CANCELLA-COLORE 

              move 4 to ACCEPT-CONTROL
           end-if 
           .
      * <TOTEM:END>

       NUOVO.
      * <TOTEM:PARA. NUOVO>
           perform SALV-MOD.

           if tutto-ok  
              move 78-ID-ef-forn   to control-id       
              move 4               to accept-control   
              move 1               to mod mod-k
              modify tool-modifica,  value = mod
              perform CANCELLA-COLORE                  
              perform VALORIZZA-NUOVO
              move 1   to num-copia
              modify pb-copia, BITMAP-NUMBER num-copia
              move 4               to BitmapNumGridElimina
              modify pb-grid-elimina, BITMAP-NUMBER BitmapNumGridElimina

              perform INIT-OLD-REC
              move tlis-chiave of tlistini to old-tlis-chiave
              set StatusIns to true
              perform STATUS-BAR-MSG  
              set nuovo to true
           end-if 
           .
      * <TOTEM:END>

       PRECEDENTE.
      * <TOTEM:PARA. PRECEDENTE>
           perform SALV-MOD.           
           if tutto-ok     
              perform CHECK-INSERIMENTO
              unlock tlistini all records 
      
              perform RIEMPI-CHIAVE
      
              start tlistini key < tlis-chiave of tlistini
                 invalid  
                    set errori to true
                 not invalid 
                    read tlistini previous no lock
                       at end   
                          set errori to true 
                    end-read
              end-start
      
              if tutto-ok
                 if nuovo
                    perform CANCELLA-COLORE
                    move 78-ID-ef-codice to control-id
                    move 4               to accept-control
                 end-if
                 move tlis-codice of tlistini to ef-codice-buf
                 display ef-codice
                 set ReadSecca             to false
                 perform CURRENT-RECORD
              else
                 display message "File [TLISTINI]"
                          x"0d0a""Raggiunto inizio file"
                           title titolo
              end-if
      
           end-if 
           .
      * <TOTEM:END>

       PRIMO.
      * <TOTEM:PARA. PRIMO>
           perform SALV-MOD.
           if tutto-ok
              perform CHECK-INSERIMENTO
              unlock tlistini all records 
      
              move low-value   to tlis-chiave of tlistini
              start tlistini key >= tlis-chiave of tlistini
                 invalid  
                    set errori to true
                 not invalid 
                    read tlistini next no lock
                       at end
                          set errori to true 
                    end-read
              end-start
      
              if tutto-ok
                 if nuovo
                    perform CANCELLA-COLORE
                    move 78-ID-ef-codice to control-id
                    move 4               to accept-control
                 end-if
                 move tlis-codice of tlistini to ef-codice-buf
                 display ef-codice
                 set  ReadSecca            to false
                 perform CURRENT-RECORD
              else
                 perform CLEAR-SCREEN
                 display message "File [TLISTINI]"
                          x"0d0a""Archivio vuoto"
                           title titolo
                 perform CANCELLA-COLORE
                 move 78-ID-ef-codice to control-id
                 move 4               to accept-control
              end-if
      
           end-if 
           .
      * <TOTEM:END>

       PUNTA-CELLA.
      * <TOTEM:PARA. PUNTA-CELLA>
           move 78-ID-gd1    to control-id store-id.
           move 4            to accept-control.
           modify gd1,       cursor-y riga, 
                             cursor-x colonna.
           perform COLORE-RIGA 
           .
      * <TOTEM:END>

       RESETTA-GRID.
      * <TOTEM:PARA. RESETTA-GRID>
           modify gd1, reset-grid = 1.
           perform GD1-CONTENT.
           initialize rec-grid.
           modify gd1, insert-rows = 9999 
           .
      * <TOTEM:END>

       RIEMPI-CHIAVE.
      * <TOTEM:PARA. RIEMPI-CHIAVE>
           inquire ef-codice, value in ef-codice-buf
           move ef-codice-buf   to tlis-codice of tlistini convert 
           .
      * <TOTEM:END>

       RIEMPI-GRID.
      * <TOTEM:PARA. RIEMPI-GRID>
           modify gd1, mass-update = 1.
           perform RESETTA-GRID.
           move tlis-codice of tlistini to rlis-codice.

           set tutto-ok   to true
           evaluate true
           when ord-descr
                move low-value to rlis-des-libera
                start rlistini key >= rlis-k-descr
                   invalid  
                      set errori  to true
                end-start
              
           when ord-cod
                move low-value to rlis-articolo
                start rlistini key >= rlis-chiave
                   invalid  
                      set errori  to true
                end-start
           end-evaluate.

           if tutto-ok
              move 2 to riga
              perform until 1 = 2
                 read rlistini next no lock 
                    at end 
                       exit perform 
                 end-read
                 if rlis-codice not = tlis-codice of tlistini
                    exit perform
                 end-if
                 move rlis-articolo   to art-codice 
                                         col-art
                 if art-codice < 90000
                    read articoli no lock 
                       invalid move "** NON TROVATO **" to 
           art-descrizione
                    end-read
                 else
                    move rlis-des-libera to art-descrizione
                 end-if
                 move art-descrizione          to col-des
                 move rlis-art-forn            to col-art-forn
                 move rlis-prz-acq             to col-prz-acq  
                 move rlis-sconto-1            to col-sconto-1 
                 move rlis-sconto-2            to col-sconto-2 
                 move rlis-sconto-3            to col-sconto-3 
                 move rlis-sconto-4            to col-sconto-4 
                 move rlis-sconto-5            to col-sconto-5 
                 move rlis-costi-agg           to col-costi-agg
                 move rlis-perce-agg           to col-perce-agg
                 move rlis-perce-pb            to col-perce-pb
                 move rlis-netto               to col-netto
                 move rlis-disponibilita       to col-disp     
                 move rlis-lead-time           to col-lead-time
                 move rlis-tipo-tratt-imposte  to col-tipo-imp
                                                  imf-codice
                 move rlis-PFA                 to col-pfa
                 read impforn 
                      invalid move space to imf-descrizione
                 end-read

                 move 0 to prg-peso-utf prg-peso-non-utf          
                 move tlis-trasp-f of tlistini to como-trasporto-f
                 move tlis-trasp-c of tlistini to como-trasporto-c
                 perform CALCOLA-PRZ-FINITO
                 move imf-descrizione          to col-des-imp
                 move prz-reale                to col-prz-tot
                 move prz-confronto            to col-prz-conf

                 modify gd1(riga, 78-col-art), cell-data col-art       
                 modify gd1(riga, 78-col-des), cell-data col-des       
                 modify gd1(riga, 78-col-art-forn), 
                                               cell-data col-art-forn  
                 modify gd1(riga, 78-col-prz-acq), 
                                               cell-data col-prz-acq   
                 modify gd1(riga, 78-col-sconto-1), 
                                               cell-data col-sconto-1  
                 modify gd1(riga, 78-col-sconto-2), 
                                               cell-data col-sconto-2  
                 modify gd1(riga, 78-col-sconto-3), 
                                               cell-data col-sconto-3  
                 modify gd1(riga, 78-col-sconto-4), 
                                               cell-data col-sconto-4  
                 modify gd1(riga, 78-col-sconto-5), 
                                               cell-data col-sconto-5  
                 modify gd1(riga, 78-col-netto) cell-data col-netto
                 modify gd1(riga, 78-col-costi-agg), 
                                            cell-data col-costi-agg 
                 modify gd1(riga, 78-col-perce-agg), 
                                            cell-data col-perce-agg 
                 modify gd1(riga, 78-col-piombo), 
                                            cell-data col-perce-pb
                 modify gd1(riga, 78-col-disp), cell-data col-disp
                 modify gd1(riga, 78-col-lead-time),
                                            cell-data col-lead-time 
                 modify gd1(riga, 78-col-tipo-imp), 
                                            cell-data col-tipo-imp
                 modify gd1(riga, 78-col-des-imp),
                                            cell-data col-des-imp
                 modify gd1(riga, 78-col-prz-tot), 
                                            cell-data col-prz-tot
                 modify gd1(riga, 78-col-prz-conf), 
                                            cell-data col-prz-conf
                 modify gd1(riga, 78-col-PFA), 
                                            cell-data col-PFA
                                            
                 modify gd1(riga, 1), hidden-data rlis-costi-agg-tot
                 modify gd1(riga, 2), hidden-data rlis-scelta
                 modify gd1(riga, 3), hidden-data rlis-sconti-zero
                 add 1 to riga
              end-perform
              subtract 2 from riga giving RigheIniziali
           end-if.
           modify gd1, mass-update = 0.
           move 2 to riga.
           move 1 to colonna.
           perform PUNTA-CELLA.
           perform VALORE-RIGA.
           move rlis-rec to old-rlis-rec.
           move rlis-articolo   to como-old-rlis-articolo
           .
      * <TOTEM:END>

       SALVA.
      * <TOTEM:PARA. SALVA>
           if mod = 0 
              exit paragraph 
           end-if.

           set tutto-ok to true.

           set controllo-finale to true.
           perform varying control-id from 78-ID-ef-codice by 1
                     until control-id > 78-ID-ef-fine-val
              perform CONTROLLO
              if errori 
                 exit perform
              end-if
           end-perform.
      
           if tutto-ok
              perform X-Y
              if tot-righe = 1
                 set errori to true
                 display message "Nessun articolo inserito"
                           title tit-err
                            icon 2
                 move 78-ID-gd1 to control-id
                 move 1 to colonna
              else
                 perform FORM1-BUF-TO-FLD
                 perform varying riga from 2 by 1 
                           until riga > tot-righe
                    perform VALORE-RIGA
                    move col-art to como-old-rlis-articolo
                    perform varying colonna from 1 by 1
                              until colonna > 16
                       perform CONTROLLO-RIGA
                       if errori 
                          move 78-ID-gd1 to store-id
                          exit perform 
                       end-if
                    end-perform
                    if errori 
                       exit perform 
                    else
                       perform SCRIVI-RIGA
                    end-if
                 end-perform
              end-if
           end-if.

           set controllo-finale to false
      
           if errori
              perform ABILITAZIONI
              if store-id = 78-ID-gd1
                 perform CANCELLA-COLORE
                 perform PUNTA-CELLA
              else
                 move store-id to control-id
                 move 4        to accept-control
              end-if
           else

              perform FORM1-BUF-TO-FLD
              perform VALORIZZA-DATI-COMUNI
              perform CANCELLA-COLORE

      *        perform DELETE-RIGHE
      *        perform SCRIVI-RIGHE

              write tlis-rec of tlistini
                    invalid rewrite tlis-rec of tlistini 
              end-write

              perform CANCELLA-NOTE
              perform SALVA-NOTE

              accept  data-oggi from century-date
              compute como-data = function integer-of-date (data-oggi)
              add 20 to como-data
              compute como-data = function date-of-integer (como-data)

              set vecchio to true

              set vecchio      to true
              set stampa       to true

              perform TORNA-IN-VISUA
              perform VALORIZZA-OLD

           end-if.

           display form1 
           .
      * <TOTEM:END>

       SALV-MOD.
      * <TOTEM:PARA. SALV-MOD>
           set tutto-ok to true.
           perform FORM1-CONTROLLO-OLD.

           if SiSalvato and mod = 1
              if RigaCambiata not = 0 or ColonnaCambiata not = 0
                 set NoSalvato  to true
                 move 78-ID-gd1 to store-id
                 move ColonnaCambiata to colonna
                 move RigaCambiata    to riga
              end-if
           end-if.    

           if SiSalvato and mod = 1
              inquire gd1, last-row in tot-righe
              subtract 1 from tot-righe
              if tot-righe not = RigheIniziali |or inserito-extra
                 add 2 to RigheIniziali giving riga
                 set NoSalvato  to true
                 move 78-ID-gd1 to store-id
                 move 1 to colonna
              end-if
           end-if.

           |Specifico per il programma dei promo
           if SiSalvato and mod = 1
              perform X-Y
              |non lascio una testa di un volantino senza righe 
              if tot-righe = 1
                 perform RIEMPI-CHIAVE
                 delete tlistini record invalid continue end-delete
              end-if
           end-if.
           ||||
      
           if NoSalvato
              display message MSG-Salvare-le-modifiche
                        title titolo
                         type mb-yes-no-cancel 
                       giving scelta       
       
              evaluate scelta
              when mb-yes 
                   perform SALVA
              when mb-no  
                   continue
                   if nuovo
                      perform RIEMPI-CHIAVE
                      delete tlistini record invalid continue end-delete
                   end-if
              when other                
                   perform CANCELLA-COLORE
                   set errori to true
                   evaluate store-id
                   when 78-ID-gd1     
                        perform PUNTA-CELLA
                   when other
                      move store-id to control-id       
                      move 4        to accept-control   
                   end-evaluate
              end-evaluate
           else
              if nuovo
                 perform RIEMPI-CHIAVE
                 delete tlistini record invalid continue end-delete
              end-if
           end-if 
           .
      * <TOTEM:END>

       SCRIVI-RIGA.
      * <TOTEM:PARA. SCRIVI-RIGA>
           if rlis-articolo = zero
              exit paragraph
           end-if.

           move tlis-codice of tlistini to rlis-codice
           move tlis-chiave-ricerca of tlistini 
                                               to rlis-chiave-ricerca

           if rlis-data-creazione   = 0
              accept rlis-data-creazione from century-date
           end-if
           if rlis-ora-creazione    = 0
              accept rlis-ora-creazione  from time
           end-if
           if rlis-utente-creazione = space
              move user-codi to rlis-utente-creazione
           end-if

           accept rlis-data-modifica from century-date
           accept rlis-ora-modifica  from time
           move user-codi    to rlis-utente-modifica

           move tlis-chiave-ricerca of tlistini   
                                            to rlis-chiave-ricerca

           write rlis-rec invalid rewrite rlis-rec end-write
           .
      * <TOTEM:END>

       SELEZIONA.
      * <TOTEM:PARA. SELEZIONA>
           set tutto-ok to true.
           move zero   to link-fornitore
           perform SEL-LISTINI.

      ***---
       SEL-LISTINI.
           call   "sel-listini" using link-codice 
                                      link-articolo 
                                      link-fornitore.
           cancel "sel-listini".

           if link-codice not = 0

              if link-codice not = tlis-codice of tlistini
                 perform SALV-MOD
              end-if

              if tutto-ok
                 set  ReadSecca   to true
                 move link-codice to tlis-codice of tlistini 
                 move link-codice to ef-codice-buf
                 display ef-codice
                 perform CURRENT-RECORD
                 if link-articolo = 0
                    move 2 to riga
                 else
                    move store-riga to riga
                 end-if
                 move 1 to colonna
                 perform PUNTA-CELLA
                 perform CANCELLA-COLORE
                 if link-articolo = 0
                    move 78-ID-ef-codice to control-id
                    move 4               to accept-control
                 end-if
              end-if

           end-if.


      ***---
       SELEZIONA-NUMERICO.
           if tlis-codice of tlistini not > 0
              set errori to true
              move 78-ID-ef-codice to control-id
              display message box msg-codice-obbligatorio
                      title tit-err
                      icon  mb-warning-icon
           else           
              read tlistini no lock
                   invalid
                   if vecchio
                      display message MSG-record-inesistente
                                title tit-err
                                 icon 2
                      perform CLEAR-SCREEN
                      set errori to true
                   end-if
               not invalid      
                   if old-tlis-chiave not = tlis-chiave of tlistini or
                    ( tlis-codice of tlistini = 0 and mod = 0 )
                      perform CURRENT-RECORD 
                   end-if
              end-read
           end-if.

      ***---
       SELEZIONA-ALFA.
      * LA SECONDA CHIAVE E' ALFANUMERICA E LA VALUE VARIABLE CONTIENE
      * ANCORA GLI ZERI DAVANTI CHE ELIMINO
           inspect ef-codice-buf replacing leading ZERO by SPACES.
           move ef-codice-buf to cli-ragsoc-1.


      * POI GIUSTIFICO A SINISTRA E MI POSIZIONO SULLO ZOOM PER CHIAVE
      * ALTERNATA
           call "C$JUSTIFY" using cli-ragsoc-1, "L".
           move low-value to cli-codice
                        
           set cli-tipo-F to true.
           start clienti key not < cli-k1
              invalid 
                 initialize cli-rec
              not invalid 
                 read clienti next 
                    if cli-tipo-C
                       initialize cli-rec
                    end-if
           end-start.
           set cli-tipo-F to true.

           if cli-ragsoc-1 = ef-codice-buf
              move cli-codice   to link-fornitore
              perform SEL-LISTINI
           else
              move "clienti-alfa-all" to como-file
              call "zoom-gt"  using  como-file, cli-rec
                              giving  stato-zoom
              cancel "zoom-gt"
              if stato-zoom = 0
                 move cli-codice    to link-fornitore
                 perform SEL-LISTINI
              end-if
      *     else
      *        set errori           to true
      *        move 78-ID-ef-codice to CONTROL-ID
           end-if 

           .
      * <TOTEM:END>

       SPOSTAMENTO.
      * <TOTEM:PARA. SPOSTAMENTO>
           set tutto-ok to true.
           perform X-Y.
      
           if event-data-2 not = riga
      
              perform VALORE-RIGA

              if art-codice not = 0      or
                 col-art    not = spaces or
                 como-acq   not = 0      or
                 como-ven   not = 0      or
                 como-qta   not = 0
                 perform varying colonna from 78-col-art by 1
                           until colonna > 78-max-colonne|78-col-tipo-imp
                    perform CONTROLLO-RIGA
                    if errori exit perform end-if
                 end-perform
              end-if
      
              if tutto-ok and mod = 1
                 perform SCRIVI-RIGA
              end-if

              if tutto-ok
                 evaluate true
                 when event-data-2 < 2 
                      move 2            to riga
                      move event-data-1 to colonna
      
                 when event-data-2 > tot-righe
                      add  1                to tot-righe giving riga
                      set event-action      to event-action-fail
                      move 1                to colonna
                      perform PUNTA-CELLA
                 when other
                      move event-data-2 to riga
                      move event-data-1 to colonna
                 end-evaluate
                 perform VALORE-RIGA
                 if art-codice = 0
                    initialize rlis-rec 
                               replacing numeric data by zeroes
                                    alphanumeric data by spaces
                 end-if
                 move rlis-rec to old-rlis-rec
                 move rlis-articolo   to como-old-rlis-articolo
              else
                 set event-action      to event-action-fail
                 perform PUNTA-CELLA
              end-if
           else
              if event-data-1 not = colonna
                 inquire gd1(riga, 1), cell-data in art-codice
                 if art-codice = 0
                    set event-action to event-action-fail
                    move 1 to colonna event-data-1
                    perform PUNTA-CELLA
                 end-if
              end-if
              move event-data-1 to colonna
           end-if.
      
           perform COLORE-RIGA.
           perform HELP-GRID 
           .
      * <TOTEM:END>

       STAMPA.
      * <TOTEM:PARA. STAMPA>
           set s-stampa to true.
           perform STAMPA-ANTEPRIMA 
           .
      * <TOTEM:END>

       STAMPA-ANTEPRIMA.
      * <TOTEM:PARA. STAMPA-ANTEPRIMA>
           if nuovo
              display message "Occorre salvare il volantino"
                              " per poterlo stampare"
                        title titolo
                         icon 2
           else
              inquire ef-codice, value in tlis-codice of tlistini
              read tlistini no lock
                    invalid
                    display message "Volantino NON valido"
                            title tit-err
                            icon 2
                not invalid
                    call "W$MOUSE" using set-mouse-shape, wait-pointer
      
                    move tlis-chiave of tlistini  to stlis-lis-chiave
      
                    evaluate true
                    when s-stampa
                         set stlis-printer  to true
                    when s-excell
                         set stlis-excell   to true
                    when other
                         set stlis-anteprima   to true
                    end-evaluate
                    move user-codi to stlis-user
           
                    call   "stlistini" using stlistini-linkage
                    cancel "stlistini"
      
      
      *              evaluate true
      *              when s-excell
      *                   set stlis-excell   to true
      *                   call   "stlistini" using stlistini-linkage
      *                   cancel "stlistini"
      *              when other
      *                   display message "In attesa di layout"
      *                           title titolo
      *                           icon 2
      *              end-evaluate
           
                   call "W$MOUSE" using set-mouse-shape, arrow-pointer
              end-read
           end-if 
           .
      * <TOTEM:END>

       SUCCESSIVO.
      * <TOTEM:PARA. SUCCESSIVO>
           perform SALV-MOD.           
           if tutto-ok     
              perform CHECK-INSERIMENTO
              unlock tlistini all records 
      
              perform RIEMPI-CHIAVE
      
              start tlistini key > tlis-chiave of tlistini
                 invalid  
                    set errori to true
                 not invalid 
                    read tlistini next no lock
                       at end   
                          set errori to true 
                    end-read
              end-start
      
              if tutto-ok
                 if nuovo
                    perform CANCELLA-COLORE
                    move 78-ID-ef-codice to control-id
                    move 4               to accept-control
                 end-if
                 move tlis-codice of tlistini to ef-codice-buf
                 display ef-codice
                 set ReadSecca             to false
                 perform CURRENT-RECORD
              else
                 display message "File [TLISTINI]"
                          x"0d0a""Raggiunta fine file"
                           title titolo
              end-if
      
           end-if 
           .
      * <TOTEM:END>

       TORNA-IN-VISUA.
      * <TOTEM:PARA. TORNA-IN-VISUA>
           move 0 to mod.
           move 1 to mod-k.
           move 78-ID-ef-codice to CONTROL-ID.
           set NoMessage to true.
           perform ABILITAZIONI.
           set StatusVisua to true.
           perform STATUS-BAR-MSG.
           unlock tlistini all records.
                        
           move 7   to BitmapNumGridElimina
           modify tool-modifica,  value mod.
           perform CANCELLA-COLORE.
           move 4 to ACCEPT-CONTROL 
           .
      * <TOTEM:END>

       ULTIMO.
      * <TOTEM:PARA. ULTIMO>
           perform SALV-MOD.           
           if tutto-ok                 
              perform CHECK-INSERIMENTO
              unlock tlistini all records 
      
              move high-value to tlis-chiave of tlistini
              start tlistini key < tlis-chiave of tlistini
                 invalid  
                    set errori to true
                 not invalid 
                    read tlistini previous no lock
                       at end   
                          set errori to true 
                    end-read
              end-start
      
              if tutto-ok
                 if nuovo
                    perform CANCELLA-COLORE
                    move 78-ID-ef-codice to control-id
                    move 4               to accept-control
                 end-if
                 move tlis-codice of tlistini to ef-codice-buf
                 display ef-codice
                 set  ReadSecca            to false
                 perform CURRENT-RECORD
              else
                 perform CLEAR-SCREEN
                 display message "File [TLISTINI]"
                          x"0d0a""Archivio vuoto"
                           title titolo
                 perform CANCELLA-COLORE
                 move 78-ID-ef-codice to control-id
                 move 4               to accept-control
              end-if
      
           end-if 
           .
      * <TOTEM:END>

       VALORE-RIGA.
      * <TOTEM:PARA. VALORE-RIGA>
           inquire gd1(riga, 1), hidden-data in costi-agg.
           inquire gd1(riga, 2), hidden-data in rlis-scelta.
           inquire gd1(riga, 3), hidden-data in rlis-sconti-zero.

           inquire gd1(riga, 78-col-art),       cell-data col-art.
           inquire gd1(riga, 78-col-des),       cell-data col-des.
           inquire gd1(riga, 78-col-art-forn),  cell-data col-art-forn.
           inquire gd1(riga, 78-col-prz-acq),   cell-data col-prz-acq.
           inquire gd1(riga, 78-col-sconto-1),  cell-data col-sconto-1.
           inquire gd1(riga, 78-col-sconto-2),  cell-data col-sconto-2.
           inquire gd1(riga, 78-col-sconto-3),  cell-data col-sconto-3.
           inquire gd1(riga, 78-col-sconto-4),  cell-data col-sconto-4.
           inquire gd1(riga, 78-col-sconto-5),  cell-data col-sconto-5. 
           inquire gd1(riga, 78-col-netto),     cell-data col-netto.
           inquire gd1(riga, 78-col-costi-agg), cell-data col-costi-agg.
           inquire gd1(riga, 78-col-perce-agg), cell-data col-perce-agg.
           inquire gd1(riga, 78-col-piombo),    cell-data col-perce-pb.
           inquire gd1(riga, 78-col-disp),      cell-data col-disp.
           inquire gd1(riga, 78-col-lead-time), cell-data col-lead-time.
           inquire gd1(riga, 78-col-tipo-imp),  cell-data col-tipo-imp.
           inquire gd1(riga, 78-col-prz-tot),   cell-data col-prz-tot.
           inquire gd1(riga, 78-col-prz-conf),  cell-data col-prz-conf.
           inquire gd1(riga, 78-col-PFA),       cell-data col-PFA.

      * 78  78-col-des-imp    value 17.
      * 78  78-col-prz-tot    value 18.
           move col-art         to rlis-articolo
                                   art-codice.
      *     if art-codice >= 90000
              move col-des to rlis-des-libera
      *     end-if.
           move col-art-forn    to rlis-art-forn.
           move col-prz-acq     to rlis-prz-acq.
           move col-sconto-1    to rlis-sconto-1.
           move col-sconto-2    to rlis-sconto-2.
           move col-sconto-3    to rlis-sconto-3.
           move col-sconto-4    to rlis-sconto-4.
           move col-sconto-5    to rlis-sconto-5.
           move col-costi-agg   to rlis-costi-agg.
           move col-perce-agg   to rlis-perce-agg.

           move col-perce-pb    to rlis-perce-pb.
           move col-netto       to rlis-netto.
           move col-disp        to rlis-disponibilita.
           move col-lead-time   to rlis-lead-time.
           move col-tipo-imp    to rlis-tipo-tratt-imposte.
           move col-PFA         to rlis-PFA

           move col-prz-acq     to como-prz-acq.
           move col-sconto-1    to como-sconto-1.
           move col-sconto-2    to como-sconto-2.
           move col-sconto-3    to como-sconto-3.
           move col-sconto-4    to como-sconto-4.
           move col-sconto-5    to como-sconto-5.
           move col-netto       to como-netto.
           move col-costi-agg   to como-costi-agg.
           move col-perce-agg   to como-perce-agg.
           move col-perce-pb    to como-perce-pb.
           move col-disp        to como-disp.
           move col-lead-time   to como-lead-time.

           move costi-agg       to rlis-costi-agg-tot 
           .
      * <TOTEM:END>

       VALORIZZA-OLD.
      * <TOTEM:PARA. VALORIZZA-OLD>
           move tlis-rec of tlistini to old-tlis-rec.
           move como-note(1) to old-como-note(1).
           move como-note(2) to old-como-note(2).
           move como-note(3) to old-como-note(3).
           move como-note(4) to old-como-note(4).

           move tlis-fornitore of tlistini  to como-old-forn
           move tlis-destino   of tlistini  to como-old-dest

           set vecchio to true.

           move 0 to StatusHelp
           perform STATUS-HELP.

           inquire gd1, last-row in tot-righe.
           subtract 1 from tot-righe giving RigheIniziali.
           move 0 to RigaCambiata ColonnaCambiata.

           move tlis-fornitore  of tlistini to save-forn..

           if mod = 0
              move 3 to num-copia
              move 7 to BitmapNumGridElimina
           else
              move 1 to num-copia
              move 1 to BitmapNumGridElimina
           end-if.
           modify pb-copia, BITMAP-NUMBER num-copia
           modify pb-grid-elimina, BITMAP-NUMBER BitmapNumGridElimina
           .
      * <TOTEM:END>

       VALORIZZA-NUOVO.
      * <TOTEM:PARA. VALORIZZA-NUOVO>
           move high-value to tlis-codice of tlistini.

           start tlistini key <=   tlis-codice of tlistini
                 invalid move 1 to tlis-codice of tlistini
             not invalid
                 read tlistini previous with no lock
                       at end move 1 to tlis-codice of tlistini
                   not at end add  1 to tlis-codice of tlistini
                 end-read
           end-start.

           move "00"    to status-tlistini.

           initialize tlis-dati of tlistini 
                      replacing numeric data by zeroes
                           alphanumeric data by spaces.

           initialize rlis-rec replacing numeric data by zeroes
                                    alphanumeric data by spaces.
                            
           set tlis-trasp-f-escluso of tlistini to true.
           set tlis-trasp-c-escluso of tlistini to true.
           write tlis-rec of tlistini
                 invalid rewrite tlis-rec of tlistini 
           end-write.
           read tlistini lock invalid continue end-read.
                                       
           initialize como-note(1)
                      como-note(2)
                      como-note(3)
                      como-note(4)

           perform FORM1-IUD-DISPLAY.

           perform RESETTA-GRID.

           move 0 to RigheIniziali.
           move 0 to RigaCambiata ColonnaCambiata.

           move spaces to save-forn.

      *    chiudo e riapro il tmp delle note per azzerarle
           close tmp-nlistini.
           open output tmp-nlistini
           close tmp-nlistini
           open i-o tmp-nlistini 
           .
      * <TOTEM:END>

       VALORIZZA-DATI-COMUNI.
      * <TOTEM:PARA. VALORIZZA-DATI-COMUNI>
      * SE NON HO VALORIZZATO I CAMPI DI CREAZIONE LI VALORIZZO
           if tlis-data-creazione   of tlistini = 0
              accept tlis-data-creazione of tlistini from century-date
           end-if.
           if tlis-ora-creazione    of tlistini = 0
              accept tlis-ora-creazione of tlistini from time
           end-if.
           if tlis-utente-creazione of tlistini = space
              move user-codi to tlis-utente-creazione of tlistini
           end-if.

           accept tlis-data-ultima-modifica 
                                         of tlistini from century-date.
           accept tlis-ora-ultima-modifica  of tlistini from time.
           move user-codi    to tlis-utente-ultima-modifica of tlistini 
           .
      * <TOTEM:END>

       X-Y.
      * <TOTEM:PARA. X-Y>
           inquire gd1, cursor-y in riga,
                        cursor-x in colonna,
                        last-row in tot-righe 
           .
      * <TOTEM:END>

       COPIA-LISTINO.
      * <TOTEM:PARA. COPIA-LISTINO>
           unlock tlistini all record

           move ef-codice-buf   to codice-x.
           inspect codice-x replacing trailing x"30" by x"20".
           call "C$JUSTIFY" using codice-x, "R".
           inspect codice-x replacing leading x"20" by x"30".
           move codice-x to clis-forn-to.
      
           move cli-copia       to clis-forn-from
      
           call "copia-listino" using copia-listino-linkage
                                      LK-BLOCKPGM
                                      USER-CODI
                                      LIVELLO-ABIL
           cancel "copia-listino".

           set vecchio to true.

           perform CURRENT-RECORD 
           .
      * <TOTEM:END>

       CERCA-COPIA.
      * <TOTEM:PARA. CERCA-COPIA>
           move "tlistini"     to como-file
           inquire EF-cli-copia,    value in tlis-fornitore of tlistini1

           call "zoom-gt"   using como-file, tlis-rec of tlistini1
                           giving stato-zoom
           end-call
           cancel "zoom-gt"
           if stato-zoom = 0
              move tlis-codice of tlistini1 to cli-copia
              modify EF-cli-copia value cli-copia
              move tlis-descrizione of tlistini1 to lbl-cli-copia-buf
              modify lbl-cli-copia, TITLE = lbl-cli-copia-buf
           end-if 
           .
      * <TOTEM:END>

       ELIMINA-RIGA.
      * <TOTEM:PARA. ELIMINA-RIGA>
           perform VALORE-RIGA.

           move tlis-codice of tlistini to rlis-codice
      *     move tlis-chiave-ricerca of tlistini 
      *                                         to rlis-chiave-ricerca
      *
      *     if rlis-data-creazione   = 0
      *        accept rlis-data-creazione from century-date
      *     end-if
      *     if rlis-ora-creazione    = 0
      *        accept rlis-ora-creazione  from time
      *     end-if
      *     if rlis-utente-creazione = space
      *        move user-codi to rlis-utente-creazione
      *     end-if
      *
      *     accept rlis-data-modifica from century-date
      *     accept rlis-ora-modifica  from time
      *     move user-codi    to rlis-utente-modifica
      *
      *     move tlis-chiave-ricerca of tlistini   
      *                                      to rlis-chiave-ricerca

           delete rlistini record
              invalid 
                 continue
           end-delete

           modify gd1, RECORD-TO-DELETE riga
           .
      * <TOTEM:END>

       CAMBIA-ORDINE.
      * <TOTEM:PARA. CAMBIA-ORDINE>
           set tutto-ok   to true
           if mod = 1
              perform VALORE-RIGA

              if art-codice not = 0      or
                 col-art    not = spaces or
                 como-acq   not = 0      or
                 como-ven   not = 0      or
                 como-qta   not = 0
                 perform varying colonna from 78-col-art by 1
                           until colonna > 78-col-tipo-imp
                    perform CONTROLLO-RIGA
                    if errori exit perform end-if
                 end-perform
              end-if
              if tutto-ok and mod = 1
                 perform SCRIVI-RIGA
              end-if
           end-if

           if tutto-ok
              evaluate event-data-1
              when 1
                   set ord-cod  to true
              when 2
                   set ord-descr   to true
              end-evaluate
              perform RIEMPI-GRID
           end-if 
           .
      * <TOTEM:END>

       LOAD-NOTE.
      * <TOTEM:PARA. LOAD-NOTE>
           close tmp-nlistini
           open output tmp-nlistini
           close tmp-nlistini
           open i-o tmp-nlistini

           initialize como-note(1)
                      como-note(2)
                      como-note(3)
                      como-note(4)
           move tlis-chiave of tlistini  to nlis-chiave-listino
           move low-value    to nlis-num-nota

           start nlistini key not < nlis-chiave
              invalid
                 continue
              not invalid
                 move 0 to cont
                 perform until 1 = 2
                    read nlistini next no lock
                       at end
                          exit perform
                    end-read
                    if tlis-chiave of tlistini not = nlis-chiave-listino
                       exit perform
                    end-if
                    add 1    to cont
                    move nlis-rec   to tmp-nlis-rec
                    write tmp-nlis-rec
                       invalid
                          continue
                    end-write
                    if cont < 5
                       move nlis-nota  to como-note(cont)
                    end-if
                 end-perform
           end-start.

           move como-note(1) to ef-note-1-buf.
           move como-note(2) to ef-note-2-buf.
           move como-note(3) to ef-note-3-buf.
           move como-note(4) to ef-note-4-buf.

           modify ef-note-1, VALUE ef-note-1-buf.
           modify ef-note-2, VALUE ef-note-2-buf.
           modify ef-note-3, VALUE ef-note-3-buf.
           modify ef-note-4, VALUE ef-note-4-buf 
           .
      * <TOTEM:END>

       CANCELLA-NOTE.
      * <TOTEM:PARA. CANCELLA-NOTE>
           move tlis-chiave of tlistini  to nlis-chiave-listino
           move low-value    to nlis-num-nota
           start nlistini key not < nlis-chiave
              invalid
                 continue
              not invalid
                 perform until 1 = 2
                    read nlistini next no lock
                       at end
                          exit perform
                    end-read
                    if tlis-chiave of tlistini not = nlis-chiave-listino
                       exit perform
                    end-if
                    delete nlistini record
                 end-perform
           end-start 
           .
      * <TOTEM:END>

       SALVA-NOTE.
      * <TOTEM:PARA. SALVA-NOTE>
           move low-value to tmp-nlis-chiave
           start TMP-nlistini key not < tmp-nlis-chiave
              invalid
                 continue
              not invalid
                 perform until 1 = 2
                    read TMP-nlistini next no lock
                       at end
                          exit perform
                    end-read
                    move tmp-nlis-rec  to nlis-rec
                    move tlis-chiave of tlistini  to nlis-chiave-listino

                    move tlis-dati-comuni 
                                      of tlistini to nlis-dati-comuni
                    write nlis-REC
                       invalid
                          continue
                    end-write
                 end-perform
           end-start 
           .
      * <TOTEM:END>

       VAL-NOTE-FORN.
      * <TOTEM:PARA. VAL-NOTE-FORN>
           move space  to como-note(1) 
                          como-note(2)
                          como-note(3)
                          como-note(4).

           close       tmp-nlistini
           open output tmp-nlistini
           close       tmp-nlistini
           open i-o    tmp-nlistini


           move desf-codice  to nfod-codice
           move desf-prog    to nfod-dest

           move low-value    to nfod-prog
           move zero         to tmp-nlis-num-nota
           start NFORN-DEST key not < nfod-chiave
              invalid
                 continue
              not invalid
                 perform until 1 = 2
                    read nforn-dest next 
                       at end
                          exit perform
                    end-read
                    if desf-codice not = nfod-codice or 
                       desf-prog   not = nfod-dest
                       exit perform
                    end-if
                    add   1           to tmp-nlis-num-nota
                    move tlis-chiave of tlistini   
                                         to tmp-nlis-chiave-listino
                    move nfod-nota    to tmp-nlis-nota
                    if tmp-nlis-num-nota < 5
                       move tmp-nlis-nota to 
           como-note(tmp-nlis-num-nota)
                    end-if
                    write tmp-nlis-rec
                       invalid
                          continue
                    end-write
                 end-perform
           end-start
           move como-note(1) to ef-note-1-buf.
           move como-note(2) to ef-note-2-buf.
           move como-note(3) to ef-note-3-buf.
           move como-note(4) to ef-note-4-buf.

           modify ef-note-1 value como-note(1).
           modify ef-note-2 value como-note(2).
           modify ef-note-3 value como-note(3).
           modify ef-note-4 value como-note(4) 

           .
      * <TOTEM:END>

       VAL-DESTINO.
      * <TOTEM:PARA. VAL-DESTINO>
           move 0 to num-dest save-dest.
           inquire ef-destino, value in desf-prog.
           if desf-prog = 0
              move cli-codice to desf-codice
              start destinif key >= desf-chiave
                 invalid 
                    continue
                 not invalid
                    perform until 1 = 2
                       read destinif next 
                          at end 
                             exit perform 
                       end-read
                       if desf-codice not = cli-codice
                          exit perform
                       end-if
                       add 1 to num-dest
                       if num-dest = 1
                          move desf-prog to save-dest
                       end-if
                       if num-dest = 2
                          exit perform
                       end-if
                    end-perform
              end-start
              if num-dest = 1
                 move save-dest to ef-destino-buf
                                   como-old-dest
                 display ef-destino
                 perform VAL-NOTE-FORN
              end-if
           end-if 
           .
      * <TOTEM:END>

      * EVENT PARAGRAPH
       NUOVO-LinkTo.
      * <TOTEM:PARA. NUOVO-LinkTo>
           INQUIRE TOOL-NUOVO, ENABLED IN E-NUOVO.

           IF E-NUOVO = 1
              PERFORM NUOVO
           END-IF                    
           .
      * <TOTEM:END>
       CANCELLA-LinkTo.
      * <TOTEM:PARA. CANCELLA-LinkTo>
           INQUIRE TOOL-MODIFICA, VALUE IN MOD.
                              
           INQUIRE TOOL-CANCELLA, ENABLED IN E-CANCELLA
           IF E-CANCELLA = 1
              PERFORM CANCELLA
           END-IF                                                
           .
      * <TOTEM:END>
       TOOL-SALVA-LinkTo.
      * <TOTEM:PARA. TOOL-SALVA-LinkTo>
           INQUIRE TOOL-MODIFICA, VALUE IN MOD           

           INQUIRE TOOL-SALVA, ENABLED IN E-SALVA
           IF E-SALVA = 1
              PERFORM SALVA
           END-IF           
           .
      * <TOTEM:END>
       ANTEPRIMA-LinkTo.
      * <TOTEM:PARA. ANTEPRIMA-LinkTo>
           INQUIRE TOOL-ANTEPRIMA, ENABLED IN E-ANTEPRIMA.
           IF E-ANTEPRIMA = 1
              PERFORM ANTEPRIMA
           END-IF 
           .
      * <TOTEM:END>
       TOOL-MODIFICA-BeforeProcedure.
      * <TOTEM:PARA. TOOL-MODIFICA-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       TOOL-MODIFICA-AfterProcedure.
      * <TOTEM:PARA. TOOL-MODIFICA-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       TOOL-MODIFICA-LinkTo.
      * <TOTEM:PARA. TOOL-MODIFICA-LinkTo>
           INQUIRE TOOL-MODIFICA, ENABLED IN E-MODIFICA.

           IF E-MODIFICA = 1
              PERFORM MODIFICA
           END-IF 
           .
      * <TOTEM:END>
       STAMPA-LinkTo.
      * <TOTEM:PARA. STAMPA-LinkTo>
           INQUIRE TOOL-STAMPA, ENABLED IN E-STAMPA
           IF E-STAMPA = 1
              PERFORM STAMPA
           END-IF 
           .
      * <TOTEM:END>
       TOOL-CERCA-LinkTo.
      * <TOTEM:PARA. TOOL-CERCA-LinkTo>
           inquire tool-cerca, enabled in e-cerca
           if e-cerca = 1
              perform CERCA
           end-if 
           .
      * <TOTEM:END>
       TOOL-SELEZIONA-LinkTo.
      * <TOTEM:PARA. TOOL-SELEZIONA-LinkTo>
           inquire tool-seleziona, enabled in e-seleziona
           if e-seleziona = 1
              perform SELEZIONA
           end-if 
           .
      * <TOTEM:END>
       TOOL-PRIMO.
      * <TOTEM:PARA. TOOL-PRIMO>
           PERFORM PRIMO 
           .
      * <TOTEM:END>
       TOOL-PRECEDENTE.
      * <TOTEM:PARA. TOOL-PRECEDENTE>
           if nuovo             
              perform PRIMO
           else
              perform PRECEDENTE
           end-if 
           .
      * <TOTEM:END>
       TOOL-SUCCESSIVO.
      * <TOTEM:PARA. TOOL-SUCCESSIVO>
           if nuovo             
              perform ULTIMO
           else
              perform SUCCESSIVO
           end-if 
           .
      * <TOTEM:END>
       TOOL-ULTIMO.
      * <TOTEM:PARA. TOOL-ULTIMO>
           PERFORM ULTIMO 
           .
      * <TOTEM:END>
       ginqui-Ev-Before-Program.
      * <TOTEM:PARA. ginqui-Ev-Before-Program>
           move LK-BL-PROG-ID    TO COMO-PROG-ID.
           move 3   to num-copia
           move 7   to BitmapNumGridElimina
           set ord-descr  to true

           initialize path-tmp-nlistini
           accept path-tmp-nlistini from environment "TEMP"

           inspect path-tmp-nlistini 
                                replacing trailing space by low-value

           accept como-data  from century-date
           accept como-ora   from time

           string path-tmp-nlistini   delimited by low-value
                  "\tmp-nlistini_"    delimited by size
                  como-data           delimited by size
                  "_"                 delimited by size
                  como-ora            delimited by size
                  into path-tmp-nlistini

           inspect path-tmp-nlistini 
                                replacing trailing low-value by space

           open output tmp-nlistini
           close tmp-nlistini
           .
      * <TOTEM:END>
       ginqui-Ev-After-Program.
      * <TOTEM:PARA. ginqui-Ev-After-Program>
           set environment "KEYSTROKE" to "DATA=44 44".
           set environment "KEYSTROKE" to "DATA=46 46".
           delete file tmp-nlistini.
           SET LK-BL-CANCELLAZIONE TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM 
           .
      * <TOTEM:END>
       Screen1-DaEf-1-BeforeProcedure.
      * <TOTEM:PARA. Screen1-DaEf-1-BeforeProcedure>
           move ZERO to StatusHelp.
           perform STATUS-HELP.
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       Screen1-DaEf-1-AfterProcedure.
      * <TOTEM:PARA. Screen1-DaEf-1-AfterProcedure>
              INQUIRE ef-codice, VALUE IN tlis-codice OF tlistini
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-codice-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-gdo-BeforeProcedure.
      * <TOTEM:PARA. ef-gdo-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           perform VAL-DESTINO

      *     inquire ef-forn, value in como-old-forn.
      *     inquire ef-destino, value in como-old-dest 
           .
      * <TOTEM:END>
       ef-ini-dpo-BeforeProcedure.
      * <TOTEM:PARA. ef-ini-dpo-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-fine-dpo-BeforeProcedure.
      * <TOTEM:PARA. ef-fine-dpo-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-nome-BeforeProcedure.
      * <TOTEM:PARA. ef-nome-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-gdo-AfterProcedure.
      * <TOTEM:PARA. ef-gdo-AfterProcedure>
              INQUIRE ef-forn, VALUE IN tlis-fornitore OF tlistini
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-forn-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
              INQUIRE ef-destino, VALUE IN tlis-destino OF tlistini
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-destino-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-ini-dpo-AfterProcedure.
      * <TOTEM:PARA. ef-ini-dpo-AfterProcedure>
              INQUIRE ef-ini-val, VALUE IN tlis-ini-val OF tlistini
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-ini-val-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-fine-dpo-AfterProcedure.
      * <TOTEM:PARA. ef-fine-dpo-AfterProcedure>
              INQUIRE ef-fine-val, VALUE IN tlis-fine-val OF tlistini
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-fine-val-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-nome-AfterProcedure.
      * <TOTEM:PARA. ef-nome-AfterProcedure>
              INQUIRE ef-note, VALUE IN tlis-descrizione OF tlistini
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-note-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       gd1-Ev-Msg-Begin-Drag.
      * <TOTEM:PARA. gd1-Ev-Msg-Begin-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd1-Ev-Msg-End-Drag.
      * <TOTEM:PARA. gd1-Ev-Msg-End-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd1-Ev-Msg-Goto-Cell.
      * <TOTEM:PARA. gd1-Ev-Msg-Goto-Cell>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd1-Ev-Msg-Goto-Cell-Drag.
      * <TOTEM:PARA. gd1-Ev-Msg-Goto-Cell-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd1-Ev-Msg-Goto-Cell-Mouse.
      * <TOTEM:PARA. gd1-Ev-Msg-Goto-Cell-Mouse>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       gd1-Ev-Msg-Begin-Entry.
      * <TOTEM:PARA. gd1-Ev-Msg-Begin-Entry>
           if mod = 0
              set event-action to event-action-fail
           else
              perform X-Y
              inquire gd1(riga, 78-col-art), cell-data OLD-col-art      
            

              if colonna = 1
                 if OLD-col-art not = space
                    set event-action to event-action-fail
                 else
                    continue
                 end-if
              end-if

              inquire gd1(riga, 78-col-des), cell-data OLD-col-des      
            
              inquire gd1(riga, 78-col-art-forn), 
                                            cell-data OLD-col-art-forn  
              inquire gd1(riga, 78-col-prz-acq), 
                                            cell-data OLD-col-prz-acq   
              inquire gd1(riga, 78-col-sconto-1), 
                                            cell-data OLD-col-sconto-1  
              inquire gd1(riga, 78-col-sconto-2), 
                                            cell-data OLD-col-sconto-2  
              inquire gd1(riga, 78-col-sconto-3), 
                                            cell-data OLD-col-sconto-3  
              inquire gd1(riga, 78-col-sconto-4), 
                                            cell-data OLD-col-sconto-4  
              inquire gd1(riga, 78-col-sconto-5), 
                                            cell-data OLD-col-sconto-5  
              inquire gd1(riga, 78-col-netto) cell-data OLD-col-netto
              inquire gd1(riga, 78-col-costi-agg), 
                                         cell-data OLD-col-costi-agg 
              inquire gd1(riga, 78-col-perce-agg), 
                                         cell-data OLD-col-perce-agg 
              inquire gd1(riga, 78-col-piombo), 
                                         cell-data OLD-col-perce-pb
              inquire gd1(riga, 78-col-disp), cell-data OLD-col-disp    
             
              inquire gd1(riga, 78-col-lead-time), 
                                         cell-data OLD-col-lead-time 
              inquire gd1(riga, 78-col-tipo-imp), 
                                         cell-data OLD-col-tipo-imp  
              
              evaluate colonna
      
              when 78-col-art
              when 78-col-art-forn
              when 78-col-disp     
              when 78-col-lead-time
              when 78-col-tipo-imp
                   continue
              when 78-col-des
                   if art-codice < 90000
                      set event-action to event-action-fail 
                   end-if
              when 78-col-prz-tot
              when 78-col-des-imp
              when 78-col-prz-conf
                   set event-action to event-action-fail 
              when 78-col-prz-acq
              when 78-col-sconto-1
              when 78-col-sconto-2
              when 78-col-sconto-3
              when 78-col-sconto-4
              when 78-col-sconto-5
              when 78-col-netto
              when 78-col-costi-agg
              when 78-col-perce-agg
              when 78-col-piombo
                   set environment "KEYSTROKE" to "DATA=44 46"    
              end-evaluate
           end-if 


           .
      * <TOTEM:END>
       gd1-Ev-Msg-Finish-Entry.
      * <TOTEM:PARA. gd1-Ev-Msg-Finish-Entry>
           set tutto-ok to true.
           perform X-Y.
           perform VALORE-RIGA.

           evaluate colonna
           when 78-col-art
                if rlis-articolo = 0
                   if col-des      not = spaces or
                      como-prz-acq not = 0      or
                      como-disp    not = 0
                      display message "Cancellare la riga?"
                                title titolo
                                 type mb-yes-no
                              default mb-no
                            giving scelta
                      if scelta = mb-no
                         set errori to true
                      else
                         move ef-codice-buf    to rlis-codice
                         move old-rlis-articolo to rlis-articolo
                         delete rlistini record 
                                invalid  continue 
                         end-delete
                         initialize rec-grid 
                                    replacing numeric data by zeroes
                                         alphanumeric data by spaces

                         move riga to store-riga
                         add 1 to riga
                         perform VALORE-RIGA
                         move rlis-rec to old-rlis-rec
                         move store-riga to riga

                         modify gd1, record-to-delete = riga
                         modify gd1, insert-rows = 1
                      end-if
                   end-if
                else
      *            controllo se l'articolo sia o no 
      *            presente in una catena articoli
      *            solo per articoli nuovi
                   move art-codice   to cat-codice
                   move low-value    to cat-princ

                   start catart  key not < cat-chiave
                         invalid continue
                     not invalid
                         read catart next
                              at end continue
                          not at end
                              if art-codice = cat-codice
                                 if cat-princ not = zero
                                    move cat-princ to cat-codice
                                    move zero      to cat-princ
                                    read catart no lock
                                         invalid continue
                                    end-read
                                    if art-codice not =
                                       cat-collegato(cat-num-el-catena)
                                       perform CHIEDI-SOST
                                    end-if
                                 else
                                    perform CHIEDI-SOST
                                 end-if
                              end-if
                         end-read
                   end-start
                   move rlis-articolo to art-codice
                   perform CONTROLLA-ARTICOLO-GIA-INSERITO
                   if not trovato
                      perform CONTROLLO-RIGA
                   end-if
                end-if
                if tutto-ok
                   if rlis-articolo not = old-rlis-articolo
                      move riga to RigaCambiata
                      move 1    to ColonnaCambiata
                   end-if
                end-if


           when 78-col-art-forn
                if col-art-forn not = old-col-art-forn
                   move riga             to RigaCambiata
                   move 78-col-art-forn  to ColonnaCambiata
                end-if
                perform CONTROLLO-RIGA
                modify gd1(riga, 78-col-art-forn), 
                                   cell-data col-art-forn

           when 78-col-prz-acq
                if col-prz-acq not = old-col-prz-acq
                   move riga             to RigaCambiata
                   move 78-col-prz-acq  to ColonnaCambiata
                end-if
                perform CONTROLLO-RIGA
                move rlis-prz-acq to col-prz-acq
                modify gd1(riga, 78-col-prz-acq), 
                                   cell-data col-prz-acq

           when 78-col-sconto-1
                if col-sconto-1 not = old-col-sconto-1
                   move riga             to RigaCambiata
                   move 78-col-sconto-1  to ColonnaCambiata
                end-if
                perform CONTROLLO-RIGA
                move rlis-sconto-1 to col-sconto-1
                modify gd1(riga, 78-col-sconto-1), 
                                   cell-data col-sconto-1 

           when 78-col-netto
                if col-netto not = old-col-netto
                   move riga          to RigaCambiata
                   move 78-col-netto  to ColonnaCambiata
                end-if
      *          perform CONTROLLO-RIGA
                move rlis-netto to col-netto
                modify gd1(riga, 78-col-netto), 
                                   cell-data col-netto

           when 78-col-sconto-2
                if col-sconto-2 not = old-col-sconto-2
                   move riga             to RigaCambiata
                   move 78-col-sconto-2  to ColonnaCambiata
                end-if
                perform CONTROLLO-RIGA
                move rlis-sconto-2 to col-sconto-2
                modify gd1(riga, 78-col-sconto-2), 
                                   cell-data col-sconto-2
           when 78-col-sconto-3
                if col-sconto-3 not = old-col-sconto-3
                   move riga             to RigaCambiata
                   move 78-col-sconto-3  to ColonnaCambiata
                end-if
                perform CONTROLLO-RIGA
                move rlis-sconto-3 to col-sconto-3
                modify gd1(riga, 78-col-sconto-3), 
                                   cell-data col-sconto-3

           when 78-col-sconto-4
                if col-sconto-4 not = old-col-sconto-4
                   move riga             to RigaCambiata
                   move 78-col-sconto-4  to ColonnaCambiata
                end-if
                perform CONTROLLO-RIGA
                move rlis-sconto-4 to col-sconto-4
                modify gd1(riga, 78-col-sconto-4), 
                                   cell-data col-sconto-4
           when 78-col-sconto-5
                if col-sconto-5 not = old-col-sconto-5
                   move riga             to RigaCambiata
                   move 78-col-sconto-5  to ColonnaCambiata
                end-if
                perform CONTROLLO-RIGA
                move rlis-sconto-5 to col-sconto-5
                modify gd1(riga, 78-col-sconto-5), 
                                   cell-data col-sconto-5 

           when 78-col-costi-agg
                if col-costi-agg not = old-col-costi-agg
                   move riga             to RigaCambiata
                   move 78-col-costi-agg  to ColonnaCambiata
                end-if
                perform CONTROLLO-RIGA
                move rlis-costi-agg   to col-costi-agg
                modify gd1(riga, 78-col-costi-agg), 
                                   cell-data col-costi-agg

           when 78-col-perce-agg
                if col-perce-agg not = old-col-perce-agg
                   move riga             to RigaCambiata
                   move 78-col-perce-agg  to ColonnaCambiata
                end-if
                perform CONTROLLO-RIGA
                move rlis-perce-agg   to col-perce-agg
                modify gd1(riga, 78-col-perce-agg), 
                                   cell-data col-perce-agg

           when 78-col-piombo
                if col-perce-pb not = old-col-perce-pb
                   move riga             to RigaCambiata
                   move 78-col-piombo  to ColonnaCambiata
                end-if
                perform CONTROLLO-RIGA
                move rlis-perce-pb to col-perce-pb
                modify gd1(riga, 78-col-piombo) cell-data col-perce-pb

           when 78-col-disp
                if col-disp not = old-col-disp
                   move riga             to RigaCambiata
                   move 78-col-disp  to ColonnaCambiata
                end-if
                perform CONTROLLO-RIGA
                modify gd1(riga, 78-col-disp), 
                                   cell-data col-disp
           when 78-col-lead-time
                if col-lead-time not = old-col-lead-time
                   move riga             to RigaCambiata
                   move 78-col-lead-time  to ColonnaCambiata
                end-if
                perform CONTROLLO-RIGA
                modify gd1(riga, 78-col-lead-time), 
                                   cell-data col-lead-time
           when 78-col-tipo-imp
                if col-tipo-imp not = old-col-tipo-imp
                   move riga             to RigaCambiata
                   move 78-col-tipo-imp  to ColonnaCambiata
                end-if
                perform CONTROLLO-RIGA
                modify gd1(riga, 78-col-tipo-imp) cell-data col-tipo-imp

           when 78-col-PFA
                if col-PFA not = old-col-PFA
                   move riga       to RigaCambiata
                   move 78-col-PFA to ColonnaCambiata
                end-if
                perform CONTROLLO-RIGA
                modify gd1(riga, 78-col-PFA) cell-data col-PFA
           end-evaluate.

           if errori
              move 78-ID-gd1 to store-id
              set event-action to event-action-fail
           else                                           
              move chk-trasporto-f-buf to como-trasporto-f
              move chk-trasporto-c-buf to como-trasporto-c
              move col-tipo-imp      to imf-codice
              move 0 to prg-peso-utf prg-peso-non-utf
              perform CALCOLA-PRZ-FINITO
              modify gd1(riga, 1), hidden-data costi-agg
              modify gd1(riga, 2), hidden-data rlis-scelta
              modify gd1(riga, 3), hidden-data rlis-sconti-zero

              move prz-reale     to col-prz-tot
              move prz-confronto to col-prz-conf

              modify gd1(riga, 78-col-prz-tot),  cell-data col-prz-tot
              modify gd1(riga, 78-col-prz-conf), cell-data col-prz-conf
              set environment "KEYSTROKE" to "DATA=44 44"
              set environment "KEYSTROKE" to "DATA=46 46"
           end-if.

      ***---
       CHIEDI-SOST.
           display message "L'articolo prevede una sostituzione con "
                           cat-collegato(cat-num-el-catena)"."
                    x"0d0a""Effettuare la sostituzione?"
                     title titolo
                      type mb-yes-no
                    giving scelta
                      icon 2
           if scelta = mb-yes
              move cat-collegato(cat-num-el-catena) to art-codice 
           rlis-articolo
              read articoli no lock
              modify gd1(riga, 78-col-art), cell-data art-codice
           end-if 
           .
      * <TOTEM:END>
       pb-excell-BeforeProcedure.
      * <TOTEM:PARA. pb-excell-BeforeProcedure>
           modify pb-excell, BITMAP-NUMBER 2
           .
      * <TOTEM:END>
       pb-excell-AfterProcedure.
      * <TOTEM:PARA. pb-excell-AfterProcedure>
           modify pb-excell, BITMAP-NUMBER 1
           .
      * <TOTEM:END>
       pb-excell-LinkTo.
      * <TOTEM:PARA. pb-excell-LinkTo>
           set s-excell  to true
           perform STAMPA-ANTEPRIMA
           modify pb-excell, BITMAP-NUMBER 2

           .
      * <TOTEM:END>
       Form1-Pb-1-LinkTo.
      * <TOTEM:PARA. Form1-Pb-1-LinkTo>
           move space  to cli-copia
                          lbl-cli-copia-buf
           perform FORM-COPIA-OPEN-ROUTINE.
           move 1 to num-copia.
           modify pb-copia, BITMAP-NUMBER num-copia
           .
      * <TOTEM:END>
       EF-ordine-FROM-BeforeProcedure.
      * <TOTEM:PARA. EF-ordine-FROM-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       EF-ordine-FROM-AfterProcedure.
      * <TOTEM:PARA. EF-ordine-FROM-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           move space to lbl-cli-copia-buf
           inquire EF-cli-copia value cli-copia
           move cli-copia       to tlis-codice of tlistini1
           read tlistini1 no lock
              invalid
                 display message box "Listino Inesistente"
                 move 4   to accept-control
              not invalid
                 move tlis-descrizione of tlistini1   to 
           lbl-cli-copia-buf
                 modify lbl-cli-copia title lbl-cli-copia-buf
           end-read

           .
      * <TOTEM:END>
       pb-ok-BeforeProcedure.
      * <TOTEM:PARA. pb-ok-BeforeProcedure>
           modify pb-ok, bitmap-number 2
           .
      * <TOTEM:END>
       pb-ok-AfterProcedure.
      * <TOTEM:PARA. pb-ok-AfterProcedure>
           modify pb-ok, bitmap-number 1
           .
      * <TOTEM:END>
       pb-ok-LinkTo.
      * <TOTEM:PARA. pb-ok-LinkTo>
           set tutto-ok   to true
           move cli-copia       to tlis-codice of tlistini1
           read tlistini1
              invalid
                 display message box "Listino inesistente"
                 set errori  to true
                 move 78-id-EF-cli-copia to control-id
                 move 4   to accept-control
              not invalid
                 if tlis-codice  of tlistini1 = tlis-codice  of tlistini
                    display message box "Impossibile copiare!"
                                        x"0D0A"
                     "I listini di partenza e desitinazione coincidono"

                    set errori  to true
                    move 78-id-EF-cli-copia to control-id
                    move 4   to accept-control
                 end-if
           end-read


           if tutto-ok
              initialize messaggio
              inspect tlis-descrizione of tlistini1
                                   replacing trailing space by low-value
              string "Confermi la copia dal Listino " delimited by size
                     x"0D0A"                         delimited by size
                  tlis-descrizione of tlistini1    delimited by 
           low-value
                  "?"                       delimited by size
                  x"0D0A"                   delimited by size
                  "Tutti i dati presenti sull'attuale" delimited by size
                  x"0D0A"                   delimited by size
                  "Listino andranno persi." delimited by size
                  into messaggio
              inspect messaggio replacing trailing space by low-value
              display message box messaggio
                    title titolo
                    type mb-yes-no
                    default mb-no
                    giving scelta

              if scelta = mb-yes
                 perform COPIA-LISTINO
              end-if
              perform FORM-COPIA-EXIT
           end-if
                  
           .
      * <TOTEM:END>
       pb-annulla-BeforeProcedure.
      * <TOTEM:PARA. pb-annulla-BeforeProcedure>
           modify pb-annulla, bitmap-number 2
           .
      * <TOTEM:END>
       pb-annulla-AfterProcedure.
      * <TOTEM:PARA. pb-annulla-AfterProcedure>
           modify pb-annulla, bitmap-number 1
           .
      * <TOTEM:END>
       pb-annulla-LinkTo.
      * <TOTEM:PARA. pb-annulla-LinkTo>
           .
      * <TOTEM:END>
       TOOL-CERCAa-LinkTo.
      * <TOTEM:PARA. TOOL-CERCAa-LinkTo>
           perform CERCA-COPIA 
           .
      * <TOTEM:END>
       pb-copia-BeforeProcedure.
      * <TOTEM:PARA. pb-copia-BeforeProcedure>
           move 2   to num-copia
           modify pb-copia, BITMAP-NUMBER num-copia
           .
      * <TOTEM:END>
       pb-copia-AfterProcedure.
      * <TOTEM:PARA. pb-copia-AfterProcedure>
           move 1   to num-copia
           modify pb-copia, BITMAP-NUMBER num-copia
           .
      * <TOTEM:END>
       Screen1-DaCb-1-BeforeProcedure.
      * <TOTEM:PARA. Screen1-DaCb-1-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       Screen1-DaCb-1-AfterProcedure.
      * <TOTEM:PARA. Screen1-DaCb-1-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       pb-grid-elimina-BeforeProcedure.
      * <TOTEM:PARA. pb-grid-elimina-BeforeProcedure>
           move 1 to BitmapNumGridElimina.
           modify pb-grid-elimina, bitmap-number = BitmapNumGridElimina 
           .
      * <TOTEM:END>
       pb-grid-elimina-AfterProcedure.
      * <TOTEM:PARA. pb-grid-elimina-AfterProcedure>
           move 4 to BitmapNumGridElimina.
           modify pb-grid-elimina, bitmap-number = BitmapNumGridElimina 
           .
      * <TOTEM:END>
       pb-grid-elimina-LinkTo.
      * <TOTEM:PARA. pb-grid-elimina-LinkTo>
           perform ELIMINA-RIGA
           .
      * <TOTEM:END>
       gd1-Ev-Msg-Heading-Clicked.
      * <TOTEM:PARA. gd1-Ev-Msg-Heading-Clicked>
           evaluate event-data-1
           when 1
           when 2
                perform CAMBIA-ORDINE
           end-evaluate 
           .
      * <TOTEM:END>
       pb-note-LinkTo.
      * <TOTEM:PARA. pb-note-LinkTo>
           move tlis-chiave of tlistini  to gnlis-tlis-chiave
           move path-tmp-nlistini        to gnlis-path
           move mod                      to gnlis-mod

           call "gnote-listini" using gnote-listini-linkage
                                      LK-BLOCKPGM
                                      USER-CODI
                                      LIVELLO-ABIL
           cancel "gnote-listini".

           move gnlis-note(1) to ef-note-1-buf
           move gnlis-note(2) to ef-note-2-buf
           move gnlis-note(3) to ef-note-3-buf
           move gnlis-note(4) to ef-note-4-buf

           modify ef-note-1 value ef-note-1-buf
           modify ef-note-2 value ef-note-2-buf
           modify ef-note-3 value ef-note-3-buf
           modify ef-note-4 value ef-note-4-buf

           .
      * <TOTEM:END>
       ef-note-1-BeforeProcedure.
      * <TOTEM:PARA. ef-note-1-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-note-1-AfterProcedure.
      * <TOTEM:PARA. ef-note-1-AfterProcedure>
              INQUIRE ef-note-1, VALUE IN como-note(1)
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-note-1-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-note-2-BeforeProcedure.
      * <TOTEM:PARA. ef-note-2-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-note-2-AfterProcedure.
      * <TOTEM:PARA. ef-note-2-AfterProcedure>
              INQUIRE ef-note-2, VALUE IN como-note(2)
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-note-2-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-note-3-BeforeProcedure.
      * <TOTEM:PARA. ef-note-3-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-note-3-AfterProcedure.
      * <TOTEM:PARA. ef-note-3-AfterProcedure>
              INQUIRE ef-note-3, VALUE IN como-note(3)
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-note-3-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-note-4-BeforeProcedure.
      * <TOTEM:PARA. ef-note-4-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-note-4-AfterProcedure.
      * <TOTEM:PARA. ef-note-4-AfterProcedure>
              INQUIRE ef-note-4, VALUE IN como-note(4)
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-note-4-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-forn-BeforeProcedure.
      * <TOTEM:PARA. ef-forn-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           perform VAL-DESTINO

           inquire ef-forn, value in como-old-forn 
           .
      * <TOTEM:END>
       chk-trasporto-f-LinkTo.
      * <TOTEM:PARA. chk-trasporto-f-LinkTo>
           inquire gd1, last-row in tot-righe.
           inquire chk-trasporto-f, value in chk-trasporto-f-buf.
           move chk-trasporto-f-buf to como-trasporto-f.

           perform varying riga from 2 by 1 
                     until riga > tot-righe
              inquire gd1(riga, 78-col-art), cell-data art-codice
              read articoli no lock invalid continue end-read
              move art-peso-utf     to prg-peso-utf
              move art-peso-non-utf to prg-peso-non-utf
              perform VALORE-RIGA
              perform CALCOLA-PRZ-FINITO
              move prz-confronto to col-prz-conf
              modify gd1(riga, 78-col-prz-conf), cell-data col-prz-conf
           end-perform 
           .
      * <TOTEM:END>
       chk-trasporto-c-LinkTo.
      * <TOTEM:PARA. chk-trasporto-c-LinkTo>
           inquire gd1, last-row in tot-righe.
           inquire chk-trasporto-c, value in chk-trasporto-c-buf.
           move chk-trasporto-c-buf to como-trasporto-c.

           perform varying riga from 2 by 1 
                     until riga > tot-righe
              inquire gd1(riga, 78-col-art), cell-data art-codice
              read articoli no lock invalid continue end-read
              move art-peso-utf     to prg-peso-utf
              move art-peso-non-utf to prg-peso-non-utf
              perform VALORE-RIGA
              perform CALCOLA-PRZ-FINITO
              move prz-confronto to col-prz-conf
              modify gd1(riga, 78-col-prz-conf), cell-data col-prz-conf
           end-perform 
           .
      * <TOTEM:END>

      *{TOTEM}END

      *{TOTEM}SHOW-MSG
       MESSAGE-FOR-FILEERROR.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
              MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           .

       SHOW-TRANSACTION-ROUTINE.
           IF TOTEM-TRANSACTION-FLAG = SPACES
              IF TRANSACTION-STATUS NOT = 0
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-1
              END-IF
           ELSE
              PERFORM SHOW-MSG-ROUTINE
              IF TRANSACTION-STATUS = 0
                 MOVE "Transazione terminata con Rollback." TO 
           TOTEM-MSG-3
              ELSE
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-3
              END-IF
           END-IF
           .

       SHOW-MSG-ROUTINE.
           MOVE SPACE TO TOTEM-MSG-1 TOTEM-MSG-2 TOTEM-MSG-3
           EVALUATE TOTEM-MSG-ID
               WHEN "10"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Nessun altro dato." TO TOTEM-MSG-2
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "22"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Chiave Duplicata." TO TOTEM-MSG-2
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "23"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Raggiunta fine file." TO TOTEM-MSG-2
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "101"
                    MOVE "Terminare l'applicazione?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "201"
                    MOVE "Aggiungere un nuovo record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "202"
                    MOVE "Aggiornare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "203"
                    MOVE "Cancellare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "204"
                    MOVE "Chiave duplicata." TO TOTEM-MSG-1
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "301"
                    MOVE "Inserimento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "302"
                    MOVE "Aggiornamento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "303"
                    MOVE "Cancellazione avvenuta con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "401"
                    MOVE "Shell non trovata." TO TOTEM-MSG-1
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN OTHER
                    MOVE TEXT-MESSAGE TO TOTEM-MSG-1
                    STRING "FILE:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-3
                    MOVE 0 TO TOTEM-IDX1
                    INSPECT TOTEM-MSG-3 TALLYING TOTEM-IDX1
                       FOR TRAILING SPACE
                    STRING TOTEM-MSG-3(1:TOTEM-MSG-LENGTH - 
           TOTEM-IDX1), 
                       ", FILE STATUS ", PRIMARY-ERROR "," 
                       SECONDARY-ERROR
                    DELIMITED BY SIZE INTO TOTEM-MSG-2
                    MOVE SPACES TO TOTEM-MSG-3
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
           END-EVALUATE
           PERFORM MESSAGE-BOX-ROUTINE
           .

       MESSAGE-BOX-ROUTINE.
           MOVE 1 TO TOTEM-MSG-TEXT-POINTER
           IF TOTEM-MSG-1 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-1 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              STRING TOTEM-MSG-1( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                 DELIMITED BY SIZE
                 INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-2 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-2 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-2( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-3 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-3 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-3( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-TEXT-POINTER = 1
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-TEXT TALLYING TOTEM-MSG-SIZE FOR 
           TRAILING SPACE
                  COMPUTE TOTEM-MSG-TEXT-POINTER = 
           TOTEM-MSG-FULL-LENGTH - TOTEM-MSG-SIZE + 1
           END-IF
           MOVE LOW-VALUES TO TOTEM-MSG-TEXT(TOTEM-MSG-TEXT-POINTER : 1 
           )
           .

       MESSAGE-BOX-DISPLAY.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

      *{TOTEM}END

