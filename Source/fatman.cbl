      *{TOTEM}PRG-COMMENT
      * fatman.Cbl
      * fatman.Cbl is generated by TOTEM
      * This is a generated file. DO NOT modify this file directly.
      *{TOTEM}END
       IDENTIFICATION       DIVISION.
      *{TOTEM}PRGID
       PROGRAM-ID.          fatman.
       AUTHOR.              ANDREA EVENTI.
       DATE-WRITTEN.        lunedì 18 febbraio 2019 12:29:51.
       REMARKS.
      *{TOTEM}END

       ENVIRONMENT          DIVISION.
       CONFIGURATION        SECTION.
       SPECIAL-NAMES.
      *{TOTEM}SPECIAL-NAME
      * <TOTEM:EPT. INIT:fatman, INIT:fatman, SpecialName>
      * <TOTEM:END>
      *{TOTEM}END
      *{TOTEM}ACTIVEX-DEF
      *{TOTEM}END
      *{TOTEM}DECIMAL-POINT
           DECIMAL-POINT IS COMMA.
      *{TOTEM}END

       INPUT-OUTPUT         SECTION.
       FILE-CONTROL.
      *{TOTEM}FILE-CONTROL
           COPY "tordini.sl".
           COPY "agenti.sl".
           COPY "tparamge.sl".
           COPY "rordini.sl".
           COPY "destini.sl".
           COPY "tivaese.sl".
           COPY "tcodpag.sl".
           COPY "clienti.sl".
           COPY "articoli.sl".
           COPY "tcontat.sl".
           COPY "tcaumag.sl".
           COPY "progmag.sl".
           COPY "MAS.sl".
           COPY "tmarche.sl".
           COPY "recapiti.sl".
           COPY "brnotacr.sl".
           COPY "btnotacr.sl".
           COPY "tvettori.sl".
      *{TOTEM}END
       DATA                 DIVISION.
       FILE                 SECTION.
      *{TOTEM}FILE
           COPY "tordini.fd".
           COPY "agenti.fd".
           COPY "tparamge.fd".
           COPY "rordini.fd".
           COPY "destini.fd".
           COPY "tivaese.fd".
           COPY "tcodpag.fd".
           COPY "clienti.fd".
           COPY "articoli.fd".
           COPY "tcontat.fd".
           COPY "tcaumag.fd".
           COPY "progmag.fd".
           COPY "MAS.fd".
           COPY "tmarche.fd".
           COPY "recapiti.fd".
           COPY "brnotacr.fd".
           COPY "btnotacr.fd".
           COPY "tvettori.fd".
      *{TOTEM}END

       WORKING-STORAGE      SECTION.
      *{TOTEM}ACU-DEF
               COPY "acugui.def".
               COPY "acucobol.def".
               COPY "fonts.def".
               COPY "crtvars.def".
               COPY "showmsg.def".
               COPY "totem.def".
               COPY "F:\lubex\geslux\Copylib\standard.def".
      *{TOTEM}END

      *{TOTEM}COPY-WORKING
      * Key Status
       77 Key-Status IS SPECIAL-NAMES CRT STATUS PIC 9(5) VALUE 0.
          88 Enter-Pushed VALUE 13.
          88 Exit-Pushed VALUE 27.
          88 Message-Received VALUE 95.
          88 Event-Occurred VALUE 96.
          88 Screen-No-Input-Field VALUE 97.
          88 Screen-Time-Out VALUE 99.
      * Properties & User defined Working Stoarge
       77 data-oggi        PIC  9(8).
           COPY  "LINK-PASSWD.DEF".
           COPY  "LINK-GESLOCK.DEF".
           COPY  "LINK-NAMBAR.DEF".
           COPY  "COMBO-STATO.DEF".
           COPY  "COSTO-MEDIO.DEF".
       01 FILLER           PIC  9.
           88 EsisteIVA VALUE IS 1    WHEN SET TO FALSE  0. 
       77 SaveTipo         PIC  x(4).
       77 Screen1-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 righe-di-cui-omaggi          PIC  9(3).
       77 como-giacenza    PIC  s9(8).
       77 como-articolo    PIC  9(6).
       77 como-magazzino   PIC  x(3).
       77 num-codici-iva   PIC  9(3).
       77 cod-iva          PIC  x(3)
                  OCCURS 3 TIMES.
       77 SaveUTF          PIC  9(5)V9(3).
       77 SaveNonUTF       PIC  9(5)V9(3).
       77 strip-grid-gclienti-bmp      PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 sum  PIC  9(15)v99.
       01 save-prg-chiave.
           05 save-prg-cod-articolo        PIC  9(6).
           05 save-prg-cod-magazzino       PIC  X(3).
           05 save-prg-tipo-imballo        PIC  X(3).
           05 save-prg-peso    PIC  9(5)V9(3).
       77 SavePrezzo       PIC  9(12)v99.
       01 FILLER           PIC  xx.
           88 TotaleSiZero VALUE IS "SI". 
           88 TotaleNoZero VALUE IS "NO". 
       01 CallWProgmagFlag PIC  9.
           88 CallWProgmag VALUE IS 1    WHEN SET TO FALSE  0. 
       01 FILLER           PIC  9.
           88 ArticoloSetFocus VALUE IS 1    WHEN SET TO FALSE  0. 
       01 FILLER           PIC  9.
           88 PrimaVolta VALUE IS 1    WHEN SET TO FALSE  0. 
       77 Small-Font
                  USAGE IS HANDLE OF FONT SMALL-FONT.
       77 pagina           PIC  9.
       01 HiddenValori.
           05 hid-old-qta      PIC  9(8).
           05 hid-old-prz      PIC  9(9)v99.
           05 hid-old-consumo  PIC  9(9)v99.
           05 hid-old-coubat   PIC  9(9)v99.
           05 hid-old-piombo   PIC  9(9)v99.
           05 hid-old-iva      PIC  x(3).
           05 hid-peso-utf     PIC  9(5)V9(3).
           05 hid-peso-non-utf PIC  9(5)V9(3).
       77 num-articoli     PIC  9(7).
       01 FILLER           PIC  9.
           88 InsertRow VALUE IS 1    WHEN SET TO FALSE  0. 
       01 tab-id.
           05 min-id           PIC  9(5)
                      OCCURS 9 TIMES.
           05 max-id           PIC  9(5)
                      OCCURS 9 TIMES.
       77 riga-edit        PIC  zzz.zzz.zz9.
       77 Screen1-Pg-1-Visible         PIC  9
                  VALUE IS 0.
       77 tipo-doc         PIC  x(50).
       77 imballi-ed       PIC  zz.zz9.
       77 Screen1-Pg-2-Visible         PIC  9
                  VALUE IS 0.
       77 como-prezzo      PIC  9(15)v999.
       77 codice-ed        PIC  z(5).
       77 Form1-St-1-Handle
                  USAGE IS HANDLE OF STATUS-BAR.
       77 Form1-Tb-1-Handle
                  USAGE IS HANDLE OF WINDOW.
       77 CountChar        PIC  9(3)
                  VALUE IS 0.
       77 TOOLBAR-BMP      PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 E-ESCI           PIC  9
                  VALUE IS 1.
       77 E-NUOVO          PIC  9
                  VALUE IS 0.
       77 E-CANCELLA       PIC  9
                  VALUE IS 0.
       77 E-SALVA          PIC  9
                  VALUE IS 1.
       77 E-ANTEPRIMA      PIC  9
                  VALUE IS 0.
       77 E-MODIFICA       PIC  9
                  VALUE IS 1.
       77 E-STAMPA         PIC  9
                  VALUE IS 0.
       77 E-CERCA          PIC  9
                  VALUE IS 0.
       77 E-SELEZIONA      PIC  9
                  VALUE IS 0.
       77 STATUS-tordini   PIC  X(2).
           88 Valid-STATUS-tordini VALUE IS "00" THRU "09". 
       77 STATUS-rordini   PIC  X(2).
           88 Valid-STATUS-rordini VALUE IS "00" THRU "09". 
       77 STATUS-agenti    PIC  X(2).
           88 Valid-STATUS-agenti VALUE IS "00" THRU "09". 
       77 STATUS-articoli  PIC  X(2).
           88 Valid-STATUS-articoli VALUE IS "00" THRU "09". 
       77 STATUS-clienti   PIC  X(2).
           88 Valid-STATUS-clienti VALUE IS "00" THRU "09". 
       77 STATUS-destini   PIC  X(2).
           88 Valid-STATUS-destini VALUE IS "00" THRU "09". 
       77 path-txt         PIC  X(32).
       77 STATUS-pass      PIC  X(2).
           88 Valid-STATUS-pass VALUE IS "00" THRU "09". 
       77 status-tcodpag   PIC  X(2).
           88 Valid-status-tcodpag VALUE IS "00" THRU "09". 
       77 STATUS-tcontat   PIC  X(2).
           88 Valid-STATUS-tcontat VALUE IS "00" THRU "09". 
       77 STATUS-tivaese   PIC  X(2).
           88 Valid-STATUS-tivaese VALUE IS "00" THRU "09". 
       77 STATUS-tparamge  PIC  X(2).
           88 Valid-STATUS-tparamge VALUE IS "00" THRU "09". 
       01 rec-grid.
           05 col-riga         PIC  z(5).
           05 col-codice       PIC  zzzzz9.
           05 col-descr        PIC  x(50).
           05 col-quantita     PIC  z(7)9
                      BLANK WHEN ZERO.
           05 col-prezzo       PIC  zzz.zzz.zz9,99.
           05 col-consumo      PIC  z.zz9,99.
           05 col-coubat       PIC  z.zz9,99.
           05 col-cod-iva      PIC  x(3).
       01 rec-visua.
           05 col-num          PIC  z(5).
           05 col-art          PIC  zzzzz9.
           05 col-des          PIC  x(150).
           05 col-qta          PIC  z(7)9.
           05 col-uni          PIC  zzz.zzz.zz9,99.
           05 col-sconto       PIC  z9,99.
           05 col-cons         PIC  z.zz9,99.
           05 col-cou          PIC  z.zz9,99.
           05 col-add          PIC  z.zz9,99.
           05 col-imp          PIC  zzz.zzz.zz9,99.
           05 col-iva          PIC  x(3).
           05 col-oma          PIC  x.
       77 lab-iva-buf      PIC  x(100).
       77 lab-pag-buf      PIC  x(100).
       77 lab-age-buf      PIC  x(100).
       77 lab-des-buf      PIC  x(100).
       77 lab-cli-buf      PIC  x(100).
       77 lab-ind-buf      PIC  x(100).
       77 lab-loca-bud     PIC  x(100).
       77 lab-loca-buf     PIC  x(100).
       77 lab-ind-d-buf    PIC  x(100).
       77 lab-loca-d-buf   PIC  x(100).
       77 AUTO-ID          PIC  9(6)
                  VALUE IS 96.
       77 cbo-stato-buf    PIC  X(10).
       01 OLD-tor-rec.
           05 OLD-tor-chiave.
               10 OLD-tor-anno     PIC  9(4).
               10 OLD-tor-numero   PIC  9(8).
           05 OLD-tor-dati.
               10 OLD-tor-causale  PIC  x(4).
               10 OLD-tor-cod-cli  PIC  9(5).
               10 OLD-tor-prg-destino          PIC  9(5).
               10 OLD-tor-num-ord-cli          PIC  X(10).
               10 OLD-tor-data-ordine          PIC  9(8).
               10 OLD-tor-data-passaggio-ordine            PIC  9(8).
               10 OLD-tor-cod-agente           PIC  9(5).
               10 OLD-tor-cod-pagamento        PIC  x(3).
               10 OLD-tor-cod-ese-iva          PIC  x(3).
               10 OLD-tor-spostam-ric-ago      PIC  X(1).
                   88 OLD-tor-si-ric-ago VALUE IS "S". 
                   88 OLD-tor-no-ric-ago VALUE IS "N". 
               10 OLD-tor-spostam-ric-dic      PIC  X(1).
                   88 OLD-tor-si-ric-dic VALUE IS "S". 
                   88 OLD-tor-no-ric-dic VALUE IS "N". 
               10 OLD-tor-vettore  PIC  9(5).
               10 OLD-tor-note1    PIC  X(19).
               10 OLD-tor-data-note1           PIC  9(8).
               10 OLD-tor-note2    PIC  X(30).
               10 OLD-tor-note3    PIC  X(30).
               10 OLD-tor-note4    PIC  X(30).
               10 OLD-tor-invio    PIC  x.
                   88 OLD-tor-invio-manuale VALUE IS "M". 
                   88 OLD-tor-invio-postel VALUE IS "P". 
               10 OLD-tor-bolla.
                   15 OLD-tor-anno-bolla           PIC  9(4).
                   15 OLD-tor-num-bolla            PIC  9(8).
                   15 OLD-tor-data-bolla           PIC  9(8).
                   15 OLD-tor-bolla-prenotata      PIC  x.
                       88 OLD-tor-bolla-si-prenotata VALUE IS "S". 
                       88 OLD-tor-bolla-no-prenotata VALUE IS "N". 
               10 OLD-tor-fattura.
                   15 OLD-tor-anno-fattura         PIC  9(4).
                   15 OLD-tor-num-fattura          PIC  9(8).
                   15 OLD-tor-data-fattura         PIC  9(8).
                   15 OLD-tor-num-prenot           PIC  9(8).
                   15 OLD-tor-fatt-prenotata       PIC  x.
                       88 OLD-tor-fatt-si-prenotata VALUE IS "S". 
                       88 OLD-tor-fatt-no-prenotata VALUE IS "N". 
               10 OLD-tor-mod-caricamento      PIC  X(1).
                   88 OLD-tor-manuale VALUE IS "M". 
                   88 OLD-tor-guidata VALUE IS "G". 
               10 OLD-tor-agg-contab           PIC  x.
                   88 OLD-tor-si-agg-contab VALUE IS "S". 
                   88 OLD-tor-no-agg-contab VALUE IS "N". 
               10 OLD-tor-tipo     PIC  x.
                   88 OLD-tor-fattura-manuale VALUE IS "M". 
                   88 OLD-tor-ordine VALUE IS "O". 
               10 OLD-tor-note     PIC  X(500).
               10 OLD-tor-contropartita        PIC  X(8).
               10 OLD-tor-stato    PIC  X(1).
                   88 OLD-tor-attivo VALUE IS "A". 
                   88 OLD-tor-disattivo VALUE IS "D". 
                   88 OLD-tor-bloccato VALUE IS "B". 
               10 OLD-tor-dati-comuni.
                   15 OLD-tor-data-creazione       PIC  9(8).
                   15 OLD-tor-ora-creazione        PIC  9(8).
                   15 OLD-tor-utente-creazione     PIC  X(10).
                   15 OLD-tor-data-ultima-modifica PIC  9(8).
                   15 OLD-tor-ora-ultima-modifica  PIC  9(8).
                   15 OLD-tor-utente-ultima-modifica           PIC  
           X(10).
               10 OLD-tor-vuoti.
                   15 OLD-tor-num-vuoto-1          PIC  9(15).
                   15 OLD-tor-num-vuoto-2          PIC  9(15).
                   15 OLD-tor-num-vuoto-3          PIC  9(15).
                   15 OLD-tor-alfa-vuoto-1         PIC  X(20).
                   15 OLD-tor-alfa-vuoto-2         PIC  X(20).
                   15 OLD-tor-alfa-vuoto-3         PIC  X(20).
       01 GiacenzaKey.
           10 gia-cod-articolo PIC  9(6).
           10 gia-cod-magazzino            PIC  X(3).
           10 gia-tipo-imballo PIC  X(3).
           10 gia-peso         PIC  9(5)V9(3).
       01 HiddenKey.
           10 hid-cod-articolo PIC  9(6).
           10 hid-cod-magazzino            PIC  X(3).
           10 hid-tipo-imballo PIC  X(3).
           10 hid-peso         PIC  9(5)V9(3).
       01 FILLER           PIC  9
                  VALUE IS 0.
           88 NonCambiareTab VALUE IS 1    WHEN SET TO FALSE  0. 
       01 FILLER           PIC  9
                  VALUE IS 0.
           88 ControllaCampi VALUE IS 1    WHEN SET TO FALSE  0. 
       01 FILLER           PIC  9
                  VALUE IS 1.
           88 CheckDestini VALUE IS 1    WHEN SET TO FALSE  0. 
       77 nome-file        PIC  x(15).
       77 titolo           PIC  x(100).
       77 Default-Font
                  USAGE IS HANDLE OF FONT DEFAULT-FONT.
       77 Form1-handle
                  USAGE IS HANDLE OF WINDOW.
       77 tit-screen       PIC  x(100).
       77 ef-iva-FTMA-buf  PIC  x(3).
       77 ef-prz-FTMA-buf  PIC  zzz.zzz.zz9,99.
       77 ef-descr-buf     PIC  X(150).
       77 Courier-New18-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 v-FTTR           PIC  9
                  VALUE IS 0.
       77 ef-art-buf       PIC  z(6).
       77 lab-art-buf      PIC  x(50).
       77 ef-qta-buf       PIC  z(8).
       77 ef-prz-buf       PIC  zzz.zzz.zz9,99.
       77 ef-iva-buf       PIC  X(3).
       77 EF-LinesWithout  PIC  S9(4)V9(2)
                  VALUE IS 40,00.
       77 LastPrg          PIC  9(5).
       77 STATUS-tmarche   PIC  X(2).
           88 Valid-STATUS-tmarche VALUE IS "00" THRU "09". 
       77 STATUS-timposte  PIC  X(2).
           88 Valid-STATUS-timposte VALUE IS "00" THRU "09". 
       77 STATUS-tcaumag   PIC  X(2).
           88 Valid-STATUS-tcaumag VALUE IS "00" THRU "09". 
       77 STATUS-progmag   PIC  X(2).
           88 Valid-STATUS-progmag VALUE IS "00" THRU "09". 
       77 STATUS-mas       PIC  X(2).
           88 Valid-STATUS-mas VALUE IS "00" THRU "09". 
       77 ef-coubat-buf    PIC  z.zz9,99.
       77 ef-consumo-buf   PIC  zzz.zzz.zz9,99.
       77 ef-coubat-FTMA-buf           PIC  z.zz9,99.
       77 ef-consumo-FTMA-buf          PIC  z.zz9,99.
       77 v-FTMA           PIC  9
                  VALUE IS 0.
       77 ef-qta-FTMA-buf  PIC  z(8).
       77 v-screen         PIC  9
                  VALUE IS 0.
       77 lab-piano-buf    PIC  x(100).
       77 STATUS-recapiti  PIC  X(2).
           88 Valid-STATUS-recapiti VALUE IS "00" THRU "09". 
       77 modif-iva-bmp    PIC  S9(9)
                  USAGE IS COMP-4
                  VALUE IS 0.
       77 Verdana12B-Occidentale
                  USAGE IS HANDLE OF FONT.
       77 lab-anno-buf     PIC  X(20)
                  VALUE IS "Label".
       77 STATUS-brordini  PIC  X(2).
           88 Valid-STATUS-brordini VALUE IS "00" THRU "09". 
       77 STATUS-btordini  PIC  X(2).
           88 Valid-STATUS-btordini VALUE IS "00" THRU "09". 
       77 ef-add-buf       PIC  z.zz9,99.
       77 ef-add-FTMA-buf  PIC  z.zz9,99.
       77 v-bozza          PIC  9
                  VALUE IS 0.
       77 lab-data-bolla-buf           PIC  99/99/9999.
       77 lab-num-bolla-buf            PIC  x(20)
                  VALUE IS "XXXXXXXXXXXXXXXXXXX0".
       77 lab-motivo-buf   PIC  x(500).
       77 lab-colpa-buf    PIC  x(30).
       77 lab-altre-buf    PIC  x(500).
       77 v-fatt           PIC  9
                  VALUE IS 1.
       77 STATUS-brnotacr  PIC  X(2).
           88 Valid-STATUS-brnotacr VALUE IS "00" THRU "09". 
       77 STATUS-btnotacr  PIC  X(2).
           88 Valid-STATUS-btnotacr VALUE IS "00" THRU "09". 
       77 lab-num-b-buf    PIC  z(8).
       77 lab-data-b-buf   PIC  99/99/9999.
       77 lab-num-buf      PIC  z(8).
       77 lab-data-buf     PIC  99/99/9999.
       77 lab-corriere-buf PIC  z(5).
       77 lab-corriere-des-buf         PIC  x(50).
       77 STATUS-tvettori  PIC  X(2).
           88 Valid-STATUS-tvettori VALUE IS "00" THRU "09". 

      ***********************************************************
      *   Code Gen's Buffer                                     *
      ***********************************************************
       77 Screen1-Ta-1-TAB-VALUE  PIC  99  VALUE 1.
       77 STATUS-Form1-FLAG-REFRESH PIC  9.
          88 Form1-FLAG-REFRESH  VALUE 1 FALSE 0. 
      * DATA CONTROL BUFFER
       01 Form1-BUF.
      * Page
              05 Screen1-Pg-1-BUF.
      * Data.Entry-Field
              10 ef-cli-BUF PIC x(5).
      * Data.Entry-Field
              10 ef-des-BUF PIC x(5).
      * Data.Entry-Field
              10 ef-age-BUF PIC zzzz9.
      * Data.Entry-Field
              10 ef-pag-BUF PIC X(3).
      * Data.Entry-Field
              10 ef-iva-ese-BUF PIC X(3).
      * Data.Entry-Field
              10 ef-piano-BUF PIC X(8).
      * Data.Entry-Field
              10 ef-note-BUF PIC X(500).
      * Data.Entry-Field
              10 ef-fatt-num-BUF PIC x(8).
      * Data.Entry-Field
              10 ef-fatt-data-BUF PIC 99/99/9999.

       77 TMP-DataSet1-tordini-BUF     PIC X(3898).
       77 TMP-DataSet1-agenti-BUF     PIC X(1233).
       77 TMP-DataSet1-tparamge-BUF     PIC X(815).
       77 TMP-DataSet1-rordini-BUF     PIC X(667).
       77 TMP-DataSet1-destini-BUF     PIC X(3386).
       77 TMP-DataSet1-tivaese-BUF     PIC X(1380).
       77 TMP-DataSet1-tcodpag-BUF     PIC X(1380).
       77 TMP-DataSet1-clienti-BUF     PIC X(1910).
       77 TMP-DataSet1-articoli-BUF     PIC X(3669).
       77 TMP-DataSet1-tcontat-BUF     PIC X(3270).
       77 TMP-DataSet1-tcaumag-BUF     PIC X(254).
       77 TMP-DataSet1-progmag-BUF     PIC X(1090).
       77 TMP-DataSet1-MAS-BUF     PIC X(512).
       77 TMP-DataSet1-tmarche-BUF     PIC X(217).
       77 TMP-DataSet1-recapiti-BUF     PIC X(328).
       77 TMP-DataSet1-brnotacr-BUF     PIC X(424).
       77 TMP-DataSet1-btnotacr-BUF     PIC X(912).
       77 TMP-DataSet1-tvettori-BUF     PIC X(1847).
      * VARIABLES FOR RECORD LENGTH.
       77  TotemFdSlRecordClearOffset   PIC 9(5) COMP-4.
       77  TotemFdSlRecordLength        PIC 9(5) COMP-4.
      * FILE'S LOCK MODE FLAG
       77 DataSet1-tordini-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tordini-LOCK  VALUE "Y".
       77 DataSet1-KEYIS   PIC 9(3) VALUE 1.
       77 DataSet1-tordini-KEY1-ORDER  PIC X VALUE "A".
          88 DataSet1-tordini-KEY1-Asc  VALUE "A".
          88 DataSet1-tordini-KEY1-Desc VALUE "D".
       77 DataSet1-agenti-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-agenti-LOCK  VALUE "Y".
       77 DataSet1-agenti-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-agenti-KEY-Asc  VALUE "A".
          88 DataSet1-agenti-KEY-Desc VALUE "D".
       77 DataSet1-tparamge-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tparamge-LOCK  VALUE "Y".
       77 DataSet1-tparamge-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tparamge-KEY-Asc  VALUE "A".
          88 DataSet1-tparamge-KEY-Desc VALUE "D".
       77 DataSet1-rordini-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-rordini-LOCK  VALUE "Y".
       77 DataSet1-rordini-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-rordini-KEY-Asc  VALUE "A".
          88 DataSet1-rordini-KEY-Desc VALUE "D".
       77 DataSet1-destini-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-destini-LOCK  VALUE "Y".
       77 DataSet1-destini-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-destini-KEY-Asc  VALUE "A".
          88 DataSet1-destini-KEY-Desc VALUE "D".
       77 DataSet1-tivaese-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tivaese-LOCK  VALUE "Y".
       77 DataSet1-tivaese-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tivaese-KEY-Asc  VALUE "A".
          88 DataSet1-tivaese-KEY-Desc VALUE "D".
       77 DataSet1-tcodpag-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tcodpag-LOCK  VALUE "Y".
       77 DataSet1-tcodpag-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tcodpag-KEY-Asc  VALUE "A".
          88 DataSet1-tcodpag-KEY-Desc VALUE "D".
       77 DataSet1-clienti-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-clienti-LOCK  VALUE "Y".
       77 DataSet1-clienti-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-clienti-KEY-Asc  VALUE "A".
          88 DataSet1-clienti-KEY-Desc VALUE "D".
       77 DataSet1-articoli-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-articoli-LOCK  VALUE "Y".
       77 DataSet1-articoli-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-articoli-KEY-Asc  VALUE "A".
          88 DataSet1-articoli-KEY-Desc VALUE "D".
       77 DataSet1-tcontat-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tcontat-LOCK  VALUE "Y".
       77 DataSet1-tcontat-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tcontat-KEY-Asc  VALUE "A".
          88 DataSet1-tcontat-KEY-Desc VALUE "D".
       77 DataSet1-tcaumag-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tcaumag-LOCK  VALUE "Y".
       77 DataSet1-tcaumag-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tcaumag-KEY-Asc  VALUE "A".
          88 DataSet1-tcaumag-KEY-Desc VALUE "D".
       77 DataSet1-progmag-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-progmag-LOCK  VALUE "Y".
       77 DataSet1-progmag-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-progmag-KEY-Asc  VALUE "A".
          88 DataSet1-progmag-KEY-Desc VALUE "D".
       77 DataSet1-MAS-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-MAS-LOCK  VALUE "Y".
       77 DataSet1-MAS-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-MAS-KEY-Asc  VALUE "A".
          88 DataSet1-MAS-KEY-Desc VALUE "D".
       77 DataSet1-tmarche-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tmarche-LOCK  VALUE "Y".
       77 DataSet1-tmarche-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tmarche-KEY-Asc  VALUE "A".
          88 DataSet1-tmarche-KEY-Desc VALUE "D".
       77 DataSet1-recapiti-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-recapiti-LOCK  VALUE "Y".
       77 DataSet1-recapiti-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-recapiti-KEY-Asc  VALUE "A".
          88 DataSet1-recapiti-KEY-Desc VALUE "D".
       77 DataSet1-brnotacr-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-brnotacr-LOCK  VALUE "Y".
       77 DataSet1-brnotacr-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-brnotacr-KEY-Asc  VALUE "A".
          88 DataSet1-brnotacr-KEY-Desc VALUE "D".
       77 DataSet1-btnotacr-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-btnotacr-LOCK  VALUE "Y".
       77 DataSet1-btnotacr-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-btnotacr-KEY-Asc  VALUE "A".
          88 DataSet1-btnotacr-KEY-Desc VALUE "D".
       77 DataSet1-tvettori-LOCK-FLAG   PIC X VALUE SPACE.
           88 DataSet1-tvettori-LOCK  VALUE "Y".
       77 DataSet1-tvettori-KEY-ORDER  PIC X VALUE "A".
          88 DataSet1-tvettori-KEY-Asc  VALUE "A".
          88 DataSet1-tvettori-KEY-Desc VALUE "D".

       77 tordini-k-causale-SPLITBUF  PIC X(17).
       77 tordini-k1-SPLITBUF  PIC X(23).
       77 tordini-k2-SPLITBUF  PIC X(21).
       77 tordini-k-bolla-SPLITBUF  PIC X(13).
       77 tordini-k3-SPLITBUF  PIC X(22).
       77 tordini-k-fattura-SPLITBUF  PIC X(13).
       77 tordini-k4-SPLITBUF  PIC X(30).
       77 tordini-k-contab-SPLITBUF  PIC X(14).
       77 tordini-k-tipo-SPLITBUF  PIC X(14).
       77 tordini-k-data-SPLITBUF  PIC X(17).
       77 tordini-k-agfatt-SPLITBUF  PIC X(42).
       77 tordini-k-stbolle-SPLITBUF  PIC X(34).
       77 tordini-k-andamento-data-SPLITBUF  PIC X(10).
       77 tordini-k-andamento-cliente-SPLITBUF  PIC X(15).
       77 tordini-k-andamento-clides-SPLITBUF  PIC X(20).
       77 tordini-k-promo-SPLITBUF  PIC X(29).
       77 tordini-k-or-SPLITBUF  PIC X(21).
       77 tordini-k-tor-inviare-SPLITBUF  PIC X(14).
       77 tordini-k-tor-tipocli-SPLITBUF  PIC X(25).
       77 tordini-k-tor-gdo-SPLITBUF  PIC X(28).
       77 rordini-ror-k-promo-SPLITBUF  PIC X(16).
       77 rordini-ror-k-articolo-SPLITBUF  PIC X(24).
       77 rordini-ror-k-master-SPLITBUF  PIC X(35).
       77 rordini-ror-k-stbolle-SPLITBUF  PIC X(30).
       77 destini-K1-SPLITBUF  PIC X(51).
       77 destini-k-localita-SPLITBUF  PIC X(36).
       77 tivaese-key01-SPLITBUF  PIC X(53).
       77 tcodpag-TBL-CODICE-01-SPLITBUF  PIC X(53).
       77 clienti-cli-K1-SPLITBUF  PIC X(47).
       77 clienti-cli-K3-SPLITBUF  PIC X(12).
       77 clienti-cli-K4-SPLITBUF  PIC X(8).
       77 articoli-art-k1-SPLITBUF  PIC X(51).
       77 articoli-art-k-frn-SPLITBUF  PIC X(16).
       77 tcaumag-k-mag-SPLITBUF  PIC X(5).
       77 progmag-key01-SPLITBUF  PIC X(21).
       77 MAS-MAS-CODICE1-SPLITBUF  PIC X(39).
       77 MAS-MAS-CODICE2-SPLITBUF  PIC X(39).
       77 brnotacr-brno-k-articolo-SPLITBUF  PIC X(25).
       77 btnotacr-k1-SPLITBUF  PIC X(23).
       77 btnotacr-k-data-SPLITBUF  PIC X(17).
       77 btnotacr-k-fattura-SPLITBUF  PIC X(13).
       77 btnotacr-k-reso-SPLITBUF  PIC X(13).
       77 btnotacr-k-bolla-SPLITBUF  PIC X(25).
       77 btnotacr-k-vettore-SPLITBUF  PIC X(18).
       77 btnotacr-k-nota-SPLITBUF  PIC X(13).
       77 btnotacr-k-fatman-SPLITBUF  PIC X(13).
       77 tvettori-k-des-SPLITBUF  PIC X(41).

      *{TOTEM}END

      *{TOTEM}ID-LOGICI
      ***** Elenco ID Logici *****
       78  78-ID-ef-cli VALUE 5001.
       78  78-ID-ef-des VALUE 5002.
       78  78-ID-ef-age VALUE 5003.
       78  78-ID-ef-pag VALUE 5004.
       78  78-ID-ef-iva-ese VALUE 5005.
       78  78-ID-ef-piano VALUE 5006.
       78  78-ID-ef-note VALUE 5007.
       78  78-ID-cbo-stato VALUE 5008.
       78  78-ID-ef-fatt-num VALUE 5009.
       78  78-ID-ef-fatt-data VALUE 5010.
       78  78-ID-form1-gd-1 VALUE 5011.
       78  78-ID-ef-descr VALUE 5012.
       78  78-ID-ef-prz-FTMA VALUE 5013.
       78  78-ID-ef-consumo-FTMA VALUE 5014.
       78  78-ID-ef-coubat-FTMA VALUE 5015.
       78  78-ID-ef-add-FTMA VALUE 5016.
       78  78-ID-ef-iva-FTMA VALUE 5017.
       78  78-ID-ef-art VALUE 5018.
       78  78-ID-ef-qta VALUE 5019.
       78  78-ID-ef-prz VALUE 5020.
       78  78-ID-ef-consumo VALUE 5021.
       78  78-ID-ef-coubat VALUE 5022.
       78  78-ID-ef-add VALUE 5023.
       78  78-ID-ef-iva VALUE 5024.
      ***** Fine ID Logici *****
      *{TOTEM}END

       LINKAGE          SECTION.
      *{TOTEM}LINKAGE
           COPY  "COMMON-LINKAGE.DEF".
           COPY  "LINK-FATMAN.DEF".
      *{TOTEM}END

       SCREEN           SECTION.
      *{TOTEM}COPY-SCREEN
      * FORM
       01 
           Form1, 
           AFTER PROCEDURE Form1-AfterProcedure,
           BEFORE PROCEDURE Form1-BeforeProcedure,
           .

      * TAB
       05
           Screen1-Ta-1, 
           Tab-Control, 
           COL 1,14, 
           LINE 1,77,
           LINES 44,54 ,
           SIZE 157,00 ,
           FONT IS Small-Font,
           ID IS 1,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           EVENT PROCEDURE Screen1-Ta-1-Event-Proc,
           .

      * PAGE
       05
           Screen1-Pg-1, 
           VISIBLE Screen1-Pg-1-Visible,
           COL 2, 
           LINE 4,
           .

      * ENTRY FIELD
       10
           ef-cli, 
           Entry-Field, 
           COL 22,81, 
           LINE 17,38,
           LINES 1,31 ,
           SIZE 7,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 78-ID-ef-cli,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 5,
           VALUE ef-cli-BUF,
           .

      * ENTRY FIELD
       10
           ef-des, 
           Entry-Field, 
           COL 22,81, 
           LINE 19,61,
           LINES 1,31 ,
           SIZE 7,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 78-ID-ef-des,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 5,
           VALUE ef-des-BUF,
           .

      * ENTRY FIELD
       10
           ef-age, 
           Entry-Field, 
           COL 22,81, 
           LINE 21,84,
           LINES 1,31 ,
           SIZE 7,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 78-ID-ef-age,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 5,
           VALUE ef-age-BUF,
           .

      * ENTRY FIELD
       10
           ef-pag, 
           Entry-Field, 
           COL 22,81, 
           LINE 24,08,
           LINES 1,31 ,
           SIZE 7,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 78-ID-ef-pag,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 3,
           VALUE ef-pag-BUF,
           .

      * ENTRY FIELD
       10
           ef-iva-ese, 
           Entry-Field, 
           COL 22,81, 
           LINE 26,31,
           LINES 1,31 ,
           SIZE 7,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 78-ID-ef-iva-ese,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 3,
           VALUE ef-iva-ese-BUF,
           .

      * ENTRY FIELD
       10
           ef-piano, 
           Entry-Field, 
           COL 22,81, 
           LINE 28,54,
           LINES 1,31 ,
           SIZE 10,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 78-ID-ef-piano,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 8,
           VALUE ef-piano-BUF,
           .

      * ENTRY FIELD
       10
           ef-note, 
           Entry-Field, 
           COL 22,81, 
           LINE 31,54,
           LINES 9,00 ,
           SIZE 121,00 ,
           BOXED,
           COLOR IS 513,
           ENABLED mod,
           FONT IS Courier-New18-Occidentale,
           ID IS 78-ID-ef-note,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 160,
           VSCROLL-BAR,
           USE-RETURN,
           VALUE ef-note-BUF,
           .

      * COMBO-BOX
       10
           cbo-stato, 
           Combo-Box, 
           COL 22,81, 
           LINE 41,00,
           LINES 5,00 ,
           SIZE 17,00 ,
           3-D,
           COLOR IS 513,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 78-ID-cbo-stato,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MASS-UPDATE 0,
           NOTIFY-SELCHANGE,
           DROP-LIST,
           UNSORTED,
           VALUE cbo-stato-buf,
           AFTER PROCEDURE cbo-stato-AfterProcedure, 
           .

      * LABEL
       10
           Screen1-La-1, 
           Label, 
           COL 3,81, 
           LINE 17,38,
           LINES 1,30 ,
           SIZE 18,00 ,
           FONT IS Small-Font,
           ID IS 81,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Codice Cliente",
           .

      * LABEL
       10
           Screen1-La-2, 
           Label, 
           COL 3,81, 
           LINE 19,61,
           LINES 1,30 ,
           SIZE 18,00 ,
           FONT IS Small-Font,
           ID IS 83,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Progressivo Destino",
           .

      * LABEL
       10
           Screen1-La-4, 
           Label, 
           COL 3,81, 
           LINE 21,84,
           LINES 1,30 ,
           SIZE 18,00 ,
           FONT IS Small-Font,
           ID IS 87,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Codice Agente",
           .

      * LABEL
       10
           Screen1-La-5, 
           Label, 
           COL 3,81, 
           LINE 24,08,
           LINES 1,30 ,
           SIZE 18,00 ,
           FONT IS Small-Font,
           ID IS 89,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Codice Pagamento",
           .

      * LABEL
       10
           Screen1-La-6, 
           Label, 
           COL 3,81, 
           LINE 26,31,
           LINES 1,31 ,
           SIZE 18,00 ,
           FONT IS Small-Font,
           ID IS 91,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Codice Esenzione IVA",
           .

      * LABEL
       10
           Screen1-La-7, 
           Label, 
           COL 3,81, 
           LINE 31,54,
           LINES 1,31 ,
           SIZE 18,00 ,
           FONT IS Small-Font,
           ID IS 93,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Intestazione",
           .

      * LABEL
       10
           lab-iva, 
           Label, 
           COL 30,81, 
           LINE 26,31,
           LINES 1,31 ,
           SIZE 77,00 ,
           COLOR IS 5,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 97,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-iva-buf,
           .

      * LABEL
       10
           lab-pag, 
           Label, 
           COL 30,81, 
           LINE 24,08,
           LINES 1,31 ,
           SIZE 77,00 ,
           COLOR IS 5,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 98,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-pag-buf,
           .

      * LABEL
       10
           lab-age, 
           Label, 
           COL 30,81, 
           LINE 21,84,
           LINES 1,31 ,
           SIZE 77,00 ,
           COLOR IS 5,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 99,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-age-buf,
           .

      * LABEL
       10
           lab-cli, 
           Label, 
           COL 30,81, 
           LINE 17,38,
           LINES 2,00 ,
           SIZE 40,00 ,
           COLOR IS 5,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 100,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-cli-buf,
           .

      * LABEL
       10
           lab-ind, 
           Label, 
           COL 72,81, 
           LINE 17,38,
           LINES 2,00 ,
           SIZE 40,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 101,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-ind-buf,
           .

      * LABEL
       10
           lab-loca, 
           Label, 
           COL 114,81, 
           LINE 17,38,
           LINES 2,00 ,
           SIZE 40,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 102,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-loca-buf,
           .

      * LABEL
       10
           lab-des, 
           Label, 
           COL 30,81, 
           LINE 19,61,
           LINES 2,00 ,
           SIZE 40,00 ,
           COLOR IS 5,
           ENABLED mod,
           FONT IS Small-Font,
           ID IS 103,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-des-buf,
           .

      * LABEL
       10
           lab-ind-d, 
           Label, 
           COL 72,81, 
           LINE 19,61,
           LINES 2,00 ,
           SIZE 40,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 104,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-ind-d-buf,
           .

      * LABEL
       10
           lab-loca-d, 
           Label, 
           COL 114,81, 
           LINE 19,61,
           LINES 2,00 ,
           SIZE 40,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 105,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-loca-d-buf,
           .

      * LABEL
       10
           Form1-La-29, 
           Label, 
           COL 3,81, 
           LINE 41,00,
           LINES 1,31 ,
           SIZE 15,00 ,
           FONT IS Small-Font,
           ID IS 57,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Stato",
           .

      * LABEL
       10
           Screen1-blockpgm-1, 
           Label, 
           COL 154,14, 
           LINE 14,31,
           LINES 0,77 ,
           SIZE 3,17 ,
           ID IS 59,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "BlockPgm",
           VISIBLE v-custom,
           .

      * LABEL
       10
           Screen1-Custom1-1, 
           Label, 
           COL 139,31, 
           LINE 14,15,
           LINES 0,69 ,
           SIZE 4,83 ,
           FONT IS Default-Font,
           ID IS 60,
           TRANSPARENT,
           TITLE "CUSTOM CONTROL",
           VISIBLE v-custom,
           .

      * LABEL
       10
           Screen1-La-8a, 
           Label, 
           COL 3,81, 
           LINE 28,54,
           LINES 1,31 ,
           SIZE 18,00 ,
           FONT IS Small-Font,
           ID IS 2,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Contropartita Contabile",
           .

      * LABEL
       10
           lab-piano, 
           Label, 
           COL 34,81, 
           LINE 28,54,
           LINES 1,31 ,
           SIZE 85,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 4,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-piano-buf,
           .

      * BAR
       10
           Screen1-Br-2, 
           Bar,
           COL 90,81, 
           LINE 30,54,
           LINES 1,00 ,
           ID IS 5,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           WIDTH 2,
           .

      * FRAME
       10
           Screen1-Fr-1b, 
           Frame, 
           COL 2,98, 
           LINE 4,00,
           LINES 11,54 ,
           SIZE 112,50 ,
           COLOR IS 2,
           ID IS 11,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Dati Bozza",
           TITLE-POSITION 3,
           VISIBLE v-bozza,
           .

      * LABEL
       10
           Screen1-La-9b, 
           Label, 
           COL 33,31, 
           LINE 5,00,
           LINES 1,31 ,
           SIZE 3,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 12,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "del",
           VISIBLE v-bozza,
           .

      * LABEL
       10
           lab-tipodocb, 
           Label, 
           COL 4,48, 
           LINE 5,00,
           LINES 1,31 ,
           SIZE 8,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 13,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Bolla n.",
           VISIBLE v-bozza,
           .

      * LABEL
       10
           lab-data-bolla, 
           Label, 
           COL 37,31, 
           LINE 5,00,
           LINES 1,31 ,
           SIZE 10,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 14,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE lab-data-bolla-buf,
           VISIBLE v-bozza,
           .

      * LABEL
       10
           lab-num-bolla, 
           Label, 
           COL 17,31, 
           LINE 5,00,
           LINES 1,31 ,
           SIZE 14,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 15,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           TRANSPARENT,
           TITLE lab-num-bolla-buf,
           VISIBLE v-bozza,
           .

      * LABEL
       10
           lab-tipodocba, 
           Label, 
           COL 4,48, 
           LINE 6,92,
           LINES 2,54 ,
           SIZE 11,67 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 16,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Motivo contestazione",
           VISIBLE v-bozza,
           .

      * LABEL
       10
           lab-motivo, 
           Label, 
           COL 17,31, 
           LINE 6,92,
           LINES 2,50 ,
           SIZE 95,33 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 17,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-motivo-buf,
           VISIBLE v-bozza,
           .

      * LABEL
       10
           lab-tipodocbb, 
           Label, 
           COL 4,48, 
           LINE 10,15,
           LINES 1,31 ,
           SIZE 11,67 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 18,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Errore colpa",
           VISIBLE v-bozza,
           .

      * LABEL
       10
           lab-colpa, 
           Label, 
           COL 17,31, 
           LINE 10,15,
           LINES 1,31 ,
           SIZE 17,83 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 19,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-colpa-buf,
           VISIBLE v-bozza,
           .

      * LABEL
       10
           lab-tipodocbaa, 
           Label, 
           COL 4,65, 
           LINE 12,23,
           LINES 2,54 ,
           SIZE 11,67 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 20,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Altre annotazioni",
           VISIBLE v-bozza,
           .

      * LABEL
       10
           lab-altre, 
           Label, 
           COL 17,31, 
           LINE 12,23,
           LINES 2,00 ,
           SIZE 96,83 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 21,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-altre-buf,
           VISIBLE v-bozza,
           .

      * LABEL
       10
           lab-tipodocbba, 
           Label, 
           COL 39,65, 
           LINE 10,15,
           LINES 1,31 ,
           SIZE 7,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 23,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Corriere",
           VISIBLE v-bozza,
           .

      * LABEL
       10
           lab-corriere, 
           Label, 
           COL 47,98, 
           LINE 10,15,
           LINES 1,31 ,
           SIZE 5,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 22,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-corriere-buf,
           VISIBLE v-bozza,
           .

      * LABEL
       10
           lab-corriere-des, 
           Label, 
           COL 54,98, 
           LINE 10,15,
           LINES 1,31 ,
           SIZE 40,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 24,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-corriere-des-buf,
           VISIBLE v-bozza,
           .

      * FRAME
       10
           Screen1-Fr-1a, 
           Frame, 
           COL 118,48, 
           LINE 4,00,
           LINES 2,77 ,
           SIZE 38,00 ,
           COLOR IS 2,
           ID IS 6,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Riferimenti documento",
           TITLE-POSITION 3,
           VISIBLE v-bozza,
           .

      * LABEL
       10
           Screen1-La-9a, 
           Label, 
           COL 140,48, 
           LINE 5,00,
           LINES 1,31 ,
           SIZE 3,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 7,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "del",
           VISIBLE v-bozza,
           .

      * LABEL
       10
           lab-tipodoca, 
           Label, 
           COL 119,98, 
           LINE 5,00,
           LINES 1,31 ,
           SIZE 8,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 8,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Bozza n.",
           VISIBLE v-bozza,
           .

      * LABEL
       10
           lab-data-b, 
           Label, 
           COL 144,48, 
           LINE 5,00,
           LINES 1,31 ,
           SIZE 10,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 9,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE lab-data-b-buf,
           VISIBLE v-bozza,
           .

      * LABEL
       10
           lab-num-b, 
           Label, 
           COL 129,48, 
           LINE 5,00,
           LINES 1,31 ,
           SIZE 9,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 10,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           TRANSPARENT,
           TITLE lab-num-b-buf,
           VISIBLE v-bozza,
           .

      * FRAME
       10
           Screen1-Fr-1, 
           Frame, 
           COL 118,48, 
           LINE 12,69,
           LINES 2,85 ,
           SIZE 38,00 ,
           COLOR IS 2,
           ID IS 61,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TITLE "Riferimenti documento EDI",
           TITLE-POSITION 3,
           .

      * ENTRY FIELD
       10
           ef-fatt-num, 
           Entry-Field, 
           COL 129,48, 
           LINE 13,69,
           LINES 1,31 ,
           SIZE 9,00 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-ef-fatt-num,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 8,
           VALUE ef-fatt-num-BUF,
           .

      * ENTRY FIELD
       10
           ef-fatt-data, 
           Entry-Field, 
           COL 144,48, 
           LINE 13,69,
           LINES 1,31 ,
           SIZE 11,00 ,
           BOXED,
           COLOR IS 513,
           ID IS 78-ID-ef-fatt-data,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           MAX-TEXT 8,
           VALUE ef-fatt-data-BUF,
           .

      * LABEL
       10
           Screen1-La-9, 
           Label, 
           COL 140,48, 
           LINE 13,69,
           LINES 1,31 ,
           SIZE 3,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 62,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "del",
           .

      * LABEL
       10
           lab-tipodoc, 
           Label, 
           COL 119,98, 
           LINE 13,69,
           LINES 1,31 ,
           SIZE 8,00 ,
           COLOR IS 2,
           FONT IS Small-Font,
           ID IS 63,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Fattura n.",
           .

      * PAGE
       05
           Screen1-Pg-2, 
           VISIBLE Screen1-Pg-2-Visible,
           COL 2, 
           LINE 4,
           .

      * PUSH BUTTON
       10
           pb-nuovo, 
           Push-Button, 
           COL 129,14, 
           LINE 38,77,
           LINES 21,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE STRIP_GRID_GCLIENTI-BMP,
           BITMAP-NUMBER 5,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 5002,
           FLAT,
           FONT IS Small-Font,
           ID IS 25,
           SELF-ACT,
           TITLE "N&uova riga",
           AFTER PROCEDURE pb-nuovo-AfterProcedure, 
           BEFORE PROCEDURE pb-nuovo-BeforeProcedure, 
           .

      * PUSH BUTTON
       10
           pb-elimina, 
           Push-Button, 
           COL 142,14, 
           LINE 38,77,
           LINES 21,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE STRIP_GRID_GCLIENTI-BMP,
           BITMAP-NUMBER 4,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 5003,
           FLAT,
           FONT IS Small-Font,
           ID IS 26,
           SELF-ACT,
           TITLE "&Elimina la riga selezionata",
           AFTER PROCEDURE pb-elimina-AfterProcedure, 
           BEFORE PROCEDURE pb-elimina-BeforeProcedure, 
           .

      * GRID
       10
           form1-gd-1, 
           Grid, 
           COL 3,81, 
           LINE 5,46,
           LINES 33,00 ,
           SIZE 151,00 ,
           ADJUSTABLE-COLUMNS,
           BOXED,
           CENTERED-HEADINGS,
           COLOR IS 516,
           DATA-COLUMNS (1, 6, 12, 162, 170, 184, 198, 212, 220),
           ALIGNMENT ("R", "R", "U", "R", "R", "R", "R", "R", "C"),
           SEPARATION (5, 5, 5, 5, 5, 5, 5, 5, 5),
           DATA-TYPES ("9(5)", "9(6)", "X", "9(8)", "9(12)", "9(12)", "9
      -    "(12)", "X", "x(3)"),
           NUM-COL-HEADINGS 1,
           COLUMN-HEADINGS,
           CURSOR-FRAME-WIDTH 0,
           DIVIDER-COLOR 1,
           HEADING-COLOR 257,
           HEADING-DIVIDER-COLOR 1,
           ID IS 78-ID-form1-gd-1,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           ROW-HEADINGS,
           TILED-HEADINGS,
           VIRTUAL-WIDTH 147,
           VPADDING 50,
           VSCROLL,
           EVENT PROCEDURE form1-gd-1-Event-Proc,
           .

      * ENTRY FIELD
       10
           ef-descr, 
           Entry-Field, 
           COL 10,81, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 66,00 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 78-ID-ef-descr,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 150,
           VALUE ef-descr-buf,
           VISIBLE v-FTMA,
           AFTER PROCEDURE ef-descr-AfterProcedure, 
           .

      * ENTRY FIELD
       10
           ef-prz-FTMA, 
           Entry-Field, 
           COL 84,31, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 9,00 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 78-ID-ef-prz-FTMA,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 11,
           VALUE ef-prz-FTMA-buf,
           VISIBLE v-FTMA,
           AFTER PROCEDURE ef-prz-FTMA-AfterProcedure, 
           .

      * ENTRY FIELD
       10
           ef-consumo-FTMA, 
           Entry-Field, 
           COL 99,98, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 8,00 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 78-ID-ef-consumo-FTMA,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 6,
           VALUE ef-consumo-FTMA-buf,
           VISIBLE v-FTMA,
           AFTER PROCEDURE ef-consumo-FTMA-AfterProcedure, 
           .


      * ENTRY FIELD
       10
           ef-coubat-FTMA, 
           Entry-Field, 
           COL 116,81, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 8,00 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 78-ID-ef-coubat-FTMA,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 6,
           VALUE ef-coubat-FTMA-buf,
           VISIBLE v-FTMA,
           AFTER PROCEDURE ef-coubat-FTMA-AfterProcedure, 
           .


      * ENTRY FIELD
       10
           ef-add-FTMA, 
           Entry-Field, 
           COL 132,98, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 8,00 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 78-ID-ef-add-FTMA,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 6,
           VALUE ef-add-FTMA-buf,
           VISIBLE v-FTMA,
           AFTER PROCEDURE ef-add-FTMA-AfterProcedure, 
           .


      * ENTRY FIELD
       10
           ef-iva-FTMA, 
           Entry-Field, 
           COL 147,81, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 7,00 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 78-ID-ef-iva-FTMA,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 3,
           VALUE ef-iva-FTMA-buf,
           VISIBLE v-FTMA,
           AFTER PROCEDURE ef-iva-FTMA-AfterProcedure, 
           .

      * ENTRY FIELD
       10
           ef-art, 
           Entry-Field, 
           COL 10,81, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 8,00 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 78-ID-ef-art,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 6,
           VALUE ef-art-buf,
           VISIBLE v-FTTR,
           AFTER PROCEDURE ef-art-AfterProcedure, 
           .


      * ENTRY FIELD
       10
           ef-qta, 
           Entry-Field, 
           COL 69,81, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 7,00 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 78-ID-ef-qta,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 8,
           VALUE ef-qta-buf,
           VISIBLE v-FTTR,
           AFTER PROCEDURE ef-qta-AfterProcedure, 
           .


      * ENTRY FIELD
       10
           ef-prz, 
           Entry-Field, 
           COL 84,31, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 9,00 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 78-ID-ef-prz,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 11,
           VALUE ef-prz-buf,
           VISIBLE v-FTTR,
           AFTER PROCEDURE ef-prz-AfterProcedure, 
           .


      * ENTRY FIELD
       10
           ef-consumo, 
           Entry-Field, 
           COL 99,98, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 8,00 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 78-ID-ef-consumo,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 6,
           VALUE ef-consumo-buf,
           VISIBLE v-FTTR,
           AFTER PROCEDURE ef-consumo-AfterProcedure, 
           .


      * ENTRY FIELD
       10
           ef-coubat, 
           Entry-Field, 
           COL 116,81, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 8,00 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 78-ID-ef-coubat,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 6,
           VALUE ef-coubat-buf,
           VISIBLE v-FTTR,
           AFTER PROCEDURE ef-coubat-AfterProcedure, 
           .


      * ENTRY FIELD
       10
           ef-add, 
           Entry-Field, 
           COL 132,98, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 8,00 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 78-ID-ef-add,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           RIGHT,
           MAX-TEXT 6,
           VALUE ef-add-buf,
           VISIBLE v-FTTR,
           AFTER PROCEDURE ef-add-AfterProcedure, 
           .


      * ENTRY FIELD
       10
           ef-iva, 
           Entry-Field, 
           COL 147,81, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 7,00 ,
           BOXED,
           COLOR IS 513,
           FONT IS Small-Font,
           ID IS 78-ID-ef-iva,                
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           MAX-TEXT 3,
           VALUE ef-iva-buf,
           VISIBLE v-FTTR,
           AFTER PROCEDURE ef-iva-AfterProcedure, 
           .


      * BAR
       10
           Screen1-Br-1, 
           Bar,
           COL 3,81, 
           LINE 41,46,
           SIZE 151,00 ,
           ID IS 34,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           COLORS (8, 8),
           SHADING (-1, 1),
           WIDTH 2,
           .

      * BAR
       10
           Screen1-Br-1a, 
           Bar,
           COL 3,81, 
           LINE 42,00,
           SIZE 151,00 ,
           ID IS 35,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           COLORS (8, 8),
           SHADING (-1, 1),
           WIDTH 2,
           .

      * LABEL
       10
           Screen1-La-14, 
           Label, 
           COL 3,81, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 5,00 ,
           FONT IS Small-Font,
           ID IS 36,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Voce",
           VISIBLE v-FTMA,
           .

      * LABEL
       10
           Screen1-La-12a, 
           Label, 
           COL 77,64, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 6,00 ,
           FONT IS Small-Font,
           ID IS 37,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Importo",
           VISIBLE v-FTMA,
           .

      * LABEL
       10
           Screen1-La-13a, 
           Label, 
           COL 141,98, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 5,00 ,
           FONT IS Small-Font,
           ID IS 38,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "C. IVA",
           VISIBLE v-FTMA,
           .

      * LABEL
       10
           Screen1-La-3, 
           Label, 
           COL 3,81, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 6,00 ,
           FONT IS Small-Font,
           ID IS 39,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Articolo",
           VISIBLE v-FTTR,
           .

      * LABEL
       10
           lab-art, 
           Label, 
           COL 19,81, 
           LINE EF-LinesWithout,
           LINES 2,00 ,
           SIZE 44,00 ,
           COLOR IS 5,
           FONT IS Small-Font,
           ID IS 45,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE lab-art-buf,
           VISIBLE v-FTTR,
           .

      * LABEL
       10
           Screen1-La-15, 
           Label, 
           COL 65,31, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 4,00 ,
           FONT IS Small-Font,
           ID IS 46,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Q.tà",
           VISIBLE v-FTTR,
           .

      * LABEL
       10
           Screen1-La-16, 
           Label, 
           COL 77,64, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 6,00 ,
           FONT IS Small-Font,
           ID IS 47,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Prezzo",
           VISIBLE v-FTTR,
           .

      * LABEL
       10
           Screen1-La-17, 
           Label, 
           COL 141,98, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 5,00 ,
           FONT IS Small-Font,
           ID IS 48,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "C. IVA",
           VISIBLE v-FTTR,
           .

      * LABEL
       10
           Screen1-La-16a, 
           Label, 
           COL 94,48, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 4,50 ,
           FONT IS Small-Font,
           ID IS 28,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Cons.",
           VISIBLE v-FTTR,
           .

      * LABEL
       10
           Screen1-La-16aa, 
           Label, 
           COL 108,81, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 7,50 ,
           FONT IS Small-Font,
           ID IS 49,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Cou/Cob",
           VISIBLE v-FTTR,
           .

      * LABEL
       10
           Screen1-La-16aaa, 
           Label, 
           COL 108,81, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 7,50 ,
           FONT IS Small-Font,
           ID IS 50,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Cou/Cob",
           VISIBLE v-FTMA,
           .

      * LABEL
       10
           Screen1-La-16ab, 
           Label, 
           COL 94,48, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 4,50 ,
           FONT IS Small-Font,
           ID IS 51,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Cons.",
           VISIBLE v-FTMA,
           .

      * PUSH BUTTON
       10
           pb-iva, 
           Push-Button, 
           COL 3,14, 
           LINE 38,77,
           LINES 21,00 ,
           SIZE 73,00 ,
           BITMAP-HANDLE MODIF_IVA-BMP,
           BITMAP-NUMBER 2,
           UNFRAMED,
           SQUARE,
           EXCEPTION-VALUE 1000,
           FLAT,
           FONT IS Small-Font,
           ID IS 52,
           NO-TAB,
           SELF-ACT,
           TITLE "&Modifica i codici iva sostituendoli con il codice sta
      -    "ndard",
           VISIBLE 0,
           AFTER PROCEDURE pb-iva-AfterProcedure, 
           BEFORE PROCEDURE pb-iva-BeforeProcedure, 
           .

      * LABEL
       10
           Screen1-La-16aab, 
           Label, 
           COL 125,64, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 6,50 ,
           FONT IS Small-Font,
           ID IS 53,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Add. Pb",
           VISIBLE v-FTTR,
           .

      * LABEL
       10
           Screen1-La-16aaba, 
           Label, 
           COL 125,64, 
           LINE EF-LinesWithout,
           LINES 1,31 ,
           SIZE 6,50 ,
           FONT IS Small-Font,
           ID IS 54,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           TRANSPARENT,
           TITLE "Add. Pb",
           VISIBLE v-FTMA,
           .

      * LABEL
       05
           lab-anno, 
           Label, 
           COL 62,50, 
           LINE 1,23,
           LINES 1,54 ,
           SIZE 35,00 ,
           COLOR IS 2,
           FONT IS Verdana12B-Occidentale,
           ID IS 55,
           HEIGHT-IN-CELLS,
           WIDTH-IN-CELLS,
           CENTER,
           TRANSPARENT,
           TITLE lab-anno-buf,
           .

      * TOOLBAR
       01
           Form1-Tb-1,
           .    

      * PUSH BUTTON
       05
           TOOL-ESCI, 
           Push-Button, 
           COL 1,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           BITMAP-NUMBER 1,
           FRAMED,
           SQUARE,
           ENABLED E-ESCI,
           EXCEPTION-VALUE 27,
           FLAT,
           ID IS 110,
           SELF-ACT,
           ESCAPE-BUTTON,
           TITLE "Esci (Esc)",
           .

      * PUSH BUTTON
       05
           TOOL-NUOVO, 
           Push-Button, 
           COL 6,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           BITMAP-NUMBER 23,
           FRAMED,
           SQUARE,
           ENABLED E-NUOVO,
           FLAT,
           ID IS 111,
           SELF-ACT,
           TITLE "Nuovo (F2)",
           .

      * PUSH BUTTON
       05
           TOOL-CANCELLA, 
           Push-Button, 
           COL 16,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           FRAMED,
           SQUARE,
           ENABLED E-CANCELLA,
           FLAT,
           ID IS 112,
           SELF-ACT,
           TITLE "Cancella (F4)",
           BITMAP-NUMBER BitmapNumDelete
           .

      * PUSH BUTTON
       05
           TOOL-SALVA, 
           Push-Button, 
           COL 11,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           FRAMED,
           SQUARE,
           ENABLED E-SALVA,
           EXCEPTION-VALUE 3,
           FLAT,
           ID IS 113,
           SELF-ACT,
           TITLE "Salva (F3)",
           BITMAP-NUMBER BitmapNumSave
           .

      * PUSH BUTTON
       05
           TOOL-ANTEPRIMA, 
           Push-Button, 
           COL 26,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           BITMAP-NUMBER 17,
           FRAMED,
           SQUARE,
           ENABLED E-ANTEPRIMA,
           EXCEPTION-VALUE 6,
           FLAT,
           ID IS 114,
           SELF-ACT,
           TITLE "Anteprima (F6)",
           .

      * CHECK BOX
       05
           TOOL-MODIFICA, 
           Check-Box, 
           COL 21,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           BITMAP-NUMBER 5,
           FRAMED,
           SQUARE,
           ENABLED E-MODIFICA,
           EXCEPTION-VALUE 150
           FLAT,
           ID IS 115,
           SELF-ACT,
           TITLE "Modifica (F5)",
           VALUE 1,
           BITMAP-NUMBER BitmapNumEdit
           AFTER PROCEDURE TOOL-MODIFICA-AfterProcedure,
           BEFORE PROCEDURE TOOL-MODIFICA-BeforeProcedure, 
           .
      * PUSH BUTTON
       05
           TOOL-STAMPA, 
           Push-Button, 
           COL 31,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           BITMAP-NUMBER 18,
           FRAMED,
           SQUARE,
           ENABLED E-STAMPA,
           EXCEPTION-VALUE 7,
           FLAT,
           ID IS 78,
           SELF-ACT,
           TITLE "Stampa (F7)",
           .

      * PUSH BUTTON
       05
           TOOL-CERCA, 
           Push-Button, 
           COL 36,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           FRAMED,
           SQUARE,
           ENABLED E-CERCA,
           EXCEPTION-VALUE 8,
           FLAT,
           ID IS 79,
           SELF-ACT,
           TITLE "Cerca (F8)",
           BITMAP-NUMBER=BitmapNumZoom
           .

      * PUSH BUTTON
       05
           TOOL-SELEZIONA, 
           Push-Button, 
           COL 41,00, 
           LINE 1,08,
           LINES 23,00 ,
           SIZE 24,00 ,
           BITMAP-HANDLE TOOLBAR-BMP,
           FRAMED,
           SQUARE,
           ENABLED E-SELEZIONA,
           FLAT,
           ID IS 80,
           SELF-ACT,
           TITLE "Seleziona (F9)",
           BITMAP-NUMBER BitmapNumSelect
           .

      *{TOTEM}END

      *{TOTEM}LINKPARA
       PROCEDURE  DIVISION USING LK-BLOCKPGM, USER-CODI, LIVELLO-ABIL, 
           fatman-linkage.
      *{TOTEM}END

      *{TOTEM}DECLARATIVE
       DECLARATIVES.
      * <TOTEM:EPT. INIT:fatman, INIT:fatman, BeforeDeclarative>
      ***---
       TORDINI-ERR SECTION.
           use after error procedure on tordini.
           set tutto-ok  to true.
           evaluate status-tordini
           when "35"
                display message "File [TORDINI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TORDINI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TORDINI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       AGENTI-ERR SECTION.
           use after error procedure on agenti.
           set tutto-ok  to true.
           evaluate status-agenti
           when "35"
                display message "File [AGENTI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [AGENTI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[AGENTI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       TPARAMGE-ERR SECTION.
           use after error procedure on tparamge.
           set tutto-ok  to true.
           evaluate status-tparamge
           when "35"
                display message "File [TPARAMGE] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TPARAMGE] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TPARAMGE] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       RORDINI-ERR SECTION.
           use after error procedure on rordini.
           set tutto-ok  to true.
           evaluate status-rordini
           when "35"
                display message "File [RORDINI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [RORDINI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[RORDINI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       DESTINI-ERR SECTION.
           use after error procedure on destini.
           set tutto-ok  to true.
           evaluate status-destini
           when "35"
                display message "File [DESTINI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [DESTINI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[DESTINI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       TIVAESE-ERR SECTION.
           use after error procedure on tivaese.
           set tutto-ok  to true.
           evaluate status-tivaese
           when "35"
                display message "File [TIVAESE] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TIVAESE] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TIVAESE] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       TCODPAG-ERR SECTION.
           use after error procedure on tcodpag.
           set tutto-ok  to true.
           evaluate status-tcodpag
           when "35"
                display message "File [TCODPAG] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TCODPAG] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TCODPAG] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       CLIENTI-ERR SECTION.
           use after error procedure on clienti.
           set tutto-ok  to true.
           evaluate status-clienti
           when "35"
                display message "File [CLIENTI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [CLIENTI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[CLIENTI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       ARTICOLI-ERR SECTION.
           use after error procedure on articoli.
           set tutto-ok  to true.
           evaluate status-articoli
           when "35"
                display message "File [ARTICOLI] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [ARTICOLI] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[ARTICOLI] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       TCONTAT-ERR SECTION.
           use after error procedure on tcontat.
           set tutto-ok  to true.
           evaluate status-tcontat
           when "35"
                display message "File [TCONTAT] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TCONTAT] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TCONTAT] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       TCAUMAG-ERR SECTION.
           use after error procedure on tcaumag.
           set tutto-ok  to true.
           evaluate status-tcaumag
           when "35"
                display message "File [TCAUMAG] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TCAUMAG] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TCAUMAG] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       PROGMAG-ERR SECTION.
           use after error procedure on progmag.
           set tutto-ok  to true.
           evaluate status-progmag
           when "35"
                display message "File [PROGMAG] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [PROGMAG] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[PROGMAG] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       MAS-ERR SECTION.
           use after error procedure on MAS.
           set tutto-ok  to true.
           evaluate status-MAS
           when "35"
                display message "File [MAS] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [MAS] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[MAS] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate. 
 
      ***---
       TMARCHE-ERR SECTION.
           use after error procedure on tmarche.
           set tutto-ok  to true.
           evaluate status-tmarche
           when "35"
                display message "File [TMARCHE] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [TMARCHE] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[TMARCHE] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       BTNOTACR-ERR SECTION.
           use after error procedure on btnotacr.
           set tutto-ok  to true.
           evaluate status-btnotacr
           when "35"
                display message "File [BTNOTACR] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [BTNOTACR] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "99"
           when "93"
                set RecLocked to true
                set errori    to true
           when "98"
                display message "[BTNOTACR] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.
 
      ***---
       BRNOTACR-ERR SECTION.
           use after error procedure on brnotacr.
           set tutto-ok  to true.
           evaluate status-brnotacr
           when "35"
                display message "File [BRNOTACR] not found!"
                           title titolo
                            icon 3
                set errori to true
           when "39"
                display message "File [BRNOTACR] Mismatch size!"
                           title titolo
                            icon 3
                set errori to true
           when "98"
                display message "[BRNOTACR] Indexed file corrupt!"
                           title titolo
                            icon 3
                set errori to true
           end-evaluate.

      * <TOTEM:END>
       INPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON INPUT.
       0100-DECL.
           EXIT.
       I-O-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON I-O.
       0200-DECL.
           EXIT.
       OUTPUT-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON OUTPUT.
       0300-DECL.
           EXIT.
       TRANSACTION-ERROR SECTION.
           USE AFTER STANDARD ERROR PROCEDURE ON TRANSACTION.
       0400-DECL.
           EXIT.
       END DECLARATIVES.
      *{TOTEM}END

       MAIN-LOGIC.
      *{TOTEM}ENTRY-BEFPRG
      *    Before-Program
           PERFORM notacr-Ev-Before-Program
      *{TOTEM}END
           PERFORM INITIALIZE-ROUTINE.
      * run main screen
      *{TOTEM}RUN-MAINSCR
           PERFORM Form1-OPEN-ROUTINE.
      *{TOTEM}END

      *{TOTEM}COPY-PROCEDURE
       EXIT-STOP-ROUTINE.
           PERFORM CLOSE-FILE-RTN
      * <TOTEM:EPT. INIT:fatman, INIT:fatman, BeforeDestroyResource>
      * <TOTEM:END>
           DESTROY Courier-New18-Occidentale
           DESTROY Verdana12B-Occidentale
           CALL "w$bitmap" USING WBITMAP-DESTROY, 
           STRIP_GRID_GCLIENTI-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, MODIF_IVA-BMP
           CALL "w$bitmap" USING WBITMAP-DESTROY, TOOLBAR-BMP
      *    After-Program
           PERFORM notacr-Ev-After-Program
           EXIT PROGRAM TOTEM-PgmStatus
           STOP RUN.

       INITIALIZE-ROUTINE.
      *    Before Init
      * initialize program status variable
           Initialize TOTEM-PgmStatus.
      * get system information
           ACCEPT SYSTEM-INFORMATION FROM SYSTEM-INFO.
      * get terminal information
           ACCEPT TERMINAL-ABILITIES FROM TERMINAL-INFO.
      * set font
           PERFORM INIT-FONT.
      * load bitmap
           PERFORM INIT-BMP.
      * load resource
           PERFORM INIT-RES.
      * create pop-up menu
           PERFORM INIT-POPUP.
      * open files
           PERFORM OPEN-FILE-RTN.
      *    After Init
           .
    
       INIT-FONT.
      * Courier-New18-Occidentale
           INITIALIZE WFONT-DATA Courier-New18-Occidentale
           MOVE 18 TO WFONT-SIZE
           MOVE "Courier New" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO FALSE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Courier-New18-Occidentale, WFONT-DATA
      * Verdana12B-Occidentale
           INITIALIZE WFONT-DATA Verdana12B-Occidentale
           MOVE 12 TO WFONT-SIZE
           MOVE "Verdana" TO WFONT-NAME
           SET WFCHARSET-DONT-CARE TO TRUE
           SET WFONT-BOLD TO TRUE
           SET WFONT-ITALIC TO FALSE
           SET WFONT-UNDERLINE TO FALSE
           SET WFONT-STRIKEOUT TO FALSE
           SET WFONT-FIXED-PITCH TO FALSE
           MOVE 0 TO WFONT-CHAR-SET
           CALL "W$FONT" USING WFONT-GET-FONT, 
                     Verdana12B-Occidentale, WFONT-DATA
           .

       INIT-BMP.
      * pb-nuovo
           COPY RESOURCE "STRIP_GRID_GCLIENTI.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "STRIP_GRID_GCLIENTI.BMP"
           , 
                   GIVING STRIP_GRID_GCLIENTI-BMP.
      * pb-iva
           COPY RESOURCE "MODIF_IVA.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "MODIF_IVA.BMP", 
                   GIVING MODIF_IVA-BMP.
      * TOOL-ESCI
           COPY RESOURCE "TOOLBAR.BMP".
           CALL "w$bitmap" USING WBITMAP-LOAD "TOOLBAR.BMP", 
                   GIVING TOOLBAR-BMP.
           .

       INIT-RES.
           .

       INIT-POPUP.
           .

       OPEN-FILE-RTN.
      *    Before Open
           PERFORM OPEN-tordini
           PERFORM OPEN-agenti
           PERFORM OPEN-tparamge
           PERFORM OPEN-rordini
           PERFORM OPEN-destini
           PERFORM OPEN-tivaese
           PERFORM OPEN-tcodpag
           PERFORM OPEN-clienti
           PERFORM OPEN-articoli
           PERFORM OPEN-tcontat
           PERFORM OPEN-tcaumag
           PERFORM OPEN-progmag
           PERFORM OPEN-MAS
           PERFORM OPEN-tmarche
           PERFORM OPEN-recapiti
           PERFORM OPEN-brnotacr
           PERFORM OPEN-btnotacr
           PERFORM OPEN-tvettori
      *    After Open
           .

       OPEN-tordini.
      * <TOTEM:EPT. INIT:fatman, FD:tordini, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O tordini
           IF STATUS-tordini = "35"
              OPEN OUTPUT tordini
                IF Valid-STATUS-tordini
                   CLOSE tordini
                   OPEN I-O tordini
                END-IF
           END-IF
           IF NOT Valid-STATUS-tordini
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:fatman, FD:tordini, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-agenti.
      * <TOTEM:EPT. INIT:fatman, FD:agenti, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT agenti
           IF NOT Valid-STATUS-agenti
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:fatman, FD:agenti, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tparamge.
      * <TOTEM:EPT. INIT:fatman, FD:tparamge, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tparamge
           IF NOT Valid-STATUS-tparamge
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:fatman, FD:tparamge, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-rordini.
      * <TOTEM:EPT. INIT:fatman, FD:rordini, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O rordini
           IF STATUS-rordini = "35"
              OPEN OUTPUT rordini
                IF Valid-STATUS-rordini
                   CLOSE rordini
                   OPEN I-O rordini
                END-IF
           END-IF
           IF NOT Valid-STATUS-rordini
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:fatman, FD:rordini, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-destini.
      * <TOTEM:EPT. INIT:fatman, FD:destini, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT destini
           IF NOT Valid-STATUS-destini
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:fatman, FD:destini, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tivaese.
      * <TOTEM:EPT. INIT:fatman, FD:tivaese, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tivaese
           IF NOT Valid-STATUS-tivaese
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:fatman, FD:tivaese, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tcodpag.
      * <TOTEM:EPT. INIT:fatman, FD:tcodpag, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tcodpag
           IF NOT Valid-status-tcodpag
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:fatman, FD:tcodpag, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-clienti.
      * <TOTEM:EPT. INIT:fatman, FD:clienti, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT clienti
           IF NOT Valid-STATUS-clienti
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:fatman, FD:clienti, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-articoli.
      * <TOTEM:EPT. INIT:fatman, FD:articoli, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT articoli
           IF NOT Valid-STATUS-articoli
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:fatman, FD:articoli, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tcontat.
      * <TOTEM:EPT. INIT:fatman, FD:tcontat, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tcontat
           IF NOT Valid-STATUS-tcontat
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:fatman, FD:tcontat, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tcaumag.
      * <TOTEM:EPT. INIT:fatman, FD:tcaumag, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tcaumag
           IF NOT Valid-STATUS-tcaumag
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:fatman, FD:tcaumag, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-progmag.
      * <TOTEM:EPT. INIT:fatman, FD:progmag, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT progmag
           IF NOT Valid-STATUS-progmag
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:fatman, FD:progmag, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-MAS.
      * <TOTEM:EPT. INIT:fatman, FD:MAS, BeforeOpen>
      * <TOTEM:END>
           OPEN  I-O MAS
           IF STATUS-MAS = "35"
              OPEN OUTPUT MAS
                IF Valid-STATUS-mas
                   CLOSE MAS
                   OPEN I-O MAS
                END-IF
           END-IF
           IF NOT Valid-STATUS-mas
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:fatman, FD:MAS, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tmarche.
      * <TOTEM:EPT. INIT:fatman, FD:tmarche, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tmarche
           IF NOT Valid-STATUS-tmarche
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:fatman, FD:tmarche, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-recapiti.
      * <TOTEM:EPT. INIT:fatman, FD:recapiti, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT recapiti
           IF NOT Valid-STATUS-recapiti
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:fatman, FD:recapiti, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-brnotacr.
      * <TOTEM:EPT. INIT:fatman, FD:brnotacr, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT brnotacr
           IF NOT Valid-STATUS-brnotacr
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:fatman, FD:brnotacr, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-btnotacr.
      * <TOTEM:EPT. INIT:fatman, FD:btnotacr, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT btnotacr
           IF NOT Valid-STATUS-btnotacr
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:fatman, FD:btnotacr, AfterOpen>
      * <TOTEM:END>
           .

       OPEN-tvettori.
      * <TOTEM:EPT. INIT:fatman, FD:tvettori, BeforeOpen>
      * <TOTEM:END>
           OPEN  INPUT tvettori
           IF NOT Valid-STATUS-tvettori
              PERFORM  Form1-EXTENDED-FILE-STATUS
              GO TO EXIT-STOP-ROUTINE
           END-IF
      * <TOTEM:EPT. INIT:fatman, FD:tvettori, AfterOpen>
      * <TOTEM:END>
           .

       CLOSE-FILE-RTN.
      *    Before Close
           PERFORM CLOSE-tordini
           PERFORM CLOSE-agenti
           PERFORM CLOSE-tparamge
           PERFORM CLOSE-rordini
           PERFORM CLOSE-destini
           PERFORM CLOSE-tivaese
           PERFORM CLOSE-tcodpag
           PERFORM CLOSE-clienti
           PERFORM CLOSE-articoli
           PERFORM CLOSE-tcontat
           PERFORM CLOSE-tcaumag
           PERFORM CLOSE-progmag
           PERFORM CLOSE-MAS
           PERFORM CLOSE-tmarche
           PERFORM CLOSE-recapiti
           PERFORM CLOSE-brnotacr
           PERFORM CLOSE-btnotacr
           PERFORM CLOSE-tvettori
      *    After Close
           .

       CLOSE-tordini.
      * <TOTEM:EPT. INIT:fatman, FD:tordini, BeforeClose>
      * <TOTEM:END>
           CLOSE tordini
           .

       CLOSE-agenti.
      * <TOTEM:EPT. INIT:fatman, FD:agenti, BeforeClose>
      * <TOTEM:END>
           CLOSE agenti
           .

       CLOSE-tparamge.
      * <TOTEM:EPT. INIT:fatman, FD:tparamge, BeforeClose>
      * <TOTEM:END>
           CLOSE tparamge
           .

       CLOSE-rordini.
      * <TOTEM:EPT. INIT:fatman, FD:rordini, BeforeClose>
      * <TOTEM:END>
           CLOSE rordini
           .

       CLOSE-destini.
      * <TOTEM:EPT. INIT:fatman, FD:destini, BeforeClose>
      * <TOTEM:END>
           CLOSE destini
           .

       CLOSE-tivaese.
      * <TOTEM:EPT. INIT:fatman, FD:tivaese, BeforeClose>
      * <TOTEM:END>
           CLOSE tivaese
           .

       CLOSE-tcodpag.
      * <TOTEM:EPT. INIT:fatman, FD:tcodpag, BeforeClose>
      * <TOTEM:END>
           CLOSE tcodpag
           .

       CLOSE-clienti.
      * <TOTEM:EPT. INIT:fatman, FD:clienti, BeforeClose>
      * <TOTEM:END>
           CLOSE clienti
           .

       CLOSE-articoli.
      * <TOTEM:EPT. INIT:fatman, FD:articoli, BeforeClose>
      * <TOTEM:END>
           CLOSE articoli
           .

       CLOSE-tcontat.
      * <TOTEM:EPT. INIT:fatman, FD:tcontat, BeforeClose>
      * <TOTEM:END>
           CLOSE tcontat
           .

       CLOSE-tcaumag.
      * <TOTEM:EPT. INIT:fatman, FD:tcaumag, BeforeClose>
      * <TOTEM:END>
           CLOSE tcaumag
           .

       CLOSE-progmag.
      * <TOTEM:EPT. INIT:fatman, FD:progmag, BeforeClose>
      * <TOTEM:END>
           CLOSE progmag
           .

       CLOSE-MAS.
      * <TOTEM:EPT. INIT:fatman, FD:MAS, BeforeClose>
      * <TOTEM:END>
           CLOSE MAS
           .

       CLOSE-tmarche.
      * <TOTEM:EPT. INIT:fatman, FD:tmarche, BeforeClose>
      * <TOTEM:END>
           CLOSE tmarche
           .

       CLOSE-recapiti.
      * <TOTEM:EPT. INIT:fatman, FD:recapiti, BeforeClose>
      * <TOTEM:END>
           CLOSE recapiti
           .

       CLOSE-brnotacr.
      * <TOTEM:EPT. INIT:fatman, FD:brnotacr, BeforeClose>
      * <TOTEM:END>
           CLOSE brnotacr
           .

       CLOSE-btnotacr.
      * <TOTEM:EPT. INIT:fatman, FD:btnotacr, BeforeClose>
      * <TOTEM:END>
           CLOSE btnotacr
           .

       CLOSE-tvettori.
      * <TOTEM:EPT. INIT:fatman, FD:tvettori, BeforeClose>
      * <TOTEM:END>
           CLOSE tvettori
           .

       tordini-k-causale-MERGE-SPLITBUF.
           INITIALIZE tordini-k-causale-SPLITBUF
           MOVE tor-causale(1:4) TO tordini-k-causale-SPLITBUF(1:4)
           MOVE tor-anno(1:4) TO tordini-k-causale-SPLITBUF(5:4)
           MOVE tor-numero(1:8) TO tordini-k-causale-SPLITBUF(9:8)
           .

       tordini-k1-MERGE-SPLITBUF.
           INITIALIZE tordini-k1-SPLITBUF
           MOVE tor-cod-cli(1:5) TO tordini-k1-SPLITBUF(1:5)
           MOVE tor-prg-destino(1:5) TO tordini-k1-SPLITBUF(6:5)
           MOVE tor-anno(1:4) TO tordini-k1-SPLITBUF(11:4)
           MOVE tor-numero(1:8) TO tordini-k1-SPLITBUF(15:8)
           .

       tordini-k2-MERGE-SPLITBUF.
           INITIALIZE tordini-k2-SPLITBUF
           MOVE tor-data-passaggio-ordine(1:8) TO 
           tordini-k2-SPLITBUF(1:8)
           MOVE tor-anno(1:4) TO tordini-k2-SPLITBUF(9:4)
           MOVE tor-numero(1:8) TO tordini-k2-SPLITBUF(13:8)
           .

       tordini-k-bolla-MERGE-SPLITBUF.
           INITIALIZE tordini-k-bolla-SPLITBUF
           MOVE tor-anno-bolla(1:4) TO tordini-k-bolla-SPLITBUF(1:4)
           MOVE tor-num-bolla(1:8) TO tordini-k-bolla-SPLITBUF(5:8)
           .

       tordini-k3-MERGE-SPLITBUF.
           INITIALIZE tordini-k3-SPLITBUF
           MOVE tor-anno-bolla(1:4) TO tordini-k3-SPLITBUF(1:4)
           MOVE tor-data-bolla(1:8) TO tordini-k3-SPLITBUF(5:8)
           MOVE tor-num-bolla(1:8) TO tordini-k3-SPLITBUF(13:8)
           MOVE tor-bolla-prenotata(1:1) TO tordini-k3-SPLITBUF(21:1)
           .

       tordini-k-fattura-MERGE-SPLITBUF.
           INITIALIZE tordini-k-fattura-SPLITBUF
           MOVE tor-anno-fattura(1:4) TO tordini-k-fattura-SPLITBUF(1:4)
           MOVE tor-num-fattura(1:8) TO tordini-k-fattura-SPLITBUF(5:8)
           .

       tordini-k4-MERGE-SPLITBUF.
           INITIALIZE tordini-k4-SPLITBUF
           MOVE tor-anno-fattura(1:4) TO tordini-k4-SPLITBUF(1:4)
           MOVE tor-data-fattura(1:8) TO tordini-k4-SPLITBUF(5:8)
           MOVE tor-num-fattura(1:8) TO tordini-k4-SPLITBUF(13:8)
           MOVE tor-num-prenot(1:8) TO tordini-k4-SPLITBUF(21:8)
           MOVE tor-fatt-prenotata(1:1) TO tordini-k4-SPLITBUF(29:1)
           .

       tordini-k-contab-MERGE-SPLITBUF.
           INITIALIZE tordini-k-contab-SPLITBUF
           MOVE tor-agg-contab(1:1) TO tordini-k-contab-SPLITBUF(1:1)
           MOVE tor-anno-fattura(1:4) TO tordini-k-contab-SPLITBUF(2:4)
           MOVE tor-num-fattura(1:8) TO tordini-k-contab-SPLITBUF(6:8)
           .

       tordini-k-tipo-MERGE-SPLITBUF.
           INITIALIZE tordini-k-tipo-SPLITBUF
           MOVE tor-tipo(1:1) TO tordini-k-tipo-SPLITBUF(1:1)
           MOVE tor-chiave(1:12) TO tordini-k-tipo-SPLITBUF(2:12)
           .

       tordini-k-data-MERGE-SPLITBUF.
           INITIALIZE tordini-k-data-SPLITBUF
           MOVE tor-data-creazione(1:8) TO tordini-k-data-SPLITBUF(1:8)
           MOVE tor-numero(1:8) TO tordini-k-data-SPLITBUF(9:8)
           .

       tordini-k-agfatt-MERGE-SPLITBUF.
           INITIALIZE tordini-k-agfatt-SPLITBUF
           MOVE tor-anno-fattura(1:4) TO tordini-k-agfatt-SPLITBUF(1:4)
           MOVE tor-data-fattura(1:8) TO tordini-k-agfatt-SPLITBUF(5:8)
           MOVE tor-num-fattura(1:8) TO tordini-k-agfatt-SPLITBUF(13:8)
           MOVE tor-num-prenot(1:8) TO tordini-k-agfatt-SPLITBUF(21:8)
           MOVE tor-fatt-prenotata(1:1) TO 
           tordini-k-agfatt-SPLITBUF(29:1)
           MOVE tor-chiave(1:12) TO tordini-k-agfatt-SPLITBUF(30:12)
           .

       tordini-k-stbolle-MERGE-SPLITBUF.
           INITIALIZE tordini-k-stbolle-SPLITBUF
           MOVE tor-anno-bolla(1:4) TO tordini-k-stbolle-SPLITBUF(1:4)
           MOVE tor-data-bolla(1:8) TO tordini-k-stbolle-SPLITBUF(5:8)
           MOVE tor-num-bolla(1:8) TO tordini-k-stbolle-SPLITBUF(13:8)
           MOVE tor-bolla-prenotata(1:1) TO 
           tordini-k-stbolle-SPLITBUF(21:1)
           MOVE tor-chiave(1:12) TO tordini-k-stbolle-SPLITBUF(22:12)
           .

       tordini-k-andamento-data-MERGE-SPLITBUF.
           INITIALIZE tordini-k-andamento-data-SPLITBUF
           MOVE tor-agg-contab(1:1) TO 
           tordini-k-andamento-data-SPLITBUF(1:1)
           MOVE tor-data-fattura(1:8) TO 
           tordini-k-andamento-data-SPLITBUF(2:8)
           .

       tordini-k-andamento-cliente-MERGE-SPLITBUF.
           INITIALIZE tordini-k-andamento-cliente-SPLITBUF
           MOVE tor-cod-cli(1:5) TO 
           tordini-k-andamento-cliente-SPLITBUF(1:5)
           MOVE tor-agg-contab(1:1) TO 
           tordini-k-andamento-cliente-SPLITBUF(6:1)
           MOVE tor-data-fattura(1:8) TO 
           tordini-k-andamento-cliente-SPLITBUF(7:8)
           .

       tordini-k-andamento-clides-MERGE-SPLITBUF.
           INITIALIZE tordini-k-andamento-clides-SPLITBUF
           MOVE tor-cod-cli(1:5) TO 
           tordini-k-andamento-clides-SPLITBUF(1:5)
           MOVE tor-prg-destino(1:5) TO 
           tordini-k-andamento-clides-SPLITBUF(6:5)
           MOVE tor-agg-contab(1:1) TO 
           tordini-k-andamento-clides-SPLITBUF(11:1)
           MOVE tor-data-fattura(1:8) TO 
           tordini-k-andamento-clides-SPLITBUF(12:8)
           .

       tordini-k-promo-MERGE-SPLITBUF.
           INITIALIZE tordini-k-promo-SPLITBUF
           MOVE tor-stato(1:1) TO tordini-k-promo-SPLITBUF(1:1)
           MOVE tor-promo(1:1) TO tordini-k-promo-SPLITBUF(2:1)
           MOVE tor-data-ordine(1:8) TO tordini-k-promo-SPLITBUF(3:8)
           MOVE tor-numero(1:8) TO tordini-k-promo-SPLITBUF(11:8)
           MOVE tor-cod-cli(1:5) TO tordini-k-promo-SPLITBUF(19:5)
           MOVE tor-prg-destino(1:5) TO tordini-k-promo-SPLITBUF(24:5)
           .

       tordini-k-or-MERGE-SPLITBUF.
           INITIALIZE tordini-k-or-SPLITBUF
           MOVE tor-cod-cli(1:5) TO tordini-k-or-SPLITBUF(1:5)
           MOVE tor-prg-destino(1:5) TO tordini-k-or-SPLITBUF(6:5)
           MOVE tor-num-ord-cli(1:10) TO tordini-k-or-SPLITBUF(11:10)
           .

       tordini-k-tor-inviare-MERGE-SPLITBUF.
           INITIALIZE tordini-k-tor-inviare-SPLITBUF
           MOVE tor-da-inviare OF tordini(1:1) TO 
           tordini-k-tor-inviare-SPLITBUF(1:1)
           MOVE tor-chiave OF tordini(1:12) TO 
           tordini-k-tor-inviare-SPLITBUF(2:12)
           .

       tordini-k-tor-tipocli-MERGE-SPLITBUF.
           INITIALIZE tordini-k-tor-tipocli-SPLITBUF
           MOVE tor-tipocli OF tordini(1:2) TO 
           tordini-k-tor-tipocli-SPLITBUF(1:2)
           MOVE tor-cod-cli OF tordini(1:5) TO 
           tordini-k-tor-tipocli-SPLITBUF(3:5)
           MOVE tor-prg-destino OF tordini(1:5) TO 
           tordini-k-tor-tipocli-SPLITBUF(8:5)
           MOVE tor-chiave OF tordini(1:12) TO 
           tordini-k-tor-tipocli-SPLITBUF(13:12)
           .

       tordini-k-tor-gdo-MERGE-SPLITBUF.
           INITIALIZE tordini-k-tor-gdo-SPLITBUF
           MOVE tor-gdo OF tordini(1:5) TO 
           tordini-k-tor-gdo-SPLITBUF(1:5)
           MOVE tor-cod-cli OF tordini(1:5) TO 
           tordini-k-tor-gdo-SPLITBUF(6:5)
           MOVE tor-prg-destino OF tordini(1:5) TO 
           tordini-k-tor-gdo-SPLITBUF(11:5)
           MOVE tor-chiave OF tordini(1:12) TO 
           tordini-k-tor-gdo-SPLITBUF(16:12)
           .

       DataSet1-tordini-INITSTART.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tordini-KEY1-Asc
                 MOVE Low-Value TO tor-chiave
              ELSE
                 MOVE High-Value TO tor-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tordini-INITEND.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tordini-KEY1-Asc
                 MOVE High-Value TO tor-chiave
              ELSE
                 MOVE Low-Value TO tor-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-CHANGETO-KEY1.
           MOVE 1 TO DataSet1-KEYIS
           .   

       DataSet1-Change-CurrentKey-Asc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "A" TO DataSet1-tordini-KEY1-ORDER
           END-EVALUATE
           .

       DataSet1-Change-CurrentKey-Desc.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              MOVE "D" TO DataSet1-tordini-KEY1-ORDER
           END-EVALUATE
           .

      * tordini
       DataSet1-tordini-START.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tordini-KEY1-Asc
                 START tordini KEY >= tor-chiave
              ELSE
                 START tordini KEY <= tor-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tordini-START-NOTGREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tordini-KEY1-Asc
                 START tordini KEY <= tor-chiave
              ELSE
                 START tordini KEY >= tor-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tordini-START-GREATER.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tordini-KEY1-Asc
                 START tordini KEY > tor-chiave
              ELSE
                 START tordini KEY < tor-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tordini-START-LESS.
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tordini-KEY1-Asc
                 START tordini KEY < tor-chiave
              ELSE
                 START tordini KEY > tor-chiave
              END-IF
           END-EVALUATE
           .

       DataSet1-tordini-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeReadRecord>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tordini-LOCK
                 READ tordini WITH LOCK 
                 KEY tor-chiave
              ELSE
                 READ tordini WITH NO LOCK 
                 KEY tor-chiave
              END-IF
           END-EVALUATE
           PERFORM tordini-k-causale-MERGE-SPLITBUF
           PERFORM tordini-k1-MERGE-SPLITBUF
           PERFORM tordini-k2-MERGE-SPLITBUF
           PERFORM tordini-k-bolla-MERGE-SPLITBUF
           PERFORM tordini-k3-MERGE-SPLITBUF
           PERFORM tordini-k-fattura-MERGE-SPLITBUF
           PERFORM tordini-k4-MERGE-SPLITBUF
           PERFORM tordini-k-contab-MERGE-SPLITBUF
           PERFORM tordini-k-tipo-MERGE-SPLITBUF
           PERFORM tordini-k-data-MERGE-SPLITBUF
           PERFORM tordini-k-agfatt-MERGE-SPLITBUF
           PERFORM tordini-k-stbolle-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-data-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-cliente-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-clides-MERGE-SPLITBUF
           PERFORM tordini-k-promo-MERGE-SPLITBUF
           PERFORM tordini-k-or-MERGE-SPLITBUF
           PERFORM tordini-k-tor-inviare-MERGE-SPLITBUF
           PERFORM tordini-k-tor-tipocli-MERGE-SPLITBUF
           PERFORM tordini-k-tor-gdo-MERGE-SPLITBUF
           MOVE STATUS-tordini TO TOTEM-ERR-STAT 
           MOVE "tordini" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tordini-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeReadNext>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tordini-KEY1-Asc
                 IF DataSet1-tordini-LOCK
                    READ tordini NEXT WITH LOCK
                 ELSE
                    READ tordini NEXT WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-tordini-LOCK
                    READ tordini PREVIOUS WITH LOCK
                 ELSE
                    READ tordini PREVIOUS WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           PERFORM tordini-k-causale-MERGE-SPLITBUF
           PERFORM tordini-k1-MERGE-SPLITBUF
           PERFORM tordini-k2-MERGE-SPLITBUF
           PERFORM tordini-k-bolla-MERGE-SPLITBUF
           PERFORM tordini-k3-MERGE-SPLITBUF
           PERFORM tordini-k-fattura-MERGE-SPLITBUF
           PERFORM tordini-k4-MERGE-SPLITBUF
           PERFORM tordini-k-contab-MERGE-SPLITBUF
           PERFORM tordini-k-tipo-MERGE-SPLITBUF
           PERFORM tordini-k-data-MERGE-SPLITBUF
           PERFORM tordini-k-agfatt-MERGE-SPLITBUF
           PERFORM tordini-k-stbolle-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-data-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-cliente-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-clides-MERGE-SPLITBUF
           PERFORM tordini-k-promo-MERGE-SPLITBUF
           PERFORM tordini-k-or-MERGE-SPLITBUF
           PERFORM tordini-k-tor-inviare-MERGE-SPLITBUF
           PERFORM tordini-k-tor-tipocli-MERGE-SPLITBUF
           PERFORM tordini-k-tor-gdo-MERGE-SPLITBUF
           MOVE STATUS-tordini TO TOTEM-ERR-STAT
           MOVE "tordini" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tordini-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeReadPrev>
      * <TOTEM:END>
           EVALUATE DataSet1-KEYIS
           WHEN 1
              IF DataSet1-tordini-KEY1-Asc
                 IF DataSet1-tordini-LOCK
                    READ tordini PREVIOUS WITH LOCK
                 ELSE
                    READ tordini PREVIOUS WITH NO LOCK
                 END-IF
              ELSE
                 IF DataSet1-tordini-LOCK
                    READ tordini NEXT WITH LOCK
                 ELSE
                    READ tordini NEXT WITH NO LOCK
                 END-IF
              END-IF
           END-EVALUATE
           PERFORM tordini-k-causale-MERGE-SPLITBUF
           PERFORM tordini-k1-MERGE-SPLITBUF
           PERFORM tordini-k2-MERGE-SPLITBUF
           PERFORM tordini-k-bolla-MERGE-SPLITBUF
           PERFORM tordini-k3-MERGE-SPLITBUF
           PERFORM tordini-k-fattura-MERGE-SPLITBUF
           PERFORM tordini-k4-MERGE-SPLITBUF
           PERFORM tordini-k-contab-MERGE-SPLITBUF
           PERFORM tordini-k-tipo-MERGE-SPLITBUF
           PERFORM tordini-k-data-MERGE-SPLITBUF
           PERFORM tordini-k-agfatt-MERGE-SPLITBUF
           PERFORM tordini-k-stbolle-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-data-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-cliente-MERGE-SPLITBUF
           PERFORM tordini-k-andamento-clides-MERGE-SPLITBUF
           PERFORM tordini-k-promo-MERGE-SPLITBUF
           PERFORM tordini-k-or-MERGE-SPLITBUF
           PERFORM tordini-k-tor-inviare-MERGE-SPLITBUF
           PERFORM tordini-k-tor-tipocli-MERGE-SPLITBUF
           PERFORM tordini-k-tor-gdo-MERGE-SPLITBUF
           MOVE STATUS-tordini TO TOTEM-ERR-STAT
           MOVE "tordini" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tordini-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeWrite>
      * <TOTEM:END>
           WRITE tor-rec OF tordini.
           MOVE STATUS-tordini TO TOTEM-ERR-STAT
           MOVE "tordini" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tordini-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeRewrite>
      * <TOTEM:END>
           REWRITE tor-rec OF tordini.
           MOVE STATUS-tordini TO TOTEM-ERR-STAT
           MOVE "tordini" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tordini-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, BeforeDelete>
      * <TOTEM:END>
           DELETE tordini.
           MOVE STATUS-tordini TO TOTEM-ERR-STAT
           MOVE "tordini" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tordini, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-agenti-INITSTART.
           IF DataSet1-agenti-KEY-Asc
              MOVE Low-Value TO age-chiave
           ELSE
              MOVE High-Value TO age-chiave
           END-IF
           .

       DataSet1-agenti-INITEND.
           IF DataSet1-agenti-KEY-Asc
              MOVE High-Value TO age-chiave
           ELSE
              MOVE Low-Value TO age-chiave
           END-IF
           .

      * agenti
       DataSet1-agenti-START.
           IF DataSet1-agenti-KEY-Asc
              START agenti KEY >= age-chiave
           ELSE
              START agenti KEY <= age-chiave
           END-IF
           .

       DataSet1-agenti-START-NOTGREATER.
           IF DataSet1-agenti-KEY-Asc
              START agenti KEY <= age-chiave
           ELSE
              START agenti KEY >= age-chiave
           END-IF
           .

       DataSet1-agenti-START-GREATER.
           IF DataSet1-agenti-KEY-Asc
              START agenti KEY > age-chiave
           ELSE
              START agenti KEY < age-chiave
           END-IF
           .

       DataSet1-agenti-START-LESS.
           IF DataSet1-agenti-KEY-Asc
              START agenti KEY < age-chiave
           ELSE
              START agenti KEY > age-chiave
           END-IF
           .

       DataSet1-agenti-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-agenti-LOCK
              READ agenti WITH LOCK 
              KEY age-chiave
           ELSE
              READ agenti WITH NO LOCK 
              KEY age-chiave
           END-IF
           MOVE STATUS-agenti TO TOTEM-ERR-STAT 
           MOVE "agenti" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-agenti-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-agenti-KEY-Asc
              IF DataSet1-agenti-LOCK
                 READ agenti NEXT WITH LOCK
              ELSE
                 READ agenti NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-agenti-LOCK
                 READ agenti PREVIOUS WITH LOCK
              ELSE
                 READ agenti PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-agenti TO TOTEM-ERR-STAT
           MOVE "agenti" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-agenti-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-agenti-KEY-Asc
              IF DataSet1-agenti-LOCK
                 READ agenti PREVIOUS WITH LOCK
              ELSE
                 READ agenti PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-agenti-LOCK
                 READ agenti NEXT WITH LOCK
              ELSE
                 READ agenti NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-agenti TO TOTEM-ERR-STAT
           MOVE "agenti" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-agenti-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-agenti TO TOTEM-ERR-STAT
           MOVE "agenti" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-agenti-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-agenti TO TOTEM-ERR-STAT
           MOVE "agenti" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-agenti-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-agenti TO TOTEM-ERR-STAT
           MOVE "agenti" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:agenti, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tparamge-INITSTART.
           IF DataSet1-tparamge-KEY-Asc
              MOVE Low-Value TO tge-chiave
           ELSE
              MOVE High-Value TO tge-chiave
           END-IF
           .

       DataSet1-tparamge-INITEND.
           IF DataSet1-tparamge-KEY-Asc
              MOVE High-Value TO tge-chiave
           ELSE
              MOVE Low-Value TO tge-chiave
           END-IF
           .

      * tparamge
       DataSet1-tparamge-START.
           IF DataSet1-tparamge-KEY-Asc
              START tparamge KEY >= tge-chiave
           ELSE
              START tparamge KEY <= tge-chiave
           END-IF
           .

       DataSet1-tparamge-START-NOTGREATER.
           IF DataSet1-tparamge-KEY-Asc
              START tparamge KEY <= tge-chiave
           ELSE
              START tparamge KEY >= tge-chiave
           END-IF
           .

       DataSet1-tparamge-START-GREATER.
           IF DataSet1-tparamge-KEY-Asc
              START tparamge KEY > tge-chiave
           ELSE
              START tparamge KEY < tge-chiave
           END-IF
           .

       DataSet1-tparamge-START-LESS.
           IF DataSet1-tparamge-KEY-Asc
              START tparamge KEY < tge-chiave
           ELSE
              START tparamge KEY > tge-chiave
           END-IF
           .

       DataSet1-tparamge-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tparamge-LOCK
              READ tparamge WITH LOCK 
              KEY tge-chiave
           ELSE
              READ tparamge WITH NO LOCK 
              KEY tge-chiave
           END-IF
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT 
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tparamge-KEY-Asc
              IF DataSet1-tparamge-LOCK
                 READ tparamge NEXT WITH LOCK
              ELSE
                 READ tparamge NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tparamge-LOCK
                 READ tparamge PREVIOUS WITH LOCK
              ELSE
                 READ tparamge PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tparamge-KEY-Asc
              IF DataSet1-tparamge-LOCK
                 READ tparamge PREVIOUS WITH LOCK
              ELSE
                 READ tparamge PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tparamge-LOCK
                 READ tparamge NEXT WITH LOCK
              ELSE
                 READ tparamge NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tparamge-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tparamge TO TOTEM-ERR-STAT
           MOVE "tparamge" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tparamge, AfterDelete>
      * <TOTEM:END>
           .

       rordini-ror-k-promo-MERGE-SPLITBUF.
           INITIALIZE rordini-ror-k-promo-SPLITBUF
           MOVE ror-promo OF rordini(1:15) TO 
           rordini-ror-k-promo-SPLITBUF(1:15)
           .

       rordini-ror-k-articolo-MERGE-SPLITBUF.
           INITIALIZE rordini-ror-k-articolo-SPLITBUF
           MOVE ror-cod-articolo OF rordini(1:6) TO 
           rordini-ror-k-articolo-SPLITBUF(1:6)
           MOVE ror-chiave OF rordini(1:17) TO 
           rordini-ror-k-articolo-SPLITBUF(7:17)
           .

       rordini-ror-k-master-MERGE-SPLITBUF.
           INITIALIZE rordini-ror-k-master-SPLITBUF
           MOVE ror-chiave-ordine OF rordini(1:17) TO 
           rordini-ror-k-master-SPLITBUF(1:17)
           MOVE ror-chiave OF rordini(1:17) TO 
           rordini-ror-k-master-SPLITBUF(18:17)
           .

       rordini-ror-k-stbolle-MERGE-SPLITBUF.
           INITIALIZE rordini-ror-k-stbolle-SPLITBUF
           MOVE ror-anno OF rordini(1:4) TO 
           rordini-ror-k-stbolle-SPLITBUF(1:4)
           MOVE ror-num-ordine OF rordini(1:8) TO 
           rordini-ror-k-stbolle-SPLITBUF(5:8)
           MOVE ror-chiave-ordine OF rordini(1:17) TO 
           rordini-ror-k-stbolle-SPLITBUF(13:17)
           .

       DataSet1-rordini-INITSTART.
           IF DataSet1-rordini-KEY-Asc
              MOVE Low-Value TO ror-chiave of rordini
           ELSE
              MOVE High-Value TO ror-chiave of rordini
           END-IF
           .

       DataSet1-rordini-INITEND.
           IF DataSet1-rordini-KEY-Asc
              MOVE High-Value TO ror-chiave of rordini
           ELSE
              MOVE Low-Value TO ror-chiave of rordini
           END-IF
           .

      * rordini
       DataSet1-rordini-START.
           IF DataSet1-rordini-KEY-Asc
              START rordini KEY >= ror-chiave of rordini
           ELSE
              START rordini KEY <= ror-chiave of rordini
           END-IF
           .

       DataSet1-rordini-START-NOTGREATER.
           IF DataSet1-rordini-KEY-Asc
              START rordini KEY <= ror-chiave of rordini
           ELSE
              START rordini KEY >= ror-chiave of rordini
           END-IF
           .

       DataSet1-rordini-START-GREATER.
           IF DataSet1-rordini-KEY-Asc
              START rordini KEY > ror-chiave of rordini
           ELSE
              START rordini KEY < ror-chiave of rordini
           END-IF
           .

       DataSet1-rordini-START-LESS.
           IF DataSet1-rordini-KEY-Asc
              START rordini KEY < ror-chiave of rordini
           ELSE
              START rordini KEY > ror-chiave of rordini
           END-IF
           .

       DataSet1-rordini-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-rordini-LOCK
              READ rordini WITH LOCK 
              KEY ror-chiave of rordini
           ELSE
              READ rordini WITH NO LOCK 
              KEY ror-chiave of rordini
           END-IF
           PERFORM rordini-ror-k-promo-MERGE-SPLITBUF
           PERFORM rordini-ror-k-articolo-MERGE-SPLITBUF
           PERFORM rordini-ror-k-master-MERGE-SPLITBUF
           PERFORM rordini-ror-k-stbolle-MERGE-SPLITBUF
           MOVE STATUS-rordini TO TOTEM-ERR-STAT 
           MOVE "rordini" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-rordini-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-rordini-KEY-Asc
              IF DataSet1-rordini-LOCK
                 READ rordini NEXT WITH LOCK
              ELSE
                 READ rordini NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-rordini-LOCK
                 READ rordini PREVIOUS WITH LOCK
              ELSE
                 READ rordini PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM rordini-ror-k-promo-MERGE-SPLITBUF
           PERFORM rordini-ror-k-articolo-MERGE-SPLITBUF
           PERFORM rordini-ror-k-master-MERGE-SPLITBUF
           PERFORM rordini-ror-k-stbolle-MERGE-SPLITBUF
           MOVE STATUS-rordini TO TOTEM-ERR-STAT
           MOVE "rordini" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-rordini-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-rordini-KEY-Asc
              IF DataSet1-rordini-LOCK
                 READ rordini PREVIOUS WITH LOCK
              ELSE
                 READ rordini PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-rordini-LOCK
                 READ rordini NEXT WITH LOCK
              ELSE
                 READ rordini NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM rordini-ror-k-promo-MERGE-SPLITBUF
           PERFORM rordini-ror-k-articolo-MERGE-SPLITBUF
           PERFORM rordini-ror-k-master-MERGE-SPLITBUF
           PERFORM rordini-ror-k-stbolle-MERGE-SPLITBUF
           MOVE STATUS-rordini TO TOTEM-ERR-STAT
           MOVE "rordini" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-rordini-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, BeforeWrite>
      * <TOTEM:END>
           WRITE ror-rec OF rordini.
           MOVE STATUS-rordini TO TOTEM-ERR-STAT
           MOVE "rordini" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-rordini-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, BeforeRewrite>
      * <TOTEM:END>
           REWRITE ror-rec OF rordini.
           MOVE STATUS-rordini TO TOTEM-ERR-STAT
           MOVE "rordini" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-rordini-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, BeforeDelete>
      * <TOTEM:END>
           DELETE rordini.
           MOVE STATUS-rordini TO TOTEM-ERR-STAT
           MOVE "rordini" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:rordini, AfterDelete>
      * <TOTEM:END>
           .

       destini-K1-MERGE-SPLITBUF.
           INITIALIZE destini-K1-SPLITBUF
           MOVE des-ragsoc-1(1:40) TO destini-K1-SPLITBUF(1:40)
           MOVE des-codice(1:5) TO destini-K1-SPLITBUF(41:5)
           MOVE des-prog(1:5) TO destini-K1-SPLITBUF(46:5)
           .

       destini-k-localita-MERGE-SPLITBUF.
           INITIALIZE destini-k-localita-SPLITBUF
           MOVE des-localita(1:35) TO destini-k-localita-SPLITBUF(1:35)
           .

       DataSet1-destini-INITSTART.
           IF DataSet1-destini-KEY-Asc
              MOVE Low-Value TO des-chiave
           ELSE
              MOVE High-Value TO des-chiave
           END-IF
           .

       DataSet1-destini-INITEND.
           IF DataSet1-destini-KEY-Asc
              MOVE High-Value TO des-chiave
           ELSE
              MOVE Low-Value TO des-chiave
           END-IF
           .

      * destini
       DataSet1-destini-START.
           IF DataSet1-destini-KEY-Asc
              START destini KEY >= des-chiave
           ELSE
              START destini KEY <= des-chiave
           END-IF
           .

       DataSet1-destini-START-NOTGREATER.
           IF DataSet1-destini-KEY-Asc
              START destini KEY <= des-chiave
           ELSE
              START destini KEY >= des-chiave
           END-IF
           .

       DataSet1-destini-START-GREATER.
           IF DataSet1-destini-KEY-Asc
              START destini KEY > des-chiave
           ELSE
              START destini KEY < des-chiave
           END-IF
           .

       DataSet1-destini-START-LESS.
           IF DataSet1-destini-KEY-Asc
              START destini KEY < des-chiave
           ELSE
              START destini KEY > des-chiave
           END-IF
           .

       DataSet1-destini-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-destini-LOCK
              READ destini WITH LOCK 
              KEY des-chiave
           ELSE
              READ destini WITH NO LOCK 
              KEY des-chiave
           END-IF
           PERFORM destini-K1-MERGE-SPLITBUF
           PERFORM destini-k-localita-MERGE-SPLITBUF
           MOVE STATUS-destini TO TOTEM-ERR-STAT 
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-destini-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-destini-KEY-Asc
              IF DataSet1-destini-LOCK
                 READ destini NEXT WITH LOCK
              ELSE
                 READ destini NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-destini-LOCK
                 READ destini PREVIOUS WITH LOCK
              ELSE
                 READ destini PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM destini-K1-MERGE-SPLITBUF
           PERFORM destini-k-localita-MERGE-SPLITBUF
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-destini-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-destini-KEY-Asc
              IF DataSet1-destini-LOCK
                 READ destini PREVIOUS WITH LOCK
              ELSE
                 READ destini PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-destini-LOCK
                 READ destini NEXT WITH LOCK
              ELSE
                 READ destini NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM destini-K1-MERGE-SPLITBUF
           PERFORM destini-k-localita-MERGE-SPLITBUF
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-destini-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-destini-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-destini-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:destini, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-destini TO TOTEM-ERR-STAT
           MOVE "destini" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:destini, AfterDelete>
      * <TOTEM:END>
           .

       tivaese-key01-MERGE-SPLITBUF.
           INITIALIZE tivaese-key01-SPLITBUF
           MOVE TBLIV-CODICE1(1:2) TO tivaese-key01-SPLITBUF(1:2)
           MOVE TBLIV-DESCRIZIONE1(1:30) TO tivaese-key01-SPLITBUF(3:30)
           MOVE TBLIV-CODICE2(1:20) TO tivaese-key01-SPLITBUF(33:20)
           .

       DataSet1-tivaese-INITSTART.
           IF DataSet1-tivaese-KEY-Asc
              MOVE Low-Value TO TBLIV-CODICE
           ELSE
              MOVE High-Value TO TBLIV-CODICE
           END-IF
           .

       DataSet1-tivaese-INITEND.
           IF DataSet1-tivaese-KEY-Asc
              MOVE High-Value TO TBLIV-CODICE
           ELSE
              MOVE Low-Value TO TBLIV-CODICE
           END-IF
           .

      * tivaese
       DataSet1-tivaese-START.
           IF DataSet1-tivaese-KEY-Asc
              START tivaese KEY >= TBLIV-CODICE
           ELSE
              START tivaese KEY <= TBLIV-CODICE
           END-IF
           .

       DataSet1-tivaese-START-NOTGREATER.
           IF DataSet1-tivaese-KEY-Asc
              START tivaese KEY <= TBLIV-CODICE
           ELSE
              START tivaese KEY >= TBLIV-CODICE
           END-IF
           .

       DataSet1-tivaese-START-GREATER.
           IF DataSet1-tivaese-KEY-Asc
              START tivaese KEY > TBLIV-CODICE
           ELSE
              START tivaese KEY < TBLIV-CODICE
           END-IF
           .

       DataSet1-tivaese-START-LESS.
           IF DataSet1-tivaese-KEY-Asc
              START tivaese KEY < TBLIV-CODICE
           ELSE
              START tivaese KEY > TBLIV-CODICE
           END-IF
           .

       DataSet1-tivaese-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tivaese-LOCK
              READ tivaese WITH LOCK 
              KEY TBLIV-CODICE
           ELSE
              READ tivaese WITH NO LOCK 
              KEY TBLIV-CODICE
           END-IF
           PERFORM tivaese-key01-MERGE-SPLITBUF
           MOVE STATUS-tivaese TO TOTEM-ERR-STAT 
           MOVE "tivaese" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tivaese-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tivaese-KEY-Asc
              IF DataSet1-tivaese-LOCK
                 READ tivaese NEXT WITH LOCK
              ELSE
                 READ tivaese NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tivaese-LOCK
                 READ tivaese PREVIOUS WITH LOCK
              ELSE
                 READ tivaese PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tivaese-key01-MERGE-SPLITBUF
           MOVE STATUS-tivaese TO TOTEM-ERR-STAT
           MOVE "tivaese" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tivaese-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tivaese-KEY-Asc
              IF DataSet1-tivaese-LOCK
                 READ tivaese PREVIOUS WITH LOCK
              ELSE
                 READ tivaese PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tivaese-LOCK
                 READ tivaese NEXT WITH LOCK
              ELSE
                 READ tivaese NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tivaese-key01-MERGE-SPLITBUF
           MOVE STATUS-tivaese TO TOTEM-ERR-STAT
           MOVE "tivaese" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tivaese-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tivaese TO TOTEM-ERR-STAT
           MOVE "tivaese" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tivaese-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tivaese TO TOTEM-ERR-STAT
           MOVE "tivaese" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tivaese-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tivaese TO TOTEM-ERR-STAT
           MOVE "tivaese" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tivaese, AfterDelete>
      * <TOTEM:END>
           .

       tcodpag-TBL-CODICE-01-MERGE-SPLITBUF.
           INITIALIZE tcodpag-TBL-CODICE-01-SPLITBUF
           MOVE TBLPA-CODICE1(1:2) TO 
           tcodpag-TBL-CODICE-01-SPLITBUF(1:2)
           MOVE TBLPA-DESCRIZIONE1(1:30) TO 
           tcodpag-TBL-CODICE-01-SPLITBUF(3:30)
           MOVE TBLPA-CODICE2(1:20) TO 
           tcodpag-TBL-CODICE-01-SPLITBUF(33:20)
           .

       DataSet1-tcodpag-INITSTART.
           IF DataSet1-tcodpag-KEY-Asc
              MOVE Low-Value TO TBLPA-CODICE
           ELSE
              MOVE High-Value TO TBLPA-CODICE
           END-IF
           .

       DataSet1-tcodpag-INITEND.
           IF DataSet1-tcodpag-KEY-Asc
              MOVE High-Value TO TBLPA-CODICE
           ELSE
              MOVE Low-Value TO TBLPA-CODICE
           END-IF
           .

      * tcodpag
       DataSet1-tcodpag-START.
           IF DataSet1-tcodpag-KEY-Asc
              START tcodpag KEY >= TBLPA-CODICE
           ELSE
              START tcodpag KEY <= TBLPA-CODICE
           END-IF
           .

       DataSet1-tcodpag-START-NOTGREATER.
           IF DataSet1-tcodpag-KEY-Asc
              START tcodpag KEY <= TBLPA-CODICE
           ELSE
              START tcodpag KEY >= TBLPA-CODICE
           END-IF
           .

       DataSet1-tcodpag-START-GREATER.
           IF DataSet1-tcodpag-KEY-Asc
              START tcodpag KEY > TBLPA-CODICE
           ELSE
              START tcodpag KEY < TBLPA-CODICE
           END-IF
           .

       DataSet1-tcodpag-START-LESS.
           IF DataSet1-tcodpag-KEY-Asc
              START tcodpag KEY < TBLPA-CODICE
           ELSE
              START tcodpag KEY > TBLPA-CODICE
           END-IF
           .

       DataSet1-tcodpag-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tcodpag-LOCK
              READ tcodpag WITH LOCK 
              KEY TBLPA-CODICE
           ELSE
              READ tcodpag WITH NO LOCK 
              KEY TBLPA-CODICE
           END-IF
           PERFORM tcodpag-TBL-CODICE-01-MERGE-SPLITBUF
           MOVE status-tcodpag TO TOTEM-ERR-STAT 
           MOVE "tcodpag" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tcodpag-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tcodpag-KEY-Asc
              IF DataSet1-tcodpag-LOCK
                 READ tcodpag NEXT WITH LOCK
              ELSE
                 READ tcodpag NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tcodpag-LOCK
                 READ tcodpag PREVIOUS WITH LOCK
              ELSE
                 READ tcodpag PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tcodpag-TBL-CODICE-01-MERGE-SPLITBUF
           MOVE status-tcodpag TO TOTEM-ERR-STAT
           MOVE "tcodpag" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tcodpag-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tcodpag-KEY-Asc
              IF DataSet1-tcodpag-LOCK
                 READ tcodpag PREVIOUS WITH LOCK
              ELSE
                 READ tcodpag PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tcodpag-LOCK
                 READ tcodpag NEXT WITH LOCK
              ELSE
                 READ tcodpag NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tcodpag-TBL-CODICE-01-MERGE-SPLITBUF
           MOVE status-tcodpag TO TOTEM-ERR-STAT
           MOVE "tcodpag" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tcodpag-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeWrite>
      * <TOTEM:END>
           MOVE status-tcodpag TO TOTEM-ERR-STAT
           MOVE "tcodpag" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tcodpag-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeRewrite>
      * <TOTEM:END>
           MOVE status-tcodpag TO TOTEM-ERR-STAT
           MOVE "tcodpag" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tcodpag-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, BeforeDelete>
      * <TOTEM:END>
           MOVE status-tcodpag TO TOTEM-ERR-STAT
           MOVE "tcodpag" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcodpag, AfterDelete>
      * <TOTEM:END>
           .

       clienti-cli-K1-MERGE-SPLITBUF.
           INITIALIZE clienti-cli-K1-SPLITBUF
           MOVE cli-tipo-CF OF clienti(1:1) TO 
           clienti-cli-K1-SPLITBUF(1:1)
           MOVE cli-ragsoc-1 OF clienti(1:40) TO 
           clienti-cli-K1-SPLITBUF(2:40)
           MOVE cli-codice OF clienti(1:5) TO 
           clienti-cli-K1-SPLITBUF(42:5)
           .

       clienti-cli-K3-MERGE-SPLITBUF.
           INITIALIZE clienti-cli-K3-SPLITBUF
           MOVE cli-gdo OF clienti(1:5) TO clienti-cli-K3-SPLITBUF(1:5)
           MOVE cli-chiave OF clienti(1:6) TO 
           clienti-cli-K3-SPLITBUF(6:6)
           .

       clienti-cli-K4-MERGE-SPLITBUF.
           INITIALIZE clienti-cli-K4-SPLITBUF
           MOVE cli-utf OF clienti(1:1) TO clienti-cli-K4-SPLITBUF(1:1)
           MOVE cli-chiave OF clienti(1:6) TO 
           clienti-cli-K4-SPLITBUF(2:6)
           .

       DataSet1-clienti-INITSTART.
           IF DataSet1-clienti-KEY-Asc
              MOVE Low-Value TO cli-chiave OF clienti
           ELSE
              MOVE High-Value TO cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-INITEND.
           IF DataSet1-clienti-KEY-Asc
              MOVE High-Value TO cli-chiave OF clienti
           ELSE
              MOVE Low-Value TO cli-chiave OF clienti
           END-IF
           .

      * clienti
       DataSet1-clienti-START.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY >= cli-chiave OF clienti
           ELSE
              START clienti KEY <= cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-START-NOTGREATER.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY <= cli-chiave OF clienti
           ELSE
              START clienti KEY >= cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-START-GREATER.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY > cli-chiave OF clienti
           ELSE
              START clienti KEY < cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-START-LESS.
           IF DataSet1-clienti-KEY-Asc
              START clienti KEY < cli-chiave OF clienti
           ELSE
              START clienti KEY > cli-chiave OF clienti
           END-IF
           .

       DataSet1-clienti-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-clienti-LOCK
              READ clienti WITH LOCK 
              KEY cli-chiave OF clienti
           ELSE
              READ clienti WITH NO LOCK 
              KEY cli-chiave OF clienti
           END-IF
           PERFORM clienti-cli-K1-MERGE-SPLITBUF
           PERFORM clienti-cli-K3-MERGE-SPLITBUF
           PERFORM clienti-cli-K4-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT 
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-clienti-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-clienti-KEY-Asc
              IF DataSet1-clienti-LOCK
                 READ clienti NEXT WITH LOCK
              ELSE
                 READ clienti NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-clienti-LOCK
                 READ clienti PREVIOUS WITH LOCK
              ELSE
                 READ clienti PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM clienti-cli-K1-MERGE-SPLITBUF
           PERFORM clienti-cli-K3-MERGE-SPLITBUF
           PERFORM clienti-cli-K4-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-clienti-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-clienti-KEY-Asc
              IF DataSet1-clienti-LOCK
                 READ clienti PREVIOUS WITH LOCK
              ELSE
                 READ clienti PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-clienti-LOCK
                 READ clienti NEXT WITH LOCK
              ELSE
                 READ clienti NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM clienti-cli-K1-MERGE-SPLITBUF
           PERFORM clienti-cli-K3-MERGE-SPLITBUF
           PERFORM clienti-cli-K4-MERGE-SPLITBUF
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-clienti-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-clienti TO TOTEM-ERR-STAT
           MOVE "clienti" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:clienti, AfterDelete>
      * <TOTEM:END>
           .

       articoli-art-k1-MERGE-SPLITBUF.
           INITIALIZE articoli-art-k1-SPLITBUF
           MOVE art-descrizione OF articoli(1:50) TO 
           articoli-art-k1-SPLITBUF(1:50)
           .

       articoli-art-k-frn-MERGE-SPLITBUF.
           INITIALIZE articoli-art-k-frn-SPLITBUF
           MOVE art-cod-art-frn OF articoli(1:15) TO 
           articoli-art-k-frn-SPLITBUF(1:15)
           .

       DataSet1-articoli-INITSTART.
           IF DataSet1-articoli-KEY-Asc
              MOVE Low-Value TO art-chiave OF articoli
           ELSE
              MOVE High-Value TO art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-INITEND.
           IF DataSet1-articoli-KEY-Asc
              MOVE High-Value TO art-chiave OF articoli
           ELSE
              MOVE Low-Value TO art-chiave OF articoli
           END-IF
           .

      * articoli
       DataSet1-articoli-START.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY >= art-chiave OF articoli
           ELSE
              START articoli KEY <= art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-START-NOTGREATER.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY <= art-chiave OF articoli
           ELSE
              START articoli KEY >= art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-START-GREATER.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY > art-chiave OF articoli
           ELSE
              START articoli KEY < art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-START-LESS.
           IF DataSet1-articoli-KEY-Asc
              START articoli KEY < art-chiave OF articoli
           ELSE
              START articoli KEY > art-chiave OF articoli
           END-IF
           .

       DataSet1-articoli-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-articoli-LOCK
              READ articoli WITH LOCK 
              KEY art-chiave OF articoli
           ELSE
              READ articoli WITH NO LOCK 
              KEY art-chiave OF articoli
           END-IF
           PERFORM articoli-art-k1-MERGE-SPLITBUF
           PERFORM articoli-art-k-frn-MERGE-SPLITBUF
           MOVE STATUS-articoli TO TOTEM-ERR-STAT 
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-articoli-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-articoli-KEY-Asc
              IF DataSet1-articoli-LOCK
                 READ articoli NEXT WITH LOCK
              ELSE
                 READ articoli NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-articoli-LOCK
                 READ articoli PREVIOUS WITH LOCK
              ELSE
                 READ articoli PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM articoli-art-k1-MERGE-SPLITBUF
           PERFORM articoli-art-k-frn-MERGE-SPLITBUF
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-articoli-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-articoli-KEY-Asc
              IF DataSet1-articoli-LOCK
                 READ articoli PREVIOUS WITH LOCK
              ELSE
                 READ articoli PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-articoli-LOCK
                 READ articoli NEXT WITH LOCK
              ELSE
                 READ articoli NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM articoli-art-k1-MERGE-SPLITBUF
           PERFORM articoli-art-k-frn-MERGE-SPLITBUF
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-articoli-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-articoli-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-articoli-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-articoli TO TOTEM-ERR-STAT
           MOVE "articoli" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:articoli, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tcontat-INITSTART.
           IF DataSet1-tcontat-KEY-Asc
              MOVE Low-Value TO con-chiave
           ELSE
              MOVE High-Value TO con-chiave
           END-IF
           .

       DataSet1-tcontat-INITEND.
           IF DataSet1-tcontat-KEY-Asc
              MOVE High-Value TO con-chiave
           ELSE
              MOVE Low-Value TO con-chiave
           END-IF
           .

      * tcontat
       DataSet1-tcontat-START.
           IF DataSet1-tcontat-KEY-Asc
              START tcontat KEY >= con-chiave
           ELSE
              START tcontat KEY <= con-chiave
           END-IF
           .

       DataSet1-tcontat-START-NOTGREATER.
           IF DataSet1-tcontat-KEY-Asc
              START tcontat KEY <= con-chiave
           ELSE
              START tcontat KEY >= con-chiave
           END-IF
           .

       DataSet1-tcontat-START-GREATER.
           IF DataSet1-tcontat-KEY-Asc
              START tcontat KEY > con-chiave
           ELSE
              START tcontat KEY < con-chiave
           END-IF
           .

       DataSet1-tcontat-START-LESS.
           IF DataSet1-tcontat-KEY-Asc
              START tcontat KEY < con-chiave
           ELSE
              START tcontat KEY > con-chiave
           END-IF
           .

       DataSet1-tcontat-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tcontat-LOCK
              READ tcontat WITH LOCK 
              KEY con-chiave
           ELSE
              READ tcontat WITH NO LOCK 
              KEY con-chiave
           END-IF
           MOVE STATUS-tcontat TO TOTEM-ERR-STAT 
           MOVE "tcontat" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tcontat-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tcontat-KEY-Asc
              IF DataSet1-tcontat-LOCK
                 READ tcontat NEXT WITH LOCK
              ELSE
                 READ tcontat NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tcontat-LOCK
                 READ tcontat PREVIOUS WITH LOCK
              ELSE
                 READ tcontat PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tcontat TO TOTEM-ERR-STAT
           MOVE "tcontat" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tcontat-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tcontat-KEY-Asc
              IF DataSet1-tcontat-LOCK
                 READ tcontat PREVIOUS WITH LOCK
              ELSE
                 READ tcontat PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tcontat-LOCK
                 READ tcontat NEXT WITH LOCK
              ELSE
                 READ tcontat NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tcontat TO TOTEM-ERR-STAT
           MOVE "tcontat" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tcontat-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tcontat TO TOTEM-ERR-STAT
           MOVE "tcontat" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tcontat-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tcontat TO TOTEM-ERR-STAT
           MOVE "tcontat" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tcontat-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tcontat TO TOTEM-ERR-STAT
           MOVE "tcontat" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcontat, AfterDelete>
      * <TOTEM:END>
           .

       tcaumag-k-mag-MERGE-SPLITBUF.
           INITIALIZE tcaumag-k-mag-SPLITBUF
           MOVE tca-cod-magaz(1:3) TO tcaumag-k-mag-SPLITBUF(1:3)
           MOVE tca-ord-forn(1:1) TO tcaumag-k-mag-SPLITBUF(4:1)
           .

       DataSet1-tcaumag-INITSTART.
           IF DataSet1-tcaumag-KEY-Asc
              MOVE Low-Value TO tca-chiave
           ELSE
              MOVE High-Value TO tca-chiave
           END-IF
           .

       DataSet1-tcaumag-INITEND.
           IF DataSet1-tcaumag-KEY-Asc
              MOVE High-Value TO tca-chiave
           ELSE
              MOVE Low-Value TO tca-chiave
           END-IF
           .

      * tcaumag
       DataSet1-tcaumag-START.
           IF DataSet1-tcaumag-KEY-Asc
              START tcaumag KEY >= tca-chiave
           ELSE
              START tcaumag KEY <= tca-chiave
           END-IF
           .

       DataSet1-tcaumag-START-NOTGREATER.
           IF DataSet1-tcaumag-KEY-Asc
              START tcaumag KEY <= tca-chiave
           ELSE
              START tcaumag KEY >= tca-chiave
           END-IF
           .

       DataSet1-tcaumag-START-GREATER.
           IF DataSet1-tcaumag-KEY-Asc
              START tcaumag KEY > tca-chiave
           ELSE
              START tcaumag KEY < tca-chiave
           END-IF
           .

       DataSet1-tcaumag-START-LESS.
           IF DataSet1-tcaumag-KEY-Asc
              START tcaumag KEY < tca-chiave
           ELSE
              START tcaumag KEY > tca-chiave
           END-IF
           .

       DataSet1-tcaumag-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tcaumag-LOCK
              READ tcaumag WITH LOCK 
              KEY tca-chiave
           ELSE
              READ tcaumag WITH NO LOCK 
              KEY tca-chiave
           END-IF
           PERFORM tcaumag-k-mag-MERGE-SPLITBUF
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT 
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tcaumag-KEY-Asc
              IF DataSet1-tcaumag-LOCK
                 READ tcaumag NEXT WITH LOCK
              ELSE
                 READ tcaumag NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tcaumag-LOCK
                 READ tcaumag PREVIOUS WITH LOCK
              ELSE
                 READ tcaumag PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tcaumag-k-mag-MERGE-SPLITBUF
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tcaumag-KEY-Asc
              IF DataSet1-tcaumag-LOCK
                 READ tcaumag PREVIOUS WITH LOCK
              ELSE
                 READ tcaumag PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tcaumag-LOCK
                 READ tcaumag NEXT WITH LOCK
              ELSE
                 READ tcaumag NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tcaumag-k-mag-MERGE-SPLITBUF
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tcaumag-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tcaumag TO TOTEM-ERR-STAT
           MOVE "tcaumag" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tcaumag, AfterDelete>
      * <TOTEM:END>
           .

       progmag-key01-MERGE-SPLITBUF.
           INITIALIZE progmag-key01-SPLITBUF
           MOVE prg-cod-magazzino OF progmag(1:3) TO 
           progmag-key01-SPLITBUF(1:3)
           MOVE prg-cod-articolo OF progmag(1:6) TO 
           progmag-key01-SPLITBUF(4:6)
           MOVE prg-tipo-imballo OF progmag(1:3) TO 
           progmag-key01-SPLITBUF(10:3)
           MOVE prg-peso OF progmag(1:8) TO progmag-key01-SPLITBUF(13:8)
           .

       DataSet1-progmag-INITSTART.
           IF DataSet1-progmag-KEY-Asc
              MOVE Low-Value TO prg-chiave OF progmag
           ELSE
              MOVE High-Value TO prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-INITEND.
           IF DataSet1-progmag-KEY-Asc
              MOVE High-Value TO prg-chiave OF progmag
           ELSE
              MOVE Low-Value TO prg-chiave OF progmag
           END-IF
           .

      * progmag
       DataSet1-progmag-START.
           IF DataSet1-progmag-KEY-Asc
              START progmag KEY >= prg-chiave OF progmag
           ELSE
              START progmag KEY <= prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-START-NOTGREATER.
           IF DataSet1-progmag-KEY-Asc
              START progmag KEY <= prg-chiave OF progmag
           ELSE
              START progmag KEY >= prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-START-GREATER.
           IF DataSet1-progmag-KEY-Asc
              START progmag KEY > prg-chiave OF progmag
           ELSE
              START progmag KEY < prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-START-LESS.
           IF DataSet1-progmag-KEY-Asc
              START progmag KEY < prg-chiave OF progmag
           ELSE
              START progmag KEY > prg-chiave OF progmag
           END-IF
           .

       DataSet1-progmag-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-progmag-LOCK
              READ progmag WITH LOCK 
              KEY prg-chiave OF progmag
           ELSE
              READ progmag WITH NO LOCK 
              KEY prg-chiave OF progmag
           END-IF
           PERFORM progmag-key01-MERGE-SPLITBUF
           MOVE STATUS-progmag TO TOTEM-ERR-STAT 
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-progmag-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-progmag-KEY-Asc
              IF DataSet1-progmag-LOCK
                 READ progmag NEXT WITH LOCK
              ELSE
                 READ progmag NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-progmag-LOCK
                 READ progmag PREVIOUS WITH LOCK
              ELSE
                 READ progmag PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM progmag-key01-MERGE-SPLITBUF
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-progmag-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-progmag-KEY-Asc
              IF DataSet1-progmag-LOCK
                 READ progmag PREVIOUS WITH LOCK
              ELSE
                 READ progmag PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-progmag-LOCK
                 READ progmag NEXT WITH LOCK
              ELSE
                 READ progmag NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM progmag-key01-MERGE-SPLITBUF
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-progmag-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-progmag-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-progmag-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-progmag TO TOTEM-ERR-STAT
           MOVE "progmag" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:progmag, AfterDelete>
      * <TOTEM:END>
           .

       MAS-MAS-CODICE1-MERGE-SPLITBUF.
           INITIALIZE MAS-MAS-CODICE1-SPLITBUF
           MOVE MAS-CODICE-ALTERNATIVO(1:30) TO 
           MAS-MAS-CODICE1-SPLITBUF(1:30)
           MOVE MAS-CODICE(1:8) TO MAS-MAS-CODICE1-SPLITBUF(31:8)
           .

       MAS-MAS-CODICE2-MERGE-SPLITBUF.
           INITIALIZE MAS-MAS-CODICE2-SPLITBUF
           MOVE MAS-DESCRIZIONE1(1:30) TO MAS-MAS-CODICE2-SPLITBUF(1:30)
           MOVE MAS-CODICE(1:8) TO MAS-MAS-CODICE2-SPLITBUF(31:8)
           .

       DataSet1-MAS-INITSTART.
           IF DataSet1-MAS-KEY-Asc
              MOVE Low-Value TO MAS-CODICE
           ELSE
              MOVE High-Value TO MAS-CODICE
           END-IF
           .

       DataSet1-MAS-INITEND.
           IF DataSet1-MAS-KEY-Asc
              MOVE High-Value TO MAS-CODICE
           ELSE
              MOVE Low-Value TO MAS-CODICE
           END-IF
           .

      * MAS
       DataSet1-MAS-START.
           IF DataSet1-MAS-KEY-Asc
              START MAS KEY >= MAS-CODICE
           ELSE
              START MAS KEY <= MAS-CODICE
           END-IF
           .

       DataSet1-MAS-START-NOTGREATER.
           IF DataSet1-MAS-KEY-Asc
              START MAS KEY <= MAS-CODICE
           ELSE
              START MAS KEY >= MAS-CODICE
           END-IF
           .

       DataSet1-MAS-START-GREATER.
           IF DataSet1-MAS-KEY-Asc
              START MAS KEY > MAS-CODICE
           ELSE
              START MAS KEY < MAS-CODICE
           END-IF
           .

       DataSet1-MAS-START-LESS.
           IF DataSet1-MAS-KEY-Asc
              START MAS KEY < MAS-CODICE
           ELSE
              START MAS KEY > MAS-CODICE
           END-IF
           .

       DataSet1-MAS-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:MAS, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:MAS, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-MAS-LOCK
              READ MAS WITH LOCK 
              KEY MAS-CODICE
           ELSE
              READ MAS WITH NO LOCK 
              KEY MAS-CODICE
           END-IF
           PERFORM MAS-MAS-CODICE1-MERGE-SPLITBUF
           PERFORM MAS-MAS-CODICE2-MERGE-SPLITBUF
           MOVE STATUS-MAS TO TOTEM-ERR-STAT 
           MOVE "MAS" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:MAS, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:MAS, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-MAS-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:MAS, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:MAS, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-MAS-KEY-Asc
              IF DataSet1-MAS-LOCK
                 READ MAS NEXT WITH LOCK
              ELSE
                 READ MAS NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-MAS-LOCK
                 READ MAS PREVIOUS WITH LOCK
              ELSE
                 READ MAS PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM MAS-MAS-CODICE1-MERGE-SPLITBUF
           PERFORM MAS-MAS-CODICE2-MERGE-SPLITBUF
           MOVE STATUS-MAS TO TOTEM-ERR-STAT
           MOVE "MAS" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:MAS, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:MAS, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-MAS-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:MAS, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:MAS, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-MAS-KEY-Asc
              IF DataSet1-MAS-LOCK
                 READ MAS PREVIOUS WITH LOCK
              ELSE
                 READ MAS PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-MAS-LOCK
                 READ MAS NEXT WITH LOCK
              ELSE
                 READ MAS NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM MAS-MAS-CODICE1-MERGE-SPLITBUF
           PERFORM MAS-MAS-CODICE2-MERGE-SPLITBUF
           MOVE STATUS-MAS TO TOTEM-ERR-STAT
           MOVE "MAS" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:MAS, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:MAS, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-MAS-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:MAS, BeforeWrite>
      * <TOTEM:END>
           WRITE RECORD-MAS OF MAS.
           MOVE STATUS-MAS TO TOTEM-ERR-STAT
           MOVE "MAS" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:MAS, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-MAS-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:MAS, BeforeRewrite>
      * <TOTEM:END>
           REWRITE RECORD-MAS OF MAS.
           MOVE STATUS-MAS TO TOTEM-ERR-STAT
           MOVE "MAS" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:MAS, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-MAS-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:MAS, BeforeDelete>
      * <TOTEM:END>
           DELETE MAS.
           MOVE STATUS-MAS TO TOTEM-ERR-STAT
           MOVE "MAS" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:MAS, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-tmarche-INITSTART.
           IF DataSet1-tmarche-KEY-Asc
              MOVE Low-Value TO mar-chiave
           ELSE
              MOVE High-Value TO mar-chiave
           END-IF
           .

       DataSet1-tmarche-INITEND.
           IF DataSet1-tmarche-KEY-Asc
              MOVE High-Value TO mar-chiave
           ELSE
              MOVE Low-Value TO mar-chiave
           END-IF
           .

      * tmarche
       DataSet1-tmarche-START.
           IF DataSet1-tmarche-KEY-Asc
              START tmarche KEY >= mar-chiave
           ELSE
              START tmarche KEY <= mar-chiave
           END-IF
           .

       DataSet1-tmarche-START-NOTGREATER.
           IF DataSet1-tmarche-KEY-Asc
              START tmarche KEY <= mar-chiave
           ELSE
              START tmarche KEY >= mar-chiave
           END-IF
           .

       DataSet1-tmarche-START-GREATER.
           IF DataSet1-tmarche-KEY-Asc
              START tmarche KEY > mar-chiave
           ELSE
              START tmarche KEY < mar-chiave
           END-IF
           .

       DataSet1-tmarche-START-LESS.
           IF DataSet1-tmarche-KEY-Asc
              START tmarche KEY < mar-chiave
           ELSE
              START tmarche KEY > mar-chiave
           END-IF
           .

       DataSet1-tmarche-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tmarche-LOCK
              READ tmarche WITH LOCK 
              KEY mar-chiave
           ELSE
              READ tmarche WITH NO LOCK 
              KEY mar-chiave
           END-IF
           MOVE STATUS-tmarche TO TOTEM-ERR-STAT 
           MOVE "tmarche" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tmarche-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tmarche-KEY-Asc
              IF DataSet1-tmarche-LOCK
                 READ tmarche NEXT WITH LOCK
              ELSE
                 READ tmarche NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tmarche-LOCK
                 READ tmarche PREVIOUS WITH LOCK
              ELSE
                 READ tmarche PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tmarche TO TOTEM-ERR-STAT
           MOVE "tmarche" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tmarche-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tmarche-KEY-Asc
              IF DataSet1-tmarche-LOCK
                 READ tmarche PREVIOUS WITH LOCK
              ELSE
                 READ tmarche PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tmarche-LOCK
                 READ tmarche NEXT WITH LOCK
              ELSE
                 READ tmarche NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-tmarche TO TOTEM-ERR-STAT
           MOVE "tmarche" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tmarche-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tmarche TO TOTEM-ERR-STAT
           MOVE "tmarche" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tmarche-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tmarche TO TOTEM-ERR-STAT
           MOVE "tmarche" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tmarche-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tmarche TO TOTEM-ERR-STAT
           MOVE "tmarche" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tmarche, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-recapiti-INITSTART.
           IF DataSet1-recapiti-KEY-Asc
              MOVE Low-Value TO rec-chiave
           ELSE
              MOVE High-Value TO rec-chiave
           END-IF
           .

       DataSet1-recapiti-INITEND.
           IF DataSet1-recapiti-KEY-Asc
              MOVE High-Value TO rec-chiave
           ELSE
              MOVE Low-Value TO rec-chiave
           END-IF
           .

      * recapiti
       DataSet1-recapiti-START.
           IF DataSet1-recapiti-KEY-Asc
              START recapiti KEY >= rec-chiave
           ELSE
              START recapiti KEY <= rec-chiave
           END-IF
           .

       DataSet1-recapiti-START-NOTGREATER.
           IF DataSet1-recapiti-KEY-Asc
              START recapiti KEY <= rec-chiave
           ELSE
              START recapiti KEY >= rec-chiave
           END-IF
           .

       DataSet1-recapiti-START-GREATER.
           IF DataSet1-recapiti-KEY-Asc
              START recapiti KEY > rec-chiave
           ELSE
              START recapiti KEY < rec-chiave
           END-IF
           .

       DataSet1-recapiti-START-LESS.
           IF DataSet1-recapiti-KEY-Asc
              START recapiti KEY < rec-chiave
           ELSE
              START recapiti KEY > rec-chiave
           END-IF
           .

       DataSet1-recapiti-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-recapiti-LOCK
              READ recapiti WITH LOCK 
              KEY rec-chiave
           ELSE
              READ recapiti WITH NO LOCK 
              KEY rec-chiave
           END-IF
           MOVE STATUS-recapiti TO TOTEM-ERR-STAT 
           MOVE "recapiti" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-recapiti-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-recapiti-KEY-Asc
              IF DataSet1-recapiti-LOCK
                 READ recapiti NEXT WITH LOCK
              ELSE
                 READ recapiti NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-recapiti-LOCK
                 READ recapiti PREVIOUS WITH LOCK
              ELSE
                 READ recapiti PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-recapiti TO TOTEM-ERR-STAT
           MOVE "recapiti" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-recapiti-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-recapiti-KEY-Asc
              IF DataSet1-recapiti-LOCK
                 READ recapiti PREVIOUS WITH LOCK
              ELSE
                 READ recapiti PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-recapiti-LOCK
                 READ recapiti NEXT WITH LOCK
              ELSE
                 READ recapiti NEXT WITH NO LOCK
              END-IF
           END-IF
           MOVE STATUS-recapiti TO TOTEM-ERR-STAT
           MOVE "recapiti" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-recapiti-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-recapiti TO TOTEM-ERR-STAT
           MOVE "recapiti" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-recapiti-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-recapiti TO TOTEM-ERR-STAT
           MOVE "recapiti" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-recapiti-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-recapiti TO TOTEM-ERR-STAT
           MOVE "recapiti" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:recapiti, AfterDelete>
      * <TOTEM:END>
           .

       brnotacr-brno-k-articolo-MERGE-SPLITBUF.
           INITIALIZE brnotacr-brno-k-articolo-SPLITBUF
           MOVE brno-cod-articolo(1:6) TO 
           brnotacr-brno-k-articolo-SPLITBUF(1:6)
           MOVE brno-chiave(1:18) TO 
           brnotacr-brno-k-articolo-SPLITBUF(7:18)
           .

       DataSet1-brnotacr-INITSTART.
           IF DataSet1-brnotacr-KEY-Asc
              MOVE Low-Value TO brno-chiave
           ELSE
              MOVE High-Value TO brno-chiave
           END-IF
           .

       DataSet1-brnotacr-INITEND.
           IF DataSet1-brnotacr-KEY-Asc
              MOVE High-Value TO brno-chiave
           ELSE
              MOVE Low-Value TO brno-chiave
           END-IF
           .

      * brnotacr
       DataSet1-brnotacr-START.
           IF DataSet1-brnotacr-KEY-Asc
              START brnotacr KEY >= brno-chiave
           ELSE
              START brnotacr KEY <= brno-chiave
           END-IF
           .

       DataSet1-brnotacr-START-NOTGREATER.
           IF DataSet1-brnotacr-KEY-Asc
              START brnotacr KEY <= brno-chiave
           ELSE
              START brnotacr KEY >= brno-chiave
           END-IF
           .

       DataSet1-brnotacr-START-GREATER.
           IF DataSet1-brnotacr-KEY-Asc
              START brnotacr KEY > brno-chiave
           ELSE
              START brnotacr KEY < brno-chiave
           END-IF
           .

       DataSet1-brnotacr-START-LESS.
           IF DataSet1-brnotacr-KEY-Asc
              START brnotacr KEY < brno-chiave
           ELSE
              START brnotacr KEY > brno-chiave
           END-IF
           .

       DataSet1-brnotacr-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-brnotacr-LOCK
              READ brnotacr WITH LOCK 
              KEY brno-chiave
           ELSE
              READ brnotacr WITH NO LOCK 
              KEY brno-chiave
           END-IF
           PERFORM brnotacr-brno-k-articolo-MERGE-SPLITBUF
           MOVE STATUS-brnotacr TO TOTEM-ERR-STAT 
           MOVE "brnotacr" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-brnotacr-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-brnotacr-KEY-Asc
              IF DataSet1-brnotacr-LOCK
                 READ brnotacr NEXT WITH LOCK
              ELSE
                 READ brnotacr NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-brnotacr-LOCK
                 READ brnotacr PREVIOUS WITH LOCK
              ELSE
                 READ brnotacr PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM brnotacr-brno-k-articolo-MERGE-SPLITBUF
           MOVE STATUS-brnotacr TO TOTEM-ERR-STAT
           MOVE "brnotacr" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-brnotacr-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-brnotacr-KEY-Asc
              IF DataSet1-brnotacr-LOCK
                 READ brnotacr PREVIOUS WITH LOCK
              ELSE
                 READ brnotacr PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-brnotacr-LOCK
                 READ brnotacr NEXT WITH LOCK
              ELSE
                 READ brnotacr NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM brnotacr-brno-k-articolo-MERGE-SPLITBUF
           MOVE STATUS-brnotacr TO TOTEM-ERR-STAT
           MOVE "brnotacr" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-brnotacr-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-brnotacr TO TOTEM-ERR-STAT
           MOVE "brnotacr" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-brnotacr-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-brnotacr TO TOTEM-ERR-STAT
           MOVE "brnotacr" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-brnotacr-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-brnotacr TO TOTEM-ERR-STAT
           MOVE "brnotacr" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:brnotacr, AfterDelete>
      * <TOTEM:END>
           .

       btnotacr-k1-MERGE-SPLITBUF.
           INITIALIZE btnotacr-k1-SPLITBUF
           MOVE btno-cod-cli(1:5) TO btnotacr-k1-SPLITBUF(1:5)
           MOVE btno-prg-destino(1:5) TO btnotacr-k1-SPLITBUF(6:5)
           MOVE btno-anno(1:4) TO btnotacr-k1-SPLITBUF(11:4)
           MOVE btno-numero(1:8) TO btnotacr-k1-SPLITBUF(15:8)
           .

       btnotacr-k-data-MERGE-SPLITBUF.
           INITIALIZE btnotacr-k-data-SPLITBUF
           MOVE btno-data(1:8) TO btnotacr-k-data-SPLITBUF(1:8)
           MOVE btno-numero(1:8) TO btnotacr-k-data-SPLITBUF(9:8)
           .

       btnotacr-k-fattura-MERGE-SPLITBUF.
           INITIALIZE btnotacr-k-fattura-SPLITBUF
           MOVE btno-anno-fatt(1:4) TO btnotacr-k-fattura-SPLITBUF(1:4)
           MOVE btno-num-fatt(1:8) TO btnotacr-k-fattura-SPLITBUF(5:8)
           .

       btnotacr-k-reso-MERGE-SPLITBUF.
           INITIALIZE btnotacr-k-reso-SPLITBUF
           MOVE btno-anno(1:4) TO btnotacr-k-reso-SPLITBUF(1:4)
           MOVE btno-num-reso(1:8) TO btnotacr-k-reso-SPLITBUF(5:8)
           .

       btnotacr-k-bolla-MERGE-SPLITBUF.
           INITIALIZE btnotacr-k-bolla-SPLITBUF
           MOVE btno-anno-bolla(1:4) TO btnotacr-k-bolla-SPLITBUF(1:4)
           MOVE btno-num-bolla(1:20) TO btnotacr-k-bolla-SPLITBUF(5:20)
           .

       btnotacr-k-vettore-MERGE-SPLITBUF.
           INITIALIZE btnotacr-k-vettore-SPLITBUF
           MOVE btno-vettore(1:5) TO btnotacr-k-vettore-SPLITBUF(1:5)
           MOVE btno-anno(1:4) TO btnotacr-k-vettore-SPLITBUF(6:4)
           MOVE btno-numero(1:8) TO btnotacr-k-vettore-SPLITBUF(10:8)
           .

       btnotacr-k-nota-MERGE-SPLITBUF.
           INITIALIZE btnotacr-k-nota-SPLITBUF
           MOVE btno-anno-nc(1:4) TO btnotacr-k-nota-SPLITBUF(1:4)
           MOVE btno-num-nc(1:8) TO btnotacr-k-nota-SPLITBUF(5:8)
           .

       btnotacr-k-fatman-MERGE-SPLITBUF.
           INITIALIZE btnotacr-k-fatman-SPLITBUF
           MOVE btno-anno-fm(1:4) TO btnotacr-k-fatman-SPLITBUF(1:4)
           MOVE btno-num-fm(1:8) TO btnotacr-k-fatman-SPLITBUF(5:8)
           .

       DataSet1-btnotacr-INITSTART.
           IF DataSet1-btnotacr-KEY-Asc
              MOVE Low-Value TO btno-chiave
           ELSE
              MOVE High-Value TO btno-chiave
           END-IF
           .

       DataSet1-btnotacr-INITEND.
           IF DataSet1-btnotacr-KEY-Asc
              MOVE High-Value TO btno-chiave
           ELSE
              MOVE Low-Value TO btno-chiave
           END-IF
           .

      * btnotacr
       DataSet1-btnotacr-START.
           IF DataSet1-btnotacr-KEY-Asc
              START btnotacr KEY >= btno-chiave
           ELSE
              START btnotacr KEY <= btno-chiave
           END-IF
           .

       DataSet1-btnotacr-START-NOTGREATER.
           IF DataSet1-btnotacr-KEY-Asc
              START btnotacr KEY <= btno-chiave
           ELSE
              START btnotacr KEY >= btno-chiave
           END-IF
           .

       DataSet1-btnotacr-START-GREATER.
           IF DataSet1-btnotacr-KEY-Asc
              START btnotacr KEY > btno-chiave
           ELSE
              START btnotacr KEY < btno-chiave
           END-IF
           .

       DataSet1-btnotacr-START-LESS.
           IF DataSet1-btnotacr-KEY-Asc
              START btnotacr KEY < btno-chiave
           ELSE
              START btnotacr KEY > btno-chiave
           END-IF
           .

       DataSet1-btnotacr-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-btnotacr-LOCK
              READ btnotacr WITH LOCK 
              KEY btno-chiave
           ELSE
              READ btnotacr WITH NO LOCK 
              KEY btno-chiave
           END-IF
           PERFORM btnotacr-k1-MERGE-SPLITBUF
           PERFORM btnotacr-k-data-MERGE-SPLITBUF
           PERFORM btnotacr-k-fattura-MERGE-SPLITBUF
           PERFORM btnotacr-k-reso-MERGE-SPLITBUF
           PERFORM btnotacr-k-bolla-MERGE-SPLITBUF
           PERFORM btnotacr-k-vettore-MERGE-SPLITBUF
           PERFORM btnotacr-k-nota-MERGE-SPLITBUF
           PERFORM btnotacr-k-fatman-MERGE-SPLITBUF
           MOVE STATUS-btnotacr TO TOTEM-ERR-STAT 
           MOVE "btnotacr" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-btnotacr-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-btnotacr-KEY-Asc
              IF DataSet1-btnotacr-LOCK
                 READ btnotacr NEXT WITH LOCK
              ELSE
                 READ btnotacr NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-btnotacr-LOCK
                 READ btnotacr PREVIOUS WITH LOCK
              ELSE
                 READ btnotacr PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM btnotacr-k1-MERGE-SPLITBUF
           PERFORM btnotacr-k-data-MERGE-SPLITBUF
           PERFORM btnotacr-k-fattura-MERGE-SPLITBUF
           PERFORM btnotacr-k-reso-MERGE-SPLITBUF
           PERFORM btnotacr-k-bolla-MERGE-SPLITBUF
           PERFORM btnotacr-k-vettore-MERGE-SPLITBUF
           PERFORM btnotacr-k-nota-MERGE-SPLITBUF
           PERFORM btnotacr-k-fatman-MERGE-SPLITBUF
           MOVE STATUS-btnotacr TO TOTEM-ERR-STAT
           MOVE "btnotacr" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-btnotacr-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-btnotacr-KEY-Asc
              IF DataSet1-btnotacr-LOCK
                 READ btnotacr PREVIOUS WITH LOCK
              ELSE
                 READ btnotacr PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-btnotacr-LOCK
                 READ btnotacr NEXT WITH LOCK
              ELSE
                 READ btnotacr NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM btnotacr-k1-MERGE-SPLITBUF
           PERFORM btnotacr-k-data-MERGE-SPLITBUF
           PERFORM btnotacr-k-fattura-MERGE-SPLITBUF
           PERFORM btnotacr-k-reso-MERGE-SPLITBUF
           PERFORM btnotacr-k-bolla-MERGE-SPLITBUF
           PERFORM btnotacr-k-vettore-MERGE-SPLITBUF
           PERFORM btnotacr-k-nota-MERGE-SPLITBUF
           PERFORM btnotacr-k-fatman-MERGE-SPLITBUF
           MOVE STATUS-btnotacr TO TOTEM-ERR-STAT
           MOVE "btnotacr" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-btnotacr-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-btnotacr TO TOTEM-ERR-STAT
           MOVE "btnotacr" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-btnotacr-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-btnotacr TO TOTEM-ERR-STAT
           MOVE "btnotacr" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-btnotacr-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-btnotacr TO TOTEM-ERR-STAT
           MOVE "btnotacr" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:btnotacr, AfterDelete>
      * <TOTEM:END>
           .

       tvettori-k-des-MERGE-SPLITBUF.
           INITIALIZE tvettori-k-des-SPLITBUF
           MOVE vet-descrizione(1:40) TO tvettori-k-des-SPLITBUF(1:40)
           .

       DataSet1-tvettori-INITSTART.
           IF DataSet1-tvettori-KEY-Asc
              MOVE Low-Value TO vet-chiave
           ELSE
              MOVE High-Value TO vet-chiave
           END-IF
           .

       DataSet1-tvettori-INITEND.
           IF DataSet1-tvettori-KEY-Asc
              MOVE High-Value TO vet-chiave
           ELSE
              MOVE Low-Value TO vet-chiave
           END-IF
           .

      * tvettori
       DataSet1-tvettori-START.
           IF DataSet1-tvettori-KEY-Asc
              START tvettori KEY >= vet-chiave
           ELSE
              START tvettori KEY <= vet-chiave
           END-IF
           .

       DataSet1-tvettori-START-NOTGREATER.
           IF DataSet1-tvettori-KEY-Asc
              START tvettori KEY <= vet-chiave
           ELSE
              START tvettori KEY >= vet-chiave
           END-IF
           .

       DataSet1-tvettori-START-GREATER.
           IF DataSet1-tvettori-KEY-Asc
              START tvettori KEY > vet-chiave
           ELSE
              START tvettori KEY < vet-chiave
           END-IF
           .

       DataSet1-tvettori-START-LESS.
           IF DataSet1-tvettori-KEY-Asc
              START tvettori KEY < vet-chiave
           ELSE
              START tvettori KEY > vet-chiave
           END-IF
           .

       DataSet1-tvettori-Read.
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeReadRecord>
      * <TOTEM:END>
           IF DataSet1-tvettori-LOCK
              READ tvettori WITH LOCK 
              KEY vet-chiave
           ELSE
              READ tvettori WITH NO LOCK 
              KEY vet-chiave
           END-IF
           PERFORM tvettori-k-des-MERGE-SPLITBUF
           MOVE STATUS-tvettori TO TOTEM-ERR-STAT 
           MOVE "tvettori" TO TOTEM-ERR-FILE
           MOVE "READ" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterReadRecord>
      * <TOTEM:END>
           .

       DataSet1-tvettori-Read-Next.
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeReadNext>
      * <TOTEM:END>
           IF DataSet1-tvettori-KEY-Asc
              IF DataSet1-tvettori-LOCK
                 READ tvettori NEXT WITH LOCK
              ELSE
                 READ tvettori NEXT WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tvettori-LOCK
                 READ tvettori PREVIOUS WITH LOCK
              ELSE
                 READ tvettori PREVIOUS WITH NO LOCK
              END-IF
           END-IF
           PERFORM tvettori-k-des-MERGE-SPLITBUF
           MOVE STATUS-tvettori TO TOTEM-ERR-STAT
           MOVE "tvettori" TO TOTEM-ERR-FILE
           MOVE "READ NEXT" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterReadNext>
      * <TOTEM:END>
           .

       DataSet1-tvettori-Read-Prev.
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeReadPrev>
      * <TOTEM:END>
           IF DataSet1-tvettori-KEY-Asc
              IF DataSet1-tvettori-LOCK
                 READ tvettori PREVIOUS WITH LOCK
              ELSE
                 READ tvettori PREVIOUS WITH NO LOCK
              END-IF
           ELSE
              IF DataSet1-tvettori-LOCK
                 READ tvettori NEXT WITH LOCK
              ELSE
                 READ tvettori NEXT WITH NO LOCK
              END-IF
           END-IF
           PERFORM tvettori-k-des-MERGE-SPLITBUF
           MOVE STATUS-tvettori TO TOTEM-ERR-STAT
           MOVE "tvettori" TO TOTEM-ERR-FILE
           MOVE "READ PREVIOUS" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterRead>
      * <TOTEM:END>
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterReadPrev>
      * <TOTEM:END>
           .

       DataSet1-tvettori-Rec-Write.
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeWrite>
      * <TOTEM:END>
           MOVE STATUS-tvettori TO TOTEM-ERR-STAT
           MOVE "tvettori" TO TOTEM-ERR-FILE
           MOVE "WRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterWrite>
      * <TOTEM:END>
           .

       DataSet1-tvettori-Rec-Rewrite.
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeRewrite>
      * <TOTEM:END>
           MOVE STATUS-tvettori TO TOTEM-ERR-STAT
           MOVE "tvettori" TO TOTEM-ERR-FILE
           MOVE "REWRITE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterRewrite>
      * <TOTEM:END>
           .

       DataSet1-tvettori-Rec-Delete.
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, BeforeDelete>
      * <TOTEM:END>
           MOVE STATUS-tvettori TO TOTEM-ERR-STAT
           MOVE "tvettori" TO TOTEM-ERR-FILE
           MOVE "DELETE" TO TOTEM-ERR-MODE
      * <TOTEM:EPT. FD:DataSet1, FD:tvettori, AfterDelete>
      * <TOTEM:END>
           .

       DataSet1-INIT-RECORD.
           INITIALIZE tor-rec OF tordini
           INITIALIZE age-rec OF agenti
           INITIALIZE tge-rec OF tparamge
           INITIALIZE ror-rec OF rordini
           INITIALIZE des-rec OF destini
           INITIALIZE record-tbliv OF tivaese
           INITIALIZE record-tblpa OF tcodpag
           INITIALIZE cli-rec OF clienti
           INITIALIZE art-rec OF articoli
           INITIALIZE con-rec OF tcontat
           INITIALIZE tca-rec OF tcaumag
           INITIALIZE prg-rec OF progmag
           INITIALIZE RECORD-MAS OF MAS
           INITIALIZE mar-rec OF tmarche
           INITIALIZE rec-rec OF recapiti
           INITIALIZE brno-rec OF brnotacr
           INITIALIZE btno-rec OF btnotacr
           INITIALIZE vet-rec OF tvettori
           .


      * COMBO-BOX
       cbo-stato-Content.
           .

      * GRID
       form1-gd-1-Content.
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 2, Y = 1,
                CELL-DATA = "Articolo",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 3, Y = 1,
                CELL-DATA = "Descrizione",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 4, Y = 1,
                CELL-DATA = "Quantità",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 5, Y = 1,
                CELL-DATA = "Prezzo",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 6, Y = 1,
                CELL-DATA = "Consumo",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 7, Y = 1,
                CELL-DATA = "Cou/Cobat",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 8, Y = 1,
                CELL-DATA = "Add. Piombo",
      * CELLS' SETTING
              MODIFY form1-gd-1, X = 9, Y = 1,
                CELL-DATA = "Cod. IVA",
           .

      * FD's Initialize Paragraph
       DataSet1-tordini-INITREC.
           INITIALIZE tor-rec OF tordini
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-agenti-INITREC.
           INITIALIZE age-rec OF agenti
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tparamge-INITREC.
           INITIALIZE tge-rec OF tparamge
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-rordini-INITREC.
           INITIALIZE ror-rec OF rordini
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-destini-INITREC.
           INITIALIZE des-rec OF destini
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tivaese-INITREC.
           INITIALIZE record-tbliv OF tivaese
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tcodpag-INITREC.
           INITIALIZE record-tblpa OF tcodpag
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-clienti-INITREC.
           INITIALIZE cli-rec OF clienti
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-articoli-INITREC.
           INITIALIZE art-rec OF articoli
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tcontat-INITREC.
           INITIALIZE con-rec OF tcontat
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tcaumag-INITREC.
           INITIALIZE tca-rec OF tcaumag
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-progmag-INITREC.
           INITIALIZE prg-rec OF progmag
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-MAS-INITREC.
           INITIALIZE RECORD-MAS OF MAS
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tmarche-INITREC.
           INITIALIZE mar-rec OF tmarche
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-recapiti-INITREC.
           INITIALIZE rec-rec OF recapiti
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-brnotacr-INITREC.
           INITIALIZE brno-rec OF brnotacr
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-btnotacr-INITREC.
           INITIALIZE btno-rec OF btnotacr
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      * FD's Initialize Paragraph
       DataSet1-tvettori-INITREC.
           INITIALIZE vet-rec OF tvettori
               REPLACING NUMERIC       DATA BY ZEROS
                         ALPHANUMERIC  DATA BY SPACES
                         ALPHABETIC    DATA BY SPACES
           .

      *
       DataSet1-DISPATCH-BUFTOFLD.
           .

       Form1-DISPLAY-STATUS-MSG.
            MODIFY Form1-St-1-Handle PANEL-INDEX = 1
                PANEL-TEXT = TOTEM-HINT-TEXT
           .

       Form1-CLEAR-STATUS-MSG.
           MOVE SPACES TO TOTEM-MSG-1, TOTEM-MSG-2, TOTEM-MSG-3, 
           TOTEM-MSG-TEXT
           PERFORM Form1-DISPLAY-STATUS-MSG
           .

       Form1-Open-Routine.
           PERFORM Form1-Scrn
           PERFORM Form1-Proc
           .

       Form1-Scrn.
           PERFORM Form1-Create-Win
           PERFORM Form1-Init-Value
           PERFORM Form1-Init-Data
      * Tab keystrok settings
      * Tool Bar
           DISPLAY Form1-Tb-1
           PERFORM Form1-DISPLAY
           .

       Form1-Create-Win.
           Display Independent GRAPHICAL WINDOW
              LINES 47,00,
              SIZE 158,00,
              HEIGHT-IN-CELLS,
              WIDTH-IN-CELLS,
              COLOR 65793,
              CONTROL FONT Small-Font,
              LINK TO THREAD,
              MODELESS,
              NO SCROLL,
              TITLE-BAR,
              TITLE tit-screen,
              AUTO-MINIMIZE,
              WITH SYSTEM MENU,
              USER-GRAY,
           VISIBLE v-screen,
              USER-WHITE,
              No WRAP,
              EVENT PROCEDURE Screen1-Event-Proc,
              HANDLE IS Form1-handle,
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterCreateWin>
      * <TOTEM:END>


      * Tool Bar    
           DISPLAY TOOL-BAR 
              LINES 2,69,   
              HANDLE IN Form1-Tb-1-Handle
           DISPLAY Form1-Tb-1 UPON Form1-Tb-1-Handle

      * Status-bar
           DISPLAY STATUS-BAR
              GRIP,
              PANEL-WIDTHS (100, 35, 999),
              PANEL-STYLE  (1, 1, 1),
              PANEL-TEXT   (SPACE, SPACE, SPACE),
              HANDLE IS Form1-St-1-Handle
           DISPLAY Form1 UPON Form1-handle
      * DISPLAY-COLUMNS settings
              MODIFY form1-gd-1, DISPLAY-COLUMNS (1, 8, 18, 83, 93, 
           105, 116, 127, 138)
           .

       Form1-PROC.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeAccept>
           set environment "KEYSTROKE" to "DATA=44   44".
           set environment "KEYSTROKE" to "DATA=46   46".

           evaluate true
           when LinkFTND move "SI MAGAZZINO" to tipo-doc
           when LinkFTTR move "NO MAGAZZINO" to tipo-doc
           when LinkFTMA move "NON DI MERCE" to tipo-doc
           end-evaluate.
           move spaces to tit-screen.
           string "Fatturazione Manuale " delimited by size
                  tipo-doc                delimited by size
                  into tit-screen
           end-string.
           move tit-screen to titolo.
           modify form1-handle, title = tit-screen.
           
           move Link-TipoFat  to tca-codice.
           read tcaumag no lock 
                invalid 
                display message "Causale ", tca-codice " non registrata"
                         x"0d0a""Impossibile utilizzare il programma."
                        title = titolo
                        icon mb-error-icon
            not invalid move 1 to v-screen
                        modify form1-handle, visible = v-screen
                        if tca-no-movim-giac and
                           tca-no-movim-imp  and
                           tca-no-movim-ord  and
                           tca-no-giac-bloc
                           set CallWProgmag to false
                        else
                           set CallWProgmag to true
                        end-if

                        if tca-si-zero set TotaleSiZero to true
                        else           set TotaleNoZero to true
                        end-if
           end-read.

           if v-screen = 1
              |Nuova modifica per autofatturazione
              if FatAnno   not = 0 and
                 FatNumero not = 0
                 if LinkFattMan
                    move FatAnno   to tor-anno
                    move FatNumero to tor-numero
                 else
                    if FatAnno   not = 0 and
                       FatNumero not = 0
                       move FatAnno   to btno-anno
                       move FatNumero to btno-numero
                       move 1 to v-bozza
                    end-if
                 end-if
                 accept data-oggi from century-date
                 perform INIT
                 perform RIEMPI-COMBO-STATO
                 move "Attivo"      to cbo-stato-buf
                 Modify  cbo-stato, value cbo-stato-buf
                 move spaces        to tge-chiave
      *****           read tparamge invalid continue end-read
      *****           move tge-cod-pag   to ef-pag-buf
                 perform CURRENT-RECORD
                 perform ABILITAZIONI
              else
                 accept data-oggi from century-date
                 perform INIT
                 move spaces        to tge-chiave
                 read tparamge invalid continue end-read
                 perform VALORIZZA-TESTATA
              end-if
              perform DISPLAY-SCREEN

              move 78-ID-ef-cli to control-id
              move 4            to accept-control
           else
              move 27 to key-status
           end-if.

           string "Esercizio " delimited size
                  esercizio    delimited size
                  " ("         delimited size
                  esercizio-G2 delimited size
                  ")"          delimited size
                  into lab-anno-buf
           end-string.

           display lab-anno.

           .
      * <TOTEM:END>
           PERFORM UNTIL Exit-Pushed
              ACCEPT Form1
                 ON EXCEPTION
                    PERFORM Form1-Evaluate-Func
                 MOVE 1 TO TOTEM-Form-Index
              END-ACCEPT
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterEndAccept>
           if NonCambiareTab
              set NonCambiareTab to false
              move 1 to screen1-ta-1-tab-value event-data-1      
              perform SCREEN1-TA-1-TABCHANGE
              move store-id to control-id
              move 4 to accept-control
      *****        set ControllaCampi to true
           end-if

           if ArticoloSetFocus
              evaluate true
              when v-FTMA = 1 move 78-ID-ef-descr    to control-id
              when v-FTTR = 1 move 78-ID-ef-art      to control-id
              end-evaluate
              move 4                 to accept-control
      *****        set ControllaCampi   to true
              set ArticoloSetFocus   to false
           end-if

           if InsertRow
              move 0         to LastPrg
              set  InsertRow to false
              |aggiungo una riga simulando
              |pressione del tasto "nuovo"
              perform pb-nuovo-LinkTo
           end-if

      * <TOTEM:END>
           END-PERFORM
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDestroyWindow>
      * <TOTEM:END>
           DESTROY Form1-handle
           INITIALIZE Key-Status
           .

       Form1-Evaluate-Func.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterAccept>
      * <TOTEM:END>
           EVALUATE TRUE
              WHEN Exit-Pushed
                 PERFORM Form1-Exit
              WHEN Event-Occurred
                 IF Event-Type = Cmd-Close
                    PERFORM Form1-Exit
                 END-IF
                 IF Event-Type = Cmd-Tabchanged AND 
                                 Event-Control-Id = 1
                    MOVE EVENT-DATA-1 TO Screen1-Ta-1-TAB-VALUE
                    PERFORM Screen1-Ta-1-TABCHANGE
                 END-IF

              WHEN Key-Status = 5002
                 PERFORM pb-nuovo-LinkTo
              WHEN Key-Status = 5003
                 PERFORM pb-elimina-LinkTo
              WHEN Key-Status = 1000
                 PERFORM pb-iva-LinkTo
              WHEN Key-Status = 3
                 PERFORM TOOL-SALVA-LinkTo
              WHEN Key-Status = 6
                 PERFORM ANTEPRIMA-LinkTo
              WHEN Key-Status = 150
                 PERFORM TOOL-MODIFICA-LinkTo
              WHEN Key-Status = 7
                 PERFORM STAMPA-LinkTo
              WHEN Key-Status = 8
                 PERFORM TOOL-CERCA-LinkTo
           END-EVALUATE
      * avoid changing focus
           MOVE 4 TO Accept-Control
           .

       Form1-CLEAR.
           PERFORM Form1-INIT-VALUE
           PERFORM Form1-DISPLAY
           .

       Form1-DISPLAY.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeDisplay>
      * <TOTEM:END>
           DISPLAY Form1-Tb-1
           DISPLAY Form1 UPON Form1-handle
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterDisplay>
           SET LK-BL-SCRITTURA     TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           MOVE FORM1-HANDLE       TO LK-HND-WIN.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           CANCEL "BLOCKPGM".

           .
      * <TOTEM:END>
           .

       Form1-Exit.
      * for main screen
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeExit>
           display message "Abbandonare il documento in gestione?"
                   title = titolo
                   type mb-yes-no
                   giving scelta
                   default mb-no
           if scelta = mb-no
              move 26 to key-status
              exit paragraph
           end-if.

           set environment "KEYSTROKE" to "DATA=44   44".
           set environment "KEYSTROKE" to "DATA=46   46".

           .
      * <TOTEM:END>
           MOVE 27 TO Key-Status
           .

       Form1-Init-Data.
           MOVE 1 TO TOTEM-Form-Index
           MOVE 0 TO TOTEM-Frame-Index
      * TAB
              MODIFY Screen1-Ta-1, RESET-TABS = 1
              MODIFY Screen1-Ta-1, 
           TAB-TO-ADD = (
                 " - Sezione dati di &Testata - ",
                 " - Sezione &Righe - ",
                        )
           MOVE 0 TO 
                   Screen1-Pg-1-Visible,
                   Screen1-Pg-2-Visible,
           MOVE 1 TO Screen1-Pg-1-Visible
           PERFORM Screen1-Ta-1-TABCHANGE
      * COMBO-BOX
           PERFORM cbo-stato-Content
      * GRID
           PERFORM form1-gd-1-Content
           .

       Form1-Init-Value.
           MOVE tit-screen TO TOTEM-MSG-TITLE
           INITIALIZE Form1-BUF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, SetDefault>
      * <TOTEM:END>
           PERFORM Form1-FLD-TO-BUF
           .


       Form1-ALLGRID-RESET.
           .

      * for Form's Validation
       Form1-VALIDATION-ROUTINE.
           SET TOTEM-CHECK-OK TO TRUE
      * ef-cli's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-cli-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 1 TO Screen1-Ta-1-TAB-VALUE
               PERFORM Screen1-Ta-1-TABCHANGE
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5001 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-des's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-des-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 1 TO Screen1-Ta-1-TAB-VALUE
               PERFORM Screen1-Ta-1-TABCHANGE
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5002 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-age's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-age-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 1 TO Screen1-Ta-1-TAB-VALUE
               PERFORM Screen1-Ta-1-TABCHANGE
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5003 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-pag's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-pag-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 1 TO Screen1-Ta-1-TAB-VALUE
               PERFORM Screen1-Ta-1-TABCHANGE
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5004 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-iva-ese's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-iva-ese-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 1 TO Screen1-Ta-1-TAB-VALUE
               PERFORM Screen1-Ta-1-TABCHANGE
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5005 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-piano's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-piano-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 1 TO Screen1-Ta-1-TAB-VALUE
               PERFORM Screen1-Ta-1-TABCHANGE
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5006 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-note's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-note-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 1 TO Screen1-Ta-1-TAB-VALUE
               PERFORM Screen1-Ta-1-TABCHANGE
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5007 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-fatt-num's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-fatt-num-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 1 TO Screen1-Ta-1-TAB-VALUE
               PERFORM Screen1-Ta-1-TABCHANGE
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5009 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
      * ef-fatt-data's Validation
           SET TOTEM-CHECK-OK TO FALSE
           PERFORM ef-fatt-data-VALIDATION
           IF NOT TOTEM-CHECK-OK
               MOVE 1 TO Screen1-Ta-1-TAB-VALUE
               PERFORM Screen1-Ta-1-TABCHANGE
               MOVE 4 TO ACCEPT-CONTROL
               MOVE 5010 TO CONTROL-ID
               EXIT PARAGRAPH
           END-IF
           .

       ef-cli-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-cli, BeforeValidation>
      * <TOTEM:END>
           .

       ef-cli-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-cli, AfterValidation>
      * <TOTEM:END>
           .

      * ef-cli's Validation
       ef-cli-VALIDATION.
           PERFORM ef-cli-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-cli-AFTER-VALIDATION
           .

       ef-des-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-des, BeforeValidation>
      * <TOTEM:END>
           .

       ef-des-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-des, AfterValidation>
      * <TOTEM:END>
           .

      * ef-des's Validation
       ef-des-VALIDATION.
           PERFORM ef-des-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-des-AFTER-VALIDATION
           .

       ef-age-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-age, BeforeValidation>
      * <TOTEM:END>
           .

       ef-age-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-age, AfterValidation>
      * <TOTEM:END>
           .

      * ef-age's Validation
       ef-age-VALIDATION.
           PERFORM ef-age-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-age-AFTER-VALIDATION
           .

       ef-pag-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-pag, BeforeValidation>
      * <TOTEM:END>
           .

       ef-pag-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-pag, AfterValidation>
      * <TOTEM:END>
           .

      * ef-pag's Validation
       ef-pag-VALIDATION.
           PERFORM ef-pag-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-pag-AFTER-VALIDATION
           .

       ef-iva-ese-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-iva-ese, BeforeValidation>
      * <TOTEM:END>
           .

       ef-iva-ese-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-iva-ese, AfterValidation>
      * <TOTEM:END>
           .

      * ef-iva-ese's Validation
       ef-iva-ese-VALIDATION.
           PERFORM ef-iva-ese-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-iva-ese-AFTER-VALIDATION
           .

       ef-piano-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-piano, BeforeValidation>
      * <TOTEM:END>
           .

       ef-piano-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-piano, AfterValidation>
      * <TOTEM:END>
           .

      * ef-piano's Validation
       ef-piano-VALIDATION.
           PERFORM ef-piano-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-piano-AFTER-VALIDATION
           .

       ef-note-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-note, BeforeValidation>
      * <TOTEM:END>
           .

       ef-note-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-note, AfterValidation>
      * <TOTEM:END>
           .

      * ef-note's Validation
       ef-note-VALIDATION.
           PERFORM ef-note-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-note-AFTER-VALIDATION
           .

       ef-fatt-num-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-fatt-num, BeforeValidation>
      * <TOTEM:END>
           .

       ef-fatt-num-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-fatt-num, AfterValidation>
      * <TOTEM:END>
           .

      * ef-fatt-num's Validation
       ef-fatt-num-VALIDATION.
           PERFORM ef-fatt-num-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-fatt-num-AFTER-VALIDATION
           .

       ef-fatt-data-BEFORE-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-fatt-data, BeforeValidation>
      * <TOTEM:END>
           .

       ef-fatt-data-AFTER-VALIDATION.
      * <TOTEM:EPT. FORM:Form1, Data.Entry-Field:ef-fatt-data, AfterValidation>
      * <TOTEM:END>
           .

      * ef-fatt-data's Validation
       ef-fatt-data-VALIDATION.
           PERFORM ef-fatt-data-BEFORE-VALIDATION
           SET TOTEM-CHECK-OK TO TRUE
           PERFORM ef-fatt-data-AFTER-VALIDATION
           .


       Form1-Buf-To-Fld.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeBufToFld>
      * <TOTEM:END>
      * DB_Entry-Field : ef-cli
           MOVE ef-cli-BUF TO tor-cod-cli
      * DB_Entry-Field : ef-des
           MOVE ef-des-BUF TO tor-prg-destino
      * DB_Entry-Field : ef-age
           MOVE ef-age-BUF TO tor-cod-agente
      * DB_Entry-Field : ef-pag
           MOVE ef-pag-BUF TO tor-cod-pagamento
      * DB_Entry-Field : ef-iva-ese
           MOVE ef-iva-ese-BUF TO tor-cod-ese-iva
      * DB_Entry-Field : ef-piano
           MOVE ef-piano-BUF TO tor-contropartita
      * DB_Entry-Field : ef-note
           MOVE ef-note-BUF TO tor-note
      * DB_Entry-Field : ef-fatt-num
           MOVE ef-fatt-num-BUF TO tor-fattura-from-numero
      * DB_Entry-Field : ef-fatt-data
           MOVE ef-fatt-data-BUF TO tor-fattura-from-data
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterBufToFld>
           move esercizio    to tor-anno.
           move lab-data-buf to como-data.
           perform DATE-TO-FILE.
           move como-data     to tor-data-ordine 
                                 tor-data-passaggio-ordine.
           move Link-TipoFat  to tor-causale.
           
           accept tor-ora-creazione  from time.
           accept tor-data-creazione from century-date.
           move user-codi            to tor-utente-creazione.
                                    
           initialize tor-fattura
                      tor-vuoti replacing numeric data by zeroes
                                     alphanumeric data by spaces.

           set tor-fatt-si-prenotata to true.
           set tor-no-agg-contab     to true.
           
           perform SCARICA-COMBO-STATO.
           move stato                 to tor-stato.

           move ef-cli-buf to tor-cod-cli     convert.  
           move ef-des-buf to tor-prg-destino convert.

LUBEXX     move spaces     to rec-invio.
LUBEXX     move cli-codice to rec-codice.
LUBEXX     read recapiti no lock invalid continue end-read.
LUBEXX     if rec-invio = spaces set tor-invio-postel to true
LUBEXX     else                  move rec-invio to tor-invio
LUBEXX     end-if.

           set tor-fattura-manuale to true.

           move data-oggi(1:4) to tor-anno-bolla.
           move data-oggi      to tor-data-bolla.

           move ef-fatt-data-buf to como-data.
           perform DATE-TO-FILE.
           move como-data       to tor-fattura-from-data.
           move ef-fatt-num-buf to tor-fattura-from-numero.

           .
      * <TOTEM:END>
           .

       Form1-Fld-To-Buf.
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, BeforeFldToBuf>
      * <TOTEM:END>
      * DB_Entry-Field : ef-cli
           MOVE tor-cod-cli TO ef-cli-BUF
      * DB_Entry-Field : ef-des
           MOVE tor-prg-destino TO ef-des-BUF
      * DB_Entry-Field : ef-age
           MOVE tor-cod-agente TO ef-age-BUF
      * DB_Entry-Field : ef-pag
           MOVE tor-cod-pagamento TO ef-pag-BUF
      * DB_Entry-Field : ef-iva-ese
           MOVE tor-cod-ese-iva TO ef-iva-ese-BUF
      * DB_Entry-Field : ef-piano
           MOVE tor-contropartita TO ef-piano-BUF
      * DB_Entry-Field : ef-note
           MOVE tor-note TO ef-note-BUF
      * DB_Entry-Field : ef-fatt-num
           MOVE tor-fattura-from-numero TO ef-fatt-num-BUF
      * DB_Entry-Field : ef-fatt-data
           MOVE tor-fattura-from-data TO ef-fatt-data-BUF
      * <TOTEM:EPT. FORM:Form1, FORM:Form1, AfterFldToBuf>
           move tor-num-fattura to ef-fatt-num-buf.
           inspect ef-fatt-num-buf replacing leading x"30" by x"20".
           call "C$JUSTIFY" using ef-fatt-num-buf, "L".

           move tor-data-fattura to como-data.
           perform DATE-TO-SCREEN.
           move como-data       to ef-fatt-data-buf.

           .
      * <TOTEM:END>
           .

       Form1-CONTROLLO-OLD.
           set SiSalvato to true.
           if mod = 0 exit paragraph end-if.
           perform Form1-BUF-TO-FLD.
           move 0 to scelta.
           if tor-contropartita not = old-tor-contropartita
              and SiSalvato
              set NoSalvato to true
              |78-ID-ef-piano è l'ID del campo ef-piano
              move 78-ID-ef-piano to store-id 
           end-if

           .
       Form1-EXTENDED-FILE-STATUS.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
           MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           PERFORM Form1-SHOW-MSG-ROUTINE
           .

       Form1-SHOW-MSG-ROUTINE.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM Form1-DISPLAY-MESSAGE
           .

       Form1-DISPLAY-MESSAGE.
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

       Form1-Save-Status.
           .             

       Form1-Restore-Status.
           .


      * Paragrafo per la struttura del codice in BEFORE sulla screen Form1
      ***---
       Form1-BEFORE-SCREEN.
           evaluate control-id
           |78-ID-ef-cli è l'ID del campo ef-cli
           when 78-ID-ef-cli
                move 1 to StatusHelp
                perform STATUS-HELP
           |78-ID-ef-des è l'ID del campo ef-des
           when 78-ID-ef-des
                move 1 to StatusHelp
                perform STATUS-HELP
           |78-ID-ef-age è l'ID del campo ef-age
           when 78-ID-ef-age
                move 1 to StatusHelp
                perform STATUS-HELP
           |78-ID-ef-pag è l'ID del campo ef-pag
           when 78-ID-ef-pag
                move 1 to StatusHelp
                perform STATUS-HELP
           |78-ID-ef-iva-ese è l'ID del campo ef-iva-ese
           when 78-ID-ef-iva-ese
                move 1 to StatusHelp
                perform STATUS-HELP
           |78-ID-ef-piano è l'ID del campo ef-piano
           when 78-ID-ef-piano
                move 1 to StatusHelp
                perform STATUS-HELP
           |78-ID-ef-art è l'ID del campo ef-art
           when 78-ID-ef-art
                move 1 to StatusHelp
                perform STATUS-HELP
           |78-ID-ef-iva è l'ID del campo ef-iva
           when 78-ID-ef-iva
                move 1 to StatusHelp
                perform STATUS-HELP
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella BEFORE della screen
           when 99999 continue
           when other continue
           end-evaluate.

      * Generazione settaggio keyboard "." ---> ","

      * Paragrafo per la struttura del codice in AFTER sulla screen Form1
      ***---
       Form1-AFTER-SCREEN.
           evaluate control-id
           |78-ID-ef-cli è l'ID del campo ef-cli
           when 78-ID-ef-cli
                move 0 to StatusHelp
                perform STATUS-HELP

           |78-ID-ef-des è l'ID del campo ef-des
           when 78-ID-ef-des
                move 0 to StatusHelp
                perform STATUS-HELP

           |78-ID-ef-age è l'ID del campo ef-age
           when 78-ID-ef-age
                move 0 to StatusHelp
                perform STATUS-HELP

           |78-ID-ef-pag è l'ID del campo ef-pag
           when 78-ID-ef-pag
                move 0 to StatusHelp
                perform STATUS-HELP

           |78-ID-ef-iva-ese è l'ID del campo ef-iva-ese
           when 78-ID-ef-iva-ese
                move 0 to StatusHelp
                perform STATUS-HELP

           |78-ID-ef-piano è l'ID del campo ef-piano
           when 78-ID-ef-piano
                move 0 to StatusHelp
                perform STATUS-HELP

           |78-ID-ef-art è l'ID del campo ef-art
           when 78-ID-ef-art
                move 0 to StatusHelp
                perform STATUS-HELP

           |78-ID-ef-iva è l'ID del campo ef-iva
           when 78-ID-ef-iva
                move 0 to StatusHelp
                perform STATUS-HELP

           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER della screen
           when 99999 continue
           when other continue
           end-evaluate.

      * Generazione risettaggio keyboard "." ---> "."

      * Generazione stringa perform CONTROLLO
           evaluate control-id
           |78-ID-ef-cli è l'ID del campo ef-cli
           when 78-ID-ef-cli
                perform CONTROLLO
           |78-ID-ef-des è l'ID del campo ef-des
           when 78-ID-ef-des
                perform CONTROLLO
           |78-ID-ef-age è l'ID del campo ef-age
           when 78-ID-ef-age
                perform CONTROLLO
           |78-ID-ef-pag è l'ID del campo ef-pag
           when 78-ID-ef-pag
                perform CONTROLLO
           |78-ID-ef-iva-ese è l'ID del campo ef-iva-ese
           when 78-ID-ef-iva-ese
                perform CONTROLLO
           |78-ID-ef-piano è l'ID del campo ef-piano
           when 78-ID-ef-piano
                perform CONTROLLO
           |78-ID-ef-note è l'ID del campo ef-note
           when 78-ID-ef-note
                perform CONTROLLO
           |78-ID-cbo-stato è l'ID del campo cbo-stato
           when 78-ID-cbo-stato
                perform CONTROLLO
           |78-ID-ef-fatt-num è l'ID del campo ef-fatt-num
           when 78-ID-ef-fatt-num
                perform CONTROLLO
           |78-ID-ef-fatt-data è l'ID del campo ef-fatt-data
           when 78-ID-ef-fatt-data
                perform CONTROLLO
           |78-ID-ef-consumo-FTMA è l'ID del campo ef-consumo-FTMA
           when 78-ID-ef-consumo-FTMA
                perform CONTROLLO
           |78-ID-ef-coubat-FTMA è l'ID del campo ef-coubat-FTMA
           when 78-ID-ef-coubat-FTMA
                perform CONTROLLO
           |78-ID-ef-add-FTMA è l'ID del campo ef-add-FTMA
           when 78-ID-ef-add-FTMA
                perform CONTROLLO
           |78-ID-ef-art è l'ID del campo ef-art
           when 78-ID-ef-art
                perform CONTROLLO
           |78-ID-ef-qta è l'ID del campo ef-qta
           when 78-ID-ef-qta
                perform CONTROLLO
           |78-ID-ef-prz è l'ID del campo ef-prz
           when 78-ID-ef-prz
                perform CONTROLLO
           |78-ID-ef-consumo è l'ID del campo ef-consumo
           when 78-ID-ef-consumo
                perform CONTROLLO
           |78-ID-ef-coubat è l'ID del campo ef-coubat
           when 78-ID-ef-coubat
                perform CONTROLLO
           |78-ID-ef-add è l'ID del campo ef-add
           when 78-ID-ef-add
                perform CONTROLLO
           |78-ID-ef-iva è l'ID del campo ef-iva
           when 78-ID-ef-iva
                perform CONTROLLO
           |99999 è un valore fittizio, che non sarà MAI usato,
           |ma mi serve per non riscontrare errori di compilazione
           |in caso non avessi generato nulla nella AFTER CONTROLLO della screen
           when 99999 continue
           when other continue
           end-evaluate.



       Screen1-Ta-1-TABCHANGE.
           MOVE 0 TO 
                   Screen1-Pg-1-Visible,
                   Screen1-Pg-2-Visible,
           EVALUATE Screen1-Ta-1-TAB-VALUE
           WHEN 1
                  MOVE 1 TO Screen1-Pg-1-Visible
                  MODIFY Screen1-Ta-1, VALUE = 1
           WHEN 2
                  MOVE 1 TO Screen1-Pg-2-Visible
                  MODIFY Screen1-Ta-1, VALUE = 2
           END-EVALUATE
           MOVE 1 TO CONTROL-ID
           DISPLAY Form1
           .

       Form1-BeforeProcedure.
           EVALUATE Control-Id
           WHEN 5001 MOVE "Digitare il codice cliente" to 
           TOTEM-HINT-TEXT
           WHEN 5002 MOVE "Digitare il progressivo per il destino" to 
           TOTEM-HINT-TEXT
           WHEN 5003 MOVE "Digitare il codice agente" to TOTEM-HINT-TEXT
           WHEN 5004 MOVE "Digitare il Codice Pagamento" to 
           TOTEM-HINT-TEXT
           WHEN 5005 MOVE "Digitare il Codice IVA" to TOTEM-HINT-TEXT
           WHEN 5006 MOVE "Digitare la contropartita contabile del docum
      -    "ento" to TOTEM-HINT-TEXT
           WHEN 5007 MOVE "Digitare le note" to TOTEM-HINT-TEXT
           WHEN 5008 MOVE "Selezionare uno stato" to TOTEM-HINT-TEXT
           WHEN 5009 MOVE "Fattura di riferimento (obbligatorio per EDI)
      -    "" to TOTEM-HINT-TEXT
           WHEN 5010 MOVE "Fattura di riferimento (obbligatorio per EDI)
      -    "" to TOTEM-HINT-TEXT
           WHEN 5012 MOVE "Digitare la descrizione della voce" to 
           TOTEM-HINT-TEXT
           WHEN 5013 MOVE "Digitare l'importo" to TOTEM-HINT-TEXT
           WHEN 5014 MOVE "Digitare l'imposta di consumo" to 
           TOTEM-HINT-TEXT
           WHEN 5015 MOVE "Digitare l'imposta COU/COBAT" to 
           TOTEM-HINT-TEXT
           WHEN 5016 MOVE "Digitare l'addizionale piombo" to 
           TOTEM-HINT-TEXT
           WHEN 5017 MOVE "Digitare il codice IVA" to TOTEM-HINT-TEXT
           WHEN 5018 MOVE "Digitare il codice dell'articolo" to 
           TOTEM-HINT-TEXT
           WHEN 5019 MOVE "Digitare la quantit" to TOTEM-HINT-TEXT
           WHEN 5020 MOVE "Digitare il prezzo" to TOTEM-HINT-TEXT
           WHEN 5021 MOVE "Digitare l'imposta di consumo" to 
           TOTEM-HINT-TEXT
           WHEN 5022 MOVE "Digitare l'imposta COU/COBAT" to 
           TOTEM-HINT-TEXT
           WHEN 5023 MOVE "Digitare l'addizionale piombo" to 
           TOTEM-HINT-TEXT
           WHEN 5024 MOVE "Digitare il codice IVA" to TOTEM-HINT-TEXT
           WHEN OTHER MOVE SPACES TO TOTEM-HINT-TEXT
           END-EVALUATE
           EVALUATE Control-Id
           When 5001 PERFORM ef-cli-BeforeProcedure
           When 5002 PERFORM ef-des-BeforeProcedure
           When 5003 PERFORM ef-age-BeforeProcedure
           When 5004 PERFORM ef-pag-BeforeProcedure
           When 5005 PERFORM ef-iva-ese-BeforeProcedure
           When 5006 PERFORM Screen1-DaEf-1-BeforeProcedure
           When 5007 PERFORM ef-note-BeforeProcedure
           When 5008 PERFORM cbo-stato-BeforeProcedure
           When 5009 PERFORM Screen1-DaEf-1-BeforeProcedure
           When 5010 PERFORM Screen1-DaEf-1-BeforeProcedure
           When 5012 PERFORM ef-descr-BeforeProcedure
           When 5013 PERFORM ef-prz-FTMA-BeforeProcedure
           When 5014 PERFORM ef-consumo-FTMA-BeforeProcedure
           When 5015 PERFORM ef-coubat-FTMA-BeforeProcedure
           When 5016 PERFORM ef-add-FTMA-BeforeProcedure
           When 5017 PERFORM ef-iva-FTMA-BeforeProcedure
           When 5018 PERFORM ef-art-BeforeProcedure
           When 5019 PERFORM ef-qta-BeforeProcedure
           When 5020 PERFORM ef-prz-BeforeProcedure
           When 5021 PERFORM ef-consumo-BeforeProcedure
           When 5022 PERFORM ef-coubat-BeforeProcedure
           When 5023 PERFORM ef-add-BeforeProcedure
           When 5024 PERFORM ef-iva-BeforeProcedure
           END-EVALUATE
           PERFORM Form1-DISPLAY-STATUS-MSG
           perform Form1-BEFORE-SCREEN
           .

       Form1-AfterProcedure.
           EVALUATE Control-Id
           When 5001 PERFORM ef-cli-AfterProcedure
           When 5002 PERFORM ef-des-AfterProcedure
           When 5003 PERFORM ef-age-AfterProcedure
           When 5004 PERFORM ef-pag-AfterProcedure
           When 5005 PERFORM ef-iva-ese-AfterProcedure
           When 5006 PERFORM Screen1-DaEf-1-AfterProcedure
           When 5007 PERFORM ef-note-AfterProcedure
           When 5009 PERFORM Screen1-DaEf-1-AfterProcedure
           When 5010 PERFORM Screen1-DaEf-1-AfterProcedure
           END-EVALUATE
           perform Form1-AFTER-SCREEN
           .

       Screen1-Event-Proc.
           .

       Screen1-Ta-1-Event-Proc.
           EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
           WHEN Cmd-Tabchanged ALSO 1 ALSO
                    Form1-handle
              PERFORM Screen1-Ta-1-Ev-Cmd-Tabchanged
           END-EVALUATE
           .

       form1-gd-1-Event-Proc.
           EVALUATE Event-Type ALSO Event-Control-Id ALSO
                                    Event-Window-Handle
           WHEN Msg-Begin-Drag ALSO 5011 ALSO
                    Form1-handle 
              PERFORM form1-gd-1-Ev-Msg-Begin-Drag
           WHEN Msg-Begin-Entry ALSO 5011 ALSO
                    Form1-handle 
              PERFORM form1-gd-1-Ev-Msg-Begin-Entry
           WHEN Msg-End-Drag ALSO 5011 ALSO
                    Form1-handle 
              PERFORM form1-gd-1-Ev-Msg-End-Drag
           WHEN Msg-Goto-Cell ALSO 5011 ALSO
                    Form1-handle 
              PERFORM form1-gd-1-Ev-Msg-Goto-Cell
           WHEN Msg-Goto-Cell-Drag ALSO 5011 ALSO
                    Form1-handle 
              PERFORM form1-gd-1-Ev-Msg-Goto-Cell-Drag
           WHEN Msg-Goto-Cell-Mouse ALSO 5011 ALSO
                    Form1-handle 
              PERFORM form1-gd-1-Ev-Msg-Goto-Cell-Mouse
           END-EVALUATE
           .

      * USER DEFINE PARAGRAPH
       ABILITAZIONI.
      * <TOTEM:PARA. ABILITAZIONI>
           modify tool-modifica,   value 1.
           move BitmapNewDisabled     to BitmapNumNew.
           move BitmapDeleteDisabled  to BitmapNumDelete.
           move BitmapEditDisabled    to BitmapNumEdit.
           move BitmapPrintDisabled   to BitmapNumPrint.
           move BitmapPreviewDisabled to BitmapNumPreview.
           move BitmapSelectDisabled  to BitmapNumSelect.

           if livello-abil > 1 move BitmapSaveEnabled  to BitmapNumSave
                               move 1                  to e-salva
           else                move BitmapSaveDisabled to BitmapNumSave
                               move 0                  to e-salva
           end-if.

           move 0 to e-cancella 
                     e-anteprima 
                     e-stampa 
                     e-nuovo
                     e-seleziona
                     e-modifica.

           if e-cerca = 0 move BitmapZoomDisabled to BitmapNumZoom
           else           move BitmapZoomEnabled  to BitmapNumZoom
           end-if.

           inquire cbo-stato,   value cbo-stato-buf
           if cbo-stato-buf not = "Disattivo" move 1 to mod
           else                               move 0 to mod
           end-if.

           perform DISPLAY-SCREEN.
                                                      
           modify tool-nuovo,     enabled = e-nuovo,
                                  bitmap-number = BitmapNumNew.
           modify tool-cancella,  enabled = e-cancella,
                                  bitmap-number = BitmapNumDelete.
           modify tool-modifica,  enabled = e-modifica,
                                  bitmap-number = BitmapNumEdit.
           modify tool-anteprima, enabled = e-anteprima,
                                  bitmap-number = BitmapNumPreview.
           modify tool-stampa,    enabled = e-stampa,
                                  bitmap-number = BitmapNumPrint.
           modify tool-seleziona, enabled = e-seleziona,
                                  bitmap-number = BitmapNumSelect.
           modify tool-salva,     enabled = e-salva,
                                  bitmap-number = BitmapNumSave.  
           modify tool-cerca,     enabled = e-cerca,
                                  bitmap-number = BitmapNumZoom 
           .
      * <TOTEM:END>

       AGGIORNA-BOZZA.
      * <TOTEM:PARA. AGGIORNA-BOZZA>
           string   "La Bozza di partenza risulta"
             x"0d0a""in uso su altro terminale."
             x"0d0a""Questo comporta l'impossibilità"
             x"0d0a""ad aggiornarne lo stato." delimited size
                 into geslock-messaggio
           end-string.
           set RecLocked to false.

           move FatChiave to btno-chiave.
           perform until 1 = 2
              set RecLocked to false
              close btnotacr
              open i-o btnotacr
              read btnotacr lock invalid continue end-read
              if RecLocked
                 move "BTNOTACR" to geslock-nome-file
                 move 1 to geslock-v-riprova
                 move 0 to geslock-v-ignora
                 move 0 to geslock-v-termina
                 call   "geslock" using geslock-linkage
                 cancel "geslock"
              else
                 move tor-data-ordine  to btno-data-fm
                 move tor-numero       to btno-num-fm
                 move tor-anno         to btno-anno-fm
                 rewrite btno-rec invalid continue end-rewrite
                 unlock  btnotacr all records
                 close   btnotacr
                 open input btnotacr
                 exit perform
              end-if
           end-perform 
           .
      * <TOTEM:END>

       BEFORE-CAMPI.
      * <TOTEM:PARA. BEFORE-CAMPI>
           evaluate control-id
           when 78-ID-ef-qta
           when 78-ID-ef-prz
           when 78-ID-ef-consumo
           when 78-ID-ef-coubat
           when 78-ID-ef-add
           when 78-ID-ef-iva
                inquire ef-art, value in art-codice
                if art-codice = 0
                   perform CANCELLA-COLORE
                   move 78-ID-ef-art to control-id
                   move 4            to accept-control
                end-if
                if ef-iva-ese-buf not = spaces
                   modify ef-iva, read-only
                else
                   modify ef-iva, not read-only
                end-if

           when 78-ID-ef-iva-FTMA
                if ef-iva-ese-buf not = spaces
                   modify ef-iva-FTMA, read-only
                else
                   modify ef-iva-FTMA, not read-only
                end-if
           end-evaluate 
           .
      * <TOTEM:END>

       CARICA-GRID.
      * <TOTEM:PARA. CARICA-GRID>
           inquire form1-gd-1, cursor-y in store-riga.
           move 0 to LastPrg.
           perform RESET-GRIGLIA.

           modify form1-gd-1, mass-update = 1.
           move low-value  to ror-rec.
           move tor-chiave to ror-chiave.
           start rordini key is >= ror-chiave
                 invalid continue
             not invalid
                 move 2 to riga
OMAGGI           move 0 to righe-di-cui-omaggi
                 perform until 1 = 2
                    read rordini      next no lock at end exit perform 
                    end-read
                    if ror-anno       not = tor-anno or
                       ror-num-ordine not = tor-numero
                       exit perform
                    end-if
LUBEXX              perform AGGIUNGI-RIGA
OMAGGI              if ror-qta-omaggi not = 0
OMAGGI                 add  1                to righe-di-cui-omaggi
OMAGGI                 move ror-qta-omaggi   to ror-qta
OMAGGI                 move 0                to ror-prz-unitario
OMAGGI                 move 0                to ror-perce-sconto
OMAGGI                 move 0                to ror-imp-consumo
OMAGGI                 move 0                to ror-imp-cou-cobat
OMAGGI                 move 0                to ror-add-piombo
OMAGGI                 move 0                to ror-imponib-merce
OMAGGI                 move tge-cod-iva-omag to ror-cod-iva
OMAGGI                 set  ror-si-omaggio   to true
OMAGGI                 perform AGGIUNGI-RIGA
OMAGGI              end-if
                 end-perform
           end-start.
           modify  form1-gd-1, mass-update = 0.
           move store-riga to riga.
           modify form1-gd-1, cursor-y = riga.
           perform SPOSTAMENTO.

      ***---
       AGGIUNGI-RIGA.
OMAGGI     add  righe-di-cui-omaggi to ror-num-riga.      
           move ror-num-riga        to col-riga LastPrg.
           move ror-cod-articolo    to col-codice art-codice.

           if LinkFTMA
              move ror-des-libera to col-descr
           else
              read articoli no lock invalid continue end-read
              move art-descrizione   to col-descr
           end-if.

           if LinkCostoMedio
              initialize prg-rec replacing numeric data by zeroes
                                      alphanumeric data by spaces
              move ror-prg-cod-articolo to prg-cod-articolo
              read progmag no lock 
                   invalid move 0 to costo-mp
               not invalid perform CALCOLA-COSTO-MP
              end-read
      *****        move costo-mp to ror-prz-unitario
              move costo-mp to ror-imponib-merce
           end-if.

           move ror-qta           to col-quantita.
      *****     move ror-prz-unitario  to col-prezzo.
           move ror-imponib-merce to col-prezzo.
           move ror-imp-consumo   to col-consumo.
           move ror-imp-cou-cobat to col-coubat. 
           move ror-add-piombo    to col-add.
           move ror-cod-iva       to col-cod-iva.

           modify form1-gd-1(riga, 1), cell-data = col-riga.
           if LinkFTTR or LinkFTND
              modify form1-gd-1(riga, 2), cell-data = col-codice
           end-if.
           modify form1-gd-1(riga, 3), cell-data = col-descr.
           modify form1-gd-1(riga, 4), cell-data = col-quantita.
           modify form1-gd-1(riga, 5), cell-data = col-prezzo.
           modify form1-gd-1(riga, 6), cell-data = col-consumo.
           modify form1-gd-1(riga, 7), cell-data = col-coubat.
           modify form1-gd-1(riga, 8), cell-data = col-add.
           modify form1-gd-1(riga, 9), cell-data = col-cod-iva.

           move ror-prg-chiave    to HiddenKey.

           move ror-qta           to hid-old-qta.
           move ror-prz-unitario  to hid-old-prz.
           move ror-imp-consumo   to hid-old-consumo.
           move ror-imp-cou-cobat to hid-old-coubat.
           move ror-add-piombo    to hid-old-piombo.
           move ror-cod-iva       to hid-old-iva.
           move ror-peso-utf      to hid-peso-utf.
           move ror-peso-non-utf  to hid-peso-non-utf.

           modify form1-gd-1(riga, 1)hidden-data = HiddenValori.
           modify form1-gd-1(riga, 2)hidden-data = HiddenKey.
           add 1 to riga 
           .
      * <TOTEM:END>

       CARICA-GRID-BOZZA.
      * <TOTEM:PARA. CARICA-GRID-BOZZA>
           inquire form1-gd-1, cursor-y in store-riga.
           move 0 to LastPrg.
           perform RESET-GRIGLIA.

           modify form1-gd-1,  mass-update = 1.
           move  low-value     to brno-rec.
           move  btno-chiave   to brno-chiave.
           set   brno-addebito to true.
           start brnotacr key  is >= brno-chiave
                 invalid continue
             not invalid
                 move 2 to riga
                 perform until 1 = 2
                    read brnotacr  next no lock 
                         at end exit perform 
                    end-read
                    if brno-anno   not = btno-anno   or
                       brno-numero not = btno-numero or
                       brno-nota                     or
                       brno-merce-rotta
                       exit perform
                    end-if
LUBEXX              perform AGGIUNGI-RIGA-BOZZA
                 end-perform
           end-start.
           modify  form1-gd-1, mass-update = 0.
           move store-riga to riga.
           modify form1-gd-1, cursor-y = riga.
           perform SPOSTAMENTO.

      ***---
       AGGIUNGI-RIGA-BOZZA.
           move brno-num-riga        to col-riga LastPrg.
           move brno-cod-articolo    to col-codice art-codice.

           read articoli no lock invalid continue end-read.
           move art-descrizione   to col-descr.

           if LinkCostoMedio
              initialize prg-rec replacing numeric data by zeroes
                                      alphanumeric data by spaces
              move brno-prg-cod-articolo to prg-cod-articolo
              read progmag no lock 
                   invalid move 0 to costo-mp
               not invalid perform CALCOLA-COSTO-MP
              end-read
              move costo-mp to brno-imponib-merce
           end-if.

           move brno-qta           to col-quantita.
           move brno-imponib-merce to col-prezzo.
           move brno-imp-consumo   to col-consumo.
           move brno-imp-cou-cobat to col-coubat. 
           move brno-add-piombo    to col-add.
           move brno-cod-iva       to col-cod-iva.

           modify form1-gd-1(riga, 1), cell-data = col-riga.
           if LinkFTTR or LinkFTND
              modify form1-gd-1(riga, 2), cell-data = col-codice
           end-if.
           modify form1-gd-1(riga, 3), cell-data = col-descr.
           modify form1-gd-1(riga, 4), cell-data = col-quantita.
           modify form1-gd-1(riga, 5), cell-data = col-prezzo.
           modify form1-gd-1(riga, 6), cell-data = col-consumo.
           modify form1-gd-1(riga, 7), cell-data = col-coubat.
           modify form1-gd-1(riga, 8), cell-data = col-add.
           modify form1-gd-1(riga, 9), cell-data = col-cod-iva.

           move brno-prg-chiave    to HiddenKey.

           move brno-qta           to hid-old-qta.
           move brno-prz-unitario  to hid-old-prz.
           move brno-imp-consumo   to hid-old-consumo.
           move brno-imp-cou-cobat to hid-old-coubat.
           move brno-add-piombo    to hid-old-piombo.
           move brno-cod-iva       to hid-old-iva.
           move brno-peso-utf      to hid-peso-utf.
           move brno-peso-non-utf  to hid-peso-non-utf.

           modify form1-gd-1(riga, 1)hidden-data = HiddenValori.
           modify form1-gd-1(riga, 2)hidden-data = HiddenKey.
           add 1 to riga 
           .
      * <TOTEM:END>

       CERCA.
      * <TOTEM:PARA. CERCA>
           evaluate control-id

           when 78-ID-ef-cli
                set cli-tipo-c        to true
                move "clienti-all"    to como-file         
                inquire ef-cli, value in cli-codice
                call "zoom-gt"  using como-file, cli-rec
                               giving stato-zoom
                end-call
                cancel "zoom-gt"

                if stato-zoom = 0
                   move cli-codice     to ef-cli-buf
                   inspect ef-cli-buf replacing leading x"30" by x"20"
                   call "C$JUSTIFY" using ef-cli-buf, "L"
                   move cli-ragsoc-1   to lab-cli-buf
                   move cli-indirizzo  to lab-ind-buf
                   move cli-localita   to lab-loca-buf
                   display ef-cli lab-cli lab-ind lab-loca
                end-if                  
      
           when 78-ID-ef-des
                inquire ef-cli, value in des-codice
                inquire ef-des, value in des-prog
                set cli-tipo-c        to true
                move "clienti-des"    to como-file
                call "zoom-gt"  using como-file, des-rec
                               giving stato-zoom
                end-call
                cancel "zoom-gt"
                if stato-zoom = 0                  
                   move des-prog     to ef-des-buf      
                   inspect ef-des-buf replacing leading x"30" by x"20"
                   call "C$JUSTIFY" using ef-des-buf, "L"
                   move des-ragsoc-1   to lab-des-buf
                   move des-indirizzo  to lab-ind-d-buf
                   move des-localita   to lab-loca-d-buf
                   display ef-des lab-des lab-ind-d lab-loca-d
                end-if
      
           when 78-ID-ef-age
                move "agenti"    to como-file         
                inquire ef-age,  value in age-codice
                call "zoom-gt"   using como-file, age-rec
                                giving stato-zoom
                end-call
                cancel "zoom-gt"
                if stato-zoom = 0
                   move age-codice   to ef-age-buf
                   move age-ragsoc-1 to lab-age-buf
                   display ef-age lab-age
                end-if

           when 78-ID-ef-iva-ese
                move "tivaese-ese" to como-file
                move "IV"          to tbliv-codice1
                inquire ef-iva-ese,value in tbliv-codice2
                call "zoom-gt"   using como-file, record-tbliv
                                giving stato-zoom
                end-call
                cancel "zoom-gt"
                if stato-zoom = 0
                   move tbliv-codice2   to ef-iva-ese-buf
                   perform MOVE-DESCR-IVA
                   display ef-iva-ese lab-iva
                end-if

           when 78-ID-ef-pag
                move "tcodpag"   to como-file         
                move "PA"        to tblpa-codice1
                inquire ef-pag,  value in tblpa-codice2
                call "zoom-gt"   using como-file, record-tblpa
                                giving stato-zoom
                end-call
                cancel "zoom-gt"
                if stato-zoom = 0
                   move tblpa-codice2   to ef-pag-buf
                   perform MOVE-DESCR-PAG
                   display ef-pag lab-pag
                end-if

           when 78-ID-ef-piano
                move "MAS" to como-file
                inquire ef-piano,value in mas-codice
                call "zoom-gt"   using como-file, record-mas
                                giving stato-zoom
                end-call
                cancel "zoom-gt"
                if stato-zoom = 0
                   move mas-codice to ef-piano-buf
                   perform MOVE-DESCR-PIANO
                   display ef-piano lab-piano
                end-if
      
           when 78-ID-ef-art
                move "progmag-sons"   to como-file
                inquire ef-art  value in prg-cod-articolo
                move tca-cod-magaz    to prg-cod-magazzino
                call "zoom-gt"     using como-file, prg-rec
                                  giving stato-zoom
                end-call
                cancel "zoom-gt"
                if stato-zoom = 0
                   move prg-chiave       to HiddenKey
                   move prg-cod-articolo to ef-art-buf
                   display ef-art
                end-if
                move 4 to accept-control

           when 78-ID-ef-iva-FTMA
                inquire ef-iva-FTMA, value in tbliv-codice2
                perform ZOOM-IVA
                if stato-zoom = 0
                   move tbliv-codice2   to ef-iva-FTMA-buf
                   display ef-iva-FTMA
                end-if

           when 78-ID-ef-iva
                inquire ef-iva,      value in tbliv-codice2
                perform ZOOM-IVA
                if stato-zoom = 0
                   move tbliv-codice2   to ef-iva-buf
                   display ef-iva
                end-if
           end-evaluate.

      ***---
       ZOOM-IVA.
           move "tivaese"   to como-file.
           move "IV"        to tbliv-codice1.
           call "zoom-gt"   using como-file, record-tbliv
                           giving stato-zoom
           end-call.
           cancel "zoom-gt" 
           .
      * <TOTEM:END>

       CHANGE-STATUS.
      * <TOTEM:PARA. CHANGE-STATUS>
           evaluate nome-file
           when "clienti"
                set disattivo to true
                perform CARICA-COMBO-STATO
                |specifico per i pgm. aventi Tab-Control
                move 1 to Screen1-Ta-1-TAB-VALUE
                perform SCREEN1-TA-1-TABCHANGE
                |******
                move 0 to mod
                perform DISPLAY-SCREEN
           end-evaluate 
           .
      * <TOTEM:END>

       CHANGE-TAB.
      * <TOTEM:PARA. CHANGE-TAB>
           set NonCambiareTab   to false.
           set ArticoloSetFocus to false.
           set ControllaCampi   to true.
           set CheckDestini     to true.
           move 0 to v-bozza.
      
           evaluate event-data-1
           when 1
                move 0 to v-FTTR
                move 0 to v-FTMA
                set ControllaCampi   to false
                if LinkBozzaMan      and
                   FatAnno   not = 0 and
                   FatNumero not = 0
                   move 1 to v-bozza
                end-if
           when 2
                set CheckDestini to false
                perform CHECK-PAGE-1
                if tutto-ok
                   if PrimaVolta
                      move 2 to event-data-2
                      perform SPOSTAMENTO
                      set PrimaVolta to false
                   end-if
                   if ef-iva-ese-buf not = spaces
                      modify ef-iva,     read-only
                   else
                      modify ef-iva, not read-only
                   end-if
                   move 0 to v-FTTR
                   move 0 to v-FTMA
                   evaluate true
                   when LinkFTTR 
                   when LinkFTND move 1 to v-FTTR
                   when LinkFTMA move 1 to v-FTMA
                   end-evaluate
                   perform CANCELLA-COLORE
                   modify pb-nuovo,   bitmap-number = 5
                   modify pb-elimina, bitmap-number = 4
                   modify pb-iva,     bitmap-number = 2
                   set ArticoloSetFocus    to true
                else
                   set ControllaCampi to false
                   move store-id to CONTROL-ID    
                   move 4        to ACCEPT-CONTROL
                   set NonCambiareTab to true
                end-if
           end-evaluate.
      
           display Screen1-Ta-1 
           .
      * <TOTEM:END>

       CHECK-PAGE-1.
      * <TOTEM:PARA. CHECK-PAGE-1>
           perform  varying control-id from 78-ID-ef-cli by 1
                      until control-id    > 78-ID-ef-fatt-data
              if control-id = 78-ID-cbo-stato
                 continue |LO FA DOPO 
              else
                 perform CONTROLLO
                 if errori 
                    exit perform 
                 end-if
              end-if
           end-perform            
           .
      * <TOTEM:END>

       CLEAR-SCREEN.
      * <TOTEM:PARA. CLEAR-SCREEN>
           move spaces to ef-cli-buf 
                          lab-cli-buf lab-ind-buf lab-loca-buf
                                      ef-fatt-num-buf.
           move spaces to  ef-des-buf
                          lab-des-buf lab-ind-d-buf lab-loca-d-buf
                          lab-piano-buf ef-piano-buf.

           move 0 to ef-age-buf tor-cod-cli tor-prg-destino 
           ef-fatt-data-buf.

           move spaces to lab-age-buf lab-iva-buf lab-pag-buf 
                          ef-note-buf ef-pag-buf ef-iva-ese-buf 
           .
      * <TOTEM:END>

       CONTA-CODICI-IVA.
      * <TOTEM:PARA. CONTA-CODICI-IVA>
           inquire form1-gd-1, last-row in tot-righe.
           move 0 to num-codici-iva.
           move 1 to idx.
           move spaces to cod-iva(1).
           move spaces to cod-iva(2).
           move spaces to cod-iva(3).
           perform varying riga from 2 by 1
                     until riga > tot-righe
              set trovato to false
              inquire form1-gd-1(riga, 9), cell-data in col-cod-iva
              perform varying idx from 1 by 1
                        until idx > 3
                 if col-cod-iva = cod-iva(idx)
                    set trovato to true
                    exit perform
                 end-if
              end-perform
              if not trovato
                 add 1 to num-codici-iva
                 perform varying idx from 1 by 1
                           until idx > 3
                    if cod-iva(idx) = spaces
                       move col-cod-iva to cod-iva(idx)
                       exit perform
                    end-if
                 end-perform
              end-if
              if num-codici-iva > 3 
                 set errori to true
                 exit perform 
              end-if
           end-perform 
           .
      * <TOTEM:END>

       CONTA-RIGHE.
      * <TOTEM:PARA. CONTA-RIGHE>
           set trovato to false.

           inquire form1-gd-1, last-row in tot-righe.
           if tot-righe > 1 set trovato to true end-if 
           .
      * <TOTEM:END>

       CONTROLLA-PERCENTUALE-IVA.
      * <TOTEM:PARA. CONTROLLA-PERCENTUALE-IVA>
           move "IV"        to tbliv-codice1.
           move ror-cod-iva to tbliv-codice2.
           read tivaese no lock 
                invalid continue
            not invalid
                if tbliv-percentuale not = 0
                   set EsisteIVA to true
                end-if
           end-read 
           .
      * <TOTEM:END>

       CONTROLLA-TOTALE.
      * <TOTEM:PARA. CONTROLLA-TOTALE>
           move 0 to Sum.
           inquire form1-gd-1, last-row in tot-righe.
           perform varying store-riga from 2 by 1 
                     until store-riga > tot-righe
              inquire form1-gd-1(store-riga, 5), cell-data in SavePrezzo
              add SavePrezzo to Sum
           end-perform.
           if Sum = 0
              if TotaleNoZero set errori to true end-if
           else
              if TotaleSiZero set errori to true end-if
           end-if 
           .
      * <TOTEM:END>

       CONTROLLO.
      * <TOTEM:PARA. CONTROLLO>
           set tutto-ok to true. 
           if not ControllaCampi
              set ControllaCampi to true
              exit paragraph
           end-if.
           inquire form1-gd-1, last-row in tot-righe.
           if tot-righe = 1 and riga-nuova = 1
              move 2 to tot-righe
           end-if.
      
      * Paragrafo per la struttura dei controlli sulla screen Screen1
           evaluate control-id
           |78-ID-ef-cli è l'ID del control ef-cli
           when 78-ID-ef-cli
                inquire ef-cli, value in ef-cli-buf 
                if ef-cli-buf not = spaces
                   inspect ef-cli-buf replacing trailing spaces 
                                                         by low-values
                   initialize CountChar
                   inspect ef-cli-buf tallying CountChar for characters 
                                                      before low-value
                   inspect ef-cli-buf replacing trailing low-values 
                                                         by spaces
                   | SE E' NUMERICO LEGGO IL RECORD NORMALMENTE
                   if ef-cli-buf(1:CountChar) is numeric
                      perform SELEZIONA-NUMERICO
                   else                     
                      | HO DIGITATO UNA SIGLA ALFANUMERICA QUINDI 
                      | APRO LO ZOOM (CASE SENSITIVE)
                      perform SELEZIONA-ALFA
                   end-if
                else
                   set errori to true  
                   move 78-ID-ef-cli to control-id
                   display message "Inserimento codice cliente mancante"
                           title = tit-err
                           icon mb-warning-icon
                   initialize cli-rec
                end-if
                move cli-ragsoc-1    to lab-cli-buf
                move cli-indirizzo   to lab-ind-buf
                move cli-localita    to lab-loca-buf
                display lab-cli lab-ind lab-loca
                if tutto-ok
                   inquire ef-pag, value in ef-pag-buf
                   if ef-pag-buf = spaces
                      initialize record-tblpa
                      move "PA"    to tblpa-codice1
                      move cli-pag to tblpa-codice2 ef-pag-buf
                      read tcodpag invalid continue end-read
                      perform MOVE-DESCR-PAG
                      display lab-pag ef-pag
                   end-if

                   inquire ef-iva-ese, value in ef-iva-ese-buf
                   if ef-iva-ese-buf = spaces
                      initialize record-tbliv
                      move "IV"        to tbliv-codice1
                      move cli-iva-ese to tbliv-codice2 ef-iva-ese-buf
                      read tivaese invalid continue end-read
                      perform MOVE-DESCR-IVA
                      display lab-iva ef-iva-ese
                   end-if
                   
                   if cli-disattivo or cli-bloccato
                      set errori to true
                      display message "Cliente non attivo"
                                title tit-err
                                 icon 2
                   end-if
                   
                end-if
      
           |78-ID-ef-des è l'ID del control ef-des
           when 78-ID-ef-des
                inquire ef-des, value in ef-des-buf
                inquire ef-cli, value in ef-cli-buf
                if ef-des-buf not = spaces
                   inspect ef-des-buf replacing trailing spaces 
                                                         by low-values
                   initialize CountChar
                   inspect ef-des-buf tallying CountChar for characters 
                                                       before low-value
                   inspect ef-des-buf replacing trailing low-values 
                                                         by spaces
      
                   | SE E' NUMERICO LEGGO IL RECORD NORMALMENTE
                   if ef-des-buf(1:CountChar) is numeric
                      perform SELEZIONA-DESTINO-NUMERICO
                   else                     
                      | HO DIGITATO UNA SIGLA ALFANUMERICA QUINDI 
                      | APRO LO ZOOM (CASE SENSITIVE)
                      perform SELEZIONA-DESTINO-ALFA
                   end-if  
                   display lab-des
                   display lab-ind-d
                   display lab-loca-d
                else
                   if CheckDestini
                      perform TROVA-DESTINO
                      if trovato
                         display message "Esiste uno o più destini per"
                                          " il cliente specificato."
                                  x"0d0a""Procedere comunque con "
                                          "progressivo non valorizzato?"
                                 title = titolo
                                  type mb-yes-no
                                giving scelta 
                         initialize des-rec
                         if scelta = mb-no
                            set errori to true
                            move 78-ID-ef-des to control-id
                            initialize des-rec
                         end-if
                      else
                         initialize des-rec
                      end-if
                   else
                      set CheckDestini to true
                   end-if
                end-if
                move des-ragsoc-1    to lab-des-buf
                move des-indirizzo   to lab-ind-d-buf
                move des-localita    to lab-loca-d-buf
                display lab-des lab-ind-d lab-loca-d

                if des-disattivo or des-bloccato
                   set errori to true
                   display message "Destino non attivo"
                             title tit-err
                              icon 2
                end-if
      
           |78-ID-ef-age è l'ID del control ef-age
           when 78-ID-ef-age
                inquire ef-age, value in ef-age-buf
                move ef-age-buf to age-codice
                read agenti no lock
                     invalid
                     move spaces to age-ragsoc-1
                     display message "Codice Agente NON valido!"
                             title = tit-err
                             icon  2
                     set errori to true
                end-read
                move age-ragsoc-1 to lab-age-buf
                display lab-age
      
           |78-ID-ef-pag è l'ID del control ef-pag
           when 78-ID-ef-pag
                inquire ef-pag, value in ef-pag-buf
                move "PA"       to tblpa-codice1
                move ef-pag-buf to tblpa-codice2
                read tcodpag no lock
                     invalid
                     move spaces to tblpa-descrizione2 
                                    tblpa-descrizione2
                     display message box "Codice Pagamento NON valido"
                             title = tit-err
                             icon  2
                     set errori to true
                end-read
                perform MOVE-DESCR-PAG
                display lab-pag     
      
           |78-ID-ef-iva-ese è l'ID del control ef-iva-ese
           when 78-ID-ef-iva-ese
                move spaces  to tbliv-descrizione2 
                                tbliv-descrizione2
                inquire ef-iva-ese, value in ef-iva-ese-buf
                if ef-iva-ese-buf      not = spaces
                   move "IV"           to tbliv-codice1
                   move ef-iva-ese-buf to tbliv-codice2
                   read tivaese no lock
                        invalid
                        set errori  to true
                        display message box "Codice IVA NON valido"
                                title = tit-err
                                icon  2
                    not invalid
                        if tbliv-percentuale not = 0
                           set errori to true        
                           display message box "Codice IVA NON valido "
                                               "in quanto non esente"
                                   title = tit-err
                                   icon mb-warning-icon
                        end-if
                   end-read
                   perform MOVE-DESCR-IVA
                else
                   move spaces to lab-iva-buf
                end-if
                display lab-iva

           |78-ID-ef-piano è l'ID del control ef-piano
           when 78-ID-ef-piano
                initialize mas-descrizione1 mas-descrizione2
                inquire ef-piano, value in ef-piano-buf
                if ef-piano-buf = spaces
                   move spaces to lab-piano-buf
                   move tca-contropartita to ef-piano-buf
                   display ef-piano lab-piano
                end-if
                move ef-piano-buf to mas-codice
                read mas no lock
                     invalid
                     set errori   to true
                     display message box "Contropartita NON valida"
                             title = tit-err
                             icon  2
                end-read
                perform MOVE-DESCR-PIANO
                display lab-piano ef-piano
      
           |78-ID-ef-note è l'ID del control ef-note
           when 78-ID-ef-note
                inquire ef-note, value in ef-note-buf
                if ef-note-buf = spaces
                   display message box "Intestazione obbligatoria"
                           title = tit-err
                           icon  2
                   set errori to true
                end-if
      
           |78-ID-cbo-stato è l'ID del control cbo-stato
           when 78-ID-cbo-stato
                inquire cbo-stato, value in cbo-stato-buf
                perform SCARICA-COMBO-STATO
                move stato   to  tor-stato
                if tor-stato not = old-tor-stato
                   move 1 to Passwd-password
                   call   "passwd" using Passwd-linkage
                   cancel "passwd"

                   if not Passwd-StatusOk
                      move old-tor-stato to stato
                      perform CARICA-COMBO-STATO
                      set errori         to true
                   else
                      if disattivo
                         move control-id to store-id
                         move "clienti" to nome-file
                         perform CHANGE-STATUS
                         move store-id to control-id
                      end-if
                   end-if
                end-if
      *****
           |78-ID-ef-descr è l'ID del control ef-descr
           when 78-ID-ef-descr
                if v-FTMA = 1 and tot-righe > 1
                   inquire ef-descr, value in ef-descr-buf
                   if ef-iva-ese-buf not = spaces
                      move ef-iva-ese-buf to ef-iva-FTMA-buf
                      display ef-iva-FTMA
                   end-if
                end-if
      *
           |78-ID-ef-prz-FTMA è l'ID del control ef-prz-FTMA
           when 78-ID-ef-prz-FTMA
                if v-FTMA = 1 and tot-righe > 1
                   inquire ef-prz-FTMA, value in ef-prz-FTMA-buf
                end-if
      
           |78-ID-ef-consumo-FTMA è l'ID del control ef-consumo-FTMA
           when 78-ID-ef-consumo-FTMA
                if v-FTMA = 1 and tot-righe > 1
                   inquire ef-consumo-FTMA, value in ror-imp-consumo
                end-if
      
           |78-ID-ef-coubat-FTMA è l'ID del control ef-coubat-FTMA
           when 78-ID-ef-coubat-FTMA
                if v-FTMA = 1 and tot-righe > 1
                   inquire ef-coubat-FTMA, value in ror-imp-cou-cobat
                end-if
      
           |78-ID-ef-add-FTMA è l'ID del control ef-add-FTMA
           when 78-ID-ef-add-FTMA
                if v-FTMA = 1 and tot-righe > 1
                   inquire ef-add-FTMA, value in ror-add-piombo
                end-if
      *
           |78-ID-ef-iva-FTMA è l'ID del control ef-iva-FTMA
           when 78-ID-ef-iva-FTMA
                if v-FTMA = 1 and tot-righe > 1
                   inquire ef-iva-FTMA, value in ef-iva-FTMA-buf
                   if ef-iva-FTMA-buf not = spaces
                      move ef-iva-FTMA-buf to tbliv-codice2
                      move "IV"            to tbliv-codice1
                      read tivaese no lock 
                           invalid
                           set errori to true
                           display message "Codice IVA NON valido"
                                   title = tit-err
                                   icon  2
                       not invalid
                           inquire ef-descr,    value in ef-descr-buf
                           inquire ef-prz-FTMA, value in ef-prz-FTMA-buf
                           move ef-prz-FTMA-buf to ror-prz-unitario
                           if ef-descr-buf = spaces
                              set errori to true
                              move 78-ID-ef-descr to control-id
                           else
                              if ror-prz-unitario = 0
                                 set errori to true
                                 move 78-ID-ef-prz-FTMA to control-id
                              end-if
                           end-if
                      end-read
                   else
                      set errori           to true
                      inquire ef-descr,    value in ef-descr-buf
                      inquire ef-prz-FTMA, value in ror-prz-unitario
                      if ef-descr-buf = spaces
                         move 78-ID-ef-descr to control-id
                      else
                         if ror-prz-unitario = 0
                            move 78-ID-ef-prz-FTMA to control-id
                         else
                            move 78-ID-ef-iva-FTMA to control-id
                         end-if
                      end-if
                   end-if    
                   if tutto-ok and key-status = 13
                      inquire ef-consumo-FTMA,value in ror-imp-consumo
                      inquire ef-coubat-FTMA, value in ror-imp-cou-cobat
                      inquire ef-add-FTMA,    value in ror-add-piombo
                      move ef-descr-buf       to col-descr
                      move ror-prz-unitario   to col-prezzo
                      move ror-qta            to col-quantita
                      move ror-imp-consumo    to col-consumo
                      move ror-imp-cou-cobat  to col-coubat
                      move ror-add-piombo     to col-add
                      move ef-iva-FTMA-buf    to col-cod-iva
                      modify form1-gd-1(riga, 3),
                             cell-data =  col-descr         
                      modify form1-gd-1(riga, 4),
                             cell-data =  col-quantita
                      modify form1-gd-1(riga, 5),
                             cell-data =  col-prezzo
                      modify form1-gd-1(riga, 6),
                             cell-data =  col-consumo
                      modify form1-gd-1(riga, 7),
                             cell-data =  col-coubat 
                      modify form1-gd-1(riga, 8),
                             cell-data =  col-add
                      modify form1-gd-1(riga, 9),
                             cell-data =  col-cod-iva
                      move 0 to riga-nuova
                   end-if
                end-if
      *
           |78-ID-ef-art è l'ID del control ef-art
           when 78-ID-ef-art
                if v-FTTR = 1 and tot-righe > 1
                   inquire ef-art, value in ef-art-buf
                   move ef-art-buf to art-codice
                   move spaces to lab-art-buf
                   if art-codice not = hid-cod-articolo
                      move spaces to HiddenKey
                   end-if
                   read articoli no lock
                        invalid  set errori to true
                    not invalid
                        if art-attivo
                           if HiddenKey = spaces
                              perform FIND-MORE-ARTICOLI-ON-PROGMAG
                              move SaveUTF    to hid-peso-utf
                              move SaveNonUTF to hid-peso-non-utf
                              evaluate num-articoli
                              when 0
                                   set errori to true
                              when 1
                                   move GiacenzaKey to HiddenKey
                              when other             
                                   perform ZOOM-SU-PROGMAG-ARTICOLO
                                   move 4 to accept-control
                              end-evaluate
                           end-if
                           if ef-iva-ese-buf not = spaces
                              move ef-iva-ese-buf to ef-iva-buf
                           else
                              if ef-iva-buf = spaces
                                 if ef-iva-ese-buf not = spaces
                                    move ef-iva-ese-buf to ef-iva-buf
                                 else
                                    move art-codice-iva  to ef-iva-buf
                                 end-if
                              end-if
                           end-if
                           move art-descrizione to lab-art-buf
                        else
                           set errori to true
                        end-if
                   end-read
                   display lab-art ef-qta ef-prz ef-iva
                   if errori
                      initialize art-stato
                      display message "Codice articolo NON valido"
                              title = tit-err
                              icon  2
                   end-if
                end-if
      *
           |78-ID-ef-qta è l'ID del control ef-qta
           when 78-ID-ef-qta
                if v-FTTR = 1 and tot-righe > 1
                   inquire ef-qta, value in ef-qta-buf
                end-if
      *
           |78-ID-ef-prz è l'ID del control ef-prz
           when 78-ID-ef-prz
                if v-FTTR = 1 and tot-righe > 1
                   inquire ef-prz, value in ef-prz-buf
                end-if
      
           |78-ID-ef-consumo è l'ID del control ef-consumo
           when 78-ID-ef-consumo
                if v-FTTR = 1 and tot-righe > 1
                   inquire ef-consumo, value in ror-imp-consumo
                end-if
      
           |78-ID-ef-coubat è l'ID del control ef-coubat
           when 78-ID-ef-coubat
                if v-FTTR = 1 and tot-righe > 1
                   inquire ef-coubat, value in ror-imp-cou-cobat
                end-if
      
           |78-ID-ef-add è l'ID del control ef-add
           when 78-ID-ef-add
                if v-FTTR = 1 and tot-righe > 1
                   inquire ef-add, value in ror-add-piombo
                end-if
      *
           |78-ID-ef-iva è l'ID del control ef-iva
           when 78-ID-ef-iva
                if v-FTTR = 1 and tot-righe > 1
                   inquire ef-art,     value in ror-cod-articolo
                   inquire ef-consumo, value in ror-imp-consumo
                   inquire ef-coubat,  value in ror-imp-cou-cobat
                   inquire ef-add,     value in ror-add-piombo
                   inquire ef-prz,     value in ror-prz-unitario
                   inquire ef-qta,     value in ror-qta
                   inquire ef-iva,     value in ef-iva-buf
                   if ef-iva-buf not = spaces
                      move ef-iva-buf to tbliv-codice2
                      move "IV"       to tbliv-codice1
                      read tivaese no lock
                           invalid
                           set errori to true
                           display message "Codice IVA NON valido"
                                   title = tit-err
                                   icon  2
                       not invalid
                           if ror-qta = 0
                              set errori        to true
                              move 78-ID-ef-qta to control-id
                           else
                              if ror-prz-unitario = 0
                                 set errori        to true
                                 move 78-ID-ef-prz to control-id
                              end-if
                           end-if
      
                      end-read
                   else
                      set errori           to true
                      if ror-qta = 0
                         move 78-ID-ef-prz to control-id
                      else
                         if ror-prz-unitario = 0
                            move 78-ID-ef-prz to control-id
                         else
                            move 78-ID-ef-iva to control-id
                         end-if
                      end-if
                   end-if    
                   if tutto-ok and key-status = 13
                      move ef-art-buf        to col-codice
                      move lab-art-buf       to col-descr
                      move ror-imp-consumo   to col-consumo
                      move ror-imp-cou-cobat to col-coubat 
                      move ror-add-piombo    to col-add
                      move ror-prz-unitario  to col-prezzo
                      move ror-qta           to col-quantita
                      move ef-iva-buf        to col-cod-iva
                      modify form1-gd-1(riga, 2), 
                             cell-data =  col-codice
                      modify form1-gd-1(riga, 3), 
                             cell-data =  col-descr
                      modify form1-gd-1(riga, 4), 
                             cell-data =  col-quantita
                      modify form1-gd-1(riga, 5), 
                             cell-data =  col-prezzo  
                      modify form1-gd-1(riga, 6), 
                             cell-data =  col-consumo
                      modify form1-gd-1(riga, 7),
                             cell-data =  col-coubat
                      modify form1-gd-1(riga, 8),
                             cell-data =  col-add
                      modify form1-gd-1(riga, 9), 
                             cell-data =  col-cod-iva
                      modify form1-gd-1(riga, 2), 
                             hidden-data = HiddenKey
                      move 0 to riga-nuova        

                      modify form1-gd-1(riga, 1),
                             hidden-data = HiddenValori
                   end-if
                end-if   
                               
           when 78-ID-ef-fatt-data
                move ef-fatt-data-buf to como-data
                if como-data not = 0
                   perform DATE-FORMAT
                   move como-data to ef-fatt-data-buf
                   display ef-fatt-data
                end-if
      *
           end-evaluate.
      *****     
           if errori
              perform CANCELLA-COLORE
              move control-id to store-id
              move 4          to accept-control
           end-if 
           .
      * <TOTEM:END>

       CONTROLLO-DATI-EDI.
      * <TOTEM:PARA. CONTROLLO-DATI-EDI>
           if tca-causale-EDI  = "L07" or "L08" or "L02"
LUBEXX        move spaces     to rec-invio
LUBEXX        move ef-cli-buf to rec-codice convert
LUBEXX        read recapiti no lock invalid continue end-read
LUBEXX        if rec-invio = spaces set tor-invio-postel to true
LUBEXX        else                  move rec-invio to tor-invio
LUBEXX        end-if
              if tor-invio-edi
                 move ef-fatt-num-buf  to tor-fattura-from-numero
                 move ef-fatt-data-buf to tor-fattura-from-data
                 if tor-fattura-from-numero = 0 or
                    tor-fattura-from-data   = 0  
                    set errori to true
                    display message 
                       "Fattura di riferimento obbligatoria"
                x"0d0a""per nota addebito EDI"
                             title tit-err
                              icon 2
                    move 78-ID-ef-fatt-num to control-id 
                    perform CANCELLA-COLORE
                 else
                    move tor-fattura-from-data to como-data
                    perform DATE-FORMAT
                    move como-data to ef-fatt-data-buf
                    display ef-fatt-data
                 
                 end-if
              end-if
           end-if 
           .
      * <TOTEM:END>

       CURRENT-RECORD.
      * <TOTEM:PARA. CURRENT-RECORD>
           set tutto-ok  to true.
           set ReadSecca to true.
           if LinkFattMan
              read tordini no lock 
                   invalid set errori to true 
              end-read            
              move tor-data-bolla  to como-data
              perform DATE-TO-SCREEN
              move como-data       to lab-data-bolla-buf
                                                       
              move tor-num-bolla   to lab-num-bolla-buf
              inspect lab-num-bolla-buf replacing leading x"30" by x"20"
              call "C$JUSTIFY" using lab-num-bolla-buf, "L"
           else
              read btnotacr no lock 
                   invalid set errori to true 
              end-read
              perform LEGGI-DATI-BOZZA
           end-if.
           set ReadSecca to false.

           if RecLocked
              set RecLocked to false
              set errori    to true
           end-if.

           if tutto-ok
              move "00"          to status-tordini
              perform FORM1-FLD-TO-BUF
              perform VALORIZZA-SCREEN
              if LinkFattMan
                 perform CARICA-GRID
              else
                 perform CARICA-GRID-BOZZA
              end-if
           else
              move 0 to mod
              move 0 to mod-k
              modify tool-modifica, value = mod
              perform ABILITAZIONI
           end-if.
           perform VALORIZZA-OLD 
           .
      * <TOTEM:END>

       DISPLAY-SCREEN.
      * <TOTEM:PARA. DISPLAY-SCREEN>
           display form1 
           .
      * <TOTEM:END>

       FIND-MORE-ARTICOLI-ON-PROGMAG.
      * <TOTEM:PARA. FIND-MORE-ARTICOLI-ON-PROGMAG>
           move 0 to num-articoli.
           move low-value     to prg-rec.
           move art-codice    to prg-cod-articolo.
           move tca-cod-magaz to prg-cod-magazzino.
           start progmag key  is >= prg-chiave
                 invalid continue
             not invalid
                 perform until 1 = 2
                    read progmag next at end exit perform    end-read
                    if prg-cod-articolo      = art-codice    and
                       prg-cod-magazzino     = tca-cod-magaz
                       if prg-tipo-imballo  not = spaces     and
                          prg-peso          not = 0          and
                          prg-attivo
                          add 1 to num-articoli
                          evaluate true
                          when num-articoli = 1 
                               move prg-chiave       to GiacenzaKey
                               move prg-peso-utf     to SaveUTF
                               move prg-peso-non-utf to SaveNonUTF
                          when num-articoli > 1 
                               exit perform
                          end-evaluate
                       end-if
                    else
                       exit perform
                    end-if
                 end-perform
           end-start 
           .
      * <TOTEM:END>

       INIT.
      * <TOTEM:PARA. INIT>
           move  43,50    to EF-LinesWithout.
           perform RIEMPI-COMBO-STATO.
           move "Attivo"         to cbo-stato-buf.
           Modify  cbo-stato, value cbo-stato-buf.
           perform ABILITAZIONI.
           set ArticoloSetFocus to false.
           set InsertRow        to false.
           set PrimaVolta       to true.
           set ControllaCampi   to true.
           set CheckDestini     to true.
           move 0 to v-FTMA.
           move 0 to v-FTTR.
           move 0 to LastPrg.
           move spaces to HiddenKey.
           move 1 to event-data-1 screen1-ta-1-tab-value.
           perform SCREEN1-TA-1-TABCHANGE.
           perform RESET-GRIGLIA.
           perform INSERISCI-RIGA.
           perform INITIALIZE-ENTRY.
           perform CANCELLA-COLORE.
           move 78-ID-ef-cli to control-id.
           move 4            to accept-control.

           move tca-contropartita to ef-piano-buf tor-contropartita.

           move tca-contropartita to mas-codice.
           read mas no lock invalid continue end-read.
           perform MOVE-DESCR-PIANO.
           
           if KeyboardSaved
              set KeyboardReleased to true
              set environment "KEYSTROKE" to "DATA=44 44"
              set environment "KEYSTROKE" to "DATA=46 46"
           end-if 
           .
      * <TOTEM:END>

       INITIALIZE-ENTRY.
      * <TOTEM:PARA. INITIALIZE-ENTRY>
           move 0 to ef-prz-FTMA-buf
                     ef-consumo-FTMA-buf
                     ef-coubat-FTMA-buf
                     ef-add-FTMA-buf
                     
                     ef-art-buf
                     ef-qta-buf
                     ef-prz-buf
                     ef-consumo-buf
                     ef-coubat-buf
                     ef-add-buf.
      
           move spaces to ef-descr-buf 
                          lab-art-buf
                          ef-iva-buf
                          ef-iva-FTMA-buf.
      
           perform DISPLAY-SCREEN 
           .
      * <TOTEM:END>

       INSERISCI-RIGA.
      * <TOTEM:PARA. INSERISCI-RIGA>
           add 1 to LastPrg.
           move LastPrg to col-riga.
           inquire form1-gd-1, last-row in tot-righe.
           modify  form1-gd-1, insert-rows = 1.
           add 1 to tot-righe giving riga.
           modify form1-gd-1(riga, 1), cell-data = col-riga.
           move 1 to riga-nuova 
           .
      * <TOTEM:END>

       INTESTAZIONE.
      * <TOTEM:PARA. INTESTAZIONE>
           if LinkFTMA
              modify form1-gd-1(1, 2), cell-data = spaces
              modify form1-gd-1(1, 3), cell-data = "Descrizione Voce"
              modify form1-gd-1(1, 4), cell-data = spaces
              modify form1-gd-1(1, 5), cell-data = "Importo"
              modify form1-gd-1(1, 6), cell-data = "Imp. Consumo"
              modify form1-gd-1(1, 7), cell-data = "Imp. Cou/Cobat"
              modify form1-gd-1(1, 8), cell-data = "Cod. IVA"
           else
              perform FORM1-GD-1-CONTENT
           end-if 
           .
      * <TOTEM:END>

       LEGGI-DATI-BOZZA.
      * <TOTEM:PARA. LEGGI-DATI-BOZZA>
           if btno-fm-vettore
              move 0 to tor-cod-cli
              move 0 to tor-prg-destino
           else
              if btno-cod-cli-fm not = 0
                 move btno-cod-cli-fm     to btno-cod-cli
                 move btno-prg-destino-fm to btno-prg-destino
              end-if
              move btno-cod-cli     to tor-cod-cli
              move btno-prg-destino to tor-prg-destino
           end-if.                          

           move btno-cod-pag     to tor-cod-pagamento.
           move btno-data-bolla  to como-data 
           perform DATE-TO-SCREEN.
           move como-data        to lab-data-bolla-buf.
           move btno-num-bolla   to lab-num-bolla-buf    

           move btno-motivo-cont to lab-motivo-buf.
           evaluate true
           when btno-corriere   move "Corriere"  to lab-colpa-buf
           when btno-magazzino  move "Magazzino" to lab-colpa-buf
           when btno-fornitore  move "fornitore" to lab-colpa-buf
           when btno-cliente    move "Cliente"   to lab-colpa-buf
           when btno-ufficio    move "Ufficio"   to lab-colpa-buf
           end-evaluate.
           move btno-vettore to vet-codice lab-corriere-buf.
           read tvettori no lock invalid continue end-read.
           move vet-descrizione to lab-corriere-des-buf.
           move btno-note to lab-altre-buf.
           move btno-data to como-data.
           perform DATE-TO-SCREEN.
           move como-data   to lab-data-b-buf.
           move btno-numero to lab-num-b-buf 
           .
      * <TOTEM:END>

       MOVE-DESCR-IVA.
      * <TOTEM:PARA. MOVE-DESCR-IVA>
           initialize lab-iva-buf.
           inspect tbliv-descrizione1 replacing trailing 
                                         spaces by low-value.
           string  tbliv-descrizione1 delimited by low-value
                   " "                delimited by size
                   tbliv-descrizione2 delimited by size
                   into lab-iva-buf
           end-string 
           .
      * <TOTEM:END>

       MOVE-DESCR-PAG.
      * <TOTEM:PARA. MOVE-DESCR-PAG>
           initialize lab-pag-buf.
           inspect tblpa-descrizione1 replacing trailing 
                                         spaces by low-value.
           string  tblpa-descrizione1 delimited by low-value
                   " "                delimited by size
                   tblpa-descrizione2 delimited by size
                   into lab-pag-buf
           end-string 
           .
      * <TOTEM:END>

       MOVE-DESCR-PIANO.
      * <TOTEM:PARA. MOVE-DESCR-PIANO>
           initialize lab-piano-buf.
           inspect mas-descrizione1 replacing trailing spaces 
                                                    by low-value.
           string  mas-descrizione1 delimited by low-value
                   " "              delimited by size
                   mas-descrizione2 delimited by size
                   into lab-piano-buf
           end-string 
           .
      * <TOTEM:END>

       PARAGRAFO-COPY.
      * <TOTEM:PARA. PARAGRAFO-COPY>
           copy "utydata.cpy".
           copy "abilita-toolbar.cpy".
           copy "color-custom.cpy".
           copy "riempi-combo-stato.cpy".
           copy "costo-medio.cpy".

      ***--- |DUMMY NON TOCCARE
       RECUPERO-ANAGRAFICA 
           .
      * <TOTEM:END>

       RESET-GRIGLIA.
      * <TOTEM:PARA. RESET-GRIGLIA>
           modify form1-gd-1, reset-grid = 1.
           perform INTESTAZIONE 
           .
      * <TOTEM:END>

       RESETTA-VIRGOLA.
      * <TOTEM:PARA. RESETTA-VIRGOLA>
           if KeyboardSaved
              set KeyboardReleased to true
      *       setto la tastiera originale
              set environment "KEYSTROKE" to "DATA=44 44"
              set environment "KEYSTROKE" to "DATA=46 46"
           end-if 
           .
      * <TOTEM:END>

       ROW-TO-ENTRY.
      * <TOTEM:PARA. ROW-TO-ENTRY>
           evaluate true
           when LinkFTND
           when LinkFTTR         
                inquire form1-gd-1(riga, 2),cell-data in col-codice
                inquire form1-gd-1(riga, 3),cell-data in col-descr
                inquire form1-gd-1(riga, 4), cell-data in col-quantita
                inquire form1-gd-1(riga, 5), cell-data in col-prezzo  
                inquire form1-gd-1(riga, 6), cell-data in col-consumo
                inquire form1-gd-1(riga, 7), cell-data in col-coubat
                inquire form1-gd-1(riga, 8), cell-data in col-add
                inquire form1-gd-1(riga, 9), cell-data in col-cod-iva
                move col-codice   to ef-art-buf
                move col-descr    to lab-art-buf
                move col-quantita to ef-qta-buf
                move col-prezzo   to ef-prz-buf
                move col-consumo  to ef-consumo-buf
                move col-coubat   to ef-coubat-buf
                move col-add      to ef-add-buf
                move col-cod-iva  to ef-iva-buf
                display ef-art
                display lab-art 
                display ef-qta 
                display ef-prz 
                display ef-iva 
                display ef-consumo 
                display ef-coubat 
                display ef-add
                    
           when LinkFTMA
                inquire form1-gd-1(riga, 3), cell-data in col-descr
                inquire form1-gd-1(riga, 5), cell-data in col-prezzo
                inquire form1-gd-1(riga, 6), cell-data in col-consumo
                inquire form1-gd-1(riga, 7), cell-data in col-coubat
                inquire form1-gd-1(riga, 8), cell-data in col-add
                inquire form1-gd-1(riga, 9), cell-data in col-cod-iva
                move col-descr    to ef-descr-buf
                move col-prezzo   to ef-prz-FTMA-buf
                move col-consumo  to ef-consumo-FTMA-buf
                move col-coubat   to ef-coubat-FTMA-buf
                move col-add      to ef-add-FTMA-buf
                move col-cod-iva  to ef-iva-FTMA-buf
                display ef-prz-FTMA ef-iva-FTMA ef-descr
                        ef-consumo-FTMA ef-coubat-FTMA ef-add-FTMA
           end-evaluate.
           
           inquire form1-gd-1(riga, 1), hidden-data in HiddenValori.
           inquire form1-gd-1(riga, 2), hidden-data in HiddenKey 
           .
      * <TOTEM:END>

       SALVA.
      * <TOTEM:PARA. SALVA>
           set tutto-ok to true.
      
           perform CHECK-PAGE-1.
      
           if tutto-ok
              if tutto-ok
                 perform CONTA-RIGHE
                 if not trovato
                    display message "Impossibile registrare la nota "
                                    "in quanto non sono presenti righe."
                            title = tit-err
                            icon mb-warning-icon
                    set errori to true
                    perform CANCELLA-COLORE
                 else
                    move 78-ID-cbo-stato to CONTROL-ID
                    perform CONTROLLO
                 end-if
              end-if
           end-if. 

           if tutto-ok
              perform CONTROLLO-DATI-EDI
           end-if.
      
           if errori
              inquire Screen1-Ta-1, value in pagina
              |******
              if store-id >= min-id(pagina) and
                 store-id <= max-id(pagina)
                 move store-id to control-id
              end-if
              |******
              move 4 to accept-control
           else      
              perform CONTROLLA-TOTALE
              if errori
                 display message 
                  "Salvataggio NON effettuato: Il totale del documento "
            x"0d0a""non rispetta l'indicazione della causale utilizzata"
                           title tit-err
                            icon 2
              else
                 perform CONTA-CODICI-IVA
                 if errori
                    display message 
                    "Impossibile registrare il documento in quanto"
                    " sono presenti più di tre codici IVA"
                            title = tit-err
                            icon mb-warning-icon
                    set errori to true
                    perform CANCELLA-COLORE
                 else
                    perform VALORIZZA-NUMERO
                    if tutto-ok
                       perform FORM1-BUF-TO-FLD
                       perform SCRIVI-RIGHE
                       perform CANCELLA-COLORE

LUBEXX                 if not EsisteIVA
LUBEXX                    set tor-invio-manuale to true
LUBEXX                 end-if
                                                                      
                       write tor-rec invalid rewrite tor-rec end-write
                       unlock tordini all records

                       if LinkBozzaMan
                          perform AGGIORNA-BOZZA
                       end-if

PATCH                  perform SCRIVI-FILE-BACKUP

                       perform CLEAR-SCREEN
                       perform INIT
                       |NUOVA MODIFICA: Se mi arriva da un altro
                       |documento esco perchè se ne inserisce uno mirato
                       if FatAnno   not = 0 and 
                          FatNumero not = 0
                          move 27 to key-status
                       end-if
                    else
                       perform CANCELLA-COLORE
                       move 27 to key-status
                    end-if
                 end-if
              end-if
           end-if.
                    
           perform DISPLAY-SCREEN.

           set environment "KEYSTROKE" to "DATA=44   44".
           set environment "KEYSTROKE" to "DATA=46   46" 
           .
      * <TOTEM:END>

       SCRIVI-FILE-BACKUP.
      * <TOTEM:PARA. SCRIVI-FILE-BACKUP>
      *****     move tor-rec to btor-rec.
      *****     write btor-rec invalid continue end-write.
      *****     move low-value  to ror-rec.
      *****     move tor-chiave to ror-chiave.
      *****     start rordini key >= ror-chiave
      *****           invalid continue
      *****       not invalid
      *****           perform until 1 = 2
      *****              read rordini next at end exit perform end-read
      *****              if ror-anno       not = tor-anno or
      *****                 ror-num-ordine not = tor-numero
      *****                 exit perform
      *****              end-if
      *****              move ror-rec to bror-rec
      *****              write bror-rec invalid continue end-write
      *****           end-perform
      *****     end-start 
           .
      * <TOTEM:END>

       SCRIVI-RIGHE.
      * <TOTEM:PARA. SCRIVI-RIGHE>
LUBEXX     set EsisteIVA to false.
           inquire form1-gd-1, last-row in tot-righe.
           perform varying riga from 2 by 1 
                     until riga > tot-righe
              initialize ror-rec replacing numeric data by zeroes
                                      alphanumeric data by spaces
              move    tor-chiave      to ror-chiave
              move    tor-stato       to ror-stato
              move    tor-dati-comuni to ror-dati-comuni
              inquire form1-gd-1(riga, 1), cell-data in col-riga
              inquire form1-gd-1(riga, 2), cell-data in col-codice
              inquire form1-gd-1(riga, 3), cell-data in col-descr
              inquire form1-gd-1(riga, 4), cell-data in col-quantita
              inquire form1-gd-1(riga, 5), cell-data in col-prezzo
              inquire form1-gd-1(riga, 6), cell-data in col-consumo
              inquire form1-gd-1(riga, 7), cell-data in col-coubat
              inquire form1-gd-1(riga, 8), cell-data in col-add

              if ef-iva-ese-buf = spaces
                 inquire form1-gd-1(riga, 9), cell-data in col-cod-iva
              else
                 move ef-iva-ese-buf to col-cod-iva
              end-if

              inquire form1-gd-1(riga, 1), hidden-data in HiddenValori
              inquire form1-gd-1(riga, 2), hidden-data in HiddenKey
              move col-riga         to ror-num-riga
              if LinkFTMA
                 move 0             to ror-qta
              else
                 move col-quantita  to ror-qta
              end-if
              move col-prezzo       to ror-prz-unitario 
                                       ror-imponib-merce
              move col-consumo      to ror-imp-consumo
              move col-coubat       to ror-imp-cou-cobat
              move col-add          to ror-add-piombo
              move col-cod-iva      to ror-cod-iva

LUBEXX        if not EsisteIVA
LUBEXX           perform CONTROLLA-PERCENTUALE-IVA
LUBEXX        end-if

              evaluate true                                        
              when LinkFTND
              when LinkFTTR move col-codice to ror-cod-articolo
              when LinkFTMA move col-descr  to ror-des-libera
              end-evaluate

              if ror-prz-unitario = 0
LUBEXX           if tca-no-speciale
LUBEXX              set ror-si-omaggio to true
LUBEXX           else
LUBEXX              set ror-no-omaggio to true
LUBEXX           end-if
              else
                 set ror-no-omaggio to true
              end-if
      
              accept como-ora from time
              move data-oggi  to ror-data-ultima-modifica
              move como-ora   to ror-ora-ultima-modifica
              move user-codi  to ror-utente-ultima-modifica

              |Quelle NON DI MERCE hanno la descrizione della voce
              |manuale per cui nessun riferimento ai progressivi
              if LinkFTTR or LinkFTND
                 
                 move HiddenKey  to ror-prg-chiave prg-chiave
                 read progmag no lock 
                      invalid 
                      perform 5 times
                         display message "ARTICOLO " prg-cod-articolo
                                  x"0d0a""RIGA " ror-num-riga
                                  x"0d0a""DATI INCOERENTI!!!"
                                  x"0d0a""CANCELLARE E REINSERIRE LA RIG
      -    "A"
                                   title tit-err
                                    icon 2
                      end-perform
                  not invalid
                      move prg-peso-utf     to ror-peso-utf
                      move prg-peso-non-utf to ror-peso-non-utf
                 end-read
              end-if
      
              write ror-rec invalid rewrite ror-rec end-write

           end-perform 
           .
      * <TOTEM:END>

       SELEZIONA-ALFA.
      * <TOTEM:PARA. SELEZIONA-ALFA>
           set tutto-ok to true.  
           move spaces to lab-cli-buf.
           move spaces to lab-ind-buf.
           move spaces to lab-loca-buf.
      * LA SECONDA CHIAVE E' ALFANUMERICA E LA VALUE VARIABLE CONTIENE
      * ANCORA GLI ZERI DAVANTI CHE ELIMINO
           inspect ef-cli-buf replacing leading zero by spaces.
           move    ef-cli-buf to cli-ragsoc-1.
      
      * POI GIUSTIFICO A SINISTRA E MI POSIZIONO SULLO ZOOM PER CHIAVE
      * ALTERNATA
           set cli-tipo-c to true.
           call "C$JUSTIFY" using cli-ragsoc-1, "L".
      
           start clienti key >= cli-k1
                 invalid continue
             not invalid read clienti next 
           end-start.
      
           move "clienti-alfa-all" to como-file.

           call "zoom-gt" using   como-file, cli-rec
                          giving  stato-zoom.
           cancel "zoom-gt".

           if stato-zoom = 0
              move cli-codice    to codice-ed
              move codice-ed     to ef-cli-buf   
              call "C$JUSTIFY" using ef-cli-buf, "L"
              display ef-cli
           end-if .

           move 78-ID-ef-cli to control-id.
           move 4            to accept-control 
           .
      * <TOTEM:END>

       SELEZIONA-DESTINO-NUMERICO.
      * <TOTEM:PARA. SELEZIONA-DESTINO-NUMERICO>
           move spaces to lab-des-buf.
           move spaces to lab-ind-d-buf.
           move spaces to lab-loca-d-buf.
           inquire ef-cli, value in des-codice.
           inquire ef-des, value in des-prog.
           if des-codice not > 0
              set errori to true
              display message box msg-codice-obbligatorio
                      title tit-err
                      icon  mb-warning-icon
           else          
              inquire ef-cli, value in des-codice
              read destini no lock
                   invalid
                   display message "Progressivo destino NON valido"
                             title tit-err
                              icon 2
                   set errori to true
              end-read
           end-if 
           .
      * <TOTEM:END>

       SELEZIONA-DESTINO-ALFA.
      * <TOTEM:PARA. SELEZIONA-DESTINO-ALFA>
      * LA SECONDA CHIAVE E' ALFANUMERICA E LA VALUE VARIABLE CONTIENE
      * ANCORA GLI ZERI DAVANTI CHE ELIMINO
           inspect ef-des-buf replacing leading zero by spaces.
           move    ef-des-buf to des-ragsoc-1.
      
      * POI GIUSTIFICO A SINISTRA E MI POSIZIONO SULLO ZOOM PER CHIAVE
      * ALTERNATA
           call "C$JUSTIFY" using des-ragsoc-1, "L".
      
           start destini     key >= K1
                 invalid     continue
                 not invalid read destini next 
           end-start.   
           set cli-tipo-c to true.
      
           move "clienti-des-alf" to como-file.
           call "zoom-gt" using   como-file, des-rec
                          giving  stato-zoom.
           cancel "zoom-gt".
           if stato-zoom = 0
              move des-prog       to codice-ed
              move codice-ed      to ef-des-buf   
              call "C$JUSTIFY" using ef-des-buf, "L"
              display ef-des
           end-if.

           set errori         to true.
           move 78-ID-ef-des  to control-id 
           .
      * <TOTEM:END>

       SELEZIONA-NUMERICO.
      * <TOTEM:PARA. SELEZIONA-NUMERICO>
           set tutto-ok to true.
           move spaces to lab-cli-buf.
           move spaces to lab-ind-buf.
           move spaces to lab-loca-buf.

           inquire ef-cli, value in cli-codice.
           if cli-codice not > 0
              set errori to true
              display message box msg-codice-obbligatorio
                      title tit-err
                      icon  MB-WARNING-ICON
           else          
              set cli-tipo-c to true
              read clienti no lock
                   invalid
                   display message box "Codice cliente NON valido"
                           title = tit-err
                           icon 2
                   set errori to true
              end-read
           end-if  
           .
      * <TOTEM:END>

       SETTA-VIRGOLA.
      * <TOTEM:PARA. SETTA-VIRGOLA>
           if KeyboardReleased
              set KeyboardSaved to true
      *       sostituisco il punto come virgola
              set environment "KEYSTROKE" to "DATA=44 46"
           end-if 
           .
      * <TOTEM:END>

       SPOSTAMENTO.
      * <TOTEM:PARA. SPOSTAMENTO>
           set tutto-ok to true.
           inquire form1-gd-1, last-row in tot-righe.
           move event-data-2 to riga.
      
           if riga < 2 move 2 to riga end-if.
      
           if riga > tot-righe
              if riga-nuova = 0
                 move tot-righe to riga
              else
                 if LinkFTMA move 78-ID-ef-descr to control-id
                 else        move 78-ID-ef-art   to control-id
                 end-if
                 move 4            to accept-control
                 set errori to true
              end-if
           else
              if riga-nuova = 1
                 move 0 to riga-nuova
                 modify form1-gd-1,  record-to-delete = tot-righe + 1
                 subtract 1 from LastPrg
              end-if
           end-if.
      
           modify form1-gd-1, start-y = riga, start-x =  2,
                                    y = riga,       x = 12,
                         region-color = 144.
      
           if tutto-ok
              perform ROW-TO-ENTRY
           end-if.
           set event-action   to event-action-terminate.
           modify form1-gd-1, cursor-y = riga 
           .
      * <TOTEM:END>

       STATUS-HELP.
      * <TOTEM:PARA. STATUS-HELP>
           if StatusHelp = 1
              modify Form1-St-1-Handle, 
                     panel-index = 2, 
                     panel-text "F8 HELP record presenti"
              move BitmapZoomEnabled to BitmapNumZoom
           else
              modify Form1-St-1-Handle, 
                     panel-index = 2, 
                     panel-text spaces
              move BitmapZoomDisabled to BitmapNumZoom
           end-if.

           move StatusHelp    to e-cerca.
           modify tool-cerca, enabled = e-cerca.
           modify tool-cerca, bitmap-number = BitmapNumZoom 
           .
      * <TOTEM:END>

       TROVA-DESTINO.
      * <TOTEM:PARA. TROVA-DESTINO>
           set trovato to false.
           inquire ef-cli, value in ef-cli-buf.
           move ef-cli-buf to des-codice convert.
           move ef-cli-buf to cli-codice convert.

           move low-value  to des-prog.
           start destini  key is >= des-chiave
                 invalid  continue
             not invalid  
                 perform until 1 = 2
                    read destini next at end exit perform end-read
                    if des-codice = cli-codice
                       set trovato to true
                       exit perform
                    else 
                       move ef-cli-buf to des-codice convert
                       move ef-des-buf to des-prog   convert
                    end-if
                 end-perform
           end-start.

           if not trovato initialize des-rec end-if 
           .
      * <TOTEM:END>

       VALORIZZA-NUMERO.
      * <TOTEM:PARA. VALORIZZA-NUMERO>
           initialize link-nambar.
           move esercizio     to link-anno.

           set  link-fatman   to true.
           set  link-crea     to true.
           move Link-TipoFat  to link-nambar-causale.

           call   "nambar" using link-nambar.
           cancel "nambar".
           
           if link-status-nambar = -1 set errori       to true
           else                       move link-numero to tor-numero
           end-if 
           .
      * <TOTEM:END>

       VALORIZZA-OLD.
      * <TOTEM:PARA. VALORIZZA-OLD>
           move tor-rec to old-tor-rec.
           set old-tor-attivo to true 
           .
      * <TOTEM:END>

       VALORIZZA-SCREEN.
      * <TOTEM:PARA. VALORIZZA-SCREEN>
           move tor-cod-cli to cli-codice.
           set cli-tipo-C   to true.
           read clienti  no lock invalid continue end-read.

           if LinkBozzaMan
              move cli-agente to tor-cod-agente
           end-if.

           move tor-cod-cli     to des-codice.
           move tor-prg-destino to des-prog.
           read destini no lock invalid continue end-read.

           move tor-cod-agente to age-codice.
           read agenti no lock invalid continue end-read.

           move "IV"            to tbliv-codice1.
           move tor-cod-ese-iva to tbliv-codice2.
           read tivaese no lock invalid continue end-read.

           move "PA"              to tblpa-codice1.
           move tor-cod-pagamento to tblpa-codice2.
           read tcodpag no lock invalid continue end-read.

           move tor-contropartita to mas-codice.
           read mas no lock invalid continue end-read.
           
           move tor-numero to lab-num-buf.

           accept como-data from century-date.
           perform DATE-TO-SCREEN.
           move como-data to lab-data-buf.

           move tor-cod-cli     to codice-ed.
           move codice-ed       to ef-cli-buf.
           call "C$JUSTIFY"  using ef-cli-buf, "L".

           move tor-prg-destino to codice-ed.
           move codice-ed       to ef-des-buf.
           call "C$JUSTIFY"  using ef-des-buf, "L".

           move tor-cod-agente  to ef-age-buf.
           move tor-cod-ese-iva to ef-iva-ese-buf.

           move cli-ragsoc-1    to lab-cli-buf.
           move cli-indirizzo   to lab-ind-buf.
           move cli-localita    to lab-loca-buf.

           move des-ragsoc-1    to lab-des-buf.
           move des-indirizzo   to lab-ind-d-buf.
           move des-localita    to lab-loca-d-buf.

           move age-ragsoc-1    to lab-age-buf.

           perform MOVE-DESCR-PAG.

           perform MOVE-DESCR-IVA.

           perform MOVE-DESCR-PIANO 
           .
      * <TOTEM:END>

       VALORIZZA-TESTATA.
      * <TOTEM:PARA. VALORIZZA-TESTATA>
           inspect ef-cli-buf replacing leading x"30" by x"20".
           inspect ef-des-buf replacing leading x"30" by x"20".

           accept data-oggi from century-date.
           move   data-oggi to como-data.
           perform DATE-TO-SCREEN.
           move como-data to lab-data-buf.

           set  tor-attivo to true.
           move tor-stato  to stato.
           perform CARICA-COMBO-STATO.

           perform VALORIZZA-OLD 
           .
      * <TOTEM:END>

       ZOOM-SU-PROGMAG-ARTICOLO.
      * <TOTEM:PARA. ZOOM-SU-PROGMAG-ARTICOLO>
           move low-value to prg-rec.
           inquire ef-art,   value in prg-cod-articolo
           move prg-cod-articolo  to como-articolo.
           move tca-cod-magaz     to prg-cod-magazzino 
                                        como-magazzino.
           move 0      to como-giacenza.
           start progmag key is >=  key01
                 invalid continue
             not invalid
                 perform until 1 = 2
                    read progmag next at end exit perform 
                    end-read
                    if prg-cod-articolo  not = como-articolo or
                       prg-cod-magazzino not = como-magazzino
                       exit perform
                    end-if
                    if prg-giacenza > como-giacenza or
                                      como-giacenza = 0
                       move prg-chiave   to save-prg-chiave
                       move prg-giacenza to como-giacenza
                    end-if
                 end-perform
           end-start.
           move save-prg-chiave to prg-chiave.

           move "prg-artico-sons"  to como-file.
           inquire ef-art,   value in prg-cod-articolo
           move tca-cod-magaz      to prg-cod-magazzino.
           call "zoom-gt"       using como-file, prg-rec
                               giving stato-zoom
           end-call.
           cancel "zoom-gt".
           if stato-zoom = 0
              move prg-cod-articolo to ef-art-buf
              display ef-art
              move prg-chiave to HiddenKey
           |else
           |   set errori to true
           end-if 
           .
      * <TOTEM:END>

      * EVENT PARAGRAPH
       TOOL-SALVA-LinkTo.
      * <TOTEM:PARA. TOOL-SALVA-LinkTo>
           perform SALVA 
           .
      * <TOTEM:END>
       ANTEPRIMA-LinkTo.
      * <TOTEM:PARA. ANTEPRIMA-LinkTo>
           .
      * <TOTEM:END>
       TOOL-MODIFICA-BeforeProcedure.
      * <TOTEM:PARA. TOOL-MODIFICA-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       TOOL-MODIFICA-AfterProcedure.
      * <TOTEM:PARA. TOOL-MODIFICA-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       TOOL-MODIFICA-LinkTo.
      * <TOTEM:PARA. TOOL-MODIFICA-LinkTo>
           .
      * <TOTEM:END>
       STAMPA-LinkTo.
      * <TOTEM:PARA. STAMPA-LinkTo>
           .
      * <TOTEM:END>
       TOOL-CERCA-LinkTo.
      * <TOTEM:PARA. TOOL-CERCA-LinkTo>
           inquire tool-cerca, enabled in e-cerca.
           if e-cerca = 1      perform CERCA end-if 
           .
      * <TOTEM:END>
       Screen1-Ta-1-Ev-Cmd-Tabchanged.
      * <TOTEM:PARA. Screen1-Ta-1-Ev-Cmd-Tabchanged>
           perform CHANGE-TAB 
           .
      * <TOTEM:END>
       ef-cli-BeforeProcedure.
      * <TOTEM:PARA. ef-cli-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-des-BeforeProcedure.
      * <TOTEM:PARA. ef-des-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       cbo-stato-BeforeProcedure.
      * <TOTEM:PARA. cbo-stato-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       cbo-stato-AfterProcedure.
      * <TOTEM:PARA. cbo-stato-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           .
      * <TOTEM:END>
       notacr-Ev-Before-Program.
      * <TOTEM:PARA. notacr-Ev-Before-Program>
           move LK-BL-PROG-ID    TO COMO-PROG-ID.
           initialize tab-id.
           move 78-ID-ef-cli     to min-id(1).
           move 78-ID-cbo-stato  to max-id(1).
           move 78-ID-form1-gd-1 to min-id(2).
           move 78-ID-ef-iva     to max-id(2).

           accept esercizio-g2 from environment "ESERCIZIO_G2".
           accept esercizio-x  from environment "ESERCIZIO".
           move   esercizio-x  to esercizio 
           .
      * <TOTEM:END>
       notacr-Ev-After-Program.
      * <TOTEM:PARA. notacr-Ev-After-Program>
           SET LK-BL-CANCELLAZIONE TO TRUE.
           MOVE COMO-PROG-ID       TO LK-BL-PROG-ID.
           CALL "BLOCKPGM"  USING LK-BLOCKPGM.
           if KeyboardSaved
              set KeyboardReleased to true
              set environment "KEYSTROKE" to "DATA=44 44"
              set environment "KEYSTROKE" to "DATA=46 46"
           end-if 
           .
      * <TOTEM:END>
       ef-age-BeforeProcedure.
      * <TOTEM:PARA. ef-age-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-pag-BeforeProcedure.
      * <TOTEM:PARA. ef-pag-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-iva-BeforeProcedure.
      * <TOTEM:PARA. ef-iva-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           perform BEFORE-CAMPI.
           move 1 to StatusHelp.
           perform STATUS-HELP 
           .
      * <TOTEM:END>
       ef-note-BeforeProcedure.
      * <TOTEM:PARA. ef-note-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           set KeyboardReleased to true.
      *    setto la tastiera originale
           set environment "KEYSTROKE" to "DATA=44 44".
           set environment "KEYSTROKE" to "DATA=46 46" 
           .
      * <TOTEM:END>
       ef-cli-AfterProcedure.
      * <TOTEM:PARA. ef-cli-AfterProcedure>
              INQUIRE ef-cli, VALUE IN tor-cod-cli
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-cli-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-des-AfterProcedure.
      * <TOTEM:PARA. ef-des-AfterProcedure>
              INQUIRE ef-des, VALUE IN tor-prg-destino
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-des-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-age-AfterProcedure.
      * <TOTEM:PARA. ef-age-AfterProcedure>
              INQUIRE ef-age, VALUE IN tor-cod-agente
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-age-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-pag-AfterProcedure.
      * <TOTEM:PARA. ef-pag-AfterProcedure>
              INQUIRE ef-pag, VALUE IN tor-cod-pagamento
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-pag-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-iva-AfterProcedure.
      * <TOTEM:PARA. ef-iva-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO.
           move 0 to StatusHelp.
           perform STATUS-HELP.
           .
      * <TOTEM:END>

       ef-note-AfterProcedure.
      * <TOTEM:PARA. ef-note-AfterProcedure>
              INQUIRE ef-note, VALUE IN tor-note
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-note-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       form1-gd-1-Ev-Msg-Begin-Drag.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-Begin-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-Begin-Entry.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-Begin-Entry>
           set event-action to event-action-fail 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-Goto-Cell.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-Goto-Cell>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-Goto-Cell-Drag.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-Goto-Cell-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-End-Drag.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-End-Drag>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       form1-gd-1-Ev-Msg-Goto-Cell-Mouse.
      * <TOTEM:PARA. form1-gd-1-Ev-Msg-Goto-Cell-Mouse>
           perform SPOSTAMENTO 
           .
      * <TOTEM:END>
       ef-descr-BeforeProcedure.
      * <TOTEM:PARA. ef-descr-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-prz-FTMA-BeforeProcedure.
      * <TOTEM:PARA. ef-prz-FTMA-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           perform SETTA-VIRGOLA 
           .
      * <TOTEM:END>
       ef-iva-FTMA-BeforeProcedure.
      * <TOTEM:PARA. ef-iva-FTMA-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           move 1 to StatusHelp.
           perform STATUS-HELP.
           perform BEFORE-CAMPI 
           .
      * <TOTEM:END>
       ef-descr-AfterProcedure.
      * <TOTEM:PARA. ef-descr-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO 
           .
      * <TOTEM:END>
       ef-prz-FTMA-AfterProcedure.
      * <TOTEM:PARA. ef-prz-FTMA-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO.
           perform RESETTA-VIRGOLA 
           .
      * <TOTEM:END>
       ef-iva-FTMA-AfterProcedure.
      * <TOTEM:PARA. ef-iva-FTMA-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO.
           move 0 to StatusHelp.
           perform STATUS-HELP 
           .
      * <TOTEM:END>
       ef-art-BeforeProcedure.
      * <TOTEM:PARA. ef-art-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           move 1 to StatusHelp.
           perform STATUS-HELP 
           .
      * <TOTEM:END>
       ef-qta-BeforeProcedure.
      * <TOTEM:PARA. ef-qta-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           perform BEFORE-CAMPI 
           .
      * <TOTEM:END>
       ef-prz-BeforeProcedure.
      * <TOTEM:PARA. ef-prz-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           perform BEFORE-CAMPI.
           perform SETTA-VIRGOLA 
           .
      * <TOTEM:END>
       ef-art-AfterProcedure.
      * <TOTEM:PARA. ef-art-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO.
           move 0 to StatusHelp.
           perform STATUS-HELP 
           .
      * <TOTEM:END>
       ef-qta-AfterProcedure.
      * <TOTEM:PARA. ef-qta-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO 
           .
      * <TOTEM:END>
       ef-prz-AfterProcedure.
      * <TOTEM:PARA. ef-prz-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO.
           perform RESETTA-VIRGOLA 
           .
      * <TOTEM:END>
       pb-nuovo-BeforeProcedure.
      * <TOTEM:PARA. pb-nuovo-BeforeProcedure>
           modify pb-nuovo, bitmap-number = 2 
           .
      * <TOTEM:END>
       pb-nuovo-AfterProcedure.
      * <TOTEM:PARA. pb-nuovo-AfterProcedure>
           modify pb-nuovo, bitmap-number = 5 
           .
      * <TOTEM:END>
       pb-nuovo-LinkTo.
      * <TOTEM:PARA. pb-nuovo-LinkTo>
           if riga-nuova = 0
              perform INSERISCI-RIGA
              initialize HiddenKey
                         HiddenValori replacing numeric data by spaces
                                           alphanumeric data by zeroes
              perform INITIALIZE-ENTRY
              move riga to event-data-2
              perform SPOSTAMENTO
              perform CANCELLA-COLORE
              if LinkFTMA move 78-ID-ef-descr to control-id
              else        move 78-ID-ef-art   to control-id
              end-if
              move 4              to accept-control
              modify pb-nuovo, bitmap-number = 5
           end-if 
           .
      * <TOTEM:END>
       pb-elimina-BeforeProcedure.
      * <TOTEM:PARA. pb-elimina-BeforeProcedure>
           modify pb-elimina, bitmap-number = 1 
           .
      * <TOTEM:END>
       pb-elimina-AfterProcedure.
      * <TOTEM:PARA. pb-elimina-AfterProcedure>
           modify pb-elimina, bitmap-number = 4 
           .
      * <TOTEM:END>
       pb-elimina-LinkTo.
      * <TOTEM:PARA. pb-elimina-LinkTo>
           set InsertRow to false.
           inquire form1-gd-1, last-row in tot-righe, cursor-y in riga.
           if riga-nuova = 1 move riga to tot-righe end-if.
           
           if tot-righe > 1 and riga <= tot-righe
              inquire form1-gd-1(riga, 1), cell-data in store-riga
              move store-riga to riga-edit
              display message "Cancellare la riga n. " riga-edit " ?"
                        title titolo
                      default mb-no
                         type mb-yes-no
                       giving scelta
                         icon 2
              if scelta = mb-yes
                 modify form1-gd-1,  record-to-delete = riga
                 inquire form1-gd-1, last-row in tot-righe
                 if riga > tot-righe
                    move tot-righe to riga
                 end-if
                 move 0 to riga-nuova
                 if tot-righe > 1  perform SPOSTAMENTO
                 else              perform INITIALIZE-ENTRY
                                   set InsertRow to true
                 end-if
              end-if
           end-if 
           .
      * <TOTEM:END>
       ef-iva-ese-BeforeProcedure.
      * <TOTEM:PARA. ef-iva-ese-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       ef-iva-ese-AfterProcedure.
      * <TOTEM:PARA. ef-iva-ese-AfterProcedure>
              INQUIRE ef-iva-ese, VALUE IN tor-cod-ese-iva
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-iva-ese-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       ef-coubat-BeforeProcedure.
      * <TOTEM:PARA. ef-coubat-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           perform BEFORE-CAMPI.
           perform SETTA-VIRGOLA 
           .
      * <TOTEM:END>
       ef-coubat-AfterProcedure.
      * <TOTEM:PARA. ef-coubat-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO.
           perform RESETTA-VIRGOLA 
           .
      * <TOTEM:END>
       ef-consumo-BeforeProcedure.
      * <TOTEM:PARA. ef-consumo-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           perform SETTA-VIRGOLA 
           .
      * <TOTEM:END>
       ef-consumo-AfterProcedure.
      * <TOTEM:PARA. ef-consumo-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO.
           perform RESETTA-VIRGOLA 
           .
      * <TOTEM:END>
       ef-coubat-FTMA-BeforeProcedure.
      * <TOTEM:PARA. ef-coubat-FTMA-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           perform SETTA-VIRGOLA 
           .
      * <TOTEM:END>
       ef-coubat-FTMA-AfterProcedure.
      * <TOTEM:PARA. ef-coubat-FTMA-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform RESETTA-VIRGOLA 
           .
      * <TOTEM:END>
       ef-consumo-FTMA-BeforeProcedure.
      * <TOTEM:PARA. ef-consumo-FTMA-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           perform SETTA-VIRGOLA 
           .
      * <TOTEM:END>
       ef-consumo-FTMA-AfterProcedure.
      * <TOTEM:PARA. ef-consumo-FTMA-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform RESETTA-VIRGOLA 
           .
      * <TOTEM:END>
       Screen1-DaEf-1-BeforeProcedure.
      * <TOTEM:PARA. Screen1-DaEf-1-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           .
      * <TOTEM:END>
       Screen1-DaEf-1-AfterProcedure.
      * <TOTEM:PARA. Screen1-DaEf-1-AfterProcedure>
              INQUIRE ef-piano, VALUE IN tor-contropartita
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-piano-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
              INQUIRE ef-fatt-num, VALUE IN tor-fattura-from-numero
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-fatt-num-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
              INQUIRE ef-fatt-data, VALUE IN tor-fattura-from-data
              SET TOTEM-CHECK-OK TO FALSE
              PERFORM ef-fatt-data-VALIDATION
              IF NOT TOTEM-CHECK-OK
                 MOVE 1 TO ACCEPT-CONTROL
              END-IF
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR

           .
      * <TOTEM:END>

       pb-iva-BeforeProcedure.
      * <TOTEM:PARA. pb-iva-BeforeProcedure>
           modify pb-iva, bitmap-number = 1 
           .
      * <TOTEM:END>
       pb-iva-AfterProcedure.
      * <TOTEM:PARA. pb-iva-AfterProcedure>
           modify pb-iva, bitmap-number = 2 
           .
      * <TOTEM:END>
       pb-iva-LinkTo.
      * <TOTEM:PARA. pb-iva-LinkTo>
           if cli-iva-ese = spaces
              inquire form1-gd-1, last-row in tot-righe
              perform varying store-riga from 2 by 1 
                        until store-riga > tot-righe
                 move tge-cod-iva-std to col-iva
                 modify form1-gd-1(store-riga, 8), cell-data col-iva
              end-perform
              inquire ef-iva, value in ef-iva-buf
              if ef-iva-buf not = spaces
                 move tge-cod-iva-std to ef-iva-buf
                 display ef-iva
              end-if
           end-if 
           .
      * <TOTEM:END>
       ef-add-BeforeProcedure.
      * <TOTEM:PARA. ef-add-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           perform BEFORE-CAMPI.
           perform SETTA-VIRGOLA 
           .
      * <TOTEM:END>
       ef-add-AfterProcedure.
      * <TOTEM:PARA. ef-add-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO.
           perform RESETTA-VIRGOLA 
           .
      * <TOTEM:END>
       ef-add-FTMA-BeforeProcedure.
      * <TOTEM:PARA. ef-add-FTMA-BeforeProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-NU
           perform BEFORE-CAMPI.
           perform SETTA-VIRGOLA 
           .
      * <TOTEM:END>
       ef-add-FTMA-AfterProcedure.
      * <TOTEM:PARA. ef-add-FTMA-AfterProcedure>
           MODIFY CONTROL-HANDLE COLOR = COLORE-OR
           perform CONTROLLO.
           perform RESETTA-VIRGOLA 
           .
      * <TOTEM:END>

      *{TOTEM}END

      *{TOTEM}SHOW-MSG
       MESSAGE-FOR-FILEERROR.
           CALL "C$RERRNAME" USING TOTEM-MSG-ERR-FILE
           CALL "C$RERR" USING EXTEND-STAT, TEXT-MESSAGE
              MOVE PRIMARY-ERROR TO TOTEM-MSG-ID
           .

       SHOW-TRANSACTION-ROUTINE.
           IF TOTEM-TRANSACTION-FLAG = SPACES
              IF TRANSACTION-STATUS NOT = 0
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-1
              END-IF
           ELSE
              PERFORM SHOW-MSG-ROUTINE
              IF TRANSACTION-STATUS = 0
                 MOVE "Transazione terminata con Rollback." TO 
           TOTEM-MSG-3
              ELSE
                 STRING "TRANSACTION ERROR ", TRANSACTION-STATUS
                    DELIMITED BY SIZE INTO TOTEM-MSG-3
              END-IF
           END-IF
           .

       SHOW-MSG-ROUTINE.
           MOVE SPACE TO TOTEM-MSG-1 TOTEM-MSG-2 TOTEM-MSG-3
           EVALUATE TOTEM-MSG-ID
               WHEN "10"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Nessun altro dato." TO TOTEM-MSG-2
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "22"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Chiave Duplicata." TO TOTEM-MSG-2
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "23"
                    STRING "File:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-1
                    MOVE "Raggiunta fine file." TO TOTEM-MSG-2
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "101"
                    MOVE "Terminare l'applicazione?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "201"
                    MOVE "Aggiungere un nuovo record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "202"
                    MOVE "Aggiornare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "203"
                    MOVE "Cancellare il Record?" TO TOTEM-MSG-1
                    MOVE 4 TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-YES-NO TO TOTEM-MSG-BUTTON-TYPE
               WHEN "204"
                    MOVE "Chiave duplicata." TO TOTEM-MSG-1
                    MOVE MB-WARNING-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "301"
                    MOVE "Inserimento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "302"
                    MOVE "Aggiornamento avvenuto con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "303"
                    MOVE "Cancellazione avvenuta con Successo." TO 
           TOTEM-MSG-1
                    MOVE MB-DEFAULT-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN "401"
                    MOVE "Shell non trovata." TO TOTEM-MSG-1
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
               WHEN OTHER
                    MOVE TEXT-MESSAGE TO TOTEM-MSG-1
                    STRING "FILE:" TOTEM-MSG-ERR-FILE DELIMITED BY SPACE
                       INTO TOTEM-MSG-3
                    MOVE 0 TO TOTEM-IDX1
                    INSPECT TOTEM-MSG-3 TALLYING TOTEM-IDX1
                       FOR TRAILING SPACE
                    STRING TOTEM-MSG-3(1:TOTEM-MSG-LENGTH - 
           TOTEM-IDX1), 
                       ", FILE STATUS ", PRIMARY-ERROR "," 
                       SECONDARY-ERROR
                    DELIMITED BY SIZE INTO TOTEM-MSG-2
                    MOVE SPACES TO TOTEM-MSG-3
                    MOVE MB-ERROR-ICON TO TOTEM-MSG-ICON-TYPE
                    MOVE MB-OK TO TOTEM-MSG-BUTTON-TYPE
           END-EVALUATE
           PERFORM MESSAGE-BOX-ROUTINE
           .

       MESSAGE-BOX-ROUTINE.
           MOVE 1 TO TOTEM-MSG-TEXT-POINTER
           IF TOTEM-MSG-1 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-1 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              STRING TOTEM-MSG-1( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                 DELIMITED BY SIZE
                 INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-2 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-2 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-2( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-3 NOT = SPACE
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-3 TALLYING TOTEM-MSG-SIZE FOR TRAILING 
           SPACE
              IF TOTEM-MSG-TEXT-POINTER > 1
                 STRING X"0A" DELIMITED BY SIZE
                     INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
              END-IF
              STRING TOTEM-MSG-3( 1 : TOTEM-MSG-LENGTH - TOTEM-MSG-SIZE 
           )
                  DELIMITED BY SIZE
                  INTO TOTEM-MSG-TEXT, POINTER TOTEM-MSG-TEXT-POINTER
           END-IF

           IF TOTEM-MSG-TEXT-POINTER = 1
              MOVE 0 TO TOTEM-MSG-SIZE
              INSPECT TOTEM-MSG-TEXT TALLYING TOTEM-MSG-SIZE FOR 
           TRAILING SPACE
                  COMPUTE TOTEM-MSG-TEXT-POINTER = 
           TOTEM-MSG-FULL-LENGTH - TOTEM-MSG-SIZE + 1
           END-IF
           MOVE LOW-VALUES TO TOTEM-MSG-TEXT(TOTEM-MSG-TEXT-POINTER : 1 
           )
           .

       MESSAGE-BOX-DISPLAY.
           PERFORM SHOW-MSG-ROUTINE
           PERFORM MESSAGE-BOX-ROUTINE
           DISPLAY MESSAGE BOX TOTEM-MSG-TEXT
               TITLE IS TOTEM-MSG-TITLE
               TYPE  IS TOTEM-MSG-BUTTON-TYPE
               ICON  IS TOTEM-MSG-DEFAULT-BUTTON
               RETURNING TOTEM-MSG-RETURN-VALUE
           .

      *{TOTEM}END

